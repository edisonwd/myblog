{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"myblog","text":"<p>\u8bb0\u5f55\u4e00\u4e9b\u5b66\u4e60\u7b14\u8bb0 </p> <p>\u672c\u535a\u5ba2\u4f7f\u7528 MkDocs \u751f\u6210</p> <p>MkDocs\u662f\u4e00\u4e2a\u5feb\u901f\u3001\u7b80\u5355\u3001\u534e\u4e3d\u7684\u9759\u6001\u7ad9\u70b9\u751f\u6210\u5668\uff0c\u7528\u4e8e\u6784\u5efa\u9879\u76ee\u7559\u6863\u3002\u6587\u6863\u6e90\u6587\u4ef6\u662f\u7528Markdown\u7f16\u5199\u7684\uff0c\u5e76\u4f7f\u7528\u5355\u4e2aYAML\u914d\u7f6e\u6587\u4ef6\u8fdb\u884c\u914d\u7f6e\u3002\u5b83\u65e8\u5728\u6613\u4e8e\u4f7f\u7528\uff0c\u53ef\u4ee5\u901a\u8fc7\u7b2c\u4e09\u65b9\u4e3b\u9898\u3001\u63d2\u4ef6\u548cMarkdown\u6269\u5c55\u8fdb\u884c\u6269\u5c55\u3002</p>"},{"location":"#_1","title":"\u524d\u8a00","text":"<p>\u7eb8\u4e0a\u5f97\u6765\u7ec8\u89c9\u6d45\uff0c\u7edd\u77e5\u6b64\u4e8b\u8981\u8eac\u884c</p> <p>\u5728\u7f51\u4e0a\u770b\u5230\u5f88\u591a\u5927\u4f6c\u7684\u4f18\u79c0\u535a\u5ba2\uff0c\u4ece\u4ed6\u4eec\u7684\u6587\u7ae0\u4e2d\u5b66\u5230\u4e86\u5f88\u591a\uff0c\u7279\u522b\u662f\u770b\u5230\u535a\u4e3b\u7684\u81ea\u6211\u4ecb\u7ecd\u4ee5\u53ca\u535a\u6587\u5217\u8868\uff0c\u4e0d\u5f97\u4e0d\u79f0\u8d5e\u201c\u771f\u7684\u592a\u4f18\u79c0\u4e86\u201d\uff0c\u60f3\u5230\u4e86\u90a3\u53e5\uff1a\u6bd4\u4f60\u4f18\u79c0\u7684\u4eba\u6bd4\u4f60\u8fd8\u52aa\u529b\uff0c\u96be\u514d\u4ea7\u751f\u7126\u8651\u60c5\u7eea\uff0c\u4f46\u662f\u5bf9\u4e8e\u6709\u79ef\u6781\u5fc3\u7406\u7684\u4eba\uff0c\u4e5f\u8bb8\u5c31\u4e0d\u80fd\u79f0\u4e4b\u4e3a\u7126\u8651\uff0c\u800c\u662f\u6253\u4e86\u4e00\u9488\u9e21\u8840\u3002\u5c31\u76ee\u524d\u5bf9\u6211\u6765\u8bf4\u8fd8\u662f\u6bd4\u8f83\u79ef\u6781\u7684\uff0c\u4f9d\u7136\u5bf9\u6280\u672f\u8fd8\u4fdd\u6301\u7740\u70ed\u60c5\uff0c\u6240\u4ee5\u5fc3\u91cc\u9ed8\u9ed8\u5bf9\u81ea\u5df1\u8bf4\uff1a\u5e94\u8be5\u5411\u8fd9\u4e9b\u4f18\u79c0\u7684\u5927\u4f6c\u5b66\u4e60\uff0c\u517b\u6210\u5199\u535a\u5ba2\u7684\u4e60\u60ef\uff0c\u5c06\u81ea\u5df1\u5b66\u4e60\u7684\u77e5\u8bc6\u8bb0\u5f55\u4e0b\u6765\u3002</p> <p>\u8bf4\u5b9e\u8bdd\u5c31\u4e2a\u4eba\u800c\u8a00\u5e76\u4e0d\u64c5\u957f\u5199\u6587\u7ae0\uff0c\u662f\u90a3\u79cd\u9ad8\u8003\u4f5c\u6587\u90fd\u5199\u4e0d\u6ee1 800 \u5b57\u7684\u4eba\uff0c\u4e0d\u671f\u5f85\u81ea\u5df1\u80fd\u5199\u51fa\u591a\u4e48\u4f18\u79c0\u7684\u6587\u7ae0\uff0c\u53ea\u5e0c\u671b\u5c3d\u81ea\u5df1\u6700\u5927\u7684\u52aa\u529b\u5c06\u5199\u7684\u5185\u5bb9\u5c3d\u53ef\u80fd\u63cf\u8ff0\u6e05\u695a\u3002</p>"},{"location":"#mkdocs","title":"\u672c\u5730\u4f7f\u7528Mkdocs\u751f\u6210\u535a\u5ba2","text":""},{"location":"#uvpython","title":"\u4f7f\u7528uv\u521b\u5efapython\u865a\u62df\u73af\u5883","text":"<pre><code>uv venv\nsource .venv/bin/activate\n</code></pre> <p>\u4f7f\u7528 uv \u521b\u5efapython\u865a\u62df\u73af\u5883\u65f6\u6307\u5b9a\u865a\u62df\u73af\u5883\u76ee\u5f55\u548cpython\u7248\u672c\uff1a <code>uv venv .venv --python 3.12</code></p>"},{"location":"#mkdocs_1","title":"\u5b89\u88c5 Mkdocs","text":"<pre><code>uv pip install mkdocs\n</code></pre>"},{"location":"#_2","title":"\u521b\u5efa\u9879\u76ee(\u53ef\u9009)","text":"<p>\u5f53\u524d\u9879\u76ee\u5df2\u7ecf\u521b\u5efa\uff0c\u53ef\u4ee5\u8df3\u8fc7\u8be5\u6b65\u9aa4\uff0c\u76f4\u63a5\u8fdb\u5165\u9879\u76ee\u76ee\u5f55 <pre><code>mkdocs new myblog\ncd myblog\n</code></pre></p>"},{"location":"#_3","title":"\u542f\u52a8\u670d\u52a1","text":"<pre><code>mkdocs serve\n</code></pre>"},{"location":"#mkdocs-material","title":"\u5b89\u88c5mkdocs-material\u4e3b\u9898","text":"<p>mkdocs-material\u662f\u4e00\u4e2aMaterial Design\u98ce\u683c\u7684\u4e3b\u9898</p> <pre><code>uv pip install mkdocs-material\n</code></pre> <p>\u4f7f\u7528<code>mkdocs-material</code>\u4e3b\u9898\u914d\u7f6e\u652f\u6301<code>mermaid</code>\u6d41\u7a0b\u56fe\uff0c\u5728<code>mkdocs.yml</code>\u4e2d\u6dfb\u52a0\u4ee5\u4e0b\u914d\u7f6e\uff1a</p> <p>\u53c2\u8003\u6587\u6863\uff1ahttps://squidfunk.github.io/mkdocs-material/reference/diagrams/ <pre><code>theme:\n  name: material\n  features:\n    - content.code.copy\n    - content.tabs.link\nmarkdown_extensions:\n   - pymdownx.superfences:\n        custom_fences:\n           - name: mermaid\n             class: mermaid\n             format: !!python/name:pymdownx.superfences.fence_code_format\n</code></pre></p>"},{"location":"#python","title":"\u4f7f\u7528python\u811a\u672c\u751f\u6210\u5bfc\u822a\u76ee\u5f55","text":"<p>\u6211\u4eec\u9700\u8981\u8bfb\u53d6\u539f\u59cb\u7684<code>mkdocs.yml</code>\u6587\u4ef6\uff0c\u7136\u540e\u4fee\u6539\u5176\u4e2d\u7684nav\u90e8\u5206\uff0c\u5176\u4ed6\u90e8\u5206\u4fdd\u6301\u4e0d\u53d8\u3002</p> <p>\u4f7f\u7528python\u811a\u672c\u751f\u6210\u5bfc\u822a\u76ee\u5f55\u5305\u542b\u4e24\u4e2a\u90e8\u5206\uff1a</p> <ol> <li>\u751f\u6210\u5bfc\u822a\u5217\u8868\u7684\u51fd\u6570\uff08\u9012\u5f52\uff09</li> <li>\u4f7f\u7528ruamel.yaml\u66ff\u6362\u539fYAML\u4e2d\u7684nav\u90e8\u5206</li> </ol> <p>\u6ce8\u610f\uff1a\u6211\u4eec\u5047\u8bbedocs\u76ee\u5f55\u4e3a\u5f53\u524d\u76ee\u5f55\u4e0b\u7684<code>docs</code>\u6587\u4ef6\u5939\u3002</p>"},{"location":"#_4","title":"\u751f\u6210\u5bfc\u822a\u5217\u8868\u7684\u51fd\u6570\uff08\u9012\u5f52\uff09","text":"<p>\u6211\u4eec\u9700\u8981\u6839\u636e\u4e00\u4e2a\u6587\u4ef6\u5939\u7684\u76ee\u5f55\u7ed3\u6784\u751f\u6210MkDocs\u7684\u5bfc\u822a\u5217\u8868\uff08nav\uff09\u3002\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2adocs\u76ee\u5f55\uff0c\u5176\u4e2d\u5305\u542b\u4e86\u6240\u6709\u7684Markdown\u6587\u4ef6\uff08.md\uff09\u4ee5\u53ca\u5b50\u6587\u4ef6\u5939\u3002</p> <p>\u8981\u6c42\uff1a</p> <ol> <li> <p>\u5bfc\u822a\u5217\u8868\u5e94\u8be5\u53cd\u6620\u76ee\u5f55\u7ed3\u6784\uff0c\u5373\u5b50\u6587\u4ef6\u5939\u7684\u5185\u5bb9\u5e94\u8be5\u5d4c\u5957\u5728\u6587\u4ef6\u5939\u540d\u79f0\u4e0b\u3002</p> </li> <li> <p>\u53ea\u5305\u542bMarkdown\u6587\u4ef6\uff08.md\uff09\u548c\u6587\u4ef6\u5939\uff08\u5982\u679c\u6587\u4ef6\u5939\u4e2d\u6709Markdown\u6587\u4ef6\uff0c\u5219\u4fdd\u7559\u8be5\u6587\u4ef6\u5939\uff09\u3002</p> </li> <li> <p>\u5ffd\u7565\u7a7a\u6587\u4ef6\u5939\u3002</p> </li> <li> <p>\u5ffd\u7565\u975eMarkdown\u6587\u4ef6\uff08\u4f8b\u5982\u56fe\u7247\u7b49\uff09\u3002</p> </li> <li> <p>\u6587\u4ef6\u5939\u548c\u6587\u4ef6\u7684\u987a\u5e8f\u53ef\u4ee5\u6309\u7167\u6587\u4ef6\u7cfb\u7edf\u987a\u5e8f\uff08\u6216\u8005\u6309\u540d\u79f0\u6392\u5e8f\uff0c\u8fd9\u91cc\u6211\u4eec\u6309\u5b57\u6bcd\u987a\u5e8f\u6392\u5e8f\uff09\u3002</p> </li> <li> <p>\u6ce8\u610f\uff1aMkDocs\u8981\u6c42nav\u4e2d\u7684\u6bcf\u4e2a\u6761\u76ee\u8981\u4e48\u662f\u5b57\u7b26\u4e32\uff08\u8868\u793a\u5355\u4e2a\u9875\u9762\uff09\uff0c\u8981\u4e48\u662f\u5b57\u5178\uff08\u952e\u4e3a\u6807\u9898\uff0c\u503c\u4e3a\u9875\u9762\u8def\u5f84\u6216\u5d4c\u5957\u5217\u8868\uff09\u3002</p> </li> </ol> <p>\u5b9e\u73b0\u601d\u8def\uff1a</p> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u9012\u5f52\u51fd\u6570\u904d\u5386\u76ee\u5f55\uff0c\u4e3a\u6bcf\u4e2a\u76ee\u5f55\u751f\u6210\u4e00\u4e2a\u5b57\u5178\uff08\u952e\u4e3a\u76ee\u5f55\u540d\uff0c\u503c\u4e3a\u8be5\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u5217\u8868\u548c\u5b50\u76ee\u5f55\u5217\u8868\uff09\uff0c\u800c\u6587\u4ef6\u5219\u76f4\u63a5\u751f\u6210\u5176\u76f8\u5bf9\u4e8edocs\u76ee\u5f55\u7684\u8def\u5f84\uff08\u4e0d\u5e26\u6269\u5c55\u540d\uff1f\u4f46\u662fMkDocs\u8981\u6c42\u5e26\u6269\u5c55\u540d\uff09\u3002</p> <p>\u4f46\u662f\u6ce8\u610f\uff1aMkDocs\u7684nav\u914d\u7f6e\u4e2d\uff0c\u9875\u9762\u8def\u5f84\u662f\u76f8\u5bf9\u4e8edocs\u76ee\u5f55\u7684\uff0c\u4e14\u9700\u8981\u5305\u542b\u6269\u5c55\u540d\uff08\u9664\u975e\u914d\u7f6e\u4e86\u6269\u5c55\u540d\u9690\u85cf\uff09\u3002\u53e6\u5916\uff0c\u6587\u4ef6\u5939\u7684\u540d\u79f0\u5e94\u8be5\u4f5c\u4e3a\u5bfc\u822a\u7684\u6807\u9898\u3002</p> <p>\u6b65\u9aa4\uff1a</p> <ol> <li> <p>\u5b9a\u4e49\u6839\u76ee\u5f55\uff08\u4f8b\u5982'docs'\uff09\u3002</p> </li> <li> <p>\u9012\u5f52\u904d\u5386\u76ee\u5f55\uff0c\u6784\u5efa\u5d4c\u5957\u7684\u5217\u8868\u7ed3\u6784\u3002</p> </li> <li> <p>\u5bf9\u4e8e\u6bcf\u4e2a\u76ee\u5f55\uff0c\u5148\u6536\u96c6\u6240\u6709.md\u6587\u4ef6\uff08\u4e0d\u5305\u62ecREADME.md\uff1f\u6216\u8005\u5305\u62ec\uff0c\u4f46\u901a\u5e38\u6211\u4eec\u53ef\u80fd\u5e0c\u671b\u5c06README.md\u4f5c\u4e3a\u76ee\u5f55\u7684\u7d22\u5f15\u9875\uff0c\u8fd9\u91cc\u6211\u4eec\u6309\u7167\u666e\u901a\u6587\u4ef6\u5904\u7406\uff09\u3002</p> </li> <li> <p>\u5bf9\u4e8e\u6bcf\u4e2a\u5b50\u76ee\u5f55\uff0c\u5982\u679c\u975e\u7a7a\uff08\u5305\u542b.md\u6587\u4ef6\u6216\u5305\u542b.md\u6587\u4ef6\u7684\u5b50\u76ee\u5f55\uff09\uff0c\u5219\u5c06\u5176\u4f5c\u4e3a\u4e00\u4e2a\u5d4c\u5957\u7684\u5b57\u5178\u9879\u3002</p> </li> </ol> <p>\u6ce8\u610f\uff1aMkDocs\u8981\u6c42\u7d22\u5f15\u9875\u901a\u5e38\u662findex.md\uff0c\u4f46\u6211\u4eec\u7684\u6587\u4ef6\u53ef\u80fd\u662f\u4efb\u610f\u7684\u3002\u6240\u4ee5\u8fd9\u91cc\u6211\u4eec\u4e0d\u7279\u522b\u5904\u7406\u7d22\u5f15\u9875\uff0c\u800c\u662f\u6309\u7167\u666e\u901a\u6587\u4ef6\u5904\u7406\u3002</p>"},{"location":"#ruamelyamlyamlnav","title":"\u4f7f\u7528<code>ruamel.yaml</code>\u5e93\u66ff\u6362\u539fYAML\u4e2d\u7684nav\u90e8\u5206","text":"<p>\u7531\u4e8eyaml\u6587\u4ef6\u4e2d\u5305\u542b\u81ea\u5b9a\u4e49\u7684\u6807\u7b7e\uff08\u5982<code>!!python/name:...</code>\uff09\uff0c\u4e3a\u4e86\u907f\u514d\u89e3\u6790\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u91c7\u7528\u4ee5\u4e0b\u7b56\u7565\uff1a</p> <ol> <li> <p>\u4f7f\u7528<code>ruamel.yaml</code>\u5e93\uff0c\u56e0\u4e3a\u5b83\u53ef\u4ee5\u4fdd\u7559\u6ce8\u91ca\u548c\u81ea\u5b9a\u4e49\u6807\u7b7e\u3002</p> </li> <li> <p>\u5982\u679c\u6211\u4eec\u4f7f\u7528<code>PyYAML</code>\uff0c\u9700\u8981\u7279\u522b\u5904\u7406\u81ea\u5b9a\u4e49\u6807\u7b7e\uff08\u4f46<code>PyYAML</code>\u9047\u5230\u81ea\u5b9a\u4e49\u6807\u7b7e<code>!!python/name:...</code>\u4f1a\u62a5\u9519\uff09\u3002</p> </li> </ol> <p>\u56e0\u6b64\uff0c\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528<code>ruamel.yaml</code>\uff0c\u56e0\u4e3a\u5b83\u80fd\u591f\u66f4\u597d\u5730\u5904\u7406yaml\u6587\u4ef6\u7684\u4fdd\u7559\u683c\u5f0f\uff08\u5305\u62ec\u6ce8\u91ca\u3001\u987a\u5e8f\u7b49\uff09\u4ee5\u53ca\u81ea\u5b9a\u4e49\u6807\u7b7e\u3002</p> <p>\u66f4\u65b0 <code>mkdocs.yml</code> \u6587\u4ef6\u4e2d\u7684 <code>nav</code> \u90e8\u5206\u6b65\u9aa4\uff1a</p> <ol> <li> <p>\u5b89\u88c5<code>ruamel.yaml</code>\uff08\u5982\u679c\u672a\u5b89\u88c5\uff09\uff1a<code>pip install ruamel.yaml</code></p> </li> <li> <p>\u8bfb\u53d6yaml\u6587\u4ef6</p> </li> <li> <p>\u4fee\u6539nav\u90e8\u5206\uff08\u66ff\u6362\u4e3a\u4e00\u4e2a\u65b0\u7684\u5bfc\u822a\u7ed3\u6784\uff09</p> </li> <li> <p>\u5c06\u4fee\u6539\u540e\u7684\u5185\u5bb9\u5199\u56de\u6587\u4ef6</p> </li> </ol> <p>\u4ee5\u4e0b\u662f\u4e00\u4e2a\u5b8c\u6574\u7684 Python \u811a\u672c\uff0c\u53ef\u4ee5\u6839\u636e\u6587\u4ef6\u5939\u76ee\u5f55\u7ed3\u6784\u81ea\u52a8\u751f\u6210 MkDocs \u7684\u5bfc\u822a\u5217\u8868\uff08nav\uff09\uff0c\u540c\u65f6\u4fdd\u6301 YAML \u6587\u4ef6\u4e2d\u7684\u5176\u4ed6\u5185\u5bb9\u4e0d\u53d8\uff0c\u5e76\u6b63\u786e\u5904\u7406\u7279\u6b8a\u6807\u7b7e\uff1a</p> <pre><code>import os\nimport ruamel.yaml\nfrom pathlib import Path\nfrom collections import OrderedDict\n\ndef generate_nav_from_directory(docs_dir='docs', ignore_dirs=None):\n    \"\"\"\n    \u6839\u636e\u6587\u4ef6\u5939\u76ee\u5f55\u751f\u6210 MkDocs \u5bfc\u822a\u5217\u8868\n\n    \u53c2\u6570:\n    docs_dir: MkDocs \u6587\u6863\u76ee\u5f55 (\u9ed8\u8ba4 'docs')\n    ignore_dirs: \u8981\u5ffd\u7565\u7684\u76ee\u5f55\u5217\u8868\n\n    \u8fd4\u56de:\n    \u5d4c\u5957\u7684\u5bfc\u822a\u5217\u8868\u7ed3\u6784\n    \"\"\"\n    if ignore_dirs is None:\n        ignore_dirs = ['.git', '.github', '.vscode', 'assets', 'images', 'js', 'css']\n\n    nav = []\n    docs_path = Path(docs_dir)\n\n    def process_directory(directory, rel_path=''):\n        \"\"\"\u9012\u5f52\u5904\u7406\u76ee\u5f55\u7ed3\u6784\"\"\"\n        items = []\n\n        # \u83b7\u53d6\u76ee\u5f55\u4e0b\u6240\u6709\u6761\u76ee\u5e76\u6392\u5e8f\n        entries = sorted(os.listdir(directory), key=lambda x: x.lower())\n\n        # \u4f18\u5148\u5904\u7406\u7d22\u5f15\u6587\u4ef6\n        index_files = ['index.md', 'README.md']\n        for index_file in index_files:\n            index_path = directory / index_file\n            if index_path.exists() and index_path.is_file():\n                # \u76f8\u5bf9\u8def\u5f84\u5904\u7406\n                rel_file_path = (rel_path + '/' + index_file).lstrip('/')\n                items.append({index_file[:-3]: rel_file_path})\n                break\n\n        # \u5904\u7406\u5176\u4ed6\u6761\u76ee\n        for entry in entries:\n            entry_path = directory / entry\n\n            # \u8df3\u8fc7\u5ffd\u7565\u76ee\u5f55\u548c\u9690\u85cf\u6587\u4ef6\n            if entry in ignore_dirs or entry.startswith('.') or entry in index_files:\n                continue\n\n            # \u5904\u7406 Markdown \u6587\u4ef6\n            if entry_path.is_file() and entry.endswith('.md'):\n                # \u76f8\u5bf9\u8def\u5f84\u5904\u7406\n                rel_file_path = (rel_path + '/' + entry).lstrip('/')\n                title = entry[:-3]  # \u79fb\u9664 .md \u6269\u5c55\u540d\n                items.append({title: rel_file_path})\n\n            # \u5904\u7406\u5b50\u76ee\u5f55\n            elif entry_path.is_dir():\n                # \u9012\u5f52\u83b7\u53d6\u5b50\u76ee\u5f55\u5185\u5bb9\n                sub_items = process_directory(\n                    entry_path, \n                    f\"{rel_path}/{entry}\" if rel_path else entry\n                )\n\n                # \u53ea\u6dfb\u52a0\u5305\u542b\u6709\u6548\u5185\u5bb9\u7684\u76ee\u5f55\n                if sub_items:\n                    # \u4f7f\u7528\u76ee\u5f55\u540d\u4f5c\u4e3a\u6807\u9898\uff0c\u4f46\u53ef\u4ee5\u81ea\u5b9a\u4e49\u5904\u7406\n                    dir_title = entry.replace('_', ' ').title()\n                    items.append({dir_title: sub_items})\n\n        return items\n\n    nav = process_directory(docs_path)\n    return nav\n\ndef update_mkdocs_nav(yaml_file='mkdocs.yml', new_nav=None):\n    \"\"\"\u66f4\u65b0 mkdocs.yml \u6587\u4ef6\u4e2d\u7684 nav \u90e8\u5206\"\"\"\n    yaml = ruamel.yaml.YAML()\n    yaml.preserve_quotes = True\n    yaml.indent(mapping=2, sequence=4, offset=2)\n\n    # \u8bfb\u53d6\u539f\u59cb YAML \u6587\u4ef6\n    with open(yaml_file, 'r', encoding='utf-8') as f:\n        data = yaml.load(f)\n\n    # \u66f4\u65b0 nav \u90e8\u5206\n    if new_nav is not None:\n        data['nav'] = new_nav\n\n    # \u5199\u56de\u4fee\u6539\u540e\u7684 YAML\n    with open(yaml_file, 'w', encoding='utf-8') as f:\n        yaml.dump(data, f)\n\nif __name__ == \"__main__\":\n    # \u914d\u7f6e\u53c2\u6570\n    DOCS_DIR = 'docs'  # MkDocs \u6587\u6863\u76ee\u5f55\n    MKDOCS_FILE = 'mkdocs.yml'  # MkDocs \u914d\u7f6e\u6587\u4ef6\n\n    # \u751f\u6210\u5bfc\u822a\u7ed3\u6784\n    nav_structure = generate_nav_from_directory(DOCS_DIR)\n\n    print(\"\u751f\u6210\u7684\u5bfc\u822a\u7ed3\u6784:\")\n    print(nav_structure)\n\n    # \u66f4\u65b0 mkdocs.yml \u6587\u4ef6\n    update_mkdocs_nav(MKDOCS_FILE, nav_structure)\n    print(f\"\\n\u6210\u529f\u66f4\u65b0 {MKDOCS_FILE} \u4e2d\u7684\u5bfc\u822a\u90e8\u5206!\")\n</code></pre>"},{"location":"#_5","title":"\u4f7f\u7528\u8bf4\u660e","text":"<ol> <li> <p>\u5b89\u88c5\u4f9d\u8d56\uff1a    <pre><code>pip install ruamel.yaml\n</code></pre></p> </li> <li> <p>\u914d\u7f6e\u53c2\u6570\uff1a</p> </li> <li><code>DOCS_DIR</code>: \u4f60\u7684 Markdown \u6587\u4ef6\u5b58\u653e\u76ee\u5f55\uff08\u9ed8\u8ba4 'docs'\uff09</li> <li> <p><code>MKDOCS_FILE</code>: mkdocs.yml \u6587\u4ef6\u8def\u5f84\uff08\u9ed8\u8ba4 'mkdocs.yml'\uff09</p> </li> <li> <p>\u8fd0\u884c\u811a\u672c\uff1a    <pre><code>python generate_nav.py\n</code></pre>    \u4f7f\u7528uv\u8fd0\u884c\uff1a    <pre><code>uv run generate_nav.py\n</code></pre></p> </li> </ol>"},{"location":"#_6","title":"\u529f\u80fd\u7279\u70b9","text":"<ol> <li>\u667a\u80fd\u76ee\u5f55\u5904\u7406\uff1a</li> <li>\u81ea\u52a8\u8bc6\u522b <code>index.md</code> \u548c <code>README.md</code> \u4f5c\u4e3a\u76ee\u5f55\u5165\u53e3</li> <li>\u5ffd\u7565\u5e38\u89c1\u975e\u5185\u5bb9\u76ee\u5f55\uff08.git, assets, images \u7b49\uff09</li> <li>\u81ea\u52a8\u8df3\u8fc7\u9690\u85cf\u6587\u4ef6\u548c\u76ee\u5f55</li> <li> <p>\u4fdd\u7559\u539f\u59cb\u6587\u4ef6\u540d\u4f5c\u4e3a\u6807\u9898\uff0c\u4f46\u53ef\u81ea\u5b9a\u4e49\u683c\u5f0f\u5316</p> </li> <li> <p>\u9012\u5f52\u76ee\u5f55\u904d\u5386\uff1a</p> </li> <li>\u81ea\u52a8\u5904\u7406\u4efb\u610f\u6df1\u5ea6\u7684\u5b50\u76ee\u5f55</li> <li>\u751f\u6210\u5d4c\u5957\u7684\u5bfc\u822a\u7ed3\u6784</li> <li> <p>\u7a7a\u76ee\u5f55\u81ea\u52a8\u8df3\u8fc7</p> </li> <li> <p>\u7279\u6b8a\u5b57\u7b26\u5904\u7406\uff1a</p> </li> <li>\u6b63\u786e\u5904\u7406\u4e2d\u6587\u6587\u4ef6\u540d\u548c\u8def\u5f84</li> <li>\u4fdd\u7559 YAML \u7279\u6b8a\u6807\u7b7e\uff08\u5982 <code>!!python/name:</code>\uff09</li> <li> <p>\u4fdd\u6301\u539f\u59cb YAML \u6587\u4ef6\u7684\u683c\u5f0f\u548c\u6ce8\u91ca</p> </li> <li> <p>\u81ea\u5b9a\u4e49\u9009\u9879\uff1a</p> </li> <li>\u53ef\u914d\u7f6e\u5ffd\u7565\u76ee\u5f55\u5217\u8868</li> <li>\u53ef\u81ea\u5b9a\u4e49\u76ee\u5f55\u6807\u9898\u683c\u5f0f\u5316\u89c4\u5219</li> <li>\u53ef\u8c03\u6574\u6392\u5e8f\u89c4\u5219\uff08\u5f53\u524d\u6309\u5b57\u6bcd\u987a\u5e8f\uff09</li> </ol>"},{"location":"#_7","title":"\u751f\u6210\u5bfc\u822a\u793a\u4f8b","text":"<p>\u5047\u8bbe\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b\uff1a <pre><code>docs/\n\u251c\u2500\u2500 index.md\n\u251c\u2500\u2500 \u4ecb\u7ecd.md\n\u251c\u2500\u2500 \u5f00\u53d1\u6307\u5357/\n\u2502   \u251c\u2500\u2500 \u5b89\u88c5.md\n\u2502   \u251c\u2500\u2500 \u914d\u7f6e.md\n\u2502   \u2514\u2500\u2500 \u9ad8\u7ea7\u6280\u5de7.md\n\u2514\u2500\u2500 API\u53c2\u8003/\n    \u251c\u2500\u2500 \u6838\u5fc3API.md\n    \u2514\u2500\u2500 \u6269\u5c55API.md\n</code></pre></p> <p>\u751f\u6210\u7684\u5bfc\u822a\u7ed3\u6784\uff1a <pre><code>nav:\n  - index: index.md\n  - \u4ecb\u7ecd: \u4ecb\u7ecd.md\n  - \u5f00\u53d1\u6307\u5357:\n      - \u5b89\u88c5: \u5f00\u53d1\u6307\u5357/\u5b89\u88c5.md\n      - \u914d\u7f6e: \u5f00\u53d1\u6307\u5357/\u914d\u7f6e.md\n      - \u9ad8\u7ea7\u6280\u5de7: \u5f00\u53d1\u6307\u5357/\u9ad8\u7ea7\u6280\u5de7.md\n  - API\u53c2\u8003:\n      - \u6838\u5fc3API: API\u53c2\u8003/\u6838\u5fc3API.md\n      - \u6269\u5c55API: API\u53c2\u8003/\u6269\u5c55API.md\n</code></pre></p>"},{"location":"#_8","title":"\u81ea\u5b9a\u4e49\u9009\u9879","text":"<p>\u5982\u679c\u9700\u8981\u4fee\u6539\u76ee\u5f55\u6807\u9898\u7684\u663e\u793a\u65b9\u5f0f\uff08\u4f8b\u5982\u53bb\u9664\u6570\u5b57\u524d\u7f00\uff09\uff0c\u53ef\u4ee5\u5728 <code>generate_nav_from_directory</code> \u51fd\u6570\u4e2d\u6dfb\u52a0\u6807\u9898\u5904\u7406\u903b\u8f91\uff1a</p> <pre><code># \u5728 process_directory \u51fd\u6570\u4e2d\u6dfb\u52a0\u6807\u9898\u5904\u7406\ndef process_directory(directory, rel_path=''):\n    # ...\n    for entry in entries:\n        # ...\n        if entry_path.is_file() and entry.endswith('.md'):\n            rel_file_path = (rel_path + '/' + entry).lstrip('/')\n            title = entry[:-3]\n\n            # \u81ea\u5b9a\u4e49\u6807\u9898\u5904\u7406\uff1a\u79fb\u9664\u6570\u5b57\u524d\u7f00\n            if ' ' in title:\n                title = title.split(' ', 1)[1]\n\n            items.append({title: rel_file_path})\n        # ...\n</code></pre> <p>\u8fd9\u4e2a\u811a\u672c\u4f1a\u4fdd\u6301\u539f\u59cb YAML \u6587\u4ef6\u4e2d\u7684\u6240\u6709\u5176\u4ed6\u914d\u7f6e\uff08\u5305\u62ec\u4e3b\u9898\u8bbe\u7f6e\u3001\u6269\u5c55\u63d2\u4ef6\u3001\u81ea\u5b9a\u4e49\u6807\u7b7e\u7b49\uff09\uff0c\u53ea\u66f4\u65b0 <code>nav</code> \u90e8\u5206\uff0c\u975e\u5e38\u9002\u5408\u81ea\u52a8\u5316\u6587\u6863\u90e8\u7f72\u6d41\u7a0b\u3002</p>"},{"location":"#github","title":"github\u535a\u5ba2\u751f\u6210\u8bf4\u660e","text":"<p>\u76f4\u63a5\u5728 GitHub \u4ed3\u5e93\u4e2d\u901a\u8fc7 GitHub Actions \u521b\u5efa\u81ea\u5b9a\u4e49\u6301\u7eed\u90e8\u7f72 (CD) \u5de5\u4f5c\u6d41\u7a0b\uff0c\u5b9e\u73b0\u4ee3\u7801\u63d0\u4ea4\u540e\u81ea\u52a8\u6784\u5efa\u7f51\u7ad9\uff0c\u914d\u7f6e\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <p>workflow\u662f\u4e00\u4e2a\u53ef\u914d\u7f6e\u7684\u81ea\u52a8\u5316\u8fc7\u7a0b\uff0c\u5c06\u8fd0\u884c\u4e00\u4e2a\u6216\u591a\u4e2a\u4f5c\u4e1a\u3002workflow\u7531\u4ee3\u7801\u4ed3\u5e93\u4e2d\u7684YAML\u6587\u4ef6\u5b9a\u4e49\uff0c\u5e76\u5c06\u5728\u4ee3\u7801\u4ed3\u5e93\u4e2d\u7684\u4e8b\u4ef6\u89e6\u53d1\u65f6\u8fd0\u884c\uff0c\u6216\u8005\u53ef\u4ee5\u624b\u52a8\u89e6\u53d1\u3002 workflow\u5728\u4ee3\u7801\u4ed3\u5e93\u7684<code>.github/workflow</code>\u76ee\u5f55\u4e2d\u5b9a\u4e49\u3002\u4e00\u4e2a\u5b58\u50a8\u5e93\u53ef\u4ee5\u6709\u591a\u4e2a\u5de5\u4f5c\u6d41\uff0c\u6bcf\u4e2a\u5de5\u4f5c\u6d41\u90fd\u53ef\u4ee5\u6267\u884c\u4e00\u7ec4\u4e0d\u540c\u7684\u4efb\u52a1\u3002</p> <p>mkdocs \u90e8\u7f72\u5230github pages \u53c2\u8003\u6587\u6863\uff1a https://www.mkdocs.org/user-guide/deploying-your-docs/</p> <ol> <li>\u5728\u4ee3\u7801\u4ed3\u5e93\u7684<code>.github/workflow</code>\u76ee\u5f55\u4e2d\u5b9a\u4e49\u4e00\u4e2a<code>yaml</code>\u6587\u4ef6\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a <pre><code>name: ci \non:\n  push:\n    branches:\n      - main\npermissions:\n  contents: write\njobs:\n  deploy:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - name: Configure Git Credentials\n        run: |\n          git config user.name github-actions[bot]\n          git config user.email 41898282+github-actions[bot]@users.noreply.github.com\n      - uses: actions/setup-python@v5\n        with:\n          python-version: 3.x\n      - run: echo \"cache_id=$(date --utc '+%V')\" &gt;&gt; $GITHUB_ENV\n      - run: pip install ruamel.yaml mkdocs-material\n      - run: python gen_mkdocs_nav.py\n      - uses: actions/cache@v4\n        with:\n          key: mkdocs-material-${{ env.cache_id }}\n          path: .cache \n          restore-keys: |\n            mkdocs-material-\n      - run: mkdocs gh-deploy --force\n</code></pre></li> </ol>"},{"location":"devops/apisix%E5%9C%A8k8s%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/","title":"apisix \u5728k8s\u4e2d\u7684\u5b9e\u8df5","text":""},{"location":"devops/apisix%E5%9C%A8k8s%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/#_1","title":"\u4e00. \u6982\u8ff0","text":"<p>\u6700\u8fd1\u5728\u4f7f\u7528\u4e00\u4e2a\u56fd\u4ea7\u7684\u4e91\u539f\u751f API \u7f51\u5173\uff08apisix\uff09,\u529f\u80fd\u975e\u5e38\u5f3a\u5927\uff0c\u672c\u6587\u6839\u636e\u5b98\u65b9\u6587\u6863\u5728 <code>minikube</code> \u4e2d\u8fdb\u884c\u5b9e\u8df5\uff0c\u5b98\u65b9\u6587\u6863\u5199\u7684\u5f88\u8be6\u7ec6\uff0c\u8be6\u60c5\u53ef\u4ee5\u67e5\u770b\u5b98\u7f51\u3002</p> <p>apisix \u5b98\u7f51\uff1ahttps://apisix.apache.org/</p>"},{"location":"devops/apisix%E5%9C%A8k8s%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/#k8s-ingress-apisix","title":"\u4e8c. \u5728 k8s \u4e2d\u5b89\u88c5 ingress apisix","text":""},{"location":"devops/apisix%E5%9C%A8k8s%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/#1","title":"1. \u73af\u5883\u51c6\u5907","text":"<ul> <li> <p>\u5b89\u88c5 Minikube.</p> </li> <li> <p>\u5b89\u88c5 Helm.</p> </li> <li> <p>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u521b\u5efa\u4e00\u4e2a\u547d\u540d\u7a7a\u95f4 <code>ingress-apisix</code></p> </li> </ul> <pre><code>kubectl create namespace ingress-apisix\n</code></pre> <ul> <li>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u6dfb\u52a0\u5b89\u88c5 apisix \u7684 helm \u4ed3\u5e93</li> </ul> <pre><code>helm repo add bitnami https://charts.bitnami.com/bitnami\nhelm repo add apisix https://charts.apiseven.com\n</code></pre> <ul> <li>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u66f4\u65b0 helm \u4ed3\u5e93</li> </ul> <pre><code>helm repo update\n</code></pre> <ul> <li>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u5728 helm \u4ed3\u5e93\u4e2d\u641c\u7d22 apisix\uff0c\u9a8c\u8bc1\u5728\u672c\u5730\u4ed3\u5e93\u662f\u5426\u5b58\u5728</li> </ul> <pre><code>[root@node01 ~]# helm search repo apisix\nNAME                              CHART VERSION   APP VERSION DESCRIPTION                                    \napisix/apisix                     0.3.4           2.6.0       A Helm chart for Apache APISIX                 \napisix/apisix-dashboard           0.1.4           2.6.0       A Helm chart for Apache APISIX Dashboard       \napisix/apisix-ingress-controller  0.5.0           1.0.0       Apache APISIX Ingress Controller for Kubernetes\n</code></pre>"},{"location":"devops/apisix%E5%9C%A8k8s%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/#2-apisix","title":"2. \u5b89\u88c5 apisix","text":"<p>Apache APISIX \u4f5c\u4e3a <code>apisix-ingress-controller</code> \u7684\u4ee3\u7406\u5e73\u9762\uff0c\u6240\u4ee5\u9700\u8981\u63d0\u524d\u90e8\u7f72\u3002</p> <p>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u6309\u7167 <code>apisix</code>\uff1a</p> <pre><code>helm install apisix apisix/apisix \\\n  --set admin.allow.ipList=\"{0.0.0.0/0}\" \\\n  --namespace ingress-apisix\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u7684\u4e00\u70b9\u662f\uff0c\u8fd9\u91cc\u4e3a\u4e86\u5feb\u901f\u6d4b\u8bd5\u8bbe\u7f6e<code>admin.allow.ipList=\"{0.0.0.0/0}\"</code>\u8868\u793a\u5141\u8bb8\u6240\u6709\u7684 IP \u8bbf\u95ee <code>Apache APISIX admin api</code> \uff0c\u8be5\u5b57\u6bb5\u5e94\u8be5\u6839\u636e k8s \u7684 <code>PodCIDR</code>(pod\u7684\u7f51\u6bb5) \u914d\u7f6e\u8fdb\u884c\u81ea\u5b9a\u4e49\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u67e5\u770b <code>podCIRD</code>\uff1a</p> <pre><code>kubectl get node node01  -o yaml |grep podCIDR\n</code></pre> <p>\u5b89\u88c5 <code>apisix</code> \u6210\u529f\u4e4b\u540e\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u67e5\u770b\u521b\u5efa\u7684 service \u8d44\u6e90\uff1a</p> <pre><code>kubectl get service --namespace ingress-apisix\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u521b\u5efa\u4e86\u4e24\u4e2aService\u8d44\u6e90\uff1a</p> <ul> <li>\u4e00\u4e2a\u662f<code>apisix-gateway</code>\uff0c\u5904\u7406\u63a5\u6536\u7684\u771f\u5b9e\u6d41\u91cf\uff1b</li> <li>\u53e6\u4e00\u4e2a\u662f<code>apisix-admin</code>\uff0c\u5b83\u5145\u5f53\u63a7\u5236\u5e73\u9762\u6765\u5904\u7406\u6240\u6709\u914d\u7f6e\u66f4\u6539\u3002</li> </ul>"},{"location":"devops/apisix%E5%9C%A8k8s%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/#3-apisix-ingress-controller","title":"3. \u5b89\u88c5 apisix-ingress-controller","text":"<p><code>apisix-ingress-controller</code> \u662f <code>Kubernetes</code> \u7684\u53e6\u4e00\u4e2a\u5165\u53e3\u63a7\u5236\u5668\uff0c\u4f7f\u7528 <code>apisix</code> \u4f5c\u4e3a\u9ad8\u6027\u80fd\u53cd\u5411\u4ee3\u7406\u3002\u5b83\u662f\u901a\u8fc7\u4f7f\u7528\u8bf8\u5982 ApisixRoute\u3001ApisixUpstream\u3001Ingress \u7b49\u58f0\u660e\u6027\u914d\u7f6e\u6765\u914d\u7f6e\u7684\uff0c\u6240\u6709\u8fd9\u4e9b\u8d44\u6e90\u90fd\u88ab\u76d1\u89c6\u5e76\u8f6c\u6362\u4e3a apisix \u4e2d\u7684\u76f8\u5e94\u8d44\u6e90\u3002</p> <p>\u8fd9\u91cc\u4f7f\u7528 helm \u5b89\u88c5 <code>apisix-ingress-controller</code>\uff0c\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u5c06\u5176\u5b89\u88c5\u5728\u4e0e <code>apisix</code> \u76f8\u540c\u7684\u547d\u540d\u7a7a\u95f4\u4e2d\uff1a</p> <pre><code>helm install apisix-ingress-controller apisix/apisix-ingress-controller \\\n  --set image.tag=dev \\\n  --set config.apisix.baseURL=http://apisix-admin:9180/apisix/admin \\\n  --set config.apisix.adminKey=edd1c9f034335f136f87ad84b625c8f1 \\\n  --namespace ingress-apisix\n</code></pre>"},{"location":"devops/apisix%E5%9C%A8k8s%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/#4-apisix-dashboard","title":"4. \u5b89\u88c5 apisix-dashboard","text":"<p><code>apache apisix</code> \u63d0\u4f9b\u4e86\u4e00\u4e2a\u63a7\u5236\u53f0\uff0c\u8ba9\u6211\u4eec\u64cd\u4f5c apisix \u66f4\u52a0\u5bb9\u6613\uff0c\u8fd9\u91cc\u4f7f\u7528 helm \u5b89\u88c5 <code>apisix-dashboard</code>\uff0c\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u5c06\u5176\u5b89\u88c5\u5728\u4e0e <code>apisix</code> \u76f8\u540c\u7684\u547d\u540d\u7a7a\u95f4\u4e2d\uff1a</p> <pre><code> helm install apisix-dashboard apisix/apisix-dashboard \\\n --set service.type=NodePort \\\n --namespace ingress-apisix\n</code></pre> <p>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u67e5\u770b <code>ingress-apisix</code> \u547d\u4ee4\u7a7a\u95f4\u4e2d\u7684 service \u8d44\u6e90\uff1a</p> <pre><code>[root@node01 ~]# kubectl get svc -n ingress-apisix \nNAME                        TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)             AGE\napisix-admin                ClusterIP   10.10.7.102    &lt;none&gt;        9180/TCP            9h\napisix-dashboard            ClusterIP   10.10.7.14     &lt;none&gt;        80/TCP              8h\napisix-etcd                 ClusterIP   10.10.4.180    &lt;none&gt;        2379/TCP,2380/TCP   9h\napisix-etcd-headless        ClusterIP   None           &lt;none&gt;        2379/TCP,2380/TCP   9h\napisix-gateway              NodePort    10.10.7.31     &lt;none&gt;        80:31124/TCP        9h\napisix-ingress-controller   ClusterIP   10.10.14.242   &lt;none&gt;        80/TCP              8h\n</code></pre> <p>\u4fee\u6539 <code>apisix-dashboard</code> \u7684 type \u7c7b\u578b\u4e3a NodePort \uff0c\u4ee5\u4fbf\u5916\u90e8\u8bbf\u95ee\uff1a</p> <pre><code>kubectl edit svc  apisix-dashboard -n ingress-apisix\n</code></pre> <p>curl 'http://127.0.0.1:10080/wolf/oauth2/token'  -H \"Content-Type: application/x-www-form-urlencoded\"  -X POST  -d \"grant_type=password&amp;client_id=test&amp;client_secret=yghS6isJ3PtPBz2pr8v8XN7OmR5QbuYNNuraDDgs&amp;username=admin&amp;password=123456\"</p>"},{"location":"devops/devops%E5%B7%A5%E5%85%B7zadig%E5%AE%9E%E8%B7%B5/","title":"devops\u5de5\u5177zadig\u5b9e\u8df5","text":""},{"location":"devops/devops%E5%B7%A5%E5%85%B7zadig%E5%AE%9E%E8%B7%B5/#helm-zadig","title":"\u4e00. \u4f7f\u7528 helm \u5b89\u88c5 zadig","text":"<p>\u5b98\u65b9\u6587\u6863\uff1ahttps://docs.koderover.com/zadig/install/overview/</p> <p>\u521b\u5efa namespace\uff1a</p> <pre><code>kubectl create ns zadig\n</code></pre> <p>\u6dfb\u52a0 zadig \u5b98\u65b9 chart \u4ed3\u5e93\uff1a</p> <pre><code>helm repo add koderover-chart https://koderover.tencentcloudcr.com/chartrepo/chart\n</code></pre> <p>\u66f4\u65b0 chart \u4ed3\u5e93\uff1a</p> <pre><code>helm  repo update\n</code></pre> <p>\u5728\u672c\u5730 chart \u4ed3\u5e93\u4e2d\u641c\u7d22 zadig\uff1a</p> <pre><code>helm search repo zadig\n</code></pre> <p>\u4e0b\u8f7d chart \u538b\u7f29\u6587\u4ef6\u5230\u672c\u5730\uff0c\u4fbf\u4e8e\u81ea\u5b9a\u4e49\u914d\u7f6e\uff1a</p> <pre><code>helm pull koderover-chart/zadig\n</code></pre> <p>\u89e3\u538b\u4e0b\u8f7d\u7684 chart \u538b\u7f29\u6587\u4ef6\uff1a</p> <pre><code>tar -zxvf zadig-1.6.0.tgz\n</code></pre> <p>\u8fdb\u5165\u89e3\u538b\u540e\u7684 zadig \u76ee\u5f55\uff0c\u4fee\u6539 <code>values.yaml</code> \u6587\u4ef6\uff1a</p> <pre><code>vim zadig/values.yaml\n</code></pre> <p>\u6839\u636e\u9700\u6c42\u4fee\u6539\u5b8c\u6210\u914d\u7f6e\u540e\uff0c\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u5b89\u88c5 zadig\uff1a</p> <pre><code>helm install -name zadig -n zadig ./zadig\n</code></pre> <p>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u67e5\u770b\u5b89\u88c5 zadig \u7684 pod\uff1a</p> <pre><code>k\n</code></pre>"},{"location":"devops/k8s%E4%B8%AD%E7%9A%84nginx-ingress%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE%E8%B7%AF%E5%BE%84%E9%87%8D%E5%AE%9A%E5%90%91/","title":"k8s\u4e2d\u7684nginx-ingress\u5982\u4f55\u914d\u7f6e\u8def\u5f84\u91cd\u5b9a\u5411","text":""},{"location":"devops/k8s%E4%B8%AD%E7%9A%84nginx-ingress%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE%E8%B7%AF%E5%BE%84%E9%87%8D%E5%AE%9A%E5%90%91/#_1","title":"\u4e00. \u9700\u6c42\u63cf\u8ff0","text":"<p>\u8def\u5f84\u91cd\u5b9a\u5411\u7684\u4e00\u822c\u5e94\u7528\u573a\u666f\uff1a</p> <ul> <li>\u8c03\u6574\u7528\u6237\u6d4f\u89c8\u7684URL\uff0c\u770b\u8d77\u6765\u66f4\u89c4\u8303</li> <li>\u4e3a\u4e86\u8ba9\u641c\u7d22\u5f15\u64ce\u6536\u5f55\u7f51\u7ad9\u5185\u5bb9\uff0c\u8ba9\u7528\u6237\u4f53\u9a8c\u66f4\u597d</li> <li>\u7f51\u7ad9\u66f4\u6362\u65b0\u57df\u540d\u540e</li> <li>\u6839\u636e\u7279\u6b8a\u7684\u53d8\u91cf\u3001\u76ee\u5f55\u3001\u5ba2\u6237\u7aef\u4fe1\u606f\u8fdb\u884c\u8df3\u8f6c</li> </ul> <p>\u6211\u8fd9\u91cc\u9047\u5230\u7684\u95ee\u9898\u662f\uff0c\u4ee5\u524d\u7684\u5f88\u591a\u670d\u52a1\u8def\u5f84\u914d\u7f6e\u4e0d\u89c4\u8303\uff0c\u6709\u7684\u670d\u52a1\u4f7f\u7528\u9879\u76ee\u540d\u4f5c\u4e3a\u4e8c\u7ea7\u8def\u5f84\uff0c\u6709\u7684\u670d\u52a1\u662f\u968f\u610f\u5b9a\u4e49\u7684\u8bbf\u95ee\u8def\u5f84\uff0c\u4e3a\u4e86\u7edf\u4e00\u4f7f\u7528\u9879\u76ee\u540d\u4f5c\u4e3a\u8bbf\u95ee\u7684\u4e8c\u7ea7\u8def\u5f84\uff0c\u907f\u514d\u4fee\u6539\u4ee3\u7801\uff0c\u6240\u4ee5\u9700\u8981\u914d\u7f6e\u8def\u5f84\u91cd\u5b9a\u5411\u3002</p> <p>\u4e3e\u4e00\u4e2a\u4f8b\u5b50\uff0c\u6211\u6709\u4e00\u4e2a <code>a \u670d\u52a1</code>\uff0c\u5b83\u539f\u6765\u7684\u8bbf\u95ee\u8def\u5f84\u662f <code>api/v1/apps</code>\uff0c\u73b0\u5728\u6211\u9700\u8981\u901a\u8fc7\u8def\u5f84 <code>a/api/v1/apps</code> \u8bbf\u95ee\uff0c\u9700\u8981\u5c06 <code>a/</code> \u91cd\u5b9a\u5411\u5230 <code>/</code>\u3002</p> <p>\u4e5f\u5c31\u662f <code>www.test.com/a/api/v1/apps</code> \u91cd\u5b9a\u5411\u5230 <code>www.test.com/api/v1/apps</code> \u3002</p>"},{"location":"devops/k8s%E4%B8%AD%E7%9A%84nginx-ingress%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE%E8%B7%AF%E5%BE%84%E9%87%8D%E5%AE%9A%E5%90%91/#_2","title":"\u4e8c. \u89e3\u51b3\u65b9\u6cd5","text":"<p>\u9700\u8981\u786e\u4fdd\u5728\u96c6\u7fa4\u4e2d\u6709\u4e00\u4e2a <code>ingress controller</code> \u6b63\u5728\u8fd0\u884c\u3002\u6211\u4eec\u53ef\u4ee5\u6309\u7167\u5982\u4e0b\u65b9\u5f0f\u914d\u7f6e <code>ingress</code> \uff1a</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    nginx.ingress.kubernetes.io/rewrite-target: /$2\n  name: rewrite\n  namespace: default\nspec:\n  ingressClassName: nginx\n  rules:\n  - host: www.test.com\n    http:\n      paths:\n      - path: /a(/|$)(.*)\n        pathType: Prefix\n        backend:\n          service:\n            name: http-svc\n            port: \n              number: 80\n</code></pre> <p>\u5728\u8fd9\u4e2a ingress \u7684\u5b9a\u4e49\u4e2d\uff0c\u901a\u8fc7\u5728 <code>annotations</code> \u4e2d\u6307\u5b9a\u4e86 <code>nginx.ingress.kubernetes.io/rewrite-target: /$2</code> \u6765\u8fdb\u884c\u91cd\u5b9a\u5411\uff0c<code>(.*)</code> \u6355\u83b7\u7684\u4efb\u4f55\u5b57\u7b26\u90fd\u5c06\u88ab\u5206\u914d\u7ed9\u5360\u4f4d\u7b26 <code>$2</code>\uff0c\u7136\u540e\u5728 <code>rewrite-target</code> \u4e2d\u7528\u4f5c\u53c2\u6570\u3002</p> <p>\u5e94\u7528\u4e0a\u9762\u7684 ingress \u914d\u7f6e\uff0c\u53ef\u4ee5\u5b9e\u73b0\u4e0b\u9762\u7684\u91cd\u5b9a\u5411\uff1a</p> <ul> <li><code>www.test.com/a</code> \u91cd\u5b9a\u5411\u5230 <code>www.test.com/</code></li> <li><code>www.test.com/a/</code> \u91cd\u5b9a\u5411\u5230 <code>www.test.com/</code></li> <li><code>www.test.com/a/api/v1/apps</code> \u91cd\u5b9a\u5411\u5230 <code>www.test.com/api/v1/apps</code></li> </ul> <p><code>rewriting</code> \u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684 <code>anntations</code> \u8fdb\u884c\u63a7\u5236\uff1a</p> \u540d\u79f0 \u63cf\u8ff0 \u503c <code>nginx.ingress.kubernetes.io/rewrite-target</code> \u5fc5\u987b\u91cd\u5b9a\u5411\u6d41\u91cf\u7684\u76ee\u6807URI string <code>nginx.ingress.kubernetes.io/ssl-redirect</code> \u8868\u793a\u4f4d\u7f6e\u90e8\u5206\u662f\u5426\u53ef\u8bbf\u95eeSSL\uff08\u5f53Ingress\u5305\u542b\u8bc1\u4e66\u65f6\u9ed8\u8ba4\u4e3aTrue\uff09 bool <code>nginx.ingress.kubernetes.io/force-ssl-redirect</code> \u5f3a\u5236\u91cd\u5b9a\u5411\u5230HTTPS\uff0c\u5373\u4f7f\u5165\u53e3\u6ca1\u6709\u542f\u7528TLS bool <code>nginx.ingress.kubernetes.io/app-root</code> \u5b9a\u4e49\u5e94\u7528\u6839\uff0c\u5982\u679c\u5b83\u5728'/'\u4e0a\u4e0b\u6587\u4e2d\uff0c\u63a7\u5236\u5668\u5fc5\u987b\u91cd\u5b9a\u5411\u5b83 string <code>nginx.ingress.kubernetes.io/use-regex</code> \u8868\u793aIngress\u4e0a\u5b9a\u4e49\u7684\u8def\u5f84\u662f\u5426\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f bool <p>App Root</p> <p>\u521b\u5efa\u4e00\u4e2a\u5e26\u6709 <code>nginx.ingress.kubernetes.io/app-root</code> \u6ce8\u89e3\u7684 <code>ingress</code>\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    nginx.ingress.kubernetes.io/app-root: /app1\n  name: approot\n  namespace: default\nspec:\n  ingressClassName: nginx\n  rules:\n  - host: approot.bar.com\n    http:\n      paths:\n      - path: /\n        pathType: Prefix\n        backend:\n          service:\n            name: http-svc\n            port: \n              number: 80\n</code></pre> <p>\u68c0\u67e5 rewrite \u662f\u5426\u8d77\u4f5c\u7528\uff1a</p> <pre><code>$ curl -I -k http://approot.bar.com/\nHTTP/1.1 302 Moved Temporarily\nServer: nginx/1.11.10\nDate: Mon, 13 Mar 2017 14:57:15 GMT\nContent-Type: text/html\nContent-Length: 162\nLocation: http://approot.bar.com/app1\nConnection: keep-alive\n</code></pre> <p>\u53c2\u8003\u6587\u6863 https://github.com/kubernetes/ingress-nginx/blob/main/docs/examples/rewrite/README.md https://www.cnblogs.com/brianzhu/p/8624703.html</p>"},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8jenkins/","title":"\u5728 k8s \u4e2d\u5b89\u88c5 jenkins \u5e76\u914d\u7f6e\u5b9e\u73b0 CI/CD","text":"<p>\u6211\u4eec\u628a\u4e16\u754c\u770b\u9519\uff0c\u53cd\u8bf4\u5b83\u6b3a\u9a97\u4e86\u6211\u4eec\u3002\u2014\u2014 \u6cf0\u6208\u5c14\u300a\u98de\u9e1f\u96c6\u300b</p>"},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8jenkins/#_1","title":"\u4e00. \u6982\u8ff0","text":"<p>\u5728\u5b66\u4e60\u4f7f\u7528\u4e00\u4e2a\u5de5\u5177\u4e4b\u524d\uff0c\u6211\u4eec\u9700\u8981\u77e5\u9053\u600e\u4e48\u5b89\u88c5\u5b83\u3002\u672c\u6587\u5c06\u81ea\u5df1\u5b66\u4e60\u7684\u8fc7\u7a0b\u8bb0\u5f55\u4e0b\u6765\uff0c\u4e00\u65b9\u9762\u5de9\u56fa\u5b66\u4e60\u7684\u5185\u5bb9\uff0c\u53e6\u4e00\u65b9\u9762\u5e0c\u671b\u5bf9\u6709\u540c\u6837\u9700\u6c42\u7684\u5c0f\u4f19\u4f34\u63d0\u4f9b\u4e00\u4e9b\u5e2e\u52a9\u3002</p> \u5f00\u6e90\u5de5\u5177 \u63cf\u8ff0 \u5b98\u65b9\u6587\u6863 \u5b98\u65b9\u5b89\u88c5\u6587\u6863 docker \u5b89\u88c5 jenkins devops\u6301\u7eed\u96c6\u6210\u5de5\u5177 jenkins \u5b98\u7f51 jenkins \u5feb\u901f\u5b89\u88c5 docker \u5b89\u88c5 <p>\u4e0a\u9762\u8868\u683c\u5217\u51fa\u4e86\u5b98\u65b9\u7684\u5b89\u88c5\u5730\u5740\uff0c\u5982\u679c\u9700\u8981\u5feb\u901f\u4f53\u9a8c\u4f7f\u7528\uff0c\u5efa\u8bae\u76f4\u63a5\u4f7f\u7528 docker \u5b89\u88c5\uff0c\u4e00\u884c\u547d\u4ee4\u5c31\u53ef\u4ee5\u542f\u52a8\u5e94\u7528\uff1a</p> <pre><code>docker run -p 8080:8080 -p 50000:50000 jenkins/jenkins:lts-jdk11\n</code></pre> <p>\u672c\u6587\u4ecb\u7ecd\u5728 k8s \u4e2d\u5b89\u88c5\u5e76\u4f7f\u7528 jenkins\uff0c\u4e3b\u8981\u901a\u8fc7\u4e24\u79cd\u65b9\u5f0f\u5b89\u88c5\u5b9e\u8df5\uff1a</p> <ul> <li>\u81ea\u5df1\u7f16\u5199 <code>yaml</code> \u6587\u4ef6\u5b89\u88c5</li> <li>\u4f7f\u7528 helm \u5b89\u88c5</li> </ul>"},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8jenkins/#_2","title":"\u5b89\u88c5\u73af\u5883","text":"<p>\u8fd9\u91cc\u4f7f\u7528 minikube \u8fdb\u884c\u5b89\u88c5\uff0c\u5728 k8s \u96c6\u7fa4\u4e2d\u57fa\u672c\u4f7f\u7528\u662f\u4e00\u6837\u7684</p> <ul> <li>minikube :  v1.18.1</li> <li>helm : v3.5.3</li> </ul>"},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8jenkins/#yaml-jenkins","title":"\u4e8c. \u81ea\u5b9a\u4e49 <code>yaml</code> \u6587\u4ef6\u5b89\u88c5 jenkins","text":"<p>\u7531\u4e8e jenkins \u9700\u8981\u6301\u4e45\u5316\u6570\u636e\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u521b\u5efa <code>PVC</code> \uff0c\u5efa\u8bae\u4f7f\u7528 <code>storageClass</code> \u52a8\u6001\u521b\u5efa <code>PVC</code>\uff0c\u5728 <code>minikube</code> \u4e2d\u6709\u4e00\u4e2a\u9ed8\u8ba4\u7684 <code>storageClass</code>\uff0c\u540d\u79f0\u662f\uff1a<code>standard</code>\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u67e5\u770b\uff1a</p> <pre><code># kubectl get sc\nNAME                 PROVISIONER                RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE\nstandard (default)   k8s.io/minikube-hostpath   Delete          Immediate           false                  50m\n</code></pre> <p>\u5173\u4e8e storageClass \u7684\u4f7f\u7528\u53ef\u4ee5\u67e5\u770b\u5b98\u7f51\uff1ahttps://kubernetes.io/zh/docs/concepts/storage/storage-classes/</p> <p>\u521b\u5efa <code>jenkins-deploy.yaml</code> \u6587\u4ef6\uff0c\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>###############\u4f7f\u7528 storageClass \u521b\u5efa pvc ###################\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: jenkins-data-pvc\n  namespace: default\nspec:\n  accessModes:\n    - ReadWriteMany\n  # \u6307\u5b9a storageClass \u7684\u540d\u5b57\uff0c\u8fd9\u91cc\u4f7f\u7528 minikube \u9ed8\u8ba4\u7684 standard\n  storageClassName: \"standard\"\n  resources:\n    requests:\n      storage: 10Gi\n\n###############\u521b\u5efa\u4e00\u4e2aServiceAccount \u540d\u79f0\u4e3a\uff1ajenkins-admin###################\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: jenkins-admin\n  namespace: default\n  labels:\n    name: jenkins\n\n###############\u7ed1\u5b9a\u8d26\u6237jenkins-admin \u4e3a\u96c6\u7fa4\u7ba1\u7406\u5458\u89d2\u8272\uff0c\u4e3a\u4e86\u63a7\u5236\u6743\u9650\u5efa\u8bae\u7ed1\u5b9a\u81ea\u5b9a\u4e49\u89d2\u8272###################\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: jenkins-admin\n  labels:\n    name: jenkins\nsubjects:\n  - kind: ServiceAccount\n    name: jenkins-admin\n    namespace: default\nroleRef:\n  kind: ClusterRole\n  # cluster-admin \u662f k8s \u96c6\u7fa4\u4e2d\u9ed8\u8ba4\u7684\u7ba1\u7406\u5458\u89d2\u8272\n  name: cluster-admin\n  apiGroup: rbac.authorization.k8s.io\n\n\n############### \u5728 default \u547d\u540d\u7a7a\u95f4\u521b\u5efa deployment ###################\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: jenkins\n  namespace: default\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: jenkins\n  template:\n    metadata:\n      labels:\n        app: jenkins\n    spec:\n      terminationGracePeriodSeconds: 10\n      # \u6ce8\u610f\uff1ak8s 1.21.x \u4e2d serviceAccount \u6539\u540d\u4e3a serviceAccountName\n      # \u8fd9\u91cc\u586b\u5199\u4e0a\u9762\u521b\u5efa\u7684 serviceAccount \u7684 name\n      serviceAccount: jenkins-admin\n      containers:\n        - name: jenkins\n          image: jenkins/jenkins:lts-jdk11\n          imagePullPolicy: IfNotPresent\n          env:\n            - name: JAVA_OPTS\n              value: -Duser.timezone=Asia/Shanghai\n          ports:\n            - containerPort: 8080\n              name: web\n              protocol: TCP\n            - containerPort: 50000\n              name: agent\n              protocol: TCP\n          resources:\n            limits:\n              cpu: 1000m\n              memory: 1Gi\n            requests:\n              cpu: 500m\n              memory: 512Mi\n          livenessProbe:\n            httpGet:\n              path: /login\n              port: 8080\n            initialDelaySeconds: 60\n            timeoutSeconds: 5\n            failureThreshold: 12\n          readinessProbe:\n            httpGet:\n              path: /login\n              port: 8080\n            initialDelaySeconds: 60\n            timeoutSeconds: 5\n            failureThreshold: 12\n          volumeMounts:\n            - name: jenkinshome\n              mountPath: /var/jenkins_home\n      volumes:\n        - name: jenkinshome\n          persistentVolumeClaim:\n            claimName: jenkins-data-pvc\n\n############### \u5728 default \u547d\u540d\u7a7a\u95f4\u521b\u5efa service ###################\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: jenkins\n  namespace: default\n  labels:\n    app: jenkins\nspec:\n  selector:\n    app: jenkins\n  type: ClusterIP\n  ports:\n    - name: web\n      port: 8080\n      targetPort: 8080\n\n\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: jenkins-agent\n  namespace: default\n  labels:\n    app: jenkins\nspec:\n  selector:\n    app: jenkins\n  type: ClusterIP\n  ports:\n    - name: agent\n      port: 50000\n      targetPort: 50000\n</code></pre> <p>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u90e8\u7f72 jenkins\uff1a</p> <pre><code># kubectl apply -f jenkins-deploy.yaml\n\npersistentvolumeclaim/jenkins-data-pvc created\nserviceaccount/jenkins-admin created\nclusterrolebinding.rbac.authorization.k8s.io/jenkins-admin created\ndeployment.apps/jenkins created\nservice/jenkins created\nservice/jenkins-agent created\n</code></pre> <p>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u4e34\u65f6\u66b4\u9732\u670d\u52a1\u7aef\u53e3\uff1a</p> <pre><code>kubectl port-forward service/jenkins 8080:8080 -n default\n</code></pre> <p>\u751f\u4ea7\u73af\u5883\u5efa\u8bae\u4f7f\u7528 ingress \u901a\u8fc7\u57df\u540d\u66b4\u9732\u670d\u52a1</p> <p>\u66b4\u9732\u670d\u52a1\u7aef\u53e3\u540e\uff0c\u53ef\u4ee5\u8bbf\u95ee\uff1ahttp://localhost:8080</p> <p></p> <p>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u67e5\u770b\u7ba1\u7406\u5458\u5bc6\u7801\uff1a</p> <pre><code># kubectl get pod -n default\nNAME                       READY   STATUS    RESTARTS   AGE\njenkins-68666b56fc-p8fvd   1/1     Running   0          8m28s\n\n# kubectl exec jenkins-68666b56fc-p8fvd -- cat /var/jenkins_home/secrets/initialAdminPassword\nb06be4420bcd4a02ab4968ab02838986\n</code></pre> <p>\u767b\u5f55\u6210\u529f\u540e\uff0c\u9700\u8981\u5b89\u88c5\u63d2\u4ef6\uff1a</p> <p></p> <p></p> <p>\u8fd9\u91cc\u4e0d\u5b89\u88c5\u63a8\u8350\u7684\u63d2\u4ef6\u7684\u539f\u56e0\u662f\uff0c\u5f88\u591a\u63d2\u4ef6\u6211\u4eec\u662f\u4e0d\u9700\u8981\u7684\uff0c\u8fd8\u6709\u5c31\u662f\u9ed8\u8ba4\u4e0b\u8f7d\u63d2\u4ef6\u4f1a\u4ece\u56fd\u5916\u4e0b\u8f7d\uff0c\u6bd4\u8f83\u6162\uff0c\u540e\u9762\u4f1a\u4ecb\u7ecd\u914d\u7f6e\u56fd\u5185\u4e0b\u8f7d\u5730\u5740\u3002</p> <p>\u70b9\u51fb\u5b89\u88c5\u540e\uff0c\u521b\u5efa\u7b2c\u4e00\u4e2a\u7ba1\u7406\u5458\u7528\u6237\uff1a</p> <p></p> <p>\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u914d\u7f6e\uff0c\u8fd9\u91cc\u9009\u62e9\u4f7f\u7528admin \u8d26\u53f7\u7ee7\u7eed\u3002</p> <p></p>"},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8jenkins/#helm-jenkins","title":"\u4e09. \u4f7f\u7528 helm \u5b89\u88c5 jenkins","text":"<p>\u53ef\u4ee5\u53bb\u5230 helm \u5b98\u65b9\u5305\u7ba1\u7406\u4ed3\u5e93\u67e5\u627e\u9700\u8981\u5b89\u88c5\u7684\u5e94\u7528\u3002</p> <p>helm \u5305\u7ba1\u7406\u5730\u5740\uff1ahttps://artifacthub.io/</p> <p>\u5728 Artifact hub \u4e2d\u641c\u7d22 jenkins\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u6839\u636e jenkins \u7684\u8bf4\u660e\u8fdb\u884c\u5b89\u88c5\uff0c\u4e0b\u9762\u8be6\u7ec6\u4ecb\u7ecd\u4e00\u4e0b\u5b89\u88c5\u6b65\u9aa4\uff1a</p> <p>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u6dfb\u52a0\u5b89\u88c5 jenkins \u7684\u4ed3\u5e93</p> <pre><code>$  helm repo add jenkins https://charts.jenkins.io\n\"jenkins\" has been added to your repositories\n</code></pre> <p>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u67e5\u770b\u5df2\u7ecf\u6dfb\u52a0\u7684helm\u4ed3\u5e93\uff1a</p> <pre><code>$  helm repo list\nNAME            URL\nkong            https://charts.konghq.com\naliyun          https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts\nstable          https://charts.helm.sh/stable\nkubeview        https://benc-uk.github.io/kubeview/charts\ntscharts        https://technosophos.github.com/tscharts\nbitnami         https://charts.bitnami.com/bitnami\napisix          https://charts.apiseven.com\njenkins         https://charts.jenkins.io\n</code></pre> <p>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u66f4\u65b0 helm \u4ed3\u5e93\uff1a</p> <pre><code>$  helm repo update\n</code></pre> <p>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u53ef\u4ee5\u641c\u7d22\u4ed3\u5e93\u4e2d\u7684 jenkins\uff1a</p> <pre><code>$  helm search repo jenkins\n\naliyun/jenkins  0.13.5          2.73            Open source continuous integration server. It s...\nbitnami/jenkins 8.0.8           2.289.3         The leading open source automation server\njenkins/jenkins 3.5.9           2.289.3         Jenkins - Build great things at any scale! The ...\nstable/jenkins  2.5.4           lts             DEPRECATED - Open source continuous integration...\n</code></pre> <p>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u67e5\u770b\u53ef\u4ee5\u914d\u7f6e\u7684\u5185\u5bb9\uff1a</p> <pre><code>$  helm show values jenkins/jenkins\n</code></pre> <p>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u4e0b\u8f7d helm \u7684 chart \u5305\u5230\u672c\u5730\uff1a</p> <pre><code>$  helm pull jenkins/jenkins\n</code></pre> <p>\u4e0b\u8f7d\u4e0b\u6765\u7684\u662f\u4e00\u4e2a\u538b\u7f29\u5305\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>tar -zxvf</code> \u547d\u4ee4\u89e3\u538b\uff1a</p> <pre><code>$  tar -zxvf jenkins-3.5.9.tgz\n\n-rw-r--r-- 1  1049089 45006 Jul 28 23:36 CHANGELOG.md\n-rw-r--r-- 1  1049089  1287 Jul 28 23:36 Chart.yaml\n-rw-r--r-- 1  1049089 30809 Jul 28 23:36 README.md\n-rw-r--r-- 1  1049089 37647 Jul 28 23:36 VALUES_SUMMARY.md\ndrwxr-xr-x 1  1049089     0 Aug  5 17:59 templates\n-rw-r--r-- 1  1049089 36203 Jul 28 23:36 values.yaml\n</code></pre> <p>\u6839\u636e\u9700\u8981\u4fee\u6539 <code>values.yaml</code> \u6587\u4ef6\u8fdb\u884c\u81ea\u5b9a\u4e49\u914d\u7f6e\uff0c\u8fd9\u91cc\u4e3a\u4e86\u5feb\u901f\u4f53\u9a8c\uff0c\u4e0d\u505a\u5176\u4ed6\u914d\u7f6e\uff0c\u76f4\u63a5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u8fdb\u884c\u5b89\u88c5\uff1a</p> <pre><code>$  helm install jenkins ./jenkins\n</code></pre> <p>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u67e5\u770b\u767b\u5f55\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\uff1a</p> <pre><code># \u67e5\u770b\u767b\u5f55\u7684\u7528\u6237\u540d\n$  kubectl exec jenkins-0 -- cat /run/secrets/chart-admin-username\n# \u67e5\u770b\u767b\u5f55\u7684\u5bc6\u7801\n$  kubectl exec jenkins-0 -- cat /run/secrets/chart-admin-password\n</code></pre> <p>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u4e34\u65f6\u66b4\u9732\u670d\u52a1\uff1a</p> <pre><code>kubectl --namespace default port-forward svc/jenkins 8080:8080\n</code></pre> <p>\u751f\u4ea7\u73af\u5883\u5efa\u8bae\u4f7f\u7528 ingress \u901a\u8fc7\u57df\u540d\u66b4\u9732\u670d\u52a1</p> <p>\u66b4\u9732\u670d\u52a1\u7aef\u53e3\u540e\uff0c\u53ef\u4ee5\u8bbf\u95ee\uff1ahttp://localhost:8080\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8jenkins/#jenkins-devops","title":"\u56db. \u914d\u7f6e jenkins \u5b9e\u73b0 devops","text":"<p>\u6839\u636e\u524d\u9762\u7684\u6b65\u9aa4\u5df2\u7ecf\u5b89\u88c5\u597d\u4e86 jenkins\uff0c\u63a5\u4e0b\u6765\u6211\u5c06\u4ecb\u7ecd\u5982\u4f55\u914d\u7f6e jenkins \u5b9e\u73b0 devops\u3002</p>"},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8jenkins/#1","title":"1. \u914d\u7f6e\u63d2\u4ef6\u66f4\u65b0\u7ad9\u70b9\u4e3a\u56fd\u5185\u6e90","text":"<p>\u9ed8\u8ba4\u63d2\u4ef6\u66f4\u65b0\u7ad9\u70b9\u4e3a\uff1a <code>https://updates.jenkins.io/update-center.json</code></p> <p>\u4fee\u6539\u63d2\u4ef6\u66f4\u65b0\u7ad9\u70b9\u4e3a\uff1a<code>https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</code></p> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8jenkins/#2","title":"2. \u4e0b\u8f7d\u5e38\u7528\u63d2\u4ef6","text":"<p>\u4e0b\u8f7d\u5e38\u7528\u63d2\u4ef6\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8jenkins/#3-kubernetes","title":"3. \u914d\u7f6e kubernetes \u96c6\u7fa4","text":"<p>\u70b9\u51fb \u3010\u7cfb\u7edf\u7ba1\u7406\u3011\u2014&gt; \u3010\u8282\u70b9\u7ba1\u7406\u3011\u2014&gt; \u3010Configure Clouds\u3011</p> <p></p> <p></p> <p>\u8fd9\u91cc\u4e0d\u505a\u4efb\u4f55\u914d\u7f6e\uff0c\u76f4\u63a5\u70b9\u51fb\u3010\u8fde\u63a5\u6d4b\u8bd5\u3011\u5c31\u53ef\u4ee5\u53d1\u73b0\u8fde\u63a5 k8s \u6210\u529f\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u914d\u7f6e k8s \u96c6\u7fa4\u76f8\u5173\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u914d\u7f6e pod \u6a21\u677f\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5728 pod \u6a21\u677f\u4e2d\u6dfb\u52a0\u7b2c\u4e00\u4e2a\u5bb9\u5668\uff1a<code>jenkins/inbound-agent</code>\uff0c\u4f5c\u4e3a jenkins \u7684 slave \u8282\u70b9\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5728 pod \u6a21\u677f\u4e2d\u6dfb\u52a0\u7b2c\u4e8c\u4e2a\u5bb9\u5668\uff1a<code>docker</code>\uff0c\u7528\u4e8e\u6784\u5efa\u4ee5\u53ca\u63a8\u9001\u955c\u50cf\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5728 pod \u6a21\u677f\u4e2d\u6dfb\u52a0\u7b2c\u4e09\u4e2a\u5bb9\u5668\uff1a<code>maven:3.8.1-openjdk-11</code>\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u6839\u636e\u9700\u8981\u6dfb\u52a0\u66f4\u591a\u5bb9\u5668\uff0c\u6bd4\u5982\u9700\u8981\u6784\u5efa\u524d\u7aef\u9879\u76ee\uff0c\u53ef\u4ee5\u6dfb\u52a0\u4e00\u4e2a <code>node:16.6.1-slim</code> \u5bb9\u5668\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8jenkins/#4-maven-settingsxml","title":"4. \u4e3a maven \u5bb9\u5668\u914d\u7f6e\u7f13\u5b58\u548c\u6302\u8f7d settings.xml","text":"<p>\u82e5\u9700\u8981\u4e3aJenkins Slave Pod\u6302\u8f7d\u81ea\u5b9a\u4e49Settings\u6587\u4ef6\uff0c\u5219\u53ef\u4ee5\u5148\u521b\u5efaConfig Map Volume\uff0c\u518d\u914d\u7f6e\u5230Pod Template\u4e0a\u3002</p> <p>\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u521b\u5efa\u81ea\u5b9a\u4e49Settings\u6587\u4ef6\uff1a</p> <pre><code>kubectl -n default create configmap maven-config --from-file=settings.xml \n</code></pre> <p>\u5728\u5377\u4e0b\u5355\u51fb\u6dfb\u52a0\u5377\uff0c\u9009\u62e9Config Map Volume\u7c7b\u578b\u5377\uff0c\u53e6\u4e00\u4e2a\u662f maven \u7684\u914d\u7f6e\uff0c\u4e3a\u4e86\u6301\u4e45\u5316\u4f9d\u8d56\uff0c\u63d0\u9ad8\u6784\u5efa\u901f\u5ea6\uff0c\u914d\u7f6e\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8jenkins/#5-docker","title":"5. \u4f7f\u7528 docker \u6784\u5efa\u548c\u63a8\u9001\u5bb9\u5668\u955c\u50cf","text":"<p>\u4f7f\u7528docker\u63a8\u9001\u955c\u50cf\u65f6\uff0c\u9700\u8981\u8bbe\u7f6e\u955c\u50cf\u4ed3\u5e93\u7684\u8bbf\u95ee\u6743\u9650\uff0c\u901a\u8fc7\u4e0b\u9762\u7684\u65b9\u5f0f\u8bbe\u7f6e\uff1a</p> <p>\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u767b\u5f55\u955c\u50cf\u4ed3\u5e93\uff0c\u767b\u5f55\u955c\u50cf\u4ed3\u5e93\u7684\u540c\u65f6\u4f1a\u751f\u6210 config.json\u6587\u4ef6\uff1a</p> <pre><code>docker login -u &lt;username&gt; -p &lt;password&gt; registry.cn-hangzhou.aliyuncs.com\n</code></pre> <p>\u5728jenkins\u547d\u540d\u7a7a\u95f4\u4e0b\u4f7f\u7528\u751f\u6210\u7684config.json\u6587\u4ef6\u521b\u5efa\u540d\u4e3a my-secret \u7684Secret\uff1a</p> <pre><code>kubectl create secret generic jenkins-docker-cfg -n default --from-file=/root/.docker/config.json\n</code></pre> <p>\u5728Jenkins\u7cfb\u7edf\u7684Pod Template\u4e2d\u914d\u7f6e\u6302\u8f7d\u5377\u53ca\u73af\u5883\u53d8\u91cf\uff1a</p> <p></p>"},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8jenkins/#6-k8skubeconfig","title":"6. \u914d\u7f6e\u8bbf\u95eek8s\u7684kubeconfig","text":"<p>\u914d\u7f6e\u8bbf\u95eek8s\u7684kubeconfig\uff0c\u5728pipeline\u4e2d\u4f7f\u7528<code>kubernetesDeploy</code>\u7684\u65f6\u5019\u4f1a\u4f7f\u7528\u5230</p> <ul> <li>[Manage Credentials] -&gt; [jenkins] -&gt; [\u5168\u5c40\u51ed\u636e] -&gt; [\u6dfb\u52a0\u51ed\u636e]</li> </ul> <p></p>"},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8jenkins/#7","title":"7. \u8bbe\u7f6e\u62c9\u53d6\u79c1\u6709\u4ed3\u5e93\u955c\u50cf\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801","text":"<ul> <li>[Manage Credentials] -&gt; [jenkins] -&gt; [\u5168\u5c40\u51ed\u636e] -&gt; [\u6dfb\u52a0\u51ed\u636e]</li> </ul>"},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8jenkins/#8-devops","title":"8. \u6d4b\u8bd5 devops \u6784\u5efa\u6d41\u7a0b","text":"<p>\u521b\u5efa\u4e00\u4e2a pipeline \u9879\u76ee\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5728\u6d41\u6c34\u7ebf\u811a\u672c\u4e2d\u8f93\u5165\u5982\u4e0b\u5185\u5bb9\uff1a</p> <pre><code>pipeline {\n     // \u5b9a\u4e49\u672c\u6b21\u6784\u5efa\u4f7f\u7528\u54ea\u4e2a\u6807\u7b7e\u7684\u6784\u5efa\u73af\u5883\n    agent{\n        node{\n          label 'slave-pipeline'\n        }\n      }\n\n    stages {\n        stage('Hello') {\n            steps {\n                echo 'Hello World'\n            }\n        }\n        // \u62c9\u53d6\u4ee3\u7801\n        stage('git clone') {\n            steps {\n                git branch: \"master\", credentialsId: \"\", url: \"https://gitee.com/peterwd/devops-demo.git\"\n            }\n        }\n        //  \u8fd0\u884c\u6e90\u7801\u6253\u5305\u547d\u4ee4\n        stage('Package'){\n          steps{\n              container(\"maven\") {\n                  sh \"mvn --version\"\n                  sh \"mvn clean package -DskipTests\"\n              }\n          }\n        }\n\n        // \u8fd0\u884c\u5bb9\u5668\u955c\u50cf\u6784\u5efa\u548c\u63a8\u9001\u547d\u4ee4\n        stage('Image Build And Publish'){\n          steps{\n              container('docker') {\n                   sh 'docker version'\n              }\n          }\n        }\n\n        //  \u8fd0\u884c node \u6784\u5efa\u547d\u4ee4\n        stage('node'){\n          steps{\n              container('node') {\n                   sh 'npm version'\n              }\n          }\n        }\n    }\n}\n</code></pre> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u70b9\u51fb\u4fdd\u5b58\uff0c\u5e76\u6784\u5efa\uff0c\u663e\u793a\u5982\u4e0b\uff1a</p> <p></p>"},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8nexus/","title":"\u5728 k8s \u4e2d\u5b89\u88c5\u5e76\u4f7f\u7528 nexus","text":"<p>\u751f\u6d3b\u662f\u5c5e\u4e8e\u6bcf\u4e2a\u4eba\u81ea\u5df1\u7684\u611f\u53d7\uff0c\u4e0d\u5c5e\u4e8e\u4efb\u4f55\u522b\u4eba\u7684\u770b\u6cd5\u3002\u2014\u2014 \u4f59\u534e\u300a\u6d3b\u7740\u300b</p>"},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8nexus/#_1","title":"\u4e00. \u6982\u8ff0","text":"<p>\u5728\u5b66\u4e60\u4f7f\u7528\u4e00\u4e2a\u5de5\u5177\u4e4b\u524d\uff0c\u6211\u4eec\u9700\u8981\u77e5\u9053\u600e\u4e48\u5b89\u88c5\u5b83\u3002\u672c\u6587\u5c06\u81ea\u5df1\u5b66\u4e60\u7684\u8fc7\u7a0b\u8bb0\u5f55\u4e0b\u6765\uff0c\u4e00\u65b9\u9762\u5de9\u56fa\u5b66\u4e60\u7684\u5185\u5bb9\uff0c\u53e6\u4e00\u65b9\u9762\u5e0c\u671b\u5bf9\u6709\u540c\u6837\u9700\u6c42\u7684\u5c0f\u4f19\u4f34\u63d0\u4f9b\u4e00\u4e9b\u5e2e\u52a9\u3002</p> \u5f00\u6e90\u5de5\u5177 \u63cf\u8ff0 \u5b98\u65b9\u6587\u6863 \u5b98\u65b9\u5b89\u88c5\u6587\u6863 docker \u5b89\u88c5 nexus maven \u4ed3\u5e93\u7ba1\u7406\u5de5\u5177 nexus \u5b98\u7f51 nexus \u5feb\u901f\u5b89\u88c5 docker \u5b89\u88c5 <p>\u4e0a\u9762\u8868\u683c\u5217\u51fa\u4e86\u5b98\u65b9\u7684\u5b89\u88c5\u5730\u5740\uff0c\u5982\u679c\u9700\u8981\u5feb\u901f\u4f53\u9a8c\u4f7f\u7528\uff0c\u5efa\u8bae\u76f4\u63a5\u4f7f\u7528 docker \u5b89\u88c5\uff0c\u4e00\u884c\u547d\u4ee4\u5c31\u53ef\u4ee5\u542f\u52a8\u5e94\u7528\uff1a</p> <pre><code>docker run -d -p 8081:8081 --name nexus sonatype/nexus3\n</code></pre> <p>\u4e0b\u6587\u5c06\u4ecb\u7ecd\u5728 k8s \u4e2d\u5b89\u88c5\u5e76\u4f7f\u7528 nexus\uff0c\u8fd9\u91cc\u5c06\u4f7f\u7528\u4e24\u79cd\u65b9\u5f0f\u5b89\u88c5\uff1a</p> <ul> <li> <p>\u81ea\u5df1\u7f16\u5199\u90e8\u7f72\u6e05\u5355 <code>nexus-deploy.yaml</code> \u5b89\u88c5</p> </li> <li> <p>\u4f7f\u7528 helm \u5b89\u88c5</p> </li> </ul>"},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8nexus/#_2","title":"\u5b89\u88c5\u73af\u5883","text":"<p>\u8fd9\u91cc\u4f7f\u7528 minikube \u8fdb\u884c\u5b89\u88c5\uff0c\u5728 k8s \u96c6\u7fa4\u4e2d\u57fa\u672c\u4f7f\u7528\u662f\u4e00\u6837\u7684</p> <ul> <li>minikube :  v1.18.1</li> <li>helm : v3.5.3</li> </ul>"},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8nexus/#nexus-deployyaml","title":"\u4e8c. \u7f16\u5199\u90e8\u7f72\u6e05\u5355 <code>nexus-deploy.yaml</code> \u5b89\u88c5","text":"<p>\u7531\u4e8e nexus \u9700\u8981\u6301\u4e45\u5316\u6570\u636e\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u521b\u5efa <code>PVC</code> \uff0c\u5efa\u8bae\u4f7f\u7528 <code>storageClass</code> \u52a8\u6001\u521b\u5efa <code>PVC</code>\uff0c\u5728 <code>minikube</code> \u4e2d\u6709\u4e00\u4e2a\u9ed8\u8ba4\u7684 <code>storageClass</code>\uff0c\u540d\u79f0\u662f\uff1a<code>standard</code>\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u67e5\u770b\uff1a</p> <pre><code># kubectl get sc\nNAME                 PROVISIONER                RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE\nstandard (default)   k8s.io/minikube-hostpath   Delete          Immediate           false                  50m\n</code></pre> <p>storageClass \u7684\u4f7f\u7528\u53ef\u4ee5\u67e5\u770b\u5b98\u7f51\uff1ahttps://kubernetes.io/zh/docs/concepts/storage/storage-classes/</p> <p>\u521b\u5efa <code>nexus-deploy.yaml</code> \u6587\u4ef6\uff0c\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: nexus-data-pvc\n  namespace: default\nspec:\n  accessModes:\n    - ReadWriteMany\n  # \u6307\u5b9a storageClass \u7684\u540d\u5b57\uff0c\u8fd9\u91cc\u4f7f\u7528\u9ed8\u8ba4\u7684 standard\n  storageClassName: \"standard\"\n  resources:\n    requests:\n      storage: 10Gi\n\n\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  namespace: default\n  name: nexus3\n  labels:\n    app: nexus3\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: nexus3\n  template:\n    metadata:\n      labels:\n        app: nexus3\n    spec:\n      containers:\n      - name: nexus3\n        image: sonatype/nexus3:3.32.0\n        imagePullPolicy: IfNotPresent\n        ports:\n          - containerPort: 8081\n            name: web\n            protocol: TCP\n        livenessProbe:\n          httpGet:\n            path: /\n            port: 8081\n          initialDelaySeconds: 100\n          periodSeconds: 30\n          failureThreshold: 6\n        readinessProbe:\n          httpGet:\n            path: /\n            port: 8081\n          initialDelaySeconds: 100\n          periodSeconds: 30\n          failureThreshold: 6\n        resources:\n          limits:\n            cpu: 4000m\n            memory: 2Gi\n          requests:\n            cpu: 500m\n            memory: 512Mi\n        volumeMounts:\n        - name: nexus-data\n          mountPath: /nexus-data\n      volumes:\n        - name: nexus-data\n          persistentVolumeClaim:\n            claimName: nexus-data-pvc\n\n\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: nexus3\n  namespace: default\n  labels:\n    app: nexus3\nspec:\n  selector:\n    app: nexus3\n  type: ClusterIP\n  ports:\n    - name: web\n      protocol: TCP\n      port: 8081\n      targetPort: 8081\n</code></pre> <p>\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u90e8\u7f72\u5e94\u7528\uff1a</p> <pre><code># kubectl apply -f nexus-deploy.yaml\n\ndeployment.apps/nexus3 created\npersistentvolumeclaim/nexus-data-pvc created\nservice/nexus3 created\n</code></pre> <p>\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u67e5\u770b pod \u662f\u5426\u6b63\u5e38\u8fd0\u884c\uff1a</p> <pre><code># kubectl get pod\nNAME                      READY   STATUS    RESTARTS   AGE\nnexus3-6c75965bcf-6tj5w   1/1     Running   0          5m37s\n</code></pre> <p>\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u67e5\u770b pod \u7684\u65e5\u5fd7\uff1a</p> <pre><code>kubectl logs -f nexus3-6c75965bcf-6tj5w -n default\n</code></pre> <p>\u770b\u5230\u5982\u4e0b\u5185\u5bb9\uff0c\u5219\u8868\u793a\u5e94\u7528\u542f\u52a8\u6210\u529f\uff1a</p> <p></p> <p>\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u66b4\u9732 pod \u7aef\u53e3\u5230\u672c\u673a\uff0c\u4ee5\u4fbf\u5916\u90e8\u8bbf\u95ee\uff1a</p> <pre><code># \u4f7f\u7528\u8bf4\u660e\uff1a kubectl port-forward TYPE/NAME [options] [LOCAL_PORT:]REMOTE_PORT\nkubectl port-forward service/nexus3 8081:8081\n</code></pre> <p>\u751f\u4ea7\u4f7f\u7528\u5efa\u8bae\u901a\u8fc7 ingress \u66b4\u9732\u670d\u52a1\uff0c\u8fd9\u91cc\u901a\u8fc7 port-forward \u4e34\u65f6\u66b4\u9732\u670d\u52a1</p> <p>\u8bbf\u95ee\u5730\u5740\uff1ahttp://localhost:8081/</p> <p></p> <p>\u9ed8\u8ba4\u767b\u5f55 nexus \u7684\u8d26\u53f7\u548c\u5bc6\u7801\u5982\u4e0b\uff1a</p> <ul> <li>\u7528\u6237\u540d\uff1aadmin</li> <li>\u5bc6\u7801\uff1a\u9ed8\u8ba4\u7684\u521d\u59cb\u5bc6\u7801\u5728\u670d\u52a1\u5668\u7684<code>/nexus-data/admin.password</code>\u6587\u4ef6\u4e2d</li> </ul> <p>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u83b7\u53d6\u9ed8\u8ba4\u7684\u5bc6\u7801\uff1a</p> <pre><code>kubectl exec nexus3-6c75965bcf-6tj5w -- cat /nexus-data/admin.password\n</code></pre> <p>\u767b\u5f55 nexus\uff1a</p> <p></p> <p>\u767b\u5f55\u6210\u529f\u540e\u9700\u8981\u8bbe\u7f6e\u65b0\u5bc6\u7801\uff1a</p> <p></p> <p>\u66f4\u65b0\u5bc6\u7801\u540e\uff0c\u914d\u7f6e\u662f\u5426\u5f00\u542f\u533f\u540d\u8bbf\u95ee\u3002\u542f\u7528\u533f\u540d\u8bbf\u95ee\u610f\u5473\u7740\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7528\u6237\u53ef\u4ee5\u5728\u6ca1\u6709\u51ed\u636e\u7684\u60c5\u51b5\u4e0b\u4ece\u5b58\u50a8\u5e93\u641c\u7d22\u3001\u6d4f\u89c8\u548c\u4e0b\u8f7d\u7ec4\u4ef6\u3002\u8003\u8651\u5230\u5b89\u5168\u7684\u95ee\u9898\uff0c\u8fd9\u91cc\u9009\u62e9\u7981\u7528\u533f\u540d\u8bbf\u95ee\u3002</p> <p></p> <p>\u5b89\u88c5\u5b8c\u6210\u540e\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u5220\u9664\u5b89\u88c5\u7684 nexus \u76f8\u5173\u7684\u8d44\u6e90\uff1a</p> <pre><code># kubectl delete -f nexus-deploy.yaml\n\ndeployment.apps \"nexus3\" deleted\npersistentvolumeclaim \"nexus-data-pvc\" deleted\nservice \"nexus3\" deleted\n</code></pre>"},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8nexus/#helm-nexus","title":"\u4e09. \u4f7f\u7528 helm \u5b89\u88c5 nexus","text":"<p>\u53ef\u4ee5\u53bb\u5230 helm \u5b98\u65b9\u5305\u7ba1\u7406\u4ed3\u5e93\u67e5\u627e\u9700\u8981\u5b89\u88c5\u7684\u5e94\u7528\u3002</p> <p>helm \u5305\u7ba1\u7406\u5730\u5740\uff1ahttps://artifacthub.io/</p> <p></p> <p>\u8fd9\u91cc\u6211\u9009\u62e9\u5b89\u88c5\u4e0b\u56fe\u6240\u793a\u7684 nexus\uff1a\uff08\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u9700\u6c42\u9009\u62e9\u5b89\u88c5 star \u6bd4\u8f83\u591a\uff0c\u66f4\u65b0\u6bd4\u8f83\u9891\u7e41\u7684 chart\uff09</p> <p></p> <p>\u6839\u636e\u4e0a\u9762\u7684\u6587\u6863\u8bf4\u660e\u8fdb\u884c\u5b89\u88c5\u5373\u53ef\uff0c\u8fd9\u91cc\u4e0d\u518d\u8be6\u7ec6\u4ecb\u7ecd\u3002</p>"},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8nexus/#nexus","title":"\u56db. nexus \u7684\u57fa\u672c\u914d\u7f6e\u53ca\u4f7f\u7528","text":""},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8nexus/#1-nexus","title":"1. nexus \u914d\u7f6e\u8bf4\u660e","text":"<p>\u70b9\u51fb\u5de6\u4fa7Repositories\u6309\u94ae\uff0c\u53ef\u4ee5\u770b\u5230\u4e0b\u56fe\u6240\u793a\u7684\u4ed3\u5e93\u5185\u5bb9\uff1a</p> <p></p> <p>\u4ed3\u5e93\u8bf4\u660e\uff1a</p> <p>Name \u5217</p> <ul> <li> <p>maven-central\uff1amaven\u4e2d\u592e\u5e93\uff0c\u9ed8\u8ba4\u4ece <code>https://repo1.maven.org/maven2/</code> \u62c9\u53d6 jar\u3002</p> </li> <li> <p>maven-releases\uff1a\u79c1\u5e93\u53d1\u884c\u7248 jar\u3002</p> </li> <li> <p>maven-snapshots\uff1a\u79c1\u5e93\u5feb\u7167\u7248\uff08\u8c03\u8bd5\u7248\u672c\uff09jar\u3002</p> </li> <li> <p>maven-public\uff1a\u4ed3\u5e93\u5206\u7ec4\uff0c\u628a\u4e0a\u9762\u4e09\u4e2a\u4ed3\u5e93\u7ec4\u5408\u5728\u4e00\u8d77\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\uff0c\u5728\u672c\u5730 maven \u57fa\u7840\u914d\u7f6e <code>settings.xml</code>\u4e2d\u4f7f\u7528\u3002</p> </li> </ul> <p>Type \u5217\uff08Nexus\u9ed8\u8ba4\u7684\u4ed3\u5e93\u7c7b\u578b\u6709\u4ee5\u4e0b\u56db\u79cd\uff09\uff1a</p> <ul> <li> <p>group(\u4ed3\u5e93\u7ec4\u7c7b\u578b)\uff1a\u53c8\u53eb\u7ec4\u4ed3\u5e93\uff0c\u7528\u4e8e\u65b9\u4fbf\u5f00\u53d1\u4eba\u5458\u81ea\u5df1\u9009\u62e9\u4ed3\u5e93\u4ee5\u53ca\u8bbe\u7f6e\u4ed3\u5e93\u7684\u987a\u5e8f\uff1b</p> </li> <li> <p>hosted(\u5bbf\u4e3b\u7c7b\u578b)\uff1a\u5185\u90e8\u9879\u76ee\u7684\u53d1\u5e03\u4ed3\u5e93\uff08\u5185\u90e8\u5f00\u53d1\u4eba\u5458\u53d1\u5e03 jar \u5305\u5b58\u653e\u7684\u4ed3\u5e93\uff09\uff1b</p> </li> <li> <p>proxy(\u4ee3\u7406\u7c7b\u578b)\uff1a\u4ece\u8fdc\u7a0b\u4e2d\u592e\u4ed3\u5e93\u4e2d\u5bfb\u627e\u6570\u636e\u7684\u4ed3\u5e93\uff08\u53ef\u4ee5\u70b9\u51fb\u5bf9\u5e94\u7684\u4ed3\u5e93\u7684Configuration\u9875\u7b7e\uff0c\u5176\u4e2d <code>Remote Storage Location</code> \u5c5e\u6027\u7684\u503c\u5373\u88ab\u4ee3\u7406\u7684\u8fdc\u7a0b\u4ed3\u5e93\u7684\u8def\u5f84\uff09\uff1b</p> </li> <li> <p>virtual(\u865a\u62df\u7c7b\u578b)\uff1a\u865a\u62df\u4ed3\u5e93\uff08\u8fd9\u4e2a\u57fa\u672c\u7528\u4e0d\u5230\uff0c\u91cd\u70b9\u5173\u6ce8\u4e0a\u9762\u4e09\u4e2a\u4ed3\u5e93\u7684\u4f7f\u7528\uff09\uff1b</p> </li> </ul>"},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8nexus/#2","title":"2. \u521b\u5efa\u81ea\u5b9a\u4e49\u79c1\u6709\u4ed3\u5e93","text":""},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8nexus/#release","title":"\u81ea\u5b9a\u4e49\u53d1\u884c\u7248\uff08release\uff09\u79c1\u5e93","text":"<p>\u70b9\u51fb <code>Create repository</code> \u521b\u5efa\u81ea\u5b9a\u4e49\u53d1\u884c\u7248\uff08release\uff09\u79c1\u5e93\uff0c\u9009\u62e9 <code>maven2 (hosted)</code>\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u81ea\u5b9a\u4e49\u4ed3\u5e93\u914d\u7f6e\u5982\u4e0b\uff1a</p> <p></p> <p>\u4e3b\u8981\u914d\u7f6e\u5982\u4e0b\u51e0\u9879\u5185\u5bb9\uff1a</p> <p>Name\uff1a\u81ea\u5b9a\u4e49\u540d\u79f0\uff0c\u5fc5\u987b\u552f\u4e00\uff0c\u901a\u5e38\u53d1\u884c\u7248\u4ed3\u5e93\u4ee5 <code>xxx-release</code> \u7ed3\u5c3e\uff0c\u5feb\u7167\u7248\u4ed3\u5e93\u4ee5 <code>xxx-snapshots</code> \u7ed3\u5c3e</p> <p>Version policy\uff1a</p> <ul> <li>Release \u4e00\u822c\u662f\u53d1\u884c\u7248\u7684 jar</li> <li>Snapshot \u4e00\u822c\u662f\u5feb\u7167\u7248\u7684 jar</li> <li>Mixed \u6df7\u5408\u7684</li> </ul> <p>Deployment policy\uff1aAllow redeploy</p> <p>\u5176\u4ed6\u7684\u914d\u7f6e\u4fdd\u6301\u9ed8\u8ba4\u5373\u53ef\u3002</p>"},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8nexus/#snapshot","title":"\u81ea\u5b9a\u4e49\u5feb\u7167\u7248\uff08snapshot\uff09\u79c1\u5e93","text":"<p>\u521b\u5efa\u5feb\u7167\u7248\uff08snapshot\uff09\u79c1\u5e93\u548c\u4e0a\u9762\u7684\u4e00\u6837\uff0c\u53ea\u9700\u8981\u5c06 Name \u4fee\u6539\u4e3a <code>xxx-snapshots</code>\uff0cVersion policy \u4fee\u6539\u4e3a <code>Snapshot</code>\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8nexus/#proxy","title":"\u81ea\u5b9a\u4e49\u4ee3\u7406\uff08proxy\uff09\u4ed3\u5e93","text":"<p>\u9ed8\u8ba4\u4ece <code>https://repo1.maven.org/maven2/</code> \u62c9\u53d6 jar\uff0c\u7531\u4e8e\u7f51\u7edc\u7684\u539f\u56e0\u7ecf\u5e38\u5bfc\u81f4\u65e0\u6cd5\u4e0b\u8f7d\u76f8\u5173\u7684\u8d44\u6e90\uff0c\u6240\u4ee5\u8fd9\u91cc\u4ecb\u7ecd\u914d\u7f6e\u963f\u91cc\u4e91\u7684 maven \u4ed3\u5e93\u4ee3\u7406\u3002</p> <p>\u963f\u91cc\u4e91 maven \u4ed3\u5e93\u4ee3\u7406\u914d\u7f6e\uff1ahttps://maven.aliyun.com/mvn/guide</p> <p>\u521b\u5efa\u4ee3\u7406\u4ed3\u5e93\uff1a</p> <p></p> <p>\u914d\u7f6e\u5185\u5bb9\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u914d\u7f6e\u8bf4\u660e\uff1a</p> <p>Name\uff1a\u4ed3\u5e93\u7684\u540d\u79f0\u5fc5\u987b\u552f\u4e00\uff0c\u8fd9\u91cc\u914d\u7f6e\u4e3a <code>aliyun-proxy</code></p> <p>Version policy \uff1aRelease</p> <p>Remote storage\uff1a\u8fdc\u7a0b\u4ed3\u5e93\u5730\u5740\uff0c\u8fd9\u91cc\u914d\u7f6e\u963f\u91cc\u4e91 maven  \u4ed3\u5e93\u5730\u5740\uff1a<code>https://maven.aliyun.com/repository/public</code></p>"},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8nexus/#group","title":"\u81ea\u5b9a\u4e49 group \u4ed3\u5e93\u7684\u987a\u5e8f","text":"<p>\u53ef\u4ee5\u4f7f\u7528\u9ed8\u8ba4\u7684 <code>maven-public</code> \uff0c\u4e5f\u53ef\u4ee5\u81ea\u5b9a\u4e49\u4e00\u4e2a <code>maven2 (group)</code> \u7c7b\u578b\u7684\u4ed3\u5e93\u8fdb\u884c\u8bbe\u7f6e\uff0c\u8fd9\u91cc\u9009\u62e9\u81ea\u5b9a\u4e49\u4e00\u4e2a<code>maven2 (group)</code> \u7c7b\u578b\u7684\u4ed3\u5e93\uff0c\u65b9\u4fbf\u5b66\u4e60\u7406\u89e3\u3002</p> <p></p> <p>\u914d\u7f6e\u5982\u4e0b\u56fe\uff1a</p> <p></p>"},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8nexus/#3-nexus","title":"3. \u521b\u5efa nexus \u7528\u6237","text":""},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8nexus/#maven-nexus","title":"\u4e94.  maven \u914d\u7f6e nexus \u8bf4\u660e","text":"<p>\u70b9\u51fb\u524d\u9762\u5b9a\u4e49\u7684 <code>maven2 (group)</code> \u67e5\u770b\u5176 URL \u5730\u5740\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8nexus/#1-settingsxml","title":"1. \u5728 settings.xml \u6587\u4ef6\u4e2d\u914d\u7f6e\uff08\u5168\u5c40\u6709\u6548\uff09","text":"<p>\u6253\u5f00 maven \u7684\u914d\u7f6e\u6587\u4ef6\uff08 windows \u673a\u5668\u4e00\u822c\u5728 maven \u5b89\u88c5\u76ee\u5f55\u7684 conf/settings.xml \uff09\uff0c\u5728<code>&lt;mirrors&gt;&lt;/mirrors&gt;</code>\u6807\u7b7e\u4e2d\u6dfb\u52a0 mirror \u5b50\u8282\u70b9\uff0c\u590d\u5236\u4e0a\u9762\u7684\u5730\u5740\uff0c\u5728 <code>settings.xml</code> \u6587\u4ef6\u4e2d\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9\uff1a</p> <pre><code>  &lt;servers&gt;\n    &lt;!-- \u8fd9\u91cc\u914d\u7f6e nexus \u7684\u8ba4\u8bc1\u4fe1\u606f\uff0c\u6ce8\u610f\u8fd9\u91cc\u7684 id \u9700\u8981\u548c mirros \u4e2d\u7684 id \u76f8\u540c\u624d\u80fd\u591f\u5339\u914d\u8ba4\u8bc1 --&gt;\n     &lt;server&gt;\n      &lt;id&gt;my-maven&lt;/id&gt;\n      &lt;username&gt;test&lt;/username&gt;\n      &lt;password&gt;maven123456&lt;/password&gt;\n    &lt;/server&gt;\n  &lt;/servers&gt;\n  &lt;mirrors&gt;\n    &lt;mirror&gt;\n      &lt;id&gt;my-maven&lt;/id&gt;\n      &lt;!--mirrorof\u914d\u7f6e\u4e3a * \u65f6\uff0c\u6240\u6709\u7684\u8bf7\u6c42\u90fd\u8d70\u8fd9\u4e2amirror\u7684url\uff0cmirrorof\u914d\u7f6e\u662f\u67d0\u4e2arepositoryid\u65f6\uff0c\u82e5\u6784\u5efa\u627e\u4e0d\u5230\uff0c\u5219\u4f1a\u5230maven\u9ed8\u8ba4\u4e2d\u592e\u4ed3\u5e93\u53bb\u83b7\u53d6\u7684\u3002--&gt;\n      &lt;mirrorOf&gt;*&lt;/mirrorOf&gt;\n      &lt;name&gt;\u81ea\u5b9a\u4e49\u79c1\u6709\u4ed3\u5e93&lt;/name&gt;\n      &lt;url&gt;http://localhost:8081/repository/my-group/&lt;/url&gt;\n    &lt;/mirror&gt;\n  &lt;/mirrors&gt;\n</code></pre> <p>\u914d\u7f6e\u5b8c\u6210\u4e4b\u540e\uff0c\u53ef\u4ee5\u5728 idea \u4e2d\u6307\u5b9a\u8fd9\u4e2a <code>settings.xml</code> \u6587\u4ef6\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5f53\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\u4e4b\u540e\uff0c\u53ef\u4ee5\u770b\u5230 idea \u4ece nexus \u79c1\u6709\u4ed3\u5e93\u4e2d\u4e0b\u8f7d jar \u5305\uff1a</p> <p></p> <p>\u53bb\u5230 nexus \u4ed3\u5e93\u4e2d\u67e5\u770b\u4ed3\u5e93\u5185\u5bb9\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8nexus/#2-pomxml","title":"2. \u5728 pom.xml \u6587\u4ef6\u4e2d\u914d\u7f6e\u79c1\u6709\u4ed3\u5e93\u5730\u5740\uff08\u9879\u76ee\u6709\u6548\uff09","text":"<p>\u5728 <code>pom.xml</code> \u4e2d <code>repositories</code> \u6807\u7b7e\u7684\u4f5c\u7528\u662f\u7528\u6765\u914d\u7f6e <code>maven</code> \u9879\u76ee\u7684\u8fdc\u7a0b\u4ed3\u5e93\uff0c\u793a\u4f8b\u5982\u4e0b:</p> <pre><code>    &lt;repositories&gt;\n        &lt;repository&gt;\n            &lt;!--\u5b9a\u4e49\u4ed3\u5e93 id ,\u5fc5\u987b\u552f\u4e00\uff0c\u9700\u8981 server \u4e2d\u7684id\u5bf9\u5e94\uff0c\u4ee5\u4fbf\u8ba4\u8bc1--&gt;\n            &lt;id&gt;my-maven&lt;/id&gt;\n            &lt;!--\u4ed3\u5e93\u63cf\u8ff0--&gt;\n            &lt;name&gt;\u81ea\u5b9a\u4e49\u79c1\u6709\u4ed3\u5e93&lt;/name&gt;\n            &lt;!--\u4ed3\u5e93\u5730\u5740--&gt;\n            &lt;url&gt;http://localhost:8081/repository/my-group/&lt;/url&gt;\n            &lt;!--\u662f\u5426\u53ef\u4ee5\u4ece\u8fd9\u4e2a\u4ed3\u5e93\u4e0b\u8f7dreleases\u7248\u672c\u7684\u6784\u4ef6\uff0c\u9ed8\u8ba4\u4e3a true--&gt;\n            &lt;releases&gt;\n                &lt;enabled&gt;true&lt;/enabled&gt;\n            &lt;/releases&gt;\n            &lt;!--\u662f\u5426\u53ef\u4ee5\u4ece\u8fd9\u4e2a\u4ed3\u5e93\u4e0b\u8f7dsnapshots\u7248\u672c\u7684\u6784\u4ef6\uff0c\u9ed8\u8ba4\u4e3a true\n            \u7981\u6b62\u4ece\u516c\u5171\u4ed3\u5e93\u4e0b\u8f7dsnapshot\u6784\u4ef6\u662f\u63a8\u8350\u7684\u505a\u6cd5\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u6784\u4ef6\u4e0d\u7a33\u5b9a\n            --&gt;\n            &lt;snapshots&gt;\n                &lt;enabled&gt;true&lt;/enabled&gt;\n            &lt;/snapshots&gt;\n        &lt;/repository&gt;\n    &lt;/repositories&gt;\n</code></pre> <p>\u5efa\u8bae\u5728 settings.xml \u6587\u4ef6\u4e2d\u914d\u7f6e\u79c1\u6709\u4ed3\u5e93\u5730\u5740\uff0c\u8fd9\u6837\u6240\u6709\u9879\u76ee\u90fd\u53ef\u4ee5\u4f7f\u7528\u90a3\u4e2a\u5730\u5740\u3002</p>"},{"location":"devops/%E5%9C%A8k8s%E4%B8%AD%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8nexus/#3-jar-nexus","title":"3. \u53d1\u5e03\u672c\u5730 jar \u5305\u5230 nexus \u4ed3\u5e93","text":"<p>\u67e5\u770b\u81ea\u5b9a\u4e49\u7684 snapshot \u4ed3\u5e93\uff0c\u76ee\u524d\u6ca1\u6709\u76f8\u5173 jar \u5305\u8d44\u6e90\uff0c\u4e0b\u9762\u5982\u4f55\u5c06\u672c\u5730jar\u5305\u53d1\u5e03\u5230\u79c1\u6709\u4ed3\u5e93\u3002</p> <p>\u5728 pom.xml \u6587\u4ef6\u4e2d\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e\uff1a</p> <pre><code>    &lt;distributionManagement&gt;\n        &lt;repository&gt;\n            &lt;!--\u5b9a\u4e49\u4ed3\u5e93 id ,\u5fc5\u987b\u552f\u4e00\uff0c\u9700\u8981 server \u4e2d\u7684id\u5bf9\u5e94\uff0c\u4ee5\u4fbf\u8ba4\u8bc1--&gt;\n            &lt;id&gt;my-maven&lt;/id&gt;\n            &lt;!--\u4ed3\u5e93\u63cf\u8ff0--&gt;\n            &lt;name&gt;\u81ea\u5b9a\u4e49\u53d1\u884c\u7248\u4ed3\u5e93&lt;/name&gt;\n            &lt;!--\u4ed3\u5e93\u5730\u5740--&gt;\n            &lt;url&gt;http://localhost:8081/repository/my-release/&lt;/url&gt;\n        &lt;/repository&gt;\n        &lt;snapshotRepository&gt;\n            &lt;!--\u5b9a\u4e49\u4ed3\u5e93 id ,\u5fc5\u987b\u552f\u4e00\uff0c\u9700\u8981 server \u4e2d\u7684id\u5bf9\u5e94\uff0c\u4ee5\u4fbf\u8ba4\u8bc1--&gt;\n            &lt;id&gt;my-maven&lt;/id&gt;\n            &lt;!--\u4ed3\u5e93\u63cf\u8ff0--&gt;\n            &lt;name&gt;\u81ea\u5b9a\u4e49\u5feb\u7167\u7248\u4ed3\u5e93&lt;/name&gt;\n            &lt;!--\u4ed3\u5e93\u5730\u5740--&gt;\n            &lt;url&gt;http://localhost:8081/repository/my-snapshots/&lt;/url&gt;\n        &lt;/snapshotRepository&gt;\n    &lt;/distributionManagement&gt;\n</code></pre> <p>\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u53d1\u5e03\u9879\u76ee\u5230 nexus \u4ed3\u5e93\uff1a</p> <pre><code>mvn clean deploy\n</code></pre> <p>\u6784\u5efa\u6210\u529f\u4e4b\u540e\u53ef\u4ee5\u67e5\u770b nexus \u4ed3\u5e93\u5185\u5bb9\u5982\u4e0b\uff1a</p> <p></p> <p>\u8fd9\u91cc\u6709\u4e00\u70b9\u503c\u5f97\u6ce8\u610f\u7684\u5730\u65b9\uff0c\u5982\u4f55\u5c06 jar \u5305\u53d1\u5e03\u5230 release \u4ed3\u5e93\uff1f</p> <p>\u5176\u5b9e\u975e\u5e38\u7b80\u5355\uff0c\u53ea\u9700\u8981\u5c06 <code>&lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;</code> \u4e2d\u7684 <code>1.0.0-SNAPSHOT</code> \u6539\u4e3a <code>1.0.0</code> \u5373\u53ef\uff0c\u5f53\u518d\u6b21\u6267\u884c <code>mvn clean deploy</code> \u5219\u4f1a\u5c06 jar \u5305\u53d1\u5e03\u5230 release \u4ed3\u5e93\u4e2d\u4e86\u3002</p> <p>\u8fd8\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 nexus \u63a7\u5236\u53f0\u4e0a\u4f20 jar \u5305\u5230\u79c1\u6709\u4ed3\u5e93\uff1a</p> <p></p>"},{"location":"devops/%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98docker%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7/","title":"\u4e00. \u6982\u8ff0","text":"<p>Docker \u5bb9\u5668\u4e00\u76f4\u662f\u5f00\u53d1\u4eba\u5458\u5de5\u5177\u7bb1\u7684\u91cd\u8981\u7ec4\u6210\u90e8\u5206\uff0c\u4f7f\u5f00\u53d1\u4eba\u5458\u80fd\u591f\u4ee5\u6807\u51c6\u5316\u7684\u65b9\u5f0f\u6784\u5efa\u3001\u5206\u53d1\u548c\u90e8\u7f72\u4ed6\u4eec\u7684\u5e94\u7528\u7a0b\u5e8f\u3002\u6beb\u65e0\u7591\u95ee\uff0c\u8fd9\u79cd\u5438\u5f15\u529b\u7684\u589e\u52a0\u4f34\u968f\u7740\u5bb9\u5668\u5316\u6280\u672f\u7684\u76f8\u5173\u5b89\u5168\u95ee\u9898\u3002\u4ed6\u4eec\u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\u5229\u7528\u9519\u8bef\u914d\u7f6e\u4ece\u5bb9\u5668\u5185\u9003\u9038\u5230\u4e3b\u673a\u3002</p> <p>\u6b64\u5916\uff0c\u201c\u5bb9\u5668\u201d\u8fd9\u4e2a\u8bcd\u7ecf\u5e38\u88ab\u8bef\u89e3\uff0c\u56e0\u4e3a\u8bb8\u591a\u5f00\u53d1\u4eba\u5458\u503e\u5411\u4e8e\u5c06\u9694\u79bb\u7684\u6982\u5ff5\u4e0e\u9519\u8bef\u7684\u5b89\u5168\u611f\u8054\u7cfb\u8d77\u6765\uff0c\u8ba4\u4e3a\u8fd9\u9879\u6280\u672f\u672c\u8d28\u4e0a\u662f\u5b89\u5168\u7684\u3002</p> <p>\u5b9e\u9645\u4e0a\u5bb9\u5668\u9ed8\u8ba4\u6ca1\u6709\u4efb\u4f55\u5b89\u5168\u7ef4\u5ea6\uff0c\u5b83\u4eec\u7684\u5b89\u5168\u6027\u5b8c\u5168\u53d6\u51b3\u4e8e\uff1a</p> <ul> <li>\u652f\u6301\u7684\u57fa\u7840\u8bbe\u65bd\uff08\u64cd\u4f5c\u7cfb\u7edf\u548c\u5e73\u53f0\uff09</li> <li>\u5b83\u4eec\u7684\u5d4c\u5165\u5f0f\u8f6f\u4ef6\u7ec4\u4ef6</li> <li>\u5b83\u4eec\u7684\u8fd0\u884c\u65f6\u914d\u7f6e</li> </ul> <p>\u5bb9\u5668\u5b89\u5168\u662f\u4e00\u4e2a\u5e7f\u6cdb\u7684\u8bdd\u9898\uff0c\u4f46\u597d\u6d88\u606f\u662f\uff0c\u6709\u8bb8\u591a\u6700\u4f73\u5b9e\u8df5\u662f\u553e\u624b\u53ef\u5f97\u7684\uff0c\u53ef\u4ee5\u5feb\u901f\u51cf\u5c11\u5176\u90e8\u7f72\u7684\u653b\u51fb\u9762\u3002</p> <p>\u4e0b\u56fe\u662f docker \u5b89\u5168\u5907\u5fd8\u6e05\u5355\uff0c\u70b9\u51fb\u4e0b\u8f7d\u6e05\u6670\u56fe\u7247</p> <p></p> <p>\u6ce8\u610f\uff1a\u5728\u50cf Kubernetes \u8fd9\u6837\u7684\u6258\u7ba1\u73af\u5883\u4e2d\uff0c\u5927\u591a\u6570\u8fd9\u4e9b\u8bbe\u7f6e\u90fd\u53ef\u4ee5\u88ab\u5b89\u5168\u4e0a\u4e0b\u6587\u6216\u5176\u4ed6\u66f4\u9ad8\u7ea7\u522b\u7684\u5b89\u5168\u89c4\u5219\u8986\u76d6\u3002 \u67e5\u770b\u66f4\u591a</p> <p>\u4e0b\u9762\u4e3b\u8981\u4ece\u56db\u4e2a\u65b9\u9762\u4ecb\u7ecd\u5982\u4f55\u6784\u5efa\u5b89\u5168\u7684 docker \u955c\u50cf\uff1a</p> <ul> <li>\u6784\u5efa\u914d\u7f6e</li> <li>\u6587\u4ef6\u7cfb\u7edf</li> <li>\u8054\u7f51</li> <li>\u65e5\u5fd7\u8bb0\u5f55</li> </ul>"},{"location":"devops/%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98docker%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7/#_2","title":"\u4e8c. \u6784\u5efa\u914d\u7f6e","text":""},{"location":"devops/%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98docker%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7/#1","title":"1. \u8c28\u614e\u9009\u62e9\u57fa\u7840\u955c\u50cf","text":"<p>\u8c28\u614e\u9009\u62e9\u4f60\u7684\u57fa\u7840\u955c\u50cf <code>docker pull image:tag</code> \u4f60\u5e94\u8be5\u59cb\u7ec8\u4f7f\u7528\u53d7\u4fe1\u4efb\u7684\u955c\u50cf\uff0c\u6700\u597d\u6765\u81eaDocker \u5b98\u65b9\u955c\u50cf\uff0c\u4ee5\u51cf\u8f7b\u4f9b\u5e94\u94fe\u653b\u51fb\u3002 \u5982\u679c\u4f60\u9700\u8981\u9009\u62e9\u57fa\u672c\u53d1\u884c\u7248\u7684\u57fa\u7840\u955c\u50cf\uff0c\u5efa\u8bae\u4f7f\u7528 Alpine Linux\uff0c \u56e0\u4e3a\u5b83\u662f\u53ef\u7528\u7684\u6700\u8f7b\u91cf\u7ea7\u53d1\u884c\u7248\u4e4b\u4e00\uff0c\u53ef\u786e\u4fdd\u51cf\u5c11\u653b\u51fb\u9762\u3002</p> <p>\u6211\u9700\u8981\u4f7f\u7528\u6700\u65b0\u7684\u8fd8\u662f\u56fa\u5b9a\u7684\u6807\u7b7e\u7248\u672c\uff1f</p> <p>\u9996\u5148\uff0c\u4f60\u9700\u8981\u4e86\u89e3 docker \u6807\u7b7e\u4ece\u8f83\u5c11\u5230\u5177\u4f53\u7684\u542b\u4e49\uff0c\u5982\u4e0b python \u955c\u50cf\u6807\u7b7e\uff1a</p> <pre><code>python:3.9.6-alpine3.14\n\npython:3.9.6-alpine\n\npython:3.9-alpine\n\npython:alpine\n</code></pre> <p>\u4e0a\u9762\u6240\u6709\u7684\u6807\u7b7e\u90fd\u662f\u6307\u5411\u76f8\u540c\u7684\u955c\u50cf\uff0c\u9009\u62e9\u5177\u4f53\u7684\u955c\u50cf\u6807\u7b7e\u53ef\u4ee5\u4fdd\u62a4\u81ea\u5df1\u514d\u53d7\u672a\u6765\u4efb\u4f55\u91cd\u5927\u66f4\u6539\u7684\u5f71\u54cd\uff0c\u53e6\u4e00\u65b9\u9762\uff0c\u4f7f\u7528\u6700\u65b0\u7248\u672c\u53ef\u786e\u4fdd\u4fee\u8865\u66f4\u591a\u6f0f\u6d1e\u3002\u8fd9\u662f\u4e00\u79cd\u6743\u8861\uff0c\u4f46\u901a\u5e38\u5efa\u8bae\u56fa\u5b9a\u5230\u7a33\u5b9a\u7248\u672c\u3002\u8003\u8651\u5230\u8fd9\u4e00\u70b9\uff0c\u6211\u4eec\u8fd9\u91cc\u4f1a\u9009\u62e9 <code>python:3.9-alpine</code>\u3002</p> <p>\u6ce8\u610f\uff1a\u8fd9\u540c\u6837\u9002\u7528\u4e8e\u5728\u955c\u50cf\u6784\u5efa\u8fc7\u7a0b\u4e2d\u5b89\u88c5\u7684\u5305\u3002</p>"},{"location":"devops/%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98docker%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7/#2","title":"2. \u59cb\u7ec8\u4f7f\u7528\u975e\u7279\u6743\u7528\u6237","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5bb9\u5668\u5185\u7684\u8fdb\u7a0b\u4ee5 root(id=0)\u8eab\u4efd\u8fd0\u884c\u3002</p> <p>\u4e3a\u4e86\u6267\u884c\u6700\u5c0f\u6743\u9650\u539f\u5219\uff0c\u4f60\u5e94\u8be5\u8bbe\u7f6e\u4e00\u4e2a\u9ed8\u8ba4\u7528\u6237\u3002\u4e3a\u6b64\uff0c\u4f60\u6709\u4e24\u4e2a\u9009\u62e9\uff1a</p> <ul> <li>\u4f7f\u7528\u4ee5\u4e0b\u9009\u9879\u6307\u5b9a\u8fd0\u884c\u5bb9\u5668\u4e2d\u4e0d\u5b58\u5728\u7684\u4efb\u610f\u7528\u6237 ID <code>-u</code>\uff1a   <code>docker run -u 4000 &lt;image&gt;</code></li> </ul> <p>\u6ce8\u610f\uff1a\u5982\u679c\u4f60\u4ee5\u540e\u9700\u8981\u6302\u8f7d\u6587\u4ef6\u7cfb\u7edf\uff0c\u4f60\u5e94\u8be5\u5c06\u4f60\u4f7f\u7528\u7684\u7528\u6237 ID \u4e0e\u4e3b\u673a\u7528\u6237\u5339\u914d\uff0c\u4ee5\u4fbf\u8bbf\u95ee\u6587\u4ef6\u3002</p> <ul> <li>\u6216\u8005\u901a\u8fc7\u5728 <code>Dockerfile</code> \u4e2d\u521b\u5efa\u9ed8\u8ba4\u7528\u6237\uff1a</li> </ul> <pre><code>FROM &lt;base image&gt;\n\nRUN addgroup -S appgroup \\\n &amp;&amp; adduser -S appuser -G appgroup\n\nUSER appuser\n\n... &lt;rest of Dockerfile&gt; ...\n</code></pre> <p>\u6ce8\u610f\uff1a\u4f60\u9700\u8981\u5728\u57fa\u7840\u955c\u50cf\u4e2d\u4e2d\u68c0\u67e5\u521b\u5efa\u7528\u6237\u548c\u7ec4\u7684\u5de5\u5177\u3002</p>"},{"location":"devops/%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98docker%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7/#3-id","title":"3. \u4f7f\u7528\u5355\u72ec\u7684\u7528\u6237 ID \u547d\u540d\u7a7a\u95f4","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cDocker \u5b88\u62a4\u8fdb\u7a0b\u4f7f\u7528\u4e3b\u673a\u7684\u7528\u6237 ID \u547d\u540d\u7a7a\u95f4\u3002\u56e0\u6b64\uff0c\u5bb9\u5668\u5185\u6743\u9650\u63d0\u5347\u4e5f\u610f\u5473\u7740\u5bf9\u4e3b\u673a\u548c\u5176\u4ed6\u5bb9\u5668\u7684 root \u8bbf\u95ee\u3002 \u4e3a\u4e86\u964d\u4f4e\u8fd9\u79cd\u98ce\u9669\uff0c\u4f60\u5e94\u8be5\u5c06\u4e3b\u673a\u548c Docker \u5b88\u62a4\u7a0b\u5e8f\u914d\u7f6e\u4e3a\u4f7f\u7528\u5e26\u6709\u8be5 <code>--userns-remap</code> \u9009\u9879\u7684\u5355\u72ec\u547d\u540d\u7a7a\u95f4\u3002\u67e5\u770b\u66f4\u591a</p>"},{"location":"devops/%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98docker%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7/#4","title":"4. \u5c0f\u5fc3\u5904\u7406\u73af\u5883\u53d8\u91cf","text":"<p>\u4f60\u6c38\u8fdc\u4e0d\u5e94\u8be5\u5728 <code>ENV</code> \u6307\u4ee4\u4e2d\u4ee5\u660e\u6587\u5f62\u5f0f\u5305\u542b\u654f\u611f\u4fe1\u606f\uff1a\u5b83\u4eec\u6839\u672c\u4e0d\u662f\u4e00\u4e2a\u5b89\u5168\u7684\u5730\u65b9\u6765\u5b58\u50a8\u4f60\u4e0d\u60f3\u51fa\u73b0\u5728\u6700\u540e\u4e00\u5c42\u7684\u4efb\u4f55\u4fe1\u606f\u3002\u4f8b\u5982\uff0c\u5982\u679c\u4f60\u8ba4\u4e3a\u50cf\u8fd9\u6837\u53d6\u6d88\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\uff1a</p> <pre><code>ENV $VAR\nRUN unset $VAR\n</code></pre> <p>\u662f\u5b89\u5168\u7684\uff0c\u4f60\u9519\u4e86\uff01<code>$VAR</code>\u4ecd\u5c06\u5b58\u5728\u4e8e\u5bb9\u5668\u4e2d\uff0c\u5e76\u4e14\u53ef\u4ee5\u968f\u65f6\u67e5\u770b\uff01</p> <p>\u4e3a\u4e86\u9632\u6b62\u8fd0\u884c\u65f6\u8bfb\u53d6\u8bbf\u95ee\uff0c\u8bf7\u4f7f\u7528\u5355\u4e2a RUN \u547d\u4ee4\u5728\u5355\u4e2a\u5c42\u4e2d\u8bbe\u7f6e\u548c\u53d6\u6d88\u8bbe\u7f6e\u53d8\u91cf\uff08\u4e0d\u8981\u5fd8\u8bb0\u53d8\u91cf\u4ecd\u7136\u53ef\u4ee5\u4ece\u955c\u50cf\u4e2d\u63d0\u53d6\uff09\u3002</p> <pre><code>RUN export ADMIN_USER=\"admin\" \\\n    &amp;&amp; ... \\\n    &amp;&amp; unset ADMIN_USER\n</code></pre> <p>\u66f4\u60ef\u7528\u7684\u662f\uff0c\u4f7f\u7528 ARG \u6307\u4ee4\uff08\u6784\u5efa\u955c\u50cf\u540e ARG \u503c\u4e0d\u53ef\u7528\uff09\u3002</p> <p>\u4e0d\u5e78\u7684\u662f\uff0csecret \u7ecf\u5e38\u88ab\u786c\u7f16\u7801\u5230 docker \u955c\u50cf\u7684\u5c42\u4e2d\uff0c\u8fd9\u5c31\u662f\u6211\u4eec\u5f00\u53d1\u5229\u7528 <code>GitGuardian</code> secret\u5f15\u64ce\u6765\u67e5\u627e\u5b83\u4eec\u7684\u626b\u63cf\u5de5\u5177\u7684\u539f\u56e0\uff1a</p> <pre><code>ggshield scan docker &lt;image&gt;\n</code></pre> <p>\u7a0d\u540e\u5c06\u8be6\u7ec6\u4ecb\u7ecd\u626b\u63cf\u955c\u50cf\u4e2d\u7684\u6f0f\u6d1e\u3002</p>"},{"location":"devops/%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98docker%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7/#5-docker","title":"5. \u4e0d\u8981\u66b4\u9732 Docker \u5b88\u62a4\u8fdb\u7a0b\u5957\u63a5\u5b57","text":"<p>\u9664\u975e\u4f60\u5bf9\u81ea\u5df1\u6b63\u5728\u505a\u7684\u4e8b\u60c5\u975e\u5e38\u6709\u4fe1\u5fc3\uff0c\u5426\u5219\u6c38\u8fdc\u4e0d\u8981\u66b4\u9732 Docker \u6b63\u5728\u4fa6\u542c\u7684 UNIX \u5957\u63a5\u5b57\uff1a <code>/var/run/docker.sock</code></p> <p>\u8fd9\u662f Docker API \u7684\u4e3b\u8981\u5165\u53e3\u70b9\u3002\u6388\u4e88\u67d0\u4eba\u8bbf\u95ee\u6743\u9650\u7b49\u540c\u4e8e\u6388\u4e88\u5bf9\u4f60\u7684\u4e3b\u673a\u7684\u65e0\u9650\u5236 root \u8bbf\u95ee\u6743\u9650\u3002 \u4f60\u6c38\u8fdc\u4e0d\u5e94\u8be5\u5c06\u5b83\u66b4\u9732\u7ed9\u5176\u4ed6\u5bb9\u5668\uff1a</p> <pre><code>-v /var/run/docker.sock://var/run/docker.sock\n</code></pre>"},{"location":"devops/%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98docker%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7/#6","title":"6. \u7279\u6743\u3001\u80fd\u529b\u548c\u5171\u4eab\u8d44\u6e90","text":"<p>\u9996\u5148\uff0c\u4f60\u7684\u5bb9\u5668\u4e0d\u5e94\u8be5\u4ee5\u7279\u6743\u8eab\u4efd\u8fd0\u884c\uff0c\u5426\u5219\uff0c\u5b83\u5c06\u88ab\u5141\u8bb8\u5728\u4e3b\u673a\u4e0a\u62e5\u6709\u6240\u6709 root \u6743\u9650\u3002 \u4e3a\u4e86\u66f4\u5b89\u5168\uff0c\u5efa\u8bae\u660e\u786e\u7981\u6b62\u5728\u4f7f\u7528\u9009\u9879\u521b\u5efa\u5bb9\u5668\u540e\u6dfb\u52a0\u65b0\u6743\u9650\u7684\u53ef\u80fd\u6027<code>--security-opt=no-new-privileges</code>\u3002</p> <p>\u5176\u6b21\uff0ccapabilities\u662f Docker \u4f7f\u7528\u7684\u4e00\u79cd Linux \u673a\u5236\uff0c\u7528\u4e8e\u5c06\u4e8c\u8fdb\u5236  <code>root/non-root</code> \u4e8c\u5206\u6cd5\u8f6c\u53d8\u4e3a\u7ec6\u7c92\u5ea6\u7684\u8bbf\u95ee\u63a7\u5236\u7cfb\u7edf\uff1a\u4f60\u7684\u5bb9\u5668\u4f7f\u7528\u4e00\u7ec4\u9ed8\u8ba4\u542f\u7528\u7684\u529f\u80fd\u8fd0\u884c\uff0c\u800c\u4f60\u5f88\u53ef\u80fd\u6ca1\u6709\u90fd\u9700\u8981\u3002</p> <p>\u5efa\u8bae\u5220\u9664\u6240\u6709\u9ed8\u8ba4\u529f\u80fd\u5e76\u4ec5\u5355\u72ec\u6dfb\u52a0\u5b83\u4eec\uff1a \u4f8b\u5982\uff0c\u8bf7\u53c2\u9605\u9ed8\u8ba4\u529f\u80fd\u5217\u8868\uff0cWeb \u670d\u52a1\u5668\u53ef\u80fd\u53ea\u9700\u8981 NET_BIND_SERVICE \u7ed1\u5b9a\u5230 1024 \u4e0b\u7684\u7aef\u53e3\uff08\u5982\u7aef\u53e3 80\uff09\u3002</p> <p>\u7b2c\u4e09\uff0c\u4e0d\u8981\u5171\u4eab\u4e3b\u673a\u6587\u4ef6\u7cfb\u7edf\u7684\u654f\u611f\u90e8\u5206\uff1a</p> <ul> <li>\u6839 \uff08/\uff09\uff0c</li> <li>\u8bbe\u5907 (/dev)</li> <li>\u8fdb\u7a0b (/proc)</li> <li>\u865a\u62df (/sys) \u6302\u8f7d\u70b9\u3002</li> </ul> <p>\u5982\u679c\u4f60\u9700\u8981\u8bbf\u95ee\u4e3b\u673a\u8bbe\u5907\uff0c\u8bf7\u5c0f\u5fc3\u4f7f\u7528<code>[r|w|m]</code>\u6807\u5fd7\uff08\u8bfb\u3001\u5199\u548c\u4f7f\u7528 mknod\uff09\u6709\u9009\u62e9\u5730\u542f\u7528\u8bbf\u95ee\u9009\u9879\u3002</p>"},{"location":"devops/%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98docker%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7/#7-control-groups","title":"7. \u4f7f\u7528Control Groups\u9650\u5236\u5bf9\u8d44\u6e90\u7684\u8bbf\u95ee","text":"<p><code>Control Groups(cgroups)</code> \u662f\u7528\u4e8e\u63a7\u5236\u6bcf\u4e2a\u5bb9\u5668\u5bf9 CPU\u3001\u5185\u5b58\u3001\u78c1\u76d8 I/O \u7684\u8bbf\u95ee\u7684\u673a\u5236\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5bb9\u5668\u4e0e<code>cgroup</code>\u5173\u8054\uff0c\u4f46\u5982\u679c<code>--cgroup-parent</code>\u5b58\u5728\u8be5\u9009\u9879\uff0c\u5219\u4f1a\u5c06\u4e3b\u673a\u8d44\u6e90\u7f6e\u4e8eDoS \u653b\u51fb\u7684\u98ce\u9669\u4e2d\uff0c\u56e0\u4e3a\u4f60\u5141\u8bb8\u4e3b\u673a\u548c\u5bb9\u5668\u4e4b\u95f4\u5171\u4eab\u8d44\u6e90\u3002</p> <p>\u51fa\u4e8e\u540c\u6837\u7684\u60f3\u6cd5\uff0c\u5efa\u8bae\u4f7f\u7528\u4ee5\u4e0b\u9009\u9879\u6307\u5b9a\u5185\u5b58\u548c CPU \u4f7f\u7528\u7387</p> <pre><code>--memory=\u201d400m\u201d\n--memory-swap=\u201d1g\u201d\n\n--cpus=0.5\n--restart=on-failure:5\n--ulimit nofile=5\n--ulimit nproc=5\n</code></pre> <p>\u67e5\u770b\u6709\u5173\u8d44\u6e90\u9650\u5236\u7684\u66f4\u591a\u4fe1\u606f</p>"},{"location":"devops/%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98docker%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7/#_3","title":"\u4e09. \u6587\u4ef6\u7cfb\u7edf","text":""},{"location":"devops/%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98docker%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7/#1_1","title":"1. \u53ea\u5141\u8bb8\u8bfb\u8bbf\u95ee\u6839\u6587\u4ef6\u7cfb\u7edf","text":"<p>\u5bb9\u5668\u5e94\u8be5\u662f\u77ed\u6682\u7684\uff0c\u56e0\u6b64\u5927\u591a\u662f\u65e0\u72b6\u6001\u7684\u3002\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u4f60\u901a\u5e38\u53ef\u4ee5\u5c06\u6302\u8f7d\u7684\u6587\u4ef6\u7cfb\u7edf\u9650\u5236\u4e3a\u53ea\u8bfb\u7684\u539f\u56e0\u3002 <code>docker run --read-only &lt;image&gt;</code></p>"},{"location":"devops/%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98docker%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7/#2_1","title":"2. \u5bf9\u975e\u6301\u4e45\u6027\u6570\u636e\u4f7f\u7528\u4e34\u65f6\u6587\u4ef6\u7cfb\u7edf","text":"<p>\u5982\u679c\u4f60\u53ea\u9700\u8981\u4e34\u65f6\u5b58\u50a8\uff0c\u8bf7\u4f7f\u7528\u9002\u5f53\u7684\u9009\u9879 <code>docker run --read-only --tmpfs /tmp:rw ,noexec,nosuid &lt;image&gt;</code></p>"},{"location":"devops/%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98docker%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7/#3","title":"3. \u4f7f\u7528\u6587\u4ef6\u7cfb\u7edf\u4fdd\u5b58\u6301\u4e45\u6570\u636e","text":"<p>\u5982\u679c\u4f60\u9700\u8981\u4e0e\u4e3b\u673a\u6587\u4ef6\u7cfb\u7edf\u6216\u5176\u4ed6\u5bb9\u5668\u5171\u4eab\u6570\u636e\uff0c\u4f60\u6709\u4e24\u79cd\u9009\u62e9\uff1a</p> <ul> <li>\u521b\u5efa\u5177\u6709\u6709\u9650\u53ef\u7528\u78c1\u76d8\u7a7a\u95f4\u7684\u7ed1\u5b9a\u6302\u8f7d ( <code>--mount type=bind,o=size</code>)</li> <li>\u4e3a\u4e13\u7528\u5206\u533a\u521b\u5efa\u7ed1\u5b9a\u5377 ( <code>--mount type=volume</code>)   \u5728\u4efb\u4f55\u4e00\u79cd\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u5bb9\u5668\u4e0d\u9700\u8981\u4fee\u6539\u5171\u4eab\u6570\u636e\uff0c\u8bf7\u4f7f\u7528\u53ea\u8bfb\u9009\u9879\u3002</li> </ul> <pre><code>docker run -v &lt;volume-name&gt;:/path/in/container:ro &lt;image&gt;`\n\u6216\u8005\n`docker run --mount source=&lt;volume-name&gt;,destination=/path/in/container,readonly &lt;image&gt;\n</code></pre>"},{"location":"devops/%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98docker%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7/#_4","title":"\u56db. \u8054\u7f51","text":""},{"location":"devops/%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98docker%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7/#1-docker-docker0","title":"1. \u4e0d\u8981\u4f7f\u7528 Docker \u7684\u9ed8\u8ba4\u7f51\u6865 docker0","text":"<p><code>docker0</code>\u662f\u5728\u542f\u52a8\u65f6\u521b\u5efa\u7684\u7f51\u6865\uff0c\u7528\u4e8e\u5c06\u4e3b\u673a\u7f51\u7edc\u4e0e\u5bb9\u5668\u7f51\u7edc\u5206\u5f00\u3002 \u521b\u5efa\u5bb9\u5668\u65f6\uff0cDocker \u7684<code>docker0</code>\u9ed8\u8ba4\u5c06\u5176\u8fde\u63a5\u5230\u7f51\u7edc\uff0c\u56e0\u6b64\u6240\u6709\u5bb9\u5668\u90fd\u76f8\u4e92\u8fde\u63a5<code>docker0</code>\u5e76\u80fd\u591f\u76f8\u4e92\u901a\u4fe1\u3002 \u4f60\u5e94\u8be5\u901a\u8fc7\u6307\u5b9a\u9009\u9879 <code>--bridge=none</code> \u7981\u7528\u6240\u6709\u5bb9\u5668\u7684\u9ed8\u8ba4\u8fde\u63a5\uff0c\u5e76\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u4e3a\u6bcf\u4e2a\u8fde\u63a5\u521b\u5efa\u4e00\u4e2a\u4e13\u7528\u7f51\u7edc\uff1a</p> <pre><code>docker network create &lt;network_name&gt;\n</code></pre> <p>\u7136\u540e\u7528\u5b83\u6765\u8bbf\u95ee\u4e3b\u673a\u7f51\u7edc\u63a5\u53e3</p> <pre><code>docker run --network=&lt;network_name&gt;\n</code></pre> <p>Docker\u8054\u7f51\u7b80\u5355\u4f8b\u5b50</p> <p>\u4f8b\u5982\uff0c\u8981\u521b\u5efa\u4e00\u4e2a\u4e0e\u6570\u636e\u5e93\u901a\u4fe1\u7684 Web \u670d\u52a1\u5668\uff08\u5728\u53e6\u4e00\u4e2a\u5bb9\u5668\u4e2d\u542f\u52a8\uff09\uff0c\u6700\u4f73\u5b9e\u8df5\u662f\u521b\u5efa\u4e00\u4e2a\u6865\u63a5\u7f51\u7edc<code>WEB</code>\u4ee5\u8def\u7531\u6765\u81ea\u4e3b\u673a\u7f51\u7edc\u63a5\u53e3\u7684\u4f20\u5165\u6d41\u91cf\uff0c\u5e76\u4f7f\u7528\u53e6\u4e00\u4e2a<code>DB</code>\u4ec5\u7528\u4e8e\u8fde\u63a5\u6570\u636e\u5e93\u7684\u6865\u63a5\u5668\u548c\u7f51\u7edc\u5bb9\u5668\u3002</p>"},{"location":"devops/%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98docker%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7/#2_2","title":"2. \u4e0d\u8981\u5171\u4eab\u4e3b\u673a\u7684\u7f51\u7edc\u547d\u540d\u7a7a\u95f4","text":"<p>\u540c\u6837\u7684\u60f3\u6cd5\uff0c\u9694\u79bb\u4e3b\u673a\u7684\u7f51\u7edc\u63a5\u53e3\uff1a<code>--network</code>\u4e0d\u5e94\u4f7f\u7528\u4e3b\u673a\u9009\u9879\u3002</p>"},{"location":"devops/%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98docker%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7/#_5","title":"\u4e94. \u65e5\u5fd7\u8bb0\u5f55","text":"<p>\u9ed8\u8ba4\u65e5\u5fd7\u7ea7\u522b\u4e3a INFO\uff0c\u4f46\u4f60\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u9009\u9879\u6307\u5b9a\u53e6\u4e00\u4e2a\u7ea7\u522b\uff1a <code>--log-level=\"debug\"|\"info\"|\"warn\"|\"error\"|\"fatal\"</code></p> <p>\u9c9c\u4e3a\u4eba\u77e5\u7684\u662f Docker \u7684\u65e5\u5fd7\u5bfc\u51fa\u80fd\u529b\uff1a\u5982\u679c\u4f60\u7684\u5bb9\u5668\u5316\u5e94\u7528\u7a0b\u5e8f\u751f\u6210\u4e8b\u4ef6\u65e5\u5fd7\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u9009\u9879\u91cd\u5b9a\u5411<code>STDERR</code>\u548c<code>STDOUT</code>\u6d41\u5230\u5916\u90e8\u65e5\u5fd7\u670d\u52a1\u4ee5\u8fdb\u884c\u89e3\u8026<code>--log-driver=&lt;logging_driver&gt;</code></p> <p>\u4f60\u8fd8\u53ef\u4ee5\u542f\u7528\u53cc\u65e5\u5fd7\u8bb0\u5f55\u4ee5\u5728\u4f7f\u7528\u5916\u90e8\u670d\u52a1\u65f6\u4fdd\u7559 docker \u5bf9\u65e5\u5fd7\u7684\u8bbf\u95ee\u3002\u5982\u679c\u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528\u4e13\u7528\u6587\u4ef6\uff08\u901a\u5e38\u5199\u5728 \u4e0b <code>/var/log</code>\uff09\uff0c\u4f60\u4ecd\u7136\u53ef\u4ee5\u91cd\u5b9a\u5411\u8fd9\u4e9b\u6d41\uff1a\u8bf7\u53c2\u9605\u5b98\u65b9\u6587\u6863</p>"},{"location":"devops/%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98docker%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7/#_6","title":"\u516d. \u626b\u63cf\u6f0f\u6d1e\u548c\u79d8\u5bc6","text":"<p>\u6700\u540e\u4f46\u5e76\u975e\u6700\u4e0d\u91cd\u8981\u7684\u4e00\u70b9\u662f\uff0c\u6211\u5e0c\u671b\u73b0\u5728\u4f60\u7684\u5bb9\u5668\u5c06\u4e0e\u5b83\u4eec\u8fd0\u884c\u7684\u8f6f\u4ef6\u4e00\u6837\u5b89\u5168\u3002\u4e3a\u786e\u4fdd\u4f60\u7684\u955c\u50cf\u6ca1\u6709\u6f0f\u6d1e\uff0c\u4f60\u9700\u8981\u5bf9\u5df2\u77e5\u6f0f\u6d1e\u6267\u884c\u626b\u63cf\u3002 \u8bb8\u591a\u5de5\u5177\u53ef\u7528\u4e8e\u4e0d\u540c\u7684\u7528\u4f8b\u548c\u4e0d\u540c\u7684\u5f62\u5f0f\uff1a</p> <p>\u6f0f\u6d1e\u626b\u63cf\uff1a</p> <ul> <li>\u514d\u8d39\u9009\u9879\uff1a</li> <li>Clair</li> <li>Trivy</li> <li>Docker Bench for Security</li> <li>\u5546\u4e1a\u7684\uff1a</li> <li>Snyk (open source and free option available)</li> <li>Anchore (open source and free option available)</li> <li>JFrog XRay</li> <li>Qualys</li> </ul> <p>secret \u626b\u63cf\uff1a</p> <ul> <li>ggshield (open source and free option available)</li> <li> <p>SecretScanner (free)</p> </li> <li> <p>https://blog.gitguardian.com/rewriting-git-history-cheatsheet/)</p> </li> </ul>"},{"location":"go/go%E8%AF%AD%E8%A8%80grpc%E6%A1%86%E6%9E%B6%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E8%B7%B5/","title":"go\u8bed\u8a00grpc\u6846\u67b6\u4ece\u5165\u95e8\u5230\u5b9e\u8df5","text":"<p>\u53c2\u8003\u6587\u6863</p> <p>https://grpc.io/docs/languages/go/quickstart/</p>"},{"location":"go/%E3%80%90golang%E3%80%91%E4%BD%BF%E7%94%A8chan%E6%94%B6%E9%9B%86%E5%A4%9A%E5%8D%8F%E7%A8%8B%E6%89%A7%E8%A1%8C%E7%9A%84%E7%BB%93%E6%9E%9C/","title":"\u3010golang\u3011\u4f7f\u7528chan\u6536\u96c6\u591a\u534f\u7a0b\u6267\u884c\u7684\u7ed3\u679c","text":""},{"location":"go/%E3%80%90golang%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%E3%80%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/","title":"\u3010golang\u3011\u73af\u5883\u642d\u5efa","text":""},{"location":"go/%E3%80%90golang%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%E3%80%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#_1","title":"\u4e00. \u6982\u8ff0","text":"<p>\u672c\u6587\u662f\u3010golang\u5b66\u4e60\u8bb0\u5f55\u3011\u7cfb\u5217\u6587\u7ae0\u7684\u7b2c\u4e00\u7bc7\uff0c\u5b89\u88c5Go\u8bed\u8a00\u53ca\u642d\u5efaGo\u8bed\u8a00\u5f00\u53d1\u73af\u5883\uff0c\u63a5\u4e0b\u6765\u5c06\u8be6\u7ec6\u8bb0\u5f55\u81ea\u5df1\u5b66\u4e60 go \u8bed\u8a00\u7684\u8fc7\u7a0b\uff0c\u4e00\u65b9\u9762\u662f\u4e3a\u4e86\u5de9\u56fa\u81ea\u5df1\u5b66\u5230\u7684\u5185\u5bb9\uff0c\u53e6\u4e00\u65b9\u9762\u5e0c\u671b\u5bf9\u6709\u540c\u6837\u9700\u6c42\u7684\u5c0f\u4f19\u4f34\u63d0\u4f9b\u4e00\u4e9b\u5e2e\u52a9\u3002</p>"},{"location":"go/%E3%80%90golang%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%E3%80%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#go","title":"\u4e8c. \u4e0b\u8f7d\u5e76\u5b89\u88c5 Go","text":"<p>Go\u5b98\u7f51\u4e0b\u8f7d\u5730\u5740\uff08\u5728\u56fd\u5185\u65e0\u6cd5\u8bbf\u95ee\uff09\uff1ahttps://golang.org/dl/</p> <p>Go\u5b98\u65b9\u955c\u50cf\u7ad9\uff08\u63a8\u8350\uff09\uff1ahttps://golang.google.cn/dl/</p> <p>\u5728Windows\u4e2d\u901a\u8fc7\u53ef\u6267\u884c\u6587\u4ef6\u6765\u5b89\u88c5\u4f1a\u81ea\u52a8\u914d\u7f6e <code>GOROOT</code> \u73af\u5883\u53d8\u91cf\uff0c\u7701\u53bb\u4e86\u624b\u52a8\u914d\u7f6e\u73af\u5883\u53d8\u91cf\u7684\u9ebb\u70e6\uff0c\u4e2a\u4eba\u89c9\u5f97\u901a\u8fc7\u4e0b\u8f7d zip \u5305\uff0c\u914d\u7f6e\u73af\u5883\u53d8\u91cf\u5b89\u88c5\u80fd\u591f\u66f4\u597d\u7406\u89e3\u5b89\u88c5\u6d41\u7a0b\u3002</p> <p>\u6211\u8fd9\u91cc\u662f\u5728 windows \u4e2d\u5b89\u88c5 Go \uff0c\u6240\u4ee5\u76f4\u63a5\u9009\u62e9 windows \u7684\u5b89\u88c5\u65b9\u5f0f\u5373\u53ef\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u4e0b\u8f7d\u5b8c\u6210\u540e\uff0c\u53cc\u51fb\u4e0b\u8f7d\u597d\u7684\u6587\u4ef6\uff0c\u7136\u540e\u6309\u7167\u4e0b\u56fe\u6240\u793a\u6b65\u9aa4\u5b89\u88c5\uff1a</p> <p></p> <p>\u5982\u679c\u4f60\u672c\u5730\u5df2\u7ecf\u5b89\u88c5\u4e86\u4f4e\u7248\u672c\u7684 Go\uff0c\u90a3\u4e48\u70b9\u51fb Next \u540e\u4f1a\u63d0\u793a\u4f60\u5378\u8f7d\u65e7\u7248\u7684 Go\uff0c\u6839\u636e\u63d0\u793a\u5378\u8f7d\u5373\u53ef\u3002</p> <p></p> <p></p> <p>\u7b49\u5f85\u5b89\u88c5\u5b8c\u6210\uff0c\u51fa\u73b0\u4e0b\u56fe\uff0c\u5373\u8868\u793a\u5b89\u88c5\u6210\u529f\uff1a</p> <p></p> <p>\u56e0\u4e3a\u901a\u8fc7\u53ef\u6267\u884c\u6587\u4ef6\u5b89\u88c5\u8fc7\u7a0b\u4e2d\u5df2\u7ecf\u81ea\u52a8\u914d\u7f6e\u597d\u4e86\u73af\u5883\u53d8\u91cf\uff0c\u6240\u4ee5\u76f4\u63a5\u5728 <code>CMD</code> \u63a7\u5236\u53f0\u8f93\u5165 <code>go version</code> \u547d\u4ee4\u9a8c\u8bc1 Go \u662f\u5426\u5b89\u88c5\u6210\u529f\uff1a</p> <pre><code>&gt; go version\ngo version go1.17.3 windows/amd64\n</code></pre>"},{"location":"go/%E3%80%90golang%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%E3%80%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#go_1","title":"\u4e09. Go \u73af\u5883\u53d8\u91cf\u914d\u7f6e\u548c\u8bf4\u660e","text":"<p>\u5728 <code>CMD</code> \u63a7\u5236\u53f0\u8f93\u5165 <code>go env</code> \u547d\u4ee4\u67e5\u770b\u914d\u7f6e\u7684\u73af\u5883\u53d8\u91cf\uff1a</p> <pre><code>C:\\Users\\admin&gt;go env\nset GO111MODULE=on\nset GOARCH=amd64\nset GOBIN=\nset GOCACHE=C:\\Users\\admin\\AppData\\Local\\go-build\nset GOENV=C:\\Users\\admin\\AppData\\Roaming\\go\\env\nset GOEXE=.exe\nset GOEXPERIMENT=\nset GOFLAGS= -mod=\nset GOHOSTARCH=amd64\nset GOHOSTOS=windows\nset GOINSECURE=\nset GOMODCACHE=C:\\Users\\admin\\go\\pkg\\mod\nset GONOPROXY=\nset GONOSUMDB=\nset GOOS=windows\nset GOPATH=C:\\Users\\admin\\go\nset GOPRIVATE=\nset GOPROXY=https://goproxy.cn,direct\nset GOROOT=D:\\environment\\Go\nset GOSUMDB=sum.golang.org\nset GOTMPDIR=\nset GOTOOLDIR=D:\\environment\\Go\\pkg\\tool\\windows_amd64\nset GOVCS=\nset GOVERSION=go1.17.3\nset GCCGO=gccgo\nset AR=ar\nset CC=gcc\nset CXX=g++\nset CGO_ENABLED=1\nset GOMOD=NUL\nset CGO_CFLAGS=-g -O2\nset CGO_CPPFLAGS=\nset CGO_CXXFLAGS=-g -O2\nset CGO_FFLAGS=-g -O2\nset CGO_LDFLAGS=-g -O2\nset PKG_CONFIG=pkg-config\nset GOGCCFLAGS=-m64 -mthreads -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=C:\\Users\\admin\\AppData\\Local\\Temp\\go-build3769788971=/tmp/\ngo-build -gno-record-gcc-switches\n</code></pre> <p>Go1.14\u7248\u672c\u4e4b\u540e\uff0c\u90fd\u63a8\u8350\u4f7f\u7528<code>go mod</code>\u6a21\u5f0f\u6765\u7ba1\u7406\u4f9d\u8d56\u73af\u5883\u4e86\uff0c\u4e5f\u4e0d\u518d\u5f3a\u5236\u6211\u4eec\u628a\u4ee3\u7801\u5fc5\u987b\u5199\u5728<code>GOPATH</code>\u4e0b\u9762\u7684src\u76ee\u5f55\u4e86\uff0c\u4f60\u53ef\u4ee5\u5728\u4f60\u7535\u8111\u7684\u4efb\u610f\u4f4d\u7f6e\u7f16\u5199go\u4ee3\u7801\u3002</p> <p>\u5176\u4e2d\u6211\u4eec\u6bd4\u8f83\u5173\u5fc3\u7684\u73af\u5883\u53d8\u91cf\u6709\u5982\u4e0b\u51e0\u4e2a\uff1a</p> <ul> <li><code>GOPATH</code>\uff1a\u53ef\u4ee5\u7406\u89e3\u4e3a go \u7684\u5de5\u4f5c\u76ee\u5f55\uff0c\u6b64\u76ee\u5f55\u5305\u542b\u4e24\u4e2a\u6587\u4ef6\u5939</li> </ul> <p>-- bin\uff1a\u5b58\u653e go \u7f16\u8bd1\u751f\u6210\u7684\u53ef\u6267\u884c\u6587\u4ef6</p> <p>-- pkg\uff1a\u5b58\u653e go \u9879\u76ee\u4f9d\u8d56\u7684\u7b2c\u4e09\u65b9 module</p> <ul> <li> <p><code>GOROOT</code>\uff1a\u662f\u6211\u4eec\u5b89\u88c5 go \u5f00\u53d1\u5305\u7684\u8def\u5f84</p> </li> <li> <p><code>GO111MODULE</code>\uff1a\u8981\u542f\u7528<code>go module</code>\u652f\u6301\u9996\u5148\u8981\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf<code>GO111MODULE</code>\uff0c\u901a\u8fc7\u5b83\u53ef\u4ee5\u5f00\u542f\u6216\u5173\u95ed\u6a21\u5757\u652f\u6301\uff0c\u5b83\u6709\u4e09\u4e2a\u53ef\u9009\u503c\uff1a<code>off</code>\u3001<code>on</code>\u3001<code>auto</code>\uff0c\u9ed8\u8ba4\u503c\u662f<code>on</code>\u3002</p> </li> <li> <p><code>GO111MODULE=off</code>\u7981\u7528\u6a21\u5757\u652f\u6301\uff0c\u7f16\u8bd1\u65f6\u4f1a\u4ece<code>GOPATH</code>\u548c<code>vendor</code>\u6587\u4ef6\u5939\u4e2d\u67e5\u627e\u5305\u3002</p> </li> <li><code>GO111MODULE=on</code>\u542f\u7528\u6a21\u5757\u652f\u6301\uff0c\u7f16\u8bd1\u65f6\u4f1a\u5ffd\u7565<code>GOPATH</code>\u548c<code>vendor</code>\u6587\u4ef6\u5939\uff0c\u53ea\u6839\u636e <code>go.mod</code>\u4e0b\u8f7d\u4f9d\u8d56\u3002</li> <li><code>GO111MODULE=auto</code>\uff0c\u5f53\u9879\u76ee\u5728<code>$GOPATH/src</code>\u5916\u4e14\u9879\u76ee\u6839\u76ee\u5f55\u6709<code>go.mod</code>\u6587\u4ef6\u65f6\uff0c\u5f00\u542f\u6a21\u5757\u652f\u6301\u3002</li> </ul> <p>\u4f7f\u7528 go module \u7ba1\u7406\u4f9d\u8d56\u540e\u4f1a\u5728\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\u751f\u6210\u4e24\u4e2a\u6587\u4ef6<code>go.mod</code>\u548c<code>go.sum</code>\u3002</p> <ul> <li><code>GOPROXY</code>\uff1aGo1.13\u4e4b\u540e<code>GOPROXY</code>\u9ed8\u8ba4\u503c\u4e3a<code>https://proxy.golang.org</code>\uff0c\u5728\u56fd\u5185\u662f\u65e0\u6cd5\u8bbf\u95ee\u7684\uff0c\u6240\u4ee5\u5341\u5206\u5efa\u8bae\u5927\u5bb6\u8bbe\u7f6e<code>GOPROXY</code>\uff0c\u8fd9\u91cc\u6211\u63a8\u8350\u4f7f\u7528goproxy.cn\u3002\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u8bbe\u7f6e\uff1a</li> </ul> <pre><code>go env -w GOPROXY=https://goproxy.cn,direct\n</code></pre>"},{"location":"go/%E3%80%90golang%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%E3%80%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#go_2","title":"\u56db. Go \u5f00\u53d1\u5de5\u5177","text":"<p>Go \u91c7\u7528\u7684\u662f <code>UTF-8</code> \u7f16\u7801\u7684\u6587\u672c\u6587\u4ef6\u5b58\u653e\u6e90\u4ee3\u7801\uff0c\u7406\u8bba\u4e0a\u4f7f\u7528\u4efb\u4f55\u4e00\u6b3e\u6587\u672c\u7f16\u8f91\u5668\u90fd\u53ef\u4ee5\u505a Go \u8bed\u8a00\u5f00\u53d1\uff0c\u6bd4\u8f83\u5e38\u7528\u7684\u5f00\u53d1\u5de5\u5177\u662f <code>VS Code</code>\u548c<code>Goland</code>\u3002 <code>VS Code</code>\u662f\u5fae\u8f6f\u5f00\u6e90\u7684\u7f16\u8f91\u5668\uff0c\u800c<code>Goland</code>\u662f jetbrains \u51fa\u54c1\u7684\u4ed8\u8d39 IDE\u3002</p> <p>\u56e0\u4e3a\u6211\u662f\u505a\u7684\u6bd4\u8f83\u591a\u7684\u662f Java \u5f00\u53d1\uff0c\u4f7f\u7528\u7684\u662f idea\uff0c\u5e76\u4e14\u4e60\u60ef\u4e86 idea \u4e0d\u60f3\u4e0b\u8f7d\u5176\u4ed6\u7684\u5f00\u53d1\u5de5\u5177\uff0c\u6240\u4ee5\u8fd9\u91cc\u4ecb\u7ecd\u5728 idea \u4e2d\u5b89\u88c5 Go \u63d2\u4ef6\u8fdb\u884c\u5f00\u53d1\u3002</p> <p>\u6253\u5f00 idea \u5728 Plugins \u4e2d\u641c\u7d22 go \uff0c\u5b89\u88c5\u4e0b\u56fe\u6240\u793a\u7684\u63d2\u4ef6\uff1a</p> <p></p> <p>\u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u6700\u597d\u662f\u91cd\u542f\u4e00\u4e0b idea\uff0c\u8ba9\u63d2\u4ef6\u751f\u6548\u3002\u5b89\u88c5\u597d\u63d2\u4ef6\u4e4b\u540e\uff0cgo \u7684\u5f00\u53d1\u5de5\u5177\u5176\u5b9e\u5c31\u914d\u7f6e\u597d\u4e86\uff0c</p>"},{"location":"go/%E3%80%90golang%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%E3%80%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#go_3","title":"\u4e94. \u7b2c\u4e00\u4e2a Go \u7a0b\u5e8f","text":"<p>\u73b0\u5728\u6211\u4eec\u6765\u521b\u5efa\u7b2c\u4e00\u4e2aGo\u9879\u76ee\u2014\u2014<code>hello-go</code>\uff0c\u5728\u6211\u4eec\u684c\u9762\u521b\u5efa\u4e00\u4e2a<code>hello-go</code>\u76ee\u5f55\u3002</p> <p>\u4f7f\u7528 <code>go module</code> \u6a21\u5f0f\u65b0\u5efa\u9879\u76ee\u65f6\uff0c\u6211\u4eec\u9700\u8981\u901a\u8fc7 <code>go mod init \u9879\u76ee\u540d</code> \u547d\u4ee4\u5bf9\u9879\u76ee\u8fdb\u884c\u521d\u59cb\u5316\uff0c\u8be5\u547d\u4ee4\u4f1a\u5728\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\u751f\u6210 <code>go.mod</code> \u6587\u4ef6\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u4f7f\u7528<code>hello-go</code> \u4f5c\u4e3a\u6211\u4eec\u7b2c\u4e00\u4e2aGo\u9879\u76ee\u7684\u540d\u79f0\uff0c\u5728\u524d\u9762\u521b\u5efa\u76ee\u5f55\u7684 <code>cmd</code> \u547d\u4ee4\u884c\u4e2d\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>go mod init hello-go\n</code></pre> <p>\u67e5\u770b\u751f\u6210\u7684 <code>go.mod</code> \u6587\u4ef6\uff1a</p> <pre><code>&gt; cat go.mod\nmodule hello-go\n\ngo 1.17\n</code></pre> <p>\u4f7f\u7528 idea \u6253\u5f00 <code>hello-go</code> \u76ee\u5f55\uff0cidea \u4f1a\u63d0\u793a\u4f60\u6ca1\u6709\u914d\u7f6e <code>GOROOT</code>\uff0c\u6211\u4eec\u6839\u636e\u63d0\u793a\uff0c\u6dfb\u52a0\u5b89\u88c5\u7684 <code>GOROOT</code>\u8def\u5f84\u5373\u53ef\u3002\u9009\u62e9\u9879\u76ee\uff0c\u53f3\u952e\u65b0\u5efa\u4e00\u4e2a <code>Go File</code> \u6587\u4ef6\uff1a</p> <p></p> <p></p> <p>\u5728 <code>main.go</code> \u6587\u4ef6\u4e2d\u8f93\u5165\u5982\u4e0b\u5185\u5bb9\uff1a</p> <pre><code>package main  // \u58f0\u660e main \u5305\uff0c\u8868\u660e\u5f53\u524d\u662f\u4e00\u4e2a\u53ef\u6267\u884c\u7a0b\u5e8f\n\nimport \"fmt\"  // \u5bfc\u5165\u5185\u7f6e fmt \u5305\n\nfunc main(){  // main\u51fd\u6570\uff0c\u662f\u7a0b\u5e8f\u6267\u884c\u7684\u5165\u53e3\n    fmt.Println(\"Hello World!\")  // \u5728\u7ec8\u7aef\u6253\u5370 Hello World!\n}\n</code></pre> <p></p> <p>\u5728 idea \u4e2d\u7684\u7b2c\u4e00\u4e2a Go \u7a0b\u5e8f\u5c31\u8fd0\u884c\u6210\u529f\u4e86~</p> <p>\u5728 <code>cmd</code> \u7ec8\u7aef\u4e2d\u8f93\u5165\u547d\u4ee4 <code>go run main.go</code>\u4e5f\u53ef\u4ee5\u6267\u884c\u7a0b\u5e8f\uff0c\u8be5\u547d\u4ee4\u672c\u8d28\u4e0a\u4e5f\u662f\u5148\u7f16\u8bd1\u518d\u6267\u884c\u3002</p>"},{"location":"go/%E3%80%90golang%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%E3%80%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#go_4","title":"\u7f16\u8bd1 Go \u7a0b\u5e8f\u4e3a\u53ef\u6267\u884c\u6587\u4ef6","text":"<p><code>go build</code>\u547d\u4ee4\u8868\u793a\u5c06\u6e90\u4ee3\u7801\u7f16\u8bd1\u6210\u53ef\u6267\u884c\u6587\u4ef6\u3002</p> <p>\u5728 idea \u7684\u7ec8\u7aef\u4e2d\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u9ed8\u8ba4\u6211\u4eec<code>go build</code>\u7684\u53ef\u6267\u884c\u6587\u4ef6\u90fd\u662f\u5f53\u524d\u64cd\u4f5c\u7cfb\u7edf\u53ef\u6267\u884c\u7684\u6587\u4ef6\uff0c\u5b83\u5148\u7f16\u8bd1\u6e90\u4ee3\u7801\u5728\u5f53\u524d\u76ee\u5f55\u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5728\u5f53\u524d\u76ee\u5f55\u6267\u884c <code>hello-go.exe</code>\uff0c\u5982\u679c\u6211\u4eec\u5e0c\u671b\u5728\u5176\u4ed6\u5730\u65b9\u4e5f\u53ef\u4ee5\u6267\u884c\uff0c\u5219\u9700\u8981\u4f7f\u7528 <code>go install</code> \u547d\u4ee4\u3002</p> <p><code>go install</code>\u8868\u793a\u5b89\u88c5\u7684\u610f\u601d\uff0c\u5b83\u5148\u7f16\u8bd1\u6e90\u4ee3\u7801\u5f97\u5230\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u7136\u540e\u5c06\u53ef\u6267\u884c\u6587\u4ef6\u79fb\u52a8\u5230<code>GOPATH</code>\u7684 <code>bin</code> \u76ee\u5f55\u4e0b\u3002\u56e0\u4e3a\u6211\u4eec\u7684\u73af\u5883\u53d8\u91cf\u4e2d\u914d\u7f6e\u4e86<code>GOPATH</code>\u4e0b\u7684 <code>bin</code> \u76ee\u5f55\uff0c\u6240\u4ee5\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u4efb\u610f\u5730\u65b9\u76f4\u63a5\u6267\u884c\u53ef\u6267\u884c\u6587\u4ef6\u4e86\u3002</p> <p>\u53c2\u8003\u6587\u6863</p> <p>https://www.liwenzhou.com/posts/Go/install_go_dev/</p>"},{"location":"image/%E6%94%B6%E9%9B%86%E7%9A%84%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99/%E5%9C%A8%E7%BA%BF%E9%98%85%E8%AF%BB%E4%B9%A6%E7%B1%8D%E6%B1%87%E6%80%BB/","title":"\u5728\u7ebf\u9605\u8bfb\u4e66\u7c4d\u6c47\u603b","text":""},{"location":"image/%E6%94%B6%E9%9B%86%E7%9A%84%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99/%E5%9C%A8%E7%BA%BF%E9%98%85%E8%AF%BB%E4%B9%A6%E7%B1%8D%E6%B1%87%E6%80%BB/#_2","title":"\u523b\u610f\u7ec3\u4e60","text":""},{"location":"image/%E6%94%B6%E9%9B%86%E7%9A%84%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99/%E5%9C%A8%E7%BA%BF%E9%98%85%E8%AF%BB%E4%B9%A6%E7%B1%8D%E6%B1%87%E6%80%BB/#java","title":"Java \u7f16\u7a0b\u601d\u60f3","text":""},{"location":"image/%E6%94%B6%E9%9B%86%E7%9A%84%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99/%E5%9C%A8%E7%BA%BF%E9%98%85%E8%AF%BB%E4%B9%A6%E7%B1%8D%E6%B1%87%E6%80%BB/#maven","title":"maven\u6307\u5357","text":""},{"location":"java/Java%20%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3/","title":"Java \u7f16\u7a0b\u601d\u60f3","text":""},{"location":"java/Java%20%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3/#_1","title":"\u4e00. \u5bf9\u8c61\u5165\u95e8","text":""},{"location":"java/Java%20%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3/#11","title":"1.1 \u5c01\u88c5","text":"\u4fee\u9970\u7b26 \u8bbf\u95ee\u8303\u56f4 public \u53ef\u4ee5\u5168\u5c40\u8bbf\u95ee \u672a\u6307\u5b9a \u53ef\u4ee5\u5305\u8bbf\u95ee protected \u81ea\u5df1\u548c\u5b50\u7c7b\u8bbf\u95ee private \u53ea\u80fd\u81ea\u5df1\u8bbf\u95ee"},{"location":"java/Java11%E5%92%8CJava17%E4%B9%8B%E9%97%B4%E6%9C%89%E5%93%AA%E4%BA%9B%E6%96%B0%E5%8F%98%E5%8C%96/","title":"Java 11 \u548c Java 17 \u4e4b\u95f4\u6709\u54ea\u4e9b\u65b0\u53d8\u5316\uff1f","text":""},{"location":"java/Java11%E5%92%8CJava17%E4%B9%8B%E9%97%B4%E6%9C%89%E5%93%AA%E4%BA%9B%E6%96%B0%E5%8F%98%E5%8C%96/#_1","title":"\u4e00. \u7b80\u4ecb","text":"<p>2021 \u5e74 9 \u6708 14 \u65e5\uff0cJava 17 \u53d1\u5e03\uff0c\u6709\u5fc5\u8981\u4ed4\u7ec6\u770b\u770b\u81ea\u4e0a\u4e00\u4e2a LTS \uff08Long Term Support\uff09\u7248\u672c\uff08\u5373 Java 11\uff09\u4ee5\u6765\u7684\u53d8\u5316\uff0c\u672c\u6587\u4e3b\u8981\u7b80\u8981\u4ecb\u7ecd\u8bb8\u53ef\u6a21\u578b\uff0c\u7136\u540e\u4ecb\u7ecd\u5982\u4f55\u5728 idea \u4e2d\u914d\u7f6e jdk17\u3002</p> <p>\u9996\u5148\uff0c\u8ba9\u6211\u4eec\u4ed4\u7ec6\u770b\u770b Java \u8bb8\u53ef\u548c\u652f\u6301\u6a21\u578b\uff0cJava 17 \u662f\u4e00\u4e2a LTS\uff08\u957f\u671f\u652f\u6301\uff09\u7248\u672c\uff0c\u5c31\u50cf Java 11 \u4e00\u6837\u3002\u968f\u7740 Java 11\uff0c\u4e00\u4e2a\u65b0\u7684\u53d1\u5e03\u8282\u594f\u5f00\u59cb\u4e86\uff0cJava 11 \u652f\u6301\u5230 2023 \u5e74 9 \u6708\uff0c\u6269\u5c55\u652f\u6301\u5230 2026 \u5e74 9 \u6708\u3002\u6b64\u5916\u5728 Java 11 \u4e2d\uff0cOracle JDK \u4e0d\u518d\u514d\u8d39\u7528\u4e8e\u751f\u4ea7\u548c\u5546\u4e1a\u7528\u9014\uff0c\u6bcf 6 \u4e2a\u6708\u53d1\u5e03\u4e00\u4e2a\u65b0\u7684 Java \u7248\u672c\uff0c\u5373\u6240\u8c13\u7684\u975e LTS \u53d1\u5e03 Java 12 \u76f4\u81f3\u5e76\u5305\u62ec Java 16\u3002\u4f46\u662f\u8fd9\u4e9b\u662f\u751f\u4ea7\u5c31\u7eea\u7248\u672c\uff0c\u4e0e LTS \u7248\u672c\u7684\u552f\u4e00\u533a\u522b\u662f\u652f\u6301\u5728\u4e0b\u4e00\u4e2a\u7248\u672c\u53d1\u5e03\u65f6\u7ed3\u675f\u3002\u4f8b\u5982\uff0cJava 12 \u7684\u652f\u6301\u5728 Java 13 \u53d1\u5e03\u65f6\u7ed3\u675f\u3002\u5f53\u4f60\u60f3\u8981\u4fdd\u6301\u652f\u6301\u65f6\uff0c\u4f60\u6216\u591a\u6216\u5c11\u9700\u8981\u5347\u7ea7\u5230 Java 13\u3002\u5f53\u4f60\u7684\u67d0\u4e9b\u4f9d\u8d56\u9879\u5c1a\u672a\u4e3a Java 13 \u505a\u597d\u51c6\u5907\u65f6\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4e00\u4e9b\u95ee\u9898\u3002 </p> <p>\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u5bf9\u4e8e\u751f\u4ea7\u7528\u9014\uff0c\u516c\u53f8\u4f1a\u7b49\u5f85 LTS \u7248\u672c\uff0c\u4f46\u5373\u4fbf\u5982\u6b64\uff0c\u4e00\u4e9b\u516c\u53f8\u4e5f\u4e0d\u613f\u610f\u5347\u7ea7\u3002\u6700\u8fd1\u5bf9 Snyk\u7684\u4e00\u9879\u8c03\u67e5\u663e\u793a\uff0c\u53ea\u6709 60% \u7684\u4eba\u5728\u751f\u4ea7\u4e2d\u4f7f\u7528 Java 11\uff0c\u800c\u8fd9\u8ddd\u79bb Java 11 \u53d1\u5e03\u5df2\u7ecf\u8fc7\u53bb\u4e86 3 \u5e74\uff0160% \u7684\u516c\u53f8\u4ecd\u5728\u4f7f\u7528 Java 8\u3002\u53e6\u4e00\u4e2a\u503c\u5f97\u6ce8\u610f\u7684\u6709\u8da3\u4e8b\u60c5\u662f\uff0c\u4e0b\u4e00\u4e2a LTS \u7248\u672c\u5c06\u662f Java 21\uff0c\u5b83\u5c06\u5728 2 \u5e74\u5185\u53d1\u5e03\uff0c\u53ef\u4ee5\u5728\u8fd9\u91cc\u627e\u5230\u5173\u4e8e\u5e93\u662f\u5426\u5b58\u5728 Java 17 \u95ee\u9898\u7684\u4e00\u4e2a\u5f88\u597d\u7684\u6982\u8ff0\u3002</p> <p>\u968f\u7740 Java 17 \u7684\u63a8\u51fa\uff0cOracle \u8bb8\u53ef\u6a21\u5f0f\u53d1\u751f\u4e86\u53d8\u5316\uff0c Java 17 \u662f\u6839\u636e\u65b0\u7684 NFTC\uff08Oracle \u514d\u8d39\u6761\u6b3e\u548c\u6761\u4ef6\uff09\u8bb8\u53ef\u53d1\u5e03\u7684\uff0c\u56e0\u6b64\u518d\u6b21\u5141\u8bb8\u514d\u8d39\u5c06 Oracle JDK \u7248\u672c\u7528\u4e8e\u751f\u4ea7\u548c\u5546\u4e1a\u7528\u9014\u3002\u5728\u540c\u4e00\u4e2a Snyk \u8c03\u67e5\u4e2d\uff0c\u6709\u4eba\u6307\u51fa Oracle JDK \u7248\u672c\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4ec5\u88ab 23% \u7684\u7528\u6237\u4f7f\u7528\uff0c\u8bf7\u6ce8\u610f\u5bf9 LTS \u7248\u672c\u7684\u652f\u6301\u5c06\u5728\u4e0b\u4e00\u4e2a LTS \u7248\u672c\u53d1\u5e03\u4e00\u5e74\u540e\u7ed3\u675f\u3002</p> <p>Java 11 \u548c Java 17 \u4e4b\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\u53d8\u5316\uff1f\u53ef\u4ee5\u5728OpenJDK\u7f51\u7ad9\u4e0a\u627e\u5230 JEP\uff08Java \u589e\u5f3a\u5efa\u8bae\uff09\u7684\u5b8c\u6574\u5217\u8868\uff0c\u4f60\u53ef\u4ee5\u5728\u6b64\u5904\u9605\u8bfb\u6bcf\u4e2a JEP \u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u6709\u5173\u81ea Java 11 \u4ee5\u6765\u6bcf\u4e2a\u7248\u672c\u66f4\u6539\u7684\u5b8c\u6574\u5217\u8868\uff0c Oracle \u53d1\u884c\u8bf4\u660e\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5f88\u597d\u7684\u6982\u8ff0\u3002</p>"},{"location":"java/Java11%E5%92%8CJava17%E4%B9%8B%E9%97%B4%E6%9C%89%E5%93%AA%E4%BA%9B%E6%96%B0%E5%8F%98%E5%8C%96/#idea-jdk17","title":"\u4e8c. \u5728 idea \u4e2d\u914d\u7f6e jdk17","text":""},{"location":"java/Java11%E5%92%8CJava17%E4%B9%8B%E9%97%B4%E6%9C%89%E5%93%AA%E4%BA%9B%E6%96%B0%E5%8F%98%E5%8C%96/#1-jdk-17","title":"1. \u4e0b\u8f7d jdk 17","text":"<p>\u4e0b\u8f7d\u5730\u5740\uff1ahttps://www.oracle.com/java/technologies/downloads/</p> <p>\u8fd9\u91cc\u662f\u5728 windows \u4e2d\u5b89\u88c5 jdk 17\uff0c\u6240\u4ee5\u9009\u62e9 Windows \uff0c\u7136\u540e\u9009\u62e9\u4e0b\u8f7d zip \u5305\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u4e0b\u8f7d\u5b8c\u6210\u540e\u89e3\u538b\u5230\u4e00\u4e2a\u6307\u5b9a\u7684\u76ee\u5f55\uff0c\u6211\u8fd9\u91cc\u9009\u62e9\u653e\u5728 <code>D:\\environment\\jdk-17</code> \u76ee\u5f55\uff0c\u7136\u540e\u9700\u8981\u914d\u7f6e\u73af\u5883\u53d8\u91cf\uff0c\u914d\u7f6e\u73af\u5883\u53d8\u91cf\u975e\u5e38\u7b80\u5355\uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\u3002\u5982\u679c\u4f7f\u7528 idea \u5f00\u53d1\uff0c\u5219\u53ef\u4ee5\u4e0d\u7528\u914d\u7f6e\u73af\u5883\u53d8\u91cf\uff0c\u901a\u8fc7\u5728 idea \u6307\u5b9a jdk \u7684\u5b89\u88c5\u76ee\u5f55\u5373\u53ef\uff0c\u4e0b\u9762\u8be6\u7ec6\u8bf4\u660e\u5982\u4f55\u914d\u7f6e\u3002</p>"},{"location":"java/Java11%E5%92%8CJava17%E4%B9%8B%E9%97%B4%E6%9C%89%E5%93%AA%E4%BA%9B%E6%96%B0%E5%8F%98%E5%8C%96/#2-idea-jdk17","title":"2. \u5728 idea \u4e2d\u914d\u7f6e jdk17","text":"<p>\u70b9\u51fb <code>file --&gt; settings</code>\uff0c\u6253\u5f00 <code>settings</code> \u786e\u5b9a <code>Java  compiler</code> \u7684 <code>Project bytecode version</code> \u662f\u5426\u9009\u4e2d\u9879\u76ee\u9700\u8981\u7684jdk\u7248\u672c\uff0c\u6211\u8fd9\u91cc\u7684 idea \u7248\u672c\u6ca1\u6709 17\uff0c\u6240\u4ee5\u9009\u62e9 16 \u5c31\u53ef\u4ee5\u4e86\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u70b9\u51fb <code>File --&gt; Project Structure</code>\uff0c\u6253\u5f00 <code>Project settings</code> \uff0c\u914d\u7f6e <code>Project SDK</code>\uff0c\u5982\u679c\u524d\u9762\u914d\u7f6e\u597d\u4e86\u73af\u5883\u53d8\u91cf\uff0cidea \u4f1a\u81ea\u52a8\u8bc6\u522b\u914d\u7f6e\u7684 jdk\uff0c\u5982\u679c\u524d\u9762\u6ca1\u6709\u914d\u7f6e\u73af\u5883\u53d8\u91cf\uff0c\u6211\u4eec\u53ea\u9700\u8981\u9009\u62e9 <code>Add SDK --&gt; JDK</code>\uff0c\u5e76\u4e14\u6307\u5b9a\u524d\u9762\u89e3\u538b\u540e\u7684 jdk \u76ee\u5f55\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u914d\u7f6e\u597d <code>Project SDK</code> \u540e\uff0c<code>Project language level</code> \u9009\u62e9 <code>SDK default</code> \u5373\u53ef\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u914d\u7f6e <code>Modules</code> \u7684 <code>Language level</code>\uff0c\u4e0d\u540c\u7684 <code>Module</code> \u53ef\u4ee5\u914d\u7f6e\u4e0d\u540c\u7684 <code>Language level</code> \uff0c\u4f46\u662f\u4e0d\u80fd\u6bd4\u9879\u76ee\u7684 jdk \u7248\u672c\u9ad8\uff0c\u8fd9\u91cc\u914d\u7f6e\u9879\u76ee\u9ed8\u8ba4\u7684\u5373\u53ef\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"java/Java11%E5%92%8CJava17%E4%B9%8B%E9%97%B4%E6%9C%89%E5%93%AA%E4%BA%9B%E6%96%B0%E5%8F%98%E5%8C%96/#java-17","title":"\u4e09. Java 17 \u65b0\u7279\u6027","text":"<p>\u6839\u636e\u524d\u9762\u7684\u6b65\u9aa4\u5c31\u53ef\u4ee5\u5728 idea \u4e2d\u914d\u7f6e\u597d jdk 17\uff0c\u4e0b\u9762\u5c06\u901a\u8fc7\u4f8b\u5b50\u91cd\u70b9\u4ecb\u7ecd Java 17 \u53ef\u4ee5\u6b63\u5f0f\u4f7f\u7528\u7684\u4e00\u4e9b\u65b0\u7279\u6027\u3002</p>"},{"location":"java/Java11%E5%92%8CJava17%E4%B9%8B%E9%97%B4%E6%9C%89%E5%93%AA%E4%BA%9B%E6%96%B0%E5%8F%98%E5%8C%96/#1-text-blocks","title":"1. \u6587\u672c\u5757(Text Blocks)","text":"<p>Java 13 \u5f15\u5165\u4e86\u6587\u672c\u5757\u6765\u89e3\u51b3\u591a\u884c\u6587\u672c\u7684\u95ee\u9898\uff0c\u6587\u672c\u5757\u4e3b\u8981\u4ee5\u4e09\u91cd\u53cc\u5f15\u53f7\u5f00\u5934\uff0c\u5e76\u4ee5\u540c\u6837\u7684\u4ee5\u4e09\u91cd\u53cc\u5f15\u53f7\u7ed3\u5c3e\u7ec8\u6b62\uff0c\u5b83\u4eec\u4e4b\u95f4\u7684\u4efb\u4f55\u5185\u5bb9\u90fd\u88ab\u89e3\u91ca\u4e3a\u6587\u672c\u5757\u5b57\u7b26\u4e32\u7684\u4e00\u90e8\u5206\uff0c\u5305\u62ec\u6362\u884c\u7b26\uff0c\u907f\u514d\u4e86\u5bf9\u5927\u591a\u6570\u8f6c\u4e49\u5e8f\u5217\u7684\u9700\u8981\uff0c\u5e76\u4e14\u5b83\u4ecd\u7136\u662f\u666e\u901a\u7684 <code>java.lang.String</code> \u5bf9\u8c61\uff0c\u6587\u672c\u5757\u53ef\u4ee5\u5728 Java \u4e2d\u80fd\u591f\u4f7f\u7528\u5b57\u7b26\u4e32\u7684\u4efb\u4f55\u5730\u65b9\u8fdb\u884c\u4f7f\u7528\uff0c\u800c\u4e0e\u7f16\u8bd1\u540e\u7684\u4ee3\u7801\u6ca1\u6709\u533a\u522b\uff0c\u8fd8\u589e\u5f3a\u4e86 Java \u7a0b\u5e8f\u4e2d\u7684\u5b57\u7b26\u4e32\u53ef\u8bfb\u6027\u3002\u5e76\u4e14\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c\u53ef\u4ee5\u66f4\u76f4\u89c2\u5730\u8868\u793a\u5b57\u7b26\u4e32\uff0c\u53ef\u4ee5\u652f\u6301\u8de8\u8d8a\u591a\u884c\uff0c\u800c\u4e14\u4e0d\u4f1a\u51fa\u73b0\u8f6c\u4e49\u7684\u89c6\u89c9\u6df7\u4e71\uff0c\u5c06\u53ef\u4ee5\u5e7f\u6cdb\u63d0\u9ad8 Java \u7c7b\u7a0b\u5e8f\u7684\u53ef\u8bfb\u6027\u548c\u53ef\u5199\u6027\u3002\u8fd9\u4e2a\u6587\u672c\u5757\u7684\u7528\u6cd5\u548c python \u4e2d\u7684\u6587\u672c\u5757\u4e00\u6837\uff0c</p> <p>Java 14 \u5728 Java 13 \u5f15\u5165\u7684\u6587\u672c\u5757\u7684\u57fa\u7840\u4e4b\u4e0a\uff0c\u65b0\u52a0\u5165\u4e86\u4e24\u4e2a\u8f6c\u4e49\u7b26\uff0c\u5206\u522b\u662f\uff1a<code>\\</code> \u548c <code>\\s</code>\uff0c\u8fd9\u4e24\u4e2a\u8f6c\u4e49\u7b26\u5206\u522b\u8868\u8fbe\u6db5\u4e49\u5982\u4e0b\uff1a</p> <ul> <li><code>\\</code>\uff1a\u884c\u7ec8\u6b62\u7b26\uff0c\u4e3b\u8981\u7528\u4e8e\u963b\u6b62\u63d2\u5165\u6362\u884c\u7b26\uff1b</li> <li><code>\\s</code>\uff1a\u8868\u793a\u4e00\u4e2a\u7a7a\u683c\u3002\u53ef\u4ee5\u7528\u6765\u907f\u514d\u672b\u5c3e\u7684\u767d\u5b57\u7b26\u88ab\u53bb\u6389\u3002</li> </ul> <p>\u5728 Java 13 \u4e4b\u524d\uff0c\u591a\u884c\u5b57\u7b26\u4e32\u5199\u6cd5\u4e3a\uff1a</p> <pre><code>String literal = \"Lorem ipsum dolor sit amet, consectetur adipiscing \" +\n                 \"elit, sed do eiusmod tempor incididunt ut labore \" +\n                 \"et dolore magna aliqua.\";\nString json = \"{\\n\" +\n    \"  \\\"name\\\": \\\"\u5f20\u4e09\\\",\\n\" +\n    \"  \\\"age\\\": 20\\n\" +\n    \"}\";\n</code></pre> <p>\u5728 Java 14 \u65b0\u5f15\u5165\u4e24\u4e2a\u8f6c\u4e49\u7b26\u4e4b\u540e\uff0c\u4e0a\u8ff0\u5185\u5bb9\u53ef\u4ee5\u5199\u4e3a\uff1a</p> <pre><code>String text = \"\"\"\n              Lorem ipsum dolor sit amet, consectetur adipiscing \\\n              elit, sed do eiusmod tempor incididunt ut labore \\\n              et dolore magna aliqua.\\\n              \"\"\";\nString json = \"\"\"\n              {\n                  \"name\": \"\u5f20\u4e09\",\n                  \"age\": 20\n              }\n              \"\"\";\n</code></pre> <p>\u4e0a\u8ff0\u4e24\u79cd\u5199\u6cd5\uff0c\u8f93\u51fa\u5185\u5bb9\u662f\u4e00\u6837\u7684\u3002</p> <p>\u5bf9\u4e8e\u8f6c\u4e49\u7b26\uff1a<code>\\s</code>\uff0c\u7528\u6cd5\u5982\u4e0b\uff0c\u80fd\u591f\u4fdd\u8bc1\u4e0b\u5217\u6587\u672c\u6bcf\u884c\u6b63\u597d\u90fd\u662f\u516d\u4e2a\u5b57\u7b26\u957f\u5ea6\uff1a</p> <p>\u6e05\u5355 13. \u591a\u884c\u6587\u672c\u5757\u52a0\u4e0a\u8f6c\u4e49\u7b26\u7684\u5199\u6cd5</p> <pre><code>String colors = \"\"\"\n             red  \\s\n             green\\s\n             blue \\s\n             \"\"\";\n</code></pre> <p>Java 14 \u5e26\u6765\u7684\u8fd9\u4e24\u4e2a\u8f6c\u4e49\u7b26\uff0c\u80fd\u591f\u7b80\u5316\u8de8\u591a\u884c\u5b57\u7b26\u4e32\u7f16\u7801\u95ee\u9898\uff0c\u901a\u8fc7\u8f6c\u4e49\u7b26\uff0c\u80fd\u591f\u907f\u514d\u5bf9\u6362\u884c\u7b49\u7279\u6b8a\u5b57\u7b26\u4e32\u8fdb\u884c\u8f6c\u79fb\uff0c\u4ece\u800c\u7b80\u5316\u4ee3\u7801\u7f16\u5199\uff0c\u540c\u65f6\u4e5f\u589e\u5f3a\u4e86\u4f7f\u7528 String \u6765\u8868\u8fbe HTML\u3001XML\u3001SQL \u6216 JSON \u7b49\u683c\u5f0f\u5b57\u7b26\u4e32\u7684\u7f16\u7801\u53ef\u8bfb\u6027\uff0c\u4e14\u6613\u4e8e\u7ef4\u62a4\u3002</p> <p>\u540c\u65f6 Java 14 \u8fd8\u5bf9 String \u8fdb\u884c\u4e86\u65b9\u6cd5\u6269\u5c55\uff1a</p> <ul> <li><code>stripIndent()</code> \uff1a\u7528\u4e8e\u4ece\u6587\u672c\u5757\u4e2d\u53bb\u9664\u7a7a\u767d\u5b57\u7b26</li> <li><code>translateEscapes()</code>\uff1a\u7528\u4e8e\u7ffb\u8bd1\u8f6c\u4e49\u5b57\u7b26</li> <li><code>formatted(Object... args)</code>\uff1a\u7528\u4e8e\u683c\u5f0f\u5316</li> </ul>"},{"location":"java/Java11%E5%92%8CJava17%E4%B9%8B%E9%97%B4%E6%9C%89%E5%93%AA%E4%BA%9B%E6%96%B0%E5%8F%98%E5%8C%96/#2-switch","title":"2. Switch \u8868\u8fbe\u5f0f","text":"<p>switch \u8868\u8fbe\u5f0f\u5728\u4e4b\u524d\u7684 Java 12 \u548c Java 13 \u4e2d\u90fd\u662f\u5904\u4e8e\u9884\u89c8\u9636\u6bb5\uff0c\u800c\u5728\u8fd9 Java 14 \u4e2d\uff0c\u7ec8\u4e8e\u6210\u4e3a\u7a33\u5b9a\u7248\u672c\uff0c\u80fd\u591f\u6b63\u5f0f\u4f7f\u7528\u3002</p> <p>\u4ee5\u5f80\u7684 switch \u8bed\u53e5\u5199\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>private static void oldStyleWithoutBreak(Fruit fruit) {\n    switch (fruit) {\n        case APPLE, PEAR:\n            System.out.println(\"Common fruit\");\n        case ORANGE, AVOCADO:\n            System.out.println(\"Exotic fruit\");\n        default:\n            System.out.println(\"Undefined fruit\");\n    }\n}\n</code></pre> <p>\u8c03\u7528\u4e0a\u9762\u7684\u65b9\u6cd5\uff1a</p> <pre><code>oldStyleWithoutBreak(Fruit.APPLE);\n</code></pre> <p>\u56e0\u4e3a\u6ca1\u6709 <code>break</code> \u8bed\u53e5\uff0c\u6240\u4ee5\u6bcf\u4e00\u4e2a <code>case</code> \u8bed\u53e5\u90fd\u4f1a\u6267\u884c\uff0c\u8f93\u51fa\u5982\u4e0b\uff1a</p> <pre><code>Common fruit\nExotic fruit\nUndefined fruit\n</code></pre> <p>\u4e3a\u4e86\u4e0d\u8ba9\u6bcf\u4e00\u4e2a case \u8bed\u53e5\u90fd\u6267\u884c\uff0c\u9700\u8981\u5728\u6bcf\u4e00\u4e2a case \u7684\u6700\u540e\u4e00\u884c\u6dfb\u52a0 break \u8bed\u53e5\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>private static void oldStyleWithBreak(Fruit fruit) {\n    switch (fruit) {\n        case APPLE, PEAR:\n            System.out.println(\"Common fruit\");\n            break;\n        case ORANGE, AVOCADO:\n            System.out.println(\"Exotic fruit\");\n            break;\n        default:\n            System.out.println(\"Undefined fruit\");\n    }\n}\n</code></pre> <p>\u800c\u73b0\u5728 Java 14 \u53ef\u4ee5\u4f7f\u7528 switch \u8868\u8fbe\u5f0f\u6b63\u5f0f\u7248\u4e4b\u540e\uff0c\u4e0a\u9762\u8bed\u53e5\u53ef\u4ee5\u8f6c\u6362\u4e3a\u4e0b\u5217\u5199\u6cd5\uff1a</p> <pre><code>private static void withSwitchExpression(Fruit fruit) {\n    switch (fruit) {\n        case APPLE, PEAR -&gt; System.out.println(\"Common fruit\");\n        case ORANGE, AVOCADO -&gt; System.out.println(\"Exotic fruit\");\n        default -&gt; System.out.println(\"Undefined fruit\");\n    }\n}\n</code></pre> <p>switch \u8868\u8fbe\u5f0f\u53ef\u4ee5\u8fd4\u56de\u4e00\u4e2a\u503c\uff0c\u56e0\u6b64\u4e0a\u9762\u7684\u4ee3\u7801\u53ef\u4ee5\u8f6c\u6362\u6210\u4e0b\u9762\u7684\u5199\u6cd5\uff1a</p> <pre><code>private static void withReturnValue(Fruit fruit) {\n    String text = switch (fruit) {\n        case APPLE, PEAR -&gt; \"Common fruit\";\n        case ORANGE, AVOCADO -&gt; \"Exotic fruit\";\n        default -&gt; \"Undefined fruit\";\n    };\n    System.out.println(text);\n}\n</code></pre> <p>switch \u8868\u8fbe\u5f0f\u7528 yield \u5173\u952e\u5b57\u6765\u8fd4\u56de case \u5206\u652f\u9700\u8981\u8fd4\u56de\u7684\u7ed3\u679c\uff0c\u4e0a\u9762\u7684\u4ee3\u7801\u53ef\u4ee5\u8f6c\u6362\u6210\u4e0b\u9762\u7684\u5199\u6cd5\uff1a</p> <pre><code>private static void oldStyleWithYield(Fruit fruit) {\n    System.out.println(switch (fruit) {\n        case APPLE, PEAR:\n            yield \"Common fruit\";\n        case ORANGE, AVOCADO:\n            yield \"Exotic fruit\";\n        default:\n            yield \"Undefined fruit\";\n    });\n}\n</code></pre> <p>switch \u8868\u8fbe\u5f0f\u5e26\u6765\u7684\u4e0d\u4ec5\u4ec5\u662f\u7f16\u7801\u4e0a\u7684\u7b80\u6d01\u3001\u6d41\u7545\uff0c\u4e5f\u7cbe\u7b80\u4e86 switch \u8bed\u53e5\u7684\u4f7f\u7528\u65b9\u5f0f\uff0c\u540c\u65f6\u4e5f\u517c\u5bb9\u4e4b\u524d\u7684 switch \u8bed\u53e5\u7684\u4f7f\u7528\uff1b\u4e4b\u524d\u4f7f\u7528 switch \u8bed\u53e5\u65f6\uff0c\u5728\u6bcf\u4e2a\u5206\u652f\u7ed3\u675f\u4e4b\u524d\uff0c\u5f80\u5f80\u90fd\u9700\u8981\u52a0\u4e0a break \u5173\u952e\u5b57\u8fdb\u884c\u5206\u652f\u8df3\u51fa\uff0c\u4ee5\u9632 switch \u8bed\u53e5\u4e00\u76f4\u5f80\u540e\u6267\u884c\u5230\u6574\u4e2a switch \u8bed\u53e5\u7ed3\u675f\uff0c\u7531\u6b64\u9020\u6210\u4e00\u4e9b\u610f\u60f3\u4e0d\u5230\u7684\u95ee\u9898\u3002switch \u8bed\u53e5\u4e00\u822c\u4f7f\u7528\u5192\u53f7 <code>\uff1a</code>\u6765\u4f5c\u4e3a\u8bed\u53e5\u5206\u652f\u4ee3\u7801\u7684\u5f00\u59cb\uff0c\u800c switch \u8868\u8fbe\u5f0f\u5219\u63d0\u4f9b\u4e86\u65b0\u7684\u5206\u652f\u5207\u6362\u65b9\u5f0f\uff0c\u5373 <code>-&gt;</code> \u7b26\u53f7\u53f3\u5219\u8868\u8fbe\u5f0f\u65b9\u6cd5\u4f53\u5728\u6267\u884c\u5b8c\u5206\u652f\u65b9\u6cd5\u4e4b\u540e\uff0c\u81ea\u52a8\u7ed3\u675f switch \u5206\u652f\uff0c\u540c\u65f6 -&gt; \u53f3\u5219\u65b9\u6cd5\u5757\u4e2d\u53ef\u4ee5\u662f\u8868\u8fbe\u5f0f\u3001\u4ee3\u7801\u5757\u6216\u8005\u662f\u624b\u52a8\u629b\u51fa\u7684\u5f02\u5e38\u3002</p> <p>\u5f88\u660e\u663e\uff0cswitch \u8868\u8fbe\u5f0f\u5c06\u4e4b\u524d switch \u8bed\u53e5\u4ece\u7f16\u7801\u65b9\u5f0f\u4e0a\u7b80\u5316\u4e86\u4e0d\u5c11\uff0c\u4f46\u662f\u8fd8\u662f\u9700\u8981\u6ce8\u610f\u4e0b\u9762\u51e0\u70b9\uff1a</p> <ul> <li>\u9700\u8981\u4fdd\u6301\u4e0e\u4e4b\u524d switch \u8bed\u53e5\u540c\u6837\u7684 case \u5206\u652f\u60c5\u51b5\u3002</li> <li>\u4e4b\u524d\u9700\u8981\u7528\u53d8\u91cf\u6765\u63a5\u6536\u8fd4\u56de\u503c\uff0c\u800c\u73b0\u5728\u76f4\u63a5\u4f7f\u7528 yield \u5173\u952e\u5b57\u6765\u8fd4\u56de case \u5206\u652f\u9700\u8981\u8fd4\u56de\u7684\u7ed3\u679c\u3002</li> <li>\u73b0\u5728\u7684 switch \u8868\u8fbe\u5f0f\u4e2d\u4e0d\u518d\u9700\u8981\u663e\u5f0f\u5730\u4f7f\u7528 return\u3001break \u6216\u8005 continue \u6765\u8df3\u51fa\u5f53\u524d\u5206\u652f\u3002</li> <li>\u73b0\u5728\u4e0d\u9700\u8981\u50cf\u4e4b\u524d\u4e00\u6837\uff0c\u5728\u6bcf\u4e2a\u5206\u652f\u7ed3\u675f\u4e4b\u524d\u52a0\u4e0a break \u5173\u952e\u5b57\u6765\u7ed3\u675f\u5f53\u524d\u5206\u652f\uff0c\u5982\u679c\u4e0d\u52a0\uff0c\u5219\u4f1a\u9ed8\u8ba4\u5f80\u540e\u6267\u884c\uff0c\u76f4\u5230\u9047\u5230 break \u5173\u952e\u5b57\u6216\u8005\u6574\u4e2a switch \u8bed\u53e5\u7ed3\u675f\uff0c\u5728 Java 14 \u8868\u8fbe\u5f0f\u4e2d\uff0c\u8868\u8fbe\u5f0f\u9ed8\u8ba4\u6267\u884c\u5b8c\u4e4b\u540e\u81ea\u52a8\u8df3\u51fa\uff0c\u4e0d\u4f1a\u7ee7\u7eed\u5f80\u540e\u6267\u884c\u3002</li> <li>\u5bf9\u4e8e\u591a\u4e2a\u76f8\u540c\u7684 case \u65b9\u6cd5\u5757\uff0c\u53ef\u4ee5\u5c06 case \u6761\u4ef6\u5e76\u5217\uff0c\u800c\u4e0d\u9700\u8981\u50cf\u4e4b\u524d\u4e00\u6837\uff0c\u901a\u8fc7\u6bcf\u4e2a case \u540e\u9762\u6545\u610f\u4e0d\u52a0 break \u5173\u952e\u5b57\u6765\u4f7f\u7528\u76f8\u540c\u65b9\u6cd5\u5757\u3002</li> </ul> <p>\u4e0e\u4f20\u7edf\u5199\u6cd5\u5bf9\u6bd4\uff0c\u53ef\u4ee5\u53d1\u73b0\u6a21\u5f0f\u5339\u914d\u4e0d\u4f46\u63d0\u9ad8\u4e86\u7a0b\u5e8f\u7684\u5b89\u5168\u6027\u3001\u5065\u58ee\u6027\uff0c\u53e6\u4e00\u65b9\u9762\uff0c\u4e0d\u9700\u8981\u663e\u5f0f\u7684\u53bb\u8fdb\u884c\u4e8c\u6b21\u7c7b\u578b\u8f6c\u6362\uff0c\u51cf\u5c11\u4e86\u5927\u91cf\u4e0d\u5fc5\u8981\u7684\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\u3002\u6a21\u5f0f\u5339\u914d\u53d8\u91cf\u5728\u6a21\u5f0f\u5339\u914d\u6210\u529f\u4e4b\u540e\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\uff0c\u540c\u65f6\u5b83\u8fd8\u88ab\u9650\u5236\u4e86\u4f5c\u7528\u8303\u56f4\uff0c\u5927\u5927\u63d0\u9ad8\u4e86\u7a0b\u5e8f\u7684\u7b80\u6d01\u6027\u3001\u53ef\u8bfb\u6027\u548c\u5b89\u5168\u6027\u3002instanceof \u7684\u6a21\u5f0f\u5339\u914d\uff0c\u4e3a Java \u5e26\u6765\u7684\u6709\u4e00\u6b21\u4fbf\u6377\u7684\u63d0\u5347\uff0c\u80fd\u591f\u5254\u9664\u4e00\u4e9b\u5197\u4f59\u7684\u4ee3\u7801\uff0c\u5199\u51fa\u66f4\u52a0\u7b80\u6d01\u5b89\u5168\u7684\u4ee3\u7801\uff0c\u63d0\u9ad8\u7801\u4ee3\u7801\u6548\u7387\u3002</p>"},{"location":"java/Java11%E5%92%8CJava17%E4%B9%8B%E9%97%B4%E6%9C%89%E5%93%AA%E4%BA%9B%E6%96%B0%E5%8F%98%E5%8C%96/#3-records","title":"3. Records","text":"<p>\u5728\u4ee5\u5f80\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u88ab\u5f53\u4f5c\u6570\u636e\u8f7d\u4f53\u7684\u7c7b\u5bf9\u8c61\uff0c\u5728\u901a\u5e38\u9700\u8981\u7f16\u5199\u5927\u91cf\u7684\u65e0\u5b9e\u9645\u4e1a\u52a1\u3001\u91cd\u590d\u6027\u8d28\u7684\u4ee3\u7801\uff0c\u5176\u4e2d\u5305\u62ec\uff1a\u6784\u9020\u51fd\u6570\u3001\u5c5e\u6027\u8c03\u7528\u3001\u8bbf\u95ee\u4ee5\u53ca equals() \u3001hashCode()\u3001toString() \u7b49\u65b9\u6cd5\uff0c\u56e0\u6b64\u5728 Java 14 \u4e2d\u5f15\u5165\u4e86 Record \u7c7b\u578b\uff0c\u5176\u6548\u679c\u6709\u4e9b\u7c7b\u4f3c Lombok \u7684 @Data \u6ce8\u89e3\u3001Kotlin \u4e2d\u7684 data class\uff0c\u4f46\u662f\u53c8\u4e0d\u5c3d\u5b8c\u5168\u76f8\u540c\uff0c\u5b83\u4eec\u7684\u5171\u540c\u70b9\u90fd\u662f\u7c7b\u7684\u90e8\u5206\u6216\u8005\u5168\u90e8\u53ef\u4ee5\u76f4\u63a5\u5728\u7c7b\u5934\u4e2d\u5b9a\u4e49\u3001\u63cf\u8ff0\uff0c\u5e76\u4e14\u8fd9\u4e2a\u7c7b\u53ea\u7528\u4e8e\u5b58\u50a8\u6570\u636e\u800c\u5df2\u3002</p> <p>\u5bf9\u4e8e Record \u7c7b\u578b\uff0c\u5177\u4f53\u53ef\u4ee5\u7528\u4e0b\u9762\u4ee3\u7801\u6765\u8bf4\u660e\uff1a</p> <pre><code>public record Person(String name, int age) {\n    public Person {\n        System.out.println(name);\n        System.out.println(age);\n    }\n}\n</code></pre> <p>\u5bf9\u4e0a\u8ff0\u4ee3\u7801\u8fdb\u884c\u7f16\u8bd1\uff0c\u7136\u540e\u53cd\u7f16\u8bd1\u4e4b\u540e\u53ef\u4ee5\u770b\u5230\u5982\u4e0b\u7ed3\u679c\uff1a</p> <pre><code>public record Person(String name, int age) {\n    public Person(String name, int age) {\n        System.out.println(name);\n        System.out.println(age);\n        this.name = name;\n        this.age = age;\n    }\n\n    public String name() {\n        return this.name;\n    }\n\n    public int age() {\n        return this.age;\n    }\n}\n</code></pre> <p>\u6839\u636e\u53cd\u7f16\u8bd1\u7ed3\u679c\uff0c\u53ef\u4ee5\u5f97\u51fa\uff0c\u5f53\u7528 Record \u6765\u58f0\u660e\u4e00\u4e2a\u7c7b\u65f6\uff0c\u8be5\u7c7b\u5c06\u81ea\u52a8\u62e5\u6709\u4e0b\u9762\u7279\u5f81\uff1a</p> <ul> <li>\u62e5\u6709\u4e00\u4e2a\u6784\u9020\u65b9\u6cd5</li> <li>\u83b7\u53d6\u6210\u5458\u5c5e\u6027\u503c\u7684\u65b9\u6cd5\uff1aname()\u3001age()</li> <li>hashCode() \u65b9\u6cd5\u548c euqals() \u65b9\u6cd5</li> <li>toString() \u65b9\u6cd5</li> <li>\u7c7b\u5bf9\u8c61\u548c\u5c5e\u6027\u88ab final \u5173\u952e\u5b57\u4fee\u9970\uff0c\u4e0d\u80fd\u88ab\u7ee7\u627f\uff0c\u7c7b\u7684\u793a\u4f8b\u5c5e\u6027\u4e5f\u90fd\u88ab final \u4fee\u9970\uff0c\u4e0d\u80fd\u518d\u88ab\u8d4b\u503c\u4f7f\u7528\u3002</li> <li>\u8fd8\u53ef\u4ee5\u5728 Record \u58f0\u660e\u7684\u7c7b\u4e2d\u5b9a\u4e49\u9759\u6001\u5c5e\u6027\u3001\u65b9\u6cd5\u548c\u793a\u4f8b\u65b9\u6cd5\u3002\u6ce8\u610f\uff0c\u4e0d\u80fd\u5728 Record \u58f0\u660e\u7684\u7c7b\u4e2d\u5b9a\u4e49\u793a\u4f8b\u5b57\u6bb5\uff0c\u7c7b\u4e5f\u4e0d\u80fd\u58f0\u660e\u4e3a\u62bd\u8c61\u7c7b\u7b49\u3002</li> </ul>"},{"location":"java/Java11%E5%92%8CJava17%E4%B9%8B%E9%97%B4%E6%9C%89%E5%93%AA%E4%BA%9B%E6%96%B0%E5%8F%98%E5%8C%96/#4-instanceof","title":"4. instanceof \u81ea\u52a8\u5339\u914d\u6a21\u5f0f","text":"<p>\u5728\u8c03\u7528\u4e00\u4e2a\u5bf9\u8c61\u7684\u65b9\u6cd5\u4e4b\u524d\uff0c\u901a\u5e38\u6709\u5fc5\u8981\u68c0\u67e5\u5bf9\u8c61\u662f\u5426\u5177\u6709\u67d0\u79cd\u7c7b\u578b\uff0c\u5982\u679c\u662f\uff0c\u9996\u5148\u8981\u505a\u7684\u662f\u5c06\u5bf9\u8c61\u5f3a\u5236\u8f6c\u6362\u4e3a\u8be5\u7c7b\u578b\u7684\u65b0\u53d8\u91cf\u3002</p> <p>\u5728 java 14 \u4e4b\u524d\u9700\u8981\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\uff0c\u5199\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>if (object instanceof Kid) {\n    Kid kid = (Kid) object;\n    // ...\n} else if (object instanceof Kiddle) {\n    Kid kid = (Kid) object;\n    // ...\n}\n</code></pre> <p>\u4f7f\u7528 <code>instanceof</code> \u81ea\u52a8\u5339\u914d\u6a21\u5f0f\u540e\uff0c\u5199\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>if (object instanceof Kid kid) {\n    // ...\n} else if (object instanceof Kiddle kiddle) {\n    // ...\n}\n</code></pre>"},{"location":"java/Java11%E5%92%8CJava17%E4%B9%8B%E9%97%B4%E6%9C%89%E5%93%AA%E4%BA%9B%E6%96%B0%E5%8F%98%E5%8C%96/#5-nullpointerexceptions","title":"5. \u6539\u8fdb NullPointerExceptions \u63d0\u793a\u4fe1\u606f","text":"<p>Java 14 \u6539\u8fdb NullPointerException \u7684\u53ef\u67e5\u6027\u3001\u53ef\u8bfb\u6027\uff0c\u80fd\u66f4\u51c6\u786e\u5730\u5b9a\u4f4d null \u53d8\u91cf\u7684\u4fe1\u606f\u3002\u8be5\u7279\u6027\u80fd\u591f\u5e2e\u52a9\u5f00\u53d1\u8005\u548c\u6280\u672f\u652f\u6301\u4eba\u5458\u63d0\u9ad8\u751f\u4ea7\u529b\uff0c\u4ee5\u53ca\u6539\u8fdb\u5404\u79cd\u5f00\u53d1\u5de5\u5177\u548c\u8c03\u8bd5\u5de5\u5177\u7684\u8d28\u91cf\uff0c\u80fd\u591f\u66f4\u52a0\u51c6\u786e\u3001\u6e05\u695a\u5730\u6839\u636e\u52a8\u6001\u5f02\u5e38\u4e0e\u7a0b\u5e8f\u4ee3\u7801\u76f8\u7ed3\u5408\u6765\u7406\u89e3\u7a0b\u5e8f\u3002</p> <p>\u76f8\u4fe1\u6bcf\u4f4d\u5f00\u53d1\u8005\u5728\u5b9e\u9645\u7f16\u7801\u8fc7\u7a0b\u4e2d\u90fd\u9047\u5230\u8fc7 NullPointerException\uff0c\u6bcf\u5f53\u9047\u5230\u8fd9\u79cd\u5f02\u5e38\u7684\u65f6\u5019\uff0c\u90fd\u9700\u8981\u6839\u636e\u6253\u5370\u51fa\u6765\u7684\u8be6\u7ec6\u4fe1\u606f\u6765\u5206\u6790\u3001\u5b9a\u4f4d\u51fa\u73b0\u95ee\u9898\u7684\u539f\u56e0\uff0c\u4ee5\u5728\u7a0b\u5e8f\u4ee3\u7801\u4e2d\u89c4\u907f\u6216\u89e3\u51b3\u3002\u4f8b\u5982\uff0c\u5047\u8bbe\u4e0b\u9762\u4ee3\u7801\u51fa\u73b0\u4e86\u4e00\u4e2a NullPointerException\uff1a</p> <pre><code>book.id = 99;\n</code></pre> <p>\u6253\u5370\u51fa\u6765\u7684 NullPointerException \u4fe1\u606f\u5982\u4e0b\uff1a</p> <pre><code>Exception in thread \"main\" java.lang.NullPointerException\n    at Book.main(Book.java:5)\n</code></pre> <p>\u50cf\u4e0a\u9762\u8fd9\u79cd\u5f02\u5e38\uff0c\u56e0\u4e3a\u4ee3\u7801\u6bd4\u8f83\u7b80\u5355\uff0c\u5e76\u4e14\u5f02\u5e38\u4fe1\u606f\u4e2d\u4e5f\u6253\u5370\u51fa\u6765\u4e86\u884c\u53f7\u4fe1\u606f\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u5f88\u5feb\u901f\u5b9a\u4f4d\u5230\u51fa\u73b0\u5f02\u5e38\u4f4d\u7f6e\uff1abook \u4e3a\u7a7a\u800c\u5bfc\u81f4\u7684 NullPointerException\uff0c\u800c\u5bf9\u4e8e\u4e00\u4e9b\u590d\u6742\u6216\u8005\u5d4c\u5957\u7684\u60c5\u51b5\u4e0b\u51fa\u73b0 NullPointerException \u65f6\uff0c\u4ec5\u6839\u636e\u6253\u5370\u51fa\u6765\u7684\u4fe1\u606f\uff0c\u5f88\u96be\u5224\u65ad\u5b9e\u9645\u51fa\u73b0\u95ee\u9898\u7684\u4f4d\u7f6e\uff0c\u5177\u4f53\u89c1\u4e0b\u9762\u793a\u4f8b\uff1a</p> <pre><code>shoopingcart.buy.book.id = 99;\n</code></pre> <p>\u5bf9\u4e8e\u8fd9\u79cd\u6bd4\u8f83\u590d\u6742\u7684\u60c5\u51b5\u4e0b\uff0c\u4ec5\u4ec5\u5355\u6839\u636e\u5f02\u5e38\u4fe1\u606f\u4e2d\u6253\u5370\u7684\u884c\u53f7\uff0c\u5219\u6bd4\u8f83\u96be\u5224\u65ad\u51fa\u73b0 NullPointerException \u7684\u539f\u56e0\u3002</p> <p>\u800c Java 14 \u4e2d\uff0c\u5219\u505a\u4e86\u5bf9 NullPointerException \u6253\u5370\u5f02\u5e38\u4fe1\u606f\u7684\u6539\u8fdb\u589e\u5f3a\uff0c\u901a\u8fc7\u5206\u6790\u7a0b\u5e8f\u7684\u5b57\u8282\u7801\u4fe1\u606f\uff0c\u80fd\u591f\u505a\u5230\u51c6\u786e\u7684\u5b9a\u4f4d\u5230\u51fa\u73b0 NullPointerException \u7684\u53d8\u91cf\uff0c\u5e76\u4e14\u6839\u636e\u5b9e\u9645\u6e90\u4ee3\u7801\u6253\u5370\u51fa\u8be6\u7ec6\u5f02\u5e38\u4fe1\u606f\uff0c\u5bf9\u4e8e\u4e0a\u8ff0\u793a\u4f8b\uff0c\u6253\u5370\u4fe1\u606f\u5982\u4e0b\uff1a</p> <pre><code>Exception in thread \"main\" java.lang.NullPointerException: \n        Cannot assign field \"book\" because \"shoopingcart.buy\" is null\n    at Book.main(Book.java:5)\n</code></pre> <p>\u5bf9\u6bd4\u53ef\u4ee5\u770b\u51fa\uff0c\u6539\u8fdb\u4e4b\u540e\u7684 NullPointerException \u4fe1\u606f\uff0c\u80fd\u591f\u51c6\u786e\u6253\u5370\u51fa\u5177\u4f53\u54ea\u4e2a\u53d8\u91cf\u5bfc\u81f4\u7684 NullPointerException\uff0c\u51cf\u5c11\u4e86\u7531\u4e8e\u4ec5\u5e26\u884c\u53f7\u7684\u5f02\u5e38\u63d0\u793a\u4fe1\u606f\u5e26\u6765\u7684\u56f0\u60d1\u3002</p>"},{"location":"java/Java11%E5%92%8CJava17%E4%B9%8B%E9%97%B4%E6%9C%89%E5%93%AA%E4%BA%9B%E6%96%B0%E5%8F%98%E5%8C%96/#6","title":"6. \u652f\u6301\u7cbe\u7b80\u7684\u6570\u636e\u683c\u5f0f\u5316","text":"<p>\u5728 <code>NumberFormat</code> \u4e2d\u6dfb\u52a0\u4e86\u4e00\u4e2a\u5de5\u5382\u65b9\u6cd5\uff0c\u4ee5\u4fbf\u6839\u636e <code>Unicode</code> \u6807\u51c6\u4ee5\u7d27\u51d1\u7684\u3001\u4eba\u7c7b\u53ef\u8bfb\u7684\u5f62\u5f0f\u683c\u5f0f\u5316\u6570\u5b57\u3002</p> <p><code>SHORT</code> \u683c\u5f0f\u6837\u5f0f\u5982\u4e0b\u9762\u7684\u4ee3\u7801\u6240\u793a\uff1a</p> <pre><code>NumberFormat fmt = NumberFormat.getCompactNumberInstance(Locale.CHINA, NumberFormat.Style.SHORT);\nSystem.out.println(fmt.format(1000));\nSystem.out.println(fmt.format(100000));\nSystem.out.println(fmt.format(1000000));\n</code></pre> <p>\u8f93\u51fa\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>1,000\n10\u4e07\n100\u4e07\n</code></pre>"},{"location":"java/Java11%E5%92%8CJava17%E4%B9%8B%E9%97%B4%E6%9C%89%E5%93%AA%E4%BA%9B%E6%96%B0%E5%8F%98%E5%8C%96/#7","title":"7. \u652f\u6301\u4e00\u5929\u7684\u65f6\u95f4\u6bb5\u8bc6\u522b","text":"<p>\u6dfb\u52a0\u4e86\u4e00\u4e2a\u65b0\u7684\u6a21\u5f0fB\uff0c\u7528\u4e8e\u683c\u5f0f\u5316DateTime\uff0c\u5b83\u6839\u636eUnicode\u6807\u51c6\u6307\u793a\u4e00\u5929\u65f6\u95f4\u6bb5\u3002</p> <p>\u5b9e\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>DateTimeFormatter dtf = DateTimeFormatter.ofPattern(\"B\").withLocale(Locale.CHINA);\nSystem.out.println(dtf.format(LocalTime.of(8, 0)));\nSystem.out.println(dtf.format(LocalTime.of(13, 0)));\nSystem.out.println(dtf.format(LocalTime.of(20, 0)));\nSystem.out.println(dtf.format(LocalTime.of(0, 0)));\nSystem.out.println(dtf.format(LocalTime.of(1, 0)));\n</code></pre> <p>\u8f93\u51fa\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>\u4e0a\u5348\n\u4e0b\u5348\n\u665a\u4e0a\n\u5348\u591c\n\u51cc\u6668\n</code></pre>"},{"location":"java/Java11%E5%92%8CJava17%E4%B9%8B%E9%97%B4%E6%9C%89%E5%93%AA%E4%BA%9B%E6%96%B0%E5%8F%98%E5%8C%96/#8-streamtolist","title":"8. Stream.toList()","text":"<p>\u4e3a\u4e86\u5c06 <code>Stream</code> \u8f6c\u6362\u4e3a <code>List</code>\uff0c\u9700\u8981\u4f7f\u7528 <code>Collections . tolist()</code> \u8c03\u7528 <code>collect</code> \u65b9\u6cd5\u3002</p> <p>\u4ece\u4e0b\u9762\u7684\u4f8b\u5b50\u4e2d\u53ef\u4ee5\u770b\u51fa\uff0c\u8fd9\u975e\u5e38\u5197\u957f:</p> <pre><code>private static void oldStyle() {\n    Stream&lt;String&gt; stringStream = Stream.of(\"a\", \"b\", \"c\");\n    List&lt;String&gt; stringList =  stringStream.collect(Collectors.toList());\n    for(String s : stringList) {\n        System.out.println(s);\n    }\n}\n</code></pre> <p>\u5728 Java 17 \u4e2d\uff0c\u6dfb\u52a0\u4e86\u4e00\u4e2a <code>toList</code> \u65b9\u6cd5\u6765\u66ff\u6362\u65e7\u7684\u884c\u4e3a\uff1a</p> <pre><code>private static void streamToList() {\n    Stream&lt;String&gt; stringStream = Stream.of(\"a\", \"b\", \"c\");\n    List&lt;String&gt; stringList =  stringStream.toList();\n    for(String s : stringList) {\n        System.out.println(s);\n    }\n}\n</code></pre>"},{"location":"java/Java11%E5%92%8CJava17%E4%B9%8B%E9%97%B4%E6%9C%89%E5%93%AA%E4%BA%9B%E6%96%B0%E5%8F%98%E5%8C%96/#9-java-17-g1-gc","title":"9. Java 17 \u9ed8\u8ba4\u4f7f\u7528\u7684 G1 GC","text":"<p>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\uff1a</p> <pre><code>&gt;java -XX:+PrintCommandLineFlags -version\n\n-XX:ConcGCThreads=1 -XX:G1ConcRefinementThreads=4 -XX:GCDrainStackTargetSize=64 -XX:InitialHeapSize=266605184 -XX:MarkStackSize=4194304 -XX:MaxHeapSize=4265682944 -XX:MinHeapSize=6815736 -XX:+PrintCommandLineFlags -XX:ReservedCodeCacheSize=251658240 -XX:+SegmentedCodeCache -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseG1GC -XX:-UseLargePagesIndividualAllocation\njava version \"17.0.1\" 2021-10-19 LTS\nJava(TM) SE Runtime Environment (build 17.0.1+12-LTS-39)\nJava HotSpot(TM) 64-Bit Server VM (build 17.0.1+12-LTS-39, mixed mode, sharing)\n</code></pre> <p>\u53c2\u8003\u6587\u6863</p> <p>https://dzone.com/articles/whats-new-between-java-11-and-java-17</p>"},{"location":"java/Java%E4%B8%AD%E8%8E%B7%E5%8F%96ThreadDumps%E7%9A%848%E7%A7%8D%E6%96%B9%E5%BC%8F%E6%B1%87%E6%80%BB/","title":"Java\u4e2d\u83b7\u53d6 Thread Dumps \u7684 8 \u79cd\u65b9\u5f0f\u6c47\u603b","text":""},{"location":"java/Java%E5%92%8Cgo%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0LRU%E7%AE%97%E6%B3%95/","title":"Java\u548cgo\u8bed\u8a00\u5b9e\u73b0LRU\u7b97\u6cd5","text":"<p>\u53c2\u8003\u6587\u7ae0</p> <p>https://zhuanlan.zhihu.com/p/34989978</p> <p>https://blog.csdn.net/belongtocode/article/details/102989685</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/","title":"Java \u5f02\u5e38\u5206\u6790","text":"<p>\u672c\u6587\u662f\u5bf9\u4ee5\u4e0b\u5185\u5bb9\u7684\u5206\u6790\uff1a</p> <ul> <li> <p>Java\u5f02\u5e38\u8bbe\u8ba1</p> </li> <li> <p>Java \u5f02\u5e38\u5206\u7c7b</p> </li> <li> <p>Java\u5f02\u5e38\u53ef\u4ee5\u544a\u8bc9\u4ec0\u4e48\u95ee\u9898</p> </li> <li> <p>Java\u5f02\u5e38\u5904\u7406\u6700\u4f73\u5b9e\u8df5</p> </li> </ul> <p>Java Exception \u662f\u4e3a\u4e86\u5904\u7406\u5e94\u7528\u7a0b\u5e8f\u7684\u5f02\u5e38\u884c\u4e3a\u800c\u521b\u5efa\u7684\u7c7b\u3002\u5728\u672c\u6587\u4e2d\uff0c\u5c06\u89e3\u91ca\u5982\u4f55\u4f7f\u7528 Java Exception \u7c7b\u4ee5\u53ca\u5982\u4f55\u5728\u8003\u8651\u73b0\u6709 Java Exception \u8bbe\u8ba1\u7684\u60c5\u51b5\u4e0b\u521b\u5efa\u5f02\u5e38\u7ed3\u6784\u3002Java \u5f02\u5e38\u6982\u5ff5\u662f Java \u4e2d\u7684\u91cd\u8981\u91cc\u7a0b\u7891\u4e4b\u4e00\uff0c\u6bcf\u4e2a\u5f00\u53d1\u4eba\u5458\u90fd\u5fc5\u987b\u77e5\u9053\u5b83\u3002 </p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/#java_1","title":"Java \u5f02\u5e38\u4f53\u7cfb\u7ed3\u6784","text":"<p>\u57fa\u672c\u7ed3\u6784\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p><code>Throwable</code> \u662f\u6240\u6709\u5f02\u5e38\u7684\u7236\u7c7b\uff0c\u5b83\u6709\u4e24\u4e2a\u5b50\u7c7b\uff1a<code>Error</code> \u548c <code>Exception</code>\u3002</p> <p>Error \uff1a\u7a0b\u5e8f\u4e00\u65e6\u51fa\u73b0 Error \u9519\u8bef\uff0c\u7a0b\u5e8f\u53ef\u80fd\u4f1a\u505c\u6b62\u8fd0\u884c\u3002</p> <p>Exception\uff1a\u4e0e Error \u4e0d\u540c\uff0c\u7a0b\u5e8f\u4e2d\u51fa\u73b0 Exception \u5f02\u5e38\u6709\u673a\u4f1a\u4ece\u95ee\u9898\u4e2d\u6062\u590d\uff0c\u5e76\u5c1d\u8bd5\u4fdd\u6301\u7a0b\u5e8f\u8fd0\u884c\u3002</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/#java_2","title":"Java \u68c0\u67e5\u5f02\u5e38\u548c\u975e\u68c0\u67e5\u5f02\u5e38","text":"<p>\u68c0\u67e5\u5f02\u5e38\uff1a\u6240\u6709\u4e0d\u662f <code>Runtime Exception</code> \u7684\u5f02\u5e38\uff0c\u7edf\u79f0\u4e3a <code>Checked Exception</code>\uff0c\u53c8\u88ab\u79f0\u4e3a\u68c0\u67e5\u6027\u5f02\u5e38\u3002\u8fd9\u7c7b\u5f02\u5e38\u7684\u4ea7\u751f\u4e0d\u662f\u7a0b\u5e8f\u672c\u8eab\u7684\u95ee\u9898\uff0c\u901a\u5e38\u7531\u5916\u754c\u56e0\u7d20\u9020\u6210\u7684\u3002\u4e3a\u4e86\u9884\u9632\u8fd9\u4e9b\u5f02\u5e38\u4ea7\u751f\u65f6\uff0c\u9020\u6210\u7a0b\u5e8f\u7684\u4e2d\u65ad\u6216\u5f97\u5230\u4e0d\u6b63\u786e\u7684\u7ed3\u679c\uff0cJava \u8981\u6c42\u7f16\u5199\u53ef\u80fd\u4ea7\u751f\u8fd9\u7c7b\u5f02\u5e38\u7684\u7a0b\u5e8f\u4ee3\u7801\u65f6\uff0c\u4e00\u5b9a\u8981\u53bb\u505a\u5f02\u5e38\u7684\u5904\u7406\u3002</p> <p>\u975e\u68c0\u67e5\u5f02\u5e38\uff1a Java \u8bed\u8a00\u5c06\u6d3e\u751f\u4e8e <code>RuntimeException</code> \u7c7b\u6216 <code>Error</code> \u7c7b\u7684\u6240\u6709\u5f02\u5e38\u79f0\u4e3a\u975e\u68c0\u67e5\u6027\u5f02\u5e38\u3002</p> <p></p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/#java_3","title":"Java \u4e2d\u7684\u5f02\u5e38\u5904\u7406","text":"<p>\u6709\u4e24\u79cd\u65b9\u6cd5\u53ef\u4ee5\u5904\u7406\u629b\u51fa\u7684\u5f02\u5e38\uff1a</p> <ol> <li> <p>\u5728\u5f53\u524d\u65b9\u6cd5\u4e2d\u901a\u8fc7 <code>try-catch</code> \u7684\u65b9\u5f0f\u5904\u7406\u8be5\u5f02\u5e38\u3002</p> </li> <li> <p>\u5728\u65b9\u6cd5\u7b7e\u540d\u7684\u540e\u9762\u901a\u8fc7 <code>throws</code> \u91cd\u65b0\u629b\u51fa\u8be5\u5f02\u5e38\u3002</p> </li> </ol> <p></p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/#java_4","title":"Java \u4e2d\u7684\u5f02\u5e38\u5206\u7c7b","text":"<p>\u6211\u4eec\u53ef\u4ee5\u5c06\u6240\u6709\u7684\u5f02\u5e38\u5206\u4e3a\u4e09\u7c7b\uff1a</p> <ul> <li>\u68c0\u67e5\u6027\u5f02\u5e38(checked exceptions) \u662f\u5fc5\u987b\u5728\u5728\u65b9\u6cd5\u7684 throws \u5b50\u53e5\u4e2d\u58f0\u660e\u7684\u5f02\u5e38\u3002\u5b83\u4eec\u6269\u5c55\u4e86\u5f02\u5e38\uff0c\u65e8\u5728\u6210\u4e3a\u4e00\u79cd\u201c\u5728\u4f60\u9762\u524d\u201d\u7684\u5f02\u5e38\u7c7b\u578b\u3002JAVA\u5e0c\u671b\u4f60\u80fd\u591f\u5904\u7406\u5b83\u4eec\uff0c\u56e0\u4e3a\u5b83\u4eec\u4ee5\u67d0\u79cd\u65b9\u5f0f\u4f9d\u8d56\u4e8e\u7a0b\u5e8f\u4e4b\u5916\u7684\u5916\u90e8\u56e0\u7d20\u3002\u68c0\u67e5\u7684\u5f02\u5e38\u8868\u793a\u5728\u6b63\u5e38\u7cfb\u7edf\u64cd\u4f5c\u671f\u95f4\u53ef\u80fd\u53d1\u751f\u7684\u9884\u671f\u95ee\u9898\u3002 \u5f53\u4f60\u5c1d\u8bd5\u901a\u8fc7\u7f51\u7edc\u6216\u6587\u4ef6\u7cfb\u7edf\u4f7f\u7528\u5916\u90e8\u7cfb\u7edf\u65f6\uff0c\u901a\u5e38\u4f1a\u53d1\u751f\u8fd9\u4e9b\u5f02\u5e38\u3002 \u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u5bf9\u68c0\u67e5\u6027\u5f02\u5e38\u7684\u6b63\u786e\u54cd\u5e94\u5e94\u8be5\u662f\u7a0d\u540e\u91cd\u8bd5\uff0c\u6216\u8005\u63d0\u793a\u7528\u6237\u4fee\u6539\u5176\u8f93\u5165\u3002</li> <li>\u975e\u68c0\u67e5\u6027\u5f02\u5e38(unchecked Exceptions) \u662f\u4e0d\u9700\u8981\u5728throws\u5b50\u53e5\u4e2d\u58f0\u660e\u7684\u5f02\u5e38\u3002 \u7531\u4e8e\u7a0b\u5e8f\u9519\u8bef\uff0cJVM\u5e76\u4e0d\u4f1a\u5f3a\u5236\u4f60\u5904\u7406\u5b83\u4eec\uff0c\u56e0\u4e3a\u5b83\u4eec\u5927\u591a\u6570\u662f\u5728\u8fd0\u884c\u65f6\u751f\u6210\u7684\u3002 \u5b83\u4eec\u6269\u5c55\u4e86 RuntimeException\u3002 \u6700\u5e38\u89c1\u7684\u4f8b\u5b50\u662f NullPointerException\uff0c \u672a\u7ecf\u68c0\u67e5\u7684\u5f02\u5e38\u53ef\u80fd\u4e0d\u5e94\u8be5\u91cd\u8bd5\uff0c\u6b63\u786e\u7684\u64cd\u4f5c\u901a\u5e38\u5e94\u8be5\u662f\u4ec0\u4e48\u90fd\u4e0d\u505a\uff0c\u5e76\u8ba9\u5b83\u4ece\u4f60\u7684\u65b9\u6cd5\u548c\u6267\u884c\u5806\u6808\u4e2d\u51fa\u6765\u3002</li> <li>\u9519\u8bef(errors) \u662f\u4e25\u91cd\u7684\u8fd0\u884c\u65f6\u73af\u5883\u95ee\u9898\uff0c\u80af\u5b9a\u65e0\u6cd5\u6062\u590d\u3002 \u4f8b\u5982 <code>OutOfMemoryError</code>\uff0c<code>LinkageError</code> \u548c <code>StackOverflowError</code>\uff0c\u901a\u5e38\u4f1a\u8ba9\u7a0b\u5e8f\u5d29\u6e83\u3002</li> </ul> <p>\u4e86\u89e3\u5f02\u5e38\u7c7b\u7684\u7c7b\u578b\u540e\uff0c\u6211\u4eec\u53ef\u80fd\u9700\u8981\u56de\u7b54\u4ee5\u4e0b\u95ee\u9898\uff1a</p> <ul> <li>\u5f02\u5e38\u60c5\u51b5\u6709\u591a\u7cdf\u7cd5\u4ee5\u53ca\u5f02\u5e38\u7684\u539f\u56e0\u662f\u4ec0\u4e48\uff1f</li> <li>\u5982\u4f55\u89e3\u51b3\u8fd9\u4e2a\u5f02\u5e38\uff1f</li> <li>\u6211\u4eec\u9700\u8981\u91cd\u542fJVM\u5417\uff1f</li> <li>\u6211\u4eec\u9700\u8981\u91cd\u5199\u4ee3\u7801\u5417\uff1f</li> </ul> <p>\u77e5\u9053\u5f02\u5e38\u7c7b\uff0c\u6211\u4eec\u53ef\u4ee5\u9884\u6d4b\u53ef\u80fd\u51fa\u9519\u7684\u5730\u65b9\u3002\u8003\u8651\u6f5c\u5728\u7684\u539f\u56e0\uff0c\u6211\u4eec\u53ef\u4ee5\u5047\u8bbe\u95ee\u9898\u7684\u539f\u56e0\u662f\u4ec0\u4e48\u4ee5\u53ca\u5982\u4f55\u89e3\u51b3\u5b83\u3002\u5728\u63a5\u4e0b\u6765\u7684\u6bb5\u843d\u4e2d\uff0c\u6211\u4eec\u5c06\u56de\u987e\u5e38\u89c1\u7684\u5f02\u5e38\u5e76\u8c03\u67e5\u6f5c\u5728\u7684\u539f\u56e0\u662f\u4ec0\u4e48\u3002\u5728\u6211\u4eec\u7684\u8c03\u67e5\u4e2d\uff0c\u6211\u4eec\u5047\u8bbe\u5e94\u7528\u7a0b\u5e8f\u8db3\u591f\u7a33\u5b9a\u5e76\u4e14\u5df2\u7ecf\u5b8c\u6210\u5f00\u53d1\u548c\u6d4b\u8bd5\u3002</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/#error","title":"\u5e38\u89c1 Error \u5f02\u5e38","text":"\u5f02\u5e38\u7c7b\u578b \u6f5c\u5728\u539f\u56e0 \u539f\u56e0\u7684\u53ef\u80fd\u6027\u6709\u591a\u5927 \u600e\u4e48\u4fee\u590d \u9700\u8981\u91cd\u5199\u4ee3\u7801\u5417\uff1f\u00a0 \u9700\u8981\u91cd\u542fJVM\u5417\uff1f OutOfMemoryError \u5e94\u7528\u7a0b\u5e8f\u5403\u6389\u4e86\u6240\u6709\u5185\u5b58 \u9ad8\u7684 \u589e\u52a0\u5806\u5185\u5b58\u5927\u5c0f \u4e0d \u662f\u7684 \u5185\u5b58\u6cc4\u6f0f \u4f4e\u7684 \u67e5\u627e\u5185\u5b58\u6cc4\u6f0f\u5e76\u4fee\u590d \u662f\u7684 \u662f\u7684 StackOverflowError \u5806\u6808\u5185\u5b58\u4e0d\u8db3 \u9ad8\u7684 \u589e\u52a0\u5806\u6808\u5185\u5b58\u5927\u5c0f \u4e0d \u662f\u7684 \u65e0\u9650\u9012\u5f52 \u4f4e\u7684 \u8bbe\u7f6e\u9012\u5f52\u8c03\u7528\u7684\u9650\u5236 \u662f\u7684 \u662f\u7684 NoClassDefFoundError \u7f3a\u5c11\u4f9d\u8d56\u00a0 \u9ad8\u7684 \u6dfb\u52a0\u4f9d\u8d56\u6216\u4fee\u590d\u4f9d\u8d56\u914d\u7f6e \u4e0d \u662f\u7684 \u521d\u59cb\u5316\u671f\u95f4\u52a0\u8f7d\u7c7b\u5931\u8d25 \u4f4e\u7684 \u66f4\u6539\u521d\u59cb\u5316\u8fc7\u7a0b \u662f\u7684 \u662f\u7684 <p>\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u9700\u8981\u505a\u7684\u5c31\u662f\u66f4\u6539 JVM \u914d\u7f6e\u6216\u6dfb\u52a0\u7f3a\u5c11\u7684\u4f9d\u8d56\u9879\uff0c\u4ecd\u7136\u5b58\u5728\u9700\u8981\u66f4\u6539\u4ee3\u7801\u7684\u60c5\u51b5\uff0c\u4f46\u5b83\u4eec\u4e0d\u592a\u53ef\u80fd\u5728\u6bcf\u79cd\u60c5\u51b5\u4e0b\u66f4\u6539\u3002</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/#runtime","title":"\u5e38\u89c1 Runtime \u5f02\u5e38","text":"\u5f02\u5e38\u7c7b\u578b \u6f5c\u5728\u539f\u56e0 \u539f\u56e0\u7684\u53ef\u80fd\u6027\u6709\u591a\u5927 \u600e\u4e48\u4fee\u590d \u9700\u8981\u91cd\u5199\u4ee3\u7801\u5417\uff1f\u00a0 \u9700\u8981\u91cd\u542f\u5417\uff1f NullPointerException \u00a0\u9884\u671f\u7684\u4e0d\u53ef\u4e3a\u7a7a\u7684\u5bf9\u8c61\u4e3a\u7a7a \u9ad8\u7684 \u8c03\u7528\u524d\u6dfb\u52a0\u9a8c\u8bc1\u5c42 \u662f\u7684 \u662f\u7684 \u67d0\u4e9b\u8d44\u6e90\u4e0d\u53ef\u7528\u5e76\u8fd4\u56de\u7a7a\u6570\u636e \u4e2d\u7b49\u7684 \u8c03\u7528\u524d\u6dfb\u52a0\u9a8c\u8bc1\u5c42 \u662f\u7684 \u662f\u7684 ConcurrentModificationException \u8fed\u4ee3\u671f\u95f4\u96c6\u5408\u5df2\u66f4\u6539 \u9ad8\u7684 \u5206\u522b\u8fdb\u884c\u96c6\u5408\u8fed\u4ee3\u548c\u4fee\u6539 \u662f\u7684 \u662f\u7684 \u96c6\u5408\u5728\u8fed\u4ee3\u671f\u95f4\u5df2\u4ece\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u66f4\u6539 \u9ad8\u7684 \u4e3a\u96c6\u5408\u6dfb\u52a0\u540c\u6b65 \u662f\u7684 \u662f\u7684 IlliegalArgumentException \u4f20\u9012\u7684\u53c2\u6570\u65e0\u6548 \u9ad8\u7684 \u5728\u4f20\u9012\u53c2\u6570\u4e4b\u524d\u6dfb\u52a0\u9a8c\u8bc1 \u662f\u7684 \u662f\u7684 NumberFormatException \u4f20\u9012\u7684\u53c2\u6570\u683c\u5f0f\u9519\u8bef\u6216\u7b26\u53f7\u9519\u8bef \u9ad8\u7684 \u5728\u4f20\u9012\u6570\u636e\u4e4b\u524d\u6dfb\u52a0\u683c\u5f0f\u6216\u5220\u9664\u4e0d\u53ef\u89c1\u7b26\u53f7 \u662f\u7684 \u662f\u7684 ArrayIndexOutOfBoundsException \u6307\u4ee4\u8bd5\u56fe\u901a\u8fc7\u4e0d\u5b58\u5728\u7684\u7d22\u5f15\u8bbf\u95ee\u5355\u5143\u683c \u9ad8\u7684 \u5c06\u8bbf\u95ee\u903b\u8f91\u66f4\u6539\u4e3a\u6b63\u786e\u7684\u903b\u8f91 \u662f\u7684 \u662f\u7684 NoSuchElementException \u5f53\u6307\u9488\u5df2\u7ecf\u6539\u53d8\u4f4d\u7f6e\u65f6\u8bbf\u95ee\u5143\u7d20 \u9ad8\u7684 \u5c06\u8bbf\u95ee\u903b\u8f91\u66f4\u6539\u4e3a\u6b63\u786e\u7684\u903b\u8f91 \u662f\u7684 \u662f\u7684 \u96c6\u5408\u5728\u8fed\u4ee3\u8fc7\u7a0b\u4e2d\u88ab\u4fee\u6539 \u9ad8\u7684 \u4e3a\u96c6\u5408\u6dfb\u52a0\u540c\u6b65 \u662f\u7684 \u662f\u7684 <p>Checked \u548c Error \u5f02\u5e38\u9519\u8bef\u4e0d\u4f1a\u5bfc\u81f4\u4efb\u4f55\u4ee3\u7801\u66f4\u6539\uff0c\u4f46\u662f\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u8fd0\u884c\u65f6\u5f02\u5e38\u7a81\u51fa\u4e86\u4ee3\u7801\u4e2d\u7684\u771f\u6b63\u95ee\u9898\uff0c\u5982\u679c\u4e0d\u91cd\u5199\u4ee3\u7801\u5c31\u65e0\u6cd5\u4fee\u590d\u8fd9\u4e9b\u95ee\u9898\u3002</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/#checked","title":"\u5e38\u89c1 Checked \u5f02\u5e38","text":"\u5f02\u5e38\u7c7b\u578b      \u6f5c\u5728\u539f\u56e0 \u539f\u56e0\u7684\u53ef\u80fd\u6027\u6709\u591a\u5927 \u600e\u4e48\u4fee\u590d \u9700\u8981\u91cd\u5199\u4ee3\u7801\u5417\uff1f\u00a0 \u9700\u8981\u91cd\u542f\u5417\uff1f FileNotFoundException \u8be5\u6587\u4ef6\u4e0d\u5b58\u5728 \u9ad8\u7684 \u521b\u5efa\u6587\u4ef6 \u4e0d \u4e0d \u5e94\u7528\u7a0b\u5e8f\u8c03\u7528\u9519\u8bef\u7684\u8def\u5f84 \u4f4e\u7684 \u4fee\u590d\u9519\u8bef\u7684\u8def\u5f84\u751f\u6210 \u662f\u7684 \u662f\u7684 IOException \u8bbf\u95ee\u8d44\u6e90\u65e0\u6548 \u9ad8\u7684 \u8ba9\u8d44\u6e90\u518d\u6b21\u53ef\u7528 \u4e0d \u4e0d ClassNotFoundException \u8be5\u7c7b\u672a\u6dfb\u52a0\u4f9d\u8d56\u9879 \u9ad8\u7684 \u6dfb\u52a0\u7f3a\u5c11\u7684\u4f9d\u8d56\u9879 \u4e0d \u662f\u7684 \u5b9e\u73b0\u8c03\u7528\u4e86\u9519\u8bef\u7684\u7c7b\u00a0 \u4e2d\u7b49\u7684 \u66f4\u6539\u7c7b\u8c03\u7528 \u662f\u7684 \u662f\u7684 SqlException \u67b6\u6784\u4e0e\u67e5\u8be2\u4e0d\u5339\u914d \u9ad8\u7684 \u5c06\u7f3a\u5931\u7684\u811a\u672c\u5e94\u7528\u5230\u6570\u636e\u5e93 \u4e0d \u4e0d \u67e5\u8be2\u9519\u8bef \u4f4e\u7684 \u66f4\u6539\u67e5\u8be2 \u662f\u7684 \u662f\u7684 \u62d2\u7edd\u8fde\u63a5 \u9ad8\u7684 \u6253\u5f00\u6570\u636e\u5e93\uff0c\u66f4\u6539\u7aef\u53e3 \u4e0d \u4e0d InterruptedException \u4f9d\u8d56\u7ebf\u7a0b\u901a\u77e5\u4e2d\u65ad\uff08\u9501\u91ca\u653e\uff0c\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u5b8c\u6210\u64cd\u4f5c\uff09 \u9ad8\u7684 \u6ca1\u6709\u5fc5\u8981\u4fee\u590d\u5b83\uff1b\u8fd9\u662f\u4e00\u79cd\u901a\u77e5\u76f8\u5173\u7ebf\u7a0b\u4e2d\u4e8b\u4ef6\u7684\u65b9\u6cd5 \u4e0d \u4e0d \u53e6\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u65ad\u5e76\u4f7f\u7528\u4e2d\u65ad\u901a\u77e5\u76f8\u5173 \u4e2d\u7b49\u7684 \u4fee\u590d\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u51fa\u73b0\u7684\u95ee\u9898\uff08\u53ef\u4ee5\u662f\u4efb\u4f55\u4e1c\u897f\uff09 \u662f\u7684 \u662f\u7684 SocketException \u7aef\u53e3\u88ab\u5360\u7528\u00a0 \u9ad8\u7684 \u6253\u5f00/\u91ca\u653e\u7aef\u53e3 \u4e0d \u4e0d \u670d\u52a1\u5668\u65ad\u5f00\u8fde\u63a5 \u9ad8\u7684 \u68c0\u67e5\u7f51\u7edc\u8fde\u63a5 \u00a0 \u4e0d \u4e0d <p>\u5982\u679c\u6211\u4eec\u67e5\u770b\u6700\u53ef\u80fd\u7684\u539f\u56e0\uff0c\u6211\u4eec\u4f1a\u53d1\u73b0\u5176\u4e2d\u7684\u5927\u591a\u6570 \u4e0d\u4ec5\u4e0d\u9700\u8981\u4efb\u4f55\u4ee3\u7801\u66f4\u6539\uff0c\u751a\u81f3\u4e0d\u9700\u8981\u91cd\u65b0\u542f\u52a8\u5e94\u7528\u7a0b\u5e8f\u3002</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/#java_5","title":"Java \u5f02\u5e38\u5904\u7406\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"java/Java%E5%BC%82%E5%B8%B8/#1","title":"1. \u4e0d\u8981\u5ffd\u7565\u6355\u83b7\u7684\u5f02\u5e38","text":"<pre><code>Copycatch (NoSuchMethodException e) {\n   return null;\n}\n</code></pre> <p>\u867d\u7136\u6355\u83b7\u4e86\u5f02\u5e38\u4f46\u662f\u5374\u6ca1\u6709\u505a\u4efb\u4f55\u5904\u7406\uff0c\u9664\u975e\u4f60\u786e\u4fe1\u8fd9\u4e2a\u5f02\u5e38\u53ef\u4ee5\u5ffd\u7565\uff0c\u4e0d\u7136\u4e0d\u5e94\u8be5\u8fd9\u6837\u505a\uff0c\u8fd9\u6837\u4f1a\u5bfc\u81f4\u5916\u9762\u65e0\u6cd5\u77e5\u6653\u8be5\u65b9\u6cd5\u53d1\u751f\u4e86\u9519\u8bef\uff0c\u65e0\u6cd5\u5b9a\u4f4d\u9519\u8bef\u539f\u56e0\u3002</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/#2","title":"2. \u5728\u4f60\u7684\u65b9\u6cd5\u91cc\u629b\u51fa\u5177\u4f53\u7684\u68c0\u67e5\u6027\u5f02\u5e38","text":"<pre><code>Copypublic void foo() throws Exception { //\u9519\u8bef\u65b9\u5f0f\n}\n</code></pre> <p>\u4e00\u5b9a\u8981\u907f\u514d\u51fa\u73b0\u4e0a\u9762\u7684\u4ee3\u7801\u793a\u4f8b\uff0c\u5b83\u7834\u574f\u4e86\u68c0\u67e5\u6027\u5f02\u5e38\u7684\u76ee\u7684\u3002 \u58f0\u660e\u4f60\u7684\u65b9\u6cd5\u53ef\u80fd\u629b\u51fa\u7684\u5177\u4f53\u68c0\u67e5\u6027\u5f02\u5e38\uff0c\u5982\u679c\u6709\u592a\u591a\u8fd9\u6837\u7684\u68c0\u67e5\u6027\u5f02\u5e38\uff0c\u4f60\u5e94\u8be5\u628a\u5b83\u4eec\u5305\u88c5\u5728\u4f60\u81ea\u5df1\u7684\u5f02\u5e38\u4e2d\uff0c\u5e76\u5728\u5f02\u5e38\u6d88\u606f\u4e2d\u6dfb\u52a0\u4fe1\u606f\u3002 \u5982\u679c\u53ef\u80fd\u7684\u8bdd\uff0c\u4f60\u4e5f\u53ef\u4ee5\u8003\u8651\u4ee3\u7801\u91cd\u6784\u3002</p> <pre><code>Copypublic void foo() throws SpecificException1, SpecificException2 { //\u6b63\u786e\u65b9\u5f0f\n}\n</code></pre>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/#3-exception","title":"3. \u6355\u83b7\u5177\u4f53\u7684\u5b50\u7c7b\u800c\u4e0d\u662f\u6355\u83b7 Exception \u7c7b","text":"<pre><code>Copytry {\n   someMethod();\n} catch (Exception e) { //\u9519\u8bef\u65b9\u5f0f\n   LOGGER.error(\"method has failed\", e);\n}\n</code></pre> <p>\u6355\u83b7 <code>Exception</code> \u7684\u95ee\u9898\u662f\uff0c\u5982\u679c\u7a0d\u540e\u8c03\u7528\u7684\u65b9\u6cd5\u4e3a\u5176\u65b9\u6cd5\u58f0\u660e\u6dfb\u52a0\u4e86\u65b0\u7684\u68c0\u67e5\u6027\u5f02\u5e38\uff0c\u5219\u5f00\u53d1\u4eba\u5458\u7684\u610f\u56fe\u662f\u5e94\u8be5\u5904\u7406\u5177\u4f53\u7684\u65b0\u5f02\u5e38\uff0c\u4f46\u662f\u4f60\u7684\u4ee3\u7801\u53ea\u662f\u6355\u83b7  <code>Exception</code> \uff08\u6216 <code>Throwable</code>\uff09\uff0c\u90a3\u4e48\u6c38\u8fdc\u4e0d\u4f1a\u77e5\u9053\u8fd9\u4e2a\u65b0\u7684\u5f02\u5e38\uff0c\u5e76\u4e14\u4f60\u7684\u7a0b\u5e8f\u53ef\u80fd\u4f1a\u5728\u8fd0\u884c\u65f6\u7684\u4efb\u4f55\u65f6\u5019\u4e2d\u65ad\u3002</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/#3-throwable","title":"3. \u6c38\u8fdc\u4e0d\u8981\u6355\u83b7 Throwable \u7c7b","text":"<p>\u8fd9\u662f\u4e00\u4e2a\u66f4\u4e25\u91cd\u7684\u95ee\u9898\uff0c\u56e0\u4e3a <code>Error</code> \u4e5f\u662f <code>Throwable</code> \u7684\u5b50\u7c7b\uff0c<code>Error</code> \u662f JVM \u672c\u8eab\u65e0\u6cd5\u5904\u7406\u7684\u4e0d\u53ef\u9006\u8f6c\u7684\u9519\u8bef\uff0c\u5bf9\u4e8e\u67d0\u4e9b JVM \u7684\u5b9e\u73b0\uff0cJVM \u53ef\u80fd\u5b9e\u9645\u4e0a\u751a\u81f3\u4e0d\u4f1a\u5728 Error \u4e0a\u8c03\u7528 catch \u5b50\u53e5\u3002</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/#4","title":"4. \u59cb\u7ec8\u6b63\u786e\u5305\u88c5\u81ea\u5b9a\u4e49\u5f02\u5e38\u4e2d\u7684\u5f02\u5e38\uff0c\u4ee5\u4fbf\u5806\u6808\u8ddf\u8e2a\u4e0d\u4f1a\u4e22\u5931","text":"<pre><code>Copycatch (NoSuchMethodException e) {\n   throw new MyServiceException(\"Some information: \" + e.getMessage());  //\u9519\u8bef\u65b9\u5f0f\n}\n</code></pre> <p>\u8fd9\u7834\u574f\u4e86\u539f\u59cb\u5f02\u5e38\u7684\u5806\u6808\u8ddf\u8e2a\uff0c\u5e76\u4e14\u59cb\u7ec8\u662f\u9519\u8bef\u7684\uff0c\u6b63\u786e\u7684\u505a\u6cd5\u662f\uff1a</p> <pre><code>Copycatch (NoSuchMethodException e) {\n   throw new MyServiceException(\"Some information: \" , e);  //\u6b63\u786e\u65b9\u5f0f\n}\n</code></pre>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/#5","title":"5. \u8981\u4e48\u8bb0\u5f55\u5f02\u5e38\u8981\u4e48\u629b\u51fa\u5f02\u5e38\uff0c\u4f46\u4e0d\u8981\u4e00\u8d77\u6267\u884c","text":"<pre><code>Copycatch (NoSuchMethodException e) {  \n    //\u9519\u8bef\u65b9\u5f0f \n   LOGGER.error(\"Some information\", e);\n   throw e;\n}\n</code></pre> <p>\u6b63\u5982\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\uff0c\u8bb0\u5f55\u548c\u629b\u51fa\u5f02\u5e38\u4f1a\u5728\u65e5\u5fd7\u6587\u4ef6\u4e2d\u4ea7\u751f\u591a\u6761\u65e5\u5fd7\u6d88\u606f\uff0c\u4ee3\u7801\u4e2d\u5b58\u5728\u5355\u4e2a\u95ee\u9898\uff0c\u5e76\u4e14\u5bf9\u5c1d\u8bd5\u5206\u6790\u65e5\u5fd7\u7684\u540c\u4e8b\u5f88\u4e0d\u53cb\u597d\u3002</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/#6-finally","title":"6. finally \u5757\u4e2d\u6c38\u8fdc\u4e0d\u8981\u629b\u51fa\u4efb\u4f55\u5f02\u5e38","text":"<pre><code>Copytry {\n  someMethod();  //Throws exceptionOne\n} finally {\n  cleanUp();    //\u5982\u679cfinally\u8fd8\u629b\u51fa\u5f02\u5e38\uff0c\u90a3\u4e48exceptionOne\u5c06\u6c38\u8fdc\u4e22\u5931\n}\n</code></pre> <p>\u53ea\u8981 <code>cleanUp()</code> \u6c38\u8fdc\u4e0d\u4f1a\u629b\u51fa\u4efb\u4f55\u5f02\u5e38\uff0c\u4e0a\u9762\u7684\u4ee3\u7801\u6ca1\u6709\u95ee\u9898\uff0c\u4f46\u662f\u5982\u679c <code>someMethod()</code> \u629b\u51fa\u4e00\u4e2a\u5f02\u5e38\uff0c\u5e76\u4e14\u5728 <code>finally</code> \u5757\u4e2d\uff0c<code>cleanUp()</code> \u4e5f\u629b\u51fa\u53e6\u4e00\u4e2a\u5f02\u5e38\uff0c\u90a3\u4e48\u7a0b\u5e8f\u53ea\u4f1a\u628a\u7b2c\u4e8c\u4e2a\u5f02\u5e38\u629b\u51fa\u6765\uff0c\u539f\u6765\u7684\u7b2c\u4e00\u4e2a\u5f02\u5e38\uff08\u6b63\u786e\u7684\u539f\u56e0\uff09\u5c06\u6c38\u8fdc\u4e22\u5931\u3002\u5982\u679c\u5728 <code>finally</code> \u5757\u4e2d\u8c03\u7528\u7684\u4ee3\u7801\u53ef\u80fd\u4f1a\u5f15\u53d1\u5f02\u5e38\uff0c\u8bf7\u786e\u4fdd\u8981\u4e48\u5904\u7406\u5b83\uff0c\u8981\u4e48\u5c06\u5176\u8bb0\u5f55\u4e0b\u6765\uff0c\u6c38\u8fdc\u4e0d\u8981\u8ba9\u5b83\u4ece finally \u5757\u4e2d\u629b\u51fa\u6765\u3002</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/#7","title":"7. \u59cb\u7ec8\u53ea\u6355\u83b7\u5b9e\u9645\u53ef\u5904\u7406\u7684\u5f02\u5e38","text":"<pre><code>Copycatch (NoSuchMethodException e) {\n   throw e; //\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\uff0c\u56e0\u4e3a\u5b83\u6ca1\u6709\u4efb\u4f55\u5e2e\u52a9\n}\n</code></pre> <p>\u8fd9\u662f\u6700\u91cd\u8981\u7684\u6982\u5ff5\uff0c\u4e0d\u8981\u4e3a\u4e86\u6355\u83b7\u5f02\u5e38\u800c\u6355\u83b7\uff0c\u53ea\u6709\u5728\u60f3\u8981\u5904\u7406\u5f02\u5e38\u65f6\u624d\u6355\u83b7\u5f02\u5e38\uff0c\u6216\u8005\u5e0c\u671b\u5728\u8be5\u5f02\u5e38\u4e2d\u63d0\u4f9b\u5176\u4ed6\u4e0a\u4e0b\u6587\u4fe1\u606f\u3002\u5982\u679c\u4f60\u4e0d\u80fd\u5728 catch \u5757\u4e2d\u5904\u7406\u5b83\uff0c\u90a3\u4e48\u6700\u597d\u7684\u5efa\u8bae\u5c31\u662f\u4e0d\u8981\u53ea\u4e3a\u4e86\u91cd\u65b0\u629b\u51fa\u5b83\u800c\u6355\u83b7\u5b83\u3002</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/#8-printstacktrace","title":"8. \u4e0d\u8981\u4f7f\u7528 printStackTrace() \u8bed\u53e5\u6216\u7c7b\u4f3c\u7684\u65b9\u6cd5","text":"<p>\u5b8c\u6210\u4ee3\u7801\u540e\uff0c\u5207\u52ff\u5ffd\u7565 <code>printStackTrace()</code>\uff0c\u6700\u7ec8\u522b\u4eba\u53ef\u80fd\u4f1a\u5f97\u5230\u8fd9\u4e9b\u5806\u6808\uff0c\u5e76\u4e14\u5bf9\u4e8e\u5982\u4f55\u5904\u7406\u5b83\u5b8c\u5168\u6ca1\u6709\u4efb\u4f55\u5e2e\u52a9\uff0c\u56e0\u4e3a\u5b83\u4e0d\u4f1a\u9644\u52a0\u4efb\u4f55\u4e0a\u4e0b\u6587\u4fe1\u606f\u3002</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/#9-finally","title":"9. \u5bf9\u4e8e\u4e0d\u6253\u7b97\u5904\u7406\u7684\u5f02\u5e38\uff0c\u76f4\u63a5\u4f7f\u7528 finally","text":"<pre><code>Copytry {\n  someMethod();  //Method 2\n} finally {\n  cleanUp();    //do cleanup here\n}\n</code></pre> <p>\u8fd9\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u505a\u6cd5\uff0c\u5982\u679c\u5728\u4f60\u7684\u65b9\u6cd5\u4e2d\u4f60\u6b63\u5728\u8bbf\u95ee Method 2\uff0c\u800c Method 2 \u629b\u51fa\u4e00\u4e9b\u4f60\u4e0d\u60f3\u5728 Method 1 \u4e2d\u5904\u7406\u7684\u5f02\u5e38\uff0c\u4f46\u662f\u4ecd\u7136\u5e0c\u671b\u5728\u53d1\u751f\u5f02\u5e38\u65f6\u8fdb\u884c\u4e00\u4e9b\u6e05\u7406\uff0c\u7136\u540e\u5728 finally \u5757\u4e2d\u8fdb\u884c\u6e05\u7406\uff0c\u4e0d\u8981\u4f7f\u7528 catch \u5757\u3002</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/#10-throw-catch","title":"10. \u8bb0\u4f4f\u65e9 throw \u665a catch \u539f\u5219","text":"<p>\u8fd9\u53ef\u80fd\u662f\u5173\u4e8e\u5f02\u5e38\u5904\u7406\u6700\u8457\u540d\u7684\u539f\u5219\uff0c\u7b80\u5355\u8bf4\uff0c\u5e94\u8be5\u5c3d\u5feb\u629b\u51fa(throw)\u5f02\u5e38\uff0c\u5e76\u5c3d\u53ef\u80fd\u665a\u5730\u6355\u83b7(catch)\u5b83\u3002\u5e94\u8be5\u7b49\u5230\u6709\u8db3\u591f\u7684\u4fe1\u606f\u6765\u59a5\u5584\u5904\u7406\u5b83\u3002</p> <p>\u8fd9\u4e2a\u539f\u5219\u9690\u542b\u5730\u8bf4\uff0c\u4f60\u5c06\u66f4\u6709\u53ef\u80fd\u628a\u5b83\u653e\u5728\u4f4e\u7ea7\u65b9\u6cd5\u4e2d\uff0c\u5728\u90a3\u91cc\u4f60\u5c06\u68c0\u67e5\u5355\u4e2a\u503c\u662f\u5426\u4e3a\u7a7a\u6216\u4e0d\u9002\u5408\u3002\u800c\u4e14\u4f60\u4f1a\u8ba9\u5f02\u5e38\u5806\u6808\u8ddf\u8e2a\u4e0a\u5347\u597d\u51e0\u4e2a\u7ea7\u522b\uff0c\u76f4\u5230\u8fbe\u5230\u8db3\u591f\u7684\u62bd\u8c61\u7ea7\u522b\u624d\u80fd\u5904\u7406\u95ee\u9898\u3002</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/#11","title":"11. \u5728\u5f02\u5e38\u5904\u7406\u540e\u6e05\u7406\u8d44\u6e90","text":"<p>\u5982\u679c\u4f60\u6b63\u5728\u4f7f\u7528\u6570\u636e\u5e93\u8fde\u63a5\u6216\u7f51\u7edc\u8fde\u63a5\u7b49\u8d44\u6e90\uff0c\u8bf7\u786e\u4fdd\u5173\u95ed\u5b83\u4eec\u3002\u5982\u679c\u4f60\u6b63\u5728\u8c03\u7528\u7684 API \u4ec5\u4f7f\u7528\u975e\u68c0\u67e5\u6027\u5f02\u5e38\uff0c\u5219\u4ecd\u5e94\u4f7f\u7528 try-finally \u5757\u6765\u6e05\u7406\u8d44\u6e90\u3002 \u5728 try \u6a21\u5757\u91cc\u9762\u8bbf\u95ee\u8d44\u6e90\uff0c\u5728 finally \u91cc\u9762\u6700\u540e\u5173\u95ed\u8d44\u6e90\u3002\u5373\u4f7f\u5728\u8bbf\u95ee\u8d44\u6e90\u65f6\u53d1\u751f\u4efb\u4f55\u5f02\u5e38\uff0c\u8d44\u6e90\u4e5f\u4f1a\u4f18\u96c5\u5730\u5173\u95ed\u3002</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/#12","title":"12. \u53ea\u629b\u51fa\u548c\u65b9\u6cd5\u76f8\u5173\u7684\u5f02\u5e38","text":"<p>\u76f8\u5173\u6027\u5bf9\u4e8e\u5e94\u7528\u7a0b\u5e8f\u6392\u67e5\u95ee\u9898\u975e\u5e38\u91cd\u8981\u3002\u4e00\u79cd\u5c1d\u8bd5\u8bfb\u53d6\u6587\u4ef6\u7684\u65b9\u6cd5\uff0c\u5982\u679c\u629b\u51fa <code>NullPointerException</code>\uff0c\u90a3\u4e48\u5b83\u4e0d\u4f1a\u7ed9\u7528\u6237\u4efb\u4f55\u76f8\u5173\u7684\u4fe1\u606f\u3002\u76f8\u53cd\uff0c\u5982\u679c\u8fd9\u79cd\u5f02\u5e38\u88ab\u5305\u88f9\u5728\u81ea\u5b9a\u4e49\u5f02\u5e38\u4e2d\uff0c\u5219\u4f1a\u66f4\u597d\uff0c<code>NoSuchFileFoundException</code> \u5219\u5bf9\u8be5\u65b9\u6cd5\u7684\u7528\u6237\u66f4\u6709\u7528\u3002</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/#13","title":"13. \u5207\u52ff\u5728\u7a0b\u5e8f\u4e2d\u4f7f\u7528\u5f02\u5e38\u6765\u8fdb\u884c\u6d41\u7a0b\u63a7\u5236","text":"<p>\u4e0d\u8981\u5728\u9879\u76ee\u4e2d\u51fa\u73b0\u4f7f\u7528\u5f02\u5e38\u6765\u5904\u7406\u5e94\u7528\u7a0b\u5e8f\u903b\u8f91\uff0c\u6c38\u8fdc\u4e0d\u8981\u8fd9\u6837\u505a\uff0c\u5b83\u4f1a\u4f7f\u4ee3\u7801\u5f88\u96be\u9605\u8bfb\u548c\u7406\u89e3\u3002</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/#14","title":"14. \u5c3d\u65e9\u9a8c\u8bc1\u7528\u6237\u8f93\u5165\u4ee5\u5728\u8bf7\u6c42\u5904\u7406\u7684\u65e9\u671f\u6355\u83b7\u5f02\u5e38","text":"<p>\u59cb\u7ec8\u8981\u5728\u975e\u5e38\u65e9\u7684\u9636\u6bb5\u9a8c\u8bc1\u7528\u6237\u8f93\u5165\uff0c\u751a\u81f3\u5728\u8fbe\u5230 <code>controller</code> \u4e4b\u524d\uff0c\u5b83\u5c06\u5e2e\u52a9\u4f60\u628a\u6838\u5fc3\u5e94\u7528\u7a0b\u5e8f\u903b\u8f91\u4e2d\u7684\u5f02\u5e38\u5904\u7406\u4ee3\u7801\u91cf\u964d\u5230\u6700\u4f4e\u3002\u5982\u679c\u7528\u6237\u8f93\u5165\u51fa\u73b0\u9519\u8bef\uff0c\u8fd8\u53ef\u4ee5\u4fdd\u8bc1\u4e0e\u5e94\u7528\u7a0b\u5e8f\u4e00\u81f4\u3002</p> <p>\u4f8b\u5982\uff1a\u5982\u679c\u5728\u7528\u6237\u6ce8\u518c\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u9075\u5faa\u4ee5\u4e0b\u903b\u8f91\uff1a</p> <ol> <li>\u9a8c\u8bc1\u7528\u6237</li> <li>\u63d2\u5165\u7528\u6237</li> <li>\u9a8c\u8bc1\u5730\u5740</li> <li>\u63d2\u5165\u5730\u5740</li> <li>\u5982\u679c\u51fa\u95ee\u9898\u56de\u6eda\u4e00\u5207</li> </ol> <p>\u8fd9\u662f\u4e0d\u6b63\u786e\u7684\u505a\u6cd5\uff0c\u5b83\u4f1a\u4f7f\u6570\u636e\u5e93\u5728\u5404\u79cd\u60c5\u51b5\u4e0b\u5904\u4e8e\u4e0d\u4e00\u81f4\u7684\u72b6\u6001\uff0c\u5e94\u8be5\u9996\u5148\u9a8c\u8bc1\u6240\u6709\u5185\u5bb9\uff0c\u7136\u540e\u5c06\u7528\u6237\u6570\u636e\u7f6e\u4e8e <code>dao</code> \u5c42\u5e76\u8fdb\u884c\u6570\u636e\u5e93\u66f4\u65b0\u3002\u6b63\u786e\u7684\u505a\u6cd5\u662f\uff1a</p> <ol> <li>\u9a8c\u8bc1\u7528\u6237</li> <li>\u9a8c\u8bc1\u5730\u5740</li> <li>\u63d2\u5165\u7528\u6237</li> <li>\u63d2\u5165\u5730\u5740</li> <li>\u5982\u679c\u95ee\u9898\u56de\u6eda\u4e00\u5207</li> </ol>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/#15","title":"15. \u4e00\u4e2a\u5f02\u5e38\u53ea\u80fd\u5305\u542b\u5728\u4e00\u4e2a\u65e5\u5fd7\u4e2d","text":"<pre><code>CopyLOGGER.debug(\"Using cache sector A\");\nLOGGER.debug(\"Using retry sector B\");\n</code></pre> <p>\u4e0d\u8981\u50cf\u4e0a\u9762\u8fd9\u6837\u505a\uff0c\u5bf9\u591a\u4e2a <code>LOGGER.debug()</code> \u8c03\u7528\u4f7f\u7528\u591a\u884c\u65e5\u5fd7\u6d88\u606f\u53ef\u80fd\u5728\u4f60\u7684\u6d4b\u8bd5\u7528\u4f8b\u4e2d\u770b\u8d77\u6765\u4e0d\u9519\uff0c\u4f46\u662f\u5f53\u5b83\u5728\u5177\u6709 100 \u4e2a\u5e76\u884c\u8fd0\u884c\u7684\u7ebf\u7a0b\u7684\u5e94\u7528\u7a0b\u5e8f\u670d\u52a1\u5668\u7684\u65e5\u5fd7\u6587\u4ef6\u4e2d\u663e\u793a\u65f6\uff0c\u6240\u6709\u4fe1\u606f\u90fd\u8f93\u51fa\u5230\u76f8\u540c\u7684\u65e5\u5fd7\u6587\u4ef6\uff0c\u5373\u4f7f\u5b83\u4eec\u5728\u5b9e\u9645\u4ee3\u7801\u4e2d\u4e3a\u524d\u540e\u884c\uff0c\u4f46\u662f\u5728\u65e5\u5fd7\u6587\u4ef6\u4e2d\u8fd9\u4e24\u4e2a\u65e5\u5fd7\u6d88\u606f\u53ef\u80fd\u4f1a\u95f4\u9694 100 \u591a\u884c\u3002\u5e94\u8be5\u8fd9\u6837\u505a\uff1a</p> <pre><code>CopyLOGGER.debug(\"Using cache sector A, using retry sector B\");\n</code></pre>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/#16","title":"16. \u5c06\u6240\u6709\u76f8\u5173\u4fe1\u606f\u5c3d\u53ef\u80fd\u5730\u4f20\u9012\u7ed9\u5f02\u5e38","text":"<p>\u6709\u7528\u7684\u5f02\u5e38\u6d88\u606f\u548c\u5806\u6808\u8ddf\u8e2a\u975e\u5e38\u91cd\u8981\uff0c\u5982\u679c\u4f60\u7684\u65e5\u5fd7\u4e0d\u80fd\u5b9a\u4f4d\u5f02\u5e38\u4f4d\u7f6e\uff0c\u90a3\u8981\u65e5\u5fd7\u6709\u4ec0\u4e48\u7528\u5462\uff1f</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/#17","title":"17. \u7ec8\u6b62\u6389\u88ab\u4e2d\u65ad\u7684\u7ebf\u7a0b","text":"<pre><code>Copywhile (true) {\n  try {\n    Thread.sleep(100000);\n  } catch (InterruptedException e) {} //\u522b\u8fd9\u6837\u505a\n  doSomethingCool();\n}\n</code></pre> <p><code>InterruptedException</code> \u5f02\u5e38\u63d0\u793a\u5e94\u8be5\u505c\u6b62\u7a0b\u5e8f\u6b63\u5728\u505a\u7684\u4e8b\u60c5\uff0c\u6bd4\u5982\u4e8b\u52a1\u8d85\u65f6\u6216\u7ebf\u7a0b\u6c60\u88ab\u5173\u95ed\u7b49\u3002</p> <p>\u5e94\u8be5\u5c3d\u6700\u5927\u52aa\u529b\u5b8c\u6210\u6b63\u5728\u505a\u7684\u4e8b\u60c5\uff0c\u5e76\u5b8c\u6210\u5f53\u524d\u6267\u884c\u7684\u7ebf\u7a0b\uff0c\u800c\u4e0d\u662f\u5ffd\u7565 <code>InterruptedException</code>\u3002\u4fee\u6539\u540e\u7684\u7a0b\u5e8f\u5982\u4e0b\uff1a</p> <pre><code>Copywhile (true) {\n  try {\n    Thread.sleep(100000);\n  } catch (InterruptedException e) {\n    break;\n  }\n}\ndoSomethingCool();\n</code></pre>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/#18-try-catch","title":"18. \u5bf9\u4e8e\u91cd\u590d\u7684 try-catch\uff0c\u4f7f\u7528\u6a21\u677f\u65b9\u6cd5","text":"<p>\u5728\u4ee3\u7801\u4e2d\u6709\u8bb8\u591a\u7c7b\u4f3c\u7684 catch \u5757\u662f\u65e0\u7528\u7684\uff0c\u53ea\u4f1a\u589e\u52a0\u4ee3\u7801\u7684\u91cd\u590d\u6027\uff0c\u9488\u5bf9\u8fd9\u6837\u7684\u95ee\u9898\u53ef\u4ee5\u4f7f\u7528\u6a21\u677f\u65b9\u6cd5\u3002</p> <p>\u4f8b\u5982\uff0c\u5728\u5c1d\u8bd5\u5173\u95ed\u6570\u636e\u5e93\u8fde\u63a5\u65f6\u7684\u5f02\u5e38\u5904\u7406\u3002</p> <pre><code>Copyclass DBUtil{\n    public static void closeConnection(Connection conn){\n        try{\n            conn.close();\n        } catch(Exception ex){\n            //Log Exception - Cannot close connection\n        }\n    }\n}\n</code></pre> <p>\u8fd9\u7c7b\u7684\u65b9\u6cd5\u5c06\u5728\u5e94\u7528\u7a0b\u5e8f\u5f88\u591a\u5730\u65b9\u4f7f\u7528\uff0c\u4e0d\u8981\u628a\u8fd9\u5757\u4ee3\u7801\u653e\u7684\u5230\u5904\u90fd\u662f\uff0c\u800c\u662f\u5b9a\u4e49\u4e0a\u9762\u7684\u65b9\u6cd5\uff0c\u7136\u540e\u50cf\u4e0b\u9762\u8fd9\u6837\u4f7f\u7528\u5b83\uff1a</p> <pre><code>Copypublic void dataAccessCode() {\n    Connection conn = null;\n    try{\n        conn = getConnection();\n        ....\n    } finally{\n        DBUtil.closeConnection(conn);\n    }\n}\n</code></pre>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/#19-javadoc","title":"19. \u4f7f\u7528 JavaDoc \u4e2d\u8bb0\u5f55\u5e94\u7528\u7a0b\u5e8f\u4e2d\u7684\u6240\u6709\u5f02\u5e38","text":"<p>\u628a\u7528 JavaDoc \u8bb0\u5f55\u8fd0\u884c\u65f6\u53ef\u80fd\u629b\u51fa\u7684\u6240\u6709\u5f02\u5e38\u4f5c\u4e3a\u4e00\u79cd\u4e60\u60ef\uff0c\u5176\u4e2d\u4e5f\u5c3d\u91cf\u5305\u62ec\u7528\u6237\u5e94\u8be5\u9075\u5faa\u7684\u64cd\u4f5c\uff0c\u4ee5\u9632\u8fd9\u4e9b\u5f02\u5e38\u53d1\u751f\u3002</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/#20-try-with-resource","title":"20. \u4f7f\u7528 try-with-resource \u81ea\u52a8\u5730\u5173\u95ed\u8d44\u6e90","text":"<p>1\u3001\u5f53\u4e00\u4e2a\u5916\u90e8\u8d44\u6e90\u7684\u53e5\u67c4\u5bf9\u8c61\u5b9e\u73b0\u4e86 <code>AutoCloseable</code> \u63a5\u53e3\uff0cJDK7\u4e2d\u4fbf\u53ef\u4ee5\u5229\u7528 try-with-resource \u8bed\u6cd5\u66f4\u4f18\u96c5\u7684\u5173\u95ed\u8d44\u6e90\uff0c\u6d88\u9664\u677f\u5f0f\u4ee3\u7801\u3002</p> <p>2\u3001\u4f7f\u7528 try-with-resource \u65f6\uff0c\u5982\u679c\u5bf9\u5916\u90e8\u8d44\u6e90\u7684\u5904\u7406\u548c\u5bf9\u5916\u90e8\u8d44\u6e90\u7684\u5173\u95ed\u5747\u906d\u9047\u4e86\u5f02\u5e38\uff0c\u201c\u5173\u95ed\u5f02\u5e38\u201d\u5c06\u88ab\u6291\u5236\uff0c\u201c\u5904\u7406\u5f02\u5e38\u201d\u5c06\u88ab\u629b\u51fa\uff0c\u4f46\u201c\u5173\u95ed\u5f02\u5e38\u201d\u5e76\u6ca1\u6709\u4e22\u5931\uff0c\u800c\u662f\u5b58\u653e\u5728\u201c\u5904\u7406\u5f02\u5e38\u201d\u7684\u88ab\u6291\u5236\u7684\u5f02\u5e38\u5217\u8868\u4e2d\u3002</p> <pre><code>public static void main(String[] args) {\n    try (FileInputStream inputStream = new FileInputStream(new File(\"test\"))) {\n        System.out.println(inputStream.read());\n    } catch (IOException e) {\n        throw new RuntimeException(e.getMessage(), e);\n    }\n}\n</code></pre> <p>\u5c06\u5916\u90e8\u8d44\u6e90\u7684\u53e5\u67c4\u5bf9\u8c61\u7684\u521b\u5efa\u653e\u5728try\u5173\u952e\u5b57\u540e\u9762\u7684\u62ec\u53f7\u4e2d\uff0c\u5f53\u8fd9\u4e2atry-catch\u4ee3\u7801\u5757\u6267\u884c\u5b8c\u6bd5\u540e\uff0cJava\u4f1a\u786e\u4fdd\u5916\u90e8\u8d44\u6e90\u7684close\u65b9\u6cd5\u88ab\u8c03\u7528\u3002</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8/#_1","title":"\u603b\u7ed3","text":"<p>\u8fd9\u7bc7\u6587\u7ae0\u9996\u5148\u4ecb\u7ecd\u4e86\u4ec0\u4e48\u662f\u5f02\u5e38\uff0c\u4ee5\u53ca\u5f02\u5e38\u7684\u4e09\u79cd\u5206\u7c7b\uff0c\u7136\u540e\u901a\u8fc7 20 \u4e2a\u6700\u4f73\u5b9e\u8df5\u6765\u8ba8\u8bba\u5982\u4f55\u5904\u7406\u5f02\u5e38\uff0c\u5e0c\u671b\u80fd\u5728\u4ee5\u540e\u5f02\u5e38\u5904\u7406\u7684\u65f6\u5019\u6709\u6240\u6539\u8fdb\u53ca\u611f\u609f\u3002</p> <p>\u53c2\u8003\u6587\u6863\uff1a</p> <p>https://dzone.com/articles/java-exceptions-1</p> <p>http://www.yinwang.org/blog-cn/2015/11/21/programming-philosophy</p> <p>https://www.cnblogs.com/wupeixuan/p/11746117.html</p> <p>https://howtodoinjava.com/best-practices/java-exception-handling-best-practices/</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E8%AE%BE%E8%AE%A1/","title":"Java\u5f02\u5e38\u5904\u7406\u8bbe\u8ba1","text":"<p>\u6211\u4eec\u6765\u6df1\u5165\u63a2\u8ba8\u4e00\u4e0bJava\u68c0\u67e5\u578b\u5f02\u5e38\u548c\u975e\u68c0\u67e5\u578b\u5f02\u5e38\u7684\u8bbe\u8ba1\u54f2\u5b66\u3001\u5229\u5f0a\u4ee5\u53ca\u5176\u4ed6\u8bed\u8a00\u7684\u505a\u6cd5\u3002</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E8%AE%BE%E8%AE%A1/#java","title":"\u4e00\u3001 Java \u4e3a\u4ec0\u4e48\u8bbe\u8ba1\u8fd9\u4e24\u79cd\u5f02\u5e38\uff1f","text":"<p>Java\u7684\u8bbe\u8ba1\u8005\u4eec\uff08\u4e3b\u8981\u662fJames Gosling\uff09\u5728\u65e9\u671f\u5e0c\u671b\u5efa\u7acb\u4e00\u4e2a\u201c\u5065\u58ee\u201d\u7684\u8bed\u8a00\u3002\u5f02\u5e38\u5904\u7406\u4f53\u7cfb\u662f\u8fd9\u4e2a\u76ee\u6807\u7684\u6838\u5fc3\u90e8\u5206\u3002\u4ed6\u4eec\u5c06\u5f02\u5e38\u5206\u4e3a\u4e24\u5927\u7c7b\uff0c\u4e3b\u8981\u662f\u57fa\u4e8e\u8d23\u4efb\u65b9\u548c\u53ef\u6062\u590d\u6027\u7684\u8003\u91cf\u3002</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E8%AE%BE%E8%AE%A1/#1","title":"1. \u68c0\u67e5\u578b\u5f02\u5e38","text":"<ul> <li>\u5b9a\u4e49\uff1a\u7ee7\u627f\u81ea <code>Exception</code> \u4f46\u4e0d\u7ee7\u627f <code>RuntimeException</code> \u7684\u5f02\u5e38\u3002\u7f16\u8bd1\u5668\u4f1a\u5728\u7f16\u8bd1\u9636\u6bb5\u68c0\u67e5\u5b83\u4eec\u662f\u5426\u88ab\u5904\u7406\u3002</li> <li> <p>\u8bbe\u8ba1\u54f2\u5b66\uff1a</p> <ul> <li>\u53ef\u6062\u590d\u6027\uff1a\u68c0\u67e5\u578b\u5f02\u5e38\u901a\u5e38\u7528\u4e8e\u7a0b\u5e8f\u4e2d\u53ef\u4ee5\u9884\u89c1\u5e76\u4e14\u5e94\u8be5\u88ab\u6062\u590d\u7684\u9519\u8bef\u60c5\u51b5\u3002\u4f8b\u5982\uff0c\u6587\u4ef6\u672a\u627e\u5230 (<code>FileNotFoundException</code>)\u3001\u7f51\u7edc\u8fde\u63a5\u4e2d\u65ad (<code>IOException</code>)\u3002\u8c03\u7528\u8005\u6709\u53ef\u80fd\u91c7\u53d6\u5907\u7528\u65b9\u6848\uff08\u5982\u8ba9\u7528\u6237\u91cd\u65b0\u9009\u62e9\u6587\u4ef6\u3001\u91cd\u8bd5\u8fde\u63a5\u7b49\uff09\u3002</li> <li>\u5951\u7ea6\u6027\uff1a\u65b9\u6cd5\u7684\u7b7e\u540d\u901a\u8fc7 <code>throws</code> \u5173\u952e\u5b57\u660e\u786e\u58f0\u660e\u4e86\u5b83\u53ef\u80fd\u629b\u51fa\u54ea\u4e9b\u68c0\u67e5\u578b\u5f02\u5e38\u3002\u8fd9\u6784\u6210\u4e86API\u7f16\u8bd1\u65f6\u5951\u7ea6\u7684\u4e00\u90e8\u5206\u3002\u8c03\u7528\u8005\u5fc5\u987b\u5904\u7406\u8fd9\u4e2a\u5f02\u5e38\uff08\u4f7f\u7528 <code>try-catch</code>\uff09\u6216\u8005\u7ee7\u7eed\u5411\u4e0a\u58f0\u660e\u629b\u51fa\u3002\u8fd9\u5f3a\u5236\u7a0b\u5e8f\u5458\u9762\u5bf9\u8fd9\u4e9b\u53ef\u80fd\u53d1\u751f\u7684\u95ee\u9898\uff0c\u4ece\u800c\u7f16\u5199\u66f4\u5065\u58ee\u7684\u4ee3\u7801\u3002</li> <li>\u8d23\u4efb\u5728\u8c03\u7528\u8005\uff1a\u8bbe\u8ba1\u8005\u8ba4\u4e3a\uff0c\u8c03\u7528\u4e00\u4e2a\u53ef\u80fd\u5931\u8d25\u7684\u65b9\u6cd5\uff08\u5982\u8bfb\u53d6\u6587\u4ef6\uff09\uff0c\u8c03\u7528\u8005\u6709\u8d23\u4efb\u548c\u4e49\u52a1\u53bb\u5904\u7406\u8fd9\u4e2a\u5931\u8d25\u3002</li> </ul> </li> <li> <p>\u4f8b\u5b50\uff1a     <pre><code>// \u7f16\u8bd1\u5668\u5f3a\u5236\u4f60\u5904\u7406FileNotFoundException\npublic void readFile(String path) {\n    try {\n        FileReader file = new FileReader(path);\n        // ...\n    } catch (FileNotFoundException e) {\n        // \u5904\u7406\u65b9\u6848\uff1a\u8bb0\u5f55\u65e5\u5fd7\u3001\u4f7f\u7528\u9ed8\u8ba4\u6587\u4ef6\u3001\u63d0\u793a\u7528\u6237\u7b49\n        System.err.println(\"\u6587\u4ef6\u672a\u627e\u5230\uff0c\u8bf7\u68c0\u67e5\u8def\u5f84: \" + path);\n    }\n}\n</code></pre></p> </li> </ul>"},{"location":"java/Java%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E8%AE%BE%E8%AE%A1/#2","title":"2. \u975e\u68c0\u67e5\u578b\u5f02\u5e38","text":"<ul> <li>\u5b9a\u4e49\uff1a\u7ee7\u627f\u81ea <code>RuntimeException</code> \u7684\u5f02\u5e38\uff08\u4ee5\u53ca <code>Error</code>\uff09\u3002\u7f16\u8bd1\u5668\u4e0d\u5f3a\u5236\u8981\u6c42\u5904\u7406\u3002</li> <li> <p>\u8bbe\u8ba1\u54f2\u5b66\uff1a</p> <ul> <li>\u7f16\u7a0b\u9519\u8bef/\u4e0d\u53ef\u6062\u590d\uff1a\u975e\u68c0\u67e5\u578b\u5f02\u5e38\u901a\u5e38\u8868\u793a\u7a0b\u5e8f\u4e2d\u7684\u903b\u8f91\u9519\u8bef\u6216\u7cfb\u7edf\u7ea7\u95ee\u9898\uff0c\u8fd9\u4e9b\u9519\u8bef\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u662f\u4e0d\u53ef\u6062\u590d\u7684\uff0c\u4e5f\u4e0d\u5e94\u8be5\u88ab\u6355\u83b7\u3002\u4f8b\u5982\uff0c\u7a7a\u6307\u9488\u5f15\u7528 (<code>NullPointerException</code>)\u3001\u6570\u7ec4\u8d8a\u754c (<code>ArrayIndexOutOfBoundsException</code>)\u3001\u7c7b\u578b\u8f6c\u6362\u9519\u8bef (<code>ClassCastException</code>)\u3002</li> <li>\u907f\u514d\u4ee3\u7801\u5197\u4f59\uff1a\u5982\u679c\u6bcf\u4e2a <code>null</code> \u68c0\u67e5\u3001\u6bcf\u4e2a\u6570\u7ec4\u8bbf\u95ee\u90fd\u9700\u8981\u7528 <code>try-catch</code> \u5305\u56f4\uff0c\u4ee3\u7801\u4f1a\u53d8\u5f97\u6781\u5176\u81c3\u80bf\u548c\u96be\u4ee5\u9605\u8bfb\u3002</li> <li>\u8d23\u4efb\u5728\u7a0b\u5e8f\u5458\uff1a\u8bbe\u8ba1\u8005\u8ba4\u4e3a\uff0c\u8fd9\u4e9b\u9519\u8bef\u672c\u5e94\u901a\u8fc7\u6b63\u786e\u7684\u7f16\u7801\u5b9e\u8df5\u6765\u907f\u514d\uff0c\u800c\u4e0d\u662f\u5728\u8fd0\u884c\u65f6\u53bb\u6355\u83b7\u5904\u7406\u3002\u5b83\u4eec\u5e38\u5e38\u66b4\u9732\u7684\u662f\u4ee3\u7801\u4e2d\u7684Bug\u3002</li> </ul> </li> <li> <p>\u4f8b\u5b50\uff1a     <pre><code>public void getLength(String str) {\n    // \u5982\u679cstr\u4e3anull\uff0c\u4f1a\u629b\u51faNullPointerException\u3002\n    // \u8fd9\u88ab\u8ba4\u4e3a\u662f\u8c03\u7528\u8005\u7684\u7f16\u7a0b\u9519\u8bef\uff0c\u4f20\u9012\u4e86\u4e00\u4e2a\u4e0d\u5408\u6cd5\u7684\u53c2\u6570\u3002\n    int length = str.length();\n}\n</code></pre></p> </li> </ul>"},{"location":"java/Java%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E8%AE%BE%E8%AE%A1/#_1","title":"\u603b\u7ed3\u5bf9\u6bd4","text":"\u7279\u6027 \u68c0\u67e5\u578b\u5f02\u5e38 \u975e\u68c0\u67e5\u578b\u5f02\u5e38 \u7ee7\u627f\u5173\u7cfb <code>Exception</code> (\u975e <code>RuntimeException</code>) <code>RuntimeException</code> \u6216 <code>Error</code> \u7f16\u8bd1\u5668\u68c0\u67e5 \u662f\uff0c\u5fc5\u987b\u5904\u7406\u6216\u58f0\u660e \u5426 \u53ef\u6062\u590d\u6027 \u901a\u5e38\u53ef\u9884\u89c1\u3001\u53ef\u6062\u590d \u901a\u5e38\u4e3a\u7f16\u7a0b\u9519\u8bef\u3001\u4e0d\u53ef\u6062\u590d \u8d23\u4efb\u65b9 \u65b9\u6cd5\u7684\u8c03\u7528\u8005 \u4ee3\u7801\u7684\u7f16\u5199\u8005\uff08\u7a0b\u5e8f\u5458\uff09 \u4f7f\u7528\u573a\u666f \u5916\u90e8\u4f9d\u8d56\u5931\u8d25\uff08IO\u3001\u7f51\u7edc\u3001\u6570\u636e\u5e93\uff09 \u903b\u8f91\u9519\u8bef\uff08\u7a7a\u6307\u9488\u3001\u8d8a\u754c\u3001\u53c2\u6570\u975e\u6cd5\uff09 \u4ee3\u7801\u5f71\u54cd \u4f7f\u65b9\u6cd5\u7b7e\u540d\u81a8\u80c0\uff0c\u7834\u574f\u63a5\u53e3 \u4fdd\u6301\u4ee3\u7801\u7b80\u6d01"},{"location":"java/Java%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E8%AE%BE%E8%AE%A1/#_2","title":"\u4e8c\u3001 \u5176\u4ed6\u8bed\u8a00\u6709\u7c7b\u4f3c\u7684\u8bbe\u8ba1\u5417\uff1f","text":"<p>\u7edd\u5927\u591a\u6570\u4e3b\u6d41\u8bed\u8a00\u90fd\u9009\u62e9\u4e86\u4e0eJava\u4e0d\u540c\u7684\u9053\u8def\uff0c\u5b83\u4eec\u66f4\u503e\u5411\u4e8eJava\u4e2d\u201c\u975e\u68c0\u67e5\u578b\u5f02\u5e38\u201d\u7684\u6a21\u578b\u3002</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E8%AE%BE%E8%AE%A1/#1-c","title":"1. C","text":"<p>C#\u7684\u8bbe\u8ba1\u6df1\u53d7Java\u5f71\u54cd\uff0c\u4f46\u5b83\u6ca1\u6709\u68c0\u67e5\u578b\u5f02\u5e38\u3002\u6240\u6709\u5f02\u5e38\u90fd\u7ee7\u627f\u81ea <code>System.Exception</code>\uff0c\u5e76\u4e14\u90fd\u662f\u975e\u68c0\u67e5\u7684\u3002 *   \u8bbe\u8ba1\u7406\u7531\uff1aC#\u7684\u9996\u5e2d\u67b6\u6784\u5e08Anders Hejlsberg\u66fe\u6279\u8bc4\u68c0\u67e5\u578b\u5f02\u5e38\u4f1a\u7834\u574f\u201c\u5f00\u95ed\u539f\u5219\u201d\uff08\u56e0\u4e3a\u7ed9\u4e00\u4e2a\u5df2\u5b58\u5728\u7684\u65b9\u6cd5\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684 <code>throws</code> \u5b50\u53e5\u4f1a\u7834\u574f\u6240\u6709\u73b0\u6709\u7684\u8c03\u7528\u8005\u4ee3\u7801\uff09\uff0c\u5e76\u4e14\u4f1a\u5bfc\u81f4\u5927\u89c4\u6a21\u7684\u3001\u65e0\u610f\u4e49\u7684 <code>catch</code> \u5757\uff0c\u53ea\u662f\u7b80\u5355\u5730\u5305\u88c5\u548c\u91cd\u65b0\u629b\u51fa\u5f02\u5e38\u3002</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E8%AE%BE%E8%AE%A1/#2-c","title":"2. C++","text":"<p>C++\u7684\u5f02\u5e38\u673a\u5236\u4e5f\u662f\u975e\u68c0\u67e5\u578b\u7684\u3002\u51fd\u6570\u53ef\u4ee5\u4f7f\u7528 <code>throw()</code> \u89c4\u8303\uff08\u5728C++11/17/20\u4e2d\u5df2\u88ab\u5f03\u7528/\u79fb\u9664\uff0c\u53d6\u800c\u4ee3\u4e4b\u7684\u662f <code>noexcept</code>\uff09\u6765\u58f0\u660e\u5b83\u53ef\u80fd\u629b\u51fa\u4ec0\u4e48\uff0c\u4f46\u7f16\u8bd1\u5668\u4e0d\u4f1a\u5f3a\u5236\u8c03\u7528\u8005\u5fc5\u987b\u5904\u7406\u3002<code>noexcept</code> \u4e3b\u8981\u662f\u4e00\u4e2a\u4f18\u5316\u548c\u5951\u7ea6\u63d0\u793a\u3002</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E8%AE%BE%E8%AE%A1/#3-python-javascript-ruby-go","title":"3. Python, JavaScript, Ruby, Go \u7b49\u52a8\u6001/\u73b0\u4ee3\u8bed\u8a00","text":"<p>\u8fd9\u4e9b\u8bed\u8a00\u90fd\u4f7f\u7528\u975e\u68c0\u67e5\u578b\u5f02\u5e38\u3002 *   \u5f02\u5e38\u662f\u63a7\u5236\u6d41\u7684\u4e00\u79cd\u624b\u6bb5\uff0c\u662f\u5426\u6355\u83b7\u5b8c\u5168\u7531\u7a0b\u5e8f\u5458\u51b3\u5b9a\u3002 *   \u8fd9\u79cd\u8bbe\u8ba1\u88ab\u8ba4\u4e3a\u66f4\u7075\u6d3b\uff0c\u51cf\u5c11\u4e86\u4ee3\u7801\u7684\u4eea\u5f0f\u611f\uff0c\u5c06\u5224\u65ad\u529b\u4ea4\u8fd8\u7ed9\u5f00\u53d1\u8005\u3002</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E8%AE%BE%E8%AE%A1/#go","title":"\u4e00\u4e2a\u7279\u4f8b\uff1aGo","text":"<p>Go\u8bed\u8a00\u91c7\u53d6\u4e86\u4e00\u79cd\u6781\u5176\u4e0d\u540c\u7684\u65b9\u5f0f\uff1a\u5b83\u6839\u672c\u6ca1\u6709\u4f20\u7edf\u7684\u201c\u5f02\u5e38\u201d\u6982\u5ff5\u3002 *   \u9519\u8bef\u5904\u7406\uff1a\u4f7f\u7528\u591a\u8fd4\u56de\u503c\uff0c\u901a\u5e38\u6700\u540e\u4e00\u4e2a\u8fd4\u56de\u503c\u662f <code>error</code> \u7c7b\u578b\u3002\u8c03\u7528\u8005\u9700\u8981\u7acb\u5373\u68c0\u67e5\u8fd9\u4e2a\u9519\u8bef\u3002     <pre><code>file, err := os.Open(\"filename.txt\")\nif err != nil {\n    // \u5904\u7406\u9519\u8bef\n    log.Fatal(err)\n}\n// \u7ee7\u7eed\u4f7f\u7528 file\n</code></pre> *   Panic/Recover\uff1aGo\u6709 <code>panic</code> \u548c <code>recover</code> \u673a\u5236\uff0c\u4f46\u8fd9\u7c7b\u4f3c\u4e8e\u201c\u975e\u68c0\u67e5\u578b\u5f02\u5e38\u201d\u4e2d\u7684\u4e25\u91cd\u9519\u8bef\uff08\u5982 <code>Error</code>\uff09\uff0c\u7528\u4e8e\u5904\u7406\u771f\u6b63\u7684\u5f02\u5e38\u60c5\u51b5\uff0c\u4e0d\u9f13\u52b1\u7528\u4e8e\u5e38\u89c4\u9519\u8bef\u5904\u7406\u3002</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E8%AE%BE%E8%AE%A1/#_3","title":"\u4e09\u3001 \u73b0\u4ee3\u89c2\u70b9\u4e0e\u4e89\u8bae","text":"<p>Java\u7684\u68c0\u67e5\u578b\u5f02\u5e38\u8bbe\u8ba1\u662f\u4e00\u4e2a\u5145\u6ee1\u4e89\u8bae\u7684\u8bdd\u9898\u3002</p> <p>\u4f18\u70b9\uff08\u652f\u6301\u8005\u89c2\u70b9\uff09\uff1a *   \u589e\u5f3a\u4ee3\u7801\u5065\u58ee\u6027\uff1a\u5f3a\u5236\u7a0b\u5e8f\u5458\u8003\u8651\u548c\u5904\u7406\u6f5c\u5728\u7684\u9519\u8bef\uff0c\u907f\u514d\u4e86\u201c\u5fd8\u8bb0\u5904\u7406\u9519\u8bef\u201d\u7684\u60c5\u51b5\u3002</p> <p>\u7f3a\u70b9\uff08\u53cd\u5bf9\u8005\u89c2\u70b9\uff09\uff1a 1.  \u63a5\u53e3\u6f14\u5316\u56f0\u96be\uff1a\u7ed9\u4e00\u4e2a\u5e7f\u6cdb\u4f7f\u7528\u7684\u63a5\u53e3\u65b9\u6cd5\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684\u68c0\u67e5\u578b\u5f02\u5e38\u662f\u7834\u574f\u6027\u7684\u53d8\u66f4\u3002 2.  \u5197\u957f\u7684\u6837\u677f\u4ee3\u7801\uff1a\u5bfc\u81f4\u5927\u91cf\u7684 <code>try-catch</code> \u5757\uff0c\u800c\u5f88\u591a\u60c5\u51b5\u4e0b <code>catch</code> \u5757\u53ea\u662f\u7b80\u5355\u5730\u5305\u88c5\u6210\u53e6\u4e00\u4e2a\u5f02\u5e38\u5e76\u91cd\u65b0\u629b\u51fa\uff0c\u6ca1\u6709\u5b9e\u9645\u5904\u7406\u4ef7\u503c\u3002\u8fd9\u88ab\u79f0\u4e3a\u201c\u5f02\u5e38\u541e\u54bd\u201d\u6216\u201c\u7a7a\u6d1e\u7684catch\u5757\u201d\u3002 3.  \u7834\u574f\u62bd\u8c61\u548c\u5c01\u88c5\uff1a\u5e95\u5c42\u5b9e\u73b0\u7ec6\u8282\uff08\u5982\u629b\u51fa\u7684\u5177\u4f53\u5f02\u5e38\u7c7b\u578b\uff09\u4f1a\u901a\u8fc7 <code>throws</code> \u5b50\u53e5\u6cc4\u6f0f\u5230\u9ad8\u5c42API\u4e2d\uff0c\u8fdd\u53cd\u4e86\u5c01\u88c5\u539f\u5219\u3002 4.  \u88ab\u8bef\u7528\uff1a\u5f88\u591a\u672c\u5e94\u662f\u7f16\u7a0b\u9519\u8bef\u7684\u573a\u666f\uff08\u5982\u4e1a\u52a1\u903b\u8f91\u53c2\u6570\u9519\u8bef\uff09\u88ab\u8bbe\u8ba1\u6210\u4e86\u68c0\u67e5\u578b\u5f02\u5e38\uff0c\u5f3a\u8feb\u8c03\u7528\u8005\u5904\u7406\u3002</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E8%AE%BE%E8%AE%A1/#_4","title":"\u56db\u3001\u4ec0\u4e48\u65f6\u5019\u9009\u62e9\u975e\u68c0\u67e5\u578b\u5f02\u5e38\uff1f","text":"<p>\u6211\u4eec\u901a\u5e38\u5c06\u4e1a\u52a1\u903b\u8f91\u9519\u8bef\u548c\u9a8c\u8bc1\u5931\u8d25\u8bbe\u8ba1\u4e3a\u975e\u68c0\u67e5\u578b\u5f02\u5e38\uff0c\u56e0\u4e3a\uff1a</p> <ol> <li> <p>\u8fd9\u4e9b\u9519\u8bef\u901a\u5e38\u662f\u7531\u4e8e\u5ba2\u6237\u7aef\u8c03\u7528\u4e0d\u5f53\uff08\u5982\u53c2\u6570\u6821\u9a8c\u4e0d\u901a\u8fc7\uff09\u5bfc\u81f4\u7684\uff0c\u7c7b\u4f3c\u4e8e\u7f16\u7a0b\u9519\u8bef\uff08\u5982\u7a7a\u6307\u9488\uff09\uff0c\u5c5e\u4e8e\u5ba2\u6237\u7aef\u8c03\u7528\u65b9\u5e94\u8be5\u907f\u514d\u7684\u3002</p> </li> <li> <p>\u4f7f\u7528\u975e\u68c0\u67e5\u578b\u5f02\u5e38\u53ef\u4ee5\u907f\u514d\u5728\u4ee3\u7801\u4e2d\u5230\u5904\u6355\u83b7\u6216\u58f0\u660e\uff0c\u4fdd\u6301\u4ee3\u7801\u7684\u7b80\u6d01\u3002</p> </li> <li> <p>\u5728\u67b6\u6784\u5c42\u9762\uff0c\u6211\u4eec\u901a\u5e38\u4f1a\u5728\u7edf\u4e00\u5f02\u5e38\u5904\u7406\uff08\u5982Spring\u7684@ControllerAdvice\uff09\u4e2d\u6355\u83b7\u8fd9\u4e9b\u975e\u68c0\u67e5\u578b\u5f02\u5e38\uff0c\u5e76\u5c06\u5176\u8f6c\u6362\u4e3a\u7528\u6237\u53cb\u597d\u7684\u9519\u8bef\u4fe1\u606f\u8fd4\u56de\u3002</p> </li> </ol> <p>\u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u4e14\u5728\u73b0\u4ee3Java\u5f00\u53d1\u4e2d\u5e7f\u6cdb\u91c7\u7528\u7684\u6700\u4f73\u5b9e\u8df5\u3002\u8ba9\u6211\u4eec\u6df1\u5165\u63a2\u8ba8\u4e3a\u4ec0\u4e48\u4f7f\u7528\u975e\u68c0\u67e5\u578b\u5f02\u5e38\u6765\u5904\u7406\u4e1a\u52a1\u903b\u8f91\u9519\u8bef\u548c\u9a8c\u8bc1\u5931\u8d25\u662f\u5408\u7406\u7684\uff0c\u4ee5\u53ca\u5982\u4f55\u6b63\u786e\u5b9e\u65bd\u3002</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E8%AE%BE%E8%AE%A1/#1_1","title":"1. \u8bed\u4e49\u4e0a\u7684\u5408\u7406\u6027","text":"<p>\u4e1a\u52a1\u903b\u8f91\u9519\u8bef\u548c\u9a8c\u8bc1\u5931\u8d25\u672c\u8d28\u4e0a\u662f\u7f16\u7a0b\u9519\u8bef\u6216\u5ba2\u6237\u7aef\u8c03\u7528\u9519\u8bef\uff0c\u800c\u4e0d\u662f\u5916\u90e8\u7cfb\u7edf\u6545\u969c\u3002</p> <pre><code>// \u68c0\u67e5\u578b\u5f02\u5e38 - \u4e0d\u5408\u7406\npublic void transferMoney(Account from, Account to, BigDecimal amount) \n    throws InsufficientBalanceException { // \u8fd9\u5e94\u8be5\u662f\u8c03\u7528\u8005\u7684\u9519\u8bef\n\n    if (from.getBalance().compareTo(amount) &lt; 0) {\n        throw new InsufficientBalanceException(\"\u4f59\u989d\u4e0d\u8db3\");\n    }\n    // \u8f6c\u8d26\u903b\u8f91\n}\n\n// \u975e\u68c0\u67e5\u578b\u5f02\u5e38 - \u5408\u7406\npublic void transferMoney(Account from, Account to, BigDecimal amount) {\n    if (from.getBalance().compareTo(amount) &lt; 0) {\n        throw new InsufficientBalanceException(\"\u4f59\u989d\u4e0d\u8db3\"); // \u7ee7\u627fRuntimeException\n    }\n    // \u8f6c\u8d26\u903b\u8f91\n}\n</code></pre>"},{"location":"java/Java%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E8%AE%BE%E8%AE%A1/#2_1","title":"2. \u4fdd\u6301\u4ee3\u7801\u7b80\u6d01\u6027","text":"<p>\u907f\u514d\u5728\u4e1a\u52a1\u4ee3\u7801\u4e2d\u5145\u65a5\u5927\u91cf\u7684 <code>try-catch</code> \u5757\uff0c\u8ba9\u4e1a\u52a1\u903b\u8f91\u66f4\u6e05\u6670\u3002</p> <pre><code>// \u274c \u4f7f\u7528\u68c0\u67e5\u578b\u5f02\u5e38 - \u4ee3\u7801\u5197\u957f\npublic void createOrder(OrderRequest request) {\n    try {\n        validateOrder(request);\n        checkInventory(request);\n        calculatePrice(request);\n        // \u521b\u5efa\u8ba2\u5355...\n    } catch (ValidationException e) {\n        // \u5904\u7406\u9a8c\u8bc1\u9519\u8bef\n    } catch (InventoryException e) {\n        // \u5904\u7406\u5e93\u5b58\u9519\u8bef\n    } catch (PricingException e) {\n        // \u5904\u7406\u4ef7\u683c\u8ba1\u7b97\u9519\u8bef\n    }\n}\n\n// \u2705 \u4f7f\u7528\u975e\u68c0\u67e5\u578b\u5f02\u5e38 - \u4ee3\u7801\u6e05\u6670\npublic void createOrder(OrderRequest request) {\n    validateOrder(request);    // \u9a8c\u8bc1\u5931\u8d25\u76f4\u63a5\u629b\u51fa\u5f02\u5e38\n    checkInventory(request);   // \u5e93\u5b58\u4e0d\u8db3\u76f4\u63a5\u629b\u51fa\u5f02\u5e38  \n    calculatePrice(request);   // \u4ef7\u683c\u8ba1\u7b97\u5f02\u5e38\u76f4\u63a5\u629b\u51fa\n    // \u521b\u5efa\u8ba2\u5355...\n}\n</code></pre>"},{"location":"java/Java%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E8%AE%BE%E8%AE%A1/#_5","title":"\u4e94\u3001\u5b9e\u8df5\u65b9\u6848","text":""},{"location":"java/Java%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E8%AE%BE%E8%AE%A1/#1_2","title":"1. \u5b9a\u4e49\u4e1a\u52a1\u5f02\u5e38\u57fa\u7c7b","text":"<pre><code>// \u4e1a\u52a1\u5f02\u5e38\u57fa\u7c7b\npublic class BusinessException extends RuntimeException {\n    private String code;    // \u9519\u8bef\u7801\n    private String message; // \u9519\u8bef\u4fe1\u606f\n\n    public BusinessException(String code, String message) {\n        super(message);\n        this.code = code;\n        this.message = message;\n    }\n\n    // getters...\n}\n\n// \u5177\u4f53\u7684\u4e1a\u52a1\u5f02\u5e38\npublic class ValidationException extends BusinessException {\n    public ValidationException(String message) {\n        super(\"VALIDATION_ERROR\", message);\n    }\n}\n\npublic class InsufficientBalanceException extends BusinessException {\n    public InsufficientBalanceException(String message) {\n        super(\"INSUFFICIENT_BALANCE\", message);\n    }\n}\n\npublic class InventoryShortageException extends BusinessException {\n    public InventoryShortageException(String productId, int available) {\n        super(\"INVENTORY_SHORTAGE\", \n              String.format(\"\u4ea7\u54c1%s\u5e93\u5b58\u4e0d\u8db3\uff0c\u5f53\u524d\u5e93\u5b58\uff1a%d\", productId, available));\n    }\n}\n</code></pre>"},{"location":"java/Java%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E8%AE%BE%E8%AE%A1/#2_2","title":"2. \u5728\u4e1a\u52a1\u5c42\u4f7f\u7528","text":"<pre><code>@Service\n@Transactional\npublic class OrderService {\n\n    public Order createOrder(CreateOrderCommand command) {\n        // \u53c2\u6570\u9a8c\u8bc1\n        validateCommand(command);\n\n        // \u4e1a\u52a1\u89c4\u5219\u9a8c\u8bc1\n        validateBusinessRules(command);\n\n        // \u6267\u884c\u6838\u5fc3\u4e1a\u52a1\u903b\u8f91\n        return executeCreateOrder(command);\n    }\n\n    private void validateCommand(CreateOrderCommand command) {\n        if (command == null) {\n            throw new ValidationException(\"\u521b\u5efa\u8ba2\u5355\u53c2\u6570\u4e0d\u80fd\u4e3a\u7a7a\");\n        }\n        if (command.getUserId() == null) {\n            throw new ValidationException(\"\u7528\u6237ID\u4e0d\u80fd\u4e3a\u7a7a\");\n        }\n        if (command.getItems() == null || command.getItems().isEmpty()) {\n            throw new ValidationException(\"\u8ba2\u5355\u5546\u54c1\u4e0d\u80fd\u4e3a\u7a7a\");\n        }\n    }\n\n    private void validateBusinessRules(CreateOrderCommand command) {\n        // \u68c0\u67e5\u7528\u6237\u72b6\u6001\n        User user = userRepository.findById(command.getUserId())\n            .orElseThrow(() -&gt; new BusinessException(\"USER_NOT_FOUND\", \"\u7528\u6237\u4e0d\u5b58\u5728\"));\n\n        if (!user.isActive()) {\n            throw new BusinessException(\"USER_INACTIVE\", \"\u7528\u6237\u8d26\u6237\u5df2\u88ab\u7981\u7528\");\n        }\n\n        // \u68c0\u67e5\u5e93\u5b58\n        checkInventory(command.getItems());\n\n        // \u68c0\u67e5\u7528\u6237\u4f59\u989d\n        checkUserBalance(command.getUserId(), command.getTotalAmount());\n    }\n\n    private void checkInventory(List&lt;OrderItem&gt; items) {\n        for (OrderItem item : items) {\n            int availableStock = inventoryService.getAvailableStock(item.getProductId());\n            if (availableStock &lt; item.getQuantity()) {\n                throw new InventoryShortageException(item.getProductId(), availableStock);\n            }\n        }\n    }\n\n    private void checkUserBalance(Long userId, BigDecimal amount) {\n        BigDecimal balance = accountService.getBalance(userId);\n        if (balance.compareTo(amount) &lt; 0) {\n            throw new InsufficientBalanceException(\n                String.format(\"\u7528\u6237\u4f59\u989d\u4e0d\u8db3\uff0c\u5f53\u524d\u4f59\u989d\uff1a%.2f\uff0c\u9700\u8981\uff1a%.2f\", balance, amount));\n        }\n    }\n}\n</code></pre>"},{"location":"java/Java%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E8%AE%BE%E8%AE%A1/#3","title":"3. \u7edf\u4e00\u7684\u5f02\u5e38\u5904\u7406","text":"<p>\u5728Web\u5c42\u4f7f\u7528 <code>@ControllerAdvice</code> \u7edf\u4e00\u5904\u7406\uff1a</p> <pre><code>@RestControllerAdvice\npublic class GlobalExceptionHandler {\n\n    private static final Logger logger = LoggerFactory.getLogger(GlobalExceptionHandler.class);\n\n    /**\n     * \u5904\u7406\u4e1a\u52a1\u5f02\u5e38\n     */\n    @ExceptionHandler(BusinessException.class)\n    public ResponseEntity&lt;ErrorResponse&gt; handleBusinessException(BusinessException ex) {\n        logger.warn(\"\u4e1a\u52a1\u5f02\u5e38: {}\", ex.getMessage());\n\n        ErrorResponse error = ErrorResponse.builder()\n            .code(ex.getCode())\n            .message(ex.getMessage())\n            .timestamp(LocalDateTime.now())\n            .build();\n\n        return ResponseEntity.badRequest().body(error);\n    }\n\n    /**\n     * \u5904\u7406\u53c2\u6570\u9a8c\u8bc1\u5f02\u5e38\n     */\n    @ExceptionHandler(MethodArgumentNotValidException.class)\n    public ResponseEntity&lt;ErrorResponse&gt; handleValidationException(\n            MethodArgumentNotValidException ex) {\n\n        List&lt;String&gt; errors = ex.getBindingResult()\n            .getFieldErrors()\n            .stream()\n            .map(error -&gt; error.getField() + \": \" + error.getDefaultMessage())\n            .collect(Collectors.toList());\n\n        ErrorResponse error = ErrorResponse.builder()\n            .code(\"VALIDATION_FAILED\")\n            .message(\"\u53c2\u6570\u9a8c\u8bc1\u5931\u8d25\")\n            .details(errors)\n            .timestamp(LocalDateTime.now())\n            .build();\n\n        return ResponseEntity.badRequest().body(error);\n    }\n\n    /**\n     * \u5904\u7406\u6240\u6709\u672a\u6355\u83b7\u7684\u5f02\u5e38\n     */\n    @ExceptionHandler(Exception.class)\n    public ResponseEntity&lt;ErrorResponse&gt; handleGenericException(Exception ex) {\n        logger.error(\"\u7cfb\u7edf\u5f02\u5e38: \", ex);\n\n        ErrorResponse error = ErrorResponse.builder()\n            .code(\"SYSTEM_ERROR\")\n            .message(\"\u7cfb\u7edf\u5185\u90e8\u9519\u8bef\")\n            .timestamp(LocalDateTime.now())\n            .build();\n\n        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(error);\n    }\n}\n\n// \u7edf\u4e00\u7684\u9519\u8bef\u54cd\u5e94\u4f53\n@Data\n@Builder\nclass ErrorResponse {\n    private String code;\n    private String message;\n    private List&lt;String&gt; details;\n    private LocalDateTime timestamp;\n}\n</code></pre>"},{"location":"java/Java%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E8%AE%BE%E8%AE%A1/#4-controller","title":"4. \u5728Controller\u5c42\u7684\u4f7f\u7528","text":"<pre><code>@RestController\n@RequestMapping(\"/api/orders\")\npublic class OrderController {\n\n    @Autowired\n    private OrderService orderService;\n\n    @PostMapping\n    public ResponseEntity&lt;ApiResponse&lt;Order&gt;&gt; createOrder(\n            @Valid @RequestBody CreateOrderRequest request) {\n\n        // \u4e0d\u9700\u8981try-catch\uff0c\u5f02\u5e38\u4f1a\u88abGlobalExceptionHandler\u7edf\u4e00\u5904\u7406\n        CreateOrderCommand command = orderMapper.toCommand(request);\n        Order order = orderService.createOrder(command);\n\n        return ResponseEntity.ok(ApiResponse.success(order));\n    }\n}\n</code></pre>"},{"location":"java/Java%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E8%AE%BE%E8%AE%A1/#_6","title":"\u516d\u3001\u4f18\u52bf\u603b\u7ed3","text":"<ol> <li>\u4ee3\u7801\u7b80\u6d01\uff1a\u4e1a\u52a1\u903b\u8f91\u6e05\u6670\uff0c\u6ca1\u6709\u6742\u4e71\u7684\u5f02\u5e38\u5904\u7406\u4ee3\u7801</li> <li>\u8bed\u4e49\u6b63\u786e\uff1a\u4e1a\u52a1\u9519\u8bef\u4f5c\u4e3a\u975e\u68c0\u67e5\u5f02\u5e38\uff0c\u7b26\u5408\"\u8c03\u7528\u65b9\u9519\u8bef\"\u7684\u8bed\u4e49</li> <li>\u7edf\u4e00\u5904\u7406\uff1a\u5728\u67b6\u6784\u5c42\u9762\u7edf\u4e00\u5904\u7406\u5f02\u5e38\uff0c\u4fdd\u8bc1\u4e00\u81f4\u6027</li> <li>\u6613\u4e8e\u6d4b\u8bd5\uff1a\u6d4b\u8bd5\u65f6\u53ef\u4ee5\u76f4\u63a5\u671f\u5f85\u5f02\u5e38\u629b\u51fa</li> </ol> <pre><code>@Test\nvoid shouldThrowExceptionWhenInsufficientBalance() {\n    CreateOrderCommand command = createTestCommandWithLargeAmount();\n\n    BusinessException exception = assertThrows(\n        InsufficientBalanceException.class,\n        () -&gt; orderService.createOrder(command)\n    );\n\n    assertEquals(\"INSUFFICIENT_BALANCE\", exception.getCode());\n}\n</code></pre> <p>\u8fd9\u79cd\u6a21\u5f0f\u5728\u73b0\u4ee3Java Web\u5f00\u53d1\u4e2d\u5df2\u7ecf\u6210\u4e3a\u4e8b\u5b9e\u6807\u51c6\uff0c\u7279\u522b\u662f\u5728Spring\u751f\u6001\u4e2d\u3002\u5b83\u5c06\u5f02\u5e38\u5904\u7406\u4ece\u4e1a\u52a1\u903b\u8f91\u4e2d\u89e3\u8026\uff0c\u8ba9\u5f00\u53d1\u8005\u80fd\u591f\u4e13\u6ce8\u4e8e\u6838\u5fc3\u4e1a\u52a1\u5b9e\u73b0\u3002</p>"},{"location":"java/Java%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E8%AE%BE%E8%AE%A1/#_7","title":"\u4e03\u3001\u7ed3\u8bba","text":"<p>Java\u8bbe\u8ba1\u68c0\u67e5\u578b\u548c\u975e\u68c0\u67e5\u578b\u5f02\u5e38\u7684\u521d\u8877\u662f\u597d\u7684\uff1a\u901a\u8fc7\u7f16\u8bd1\u5668\u7684\u529b\u91cf\uff0c\u5c06\u201c\u53ef\u6062\u590d\u7684\u9519\u8bef\u201d\u4e0e\u201c\u7f16\u7a0b\u9519\u8bef\u201d\u533a\u5206\u5f00\u6765\uff0c\u5e76\u5f3a\u5236\u7a0b\u5e8f\u5458\u5904\u7406\u524d\u8005\uff0c\u4ee5\u6784\u5efa\u66f4\u53ef\u9760\u7684\u7cfb\u7edf\u3002</p> <p>\u7136\u800c\uff0c\u5728\u5b9e\u8df5\u4e2d\uff0c\u8fd9\u79cd\u8bbe\u8ba1\u7684\u5f0a\u7aef\u4e5f\u9010\u6e10\u66b4\u9732\uff0c\u5c24\u5176\u662f\u5728\u5927\u578b\u3001\u590d\u6742\u7684\u7cfb\u7edf\u4e2d\u3002\u56e0\u6b64\uff0c\u540e\u7eed\u7684\u4e3b\u6d41\u8bed\u8a00\u51e0\u4e4e\u90fd\u653e\u5f03\u4e86\u68c0\u67e5\u578b\u5f02\u5e38\u7684\u8bbe\u8ba1\uff0c\u9009\u62e9\u4e86\u66f4\u7075\u6d3b\u3001\u4fb5\u5165\u6027\u66f4\u5c0f\u7684\u975e\u68c0\u67e5\u578b\u5f02\u5e38\u6a21\u578b\u3002</p> <p>\u5728\u73b0\u4ee3Java\u5f00\u53d1\u4e2d\uff0c\u4e00\u4e2a\u5e38\u89c1\u7684\u8d8b\u52bf\u662f\uff1a *   \u8c28\u614e\u4f7f\u7528\u68c0\u67e5\u578b\u5f02\u5e38\uff0c\u53ea\u5728\u8c03\u7528\u8005\u771f\u7684\u6709\u6709\u610f\u4e49\u7684\u65b9\u5f0f\u53bb\u6062\u590d\u65f6\u624d\u4f7f\u7528\u5b83\u3002 *   \u66f4\u591a\u5730\u4f7f\u7528\u975e\u68c0\u67e5\u578b\u5f02\u5e38\u6765\u5904\u7406\u4e1a\u52a1\u903b\u8f91\u9519\u8bef\u548c\u9a8c\u8bc1\u5931\u8d25\u3002 *   \u5728\u6846\u67b6\uff08\u5982Spring\uff09\u4e2d\uff0c\u5f88\u591a\u5e95\u5c42\u7684\u68c0\u67e5\u578b\u5f02\u5e38\uff08\u5982JDBC\u7684 <code>SQLException</code>\uff09\u4f1a\u88ab\u6355\u83b7\u5e76\u5305\u88c5\u6210\u975e\u68c0\u67e5\u578b\u5f02\u5e38\uff08\u5982 <code>DataAccessException</code>\uff09\u91cd\u65b0\u629b\u51fa\uff0c\u4ece\u800c\u7b80\u5316\u4e0a\u5c42\u5e94\u7528\u7684\u4ee3\u7801\u3002</p>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/","title":"Mockito\u5355\u5143\u6d4b\u8bd5\u6846\u67b6\u4f7f\u7528\u6307\u5357","text":"<p>Mockito \u662f\u4e00\u4e2a\u6d41\u884c\u7684 Java \u5355\u5143\u6d4b\u8bd5\u6a21\u62df\u6846\u67b6\uff0c\u7528\u4e8e\u521b\u5efa\u548c\u914d\u7f6e\u6a21\u62df\u5bf9\u8c61\uff08mock objects\uff09\u3002\u5b83\u80fd\u591f\u5e2e\u52a9\u4f60\u5728\u6d4b\u8bd5\u4e2d\u9694\u79bb\u5916\u90e8\u4f9d\u8d56\uff0c\u4f7f\u5f97\u6d4b\u8bd5\u66f4\u52a0\u4e13\u6ce8\u4e8e\u88ab\u6d4b\u8bd5\u7c7b\u7684\u884c\u4e3a\u3002\u4ee5\u4e0b\u662f\u4e00\u4e2a\u5173\u4e8e Mockito \u4f7f\u7528\u7684\u57fa\u672c\u4ecb\u7ecd\uff1a</p>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#mockito","title":"Mockito \u4f7f\u7528\u6307\u5357","text":""},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#1","title":"1. \u6dfb\u52a0\u4f9d\u8d56","text":"<p>\u9996\u5148\uff0c\u9700\u8981\u5728\u9879\u76ee\u4e2d\u6dfb\u52a0 Mockito \u7684\u4f9d\u8d56\u3002\u4ee5 Maven \u4e3a\u4f8b\uff1a <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.mockito&lt;/groupId&gt;\n    &lt;artifactId&gt;mockito-core&lt;/artifactId&gt;\n    &lt;version&gt;5.11.0&lt;/version&gt; &lt;!-- \u8bf7\u4f7f\u7528\u6700\u65b0\u7248\u672c --&gt;\n    &lt;scope&gt;test&lt;/scope&gt;\n&lt;/dependency&gt;\n</code></pre></p>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#2","title":"2. \u57fa\u672c\u7528\u6cd5","text":"<p>Mockito \u7684\u6838\u5fc3\u529f\u80fd\u5305\u62ec\uff1a\u521b\u5efa\u6a21\u62df\u5bf9\u8c61\u3001\u8bbe\u7f6e\u6a21\u62df\u884c\u4e3a\u3001\u9a8c\u8bc1\u4ea4\u4e92\u3002</p>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#_1","title":"\u521b\u5efa\u6a21\u62df\u5bf9\u8c61","text":"<p>\u4f7f\u7528 <code>Mockito.mock()</code> \u65b9\u6cd5\u6216 <code>@Mock</code> \u6ce8\u89e3\u6765\u521b\u5efa\u6a21\u62df\u5bf9\u8c61\u3002 \u4f7f\u7528 <code>mock()</code> \u65b9\u6cd5\uff1a <pre><code>import static org.mockito.Mockito.*;\nList&lt;String&gt; mockedList = mock(List.class);\n</code></pre> \u4f7f\u7528 <code>@Mock</code> \u6ce8\u89e3\uff1a \u5728\u6d4b\u8bd5\u7c7b\u4e0a\u4f7f\u7528 <code>@ExtendWith(MockitoExtension.class)</code>\uff08JUnit 5\uff09\u6216 <code>@RunWith(MockitoJUnitRunner.class)</code>\uff08JUnit 4\uff09\uff0c\u7136\u540e\u4f7f\u7528 <code>@Mock</code> \u6ce8\u89e3\u5b57\u6bb5\u3002 <pre><code>import org.junit.jupiter.api.Test;\nimport org.junit.jupiter.api.extension.ExtendWith;\nimport org.mockito.Mock;\nimport org.mockito.junit.jupiter.MockitoExtension;\n@ExtendWith(MockitoExtension.class)\npublic class MockitoTest {\n    @Mock\n    List&lt;String&gt; mockedList;\n}\n</code></pre></p>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#_2","title":"\u8bbe\u7f6e\u6a21\u62df\u884c\u4e3a","text":"<p>\u4f7f\u7528 <code>when(...).thenReturn(...)</code> \u6765\u6307\u5b9a\u5f53\u6a21\u62df\u5bf9\u8c61\u7684\u65b9\u6cd5\u88ab\u8c03\u7528\u65f6\u8fd4\u56de\u4ec0\u4e48\u503c\u3002 <pre><code>when(mockedList.get(0)).thenReturn(\"first\");\n</code></pre> \u4e5f\u53ef\u4ee5\u8bbe\u7f6e\u629b\u51fa\u5f02\u5e38\uff1a <pre><code>when(mockedList.get(1)).thenThrow(new RuntimeException());\n</code></pre></p>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#_3","title":"\u9a8c\u8bc1\u4ea4\u4e92","text":"<p>\u9a8c\u8bc1\u6a21\u62df\u5bf9\u8c61\u7684\u65b9\u6cd5\u662f\u5426\u88ab\u8c03\u7528\uff0c\u4ee5\u53ca\u8c03\u7528\u7684\u53c2\u6570\u3001\u6b21\u6570\u7b49\u3002 <pre><code>mockedList.add(\"one\");\nmockedList.add(\"two\");\n// \u9a8c\u8bc1 mockedList \u7684 add \u65b9\u6cd5\u88ab\u8c03\u7528\u4e24\u6b21\uff0c\u53c2\u6570\u5206\u522b\u4e3a \"one\" \u548c \"two\"\nverify(mockedList, times(2)).add(anyString());\nverify(mockedList).add(\"one\");\nverify(mockedList).add(\"two\");\n// \u9a8c\u8bc1 get(0) \u88ab\u8c03\u7528\u4e00\u6b21\nverify(mockedList).get(0);\n</code></pre></p>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#3","title":"3. \u53c2\u6570\u5339\u914d\u5668","text":"<p>Mockito \u63d0\u4f9b\u53c2\u6570\u5339\u914d\u5668\uff08\u5982 <code>any()</code>, <code>eq()</code> \u7b49\uff09\u6765\u66f4\u7075\u6d3b\u5730\u5339\u914d\u53c2\u6570\u3002 <pre><code>// \u5f53\u8c03\u7528 add \u65b9\u6cd5\u65f6\uff0c\u65e0\u8bba\u53c2\u6570\u662f\u4ec0\u4e48\uff0c\u90fd\u8fd4\u56de true\nwhen(mockedList.add(anyString())).thenReturn(true);\n// \u9a8c\u8bc1 add \u65b9\u6cd5\u88ab\u8c03\u7528\uff0c\u53c2\u6570\u4e3a \"someString\"\nverify(mockedList).add(eq(\"someString\"));\n</code></pre></p>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#4","title":"4. \u9a8c\u8bc1\u8c03\u7528\u987a\u5e8f","text":"<p>\u53ef\u4ee5\u4f7f\u7528 <code>InOrder</code> \u6765\u9a8c\u8bc1\u591a\u4e2a\u6a21\u62df\u5bf9\u8c61\u7684\u8c03\u7528\u987a\u5e8f\u3002 <pre><code>InOrder inOrder = inOrder(mockedList);\ninOrder.verify(mockedList).add(\"first\");\ninOrder.verify(mockedList).add(\"second\");\n</code></pre></p>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#5-stubbing-consecutive-calls","title":"5. \u5b58\u6839\u8fde\u7eed\u8c03\u7528\uff08Stubbing Consecutive Calls\uff09","text":"<p>\u5bf9\u4e8e\u540c\u4e00\u4e2a\u65b9\u6cd5\u8c03\u7528\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u8fde\u7eed\u7684\u4e0d\u540c\u884c\u4e3a\u3002 <pre><code>when(mockedList.get(anyInt()))\n    .thenReturn(\"first\")\n    .thenReturn(\"second\")\n    .thenThrow(new RuntimeException());\n// \u7b2c\u4e00\u6b21\u8c03\u7528\u8fd4\u56de \"first\"\nSystem.out.println(mockedList.get(0)); // \"first\"\n// \u7b2c\u4e8c\u6b21\u8c03\u7528\u8fd4\u56de \"second\"\nSystem.out.println(mockedList.get(0)); // \"second\"\n// \u7b2c\u4e09\u6b21\u8c03\u7528\u629b\u51fa\u5f02\u5e38\nSystem.out.println(mockedList.get(0)); // \u629b\u51fa RuntimeException\n</code></pre></p>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#6","title":"6. \u53c2\u6570\u6355\u83b7","text":"<p>\u4f7f\u7528 <code>ArgumentCaptor</code> \u6765\u6355\u83b7\u65b9\u6cd5\u8c03\u7528\u7684\u53c2\u6570\uff0c\u4ee5\u4fbf\u8fdb\u884c\u8fdb\u4e00\u6b65\u65ad\u8a00\u3002 <pre><code>ArgumentCaptor&lt;String&gt; captor = ArgumentCaptor.forClass(String.class);\nverify(mockedList).add(captor.capture());\nassertEquals(\"capturedValue\", captor.getValue());\n</code></pre></p>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#7-spy","title":"7. \u90e8\u5206\u6a21\u62df\uff08Spy\uff09","text":"<p><code>Spy</code> \u662f\u5bf9\u771f\u5b9e\u5bf9\u8c61\u7684\u5305\u88c5\uff0c\u9ed8\u8ba4\u4f1a\u8c03\u7528\u771f\u5b9e\u65b9\u6cd5\uff0c\u4f46\u4f60\u53ef\u4ee5\u9009\u62e9\u6027\u5730\u5bf9\u67d0\u4e9b\u65b9\u6cd5\u8fdb\u884c\u6a21\u62df\u3002 <pre><code>List&lt;String&gt; realList = new ArrayList&lt;&gt;();\nList&lt;String&gt; spiedList = spy(realList);\n// \u53ef\u4ee5\u8bbe\u7f6e\u67d0\u4e9b\u65b9\u6cd5\u7684\u884c\u4e3a\ndoReturn(\"mockValue\").when(spiedList).get(0);\n// \u5176\u4ed6\u65b9\u6cd5\u4f1a\u8c03\u7528\u771f\u5b9e\u5bf9\u8c61\u7684\u65b9\u6cd5\nspiedList.add(\"realValue\");\nassertEquals(1, spiedList.size());\n</code></pre></p>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#8","title":"8. \u91cd\u7f6e\u6a21\u62df\u5bf9\u8c61","text":"<p>\u901a\u5e38\u4e0d\u5efa\u8bae\u5728\u6d4b\u8bd5\u4e2d\u91cd\u7f6e\u6a21\u62df\u5bf9\u8c61\uff0c\u56e0\u4e3a\u8fd9\u53ef\u80fd\u610f\u5473\u7740\u6d4b\u8bd5\u4e0d\u591f\u72ec\u7acb\u3002\u4f46\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>reset()</code> \u65b9\u6cd5\uff1a <pre><code>reset(mockedList);\n</code></pre></p>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#9-bdd","title":"9. \u884c\u4e3a\u9a71\u52a8\u5f00\u53d1\uff08BDD\uff09\u98ce\u683c","text":"<p>Mockito \u652f\u6301 BDD \u98ce\u683c\u7684 API\uff0c\u4f7f\u7528 <code>given(...).willReturn(...)</code> \u7b49\u3002 <pre><code>import static org.mockito.BDDMockito.*;\ngiven(mockedList.get(0)).willReturn(\"first\");\n</code></pre></p>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#10","title":"10. \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u4e0d\u8981\u6a21\u62df\u4e0d\u53ef\u9760\u7684\u5bf9\u8c61\uff08\u5982\u503c\u5bf9\u8c61\uff09\u3002</li> <li>\u907f\u514d\u8fc7\u5ea6\u4f7f\u7528\u6a21\u62df\uff0c\u5c3d\u91cf\u4f7f\u7528\u771f\u5b9e\u5bf9\u8c61\uff08\u5982\u4f7f\u7528\u5185\u5b58\u6570\u636e\u5e93\u4ee3\u66ff\u6a21\u62df\u6570\u636e\u5e93\uff09\u3002</li> <li>\u6bcf\u4e2a\u6d4b\u8bd5\u5e94\u8be5\u53ea\u6d4b\u8bd5\u4e00\u4ef6\u4e8b\u60c5\uff0c\u9a8c\u8bc1\u7684\u4ea4\u4e92\u4e5f\u5e94\u8be5\u5c3d\u91cf\u7b80\u6d01\u3002</li> </ul>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#_4","title":"\u6700\u4f73\u5b9e\u8df5","text":"<ol> <li>3A\u539f\u5219\uff1a</li> <li>Arrange\uff1a\u521d\u59cb\u5316\u6a21\u62df\u5bf9\u8c61\u548c\u5b58\u6839</li> <li>Act\uff1a\u6267\u884c\u88ab\u6d4b\u8bd5\u65b9\u6cd5</li> <li> <p>Assert\uff1a\u9a8c\u8bc1\u7ed3\u679c\u548c\u4ea4\u4e92</p> </li> <li> <p>\u907f\u514d\u8fc7\u5ea6\u6a21\u62df\uff1a</p> </li> <li>\u53ea\u6a21\u62df\u5916\u90e8\u4f9d\u8d56\uff08\u5982\u6570\u636e\u5e93\u3001\u7f51\u7edc\u670d\u52a1\uff09</li> <li> <p>\u4e0d\u8981\u6a21\u62df\u503c\u5bf9\u8c61\u6216\u5de5\u5177\u7c7b</p> </li> <li> <p>\u7ec4\u5408JUnit\u4f7f\u7528\uff1a</p> </li> </ol> <pre><code>@ExtendWith(MockitoExtension.class) // JUnit 5\nclass ServiceTest {\n    @Mock\n    Database mockDB;\n\n    @InjectMocks\n    Service service; // \u81ea\u52a8\u6ce8\u5165\u6a21\u62df\u5bf9\u8c61\n\n    @Test\n    void testQuery() {\n        when(mockDB.query(any())).thenReturn(\"result\");\n        String res = service.executeQuery(\"SELECT\");\n        assertEquals(\"result\", res);\n    }\n}\n</code></pre>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#_5","title":"\u5e38\u89c1\u9519\u8bef\u89e3\u51b3","text":"<ul> <li>UnnecessaryStubbingException\uff1a\u79fb\u9664\u672a\u4f7f\u7528\u7684\u5b58\u6839</li> <li>ArgumentNotMatcherException\uff1a\u6df7\u5408\u5339\u914d\u5668\u4e0e\u5177\u4f53\u503c\u65f6\uff0c\u6240\u6709\u53c2\u6570\u5fc5\u987b\u7528\u5339\u914d\u5668\uff1a</li> </ul> <pre><code>// \u9519\u8bef\u793a\u4f8b\nwhen(mock.method(anyInt(), \"value\"))...\n\n// \u6b63\u786e\u5199\u6cd5\nwhen(mock.method(anyInt(), eq(\"value\")))...\n</code></pre>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#_6","title":"\u793a\u4f8b\uff1a\u4e00\u4e2a\u5b8c\u6574\u7684\u6d4b\u8bd5\u6848\u4f8b","text":"<p>\u6211\u4eec\u901a\u8fc7\u4e00\u4e2a\u5177\u4f53\u7684\u4f8b\u5b50\u6765\u4ecb\u7ecdMockito\u7684\u4f7f\u7528\u3002\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a\u7b80\u5355\u7684\u7528\u6237\u670d\u52a1\uff08UserService\uff09\uff0c\u5b83\u4f9d\u8d56\u4e8e\u7528\u6237\u4ed3\u5e93\uff08UserRepository\uff09\u3002\u6211\u4eec\u5c06\u5bf9UserService\u8fdb\u884c\u5355\u5143\u6d4b\u8bd5\uff0c\u5e76\u6a21\u62dfUserRepository\u3002</p>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#_7","title":"\u573a\u666f\u63cf\u8ff0","text":"<ul> <li><code>UserService</code> \u5305\u542b\u4e00\u4e2a\u65b9\u6cd5 <code>getUserEmail</code>\uff0c\u901a\u8fc7\u7528\u6237\u540d\u83b7\u53d6\u7528\u6237\u90ae\u7bb1\u3002</li> <li><code>UserRepository</code> \u662f\u4e00\u4e2a\u6570\u636e\u8bbf\u95ee\u63a5\u53e3\uff0c\u5305\u542b\u65b9\u6cd5 <code>findUserByUsername</code>\u3002</li> </ul>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#_8","title":"\u7c7b\u5b9a\u4e49","text":"<pre><code>// \u7528\u6237\u5b9e\u4f53\npublic class User {\n    private String username;\n    private String email;\n    // \u6784\u9020\u65b9\u6cd5\u3001getter\u548csetter\u7701\u7565\n}\n// \u7528\u6237\u4ed3\u5e93\u63a5\u53e3\npublic interface UserRepository {\n    User findUserByUsername(String username);\n}\n// \u7528\u6237\u670d\u52a1\npublic class UserService {\n    private UserRepository userRepository;\n    public UserService(UserRepository userRepository) {\n        this.userRepository = userRepository;\n    }\n    public String getUserEmail(String username) {\n        User user = userRepository.findUserByUsername(username);\n        if (user == null) {\n            return null;\n        }\n        return user.getEmail();\n    }\n}\n</code></pre>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#_9","title":"\u5355\u5143\u6d4b\u8bd5\u6b65\u9aa4","text":"<p>\u6211\u4eec\u5c06\u4f7f\u7528Mockito\u6765\u6a21\u62dfUserRepository\uff0c\u5e76\u6d4b\u8bd5UserService\u7684getUserEmail\u65b9\u6cd5\u3002</p>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#1_1","title":"1. \u6dfb\u52a0\u4f9d\u8d56","text":"<p>\u786e\u4fdd\u9879\u76ee\u4e2d\u5df2\u7ecf\u6dfb\u52a0\u4e86Mockito\u4f9d\u8d56\uff08\u5982\u4e4b\u524d\u6240\u8ff0\uff09\u3002</p>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#2_1","title":"2. \u7f16\u5199\u6d4b\u8bd5\u7c7b","text":"<p>\u4f7f\u7528JUnit 5\u548cMockito\u6269\u5c55\u3002</p> <pre><code>import org.junit.jupiter.api.Test;\nimport org.junit.jupiter.api.extension.ExtendWith;\nimport org.mockito.InjectMocks;\nimport org.mockito.Mock;\nimport org.mockito.junit.jupiter.MockitoExtension;\nimport static org.junit.jupiter.api.Assertions.*;\nimport static org.mockito.Mockito.*;\n\n@ExtendWith(MockitoExtension.class)\nclass UserServiceTest {\n    // \u4f7f\u7528@Mock\u521b\u5efa\u6a21\u62df\u5bf9\u8c61\n    @Mock\n    private UserRepository mockUserRepository;\n    // \u4f7f\u7528@InjectMocks\u521b\u5efa\u88ab\u6d4b\u8bd5\u5bf9\u8c61\n    @InjectMocks\n    private UserService userService;\n\n    @Test\n    void getUserEmail_UserExists_ReturnsEmail() {\n        // Arrange: \u8bbe\u7f6e\u6a21\u62df\u884c\u4e3a\n        String username = \"john_doe\";\n        String email = \"john@example.com\";\n        User mockUser = new User();\n        mockUser.setUsername(username);\n        mockUser.setEmail(email);\n        // \u5f53\u8c03\u7528mockUserRepository.findUserByUsername(username)\u65f6\uff0c\u8fd4\u56demockUser\n        when(mockUserRepository.findUserByUsername(username)).thenReturn(mockUser);\n        // Act: \u8c03\u7528\u88ab\u6d4b\u8bd5\u65b9\u6cd5\n        String result = userService.getUserEmail(username);\n        // Assert: \u9a8c\u8bc1\u7ed3\u679c\n        assertEquals(email, result);\n        // \u9a8c\u8bc1findUserByUsername\u88ab\u8c03\u7528\u4e86\u4e00\u6b21\uff0c\u4e14\u53c2\u6570\u662fusername\n        verify(mockUserRepository, times(1)).findUserByUsername(username);\n    }\n\n    @Test\n    void getUserEmail_UserNotExists_ReturnsNull() {\n        // Arrange\n        String username = \"non_existing\";\n        when(mockUserRepository.findUserByUsername(username)).thenReturn(null);\n        // Act\n        String result = userService.getUserEmail(username);\n        // Assert\n        assertNull(result);\n        // \u9a8c\u8bc1\u8c03\u7528\n        verify(mockUserRepository, times(1)).findUserByUsername(username);\n    }\n\n    @Test\n    void getUserEmail_ExceptionHandling() {\n        // Arrange: \u6a21\u62df\u629b\u51fa\u5f02\u5e38\n        String username = \"test\";\n        when(mockUserRepository.findUserByUsername(username))\n                .thenThrow(new RuntimeException(\"Database error\"));\n        // Act &amp; Assert: \u9a8c\u8bc1\u662f\u5426\u629b\u51fa\u5f02\u5e38\n        assertThrows(RuntimeException.class, () -&gt; userService.getUserEmail(username));\n    }\n}\n</code></pre>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#_10","title":"\u8be6\u7ec6\u89e3\u91ca","text":""},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#_11","title":"\u6ce8\u89e3\u4f7f\u7528","text":"<ul> <li><code>@ExtendWith(MockitoExtension.class)</code>\uff1a\u542f\u7528Mockito\u5bf9JUnit 5\u7684\u652f\u6301\u3002</li> <li><code>@Mock</code>\uff1a\u521b\u5efa\u4e00\u4e2a\u6a21\u62df\u7684UserRepository\u5b9e\u4f8b\u3002</li> <li><code>@InjectMocks</code>\uff1a\u521b\u5efaUserService\u5b9e\u4f8b\uff0c\u5e76\u5c06\u6a21\u62df\u7684UserRepository\u6ce8\u5165\u8fdb\u53bb\u3002</li> </ul>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#1getuseremail_userexists_returnsemail","title":"\u6d4b\u8bd5\u65b9\u6cd51\uff1a<code>getUserEmail_UserExists_ReturnsEmail</code>","text":"<ol> <li>Arrange\uff1a\u8bbe\u7f6e\u6a21\u62df\u884c\u4e3a\uff0c\u5f53\u8c03\u7528<code>mockUserRepository.findUserByUsername(\"john_doe\")</code>\u65f6\uff0c\u8fd4\u56de\u4e00\u4e2a\u9884\u8bbe\u7684User\u5bf9\u8c61\u3002</li> <li>Act\uff1a\u8c03\u7528<code>userService.getUserEmail(\"john_doe\")</code>\u3002</li> <li>Assert\uff1a</li> <li>\u9a8c\u8bc1\u8fd4\u56de\u7684\u90ae\u7bb1\u662f\u5426\u6b63\u786e\u3002</li> <li>\u4f7f\u7528<code>verify</code>\u68c0\u67e5<code>findUserByUsername</code>\u65b9\u6cd5\u88ab\u8c03\u7528\u4e86\u4e00\u6b21\uff0c\u5e76\u4e14\u53c2\u6570\u662f\"john_doe\"\u3002</li> </ol>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#2getuseremail_usernotexists_returnsnull","title":"\u6d4b\u8bd5\u65b9\u6cd52\uff1a<code>getUserEmail_UserNotExists_ReturnsNull</code>","text":"<ol> <li>Arrange\uff1a\u8bbe\u7f6e\u6a21\u62df\u884c\u4e3a\uff0c\u5f53\u8c03\u7528<code>findUserByUsername</code>\u65f6\u8fd4\u56denull\uff08\u6a21\u62df\u7528\u6237\u4e0d\u5b58\u5728\uff09\u3002</li> <li>Act\uff1a\u8c03\u7528\u88ab\u6d4b\u8bd5\u65b9\u6cd5\u3002</li> <li>Assert\uff1a\u9a8c\u8bc1\u8fd4\u56de\u7ed3\u679c\u4e3anull\uff0c\u5e76\u9a8c\u8bc1\u65b9\u6cd5\u8c03\u7528\u3002</li> </ol>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#3getuseremail_exceptionhandling","title":"\u6d4b\u8bd5\u65b9\u6cd53\uff1a<code>getUserEmail_ExceptionHandling</code>","text":"<ol> <li>Arrange\uff1a\u8bbe\u7f6e\u6a21\u62df\u884c\u4e3a\uff0c\u5f53\u8c03\u7528<code>findUserByUsername</code>\u65f6\u629b\u51fa\u5f02\u5e38\uff08\u6a21\u62df\u6570\u636e\u5e93\u9519\u8bef\uff09\u3002</li> <li>Act &amp; Assert\uff1a\u4f7f\u7528<code>assertThrows</code>\u9a8c\u8bc1\u8c03\u7528\u88ab\u6d4b\u8bd5\u65b9\u6cd5\u65f6\u629b\u51fa\u4e86\u5f02\u5e38\u3002</li> </ol>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#_12","title":"\u9ad8\u7ea7\u7528\u6cd5","text":""},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#_13","title":"\u9ad8\u7ea7\u4f7f\u7528\u793a\u4f8b\uff1a\u53c2\u6570\u6355\u83b7","text":"<p>\u5047\u8bbe\u6211\u4eec\u60f3\u8981\u6355\u83b7\u4f20\u9012\u7ed9<code>findUserByUsername</code>\u65b9\u6cd5\u7684\u53c2\u6570\uff0c\u53ef\u4ee5\u8fd9\u6837\u505a\uff1a <pre><code>@Test\nvoid getUserEmail_ArgumentCapture() {\n    String username = \"john_doe\";\n    User mockUser = new User();\n    mockUser.setEmail(\"john@example.com\");\n    when(mockUserRepository.findUserByUsername(username)).thenReturn(mockUser);\n    // \u6267\u884c\u65b9\u6cd5\n    userService.getUserEmail(username);\n    // \u521b\u5efa\u53c2\u6570\u6355\u83b7\u5668\n    ArgumentCaptor&lt;String&gt; usernameCaptor = ArgumentCaptor.forClass(String.class);\n    verify(mockUserRepository).findUserByUsername(usernameCaptor.capture());\n    // \u83b7\u53d6\u6355\u83b7\u7684\u53c2\u6570\u503c\n    String capturedUsername = usernameCaptor.getValue();\n    assertEquals(username, capturedUsername);\n}\n</code></pre></p>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#spy","title":"\u90e8\u5206\u6a21\u62df\uff08Spy\uff09\u793a\u4f8b","text":"<p>\u5982\u679c\u6211\u4eec\u9700\u8981\u6d4b\u8bd5\u4e00\u4e2a\u7c7b\u4e2d\u7684\u90e8\u5206\u65b9\u6cd5\uff0c\u800c\u5176\u4ed6\u65b9\u6cd5\u9700\u8981\u771f\u5b9e\u8c03\u7528\uff0c\u53ef\u4ee5\u4f7f\u7528Spy\u3002 \u5047\u8bbeUserService\u4e2d\u6709\u4e00\u4e2a\u5185\u90e8\u65b9\u6cd5\uff0c\u6211\u4eec\u4e0d\u60f3\u6a21\u62df\uff0c\u4f46\u60f3\u6a21\u62df\u4f9d\u8d56\u9879\uff1a <pre><code>public class UserService {\n    // ... \u5176\u4ed6\u4ee3\u7801\u540c\u4e0a\n    public String getUserEmailUpperCase(String username) {\n        String email = getUserEmail(username);\n        return email != null ? email.toUpperCase() : null;\n    }\n}\n</code></pre> \u6d4b\u8bd5<code>getUserEmailUpperCase</code>\u65b9\u6cd5\uff0c\u4f46\u53ea\u6a21\u62df<code>getUserEmail</code>\u65b9\u6cd5\uff08\u6ce8\u610f\uff1a\u8fd9\u4e2a\u4f8b\u5b50\u53ef\u80fd\u4e0d\u592a\u7b26\u5408\u5b9e\u9645\uff0c\u56e0\u4e3a\u901a\u5e38\u6211\u4eec\u4e0d\u4f1a\u5bf9\u540c\u4e00\u4e2a\u7c7b\u4e2d\u7684\u65b9\u6cd5\u8fdb\u884c\u6a21\u62df\uff0c\u8fd9\u91cc\u4ec5\u6f14\u793aSpy\u7684\u7528\u6cd5\uff09\uff1a <pre><code>@Test\nvoid getUserEmailUpperCase_SpyExample() {\n    // \u6ce8\u610f\uff1a\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528Spy\u5305\u88c5\u771f\u5b9e\u7684UserService\u5bf9\u8c61\uff0c\u4f46\u9700\u8981\u786e\u4fdd\u4f9d\u8d56\u9879\u5df2\u7ecf\u88ab\u6a21\u62df\n    UserService spyUserService = spy(userService);\n    // \u6a21\u62dfgetUserEmail\u65b9\u6cd5\n    doReturn(\"john@example.com\").when(spyUserService).getUserEmail(\"john_doe\");\n    // \u8c03\u7528\n    String result = spyUserService.getUserEmailUpperCase(\"john_doe\");\n    assertEquals(\"JOHN@EXAMPLE.COM\", result);\n}\n</code></pre> \u6ce8\u610f\uff1a\u4f7f\u7528Spy\u65f6\uff0c\u5982\u679c\u6a21\u62df\u7684\u65b9\u6cd5\u6709\u53c2\u6570\uff0c\u9700\u8981\u786e\u4fdd\u4f20\u9012\u7684\u53c2\u6570\u5339\u914d\uff0c\u5426\u5219\u4f1a\u8c03\u7528\u771f\u5b9e\u65b9\u6cd5\u3002</p>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#mockito_1","title":"\u4f7f\u7528 Mockito \u6a21\u62df\u9759\u6001\u65b9\u6cd5\u8be6\u89e3","text":"<p>\u6211\u4eec\u4f7f\u7528Mockito 3.4.0\u53ca\u4ee5\u4e0a\u7248\u672c\u53ef\u4ee5\u6a21\u62df\u9759\u6001\u65b9\u6cd5\uff0c\u56e0\u4e3a\u4ece\u8be5\u7248\u672c\u5f00\u59cbMockito\u652f\u6301\u5185\u8054\u6a21\u62df\uff08inline mock maker\uff09\uff0c\u4ece\u800c\u53ef\u4ee5\u6a21\u62df\u9759\u6001\u65b9\u6cd5\u3002  \u6ce8\u610f\uff1a\u5728\u4e4b\u524d\u7684\u7248\u672c\u4e2d\uff0c\u6a21\u62df\u9759\u6001\u65b9\u6cd5\u9700\u8981\u4f7f\u7528PowerMock\u7b49\u6269\u5c55\u5de5\u5177\u3002  \u4ee5\u4e0b\u662f\u4f7f\u7528Mockito\u6a21\u62df\u9759\u6001\u65b9\u6cd5\u7684\u6b65\u9aa4\u548c\u793a\u4f8b\uff1a  \u6b65\u9aa4\uff1a  1. \u6dfb\u52a0\u4f9d\u8d56 mockito-inline\uff08\u786e\u4fddmockito-core\u7248\u672c\u81f3\u5c11\u4e3a3.4.0\uff09  2. \u5728\u6d4b\u8bd5\u7c7b\u4e0a\u4f7f\u7528@ExtendWith(MockitoExtension.class)\uff08JUnit5\uff09\u6216\u4f7f\u7528MockitoRule\uff08JUnit4\uff09  3. \u4f7f\u7528MockedStatic\u6765\u6a21\u62df\u9759\u6001\u65b9\u6cd5\uff0c\u5e76\u901a\u8fc7try-with-resources\u6216\u663e\u5f0f\u5173\u95ed\u6765\u7ba1\u7406\u5176\u4f5c\u7528\u57df"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#_14","title":"\u524d\u7f6e\u6761\u4ef6","text":"<ol> <li>\u4f7f\u7528 Mockito 3.4.0+</li> <li>\u6dfb\u52a0\u4f9d\u8d56\uff1a <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.mockito&lt;/groupId&gt;\n    &lt;artifactId&gt;mockito-inline&lt;/artifactId&gt;\n    &lt;version&gt;5.11.0&lt;/version&gt; &lt;!-- \u4f7f\u7528\u6700\u65b0\u7248\u672c --&gt;\n    &lt;scope&gt;test&lt;/scope&gt;\n&lt;/dependency&gt;\n</code></pre></li> </ol>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#_15","title":"\u57fa\u7840\u7528\u6cd5\u793a\u4f8b","text":"<pre><code>import org.junit.jupiter.api.Test;\nimport org.mockito.MockedStatic;\nimport org.mockito.Mockito;\n\nimport static org.junit.jupiter.api.Assertions.*;\nimport static org.mockito.Mockito.*;\n\nclass StaticUtils {\n    public static String getAppName() {\n        return \"RealApp\";\n    }\n\n    public static int generateId() {\n        return (int) (Math.random() * 1000);\n    }\n}\n\nclass StaticMethodTest {\n\n    @Test\n    void mockStaticMethod() {\n        // 1. \u521b\u5efa\u9759\u6001\u65b9\u6cd5\u6a21\u62df\u4f5c\u7528\u57df\n        try (MockedStatic&lt;StaticUtils&gt; mockedStatic = mockStatic(StaticUtils.class)) {\n\n            // 2. \u8bbe\u7f6e\u9759\u6001\u65b9\u6cd5\u884c\u4e3a\n            mockedStatic.when(StaticUtils::getAppName).thenReturn(\"MockedApp\");\n            mockedStatic.when(StaticUtils::generateId).thenReturn(42);\n\n            // 3. \u6267\u884c\u6d4b\u8bd5\n            assertEquals(\"MockedApp\", StaticUtils.getAppName());\n            assertEquals(42, StaticUtils.generateId());\n\n            // 4. \u9a8c\u8bc1\u8c03\u7528\n            mockedStatic.verify(StaticUtils::getAppName);\n            mockedStatic.verify(times(1), StaticUtils::generateId);\n        }\n\n        // 5. \u4f5c\u7528\u57df\u5916\u6062\u590d\u539f\u59cb\u884c\u4e3a\n        assertEquals(\"RealApp\", StaticUtils.getAppName());\n    }\n}\n</code></pre>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#_16","title":"\u9ad8\u7ea7\u529f\u80fd\u793a\u4f8b","text":""},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#1_2","title":"1. \u6a21\u62df\u5e26\u53c2\u6570\u7684\u9759\u6001\u65b9\u6cd5","text":"<pre><code>class FileUtils {\n    public static boolean exists(String path) {\n        // \u5b9e\u9645\u6587\u4ef6\u68c0\u67e5\n        return new File(path).exists();\n    }\n}\n\n@Test\nvoid mockStaticMethodWithArgs() {\n    try (MockedStatic&lt;FileUtils&gt; mocked = mockStatic(FileUtils.class)) {\n        // \u8bbe\u7f6e\u53c2\u6570\u5339\u914d\u884c\u4e3a\n        mocked.when(() -&gt; FileUtils.exists(\"/valid/path\")).thenReturn(true);\n        mocked.when(() -&gt; FileUtils.exists(anyString())).thenReturn(false);\n\n        assertTrue(FileUtils.exists(\"/valid/path\"));\n        assertFalse(FileUtils.exists(\"/invalid/path\"));\n    }\n}\n</code></pre>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#2-void","title":"2. \u6a21\u62df void \u9759\u6001\u65b9\u6cd5","text":"<pre><code>class Logger {\n    public static void logError(String message) {\n        // \u5b9e\u9645\u65e5\u5fd7\u8bb0\u5f55\n        System.err.println(\"ERROR: \" + message);\n    }\n}\n\n@Test\nvoid mockVoidStaticMethod() {\n    try (MockedStatic&lt;Logger&gt; mocked = mockStatic(Logger.class)) {\n        // \u6355\u83b7\u53c2\u6570\n        ArgumentCaptor&lt;String&gt; captor = ArgumentCaptor.forClass(String.class);\n\n        // \u8bbe\u7f6evoid\u65b9\u6cd5\u884c\u4e3a\n        mocked.when(() -&gt; Logger.logError(anyString())).thenAnswer(invocation -&gt; {\n            System.out.println(\"Mocked: \" + invocation.getArgument(0));\n            return null;\n        });\n\n        // \u8c03\u7528\u65b9\u6cd5\n        Logger.logError(\"Test Error\");\n\n        // \u9a8c\u8bc1\n        mocked.verify(() -&gt; Logger.logError(captor.capture()));\n        assertEquals(\"Test Error\", captor.getValue());\n    }\n}\n</code></pre>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#3_1","title":"3. \u591a\u6b21\u8c03\u7528\u8fd4\u56de\u4e0d\u540c\u503c","text":"<pre><code>@Test\nvoid mockConsecutiveCalls() {\n    try (MockedStatic&lt;StaticUtils&gt; mocked = mockStatic(StaticUtils.class)) {\n        mocked.when(StaticUtils::generateId)\n             .thenReturn(100)\n             .thenReturn(200)\n             .thenThrow(new RuntimeException(\"DB Error\"));\n\n        assertEquals(100, StaticUtils.generateId());\n        assertEquals(200, StaticUtils.generateId());\n        assertThrows(RuntimeException.class, StaticUtils::generateId);\n    }\n}\n</code></pre>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#4_1","title":"4. \u90e8\u5206\u6a21\u62df\u9759\u6001\u7c7b","text":"<pre><code>@Test\nvoid partialMockStaticClass() {\n    try (MockedStatic&lt;StaticUtils&gt; mocked = mockStatic(StaticUtils.class)) {\n        // \u6a21\u62df\u7279\u5b9a\u65b9\u6cd5\n        mocked.when(StaticUtils::generateId).thenReturn(999);\n\n        // \u5176\u4ed6\u65b9\u6cd5\u4fdd\u6301\u539f\u59cb\u884c\u4e3a\n        mocked.when(StaticUtils::getAppName).thenCallRealMethod();\n\n        assertEquals(999, StaticUtils.generateId());\n        assertEquals(\"RealApp\", StaticUtils.getAppName()); // \u8c03\u7528\u771f\u5b9e\u65b9\u6cd5\n    }\n}\n</code></pre>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#_17","title":"\u6700\u4f73\u5b9e\u8df5","text":"<ol> <li> <p>\u4f7f\u7528 try-with-resources \u786e\u4fdd\u8d44\u6e90\u91ca\u653e <pre><code>// \u6b63\u786e\u505a\u6cd5\ntry (MockedStatic&lt;MyClass&gt; mocked = mockStatic(MyClass.class)) {\n    // \u6d4b\u8bd5\u4ee3\u7801\n}\n\n// \u907f\u514d\uff08\u53ef\u80fd\u5fd8\u8bb0\u5173\u95ed\uff09\nMockedStatic&lt;MyClass&gt; mocked = mockStatic(MyClass.class);\n// \u6d4b\u8bd5\u4ee3\u7801\nmocked.close(); // \u5bb9\u6613\u5fd8\u8bb0\n</code></pre></p> </li> <li> <p>\u4f5c\u7528\u57df\u6700\u5c0f\u5316\u539f\u5219 <pre><code>@Test\nvoid testMethod() {\n    // \u53ea\u5728\u9700\u8981\u7684\u65b9\u6cd5\u5185\u521b\u5efa\u6a21\u62df\u4f5c\u7528\u57df\n    try (MockedStatic&lt;A&gt; mockA = mockStatic(A.class)) {\n        // \u6d4b\u8bd5A\n    }\n\n    try (MockedStatic&lt;B&gt; mockB = mockStatic(B.class)) {\n        // \u6d4b\u8bd5B\n    }\n}\n</code></pre></p> </li> <li> <p>\u7ed3\u5408 JUnit 5 \u6269\u5c55 <pre><code>@ExtendWith(MockitoExtension.class)\nclass AdvancedTest {\n    @Test\n    void testWithStaticMock() {\n        try (MockedStatic&lt;StaticUtils&gt; mocked = mockStatic(StaticUtils.class)) {\n            // \u6d4b\u8bd5\u4ee3\u7801\n        }\n    }\n}\n</code></pre></p> </li> </ol>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#_18","title":"\u5e38\u89c1\u95ee\u9898\u89e3\u51b3","text":"<p>\u95ee\u98981\uff1a<code>MockitoException: Mockito cannot mock static methods in this environment</code> \u2794 \u786e\u4fdd\uff1a 1. \u4f7f\u7528 <code>mockito-inline</code> \u4f9d\u8d56 2. Java \u7248\u672c &gt;= 8 3. \u672a\u4e0e\u5176\u4ed6\u6a21\u62df\u6846\u67b6\u51b2\u7a81</p> <p>\u95ee\u98982\uff1a\u9759\u6001\u6a21\u62df\u672a\u751f\u6548 \u2794 \u68c0\u67e5\u662f\u5426\uff1a 1. \u5728 <code>try</code> \u4f5c\u7528\u57df\u5916\u8c03\u7528\u4e86\u65b9\u6cd5 2. \u5fd8\u8bb0\u8c03\u7528 <code>when()</code> \u8bbe\u7f6e\u884c\u4e3a 3. \u5b58\u5728\u591a\u4e2a <code>MockedStatic</code> \u5b9e\u4f8b\u51b2\u7a81</p> <p>\u95ee\u98983\uff1a\u9a8c\u8bc1\u5931\u8d25 \u2794 \u6b63\u786e\u4f7f\u7528\u9a8c\u8bc1\u8bed\u6cd5\uff1a <pre><code>try (MockedStatic&lt;Service&gt; mocked = mockStatic(Service.class)) {\n    Service.doSomething();\n\n    // \u6b63\u786e\n    mocked.verify(Service::doSomething);\n\n    // \u9519\u8bef\uff08\u4f20\u7edf\u65b9\u5f0f\u4e0d\u9002\u7528\uff09\n    verify(Service).doSomething(); // \u7f16\u8bd1\u9519\u8bef\n}\n</code></pre></p>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#_19","title":"\u66ff\u4ee3\u65b9\u6848\uff08\u65e7\u7248\u672c\u517c\u5bb9\uff09","text":"<p>\u5bf9\u4e8e Mockito &lt; 3.4.0\uff0c\u4f7f\u7528 PowerMock\uff1a</p> <pre><code>@RunWith(PowerMockRunner.class)\n@PrepareForTest(StaticUtils.class)\npublic class LegacyTest {\n\n    @Test\n    public void testStaticMock() {\n        // 1. \u51c6\u5907\u9759\u6001\u7c7b\n        PowerMockito.mockStatic(StaticUtils.class);\n\n        // 2. \u8bbe\u7f6e\u884c\u4e3a\n        when(StaticUtils.getAppName()).thenReturn(\"PowerMockApp\");\n\n        // 3. \u6d4b\u8bd5\n        assertEquals(\"PowerMockApp\", StaticUtils.getAppName());\n    }\n}\n</code></pre> <p>\u5b98\u65b9\u5efa\u8bae\uff1a\u4f18\u5148\u5347\u7ea7\u5230 Mockito 3.4+ \u4f7f\u7528\u5185\u7f6e\u9759\u6001\u6a21\u62df\uff0c\u907f\u514d\u5f15\u5165\u989d\u5916\u7684 PowerMock \u4f9d\u8d56</p>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#_20","title":"\u91cd\u8981\u6ce8\u610f\u4e8b\u9879","text":"<ol> <li>\u7ebf\u7a0b\u5b89\u5168\uff1a\u9759\u6001\u6a21\u62df\u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u786e\u4fdd\u5728\u5355\u7ebf\u7a0b\u4e2d\u4f7f\u7528</li> <li>\u6027\u80fd\u5f71\u54cd\uff1a\u9759\u6001\u6a21\u62df\u4f1a\u4fee\u6539\u7c7b\u52a0\u8f7d\u5668\uff0c\u53ef\u80fd\u7565\u5fae\u589e\u52a0\u6d4b\u8bd5\u65f6\u95f4</li> <li>\u8bbe\u8ba1\u8b66\u544a\uff1a\u9700\u5927\u91cf\u9759\u6001\u6a21\u62df\u53ef\u80fd\u610f\u5473\u7740\u4ee3\u7801\u9700\u8981\u91cd\u6784\uff08\u8003\u8651\u4f9d\u8d56\u6ce8\u5165\u66ff\u4ee3\uff09</li> <li>\u4f5c\u7528\u57df\uff1a\u6bcf\u4e2a <code>MockedStatic</code> \u5b9e\u4f8b\u53ea\u5f71\u54cd\u5176\u4f5c\u7528\u57df\u5185\u7684\u8c03\u7528</li> </ol> <p>\u9759\u6001\u65b9\u6cd5\u6a21\u62df\u5e94\u4f5c\u4e3a\u6700\u540e\u624b\u6bb5\uff0c\u4f18\u5148\u8003\u8651\u91cd\u6784\u4ee3\u7801\uff1a <pre><code>// \u91cd\u6784\u524d\nclass OrderService {\n    public void process(Order order) {\n        if (ValidationUtils.isValid(order)) { // \u9759\u6001\u8c03\u7528\n            // ...\n        }\n    }\n}\n\n// \u91cd\u6784\u540e\uff08\u53ef\u6d4b\u8bd5\u6027\u66f4\u597d\uff09\nclass OrderService {\n    private final Validator validator; // \u4f9d\u8d56\u6ce8\u5165\n\n    public void process(Order order) {\n        if (validator.isValid(order)) { \n            // ...\n        }\n    }\n}\n</code></pre></p> <p>\u5b98\u65b9\u6587\u6863\u53c2\u8003\uff1aMockito Static Methods</p>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#_21","title":"\u603b\u7ed3","text":"<p>\u901a\u8fc7\u4ee5\u4e0a\u793a\u4f8b\uff0c\u6211\u4eec\u5c55\u793a\u4e86Mockito\u7684\u6838\u5fc3\u529f\u80fd\uff1a - \u521b\u5efa\u6a21\u62df\u5bf9\u8c61\uff08<code>@Mock</code>\uff09 - \u8bbe\u7f6e\u6a21\u62df\u884c\u4e3a\uff08<code>when().thenReturn()</code>\uff09 - \u9a8c\u8bc1\u4ea4\u4e92\uff08<code>verify()</code>\uff09 - \u53c2\u6570\u6355\u83b7\uff08<code>ArgumentCaptor</code>\uff09 - \u90e8\u5206\u6a21\u62df\uff08<code>spy</code>\uff09 \u8fd9\u4e9b\u6280\u672f\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u7f16\u5199\u9694\u79bb\u7684\u3001\u5feb\u901f\u7684\u5355\u5143\u6d4b\u8bd5\uff0c\u4e13\u6ce8\u4e8e\u88ab\u6d4b\u8bd5\u7c7b\u7684\u884c\u4e3a\uff0c\u800c\u4e0d\u53d7\u4f9d\u8d56\u9879\u7684\u5236\u7ea6\u3002</p> <p>\u4ee5\u4e0a\u662f Mockito \u7684\u57fa\u672c\u4f7f\u7528\u4ecb\u7ecd\u3002Mockito \u8fd8\u6709\u66f4\u591a\u9ad8\u7ea7\u529f\u80fd\uff0c\u5177\u4f53\u53ef\u4ee5\u53c2\u8003 Mockito \u5b98\u65b9\u6587\u6863\u3002</p>"},{"location":"java/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#_22","title":"\u8d44\u6e90\u63a8\u8350","text":"<ul> <li>\u5b98\u65b9\u6587\u6863</li> <li>Mockito GitHub</li> <li>\u300aEffective Unit Testing\u300bby Lasse Koskela</li> </ul> <p>Mockito \u80fd\u663e\u8457\u63d0\u5347\u6d4b\u8bd5\u7684\u9694\u79bb\u6027\u548c\u6267\u884c\u901f\u5ea6\uff0c\u662f\u7f16\u5199\u9ad8\u8d28\u91cf\u5355\u5143\u6d4b\u8bd5\u7684\u5229\u5668\u3002</p>"},{"location":"java/Mockito%E7%9A%84%E5%B8%B8%E8%A7%81%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E5%8F%8A%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/","title":"Mockito\u7684\u5e38\u89c1\u6838\u5fc3\u529f\u80fd\u53ca\u6700\u4f73\u5b9e\u8df5","text":"<p>Mockito \u662f\u4e00\u4e2a\u6d41\u884c\u7684 Java \u5355\u5143\u6d4b\u8bd5\u6a21\u62df\u6846\u67b6\uff0c\u5b83\u7684\u6838\u5fc3\u529f\u80fd\u5305\u62ec\uff1a\u521b\u5efa\u6a21\u62df\u5bf9\u8c61\u3001\u8bbe\u7f6e\u6a21\u62df\u884c\u4e3a\u3001\u9a8c\u8bc1\u4ea4\u4e92\u3002\u5b83\u80fd\u591f\u5e2e\u52a9\u4f60\u5728\u6d4b\u8bd5\u4e2d\u9694\u79bb\u5916\u90e8\u4f9d\u8d56\uff0c\u4f7f\u5f97\u6d4b\u8bd5\u66f4\u52a0\u4e13\u6ce8\u4e8e\u88ab\u6d4b\u8bd5\u7c7b\u7684\u884c\u4e3a\u3002\u4ee5\u4e0b\u662f Mockito \u5e38\u89c1\u529f\u80fd\u3001\u6ce8\u610f\u4e8b\u9879\u548c\u6700\u4f73\u5b9e\u8df5\uff1a</p>"},{"location":"java/Mockito%E7%9A%84%E5%B8%B8%E8%A7%81%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E5%8F%8A%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#_1","title":"\u4e00\u3001\u6838\u5fc3\u529f\u80fd\u6982\u89c8","text":"\u529f\u80fd\u7c7b\u522b \u5173\u952e\u65b9\u6cd5 \u5e94\u7528\u573a\u666f \u793a\u4f8b \u5bf9\u8c61\u6a21\u62df <code>mock()</code>, <code>@Mock</code>, <code>@InjectMocks</code> \u521b\u5efa\u5916\u90e8\u4f9d\u8d56\u7684\u6a21\u62df\u5bf9\u8c61 <code>List&lt;String&gt; mockList = mock(ArrayList.class)</code> \u884c\u4e3a\u6a21\u62df <code>when().thenReturn()</code>, <code>doReturn()</code> \u5b9a\u4e49\u65b9\u6cd5\u8c03\u7528\u7684\u8fd4\u56de\u503c <code>when(mock.get(0)).thenReturn(\"value\")</code> \u5f02\u5e38\u6a21\u62df <code>thenThrow()</code>, <code>doThrow()</code> \u6d4b\u8bd5\u5f02\u5e38\u5904\u7406\u903b\u8f91 <code>when(mock.save()).thenThrow(new DBException())</code> \u53c2\u6570\u5339\u914d\u5668 <code>any()</code>, <code>eq()</code>, <code>argThat()</code> \u7075\u6d3b\u5339\u914d\u65b9\u6cd5\u53c2\u6570 <code>verify(mock).save(argThat(u -&gt; u.age &gt; 18))</code> \u8c03\u7528\u9a8c\u8bc1 <code>verify()</code>, <code>times()</code>, <code>never()</code> \u9a8c\u8bc1\u65b9\u6cd5\u662f\u5426\u6309\u9884\u671f\u8c03\u7528 <code>verify(mock, times(2)).update()</code> \u53c2\u6570\u6355\u83b7 <code>ArgumentCaptor</code> \u6355\u83b7\u65b9\u6cd5\u8c03\u7528\u53c2\u6570\u8fdb\u884c\u65ad\u8a00 \u89c1\u4e0b\u65b9\u8be6\u7ec6\u8bf4\u660e \u90e8\u5206\u6a21\u62df(Spy) <code>spy()</code>, <code>@Spy</code> \u5305\u88c5\u771f\u5b9e\u5bf9\u8c61\u5e76\u8986\u76d6\u7279\u5b9a\u65b9\u6cd5 <code>List spyList = spy(new ArrayList())</code> \u9759\u6001\u65b9\u6cd5\u6a21\u62df <code>mockStatic()</code> (Mockito 3.4+) \u6a21\u62df\u9759\u6001\u65b9\u6cd5\u8c03\u7528 <code>try (MockedStatic&lt;Util&gt; util = mockStatic(Util.class)) {...}</code> \u8c03\u7528\u987a\u5e8f\u9a8c\u8bc1 <code>InOrder</code> \u9a8c\u8bc1\u591a\u4e2a\u8c03\u7528\u7684\u6267\u884c\u987a\u5e8f \u89c1\u4e0b\u65b9\u8be6\u7ec6\u8bf4\u660e"},{"location":"java/Mockito%E7%9A%84%E5%B8%B8%E8%A7%81%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E5%8F%8A%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#_2","title":"\u4e8c\u3001\u3010\u91cd\u70b9\u3011\u6ce8\u610f\u4e8b\u9879","text":"<p>\u5173\u952e\u539f\u5219\uff1a\u53ea\u6a21\u62df\u5916\u90e8\u4f9d\u8d56\uff08\u6570\u636e\u5e93\u3001\u7f51\u7edc\u670d\u52a1\u3001\u6587\u4ef6\u7cfb\u7edf\u7b49\uff09\uff0c\u5bf9\u6838\u5fc3\u4e1a\u52a1\u903b\u8f91\u4f7f\u7528\u771f\u5b9e\u5bf9\u8c61\u3002</p> <p>\u5178\u578b\u6d4b\u8bd5\u7ed3\u6784\uff1a</p> <ol> <li>\u521b\u5efa\u6a21\u62df\u4f9d\u8d56</li> <li>\u8bbe\u7f6e\u6a21\u62df\u884c\u4e3a</li> <li>\u6267\u884c\u6d4b\u8bd5\u65b9\u6cd5</li> <li>\u9a8c\u8bc1\u72b6\u6001\u53d8\u5316</li> <li>\u9a8c\u8bc1\u4f9d\u8d56\u4ea4\u4e92</li> </ol> <p>\u9759\u6001\u6a21\u62df\u6ce8\u610f\u4e8b\u9879</p> <ol> <li>\u7ebf\u7a0b\u5b89\u5168\uff1a\u9759\u6001\u6a21\u62df\u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u786e\u4fdd\u5728\u5355\u7ebf\u7a0b\u4e2d\u4f7f\u7528</li> <li>\u6027\u80fd\u5f71\u54cd\uff1a\u9759\u6001\u6a21\u62df\u4f1a\u4fee\u6539\u7c7b\u52a0\u8f7d\u5668\uff0c\u53ef\u80fd\u7565\u5fae\u589e\u52a0\u6d4b\u8bd5\u65f6\u95f4</li> <li>\u8bbe\u8ba1\u8b66\u544a\uff1a\u9700\u5927\u91cf\u9759\u6001\u6a21\u62df\u53ef\u80fd\u610f\u5473\u7740\u4ee3\u7801\u9700\u8981\u91cd\u6784\uff08\u8003\u8651\u4f9d\u8d56\u6ce8\u5165\u66ff\u4ee3\uff09</li> <li>\u4f5c\u7528\u57df\uff1a\u6bcf\u4e2a <code>MockedStatic</code> \u5b9e\u4f8b\u53ea\u5f71\u54cd\u5176\u4f5c\u7528\u57df\u5185\u7684\u8c03\u7528</li> <li>\u91cd\u6784\u4ee3\u7801\uff1a\u9759\u6001\u65b9\u6cd5\u6a21\u62df\u5e94\u4f5c\u4e3a\u6700\u540e\u624b\u6bb5\uff0c\u4f18\u5148\u8003\u8651\u91cd\u6784\u4ee3\u7801</li> </ol> <p>\u9ec4\u91d1\u6cd5\u5219\uff1aMockito \u5e94\u7528\u4e8e\u89e3\u51b3\u5916\u90e8\u4f9d\u8d56\u95ee\u9898\uff0c\u800c\u975e\u63a9\u76d6\u8bbe\u8ba1\u7f3a\u9677\u3002\u5f53\u53d1\u73b0\u9700\u8981\u5927\u91cf\u6a21\u62df\u624d\u80fd\u6d4b\u8bd5\u65f6\uff0c\u5e94\u8003\u8651\u91cd\u6784\u4ee3\u7801\uff1a</p> <ul> <li>\u5f15\u5165\u4f9d\u8d56\u6ce8\u5165</li> <li>\u9075\u5faa\u5355\u4e00\u804c\u8d23\u539f\u5219</li> <li>\u4f7f\u7528\u7b56\u7565\u6a21\u5f0f\u66ff\u6362\u6761\u4ef6\u903b\u8f91</li> <li>\u5c06\u9759\u6001\u5de5\u5177\u7c7b\u8f6c\u6362\u4e3a\u53ef\u6ce8\u5165\u670d\u52a1</li> </ul>"},{"location":"java/Mockito%E7%9A%84%E5%B8%B8%E8%A7%81%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E5%8F%8A%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#mockito_1","title":"\u4e09\u3001\u3010\u91cd\u70b9\u3011Mockito \u4f7f\u7528\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"java/Mockito%E7%9A%84%E5%B8%B8%E8%A7%81%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E5%8F%8A%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#1","title":"1. \u3010\u91cd\u70b9\u3011\u660e\u786e\u6d4b\u8bd5\u76ee\u6807\uff0c\u907f\u514d\u8fc7\u5ea6\u6a21\u62df","text":"<ul> <li>\u539f\u5219\uff1a\u53ea\u6a21\u62df\u5916\u90e8\u4f9d\u8d56\uff08\u5982\u6570\u636e\u5e93\u3001\u7f51\u7edc\u670d\u52a1\uff09\uff0c\u4e0d\u8981\u6a21\u62df\u88ab\u6d4b\u5bf9\u8c61\uff08SUT\uff09\u672c\u8eab\u6216\u5176\u5185\u90e8\u7ec4\u4ef6\u3002</li> <li>\u793a\u4f8b\uff1a</li> </ul> <pre><code>@Mock \nprivate UserRepository userRepository; // \u6b63\u786e\uff1a\u6a21\u62df\u5916\u90e8\u4f9d\u8d56\n@InjectMocks \nprivate UserService userService; // \u88ab\u6d4b\u5bf9\u8c61\n\n@Mock \nprivate String userName; // \u53cd\u4f8b\uff0c\u9519\u8bef\uff1a\u4e0d\u8981\u6a21\u62df\u503c\u5bf9\u8c61\uff08\u5982String, Integer\uff09\u6216\u88ab\u6d4b\u5bf9\u8c61\n</code></pre>"},{"location":"java/Mockito%E7%9A%84%E5%B8%B8%E8%A7%81%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E5%8F%8A%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#2","title":"2. \u3010\u91cd\u70b9\u3011\u4f18\u5148\u4f7f\u7528\u6ce8\u89e3\u7b80\u5316\u8bbe\u7f6e","text":"<ul> <li>\u5b9e\u8df5\uff1a\u4f7f\u7528 <code>@Mock</code> \u548c <code>@InjectMocks</code> \u6ce8\u89e3\u914d\u5408\u521d\u59cb\u5316\u65b9\u5f0f\uff08\u5982\u5728\u6d4b\u8bd5\u7c7b\u4e0a\u4f7f\u7528 <code>@ExtendWith(MockitoExtension.class)</code>\uff08JUnit 5\uff09\u6216 <code>@RunWith(MockitoJUnitRunner.class)</code>\uff08JUnit 4\uff09\uff09\u51cf\u5c11\u6837\u677f\u4ee3\u7801\u3002</li> <li>\u793a\u4f8b\uff08JUnit 5\uff09\uff1a</li> </ul> <pre><code>@ExtendWith(MockitoExtension.class)\nclass UserServiceTest {\n    @Mock \n    private UserRepository userRepository;\n    @InjectMocks \n    private UserService userService;\n    // \u6d4b\u8bd5\u65b9\u6cd5...\n}\n</code></pre>"},{"location":"java/Mockito%E7%9A%84%E5%B8%B8%E8%A7%81%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E5%8F%8A%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#3-bdd","title":"3. \u3010\u63a8\u8350\u3011BDD\uff08\u884c\u4e3a\u9a71\u52a8\u5f00\u53d1\uff09\u98ce\u683c\u7f16\u5199\u6d4b\u8bd5","text":"<ul> <li>\u5b9e\u8df5\uff1aMockito\u652f\u6301BDD\u98ce\u683c\u7684API\uff0c\u5373 <code>given(...).willReturn(...)</code>\u7b49\uff0c\u8fd9\u53ef\u4ee5\u8ba9\u6d4b\u8bd5\u4ee3\u7801\u66f4\u7b26\u5408 <code>Given-When-Then</code> \u7ed3\u6784\uff0c\u4f7f\u7528 <code>given</code>\u3001<code>when</code>\u3001<code>then</code> \u7ed3\u6784\u63d0\u5347\u53ef\u8bfb\u6027\u3002</li> <li>\u793a\u4f8b\uff1a</li> </ul> <pre><code>@Test\nvoid getUserById_shouldReturnUser() {\n    // Given\n    User expectedUser = new User(\"Alice\");\n    given(userRepository.findById(\"alice_id\")).willReturn(expectedUser);\n    // When\n    User actualUser = userService.getUserById(\"alice_id\");\n    // Then\n    assertEquals(expectedUser, actualUser);\n}\n</code></pre>"},{"location":"java/Mockito%E7%9A%84%E5%B8%B8%E8%A7%81%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E5%8F%8A%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#4-stubbing","title":"4. \u7cbe\u786eStubbing\uff0c\u907f\u514d\u6a21\u7cca\u5339\u914d","text":"<ul> <li>\u539f\u5219\uff1a\u5c3d\u91cf\u4f7f\u7528\u5177\u4f53\u7684\u53c2\u6570\u503c\uff0c\u907f\u514d\u8fc7\u5ea6\u4f7f\u7528 <code>any()</code> \u7b49\u5339\u914d\u5668\uff0c\u9664\u975e\u786e\u5b9e\u9700\u8981\u7075\u6d3b\u6027\u3002</li> <li>\u793a\u4f8b\uff1a</li> </ul> <pre><code>// \u6b63\u4f8b\uff1a\u7cbe\u786e\u53c2\u6570\ngiven(userRepository.findById(\"alice_id\")).willReturn(alice);\n// \u53cd\u4f8b\uff1a\u6a21\u7cca\u5339\u914d\uff08\u53ef\u80fd\u63a9\u76d6\u95ee\u9898\uff09\ngiven(userRepository.findById(anyString())).willReturn(alice); // \u4efb\u4f55ID\u90fd\u8fd4\u56deAlice\uff0c\u53ef\u80fd\u4e0d\u771f\u5b9e\n</code></pre>"},{"location":"java/Mockito%E7%9A%84%E5%B8%B8%E8%A7%81%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E5%8F%8A%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#5","title":"5. \u9a8c\u8bc1\u4ea4\u4e92\u65f6\u6ce8\u91cd\u6838\u5fc3\u903b\u8f91","text":"<ul> <li>\u539f\u5219\uff1a\u53ea\u9a8c\u8bc1\u4e0e\u6d4b\u8bd5\u76ee\u6807\u76f4\u63a5\u76f8\u5173\u7684\u4ea4\u4e92\uff0c\u907f\u514d\u8fc7\u5ea6\u9a8c\u8bc1\uff08\u5982\u5185\u90e8\u5de5\u5177\u65b9\u6cd5\uff09\u3002</li> <li>\u793a\u4f8b\uff1a</li> </ul> <pre><code>// \u6b63\u4f8b\uff1a\u9a8c\u8bc1\u6838\u5fc3\u65b9\u6cd5\u88ab\u8c03\u7528\nverify(userRepository).findById(\"alice_id\");\n// \u53cd\u4f8b\uff1a\u8fc7\u5ea6\u9a8c\u8bc1\uff08\u5982\u9a8c\u8bc1\u65e5\u5fd7\u8bb0\u5f55\uff09\nverify(logService).logAccess(\"alice_id\"); // \u9664\u975e\u8fd9\u662f\u6d4b\u8bd5\u76ee\u6807\uff0c\u5426\u5219\u4e0d\u8981\u9a8c\u8bc1\n</code></pre>"},{"location":"java/Mockito%E7%9A%84%E5%B8%B8%E8%A7%81%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E5%8F%8A%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#6-spy","title":"6. \u3010\u91cd\u70b9\u3011\u8c28\u614e\u4f7f\u7528Spy","text":"<ul> <li>\u539f\u5219\uff1a\u4f18\u5148\u4f7f\u7528 <code>mock</code>\uff0c\u4ec5\u5728\u9700\u8981\u90e8\u5206\u6a21\u62df\u65f6\u4f7f\u7528 <code>spy</code>\uff08\u5982\u6d4b\u8bd5\u9057\u7559\u4ee3\u7801\uff09\u3002\u6ce8\u610f <code>spy</code> \u4f1a\u8c03\u7528\u771f\u5b9e\u65b9\u6cd5\uff0c\u53ef\u80fd\u5bfc\u81f4\u5f02\u5e38\u3002</li> <li>\u6b63\u786e\u4f7f\u7528Spy\uff1a</li> </ul> <pre><code>List&lt;String&gt; list = new ArrayList&lt;&gt;();\nList&lt;String&gt; spyList = spy(list);\n// \u6b63\u786e\uff1a\u4f7f\u7528doReturn\u907f\u514d\u8c03\u7528\u771f\u5b9e\u65b9\u6cd5\ndoReturn(100).when(spyList).size();\n// \u9519\u8bef\uff1a\u76f4\u63a5when(spyList.size())\u4f1a\u8c03\u7528\u771f\u5b9e\u65b9\u6cd5\uff08\u6b64\u65f6size()=0\uff09\nwhen(spyList.size()).thenReturn(100); // \u629b\u51faIndexOutOfBoundsException\n</code></pre>"},{"location":"java/Mockito%E7%9A%84%E5%B8%B8%E8%A7%81%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E5%8F%8A%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#7","title":"7. \u5f02\u5e38\u6d4b\u8bd5\u6807\u51c6\u5316","text":"<ul> <li>\u5b9e\u8df5\uff1a\u660e\u786e\u533a\u5206Stubbing\u5f02\u5e38\u548c\u9a8c\u8bc1\u5f02\u5e38\u3002</li> <li>\u793a\u4f8b\uff1a</li> </ul> <pre><code>@Test\nvoid updateUser_shouldThrowWhenUserNotFound() {\n    // Stubbing\uff1a\u6a21\u62df\u5f02\u5e38\n    given(userRepository.findById(\"unknown_id\")).willThrow(new UserNotFoundException());\n    // \u9a8c\u8bc1\u5f02\u5e38\n    assertThrows(UserNotFoundException.class, () -&gt; userService.updateUser(\"unknown_id\", new UserData()));\n    // \u53ef\u9009\uff1a\u9a8c\u8bc1\u4ea4\u4e92\n    verify(userRepository, never()).save(any());\n}\n</code></pre>"},{"location":"java/Mockito%E7%9A%84%E5%B8%B8%E8%A7%81%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E5%8F%8A%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#8-verifynomoreinteractions","title":"8. \u907f\u514d\u4f7f\u7528<code>verifyNoMoreInteractions</code>","text":"<ul> <li>\u539f\u56e0\uff1a\u8fc7\u5ea6\u4f7f\u7528\u4f1a\u5bfc\u81f4\u6d4b\u8bd5\u8106\u5f31\uff08\u5bf9\u65e0\u5173\u4ea4\u4e92\u654f\u611f\uff09\u3002\u66ff\u4ee3\u65b9\u6848\uff1a\u53ea\u9a8c\u8bc1\u5fc5\u8981\u7684\u4ea4\u4e92\u3002</li> <li>\u4f8b\u5916\uff1a\u5728\u9700\u8981\u4e25\u683c\u9a8c\u8bc1\u65e0\u591a\u4f59\u8c03\u7528\u65f6\uff08\u5982\u534f\u8bae\u8981\u6c42\uff09\uff0c\u53ef\u8c28\u614e\u4f7f\u7528\u3002</li> </ul>"},{"location":"java/Mockito%E7%9A%84%E5%B8%B8%E8%A7%81%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E5%8F%8A%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#9","title":"9. \u3010\u91cd\u70b9\u3011\u53ca\u65f6\u6e05\u7406\u8d44\u6e90\uff08\u6309\u9700\uff09","text":"<ul> <li>\u573a\u666f\uff1a\u4f7f\u7528 <code>MockedStatic</code>\uff08Mockito 3.4+\uff09\u6216\u9700\u8981\u91cd\u7f6emock\u65f6\u3002</li> <li>\u793a\u4f8b\uff08\u9759\u6001\u6a21\u62df\uff09\uff1a</li> </ul> <pre><code>@Test\nvoid testStaticMethod() {\n    try (MockedStatic&lt;MyUtils&gt; utils = mockStatic(MyUtils.class)) {\n        utils.when(MyUtils::generateId).thenReturn(\"fixed-id\");\n        // \u6d4b\u8bd5\u4ee3\u7801...\n    } // \u81ea\u52a8\u5173\u95ed\uff0c\u89e3\u9664\u9759\u6001\u6a21\u62df\n}\n</code></pre>"},{"location":"java/Mockito%E7%9A%84%E5%B8%B8%E8%A7%81%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E5%8F%8A%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#10","title":"10. \u4fdd\u6301\u6d4b\u8bd5\u72ec\u7acb\u6027\u548c\u53ef\u8bfb\u6027","text":"<ul> <li>\u547d\u540d\uff1a\u6d4b\u8bd5\u65b9\u6cd5\u540d\u660e\u786e\u8868\u8fbe\u610f\u56fe\uff08\u5982 <code>getUserById_whenNotFound_throwsException</code>\uff09\u3002</li> <li>\u5355\u4e00\u804c\u8d23\uff1a\u6bcf\u4e2a\u6d4b\u8bd5\u53ea\u9a8c\u8bc1\u4e00\u4e2a\u884c\u4e3a\u3002</li> <li>\u907f\u514d\u4f9d\u8d56\uff1a\u4e0d\u8981\u4f9d\u8d56\u6d4b\u8bd5\u6267\u884c\u987a\u5e8f\uff0c\u6bcf\u4e2a\u6d4b\u8bd5\u72ec\u7acb\u521d\u59cb\u5316mock\u3002</li> </ul>"},{"location":"java/Mockito%E7%9A%84%E5%B8%B8%E8%A7%81%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E5%8F%8A%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#_3","title":"\u56db\u3001\u603b\u7ed3\uff1a\u6838\u5fc3\u539f\u5219","text":"<ul> <li>\u907f\u514d\u8fc7\u5ea6\u6a21\u62df\uff1a<ul> <li>\u53ea\u6a21\u62df\u5916\u90e8\u4f9d\u8d56\uff08\u5982\u6570\u636e\u5e93\u3001\u7f51\u7edc\u670d\u52a1\uff09</li> <li>\u4e0d\u8981\u6a21\u62df\u503c\u5bf9\u8c61\uff08\u5982String/Integer\uff09\u6216\u5de5\u5177\u7c7b</li> </ul> </li> <li>3A\u539f\u5219\uff1a<ul> <li>Arrange\uff1a\u521d\u59cb\u5316\u6a21\u62df\u5bf9\u8c61\u548c\u5b58\u6839</li> <li>Act\uff1a\u6267\u884c\u88ab\u6d4b\u8bd5\u65b9\u6cd5</li> <li>Assert\uff1a\u9a8c\u8bc1\u7ed3\u679c\u548c\u4ea4\u4e92</li> </ul> </li> <li>KISS\u539f\u5219\uff1a\u4f18\u5148\u9009\u62e9\u7b80\u5355\u65b9\u6848\uff08\u5982\u7eafMockito\uff09\uff0c\u907f\u514d\u590d\u6742\u6280\u5de7\uff08\u5982PowerMock\uff09\u3002</li> <li>\u805a\u7126\u4e1a\u52a1\u4ef7\u503c\uff1a\u6d4b\u8bd5\u5e94\u9a8c\u8bc1\u4e1a\u52a1\u903b\u8f91\uff0c\u800c\u4e0d\u662f\u6846\u67b6\u4f7f\u7528\u3002</li> <li>\u91cd\u6784\u4f18\u5148\uff1a\u5f53\u6d4b\u8bd5\u96be\u4ee5\u7f16\u5199\u65f6\uff0c\u9996\u5148\u8003\u8651\u91cd\u6784\u4ee3\u7801\uff08\u5982\u4f9d\u8d56\u6ce8\u5165\u3001\u63a5\u53e3\u5206\u79bb\uff09\u3002 \u8fd9\u4e9b\u5b9e\u8df5\u8986\u76d6\u4e86\u5927\u90e8\u5206\u65e5\u5e38\u6d4b\u8bd5\u573a\u666f\uff0c\u9075\u5faa\u5b83\u4eec\u53ef\u4ee5\u663e\u8457\u63d0\u5347\u6d4b\u8bd5\u8d28\u91cf\u3002\u8bb0\u4f4f\uff0c\u597d\u7684\u6d4b\u8bd5\u5e94\u8be5\u50cf\u6587\u6863\u4e00\u6837\u6e05\u6670\u8868\u8fbe\u4ee3\u7801\u7684\u9884\u671f\u884c\u4e3a\u3002</li> </ul>"},{"location":"java/Mockito%E7%9A%84%E5%B8%B8%E8%A7%81%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E5%8F%8A%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#_4","title":"\u4e94\u3001\u8d44\u6e90\u63a8\u8350","text":"<ol> <li>\u5b98\u65b9\u6587\u6863 - \u6700\u65b0API\u53c2\u8003</li> <li>Mockito Cookbook - \u5b9e\u7528\u6280\u5de7\u5408\u96c6</li> <li>\u6d4b\u8bd5\u9a71\u52a8\u5f00\u53d1(TDD)\u5b9e\u8df5\u6307\u5357</li> <li>Effective Unit Testing- Lasse Koskela\u8457</li> </ol>"},{"location":"java/java%E4%B8%AD%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BA%BF%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/","title":"Java \u4e2d\u5982\u4f55\u5b9e\u73b0\u7ebf\u7a0b\u95f4\u901a\u4fe1","text":"<p>\u4e16\u754c\u4ee5\u75db\u543b\u6211\uff0c\u8981\u6211\u62a5\u4e4b\u4ee5\u6b4c \u2014\u2014 \u6cf0\u6208\u5c14\u300a\u98de\u9e1f\u96c6\u300b</p> <p>\u867d\u7136\u901a\u5e38\u6bcf\u4e2a\u5b50\u7ebf\u7a0b\u53ea\u9700\u8981\u5b8c\u6210\u81ea\u5df1\u7684\u4efb\u52a1\uff0c\u4f46\u662f\u6709\u65f6\u6211\u4eec\u5e0c\u671b\u591a\u4e2a\u7ebf\u7a0b\u4e00\u8d77\u5de5\u4f5c\u6765\u5b8c\u6210\u4e00\u4e2a\u4efb\u52a1\uff0c\u8fd9\u5c31\u6d89\u53ca\u5230\u7ebf\u7a0b\u95f4\u901a\u4fe1\u3002</p> <p>\u5173\u4e8e\u7ebf\u7a0b\u95f4\u901a\u4fe1\u672c\u6587\u6d89\u53ca\u5230\u7684\u65b9\u6cd5\u548c\u7c7b\u5305\u62ec\uff1a<code>thread.join()</code>\u3001<code>object.wait()</code>\u3001<code>object.notify()</code>\u3001<code>CountdownLatch</code>\u3001<code>CyclicBarrier</code>\u3001<code>FutureTask</code>\u3001<code>Callable</code>\u3002</p> <p>\u63a5\u4e0b\u6765\u5c06\u7528\u51e0\u4e2a\u4f8b\u5b50\u6765\u4ecb\u7ecd\u5982\u4f55\u5728Java\u4e2d\u5b9e\u73b0\u7ebf\u7a0b\u95f4\u901a\u4fe1\uff1a</p> <ol> <li>\u5982\u4f55\u8ba9\u4e24\u4e2a\u7ebf\u7a0b\u4f9d\u6b21\u6267\u884c\uff0c\u5373\u4e00\u4e2a\u7ebf\u7a0b\u7b49\u5f85\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\u5b8c\u6210\u540e\u518d\u6267\u884c\uff1f</li> <li>\u5982\u4f55\u8ba9\u4e24\u4e2a\u7ebf\u7a0b\u4ee5\u6307\u5b9a\u7684\u65b9\u5f0f\u6709\u5e8f\u76f8\u4ea4\u6267\u884c\uff1f</li> <li>\u6709\u56db\u4e2a\u7ebf\u7a0b\uff1aA\u3001B\u3001C\u3001D\uff0c\u5982\u4f55\u5b9e\u73b0 D \u5728 A\u3001B\u3001C \u90fd\u540c\u6b65\u6267\u884c\u5b8c\u6bd5\u540e\u6267\u884c\uff1f</li> <li>\u4e09\u4e2a\u8fd0\u52a8\u5458\u5206\u5f00\u51c6\u5907\uff0c\u7136\u540e\u5728\u6bcf\u4e2a\u4eba\u51c6\u5907\u597d\u540e\u540c\u65f6\u5f00\u59cb\u8dd1\u6b65\u3002</li> <li>\u5b50\u7ebf\u7a0b\u5b8c\u6210\u4efb\u52a1\u540e\uff0c\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9\u4e3b\u7ebf\u7a0b\u3002</li> </ol>"},{"location":"java/java%E4%B8%AD%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BA%BF%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/#1","title":"1. \u5982\u4f55\u8ba9\u4e24\u4e2a\u7ebf\u7a0b\u4f9d\u6b21\u6267\u884c\uff1f","text":"<p>\u5047\u8bbe\u6709\u4e24\u4e2a\u7ebf\u7a0b\uff1aA \u548c B\uff0c\u8fd9\u4e24\u4e2a\u7ebf\u7a0b\u90fd\u53ef\u4ee5\u6309\u7167\u987a\u5e8f\u6253\u5370\u6570\u5b57\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>public class Test01 {\n\n    public static void main(String[] args) throws InterruptedException {\n        demo1();\n    }\n\n    public static void demo1() {\n        Thread a = new Thread(() -&gt; {\n            printNumber(\"A\");\n        });\n\n        Thread b = new Thread(() -&gt; {\n            printNumber(\"B\");\n        });\n\n        a.start();\n        b.start();\n    }\n\n    public static void printNumber(String threadName) {\n        int i = 0;\n        while (i++ &lt; 3) {\n            try {\n                Thread.sleep(100);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            System.out.println(threadName + \" print: \" + i);\n        }\n    }\n\n}\n</code></pre> <p>\u5f97\u5230\u7684\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>A print: 1\nB print: 1\nB print: 2\nA print: 2\nA print: 3\nB print: 3\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230 A \u548c B \u540c\u65f6\u6253\u5370\u6570\u5b57\uff0c\u5982\u679c\u6211\u4eec\u5e0c\u671b B \u5728 A \u6267\u884c\u5b8c\u6210\u4e4b\u540e\u5f00\u59cb\u6267\u884c\uff0c\u90a3\u4e48\u53ef\u4ee5\u4f7f\u7528 <code>thread.join()</code> \u65b9\u6cd5\u5b9e\u73b0\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>public static void demo2() {\n    Thread a = new Thread(() -&gt; {\n        printNumber(\"A\");\n    });\n\n    Thread b = new Thread(() -&gt; {\n        System.out.println(\"B \u7b49\u5f85 A \u6267\u884c\");\n        try {\n            a.join();\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        printNumber(\"B\");\n    });\n\n    a.start();\n    b.start();\n}\n</code></pre> <p>\u5f97\u5230\u7684\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>B \u7b49\u5f85 A \u6267\u884c\nA print: 1\nA print: 2\nA print: 3\nB print: 1\nB print: 2\nB print: 3\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u8be5 <code>a.join()</code> \u65b9\u6cd5\u4f1a\u8ba9 B \u7b49\u5f85 A \u5b8c\u6210\u6253\u5370\u3002</p> <p><code>thread.join()</code> \u65b9\u6cd5\u7684\u4f5c\u7528\u5c31\u662f\u963b\u585e\u5f53\u524d\u7ebf\u7a0b\uff0c\u7b49\u5f85\u8c03\u7528 <code>join()</code> \u65b9\u6cd5\u7684\u7ebf\u7a0b\u6267\u884c\u5b8c\u6bd5\u540e\u518d\u6267\u884c\u540e\u9762\u7684\u4ee3\u7801\u3002</p> <p>\u67e5\u770b <code>join()</code> \u65b9\u6cd5\u7684\u6e90\u7801\uff0c\u5185\u90e8\u662f\u8c03\u7528\u4e86 <code>join(0)</code> \uff0c\u5982\u4e0b\uff1a</p> <pre><code>public final void join() throws InterruptedException {\n    join(0);\n}\n</code></pre> <p>\u67e5\u770b <code>join(0)</code> \u7684\u6e90\u7801\u5982\u4e0b\uff1a</p> <pre><code>// \u6ce8\u610f\u8fd9\u91cc\u4f7f\u7528\u4e86 sychronized \u52a0\u9501\uff0c\u9501\u5bf9\u8c61\u662f\u7ebf\u7a0b\u7684\u5b9e\u4f8b\u5bf9\u8c61\npublic final synchronized void join(long millis) throws InterruptedException {\n    long base = System.currentTimeMillis();\n    long now = 0;\n\n    if (millis &lt; 0) {\n        throw new IllegalArgumentException(\"timeout value is negative\");\n    }\n    // \u8c03\u7528 join(0) \u6267\u884c\u4e0b\u9762\u7684\u4ee3\u7801\n    if (millis == 0) {\n        // \u8fd9\u91cc\u4f7f\u7528 while \u5faa\u73af\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u907f\u514d\u865a\u5047\u5524\u9192\n        // \u5982\u679c\u5f53\u524d\u7ebf\u7a0b\u5b58\u6d3b\u5219\u8c03\u7528 wait(0), 0 \u8868\u793a\u6c38\u4e45\u7b49\u5f85\uff0c\u76f4\u5230\u8c03\u7528 notifyAll() \u6216\u8005 notify() \u65b9\u6cd5\n        // \u5f53\u7ebf\u7a0b\u7ed3\u675f\u7684\u65f6\u5019\u4f1a\u8c03\u7528 notifyAll() \u65b9\u6cd5\n        while (isAlive()) {\n            wait(0);\n        }\n    } else {\n        while (isAlive()) {\n            long delay = millis - now;\n            if (delay &lt;= 0) {\n                break;\n            }\n            wait(delay);\n            now = System.currentTimeMillis() - base;\n        }\n    }\n}\n</code></pre> <p>\u4ece\u6e90\u7801\u4e2d\u53ef\u4ee5\u770b\u51fa <code>join(long millis)</code> \u65b9\u6cd5\u662f\u901a\u8fc7 <code>wait(long timeout)</code> \uff08<code>Object</code> \u63d0\u4f9b\u7684\u65b9\u6cd5\uff09\u65b9\u6cd5\u5b9e\u73b0\u7684\uff0c\u8c03\u7528 <code>wait</code> \u65b9\u6cd5\u4e4b\u524d\uff0c\u5f53\u524d\u7ebf\u7a0b\u5fc5\u987b\u83b7\u5f97\u5bf9\u8c61\u7684\u9501\uff0c\u6240\u4ee5\u6b64 <code>join</code> \u65b9\u6cd5\u4f7f\u7528\u4e86 <code>synchronized</code> \u52a0\u9501\uff0c\u9501\u5bf9\u8c61\u662f\u7ebf\u7a0b\u7684\u5b9e\u4f8b\u5bf9\u8c61\u3002\u5176\u4e2d <code>wait(0)</code>\u65b9\u6cd5\u4f1a\u8ba9\u5f53\u524d\u7ebf\u7a0b\u963b\u585e\u7b49\u5f85\uff0c\u76f4\u5230\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u8c03\u7528\u6b64\u5bf9\u8c61\u7684 <code>notify()</code> \u6216\u8005 <code>notifyAll()</code> \u65b9\u6cd5\u624d\u4f1a\u7ee7\u7eed\u6267\u884c\u3002\u5f53\u8c03\u7528 <code>join</code> \u65b9\u6cd5\u7684\u7ebf\u7a0b\u7ed3\u675f\u7684\u65f6\u5019\u4f1a\u8c03\u7528 <code>notifyAll()</code> \u65b9\u6cd5\uff0c\u6240\u4ee5 <code>join()</code> \u65b9\u6cd5\u53ef\u4ee5\u5b9e\u73b0\u4e00\u4e2a\u7ebf\u7a0b\u7b49\u5f85\u53e6\u4e00\u4e2a\u8c03\u7528 <code>join()</code> \u7684\u7ebf\u7a0b\u7ed3\u675f\u540e\u518d\u6267\u884c\u3002</p> <p>\u865a\u5047\u5524\u9192\uff1a\u4e00\u4e2a\u7ebf\u7a0b\u5728\u6ca1\u6709\u88ab\u901a\u77e5\u3001\u4e2d\u65ad\u3001\u8d85\u65f6\u7684\u60c5\u51b5\u4e0b\u88ab\u5524\u9192\uff1b</p> <p>\u865a\u5047\u5524\u9192\u53ef\u80fd\u5bfc\u81f4\u6761\u4ef6\u4e0d\u6210\u7acb\u7684\u60c5\u51b5\u4e0b\u6267\u884c\u4ee3\u7801\uff0c\u7834\u574f\u88ab\u9501\u4fdd\u62a4\u7684\u7ea6\u675f\u5173\u7cfb\uff1b</p> <p>\u4e3a\u4ec0\u4e48\u4f7f\u7528 while \u5faa\u73af\u6765\u907f\u514d\u865a\u5047\u5524\u9192\uff1a</p> <p>\u5728 if \u5757\u4e2d\u4f7f\u7528 wait \u65b9\u6cd5\uff0c\u662f\u975e\u5e38\u5371\u9669\u7684\uff0c\u56e0\u4e3a\u4e00\u65e6\u7ebf\u7a0b\u88ab\u5524\u9192\uff0c\u5e76\u5f97\u5230\u9501\uff0c\u5c31\u4e0d\u4f1a\u518d\u5224\u65ad if \u6761\u4ef6\u800c\u6267\u884c if \u8bed\u53e5\u5757\u5916\u7684\u4ee3\u7801\uff0c\u6240\u4ee5\u5efa\u8bae\u51e1\u662f\u5148\u8981\u505a\u6761\u4ef6\u5224\u65ad\uff0c\u518d wait \u7684\u5730\u65b9\uff0c\u90fd\u4f7f\u7528 while \u5faa\u73af\u6765\u505a\uff0c\u5faa\u73af\u4f1a\u5728\u7b49\u5f85\u4e4b\u524d\u548c\u4e4b\u540e\u5bf9\u6761\u4ef6\u8fdb\u884c\u6d4b\u8bd5\u3002</p>"},{"location":"java/java%E4%B8%AD%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BA%BF%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/#2","title":"2. \u5982\u4f55\u8ba9\u4e24\u4e2a\u7ebf\u7a0b\u6309\u7167\u6307\u5b9a\u7684\u65b9\u5f0f\u6709\u5e8f\u76f8\u4ea4\uff1f","text":"<p>\u5982\u679c\u73b0\u5728\u6211\u4eec\u5e0c\u671b B\u7ebf\u7a0b\u5728 A \u7ebf\u7a0b\u6253\u5370 1 \u540e\u7acb\u5373\u6253\u5370 1\uff0c2\uff0c3\uff0c\u7136\u540e A \u7ebf\u7a0b\u7ee7\u7eed\u6253\u5370 2\uff0c3\uff0c\u90a3\u4e48\u6211\u4eec\u9700\u8981\u66f4\u7ec6\u7c92\u5ea6\u7684\u9501\u6765\u63a7\u5236\u6267\u884c\u987a\u5e8f\u3002</p> <p>\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528 <code>object.wait()</code> \u548c <code>object.notify()</code> \u65b9\u6cd5\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>public static void demo3() {\n    Object lock = new Object();\n    Thread A = new Thread(() -&gt; {\n        synchronized (lock) {\n            System.out.println(\"A 1\");\n            try {\n                lock.wait();\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            System.out.println(\"A 2\");\n            System.out.println(\"A 3\");\n        }\n    });\n\n    Thread B = new Thread(() -&gt; {\n        synchronized (lock) {\n            System.out.println(\"B 1\");\n            System.out.println(\"B 2\");\n            System.out.println(\"B 3\");\n            lock.notify();\n        }\n    });\n\n    A.start();\n    B.start();\n}\n</code></pre> <p>\u5f97\u5230\u7684\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>A 1\nB 1\nB 2\nB 3\nA 2\nA 3\n</code></pre> <p>\u4e0a\u8ff0\u4ee3\u7801\u7684\u6267\u884c\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li>\u9996\u5148\u6211\u4eec\u521b\u5efa\u4e00\u4e2a\u7531 A \u548c B \u5171\u4eab\u7684\u5bf9\u8c61\u9501\uff1a <code>lock = new Object()</code>;</li> <li>\u5f53A\u62ff\u5230\u9501\u65f6\uff0c\u5148\u6253\u53701\uff0c\u7136\u540e\u8c03\u7528<code>lock.wait()</code>\u65b9\u6cd5\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\uff0c\u7136\u540e\u4ea4\u51fa\u9501\u7684\u63a7\u5236\u6743\uff1b</li> <li>B \u4e0d\u4f1a\u88ab\u6267\u884c\uff0c\u76f4\u5230 A \u8c03\u7528\u8be5<code>lock.wait()</code>\u65b9\u6cd5\u91ca\u653e\u63a7\u5236\u6743\u5e76\u4e14 B \u83b7\u5f97\u9501\uff1b</li> <li>B\u62ff\u5230\u9501\u540e\u6253\u53701\uff0c2\uff0c3\uff0c\u7136\u540e\u8c03\u7528<code>lock.notify()</code>\u65b9\u6cd5\u5524\u9192\u6b63\u5728\u7b49\u5f85\u7684A\uff1b</li> <li>A \u5524\u9192\u540e\u7ee7\u7eed\u6253\u5370\u5269\u4f59\u7684 2\uff0c3\u3002</li> </ol> <p>\u4e3a\u4e86\u4fbf\u4e8e\u7406\u89e3\uff0c\u6211\u5c06\u4e0a\u9762\u7684\u4ee3\u7801\u6dfb\u52a0\u4e86\u65e5\u5fd7\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>public static void demo3() {\n    Object lock = new Object();\n    Thread A = new Thread(() -&gt; {\n        System.out.println(\"INFO\uff1aA \u7b49\u5f85\u83b7\u53d6\u9501\");\n        synchronized (lock) {\n            System.out.println(\"INFO\uff1aA \u83b7\u53d6\u5230\u9501\");\n            System.out.println(\"A 1\");\n            try {\n                System.out.println(\"INFO\uff1aA \u8fdb\u5165 waiting \u72b6\u6001\uff0c\u653e\u5f03\u9501\u7684\u63a7\u5236\u6743\");\n                lock.wait();\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            System.out.println(\"INFO\uff1aA \u88ab B \u5524\u9192\u7ee7\u7eed\u6267\u884c\");\n            System.out.println(\"A 2\");\n            System.out.println(\"A 3\");\n        }\n    });\n\n    Thread B = new Thread(() -&gt; {\n        System.out.println(\"INFO\uff1aB \u7b49\u5f85\u83b7\u53d6\u9501\");\n        synchronized (lock) {\n            System.out.println(\"INFO\uff1aB \u83b7\u53d6\u5230\u9501\");\n            System.out.println(\"B 1\");\n            System.out.println(\"B 2\");\n            System.out.println(\"B 3\");\n            System.out.println(\"INFO\uff1aB \u6267\u884c\u7ed3\u675f\uff0c\u8c03\u7528 notify \u65b9\u6cd5\u5524\u9192 A\");\n            lock.notify();\n        }\n    });\n\n    A.start();\n    B.start();\n}\n</code></pre> <p>\u5f97\u5230\u7684\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>INFO\uff1aA \u7b49\u5f85\u83b7\u53d6\u9501\nINFO\uff1aA \u83b7\u53d6\u5230\u9501\nA 1\nINFO\uff1aA \u8fdb\u5165 waiting \u72b6\u6001\uff0c\u653e\u5f03\u9501\u7684\u63a7\u5236\u6743\nINFO\uff1aB \u7b49\u5f85\u83b7\u53d6\u9501\nINFO\uff1aB \u83b7\u53d6\u5230\u9501\nB 1\nB 2\nB 3\nINFO\uff1aB \u6267\u884c\u7ed3\u675f\uff0c\u8c03\u7528 notify \u65b9\u6cd5\u5524\u9192 A\nINFO\uff1aA \u88ab B \u5524\u9192\u7ee7\u7eed\u6267\u884c\nA 2\nA 3\n</code></pre>"},{"location":"java/java%E4%B8%AD%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BA%BF%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/#3-d-abc","title":"3. \u7ebf\u7a0b D \u5728A\u3001B\u3001C\u90fd\u540c\u6b65\u6267\u884c\u5b8c\u6bd5\u540e\u6267\u884c","text":"<p><code>thread.join()</code> \u524d\u9762\u4ecb\u7ecd\u7684\u65b9\u6cd5\u5141\u8bb8\u4e00\u4e2a\u7ebf\u7a0b\u5728\u7b49\u5f85\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u5b8c\u6210\u8fd0\u884c\u540e\u7ee7\u7eed\u6267\u884c\u3002\u4f46\u662f\u5982\u679c\u6211\u4eec\u5c06A\u3001B\u3001C\u4f9d\u6b21\u52a0\u5165\u5230D\u7ebf\u7a0b\u4e2d\uff0c\u5c31\u4f1a\u8ba9A\u3001B\u3001C\u4f9d\u6b21\u6267\u884c\uff0c\u800c\u6211\u4eec\u5e0c\u671b\u5b83\u4eec\u4e09\u4e2a\u540c\u6b65\u8fd0\u884c\u3002</p> <p>\u6211\u4eec\u8981\u5b9e\u73b0\u7684\u76ee\u6807\u662f\uff1aA\u3001B\u3001C\u4e09\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u540c\u65f6\u5f00\u59cb\u8fd0\u884c\uff0c\u5404\u81ea\u72ec\u7acb\u8fd0\u884c\u5b8c\u6210\u540e\u901a\u77e5D\uff1bD \u4e0d\u4f1a\u5f00\u59cb\u8fd0\u884c\uff0c\u76f4\u5230 A\u3001B \u548c C \u90fd\u8fd0\u884c\u5b8c\u6bd5\u3002\u6240\u4ee5\u6211\u4eec <code>CountdownLatch</code> \u7528\u6765\u5b9e\u73b0\u8fd9\u79cd\u7c7b\u578b\u7684\u901a\u4fe1\u3002\u5b83\u7684\u57fa\u672c\u7528\u6cd5\u662f\uff1a</p> <ol> <li>\u521b\u5efa\u4e00\u4e2a\u8ba1\u6570\u5668\uff0c\u5e76\u8bbe\u7f6e\u4e00\u4e2a\u521d\u59cb\u503c\uff0c <code>CountdownLatch countDownLatch = new CountDownLatch(3)</code>;</li> <li>\u8c03\u7528<code>countDownLatch.await()</code>\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\uff0c\u76f4\u5230\u8ba1\u6570\u503c\u53d8\u4e3a0\uff1b</li> <li>\u5728\u5176\u4ed6\u7ebf\u7a0b\u8c03\u7528<code>countDownLatch.countDown()</code>\uff0c\u8be5\u65b9\u6cd5\u4f1a\u5c06\u8ba1\u6570\u503c\u51cf\u4e00\uff1b</li> <li>\u5f53\u8ba1\u6570\u5668\u7684\u503c\u53d8\u4e3a <code>0</code> \u65f6\uff0c<code>countDownLatch.await()</code>\u7b49\u5f85\u7ebf\u7a0b\u4e2d\u7684\u65b9\u6cd5\u4f1a\u7ee7\u7eed\u6267\u884c\u4e0b\u9762\u7684\u4ee3\u7801\u3002</li> </ol> <p>\u5b9e\u73b0\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>public static void runDAfterABC() {\n    int count = 3;\n    CountDownLatch countDownLatch = new CountDownLatch(count);\n    new Thread(() -&gt; {\n        System.out.println(\"INFO: D \u7b49\u5f85 A B C \u8fd0\u884c\u5b8c\u6210\");\n        try {\n            countDownLatch.await();\n            System.out.println(\"INFO: A B C \u8fd0\u884c\u5b8c\u6210\uff0cD \u5f00\u59cb\u8fd0\u884c\");\n            System.out.println(\"D is working\");\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }).start();\n\n    for (char threadName = 'A'; threadName &lt;= 'C' ; threadName++) {\n        final String name = String.valueOf(threadName);\n        new Thread(() -&gt; {\n            System.out.println(name + \" is working\");\n            try {\n                Thread.sleep(100);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            System.out.println(name + \" finished\");\n            countDownLatch.countDown();\n        }).start();\n    }\n}\n</code></pre> <p>\u5f97\u5230\u7684\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>INFO: D \u7b49\u5f85 A B C \u8fd0\u884c\u5b8c\u6210\nA is working\nB is working\nC is working\nC finished\nB finished\nA finished\nINFO: A B C \u8fd0\u884c\u5b8c\u6210\uff0cD \u5f00\u59cb\u8fd0\u884c\nD is working\n</code></pre> <p>\u5176\u5b9e<code>CountDownLatch</code>\u5b83\u672c\u8eab\u5c31\u662f\u4e00\u4e2a\u5012\u6570\u8ba1\u6570\u5668\uff0c\u6211\u4eec\u628a\u521d\u59cb\u7684count\u503c\u8bbe\u7f6e\u4e3a3\u3002D\u8fd0\u884c\u7684\u65f6\u5019\uff0c\u9996\u5148\u8c03\u7528\u8be5<code>countDownLatch.await()</code>\u65b9\u6cd5\u68c0\u67e5\u8ba1\u6570\u5668\u7684\u503c\u662f\u5426\u4e3a0\uff0c\u5982\u679c\u4e0d\u662f0\u5219\u4fdd\u6301\u7b49\u5f85\u72b6\u6001. A\u3001B\u3001C \u8fd0\u884c\u5b8c\u6bd5\u540e\uff0c\u5206\u522b\u4f7f\u7528<code>countDownLatch.countDown()</code>\u65b9\u6cd5\u5c06\u5012\u6570\u8ba1\u6570\u5668\u51cf1\u3002\u8ba1\u6570\u5668\u5c06\u51cf\u4e3a 0\uff0c\u7136\u540e\u901a\u77e5<code>await()</code>\u65b9\u6cd5\u7ed3\u675f\u7b49\u5f85\uff0cD\u5f00\u59cb\u7ee7\u7eed\u6267\u884c\u3002</p> <p>\u56e0\u6b64\uff0c<code>CountDownLatch</code>\u9002\u7528\u4e8e\u4e00\u4e2a\u7ebf\u7a0b\u9700\u8981\u7b49\u5f85\u591a\u4e2a\u7ebf\u7a0b\u7684\u60c5\u51b5\u3002</p>"},{"location":"java/java%E4%B8%AD%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BA%BF%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/#4","title":"4. \u4e09\u4e2a\u8fd0\u52a8\u5458\u5206\u5f00\u51c6\u5907\u540c\u65f6\u5f00\u8dd1","text":"<p>\u8fd9\u4e00\u6b21\uff0cA\u3001B\u3001C\u8fd9\u4e09\u4e2a\u7ebf\u7a0b\u90fd\u9700\u8981\u5206\u522b\u51c6\u5907\uff0c\u7b49\u4e09\u4e2a\u7ebf\u7a0b\u90fd\u51c6\u5907\u597d\u540e\u5f00\u59cb\u540c\u65f6\u8fd0\u884c\uff0c\u6211\u4eec\u5e94\u8be5\u5982\u4f55\u505a\u5230\u8fd9\u4e00\u70b9\uff1f</p> <p><code>CountDownLatch</code>\u53ef\u4ee5\u7528\u6765\u8ba1\u6570\uff0c\u4f46\u5b8c\u6210\u8ba1\u6570\u7684\u65f6\u5019\uff0c\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u7684\u4e00\u4e2a<code>await()</code>\u65b9\u6cd5\u4f1a\u5f97\u5230\u54cd\u5e94\uff0c\u6240\u4ee5\u591a\u7ebf\u7a0b\u4e0d\u80fd\u5728\u540c\u4e00\u65f6\u95f4\u88ab\u89e6\u53d1\u3002\u4e3a\u4e86\u8fbe\u5230\u7ebf\u7a0b\u76f8\u4e92\u7b49\u5f85\u7684\u6548\u679c\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u8be5<code>CyclicBarrier</code>\uff0c\u5176\u57fa\u672c\u7528\u6cd5\u4e3a\uff1a</p> <ol> <li>\u9996\u5148\u521b\u5efa\u4e00\u4e2a\u516c\u5171\u5bf9\u8c61<code>CyclicBarrier</code>\uff0c\u5e76\u8bbe\u7f6e\u540c\u65f6\u7b49\u5f85\u7684\u7ebf\u7a0b\u6570\uff0c<code>CyclicBarrier cyclicBarrier = new CyclicBarrier(3);</code></li> <li>\u8fd9\u4e9b\u7ebf\u7a0b\u540c\u65f6\u5f00\u59cb\u51c6\u5907\uff0c\u51c6\u5907\u597d\u540e\uff0c\u9700\u8981\u7b49\u5f85\u522b\u4eba\u51c6\u5907\u597d\uff0c\u6240\u4ee5\u8c03\u7528<code>cyclicBarrier.await()</code>\u65b9\u6cd5\u7b49\u5f85\u522b\u4eba\uff1b</li> <li>\u5f53\u6307\u5b9a\u7684\u9700\u8981\u540c\u65f6\u7b49\u5f85\u7684\u7ebf\u7a0b\u90fd\u8c03\u7528\u4e86\u8be5<code>cyclicBarrier.await()</code>\u65b9\u6cd5\u65f6\uff0c\u610f\u5473\u7740\u8fd9\u4e9b\u7ebf\u7a0b\u51c6\u5907\u597d\u4e86\uff0c\u90a3\u4e48\u8fd9\u4e9b\u7ebf\u7a0b\u5c31\u4f1a\u5f00\u59cb\u540c\u65f6\u7ee7\u7eed\u6267\u884c\u3002</li> </ol> <p>\u60f3\u8c61\u4e00\u4e0b\u6709\u4e09\u4e2a\u8dd1\u6b65\u8005\u9700\u8981\u540c\u65f6\u5f00\u59cb\u8dd1\u6b65\uff0c\u6240\u4ee5\u4ed6\u4eec\u9700\u8981\u7b49\u5f85\u5176\u4ed6\u4eba\u90fd\u51c6\u5907\u597d\uff0c\u5b9e\u73b0\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>public static void runABCWhenAllReady() {\n    int count = 3;\n    CyclicBarrier cyclicBarrier = new CyclicBarrier(count);\n    Random random = new Random();\n    for (char threadName = 'A'; threadName &lt;= 'C' ; threadName++) {\n        final String name = String.valueOf(threadName);\n        new Thread(() -&gt; {\n            int prepareTime = random.nextInt(10000);\n            System.out.println(name + \" \u51c6\u5907\u65f6\u95f4\uff1a\" + prepareTime);\n            try {\n                Thread.sleep(prepareTime);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            System.out.println(name + \" \u51c6\u5907\u597d\u4e86\uff0c\u7b49\u5f85\u5176\u4ed6\u4eba\");\n            try {\n                cyclicBarrier.await();\n            } catch (InterruptedException | BrokenBarrierException e) {\n                e.printStackTrace();\n            }\n            System.out.println(name + \" \u5f00\u59cb\u8dd1\u6b65\");\n        }).start();\n    }\n}\n</code></pre> <p>\u5f97\u5230\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>A \u51c6\u5907\u65f6\u95f4\uff1a1085\nB \u51c6\u5907\u65f6\u95f4\uff1a7729\nC \u51c6\u5907\u65f6\u95f4\uff1a8444\nA \u51c6\u5907\u597d\u4e86\uff0c\u7b49\u5f85\u5176\u4ed6\u4eba\nB \u51c6\u5907\u597d\u4e86\uff0c\u7b49\u5f85\u5176\u4ed6\u4eba\nC \u51c6\u5907\u597d\u4e86\uff0c\u7b49\u5f85\u5176\u4ed6\u4eba\nC \u5f00\u59cb\u8dd1\u6b65\nA \u5f00\u59cb\u8dd1\u6b65\nB \u5f00\u59cb\u8dd1\u6b65\n</code></pre> <p><code>CyclicBarrier</code> \u7684\u4f5c\u7528\u5c31\u662f\u7b49\u5f85\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u6267\u884c\u3002</p>"},{"location":"java/java%E4%B8%AD%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BA%BF%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/#5","title":"5. \u5b50\u7ebf\u7a0b\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9\u4e3b\u7ebf\u7a0b","text":"<p>\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u5f80\u5f80\u6211\u4eec\u9700\u8981\u521b\u5efa\u5b50\u7ebf\u7a0b\u6765\u505a\u4e00\u4e9b\u8017\u65f6\u7684\u4efb\u52a1\uff0c\u7136\u540e\u5c06\u6267\u884c\u7ed3\u679c\u4f20\u56de\u4e3b\u7ebf\u7a0b\u3002\u90a3\u4e48\u5982\u4f55\u5728 Java \u4e2d\u5b9e\u73b0\u5462\uff1f</p> <p>\u4e00\u822c\u5728\u521b\u5efa\u7ebf\u7a0b\u7684\u65f6\u5019\uff0c\u6211\u4eec\u4f1a\u628a <code>Runnable</code> \u5bf9\u8c61\u4f20\u9012\u7ed9 <code>Thread</code> \u6267\u884c\uff0c<code>Runable</code> \u7684\u6e90\u7801\u5982\u4e0b\uff1a</p> <pre><code>@FunctionalInterface\npublic interface Runnable {\n    public abstract void run();\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230 Runable \u662f\u4e00\u4e2a\u51fd\u6570\u5f0f\u63a5\u53e3\uff0c\u8be5\u63a5\u53e3\u4e2d\u7684 run \u65b9\u6cd5\u6ca1\u6709\u8fd4\u56de\u503c\uff0c\u90a3\u4e48\u5982\u679c\u8981\u8fd4\u56de\u7ed3\u679c\uff0c\u53ef\u4ee5\u4f7f\u7528\u53e6\u4e00\u4e2a\u7c7b\u4f3c\u7684\u63a5\u53e3 <code>Callable</code>\u3002</p> <p>\u51fd\u6570\u5f0f\u63a5\u53e3\uff1a\u53ea\u6709\u4e00\u4e2a\u65b9\u6cd5\u7684\u63a5\u53e3</p> <p><code>Callable</code> \u63a5\u53e3\u7684\u6e90\u7801\u5982\u4e0b\uff1a</p> <pre><code>@FunctionalInterface\npublic interface Callable&lt;V&gt; {\n    /**\n     * Computes a result, or throws an exception if unable to do so.\n     *\n     * @return computed result\n     * @throws Exception if unable to compute a result\n     */\n    V call() throws Exception;\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u51fa\uff0c\u6700\u5927\u7684\u533a\u522b<code>Callable</code>\u5728\u4e8e\u5b83\u8fd4\u56de\u7684\u662f\u6cdb\u578b\u3002</p> <p>\u90a3\u4e48\u63a5\u4e0b\u6765\u7684\u95ee\u9898\u662f\uff0c\u5982\u4f55\u5c06\u5b50\u7ebf\u7a0b\u7684\u7ed3\u679c\u4f20\u56de\u53bb\u5462\uff1fJava \u6709\u4e00\u4e2a\u7c7b\uff0c<code>FutureTask</code>\uff0c\u5b83\u53ef\u4ee5\u4e0e \u4e00\u8d77\u5de5\u4f5c<code>Callable</code>\uff0c\u4f46\u8bf7\u6ce8\u610f\uff0c<code>get</code>\u7528\u4e8e\u83b7\u53d6\u7ed3\u679c\u7684\u65b9\u6cd5\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002<code>FutureTask</code> \u672c\u8d28\u4e0a\u8fd8\u662f\u4e00\u4e2a <code>Runnable</code>\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u4f20\u5230 <code>Thread</code> \u4e2d\u3002</p> <p></p> <p>\u6bd4\u5982\u6211\u4eec\u60f3\u8ba9\u5b50\u7ebf\u7a0b\u8ba1\u7b971\u5230100\u7684\u603b\u548c\uff0c\u5e76\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9\u4e3b\u7ebf\u7a0b\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>public static void getResultInWorker() {\n    Callable&lt;Integer&gt; callable = () -&gt; {\n        System.out.println(\"\u5b50\u4efb\u52a1\u5f00\u59cb\u6267\u884c\");\n        Thread.sleep(1000);\n        int result = 0;\n        for (int i = 0; i &lt;= 100; i++) {\n            result += i;\n        }\n        System.out.println(\"\u5b50\u4efb\u52a1\u6267\u884c\u5b8c\u6210\u5e76\u8fd4\u56de\u7ed3\u679c\");\n        return result;\n    };\n    FutureTask&lt;Integer&gt; futureTask = new FutureTask&lt;&gt;(callable);\n    new Thread(futureTask).start();\n\n    try {\n        System.out.println(\"\u5f00\u59cb\u6267\u884c futureTask.get()\");\n        Integer result = futureTask.get();\n        System.out.println(\"\u6267\u884c\u7684\u7ed3\u679c\uff1a\" + result);\n    } catch (InterruptedException e) {\n        e.printStackTrace();\n    } catch (ExecutionException e) {\n        e.printStackTrace();\n    }\n}\n</code></pre> <p>\u5f97\u5230\u7684\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>\u5f00\u59cb\u6267\u884c futureTask.get()\n\u5b50\u4efb\u52a1\u5f00\u59cb\u6267\u884c\n\u5b50\u4efb\u52a1\u6267\u884c\u5b8c\u6210\u5e76\u8fd4\u56de\u7ed3\u679c\n\u6267\u884c\u7684\u7ed3\u679c\uff1a5050\n</code></pre> <p>\u53ef\u4ee5\u770b\u51fa\u5728\u4e3b\u7ebf\u7a0b\u8c03\u7528<code>futureTask.get()</code>\u65b9\u6cd5\u65f6\u963b\u585e\u4e86\u4e3b\u7ebf\u7a0b\uff1b\u7136\u540e<code>Callable</code>\u5f00\u59cb\u5728\u5185\u90e8\u6267\u884c\u5e76\u8fd4\u56de\u64cd\u4f5c\u7684\u7ed3\u679c\uff1b\u7136\u540e<code>futureTask.get()</code>\u5f97\u5230\u7ed3\u679c\uff0c\u4e3b\u7ebf\u7a0b\u6062\u590d\u8fd0\u884c\u3002</p> <p>\u5728\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u4e86\u89e3\u5230\uff0c<code>FutureTask</code>\u548c<code>Callable</code>\u53ef\u4ee5\u76f4\u63a5\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u83b7\u53d6\u5b50\u7ebf\u7a0b\u7684\u7ed3\u679c\uff0c\u4f46\u662f\u5b83\u4eec\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002\u5f53\u7136\uff0c\u5982\u679c\u4f60\u4e0d\u5e0c\u671b\u963b\u585e\u4e3b\u7ebf\u7a0b\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528<code>ExecutorService</code>\u628a<code>FutureTask</code>\u5230\u7ebf\u7a0b\u6c60\u6765\u7ba1\u7406\u6267\u884c\u3002</p> <p>\u53c2\u8003\u6587\u7ae0\uff1a</p> <p>https://www.tutorialdocs.com/article/java-inter-thread-communication.html</p>"},{"location":"java/maven%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/","title":"maven \u57fa\u7840\u77e5\u8bc6\u603b\u7ed3","text":"<p>\u8fd9\u91cc\u8bb0\u5f55 maven \u7684\u57fa\u7840\u77e5\u8bc6\uff0c\u4e00\u65b9\u9762\u5de9\u56fa\u81ea\u5df1\u5b66\u5230\u7684\u77e5\u8bc6\uff0c\u53e6\u4e00\u65b9\u9762\u5e0c\u671b\u53ef\u4ee5\u5bf9\u6709\u540c\u6837\u56f0\u60d1\u7684\u5c0f\u4f19\u4f34\u63d0\u4f9b\u4e00\u4e9b\u5e2e\u52a9\u3002</p>"},{"location":"java/maven%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/#maven_1","title":"\u4e00. maven \u7b80\u4ecb","text":"<p><code>Maven</code> \u662f\u4e00\u4e2a\u9879\u76ee\u7ba1\u7406\u5de5\u5177\uff0c\u5b83\u5305\u542b\u4e86\u4e00\u4e2a\u9879\u76ee\u5bf9\u8c61\u6a21\u578b<code>POM</code> (Project Object Model)\uff0c\u4e00\u7ec4\u6807\u51c6\u96c6\u5408\uff0c\u4e00\u4e2a\u9879\u76ee\u751f\u547d\u5468\u671f(Project Lifecycle)\uff0c\u4e00\u4e2a\u4f9d\u8d56\u7ba1\u7406\u7cfb\u7edf(Dependency Management System)\u548c\u7528\u6765\u8fd0\u884c\u5b9a\u4e49\u5728\u751f\u547d\u5468\u671f\u9636\u6bb5(phase)\u4e2d\u63d2\u4ef6(plugin)\u76ee\u6807(goal)\u7684\u903b\u8f91\u3002 \u5f53\u4f60\u4f7f\u7528Maven\u7684\u65f6\u5019\uff0c\u4f60\u7528\u4e00\u4e2a\u660e\u786e\u5b9a\u4e49\u7684 <code>POM</code> \u6765\u63cf\u8ff0\u4f60\u7684\u9879\u76ee\uff0c\u7136\u540e <code>Maven</code> \u53ef\u4ee5\u5e94\u7528\u6a2a\u5207\u7684\u903b\u8f91\uff0c\u8fd9\u4e9b\u903b\u8f91\u6765\u81ea\u4e00\u7ec4\u5171\u4eab\u7684\uff08\u6216\u8005\u81ea\u5b9a\u4e49\u7684\uff09\u63d2\u4ef6\u3002</p> <p>Maven \u7684\u6838\u5fc3\u5176\u5b9e\u4e0d\u505a\u4ec0\u4e48\u5b9e\u9645\u7684\u4e8b\u60c5\uff0c\u9664\u4e86\u89e3\u6790\u4e00\u4e9b XML \u6587\u6863\uff0c\u7ba1\u7406\u751f\u547d\u5468\u671f\u4e0e\u63d2\u4ef6\u4e4b\u5916\uff0c\u5b83\u4ec0\u4e48\u4e5f\u4e0d\u61c2\u3002Maven \u88ab\u8bbe\u8ba1\u6210\u5c06\u4e3b\u8981\u7684\u804c\u8d23\u59d4\u6d3e\u7ed9\u4e00\u7ec4 Maven \u63d2\u4ef6\uff0c\u8fd9\u4e9b\u63d2\u4ef6\u53ef\u4ee5\u5f71\u54cd Maven \u751f\u547d\u5468\u671f\uff0c\u63d0\u4f9b\u5bf9\u76ee\u6807\u7684\u8bbf\u95ee\u3002\u7edd\u5927\u591a\u6570 Maven \u7684\u52a8\u4f5c\u53d1\u751f\u4e8eMaven \u63d2\u4ef6\u7684\u76ee\u6807\uff08goal\uff09\uff0c\u5982\u7f16\u8bd1\u6e90\u7801\uff0c\u6253\u5305\u4e8c\u8fdb\u5236\u4ee3\u7801\uff0c\u53d1\u5e03\u7ad9\u70b9\u548c\u5176\u5b83\u6784\u5efa\u4efb\u52a1\u3002\u4f60\u4ece Apache \u4e0b\u8f7d\u7684 Maven \u4e0d\u77e5\u9053\u5982\u4f55\u6253\u5305 WAR \u6587\u4ef6\uff0c\u4e5f\u4e0d\u77e5\u9053\u5982\u4f55\u8fd0\u884c\u5355\u5143\u6d4b\u8bd5\uff0cMaven \u5927\u90e8\u5206\u7684\u667a\u80fd\u662f\u7531\u63d2\u4ef6\u5b9e\u73b0\u7684\uff0c\u800c\u63d2\u4ef6\u4ece Maven \u4ed3\u5e93\u83b7\u5f97\u3002\u4e8b\u5b9e\u4e0a\uff0c\u7b2c\u4e00\u6b21\u4f60\u7528\u5168\u65b0\u7684 Maven \u5b89\u88c5\u8fd0\u884c\u8bf8\u5982 <code>mvn install</code> \u547d\u4ee4\u7684\u65f6\u5019\uff0c\u5b83\u4f1a\u4ece\u4e2d\u592e Maven \u4ed3\u5e93\u4e0b\u8f7d\u5927\u90e8\u5206\u6838\u5fc3 Maven \u63d2\u4ef6\u3002\u8fd9\u4e0d\u4ec5\u4ec5\u662f\u4e00\u4e2a\u6700\u5c0f\u5316 Maven \u5206\u53d1\u5305\u5927\u5c0f\u7684\u6280\u5de7\uff0c\u8fd9\u79cd\u65b9\u5f0f\u66f4\u80fd\u8ba9\u4f60\u5347\u7ea7\u63d2\u4ef6\u4ee5\u7ed9\u4f60\u9879\u76ee\u7684\u6784\u5efa\u63d0\u9ad8\u80fd\u529b\u3002Maven \u4ece\u8fdc\u7a0b\u4ed3\u5e93\u83b7\u53d6\u4f9d\u8d56\u548c\u63d2\u4ef6\u7684\u8fd9\u4e00\u4e8b\u5b9e\u5141\u8bb8\u4e86\u6784\u5efa\u903b\u8f91\u7684\u5168\u5c40\u6027\u91cd\u7528\u3002</p> <p>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u6307\u5b9a\u63d2\u4ef6\u7684\u8be6\u7ec6\u4fe1\u606f\uff1a</p> <pre><code>mvn help:describe -Dplugin=install -Dfull\n</code></pre>"},{"location":"java/maven%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/#maven_2","title":"\u4e8c. maven \u751f\u547d\u5468\u671f","text":""},{"location":"java/maven%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/#1-maven","title":"1. maven\u9ed8\u8ba4\u751f\u547d\u5468\u671f","text":"\u751f\u547d\u5468\u671f\u9636\u6bb5 \u63cf\u8ff0 validate \u9a8c\u8bc1\u9879\u76ee\u662f\u5426\u6b63\u786e\uff0c\u4ee5\u53ca\u6240\u6709\u4e3a\u4e86\u5b8c\u6574\u6784\u5efa\u5fc5\u8981\u7684\u4fe1\u606f\u662f\u5426\u53ef\u7528 generate-sources \u751f\u6210\u6240\u6709\u9700\u8981\u5305\u542b\u5728\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\u7684\u6e90\u4ee3\u7801 process-sources \u5904\u7406\u6e90\u4ee3\u7801\uff0c\u6bd4\u5982\u8fc7\u6ee4\u4e00\u4e9b\u503c generate-resources \u751f\u6210\u6240\u6709\u9700\u8981\u5305\u542b\u5728\u6253\u5305\u4e2d\u7684\u8d44\u6e90\u6587\u4ef6 process-resources \u590d\u5236\u5e76\u5904\u7406\u8d44\u6e90\u6587\u4ef6\u81f3\u76ee\u6807(target)\u76ee\u5f55\uff0c\u51c6\u5907\u6253\u5305 compile \u7f16\u8bd1\u9879\u76ee\u7684\u6e90\u4ee3\u7801 process-classes \u540e\u5904\u7406\u7f16\u8bd1\u751f\u6210\u7684 class \u6587\u4ef6\uff0c\u4f8b\u5982\u5bf9Java\u7c7b\u8fdb\u884c\u5b57\u8282\u7801\u589e\u5f3a generate-test-sources \u751f\u6210\u6240\u6709\u5305\u542b\u5728\u6d4b\u8bd5\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\u7684\u6d4b\u8bd5\u6e90\u7801 process-test-sources \u5904\u7406\u6d4b\u8bd5\u6e90\u7801\uff0c\u6bd4\u5982\u8fc7\u6ee4\u4e00\u4e9b\u503c generate-test-resources \u751f\u6210\u6d4b\u8bd5\u9700\u8981\u7684\u8d44\u6e90\u6587\u4ef6 process-test-resources \u590d\u5236\u5e76\u5904\u7406\u6d4b\u8bd5\u8d44\u6e90\u6587\u4ef6\u81f3\u6d4b\u8bd5\u76ee\u6807\u76ee\u5f55 test-compile \u7f16\u8bd1\u6d4b\u8bd5\u6e90\u7801\u81f3\u6d4b\u8bd5\u76ee\u6807\u76ee\u5f55 test \u4f7f\u7528\u5408\u9002\u7684\u5355\u5143\u6d4b\u8bd5\u6846\u67b6\u8fd0\u884c\u6d4b\u8bd5\uff0c\u8fd9\u4e9b\u6d4b\u8bd5\u4e0d\u9700\u8981\u88ab\u6253\u5305\u6216\u53d1\u5e03 prepare-package \u5728\u771f\u6b63\u7684\u6253\u5305\u4e4b\u524d\uff0c\u6267\u884c\u4e00\u4e9b\u51c6\u5907\u6253\u5305\u5fc5\u8981\u7684\u64cd\u4f5c package \u5c06\u7f16\u8bd1\u597d\u7684\u4ee3\u7801\u6253\u5305\u6210\u53ef\u5206\u53d1\u7684\u683c\u5f0f\uff0c\u5982 JAR\uff0cWAR pre-integration-test \u6267\u884c\u4e00\u4e9b\u5728\u96c6\u6210\u6d4b\u8bd5\u8fd0\u884c\u4e4b\u524d\u9700\u8981\u7684\u52a8\u4f5c\u3002\u5982\u5efa\u7acb\u96c6\u6210\u6d4b\u8bd5\u9700\u8981\u7684\u73af\u5883 integration-test \u5982\u679c\u6709\u5fc5\u8981\u7684\u8bdd\uff0c\u5904\u7406\u5305\u5e76\u53d1\u5e03\u81f3\u96c6\u6210\u6d4b\u8bd5\u53ef\u4ee5\u8fd0\u884c\u7684\u73af\u5883 post-integration-test \u6267\u884c\u4e00\u4e9b\u5728\u96c6\u6210\u6d4b\u8bd5\u8fd0\u884c\u4e4b\u540e\u9700\u8981\u7684\u52a8\u4f5c\u3002\u5982\u6e05\u7406\u96c6\u6210\u6d4b\u8bd5\u73af\u5883\u3002 verify \u6267\u884c\u6240\u6709\u68c0\u67e5\uff0c\u9a8c\u8bc1\u5305\u662f\u6709\u6548\u7684\uff0c\u7b26\u5408\u8d28\u91cf\u89c4\u8303 install \u5b89\u88c5\u5305\u81f3\u672c\u5730\u4ed3\u5e93\uff0c\u4ee5\u5907\u672c\u5730\u7684\u5176\u5b83\u9879\u76ee\u4f5c\u4e3a\u4f9d\u8d56\u4f7f\u7528 deploy \u5b89\u88c5\u5305\u81f3\u8fdc\u7a0b\u4ed3\u5e93\uff0c\u5171\u4eab\u7ed9\u5176\u4ed6\u5f00\u53d1\u4eba\u5458\u548c\u9879\u76ee <p>\u5728\u4e0a\u9762\u7684\u8868\u683c\u4e2d\u6807\u51fa\u4e86\u5e38\u7528\u7684\u751f\u547d\u5468\u671f\uff0c\u5bf9\u5e94 idea \u4e2d maven \u7684\u751f\u547d\u5468\u671f\u5982\u4e0b\u56fe\uff1a</p> <p></p>"},{"location":"java/maven%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/#2-mvn-package","title":"2. \u6267\u884c mvn package \u53d1\u751f\u4e86\u4ec0\u4e48","text":"<p>\u6211\u4eec\u53ef\u4ee5\u5c06\u63d2\u4ef6\u7684\u76ee\u6807\u7ed1\u5b9a\u5230 maven \u7684\u751f\u547d\u5468\u671f\u9636\u6bb5\u4e0a\uff0c\u6267\u884c <code>mvn package</code> \u547d\u4ee4\uff0c\u5728 Maven \u6cbf\u7740\u751f\u547d\u5468\u671f\u4e00\u6b65\u6b65\u5411\u524d\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5b83\u5c06\u8fd0\u884c\u7ed1\u5b9a\u5728\u6bcf\u4e2a\u9636\u6bb5\u4e0a\u7684\u6240\u6709\u76ee\u6807\u3002</p>"},{"location":"java/maven%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/#maven_3","title":"\u4e09. maven \u9879\u76ee\u4f9d\u8d56","text":"<p>Maven\u53ef\u4ee5\u7ba1\u7406\u5185\u90e8\u548c\u5916\u90e8\u4f9d\u8d56\u3002\u5185\u90e8\u4f9d\u8d56\u662f\u6307\u4e00\u4e2a maven \u9879\u76ee\u5185\u90e8\u5404\u4e2a\u6a21\u5757\u4e4b\u95f4\u7684\u4f9d\u8d56\uff0c\u6bd4\u5982\u4e00\u4e2a\u4e09\u5c42\u67b6\u6784\u7684 web \u9879\u76ee\u4e2d service \u6a21\u5757\u4f9d\u8d56 model \u6a21\u5757\uff0c\u6216\u8005\u6301\u4e45\u5c42\u6a21\u5757\uff1b\u5916\u90e8\u4f9d\u8d56\u662f\u6307\u4f9d\u8d56\u7b2c\u4e09\u65b9\u7c7b\u5e93\uff0c\u6bd4\u5982\u4f9d\u8d56 spring\u3001mybatis \u7b49\u76f8\u5173\u7684\u4f9d\u8d56\u3002</p>"},{"location":"java/maven%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/#1","title":"1. \u4f9d\u8d56\u8303\u56f4","text":"<p>\u5728 <code>pom.xml</code> \u6587\u4ef6\u4e2d\u6307\u5b9a <code>dependency</code> \u4f9d\u8d56\u65f6\uff0c\u53ef\u4ee5\u6307\u5b9a\u4f9d\u8d56\u7684 <code>scope</code> \u8303\u56f4\uff0c\u8303\u56f4\u53ef\u4ee5\u63a7\u5236\u54ea\u4e9b\u4f9d\u8d56\u5728\u54ea\u4e9b<code>classpath</code> \u4e2d\u53ef\u7528\uff0c\u54ea\u4e9b\u4f9d\u8d56\u5305\u542b\u5728\u4e00\u4e2a\u5e94\u7528\u4e2d\u3002\u8ba9\u6211\u4eec\u8be6\u7ec6\u770b\u4e00\u4e0b\u6bcf\u4e00\u79cd\u8303\u56f4\uff1a</p> <ul> <li>compile\uff08\u7f16\u8bd1\u8303\u56f4\uff09</li> </ul> <p>compile \u662f\u9ed8\u8ba4\u7684\u8303\u56f4\u3002\u5982\u679c\u6ca1\u6709\u63d0\u4f9b\u4e00\u4e2a\u8303\u56f4\uff0c\u90a3\u8be5\u4f9d\u8d56\u7684\u8303\u56f4\u5c31\u662f\u7f16\u8bd1\u8303\u56f4\u3002\u7f16\u8bd1\u8303\u56f4\u4f9d\u8d56\u5728\u6240\u6709\u7684 <code>classpath</code> \u4e2d\u53ef\u7528\uff0c\u540c\u65f6\u5b83\u4eec\u4e5f\u4f1a\u88ab\u6253\u5305\u3002</p> <ul> <li>provided\uff08\u5df2\u63d0\u4f9b\u8303\u56f4\uff09</li> </ul> <p><code>provided</code> \u4f9d\u8d56\u53ea\u6709\u5728\u5f53 <code>JDK</code> \u6216\u8005\u4e00\u4e2a\u5bb9\u5668\u5df2\u63d0\u4f9b\u8be5\u4f9d\u8d56\u4e4b\u540e\u624d\u4f7f\u7528\u3002\u4f8b\u5982\uff0c\u5982\u679c\u4f60\u5f00\u53d1\u4e86\u4e00\u4e2aweb\u5e94\u7528\uff0c\u4f60\u53ef\u80fd\u5728\u7f16\u8bd1 <code>classpath</code> \u4e2d\u9700\u8981\u53ef\u7528\u7684 <code>Servlet API</code> \u6765\u7f16\u8bd1\u4e00\u4e2a <code>servlet</code>\uff0c\u4f46\u662f\u4f60\u4e0d\u4f1a\u60f3\u8981\u5728\u6253\u5305\u597d\u7684WAR\u4e2d\u5305\u542b\u8fd9\u4e2a<code>Servlet API</code>\uff0c\u8fd9\u4e2a<code>Servlet API JAR</code>\u7531\u4f60\u7684\u5e94\u7528\u670d\u52a1\u5668\u6216\u8005<code>servlet</code> \u5bb9\u5668\u63d0\u4f9b\u3002\u5df2\u63d0\u4f9b\u8303\u56f4\u7684\u4f9d\u8d56\u5728\u7f16\u8bd1<code>classpath</code>\uff08\u4e0d\u662f\u8fd0\u884c\u65f6\uff09\u53ef\u7528\uff0c\u5b83\u4eec\u4e0d\u662f\u4f20\u9012\u6027\u7684\uff0c\u4e5f\u4e0d\u4f1a\u88ab\u6253\u5305\u3002</p> <ul> <li>runtime\uff08\u8fd0\u884c\u65f6\u8303\u56f4\uff09</li> </ul> <p><code>runtime</code> \u4f9d\u8d56\u5728\u8fd0\u884c\u7684\u65f6\u5019\u9700\u8981\uff0c\u4f46\u5728\u7f16\u8bd1\u7684\u65f6\u5019\u4e0d\u9700\u8981\u3002\u6bd4\u5982\uff0c\u4f60\u53ef\u80fd\u5728\u7f16\u8bd1\u7684\u65f6\u5019\u53ea\u9700\u8981 <code>JDBC API JAR</code> \u63a5\u53e3\uff0c\u800c\u53ea\u6709\u5728\u8fd0\u884c\u7684\u65f6\u5019\u624d\u9700\u8981 <code>JDBC</code> \u9a71\u52a8\u5b9e\u73b0\u3002</p> <ul> <li>test\uff08\u6d4b\u8bd5\u8303\u56f4\uff09</li> </ul> <p>test \u8303\u56f4\u4f9d\u8d56\u5728\u4e00\u822c\u7684\u7f16\u8bd1\u548c\u8fd0\u884c\u65f6\u90fd\u4e0d\u9700\u8981\uff0c\u5b83\u4eec\u53ea\u6709\u5728\u6d4b\u8bd5\u7f16\u8bd1\u548c\u6d4b\u8bd5\u8fd0\u884c\u9636\u6bb5\u53ef\u7528\u3002</p> <ul> <li>system\uff08\u7cfb\u7edf\u8303\u56f4\uff09</li> </ul> <p>system \u8303\u56f4\u4f9d\u8d56\u4e0e provided \u7c7b\u4f3c\uff0c\u4f46\u662f\u4f60\u5fc5\u987b\u663e\u5f0f\u7684\u63d0\u4f9b\u4e00\u4e2a\u5bf9\u4e8e\u672c\u5730\u7cfb\u7edf\u4e2dJAR\u6587\u4ef6\u7684\u8def\u5f84\u3002\u8fd9\u4e48\u505a\u662f\u4e3a\u4e86\u5141\u8bb8\u57fa\u4e8e\u672c\u5730\u5bf9\u8c61\u7f16\u8bd1\uff0c\u800c\u8fd9\u4e9b\u5bf9\u8c61\u662f\u7cfb\u7edf\u7c7b\u5e93\u7684\u4e00\u90e8\u5206\u3002\u8fd9\u6837\u7684\u6784\u4ef6\u5e94\u8be5\u662f\u4e00\u76f4\u53ef\u7528\u7684\uff0cMaven\u4e5f\u4e0d\u4f1a\u5728\u4ed3\u5e93\u4e2d\u53bb\u5bfb\u627e\u5b83\u3002\u5982\u679c\u4f60\u5c06\u4e00\u4e2a\u4f9d\u8d56\u8303\u56f4\u8bbe\u7f6e\u6210\u7cfb\u7edf\u8303\u56f4\uff0c\u4f60\u5fc5\u987b\u540c\u65f6\u63d0\u4f9b\u4e00\u4e2asystemPath\u5143\u7d20\u3002\u6ce8\u610f\u8be5\u8303\u56f4\u662f\u4e0d\u63a8\u8350\u4f7f\u7528\u7684\uff08\u4f60\u5e94\u8be5\u4e00\u76f4\u5c3d\u91cf\u53bb\u4ece\u516c\u5171\u6216\u5b9a\u5236\u7684Maven\u4ed3\u5e93\u4e2d\u5f15\u7528\u4f9d\u8d56\uff09\u3002</p> scope \u53d6\u503c \u6709\u6548\u8303\u56f4\uff08compile, runtime, test\uff09 \u4f9d\u8d56\u4f20\u9012 \u4f8b\u5b50 compile\uff08\u9ed8\u8ba4\uff09 all \u662f spring-core provided compile\u3001test \u5426 servlet-api runtime runtime\u3001test \u662f JDBC\u9a71\u52a8 test test \u5426 Junit system compile\u3001test \u662f \u4e0d\u63a8\u8350\u4f7f\u7528"},{"location":"java/maven%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/#2","title":"2. \u53ef\u9009\u4f9d\u8d56","text":"<p>\u5728 pom.xml \u6587\u4ef6\u4e2d\u6307\u5b9a<code>&lt;dependency&gt;</code>\u4f9d\u8d56\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>&lt;optional&gt;true&lt;optional&gt;</code>\u6807\u7b7e\u5c06\u6b64\u4f9d\u8d56\u58f0\u660e\u4e3a\u53ef\u9009\u4f9d\u8d56\u3002\u5982\u679c\u9879\u76ee\u4e2d\u4f9d\u8d56\u7684\u7c7b\u5e93\u5305\u542b\u53ef\u9009\u4f9d\u8d56\uff0c\u6211\u4eec\u5728\u4f7f\u7528\u7684\u65f6\u5019\u9700\u8981\u663e\u793a\u6307\u5b9a\u9700\u8981\u7684\u53ef\u9009\u4f9d\u8d56\u3002</p>"},{"location":"java/maven%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/#3","title":"3. \u4f20\u9012\u4f9d\u8d56","text":"<p>\u4f20\u9012\u6027\u4f9d\u8d56\u5c31\u662f\u5bf9\u4e8e\u4e00\u4e2a\u4f9d\u8d56\u7684\u4f9d\u8d56\u3002\u5982\u679c project-a \u4f9d\u8d56\u4e8e project-b\uff0c\u800c\u540e\u8005\u63a5\u7740\u4f9d\u8d56\u4e8e project-c\uff0c\u90a3\u4e48 project-c \u5c31\u88ab\u8ba4\u4e3a\u662f project-a \u7684\u4f20\u9012\u6027\u4f9d\u8d56\u3002\u5982\u679c project-c \u4f9d\u8d56\u4e8e project-d\uff0c\u90a3\u4e48project-d \u5c31\u4e5f\u88ab\u8ba4\u4e3a\u662f project-a \u7684\u4f20\u9012\u6027\u4f9d\u8d56\u3002Maven \u7684\u90e8\u5206\u4f18\u52bf\u662f\u7531\u4e8e\u5b83\u80fd\u591f\u7ba1\u7406\u4f20\u9012\u6027\u4f9d\u8d56\uff0c\u5e76\u4e14\u80fd\u591f\u5e2e\u52a9\u5f00\u53d1\u8005\u5c4f\u853d\u6389\u8ddf\u8e2a\u6240\u6709\u7f16\u8bd1\u671f\u548c\u8fd0\u884c\u671f\u4f9d\u8d56\u7684\u7ec6\u8282\u3002\u4f60\u53ef\u4ee5\u53ea\u4f9d\u8d56\u4e8e\u4e00\u4e9b\u5305\u5982 Spring Framework\uff0c\u800c\u4e0d\u7528\u62c5\u5fc3 Spring Framework \u7684\u6240\u6709\u4f9d\u8d56\uff0cMaven \u5e2e\u4f60\u81ea\u52a8\u7ba1\u7406\u4e86\uff0c\u4f60\u4e0d\u7528\u81ea\u5df1\u53bb\u8be6\u7ec6\u4e86\u89e3\u914d\u7f6e\u3002</p> <p>Maven \u662f\u600e\u6837\u5b8c\u6210\u8fd9\u4ef6\u4e8b\u60c5\u7684\u5462\uff1f\u5b83\u5efa\u7acb\u4e00\u4e2a\u4f9d\u8d56\u56fe\uff0c\u5e76\u4e14\u5904\u7406\u4e00\u4e9b\u53ef\u80fd\u53d1\u751f\u7684\u51b2\u7a81\u548c\u91cd\u53e0\u3002\u5982\u679cMaven \u770b\u5230\u6709\u4e24\u4e2a\u9879\u76ee\u4f9d\u8d56\u4e8e\u540c\u6837\u7684 groupId \u548c artifactId\uff0c\u5b83\u4f1a\u81ea\u52a8\u9009\u62e9\u90a3\u4e2a\u6700\u65b0\u7248\u672c\u7684\u4f9d\u8d56\u3002\u867d\u7136\u8fd9\u542c\u8d77\u6765\u5f88\u65b9\u4fbf\uff0c\u4f46\u5728\u4e00\u4e9b\u8fb9\u754c\u60c5\u51b5\u4e2d\uff0c\u4f20\u9012\u6027\u4f9d\u8d56\u4f1a\u9020\u6210\u4e00\u4e9b\u914d\u7f6e\u95ee\u9898\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528<code>&lt;exclusion&gt;</code>\u4f9d\u8d56\u6392\u9664\u3002</p> <p>\u4e0b\u9762\u51e0\u79cd\u60c5\u51b5\u53ef\u4ee5\u4f7f\u7528<code>&lt;exclusion&gt;</code>\u4f9d\u8d56\u6392\u9664\uff1a</p> <ol> <li>\u6392\u9664\u901a\u8fc7\u4f20\u9012\u4f9d\u8d56\u5f15\u5165\u4f46\u662f\u9879\u76ee\u4e2d\u6ca1\u6709\u4f7f\u7528\u7684\u4f9d\u8d56</li> <li>\u6392\u9664\u8fd0\u884c\u65f6\u5bb9\u5668\u5df2\u7ecf\u63d0\u4f9b\u7684\u4f9d\u8d56</li> <li>\u6392\u9664\u53ef\u80fd\u6709\u591a\u4e2a\u5b9e\u73b0\u7684 API \u4f9d\u8d56</li> <li>\u6709\u591a\u4e2a\u7248\u672c\u7684\u4f9d\u8d56\uff0c\u6392\u9664\u4f60\u4e0d\u60f3\u4f7f\u7528\u7684\u90a3\u4e2a\u4f9d\u8d56</li> </ol>"},{"location":"java/maven%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/#4","title":"4. \u4f9d\u8d56\u7ba1\u7406","text":"<p>\u5728\u4e00\u4e2a\u6709\u5f88\u591a\u6a21\u5757\u7684\u590d\u6742 maven \u9879\u76ee\u4e2d\uff0c\u5982\u679c\u6709\u5f88\u591a\u6a21\u5757\u90fd\u4f7f\u7528\u4e86\u76f8\u540c\u7684\u4f9d\u8d56\uff0c\u6bd4\u5982 <code>MySQL</code> \u6570\u636e\u5e93\u9a71\u52a8\u7684\u4f9d\u8d56\uff0c\u9700\u8981\u5728\u5404\u4e2a\u6a21\u5757\u4e2d\u72ec\u7acb\u7684\u5217\u51fa\u8be5\u4f9d\u8d56\u7684\u7248\u672c\uff0c\u5728\u4f60\u9700\u8981\u5347\u7ea7\u5230\u4e00\u4e2a\u65b0\u7248\u672c\u7684\u65f6\u5019\u4f60\u5c31\u4f1a\u9047\u5230\u95ee\u9898\u3002\u7531\u4e8e\u8fd9\u4e9b\u7248\u672c\u53f7\u5206\u6563\u5728\u4f60\u7684\u9879\u76ee\u6811\u4e2d\uff0c\u4f60\u9700\u8981\u624b\u52a8\u4fee\u6539\u6bcf\u4e00\u4e2a\u5f15\u7528\u8be5\u4f9d\u8d56\u7684 <code>pom.xml</code>\uff0c\u786e\u4fdd\u6bcf\u4e2a\u5730\u65b9\u7684\u7248\u672c\u53f7\u90fd\u66f4\u6539\u4e86\u3002\u90a3\u4e48\u5982\u4f55\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5462\uff1f</p> <p>maven \u63d0\u4f9b\u4e86 <code>dependencyManagement</code>\u5143\u7d20\u6765\u7edf\u4e00\u7ba1\u7406\u4f9d\u8d56\u7248\u672c\u53f7\uff0c\u4f7f\u7528 <code>pom.xml</code>\u4e2d\u7684<code>dependencyManagement</code> \u5143\u7d20\u80fd\u8ba9\u4f60\u5728\u5b50\u9879\u76ee\u4e2d\u5f15\u7528\u4e00\u4e2a\u4f9d\u8d56\u800c\u4e0d\u7528\u663e\u5f0f\u7684\u5217\u51fa\u7248\u672c\u53f7\uff0cmaven \u4f1a\u6cbf\u7740\u7236\u5b50\u5c42\u6b21\u5411\u4e0a\u8d70\uff0c\u76f4\u5230\u627e\u5230\u4e00\u4e2a\u62e5\u6709 <code>dependencyManagement</code>  \u5143\u7d20\u7684\u9879\u76ee\uff0c\u7136\u540e\u5b83\u5c31\u4f1a\u4f7f\u7528\u5728\u8fd9\u4e2a</p> <p><code>dependencyManagement</code> \u5143\u7d20\u4e2d\u6307\u5b9a\u7684\u7248\u672c\u53f7\u3002</p> <p>\u6ce8\u610f \u5982\u679c\u5b50\u9879\u76ee\u5b9a\u4e49\u4e86\u4e00\u4e2a\u7248\u672c <code>version</code>\uff0c\u5b83\u5c06\u8986\u76d6\u9876\u5c42 POM \u7684 <code>dependencyManagement</code> \u5143\u7d20\u4e2d\u7684\u7248\u672c\u3002\u53ea\u6709\u5728\u5b50\u9879\u76ee\u6ca1\u6709\u76f4\u63a5\u58f0\u660e\u4e00\u4e2a\u7248\u672c\u7684\u65f6\u5019\uff0c<code>dependencyManagement</code> \u5b9a\u4e49\u7684\u7248\u672c\u624d\u4f1a\u88ab\u4f7f\u7528\u3002</p> <p>\u5b9a\u4e49\u5728\u9876\u5c42 <code>pom.xml</code> \u6587\u4ef6\u7684 <code>dependencyManagement</code> \u4e2d\u7684\u4f9d\u8d56\uff0c\u5728\u5b50\u9879\u76ee\u4e2d\u5982\u679c\u6ca1\u6709\u663e\u793a\u5f15\u7528\u5219\u4e0d\u4f1a\u88ab\u5f15\u5165\uff0c\u4f46\u662f\u5b9a\u4e49\u9876\u5c42 <code>pom.xml</code> \u7684 <code>dependencies</code> \u4e2d\u7684\u4f9d\u8d56\u4f1a\u88ab\u6240\u6709\u5b50\u9879\u76ee\u5f15\u5165\uff0c\u4e3a\u4e86\u4e0d\u6dfb\u52a0\u4e00\u4e9b\u4e0d\u5fc5\u8981\u7684\u4f9d\u8d56\uff0c\u4f7f\u7528 <code>dependencyManagement</code> \u80fd\u8ba9\u4f60\u7edf\u4e00\u5e76\u96c6\u4e2d\u5316\u4f9d\u8d56\u7248\u672c\u7684\u7ba1\u7406\uff0c\u800c\u4e0d\u7528\u6dfb\u52a0\u90a3\u4e9b\u4f1a\u88ab\u6240\u6709\u5b50\u9879\u76ee\u7ee7\u627f\u7684\u4f9d\u8d56\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c<code>dependencyManagement</code>\u5143\u7d20\u548c\u4e00\u4e2a\u73af\u5883\u53d8\u91cf\u4e00\u6837\uff0c\u80fd\u8ba9\u4f60\u5728\u4e00\u4e2a\u9879\u76ee\u4e0b\u9762\u7684\u4efb\u4f55\u5730\u65b9\u58f0\u660e\u4e00\u4e2a\u4f9d\u8d56\u800c\u4e0d\u7528\u6307\u5b9a\u4e00\u4e2a\u7248\u672c\u53f7\u3002</p>"},{"location":"java/maven%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/#maven_4","title":"\u56db. maven \u5185\u7f6e\u5c5e\u6027","text":""},{"location":"java/maven%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/#1-maven_1","title":"1. maven \u5c5e\u6027","text":"<p>\u4f60\u53ef\u4ee5\u5728 <code>pom.xml</code> \u6587\u4ef6\u6216\u8005\u8d44\u6e90\u6587\u4ef6\u4e2d\u4f7f\u7528\u5c5e\u6027\uff0c\u8d44\u6e90\u6587\u4ef6\u88ab\u4f1a <code>Maven Resource</code> \u63d2\u4ef6\u7684\u8fc7\u6ee4\u7279\u6027\u5904\u7406\u3002\u4e00\u4e2a\u5c5e\u6027\u6c38\u8fdc\u5305\u542b\u5728\u4e2d<code>${}</code>\u4e2d\u3002\u4f8b\u5982\uff0c\u8981\u5f15\u7528 <code>project.version</code> \u5c5e\u6027\uff0c\u5c31\u9700\u8981\u8fd9\u6837\u5199 <code>${project.version}</code>\u3002\u5728\u4efb\u4f55Maven\u9879\u76ee\u4e2d\u90fd\u6709\u4e00\u4e9b\u9690\u5f0f\u7684\u5c5e\u6027\uff0c\u8fd9\u4e9b\u9690\u5f0f\u7684\u5c5e\u6027\u662f\uff1a</p> <ul> <li>project.*</li> </ul> <p>\u53ef\u4ee5\u4f7f\u7528\u8be5 <code>project.*</code> \u524d\u7f00\u6765\u5f15\u7528\u4efb\u4f55\u5728 <code>pom.xml</code> \u4e2d\u7684\u503c\u3002</p> <ul> <li>settings.*</li> </ul> <p>\u53ef\u4ee5\u4f7f\u7528\u8be5 <code>settings.*</code> \u524d\u7f00\u6765\u5f15\u7528 <code>~/.m2/settings.xml</code> \u6587\u4ef6\u4e2d\u7684\u503c\u3002</p> <ul> <li>env.*</li> </ul> <p>\u53ef\u4ee5\u4f7f\u7528 <code>env.*</code> \u524d\u7f00\u6765\u5f15\u7528\u73af\u5883\u53d8\u91cf\u5982 <code>PATH</code> \u548c <code>M2_HOME</code>\u7684\u503c\u3002</p> <ul> <li>\u7cfb\u7edf\u5c5e\u6027</li> </ul> <p>\u4efb\u4f55\u53ef\u4ee5\u901a\u8fc7 <code>System.getProperty()</code> \u65b9\u6cd5\u83b7\u53d6\u7684\u5c5e\u6027\u90fd\u53ef\u4ee5\u4f5c\u4e3a maven \u5c5e\u6027\u88ab\u5f15\u7528\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528 <code>mvn help:system</code> \u547d\u4ee4\u53ef\u67e5\u770b\u6240\u6709\u73af\u5883\u53d8\u91cf\u3002</p> <p>\u9664\u4e86\u4e0a\u8ff0\u7684\u9690\u5f0f\u5c5e\u6027\uff0c\u7528\u6237\u8fd8\u53ef\u4ee5\u4f7f\u7528 <code>&lt;properties&gt;</code> \u81ea\u5b9a\u4e49\u5c5e\u6027\u3002</p>"},{"location":"java/maven%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/#2-pomxml","title":"2. pom.xml \u6587\u4ef6\u5e38\u7528\u5c5e\u6027","text":"<pre><code>${project.groupId}:\u9879\u76ee\u7684groupId.\n${project.artifactId}:\u9879\u76ee\u7684artifactId.\n${project.version}:\u9879\u76ee\u7684version,\u4e8e${version}\u7b49\u4ef7 \n${project.basedir}:\u8868\u793a\u9879\u76ee\u6839\u76ee\u5f55\uff0c\u5373\u5305\u542bpom.xml\u6587\u4ef6\u7684\u76ee\u5f55;  \n${project.build.sourceDirectory}:\u9879\u76ee\u7684\u4e3b\u6e90\u7801\u76ee\u5f55\uff0c\u9ed8\u8ba4\u4e3asrc/main/java/.\n${project.build.testSourceDirectory}:\u9879\u76ee\u7684\u6d4b\u8bd5\u6e90\u7801\u76ee\u5f55\uff0c\u9ed8\u8ba4\u4e3a/src/test/java/.\n${project.build.directory}:\u9879\u76ee\u6784\u5efa\u8f93\u51fa\u76ee\u5f55\uff0c\u9ed8\u8ba4\u4e3atarget/.\n${project.outputDirectory}:\u9879\u76ee\u4e3b\u4ee3\u7801\u7f16\u8bd1\u8f93\u51fa\u76ee\u5f55\uff0c\u9ed8\u8ba4\u4e3atarget/classes/.\n${project.testOutputDirectory}:\u9879\u76ee\u6d4b\u8bd5\u4ee3\u7801\u7f16\u8bd1\u8f93\u51fa\u76ee\u5f55\uff0c\u9ed8\u8ba4\u4e3atarget/testclasses/.\n${project.build.finalName}:\u9879\u76ee\u6253\u5305\u8f93\u51fa\u6587\u4ef6\u7684\u540d\u79f0\uff0c\u9ed8\u8ba4\u4e3a${project.artifactId}-${project.version}\n</code></pre>"},{"location":"java/maven%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/#3-settingxml","title":"3. setting.xml \u6587\u4ef6\u5c5e\u6027","text":"<p>\u4e0epom\u5c5e\u6027\u540c\u7406\uff0c\u7528\u6237\u53ef\u4ee5\u7528\u4ee5<code>settings.</code>\u5f00\u5934\u7684\u5c5e\u6027\u5f15\u7528 <code>setting.xml</code> \u6587\u4ef6\u7684XML\u5143\u7d20\u503c\u3002</p> <p><code>${settings.localRepository}</code> \u8868\u793a\u672c\u5730\u4ed3\u5e93\u7684\u5730\u5740</p>"},{"location":"java/maven%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/#4_1","title":"4. \u81ea\u5b9a\u4e49\u5c5e\u6027","text":"<p>\u81ea\u5b9a\u4e49\u5c5e\u6027\uff1a\u5728 <code>pom.xml</code> \u6587\u4ef6\u7684 <code>&lt;properties&gt;</code> \u6807\u7b7e\u4e0b\u5b9a\u4e49\u7684maven\u5c5e\u6027\uff1a</p> <pre><code>&lt;properties&gt;\n    &lt;spring&gt;5.2.13.RELEASE&lt;/spring&gt;\n&lt;/properties&gt;\n</code></pre> <p>\u53ef\u4ee5\u5728\u5176\u4ed6\u5730\u65b9\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684\u5c5e\u6027\uff1a</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-context&lt;/artifactId&gt;\n    &lt;version&gt;${spring}&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"java/maven%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/#pom","title":"\u4e94. POM \u6700\u4f73\u5b9e\u8df5","text":""},{"location":"java/maven%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/#1_1","title":"1. \u4f9d\u8d56\u5f52\u7c7b","text":"<p>\u5982\u679c\u4f60\u6709\u4e00\u7ec4\u903b\u8f91\u4e0a\u5f52\u7c7b\u5728\u4e00\u8d77\u7684\u4f9d\u8d56\uff0c\u4f60\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u6253\u5305\u65b9\u5f0f\u4e3a <code>pom</code> \u7684\u5b50\u6a21\u5757\u6765\u5c06\u8fd9\u4e9b\u4f9d\u8d56\u5f52\u5728\u4e00\u8d77\u3002\u6bd4\u5982\u521b\u5efa\u4e00\u4e2a\u53eb\u505a <code>dependencies</code> \u7684\u5b50\u6a21\u5757\uff0c\u6b64\u6a21\u5757\u53ea\u5305\u542b\u4e00\u4e2a <code>pom.xml</code> \u6587\u4ef6\uff0c\u7528\u6765\u5f52\u7c7b\u7ba1\u7406\u4e00\u4e9b\u516c\u5171\u4f9d\u8d56\u7684\u7248\u672c\u53f7\uff0c\u6ce8\u610f\u6307\u5b9a\u6b64\u6a21\u5757\u7684\u6253\u5305\u7c7b\u578b\u4e3a\uff1a<code>&lt;packaging&gt;pom&lt;/packaging&gt;</code>\u3002</p> <p>\u6bd4\u5982\u5728 dubbo \u9879\u76ee\u4e2d\u4e5f\u662f\u8fd9\u6837\u4f7f\u7528\u7684\uff0c\u5b83\u5b9a\u4e49\u4e86\u4e00\u4e2a\u53eb\u505a <code>dubbo-dependencies-bom</code> \u7684\u5b50\u6a21\u5757\uff0c\u6a21\u5757\u4e2d\u53ea\u6709\u4e00\u4e2a <code>pom.xml</code> \u6587\u4ef6\uff0c\u5982\u4e0b\u56fe:</p> <p></p> <p>\u5728 <code>dubbo-dependencies-bom</code> \u7684\u7236 <code>pom.xml</code> \u4e2d\u901a\u8fc7\u5982\u4e0b\u65b9\u5f0f\u5f15\u5165\u4f7f\u7528\uff1a</p> <pre><code>    &lt;dependencyManagement&gt;\n        &lt;dependencies&gt;\n            &lt;dependency&gt;\n                &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;\n                &lt;artifactId&gt;dubbo-dependencies-bom&lt;/artifactId&gt;\n                &lt;version&gt;${project.version}&lt;/version&gt;\n                &lt;type&gt;pom&lt;/type&gt;\n                &lt;scope&gt;import&lt;/scope&gt;\n            &lt;/dependency&gt;\n        &lt;/dependencies&gt;\n    &lt;/dependencyManagement&gt;\n</code></pre>"},{"location":"java/maven%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/#2_1","title":"2. \u8d44\u6e90\u8fc7\u6ee4\u7684\u95ee\u9898","text":"<p>\u5728\u4e0a\u9762\u7684 maven \u751f\u547d\u5468\u671f\u4e00\u8282\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0cmaven \u5c06 <code>resources:resources</code>\u76ee\u6807\u7ed1\u5b9a\u5230 <code>process-resources</code> \u751f\u547d\u5468\u671f\u9636\u6bb5\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b  <code>resources:resources</code> \u76ee\u6807\u7684\u4f5c\u7528\u662f\u5c06 <code>src/main/resources</code> \u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u590d\u5236\u5230 <code>target/classes</code> \u76ee\u5f55\u4e2d\u3002\u9664\u4e86\u590d\u5236\u6587\u4ef6\u5230\u8f93\u51fa\u76ee\u5f55\u4e4b\u5916\uff0c<code>resources:resources</code> \u76ee\u6807\u8fd8\u53ef\u4ee5\u4f7f\u7528\u8fc7\u6ee4\u5668\uff0c\u7528\u4e8e\u5c06\u8d44\u6e90\u6587\u4ef6\u4e2d\u7684\u7b26\u53f7\u53d8\u91cf\uff08<code>${\u53d8\u91cf\u540d}</code>\uff09\u66ff\u6362\u4e3a\u53d8\u91cf\u6307\u5411\u7684\u503c\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u65b9\u5f0f\u5f00\u542f\u8fc7\u6ee4\u5668\u529f\u80fd\uff1a <pre><code>&lt;build&gt;\n    &lt;resources&gt;\n        &lt;resource&gt;\n            &lt;directory&gt;src/main/resources&lt;/directory&gt;\n\n            &lt;!--\u4f7f\u7528 &lt;excludes&gt; \u6392\u9664 src/main/resources \u76ee\u5f55\u4e0b\u7684 test.txt \u6587\u4ef6 --&gt;\n            &lt;excludes&gt;\n                &lt;exclude&gt;test.txt&lt;/exclude&gt;\n            &lt;/excludes&gt;\n\n            &lt;!--\n            \u5f00\u542f\u8fc7\u6ee4\u5668\u529f\u80fd\uff0c\u5f00\u542f\u4e4b\u540e\u5c31\u53ef\u4ee5\u4ece &lt;properties&gt; \u5143\u7d20\n            \u6216\u8005\u4e0b\u9762 &lt;filters&gt;\u4e2d\u6307\u5b9a\u7684 properties \u6587\u4ef6\u4e2d\u8bfb\u53d6\u53d8\u91cf\u7684\u503c\n            \u66ff\u6362 ${\u53d8\u91cf\u540d} \n            --&gt;\n            &lt;filtering&gt;true&lt;/filtering&gt;\n        &lt;/resource&gt;\n    &lt;/resources&gt;\n    &lt;filters&gt;\n        &lt;filter&gt;src/main/resources/my.properties&lt;/filter&gt;\n    &lt;/filters&gt;\n&lt;/build&gt;\n</code></pre> \u53ef\u4ee5\u4f7f\u7528 <code>&lt;excludes&gt;</code> \u6392\u9664\u6307\u5b9a\u76ee\u5f55\u4e0b\u7684\u6307\u5b9a\u6587\u4ef6\uff0c\u652f\u6301\u901a\u914d\u7b26\u5339\u914d\uff0c\u6bd4\u5982\u901a\u8fc7 <code>*.txt</code> \u6392\u9664\u4ee5 <code>.txt</code>\u4e3a\u540e\u7f00\u7684\u6587\u4ef6\u3002</p> <p>\u901a\u8fc7<code>&lt;filtering&gt;true&lt;/filtering&gt;</code>\u5f00\u542f\u8fc7\u6ee4\u5668\u529f\u80fd\uff0c\u5f00\u542f\u4e4b\u540e\u5c31\u53ef\u4ee5\u4ece<code>pom.xml</code>\u6587\u4ef6\u3001 <code>&lt;properties&gt;</code> \u5143\u7d20\u6216\u8005 <code>&lt;filters&gt;</code> \u4e2d\u6307\u5b9a\u7684 properties \u6587\u4ef6\u4e2d\u8bfb\u53d6\u53d8\u91cf\u7684\u503c\u66ff\u6362 <code>${\u53d8\u91cf\u540d}</code>\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff1a</p> <p>\u5728 <code>pom.xml</code>\u6587\u4ef6\u3001 <code>&lt;properties&gt;</code> \u5143\u7d20\u6216\u8005 <code>&lt;filters&gt;</code> \u4e2d\u6709\u76f8\u540c\u53d8\u91cf\u540d\u65f6\uff0c\u8bfb\u53d6\u53d8\u91cf\u4f18\u5148\u7ea7\u5982\u4e0b\uff1a</p> <p><code>&lt;filters&gt;</code> &gt; <code>&lt;properties&gt;</code> &gt;  <code>pom.xml</code></p> <p>\u4e0b\u9762\u901a\u8fc7\u4e00\u4e2a\u4f8b\u5b50\u6765\u8bf4\u660e\u4e0a\u9762\u7684\u529f\u80fd\uff0c\u5b9a\u4e49\u4e00\u4e2a <code>hello.txt</code> \u6587\u4ef6\uff0c\u6587\u4ef6\u4e2d\u901a\u8fc7 <code>${\u53d8\u91cf\u540d}</code> \u65b9\u5f0f\u5b9a\u4e49\u4e00\u4e9b\u53d8\u91cf\uff0c\u7528\u6765\u9a8c\u8bc1\u53d8\u91cf\u66ff\u6362\u7684\u529f\u80fd\uff0c\u5b9a\u4e49\u4e86 <code>test.txt</code> \u7528\u6765\u9a8c\u8bc1\u6587\u4ef6\u6392\u9664\u529f\u80fd\uff0c\u5b9a\u4e49\u4e86\u4e00\u4e2a <code>my.properties</code> \u6587\u4ef6\u6307\u5b9a\u53d8\u91cf\u7684\u503c\uff0c\u5982\u4e0b\u56fe\u6240\u793a:</p> <p></p> <p>\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u7f16\u8bd1\u6253\u5305\uff1a  <pre><code>mvn clean package\n</code></pre>  \u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u4ece\u7ed3\u679c\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\uff0c<code>test.txt</code> \u6587\u4ef6\u88ab\u6392\u9664\u4e86\uff0c\u81ea\u5b9a\u4e49\u53d8\u91cf\u7684\u503c\u4e5f\u88ab\u6b63\u786e\u66ff\u6362\u4e86\u3002</p> <p>\u8d44\u6e90\u6587\u4ef6\u662fJava\u4ee3\u7801\u4e2d\u8981\u4f7f\u7528\u7684\u6587\u4ef6\uff0c\u4ee3\u7801\u5728\u6267\u884c\u7684\u65f6\u5019\u4f1a\u5230\u6307\u5b9a\u76ee\u5f55\u53bb\u67e5\u627e\u8fd9\u4e9b\u6587\u4ef6\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u7528\u5230\u7684\u8d44\u6e90\u6587\u4ef6\uff08\u5404\u79cdxml\uff0cproperties\uff0cxsd\u6587\u4ef6\u7b49\uff09\u90fd\u653e\u5728<code>src/mian/resources</code>\u4e0b\uff0c\u5229\u7528Maven\u6253\u5305\u7684\u65f6\u5019\uff0cMaven\u90fd\u80fd\u9ed8\u8ba4\u5c06\u8fd9\u4e9b\u8d44\u6e90\u6587\u4ef6\u6253\u5305\u5230\u76f8\u5e94\u7684jar\u5305\u6216\u8005war\u5305\u4e2d\u3002</p> <p>\u4f46\u662f\u6709\u4e9b\u65f6\u5019\uff0c\u53ef\u80fd\u4f1a\u628a\u8d44\u6e90\u6587\u4ef6\u653e\u5230<code>src/main/java</code>\u4e0b\uff0c\u6bd4\u5982\u8bf4<code>Mybatis</code>\u7684<code>Mapper.xml</code>\u6587\u4ef6\u5c31\u662f\u548c<code>Mapper.java</code>\u653e\u5728\u4e00\u8d77\uff0c\u4e5f\u5c31\u5bfc\u81f4\u4e86java\u6587\u4ef6\u80fd\u6253\u5230jar\u5305\u4e2d\uff0cMapper.xml\u5374\u6ca1\u6709\u6253\u8fdbjar\u5305\u4e2d\u3002\u8fd9\u65f6\u5019\uff0c\u5c31\u9700\u8981\u5728pom.xml\u4e2d\u6dfb\u52a0\u7279\u5b9a\u7684\u914d\u7f6e\u6765\u5c06\u8fd9\u4e9b\u8d44\u6e90\u6587\u4ef6\u80fd\u6253\u8fdbjar\u5305\u6216war\u5305\u4e2d\u3002</p> <p>\u914d\u7f6e\u6709\u4e24\u79cd\u65b9\u6cd5\uff0c\u4e00\u662f\u5728 <code>&lt;build&gt;</code> \u6807\u7b7e\u8282\u70b9\u4e0b\u6dfb\u52a0 <code>&lt;resources&gt;</code>\u6807\u7b7e\u8282\u70b9\uff0c\u4e8c\u662f\u5728 <code>&lt;build&gt;</code>\u6807\u7b7e\u8282\u70b9\u4e0b\u7684<code>&lt;plugins&gt;</code>\u6807\u7b7e\u8282\u70b9\u4e2d\u914d\u7f6e<code>maven-resources-plugin</code>\u7b49\u5904\u7406\u8d44\u6e90\u6587\u4ef6\u7684\u63d2\u4ef6\u3002</p> <ul> <li><code>&lt;resources&gt;</code>\u6807\u7b7e\u65b9\u5f0f\u5f15\u5165<code>src/main/java</code> \u4e2d\u7684 <code>properties</code> \u548c <code>xml</code> \u6587\u4ef6 <pre><code>&lt;build&gt;\n    .......\n      &lt;resources&gt;\n        &lt;resource&gt;\n            &lt;directory&gt;src/main/resources&lt;/directory&gt;\n            &lt;excludes&gt;\n                &lt;exclude&gt;**/*.properties&lt;/exclude&gt;\n                &lt;exclude&gt;**/*.xml&lt;/exclude&gt;\n             &lt;/excludes&gt;\n            &lt;filtering&gt;false&lt;/filtering&gt;\n        &lt;/resource&gt;\n        &lt;resource&gt;\n            &lt;directory&gt;src/main/java&lt;/directory&gt;\n            &lt;includes&gt;\n                &lt;include&gt;**/*.properties&lt;/include&gt;\n                &lt;include&gt;**/*.xml&lt;/include&gt;\n            &lt;/includes&gt;\n            &lt;filtering&gt;false&lt;/filtering&gt;\n        &lt;/resource&gt;\n    &lt;/resources&gt;\n    ......\n&lt;/build&gt;\n</code></pre></li> <li><code>maven-resources-plugin</code>\u63d2\u4ef6\u65b9\u5f0f\u5f15\u5165<code>src/main/java</code> \u4e2d\u7684 <code>properties</code> \u548c <code>xml</code> \u6587\u4ef6 <pre><code>&lt;plugin&gt;\n    &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt;\n    &lt;version&gt;2.5&lt;/version&gt;\n    &lt;executions&gt;\n        &lt;execution&gt;\n            &lt;id&gt;copy-xmls&lt;/id&gt;\n            &lt;phase&gt;process-sources&lt;/phase&gt;\n            &lt;goals&gt;\n                &lt;goal&gt;copy-resources&lt;/goal&gt;\n            &lt;/goals&gt;\n            &lt;configuration&gt;                                  \n                &lt;outputDirectory&gt;${basedir}/target/classes&lt;/outputDirectory&gt;\n                &lt;resources&gt;\n                    &lt;resource&gt;\n                        &lt;directory&gt;${basedir}/src/main/java&lt;/directory&gt;\n                        &lt;includes&gt;\n                            &lt;include&gt;**/*.xml&lt;/include&gt;\n                        &lt;/includes&gt;\n                    &lt;/resource&gt;\n                &lt;/resources&gt;\n            &lt;/configuration&gt;\n        &lt;/execution&gt;\n    &lt;/executions&gt;\n&lt;/plugin&gt;\n</code></pre></li> </ul> <p>\u53c2\u8003\u6587\u6863</p> <p>maven \u6307\u5357</p>"},{"location":"java/springboot%E4%BD%BF%E7%94%A8k8s%E7%9A%84configMap%E4%BD%9C%E4%B8%BA%E5%A4%96%E9%83%A8%E9%85%8D%E7%BD%AE/","title":"spring boot \u4f7f\u7528 k8s \u7684 configMap \u4f5c\u4e3a\u5916\u90e8\u914d\u7f6e","text":""},{"location":"java/springboot%E4%BD%BF%E7%94%A8k8s%E7%9A%84configMap%E4%BD%9C%E4%B8%BA%E5%A4%96%E9%83%A8%E9%85%8D%E7%BD%AE/#_1","title":"\u4e00\u3001\u2600\ufe0f\u6982\u8ff0","text":"<p><code>spring boot</code> \u5e94\u7528\u4ee5\u5bb9\u5668\u7684\u65b9\u5f0f\u8fd0\u884c\u5728 <code>k8s</code> \u96c6\u7fa4\u4e0a\u9762\u662f\u975e\u5e38\u65b9\u4fbf\u7684\uff0c\u4f46\u662f\u4e0d\u540c\u7684\u73af\u5883\u9700\u8981\u4e0d\u540c\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5916\u90e8\u7684\u914d\u7f6e\u4e2d\u5fc3\uff0c\u6bd4\u5982 <code>nacos</code> \u3001<code>apollo</code>\u3002<code>k8s</code> \u4e5f\u63d0\u4f9b\u4e86 <code>configMap</code> \u7528\u6765\u5c06\u73af\u5883\u914d\u7f6e\u4fe1\u606f\u548c\u5bb9\u5668\u955c\u50cf\u89e3\u8026\uff0c\u4fbf\u4e8e\u5e94\u7528\u914d\u7f6e\u7684\u4fee\u6539\u3002\u672c\u6587\u4e3b\u8981\u4ece\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\u4ecb\u7ecd <code>spring boot</code> \u4f7f\u7528 <code>k8s</code> \u7684 <code>configMap</code> \u4f5c\u4e3a\u5916\u90e8\u914d\u7f6e\u7684\u4f7f\u7528\u65b9\u6cd5\uff1a</p> <ul> <li> <p><code>spring boot</code> \u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\u4ecb\u7ecd</p> </li> <li> <p><code>k8s</code> \u7684 <code>configMap</code> \u4ecb\u7ecd</p> </li> <li> <p>\u4f7f\u7528 <code>k8s</code> \u7684 <code>configMap</code> \u4f5c\u4e3a\u5916\u90e8\u914d\u7f6e\u6587\u4ef6</p> </li> </ul>"},{"location":"java/springboot%E4%BD%BF%E7%94%A8k8s%E7%9A%84configMap%E4%BD%9C%E4%B8%BA%E5%A4%96%E9%83%A8%E9%85%8D%E7%BD%AE/#spring-boot","title":"\u4e8c\u3001\u2600\ufe0fspring boot \u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\u4ecb\u7ecd","text":"<p>\u5f53\u5e94\u7528\u7a0b\u5e8f\u542f\u52a8\u65f6\uff0cSpring Boot \u4f1a\u81ea\u52a8\u4ece\u4ee5\u4e0b\u4f4d\u7f6e\u67e5\u627e\u5e76\u52a0\u8f7d <code>application.properties</code> \u548c <code>application.yaml</code> \u6587\u4ef6\u3002</p> <p>\u914d\u7f6e\u6587\u4ef6\u4f18\u5148\u7ea7\u4ece\u9ad8\u5230\u5e95\u7684\u987a\u5e8f\u5982\u4e0b\uff1a</p> <ol> <li> <p><code>file:./config/</code>  - \u4f18\u5148\u7ea7\u6700\u9ad8\uff08\u9879\u76ee\u6839\u8def\u5f84\u4e0b\u7684<code>/config</code>\u5b50\u76ee\u5f55\uff09</p> </li> <li> <p><code>file:./</code>  - \u4f18\u5148\u7ea7\u7b2c\u4e8c  \uff08\u9879\u76ee\u6839\u8def\u5f84\u4e0b\uff09</p> </li> <li> <p><code>classpath:/config/</code>  - \u4f18\u5148\u7ea7\u7b2c\u4e09\uff08\u9879\u76ee<code>resources/config</code>\u4e0b\uff09</p> </li> <li> <p><code>classpath:/</code>  - \u4f18\u5148\u7ea7\u7b2c\u56db\uff08\u9879\u76ee<code>resources</code>\u6839\u76ee\u5f55\uff09</p> </li> </ol> <p>\u9ad8\u4f18\u5148\u7ea7\u914d\u7f6e\u4f1a\u8986\u76d6\u4f4e\u4f18\u5148\u7ea7\u914d\u7f6e</p> <p>\u5728\u540c\u7ea7\u76ee\u5f55\u4e0b\u540c\u65f6\u5b58\u5728 <code>application.properties</code> \u548c <code>application.yaml</code> \u6587\u4ef6\uff0c\u90a3\u4e48<code>application.properties</code> \u4f1a\u8986\u76d6 <code>application.yaml</code> \u6587\u4ef6</p> <p>\u5982\u679c\u6211\u4eec\u8fd0\u884c\u65f6\u60f3\u6307\u5b9a\u8fd0\u884c\u54ea\u4e2a\u73af\u5883\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u53ef\u4ee5\u6709\u4e09\u79cd\u65b9\u5f0f\uff1a</p> <ol> <li>\u5728\u9879\u76ee resources \u6587\u4ef6\u5939\u4e0b\u7684 <code>application.properties</code> \u6587\u4ef6\u4e2d\u914d\u7f6e <code>spring.profiles.active=dev</code> \u6307\u5b9a\u52a0\u8f7d\u7684\u73af\u5883</li> <li>\u542f\u52a8 jar \u65f6\uff0c\u6307\u5b9a <code>--spring.profiles.active=prod</code> \u52a0\u8f7d\u7684\u73af\u5883</li> <li>\u542f\u52a8 jar \u65f6\uff0c\u6307\u5b9a <code>--spring.config.location=target/application.properties</code>\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\u4f4d\u7f6e</li> </ol>"},{"location":"java/springboot%E4%BD%BF%E7%94%A8k8s%E7%9A%84configMap%E4%BD%9C%E4%B8%BA%E5%A4%96%E9%83%A8%E9%85%8D%E7%BD%AE/#k8s-configmap","title":"\u4e09\u3001\u2600\ufe0fk8s \u7684 <code>configMap</code>\u4ecb\u7ecd","text":"<p><code>ConfigMap</code> \u662f\u4e00\u79cd <code>API</code> \u5bf9\u8c61\uff0c\u7528\u6765\u5c06\u975e\u673a\u5bc6\u6027\u7684\u6570\u636e\u4fdd\u5b58\u5230\u952e\u503c\u5bf9\u4e2d\u3002\u4f7f\u7528\u65f6 <code>pod</code> \u53ef\u4ee5\u5c06\u5176\u7528\u4f5c\u73af\u5883\u53d8\u91cf\u3001\u547d\u4ee4\u884c\u53c2\u6570\u6216\u8005\u5b58\u50a8\u5377\u4e2d\u7684\u914d\u7f6e\u6587\u4ef6\u3002</p> <p>\u6ce8\u610f\uff1a</p> <p><code>ConfigMap</code> \u5e76\u4e0d\u63d0\u4f9b\u4fdd\u5bc6\u6216\u8005\u52a0\u5bc6\u529f\u80fd\u3002 \u5982\u679c\u4f60\u60f3\u5b58\u50a8\u7684\u6570\u636e\u662f\u673a\u5bc6\u7684\uff0c\u8bf7\u4f7f\u7528 <code>secret</code>\u6216\u8005\u4f7f\u7528\u5176\u4ed6\u7b2c\u4e09\u65b9\u5de5\u5177\u6765\u4fdd\u8bc1\u4f60\u7684\u6570\u636e\u7684\u79c1\u5bc6\u6027\uff0c\u800c\u4e0d\u662f\u7528 <code>ConfigMap</code>\u3002</p> <p><code>ConfigMap</code> \u5728\u8bbe\u8ba1\u4e0a\u4e0d\u662f\u7528\u6765\u4fdd\u5b58\u5927\u91cf\u6570\u636e\u7684\uff0c\u5728 <code>ConfigMap</code> \u4e2d\u4fdd\u5b58\u7684\u6570\u636e\u4e0d\u53ef\u8d85\u8fc7 <code>1 MiB</code>\uff0c\u5982\u679c\u9700\u8981\u4fdd\u5b58\u8d85\u51fa\u6b64\u9650\u5236\u7684\u6570\u636e\uff0c\u4f60\u53ef\u4ee5\u8003\u8651\u6302\u8f7d\u5b58\u50a8\u5377\u6216\u8005\u4f7f\u7528\u72ec\u7acb\u7684\u6570\u636e\u5e93\u6216\u8005\u6587\u4ef6\u670d\u52a1\u3002</p> <p>\u521b\u5efa <code>configMap</code> \u7684\u51e0\u79cd\u65b9\u5f0f\uff1a</p> <ol> <li>\u4f7f\u7528\u76ee\u5f55\u521b\u5efa(<code>--from-file</code> \u6307\u5b9a\u5728\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u90fd\u4f1a\u88ab\u7528\u5728<code>ConfigMap</code>\u91cc\u9762\u521b\u5efa\u4e00\u4e2a\u952e\u503c\u5bf9\uff0c\u6709\u591a\u5c11\u4e2a\u6587\u4ef6\u5c31\u6709\u591a\u5c11\u4e2a\u952e\u503c\u5bf9\uff0c\u952e\u7684\u540d\u5b57\u5c31\u662f\u6587\u4ef6\u540d\uff0c\u503c\u5c31\u662f\u6587\u4ef6\u7684\u5185\u5bb9)</li> </ol> <pre><code>kubectl create cm [configmap\u540d\u79f0] --from-file=[\u76ee\u5f55]\n</code></pre> <ol> <li>\u4f7f\u7528\u6587\u4ef6\u521b\u5efa(<code>--from-file</code> \u8fd9\u4e2a\u53c2\u6570\u53ef\u4ee5\u4f7f\u7528\u591a\u6b21\uff0c\u6548\u679c\u5c31\u8ddf\u6307\u5b9a\u6574\u4e2a\u76ee\u5f55\u662f\u4e00\u6837\u7684)</li> </ol> <pre><code>kubectl create cm [configmap\u540d\u79f0] --from-file=[\u6587\u4ef6] --from-file=[\u6587\u4ef6]\n</code></pre> <ol> <li>\u4ece\u5b57\u9762\u503c\u521b\u5efa(<code>--from-literal</code> \u8fd9\u4e2a\u53c2\u6570\u53ef\u4ee5\u4f7f\u7528\u591a\u6b21)</li> </ol> <pre><code>kubectl create cm [configmap\u540d\u79f0] --from-literal=[\u952e=\u503c] --from-literal=[\u952e=\u503c]\n</code></pre> <p>\u793a\u4f8b\uff1a\u4f7f\u7528\u5b57\u9762\u503c\u521b\u5efa\u4e00\u4e2a <code>configMap</code></p> <pre><code> kubectl create cm myconfigMap --from-literal=env=dev --from-literal=name=test\n</code></pre> <pre><code>[root@node01 test]# kubectl describe cm my`configMap\nName:         myconfigmap\nNamespace:    default\nLabels:       &lt;none&gt;\nAnnotations:  &lt;none&gt;\n\nData\n====\nenv:\n----\ndev\nname:\n----\ntest\nEvents:  &lt;none&gt;\n</code></pre> <ol> <li>\u4f7f\u7528 <code>yaml</code> \u6e05\u5355\u6587\u4ef6\u521b\u5efa</li> </ol> <p>\u521b\u5efa\u4e00\u4e2a <code>game-demo.yaml</code> \u6587\u4ef6\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: game-demo\ndata:\n  # \u7c7b\u5c5e\u6027\u952e\uff1b\u6bcf\u4e00\u4e2a\u952e\u90fd\u6620\u5c04\u5230\u4e00\u4e2a\u7b80\u5355\u7684\u503c\n  player_initial_lives: \"3\"\n  ui_properties_file_name: \"user-interface.properties\"\n\n  # \u7c7b\u6587\u4ef6\u952e\uff0c\u952e\u7684\u540d\u5b57\u5c31\u662f\u6587\u4ef6\u540d\uff0c\u503c\u5c31\u662f\u6587\u4ef6\u7684\u5185\u5bb9\n  game.properties: |\n    enemy.types=aliens,monsters\n    player.maximum-lives=5    \n  user-interface.properties: |\n    color.good=purple\n    color.bad=yellow\n    allow.textmode=true    \n</code></pre> <p>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u521b\u5efa <code>configMap</code>\uff1a</p> <pre><code>kubectl apply -f game-demo.yaml\n</code></pre>"},{"location":"java/springboot%E4%BD%BF%E7%94%A8k8s%E7%9A%84configMap%E4%BD%9C%E4%B8%BA%E5%A4%96%E9%83%A8%E9%85%8D%E7%BD%AE/#k8s-configmap_1","title":"\u56db\u3001\u2600\ufe0f\u4f7f\u7528 k8s \u7684 <code>configMap</code>\u4f5c\u4e3a\u5916\u90e8\u914d\u7f6e\u6587\u4ef6","text":"<p>\u4ece\u524d\u9762\u7684\u4ecb\u7ecd\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0cspring boot \u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\u7684\u6700\u9ad8\u4f18\u5148\u7ea7\u662f\u9879\u76ee\u6839\u8def\u5f84\u4e0b\u7684<code>/config</code>\u5b50\u76ee\u5f55\uff0c\u6240\u4ee5\u53ef\u4ee5\u5c06 <code>configMap</code> \u4e2d\u7684\u914d\u7f6e\u6587\u4ef6\u6302\u8f7d\u5230\u5bb9\u5668\u4e2d\u7684\u9879\u76ee\u6839\u8def\u5f84\u4e0b\u7684<code>config</code>\u5b50\u76ee\u5f55\u4e2d\u3002</p> <ol> <li>\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u4ece\u6587\u4ef6\u4e2d\u521b\u5efa\u4e00\u4e2a <code>configMap</code>\uff1a</li> </ol> <pre><code>kubectl create cm  spring-boot-demo  --from-file=application.yaml\n</code></pre> <ol> <li>\u521b\u5efa\u4e00\u4e2a <code>spring-boot-demo.yaml</code> \u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a</li> </ol> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: spring-boot-demo\n  namespace: default\n  labels:\n    app: spring-boot-demo\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: spring-boot-demo\n  template:\n    metadata:\n      labels:\n        app: spring-boot-demo\n    spec:\n      containers:\n        - name: spring-boot-demo\n          image: ${ORIGIN_REPO}/spring-boot-demo:${IMAGE_TAG}\n          imagePullPolicy: Always\n          env:\n            - name: TZ\n              value: Asia/Shanghai\n          ports:\n            - containerPort: 8080\n          resources:\n            requests:\n              cpu: 200m\n              memory: 500Mi\n          # \u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\u6302\u8f7d\u5230 /app/config \u76ee\u5f55\u4e0b\uff0c\u6784\u5efa\u955c\u50cf\u65f6\u7684jar\u5305\u4e5f\u5728 /app \u76ee\u5f55\u4e0b\n          volumeMounts:\n            - mountPath: /app/config\n              name: config\n      imagePullSecrets:\n        - name: docker-password\n      volumes:\n        - configMap:\n            # \u6307\u5b9a\u6211\u4eec\u521b\u5efa\u7684configMap\u7684\u540d\u5b57\n            name: spring-boot-demo\n          # \u81ea\u5b9a\u4e49\u7684\u540d\u5b57\uff0c\u9700\u8981\u8ddf volumeMounts.name \u5339\u914d\n          name: config\n\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: spring-boot-demo\n  namespace: default\n  labels:\n    app: spring-boot-demo\nspec:\n  ports:\n    - name: port\n      port: 80\n      protocol: TCP\n      targetPort: 8080\n  selector:\n    app: spring-boot-demo\n  type: ClusterIP\n</code></pre> <ol> <li>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u521b\u5efa\u6302\u8f7d\u4e86\u914d\u7f6e\u7684 deployment \uff1a</li> </ol> <pre><code>kubectl apply -f spring-boot-demo.yaml\n</code></pre> <ol> <li>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u8fdb\u5165\u5230\u5bb9\u5668\u4e2d\u67e5\u770b\u9a8c\u8bc1\u662f\u5426\u6302\u8f7d\u5230\u914d\u7f6e\u7684\u76ee\u5f55\uff1a</li> </ol> <pre><code># \u67e5\u770bpod\nkubectl get pod -n default\n# \u8fdb\u5165\u5bb9\u5668\nkubectl exec -it spring-boot-demo-76bd6c8857-kwss6  bash\n</code></pre>"},{"location":"java/springboot%E4%BD%BF%E7%94%A8k8s%E7%9A%84configMap%E4%BD%9C%E4%B8%BA%E5%A4%96%E9%83%A8%E9%85%8D%E7%BD%AE/#configmap","title":"\u4e94\u3001\u2600\ufe0f\u88ab\u6302\u8f7d\u7684 <code>configMap</code>\u5185\u5bb9\u4f1a\u88ab\u81ea\u52a8\u66f4\u65b0","text":"<p>\u5f53\u5377\u4e2d\u4f7f\u7528\u7684 <code>configMap</code>\u88ab\u66f4\u65b0\u65f6\uff0c\u6240\u6295\u5c04\u7684\u952e\u6700\u7ec8\u4e5f\u4f1a\u88ab\u66f4\u65b0\u3002 <code>kubelet</code> \u7ec4\u4ef6\u4f1a\u5728\u6bcf\u6b21\u5468\u671f\u6027\u540c\u6b65\u65f6\u68c0\u67e5\u6240\u6302\u8f7d\u7684 <code>configMap</code>\u662f\u5426\u4e3a\u6700\u65b0\u3002 \u4e0d\u8fc7\uff0c<code>kubelet</code> \u4f7f\u7528\u7684\u662f\u5176\u672c\u5730\u7684\u9ad8\u901f\u7f13\u5b58\u6765\u83b7\u5f97 <code>configMap</code>\u7684\u5f53\u524d\u503c\u3002 \u9ad8\u901f\u7f13\u5b58\u7684\u7c7b\u578b\u53ef\u4ee5\u901a\u8fc7 KubeletConfiguration \u7ed3\u6784 \u7684 <code>ConfigMapAndSecretChangeDetectionStrategy</code> \u5b57\u6bb5\u6765\u914d\u7f6e\u3002</p> <p><code>configMap</code>\u65e2\u53ef\u4ee5\u901a\u8fc7 watch \u64cd\u4f5c\u5b9e\u73b0\u5185\u5bb9\u4f20\u64ad\uff08\u9ed8\u8ba4\u5f62\u5f0f\uff09\uff0c\u4e5f\u53ef\u5b9e\u73b0\u57fa\u4e8e TTL \u7684\u7f13\u5b58\uff0c\u8fd8\u53ef\u4ee5\u76f4\u63a5\u7ecf\u8fc7\u6240\u6709\u8bf7\u6c42\u91cd\u5b9a\u5411\u5230 <code>API</code> \u670d\u52a1\u5668\u3002 \u56e0\u6b64\uff0c\u4ece <code>configMap</code>\u88ab\u66f4\u65b0\u7684\u90a3\u4e00\u523b\u7b97\u8d77\uff0c\u5230\u65b0\u7684\u4e3b\u952e\u88ab\u6295\u5c04\u5230 Pod \u4e2d\u53bb\uff0c\u8fd9\u4e00 \u65f6\u95f4\u8de8\u5ea6\u53ef\u80fd\u4e0e <code>kubelet</code> \u7684\u540c\u6b65\u5468\u671f\u52a0\u4e0a\u9ad8\u901f\u7f13\u5b58\u7684\u4f20\u64ad\u5ef6\u8fdf\u76f8\u7b49\u3002 \u8fd9\u91cc\u7684\u4f20\u64ad\u5ef6\u8fdf\u53d6\u51b3\u4e8e\u6240\u9009\u7684\u9ad8\u901f\u7f13\u5b58\u7c7b\u578b \uff08\u5206\u522b\u5bf9\u5e94 watch \u64cd\u4f5c\u7684\u4f20\u64ad\u5ef6\u8fdf\u3001\u9ad8\u901f\u7f13\u5b58\u7684 TTL \u65f6\u957f\u6216\u8005 0\uff09\u3002</p> <p>\u4ee5\u73af\u5883\u53d8\u91cf\u65b9\u5f0f\u4f7f\u7528\u7684 <code>configMap</code>\u6570\u636e\u4e0d\u4f1a\u88ab\u81ea\u52a8\u66f4\u65b0\uff0c\u66f4\u65b0\u8fd9\u4e9b\u6570\u636e\u9700\u8981\u91cd\u65b0\u542f\u52a8 Pod\u3002</p> <p>\u53c2\u8003\u6587\u6863\uff1a</p> <p>k8s \u5b98\u7f51</p> <p>spring boot \u5b98\u7f51</p>"},{"location":"java/%E4%BD%BF%E7%94%A8maven%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8F%92%E4%BB%B6%E5%AE%9E%E7%8E%B0devops/","title":"\u4f7f\u7528 maven \u81ea\u5b9a\u4e49\u63d2\u4ef6\u5b9e\u73b0 devops","text":""},{"location":"java/%E4%BD%BF%E7%94%A8maven%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8F%92%E4%BB%B6%E5%AE%9E%E7%8E%B0devops/#_1","title":"\u6982\u8ff0","text":"<p>\u6700\u8fd1\u5728\u7814\u7a76 <code>devops</code>\uff0c\u524d\u9762\u5199\u4e86\u4e00\u7bc7\u6587\u7ae0\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 <code>k8s + Gitlab + Jenkins + docker</code> \u5b9e\u73b0 <code>devops</code>\uff0c\u5728\u6587\u7ae0\u4e2d\u8bf4\u660e\u9700\u8981\u5728\u9879\u76ee\u4e2d\u5b9a\u4e49\u4e09\u4e2a\u6587\u4ef6\uff1a</p> <ol> <li><code>Jenkinsfile</code> \u6587\u4ef6\uff1a\u63cf\u8ff0\u9879\u76ee\u5728 Jenkins \u4e2d\u7684\u6267\u884c\u6d41\u7a0b\uff0c\u5305\u62ec\u6253\u5305\u4ee5\u53ca\u63a8\u9001\u955c\u50cf\u7b49</li> <li><code>Dockerfile</code> \u6587\u4ef6\uff1a\u63cf\u8ff0\u5982\u4f55\u6784\u5efa\u955c\u50cf</li> <li><code>deployment.yaml</code> \u6587\u4ef6\uff1a\u63cf\u8ff0<code>k8s</code> \u7684\u90e8\u7f72\u6e05\u5355\u6587\u4ef6</li> </ol> <p>\u5bf9\u4e8e spring boot \u9879\u76ee\u6765\u8bf4\uff0c\u5b9e\u73b0 <code>devops</code> \u5bb9\u5668\u5316\u90e8\u7f72\u65f6\uff0c\u8fd9\u4e09\u4e2a\u6587\u4ef6\u662f\u5dee\u4e0d\u591a\u7684\uff0c\u9700\u8981\u53d8\u5316\u7684\u662f\u9879\u76ee\u540d\u4ee5\u53ca\u7aef\u53e3\u53f7\uff0c\u6240\u4ee5\u53ef\u4ee5\u5c06\u8fd9\u4e09\u4e2a\u6587\u4ef6\u63d0\u53d6\u6210\u4e00\u4e2a\u6a21\u677f\uff0c\u901a\u8fc7\u81ea\u5b9a\u4e49\u4e00\u4e2a maven \u63d2\u4ef6\u6765\u6839\u636e\u9879\u76ee\u4e2d\u7684\u914d\u7f6e\u81ea\u52a8\u751f\u6210\u5bf9\u5e94\u7684\u90e8\u7f72\u6587\u4ef6\u3002\u63a5\u4e0b\u6765\u5c06\u8be6\u7ec6\u63cf\u8ff0\u6574\u4e2a\u5b9e\u73b0\u8fc7\u7a0b\u3002</p> <p>\u672c\u6587\u5c06\u4ece\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\u8fdb\u884c\u4ecb\u7ecd\uff1a</p> <ul> <li>maven \u63d2\u4ef6\u5f00\u53d1\u4ecb\u7ecd</li> <li>\u81ea\u5b9a\u4e49\u5b9e\u73b0 <code>devops</code> \u63d2\u4ef6</li> <li>\u63a8\u9001\u81ea\u5b9a\u4e49\u63d2\u4ef6\u5230 maven \u4ed3\u5e93</li> </ul>"},{"location":"java/%E4%BD%BF%E7%94%A8maven%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8F%92%E4%BB%B6%E5%AE%9E%E7%8E%B0devops/#maven","title":"maven \u63d2\u4ef6\u5f00\u53d1\u4ecb\u7ecd","text":""},{"location":"java/%E4%BD%BF%E7%94%A8maven%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8F%92%E4%BB%B6%E5%AE%9E%E7%8E%B0devops/#_2","title":"\u4ec0\u4e48\u662f\u63d2\u4ef6\uff1f","text":"<p>\u201cMaven\u201d \u5b9e\u9645\u4e0a\u53ea\u662f\u4e00\u4e2a\u5305\u542b\u5f88\u591a Maven \u6838\u5fc3\u63d2\u4ef6\u7684\u6846\u67b6\uff0c\u6362\u53e5\u8bdd\u8bf4\uff0c\u63d2\u4ef6\u662f maven \u6267\u884c\u5927\u90e8\u5206\u5b9e\u9645\u64cd\u4f5c\u7684\u5730\u65b9\uff0c\u63d2\u4ef6\u7528\u4e8e\uff1a\u521b\u5efa jar \u6587\u4ef6\u3001\u521b\u5efa war \u6587\u4ef6\u3001\u7f16\u8bd1\u4ee3\u7801\u3001\u5355\u5143\u6d4b\u8bd5\u4ee3\u7801\u3001\u521b\u5efa\u9879\u76ee\u6587\u6863\u7b49\u7b49\u3002\u51e0\u4e4e\u6240\u6709\u4f60\u80fd\u60f3\u5230\u7684\u5bf9\u9879\u76ee\u6267\u884c\u7684\u64cd\u4f5c\u90fd\u662f\u4f5c\u4e3a Maven \u63d2\u4ef6\u5b9e\u73b0\u7684\u3002</p> <p>\u63d2\u4ef6\u662f Maven \u7684\u6838\u5fc3\u529f\u80fd\uff0c\u5141\u8bb8\u8de8\u591a\u4e2a\u9879\u76ee\u91cd\u7528\u516c\u5171\u6784\u5efa\u903b\u8f91\u3002\u4ed6\u4eec\u901a\u8fc7\u5728\u9879\u76ee\u63cf\u8ff0\u7684\u4e0a\u4e0b\u6587 \u9879\u76ee\u5bf9\u8c61\u6a21\u578b (POM) \u4e2d\u6267\u884c \u64cd\u4f5c\uff08\u5373\u521b\u5efa WAR \u6587\u4ef6\u6216\u7f16\u8bd1\u5355\u5143\u6d4b\u8bd5\uff09\u6765\u5b9e\u73b0\u8fd9\u4e00\u70b9\u3002\u63d2\u4ef6\u884c\u4e3a\u53ef\u4ee5\u901a\u8fc7\u4e00\u7ec4\u72ec\u7279\u7684\u53c2\u6570\u8fdb\u884c\u5b9a\u5236\uff0c\u8fd9\u4e9b\u53c2\u6570\u7531\u6bcf\u4e2a\u63d2\u4ef6\u76ee\u6807\uff08\u6216 Mojo\uff09\u7684\u63cf\u8ff0\u516c\u5f00\u3002</p> <p>Maven \u4e2d\u6700\u7b80\u5355\u7684\u63d2\u4ef6\u4e4b\u4e00\u662f <code>Clean Plugin</code>\uff0c\u5b83\u662f\u8d1f\u8d23\u6e05\u9664 Maven \u9879\u76ee\u7684\u76ee\u6807\uff08target\uff09\u76ee\u5f55\u3002\u5f53\u8fd0\u884c <code>mvn clean</code> \u65f6\uff0cMaven \u4f1a\u6267\u884c Clean \u63d2\u4ef6\u4e2d\u5b9a\u4e49\u7684 <code>clean</code> \u76ee\u6807\uff0c\u5e76\u5220\u9664\u76ee\u6807\uff08target\uff09\u76ee\u5f55\u3002</p>"},{"location":"java/%E4%BD%BF%E7%94%A8maven%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8F%92%E4%BB%B6%E5%AE%9E%E7%8E%B0devops/#mojo","title":"\u4ec0\u4e48\u662f mojo?","text":"<p>maven \u63d2\u4ef6\u662f\u7531\u4e00\u4e2a\u6216\u591a\u4e2a <code>mojo</code> \u7ec4\u6210\u7684\uff0c\u6bcf\u4e2a <code>mojo</code> \u662f maven \u4e2d\u7684\u4e00\u4e2a\u53ef\u6267\u884c\u76ee\u6807\u3002\u5176\u5b9e <code>mojo</code> \u8fd9\u4e2a\u540d\u5b57\u548c <code>pojo</code> \uff08<code>plain-old-java-object</code>\uff09 \u7c7b\u4f3c\uff0c\u4f7f\u7528 <code>maven</code> \u4ee3\u66ff <code>plain</code>\uff0c\u6240\u4ee5 <code>mojo</code>\u5168\u79f0\u5c31\u662f\uff08<code>maven-old-java-object</code>\uff09\u3002</p> <p>\u901a\u8fc7\u5c06\u63d2\u4ef6\u7684 <code>mojo</code> \u7ed1\u5b9a\u5230 <code>maven</code> \u751f\u547d\u5468\u671f\u9636\u6bb5\u6765\u5b8c\u6210\u7279\u5b9a\u7684\u529f\u80fd\uff0c\u6bd4\u5982\u6267\u884c <code>mvn package</code> \u5404\u4e2a\u751f\u547d\u5468\u671f\u9636\u6bb5\u7ed1\u5b9a\u7684\u63d2\u4ef6\u76ee\u6807\u5982\u4e0b\u56fe\uff1a</p> <p></p>"},{"location":"java/%E4%BD%BF%E7%94%A8maven%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8F%92%E4%BB%B6%E5%AE%9E%E7%8E%B0devops/#devops","title":"\u81ea\u5b9a\u4e49\u5b9e\u73b0 <code>devops</code> \u63d2\u4ef6","text":""},{"location":"java/%E4%BD%BF%E7%94%A8maven%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8F%92%E4%BB%B6%E5%AE%9E%E7%8E%B0devops/#_3","title":"\u63d2\u4ef6\u547d\u540d\u89c4\u8303","text":"<p>\u7b2c\u4e09\u65b9\u5b9a\u4e49\u7684\u63d2\u4ef6\u547d\u540d\u4e3a\uff1a<code>&lt;yourplugin&gt;-maven-plugin</code></p> <p>maven \u5b98\u65b9\u7684\u63d2\u4ef6\u547d\u540d\u4e3a\uff1a<code>maven-&lt;yourplugin&gt;-plugin</code></p> <p>\u8fd9\u4e2a\u548c spring boot starter \u7684\u547d\u540d\u89c4\u5219\u7c7b\u4f3c</p> <p>spring \u5b98\u65b9\u7684\u7ec4\u4ef6\u547d\u540d\u4e3a\uff1a<code>spring-boot-starter-xxx</code></p> <p>\u7b2c\u4e09\u65b9\u5f00\u53d1\u7684\u7ec4\u4ef6\u547d\u540d\u4e3a\uff1a<code>xxx-spring-boot-starter</code></p> <p>\u9075\u5faa maven \u63d2\u4ef6\u547d\u540d\u7ea6\u5b9a\u7684\u597d\u5904\u662f\uff0c\u5982\u679c\u4f60\u7684\u63d2\u4ef6\u7684 <code>artifactId</code> \u662f <code>maven-first-plugin</code>\u6216\u8005<code>first-maven-plugin</code>\uff0c \u901a\u8fc7 Maven Plugin \u63d2\u4ef6\u751f\u6210\u63d2\u4ef6\u63cf\u8ff0\u7b26\u7684\u65f6\u5019\uff0c\u4f60\u4e0d\u9700\u8981\u663e\u5f0f\u7684\u4e3a\u4f60\u7684\u9879\u76ee\u8bbe\u5b9a <code>goalPrefix</code>\uff0c\u5f53\u6267\u884c<code>maven-plugin-plugin:3.2:descriptor</code>\u8fd9\u4e2a\u76ee\u6807\u7684\u65f6\u5019\uff0cmaven plugin \u4f1a\u4ece  <code>artifactId</code> \u4e2d\u62bd\u53d6\u524d\u7f00 <code>first</code>\u3002</p>"},{"location":"java/%E4%BD%BF%E7%94%A8maven%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8F%92%E4%BB%B6%E5%AE%9E%E7%8E%B0devops/#maven_1","title":"\u521b\u5efa\u4e00\u4e2a maven \u63d2\u4ef6\u9879\u76ee","text":"<p>\u5728\u4e00\u4e2a\u63d2\u4ef6\u9879\u76ee\u7684 <code>pom.xml</code> \u4e2d\u6700\u91cd\u8981\u7684\u5143\u7d20\u662f\u6253\u5305\u7c7b\u578b\uff0c\u5176\u503c\u4e3a <code>maven-plugin</code>\uff0c\u5373 <code>&lt;packaging&gt;maven-plugin&lt;/packaging&gt;</code>\uff0c\u8be5\u6253\u5305\u7c7b\u578b\u4f1a\u5b9a\u5236Maven\u7684\u751f\u547d\u5468\u671f\uff0c\u4f7f\u5176\u5305\u542b\u521b\u5efa\u63d2\u4ef6\u63cf\u8ff0\u7b26\u5fc5\u8981\u7684\u76ee\u6807\u3002\u5b83\u548c Jar \u751f\u547d\u5468\u671f\u7c7b\u4f3c\uff0c\u4f46\u6709\u4e09\u4e2a\u4f8b\u5916\uff1a</p> <ul> <li> <p><code>plugin:descriptor</code> \u88ab\u7ed1\u5b9a\u5230 <code>generate-resources</code> \u9636\u6bb5\uff0c</p> </li> <li> <p><code>plugin:addPluginArtifactMetadata</code> \u88ab\u6dfb\u52a0\u5230 <code>package</code> \u9636\u6bb5\uff0c</p> </li> <li> <p><code>plugin:updateRegistry</code> \u88ab\u6dfb\u52a0\u5230 <code>install</code> \u9636\u6bb5\u3002</p> </li> </ul> <p>\u63d2\u4ef6\u9879\u76ee\u7684 <code>pom.xml</code> \u4e2d\u53e6\u4e00\u4e2a\u91cd\u8981\u7684\u90e8\u5206\u662f\uff0c\u5b83\u6709\u4e00\u4e2a\u5bf9\u4e8e <code>Maven Plugin API</code> \u7684\u4f9d\u8d56\u3002</p>"},{"location":"java/%E4%BD%BF%E7%94%A8maven%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8F%92%E4%BB%B6%E5%AE%9E%E7%8E%B0devops/#maven_2","title":"\u63a8\u9001\u81ea\u5b9a\u4e49\u63d2\u4ef6\u5230 maven \u4ed3\u5e93","text":"<p>\u53c2\u8003\u6587\u6863\uff1a</p> <p>maven \u5b98\u7f51</p> <p>maven \u4e2d\u6587\u6307\u5357</p>"},{"location":"java/%E5%A6%82%E4%BD%95%E7%9B%91%E6%8E%A7%20Java%20%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/","title":"\u5982\u4f55\u76d1\u63a7 Java \u5783\u573e\u56de\u6536","text":"<p>\u8fd9\u662f\u6210\u4e3a Java GC \u4e13\u5bb6\u7cfb\u5217\u7684\u7b2c\u4e8c\u7bc7\u6587\u7ae0\uff0c\u6211\u4eec\u4e86\u89e3\u4e86\u4e0d\u540c GC \u7b97\u6cd5\u7684\u6d41\u7a0b\uff0cGC \u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff0c\u4ec0\u4e48\u662f\u5e74\u8f7b\u4ee3\u548c\u8001\u5e74\u4ee3\uff0c\u4f60\u5e94\u8be5\u4e86\u89e3\u7684 JDK 7 \u4e2d\u7684 5 \u79cd\u7c7b\u578b\u7684 GC\uff1a</p> <ol> <li>Serial GC</li> <li>Parallel GC</li> <li>Parallel Old GC (Parallel Compacting GC)</li> <li>Concurrent Mark &amp; Sweep GC  (or \"CMS\")</li> <li>Garbage First (G1) GC</li> </ol> <p>\u5728\u672c\u6587\u4e2d\uff0c\u6211\u5c06\u4ecb\u7ecd JVM \u5982\u4f55\u5b9e\u65f6\u76d1\u63a7\u8fd0\u884c\u7684\u5783\u573e\u6536\u96c6\u3002</p>"},{"location":"java/%E5%A6%82%E4%BD%95%E7%9B%91%E6%8E%A7%20Java%20%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/#gc","title":"\u4ec0\u4e48\u662f GC \u76d1\u63a7\uff1f","text":"<p>GC \u76d1\u63a7 \u662f\u6307\u5f04\u6e05\u695a JVM \u5982\u4f55\u8fd0\u884c GC \u7684\u8fc7\u7a0b\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0cstop-the-world \u4f55\u65f6\u53d1\u751f\u4ee5\u53ca\u6301\u7eed\u591a\u957f\u65f6\u95f4\u3002</p> <p>\u6267\u884c GC \u76d1\u63a7 \u4ee5\u67e5\u770b JVM \u662f\u5426\u6709\u6548\u5730\u8fd0\u884c GC\uff0c\u5e76\u68c0\u67e5\u662f\u5426\u9700\u8981\u989d\u5916\u7684\u8c03\u6574 GC \u3002\u6839\u636e\u6b64\u4fe1\u606f\uff0c\u53ef\u4ee5\u7f16\u8f91\u5e94\u7528\u7a0b\u5e8f\u6216\u66f4\u6539 GC \u65b9\u6cd5\uff08GC \u8c03\u6574\uff09\u3002</p>"},{"location":"java/%E5%A6%82%E4%BD%95%E7%9B%91%E6%8E%A7%20Java%20%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/#gc_1","title":"\u5982\u4f55\u76d1\u63a7GC\uff1f","text":"<p>\u76d1\u63a7 GC \u7684\u65b9\u5f0f\u6709\u5f88\u591a\u79cd\uff0c\u4f46\u552f\u4e00\u7684\u533a\u522b\u662f GC \u64cd\u4f5c\u4fe1\u606f\u7684\u663e\u793a\u65b9\u5f0f\u3002GC \u662f\u7531 JVM \u6765\u5b8c\u6210\u7684\uff0c\u7531\u4e8e GC \u76d1\u63a7\u5de5\u5177\u4f1a\u516c\u5f00 JVM \u63d0\u4f9b\u7684 GC \u4fe1\u606f\uff0c\u6240\u4ee5\u65e0\u8bba\u4f60\u5982\u4f55\u76d1\u63a7 GC \u90fd\u4f1a\u5f97\u5230\u76f8\u540c\u7684\u7ed3\u679c\uff0c\u56e0\u6b64\u4e0d\u9700\u8981\u5b66\u4e60\u6240\u6709\u7684GC\u76d1\u63a7\u65b9\u6cd5\uff0c\u4f46\u662f\u7531\u4e8e\u5b66\u4e60\u6bcf\u79cdGC\u76d1\u63a7\u65b9\u6cd5\u53ea\u9700\u8981\u5f88\u5c11\u7684\u65f6\u95f4\uff0c\u4e86\u89e3\u5176\u4e2d\u7684\u51e0\u79cd\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u9488\u5bf9\u4e0d\u540c\u7684\u60c5\u51b5\u548c\u73af\u5883\u4f7f\u7528\u6b63\u786e\u7684\u65b9\u6cd5\u3002</p> <p>\u9996\u5148\uff0cGC \u76d1\u63a7\u65b9\u6cd5\u53ef\u4ee5\u6839\u636e\u8bbf\u95ee\u63a5\u53e3\u5206\u4e3a CUI \u548c GUI\uff1a</p> <p>CUI GC \u76d1\u63a7\u65b9\u6cd5\u6709 jstat \u7684\u5355\u72ec CUI \u5e94\u7528\u7a0b\u5e8f\uff0c\u6216\u5728\u8fd0\u884c JVM \u65f6\u9009\u62e9\u540d\u4e3a verbosegc \u7684 JVM \u9009\u9879\u3002</p> <p>GUI GC \u76d1\u63a7\u662f\u901a\u8fc7\u4f7f\u7528\u5355\u72ec\u7684 GUI \u5e94\u7528\u7a0b\u5e8f\u5b8c\u6210\u7684\uff0c\u4e09\u4e2a\u6700\u5e38\u7528\u7684\u5e94\u7528\u7a0b\u5e8f\u662f jconsole\u3001jvisualvm \u548c Visual GC\u3002</p> <p>\u8ba9\u6211\u4eec\u8be6\u7ec6\u4e86\u89e3\u6bcf\u79cd\u65b9\u6cd5\u3002</p>"},{"location":"java/%E5%A6%82%E4%BD%95%E7%9B%91%E6%8E%A7%20Java%20%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/#jstat","title":"jstat","text":"<p>jstat \u662f HotSpot JVM \u4e2d\u7684\u4e00\u4e2a\u76d1\u63a7\u5de5\u5177\uff0cHotSpot JVM \u7684\u5176\u4ed6\u76d1\u63a7\u5de5\u5177\u662f jps \u548c jstatd\uff0c\u6709\u65f6\uff0c\u9700\u8981\u6240\u6709\u4e09\u79cd\u5de5\u5177\u6765\u76d1\u89c6 Java \u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>jstat \u4e0d\u53ea\u63d0\u4f9b GC \u64cd\u4f5c\u4fe1\u606f\u663e\u793a\uff0c\u5b83\u8fd8\u63d0\u4f9b\u7c7b\u52a0\u8f7d\u5668\u64cd\u4f5c\u4fe1\u606f\u6216 Just-in-Time \u7f16\u8bd1\u5668\u64cd\u4f5c\u4fe1\u606f\uff0c\u5728\u672c\u6587\u4e2d\u6211\u4eec\u5c06\u53ea\u4ecb\u7ecd\u5176\u76d1\u63a7GC \u8fd0\u884c\u4fe1\u606f\u7684\u529f\u80fd\u3002</p> <p>jstat \u4f4d\u4e8e<code>$JDK_HOME/bin</code>\uff0c\u5982\u679c\u6211\u4eec\u914d\u7f6e\u597d\u4e86 JDK \u7684\u73af\u5883\u53d8\u91cf\uff0c\u90a3\u4e48 jstat \u4e5f\u53ef\u4ee5\u76f4\u63a5\u547d\u4ee4\u884c\u8fd0\u884c\u3002</p> <p>\u5728\u547d\u4ee4\u884c\u4e2d\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>&gt;jstat\ninvalid argument count\nUsage: jstat -help|-options\n       jstat -&lt;option&gt; [-t] [-h&lt;lines&gt;] &lt;vmid&gt; [&lt;interval&gt; [&lt;count&gt;]]\n\nDefinitions:\n  &lt;option&gt;      An option reported by the -options option\n  &lt;vmid&gt;        Virtual Machine Identifier. A vmid takes the following form:\n                     &lt;lvmid&gt;[@&lt;hostname&gt;[:&lt;port&gt;]]\n                Where &lt;lvmid&gt; is the local vm identifier for the target\n                Java virtual machine, typically a process id; &lt;hostname&gt; is\n                the name of the host running the target Java virtual machine;\n                and &lt;port&gt; is the port number for the rmiregistry on the\n                target host. See the jvmstat documentation for a more complete\n                description of the Virtual Machine Identifier.\n  &lt;lines&gt;       Number of samples between header lines.\n  &lt;interval&gt;    Sampling interval. The following forms are allowed:\n                    &lt;n&gt;[\"ms\"|\"s\"]\n                Where &lt;n&gt; is an integer and the suffix specifies the units as\n                milliseconds(\"ms\") or seconds(\"s\"). The default units are \"ms\".\n  &lt;count&gt;       Number of samples to take before terminating.\n  -J&lt;flag&gt;      Pass &lt;flag&gt; directly to the runtime system.\n</code></pre> <p>vmid\uff08Virtual Machine ID\uff09\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5c31\u662fVM\u7684ID\uff0c\u53ef\u4ee5\u4f7f\u7528 vmid \u6307\u5b9a\u5728\u672c\u5730\u673a\u5668\u6216\u8fdc\u7a0b\u673a\u5668\u4e0a\u8fd0\u884c\u7684 Java \u5e94\u7528\u7a0b\u5e8f\u3002\u8fd0\u884c\u5728\u672c\u5730\u673a\u5668\u4e0a\u7684Java\u5e94\u7528\u7a0b\u5e8f\u7684 vmid \u79f0\u4e3a lvmid\uff08Local vmid\uff09\uff0c\u901a\u5e38\u662fPID\u3002\u8981\u627e\u51fa lvmid\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528ps\u547d\u4ee4\u6216 Windows \u4efb\u52a1\u7ba1\u7406\u5668\u5199\u5165 PID \u503c\uff0c\u4f46\u6211\u4eec\u5efa\u8bae\u4f7f\u7528 jps\uff0c\u56e0\u4e3a PID \u548c lvmid \u5e76\u4e0d\u603b\u662f\u5339\u914d\u3002jps\u4ee3\u8868 Java \u8fdb\u7a0b\uff0cjps \u663e\u793a vmids \u548c\u4e3b\u8981\u65b9\u6cd5\u4fe1\u606f\uff0c\u5c31\u50cf ps \u663e\u793a PID \u548c\u8fdb\u7a0b\u540d\u79f0\u4e00\u6837\u3002</p> <p>\u4f7f\u7528 jps \u627e\u51fa\u4f60\u8981\u76d1\u63a7\u7684 Java \u5e94\u7528\u7684 vmid\uff0c\u7136\u540e\u5728 jstat \u4e2d\u4f5c\u4e3a\u53c2\u6570\u4f7f\u7528\u3002\u5982\u679c\u5355\u72ec\u4f7f\u7528 jps\uff0c\u5f53\u591a\u4e2a WAS \u5b9e\u4f8b\u5728\u4e00\u53f0\u8bbe\u5907\u4e0a\u8fd0\u884c\u65f6\uff0c\u53ea\u4f1a\u663e\u793a\u5f15\u5bfc\u7a0b\u5e8f\u4fe1\u606f\u3002\u6211\u4eec\u5efa\u8bae\u60a8\u4f7f\u7528 <code>ps -ef | grep java</code> \u547d\u4ee4\u4ee5\u53cajps\u3002</p> <p>GC\u6027\u80fd\u6570\u636e\u9700\u8981\u4e0d\u65ad\u89c2\u5bdf\uff0c\u56e0\u6b64\u5728\u8fd0\u884cjstat\u65f6\uff0c\u5c3d\u91cf\u5b9a\u671f\u8f93\u51faGC\u76d1\u63a7\u4fe1\u606f\u3002 </p> <ul> <li><code>jstat \u2013gc &lt;vmid&gt; 1000</code>\uff08\u62161s\uff09\u5c06\u6bcf\u96941\u79d2\u5728\u63a7\u5236\u53f0\u4e0a\u663e\u793a\u4e00\u6b21GC\u76d1\u63a7\u6570\u636e\u3002</li> <li><code>jstat \u2013gc &lt;vmid&gt; 1000 10</code> \u6bcf1\u79d2\u663e\u793a\u4e00\u6b21GC\u76d1\u63a7\u4fe1\u606f\uff0c\u5171\u663e\u793a10\u6b21\u3002</li> </ul> <p>jstat  \u9664\u4e86 -gc \u4e4b\u5916\u8fd8\u6709\u5f88\u591a\u9009\u9879\uff0c\u4e0b\u9762\u5217\u51fa\u4e86\u5176\u4e2d\u4e0e GC \u76f8\u5173\u7684\u9009\u9879\u3002</p> \u9009\u9879\u540d\u79f0 \u63cf\u8ff0 GC \u5b83\u663e\u793a\u4e86\u6bcf\u4e2a\u5806\u533a\u57df\u7684\u5f53\u524d\u5927\u5c0f\u53ca\u5176\u5f53\u524d\u4f7f\u7528\u60c5\u51b5\uff08Ede\u3001survivor\u3001old \u7b49\uff09\u3001\u6267\u884c\u7684 GC \u603b\u6570\u4ee5\u53ca GC \u64cd\u4f5c\u7684\u7d2f\u8ba1\u65f6\u95f4\u3002 gccapactiy \u5b83\u663e\u793a\u4e86\u6bcf\u4e2a\u5806\u533a\u57df\u7684\u6700\u5c0f\u5927\u5c0f (ms) \u548c\u6700\u5927\u5927\u5c0f (mx)\u3001\u5f53\u524d\u5927\u5c0f\u4ee5\u53ca\u6bcf\u4e2a\u533a\u57df\u6267\u884c\u7684 GC \u6b21\u6570\uff08\u4e0d\u663e\u793a GC \u64cd\u4f5c\u7684\u5f53\u524d\u4f7f\u7528\u60c5\u51b5\u548c\u7d2f\u8ba1\u65f6\u95f4\u3002\uff09 gccause \u5b83\u663e\u793a\u4e86\u201c-gcutil \u63d0\u4f9b\u7684\u4fe1\u606f\u201d+ \u4e0a\u6b21 GC \u7684\u539f\u56e0\u548c\u5f53\u524d GC \u7684\u539f\u56e0\u3002 gcnew \u663e\u793a\u65b0\u533a\u57df\u7684 GC \u6027\u80fd\u6570\u636e\u3002 gcnewcapacity \u663e\u793a\u65b0\u533a\u57df\u5927\u5c0f\u7684\u7edf\u8ba1\u4fe1\u606f\u3002 gcold \u663e\u793a\u65e7\u533a\u57df\u7684 GC \u6027\u80fd\u6570\u636e\u3002 gcoldcapacity \u663e\u793a\u65e7\u533a\u57df\u5927\u5c0f\u7684\u7edf\u8ba1\u4fe1\u606f\u3002 gcpermcapacity \u663e\u793a\u6c38\u4e45\u533a\u57df\u7684\u7edf\u8ba1\u6570\u636e\u3002 gcutil \u4ee5\u767e\u5206\u6bd4\u663e\u793a\u6bcf\u4e2a\u5806\u533a\u57df\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u8fd8\u663e\u793a\u6267\u884c\u7684 GC \u603b\u6570\u548c GC \u64cd\u4f5c\u7684\u7d2f\u8ba1\u65f6\u95f4\u3002 <p>\u4ec5\u67e5\u770b\u9891\u7387\uff0c\u60a8\u53ef\u80fd\u4f1a\u6309\u8be5\u987a\u5e8f\u6700\u591a\u4f7f\u7528 -gcutil\uff08\u6216 -gccause\uff09\uff0c-gc\u548c -gccapacity\u3002</p> <ul> <li>-gcutil \u7528\u4e8e\u68c0\u67e5\u5806\u533a\u57df\u7684\u4f7f\u7528\u60c5\u51b5\u3001\u6267\u884c\u7684 GC \u6b21\u6570\u4ee5\u53ca GC \u64cd\u4f5c\u7684\u603b\u7d2f\u8ba1\u65f6\u95f4\uff0c</li> <li>-gccapacity \u9009\u9879\u548c\u5176\u4ed6\u9009\u9879\u53ef\u7528\u4e8e\u68c0\u67e5\u5206\u914d\u7684\u5b9e\u9645\u5927\u5c0f\u3002</li> </ul> <p>\u60a8\u53ef\u4ee5\u4f7f\u7528-gc\u9009\u9879\u67e5\u770b\u4ee5\u4e0b\u8f93\u51fa\uff1a</p> <pre><code>&gt;jstat  -gc 15076 1000 3\n S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT\n33280.0 31744.0  0.0   22891.1 652800.0 250844.6  216064.0   51610.3   70528.0 66272.3 9088.0 8293.1     17    0.247   3      0.297    0.543\n33280.0 31744.0  0.0   22891.1 652800.0 250844.6  216064.0   51610.3   70528.0 66272.3 9088.0 8293.1     17    0.247   3      0.297    0.543\n33280.0 31744.0  0.0   22891.1 652800.0 250844.6  216064.0   51610.3   70528.0 66272.3 9088.0 8293.1     17    0.247   3      0.297    0.543\n</code></pre> <p>\u4e0d\u540c\u7684 jstat \u9009\u9879\u663e\u793a\u4e0d\u540c\u7c7b\u578b\u7684\u5217\uff0c\u5982\u4e0b\u6240\u5217\u3002\u5f53\u60a8\u4f7f\u7528\u524d\u9762\u5217\u51fa\u7684 jstat \u9009\u9879 \u65f6\uff0c\u5c06\u663e\u793a\u6bcf\u5217\u4fe1\u606f\u3002</p> \u5217 \u63cf\u8ff0 Jstat \u9009\u9879 S0C \u4ee5 KB \u4e3a\u5355\u4f4d\u663e\u793a Survivor0 \u533a\u57df\u7684\u5f53\u524d\u5927\u5c0f -gc -gccapacity -gcnew -gcnewcapacity S1C \u4ee5 KB \u4e3a\u5355\u4f4d\u663e\u793a Survivor1 \u533a\u57df\u7684\u5f53\u524d\u5927\u5c0f -gc -gccapacity -gcnew -gcnewcapacity S0U \u4ee5 KB \u4e3a\u5355\u4f4d\u663e\u793a Survivor0 \u533a\u57df\u7684\u5f53\u524d\u4f7f\u7528\u60c5\u51b5 -gc -gcnew S1U \u4ee5 KB \u4e3a\u5355\u4f4d\u663e\u793a Survivor1 \u533a\u57df\u7684\u5f53\u524d\u4f7f\u7528\u60c5\u51b5 -gc -gcnew EC \u4ee5 KB \u4e3a\u5355\u4f4d\u663e\u793a Eden \u533a\u57df\u7684\u5f53\u524d\u5927\u5c0f -gc -gccapacity -gcnew -gcnewcapacity EU \u4ee5 KB \u4e3a\u5355\u4f4d\u663e\u793a Eden \u533a\u57df\u7684\u5f53\u524d\u4f7f\u7528\u60c5\u51b5 -gc -gcnew OC \u4ee5 KB \u4e3a\u5355\u4f4d\u663e\u793a\u65e7\u533a\u57df\u7684\u5f53\u524d\u5927\u5c0f -gc -gccapacity -gcold -gcoldcapacity OU \u4ee5KB\u4e3a\u5355\u4f4d\u663e\u793a\u65e7\u533a\u7684\u5f53\u524d\u4f7f\u7528\u60c5\u51b5 -gc -gcold PC \u4ee5 KB \u4e3a\u5355\u4f4d\u663e\u793a\u6c38\u4e45\u533a\u57df\u7684\u5f53\u524d\u5927\u5c0f -gc -gccapacity -gcold -gcoldcapacity -gcpermcapacity PU \u4ee5KB\u4e3a\u5355\u4f4d\u663e\u793a\u6c38\u4e45\u533a\u57df\u7684\u5f53\u524d\u4f7f\u7528\u60c5\u51b5 -gc -gcold YGC \u5e74\u8f7b\u533aGC\u4e8b\u4ef6\u53d1\u751f\u6b21\u6570 -gc -gccapacity -gcnew -gcnewcapacity -gcold -gcoldcapacity -gcpermcapacity -gcutil -gccause YGCT \u6c38\u533aGC\u64cd\u4f5c\u7d2f\u8ba1\u65f6\u95f4 -gc -gcnew -gcutil -gccause FGC full GC \u4e8b\u4ef6\u53d1\u751f\u7684\u6b21\u6570 -gc -gccapacity -gcnew -gcnewcapacity -gcold -gcoldcapacity -gcpermcapacity -gcutil -gccause FGCT full GC \u64cd\u4f5c\u7684\u7d2f\u8ba1\u65f6\u95f4 -gc -gcold -gcoldcapacity -gcpermcapacity -gcutil -gccause GCT GC \u64cd\u4f5c\u7684\u603b\u7d2f\u8ba1\u65f6\u95f4 -gc -gcold -gcoldcapacity -gcpermcapacity -gcutil -gccause NGCMN \u65b0\u533a\u7684\u6700\u5c0f\u5927\u5c0f (KB) -gccapacity -gcnewcapacity NGCMX max area \u7684\u6700\u5927\u5927\u5c0f (KB) -gccapacity -gcnewcapacity NGC \u65b0\u533a\u7684\u5f53\u524d\u5927\u5c0f (KB) -gccapacity -gcnewcapacity OGCMN \u65e7\u533a\u7684\u6700\u5c0f\u5927\u5c0f\uff08KB\uff09 -gccapacity -gcoldcapacity OGCMX \u65e7\u533a\u7684\u6700\u5927\u5927\u5c0f\uff08KB\uff09 -gccapacity -gcoldcapacity OGC \u65e7\u533a\u7684\u5f53\u524d\u5927\u5c0f (KB) -gccapacity -gcoldcapacity PGCMN \u6c38\u4e45\u533a\u57df\u7684\u6700\u5c0f\u5927\u5c0f (KB) -gccapacity -gcpermcapacity PGCMX \u6c38\u4e45\u533a\u57df\u7684\u6700\u5927\u5927\u5c0f (KB) -gccapacity -gcpermcapacity PGC \u6c38\u4e45\u4ee3\u533a\u7684\u5f53\u524d\u5927\u5c0f (KB) -gccapacity -gcpermcapacity LGCC \u4e0a\u6b21 GC \u53d1\u751f\u7684\u539f\u56e0 -gccause TT \u4efb\u671f\u95e8\u69db\u3002\u5982\u679c\u5728\u5e74\u8f7b\u533a\u57df\uff08S0 -&gt; S1\uff0cS1-&gt; S0\uff09\u4e2d\u590d\u5236\u4e86\u8fd9\u4e2a\u6b21\u6570\uff0c\u5219\u5b83\u4eec\u5c06\u88ab\u79fb\u52a8\u5230\u65e7\u533a\u57df\u3002 -gcnew MTT \u6700\u5927\u4efb\u671f\u9608\u503c\u3002\u5982\u679c\u5728\u5e74\u8f7b\u533a\u57df\u5185\u590d\u5236\u4e86\u8fd9\u4e48\u591a\u6b21\uff0c\u90a3\u4e48\u5b83\u4eec\u5c06\u88ab\u79fb\u52a8\u5230\u65e7\u533a\u57df\u3002 -gcnew DSS \u4ee5 KB \u4e3a\u5355\u4f4d\u7684\u8db3\u591f\u5927\u5c0f\u7684\u5e78\u5b58\u8005 -gcnew <p>jstat\u7684\u4f18\u70b9\u662f\u53ef\u4ee5\u968f\u65f6\u76d1\u63a7\u672c\u5730/\u8fdc\u7a0b\u673a\u5668\u4e0a\u8fd0\u884c\u7684Java\u5e94\u7528\u7684GC\u8fd0\u884c\u6570\u636e\uff0c\u53ea\u8981\u4f7f\u7528\u63a7\u5236\u53f0\u5373\u53ef\u3002\u4ece\u8fd9\u4e9b\u9879\u76ee\u4e2d\uff0c\u4f7f\u7528-gcutil\u65f6\u8f93\u51fa\u4ee5\u4e0b\u7ed3\u679c\u3002\u5728GC\u8c03\u4f18\u7684\u65f6\u5019\uff0c\u8981\u7279\u522b\u6ce8\u610fYGC\u3001YGCT\u3001FGC\u3001FGCT\u548cGCT\u3002</p> <pre><code>&gt;jstat  -gcutil 15076 1000 3\n  S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT\n  0.00  72.11  39.82  23.89  93.97  91.25     17    0.247     3    0.297    0.543\n  0.00  72.11  39.82  23.89  93.97  91.25     17    0.247     3    0.297    0.543\n  0.00  72.11  39.99  23.89  93.97  91.25     17    0.247     3    0.297    0.543\n</code></pre> <p>\u8fd9\u4e9b\u9879\u76ee\u5f88\u91cd\u8981\uff0c\u56e0\u4e3a\u5b83\u4eec\u663e\u793a\u4e86\u8fd0\u884c GC \u82b1\u8d39\u4e86\u591a\u5c11\u65f6\u95f4\u3002</p>"},{"location":"java/%E5%A6%82%E4%BD%95%E7%9B%91%E6%8E%A7%20Java%20%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/#-verbosegc","title":"-verbosegc","text":"<p>-verbosegc \u662f\u8fd0\u884c Java \u5e94\u7528\u7a0b\u5e8f\u65f6\u6307\u5b9a\u7684 JVM \u9009\u9879\u4e4b\u4e00\u3002\u867d\u7136 jstat \u53ef\u4ee5\u76d1\u63a7\u4efb\u4f55\u6ca1\u6709\u6307\u5b9a\u4efb\u4f55\u9009\u9879\u7684 JVM \u5e94\u7528\u7a0b\u5e8f\uff0c\u4f46-verbosegc\u9700\u8981\u5728\u5f00\u59cb\u65f6\u6307\u5b9a\uff0c\u56e0\u6b64\u5b83\u53ef\u4ee5\u88ab\u89c6\u4e3a\u4e00\u4e2a\u4e0d\u5fc5\u8981\u7684\u9009\u9879\uff08\u56e0\u4e3a\u53ef\u4ee5\u4f7f\u7528 jstat \u4ee3\u66ff\uff09\u3002\u4f46\u662f\uff0c\u7531\u4e8e-verbosegc\u5728\u53d1\u751f GC \u65f6\u663e\u793a\u6613\u4e8e\u7406\u89e3\u7684\u8f93\u51fa\u7ed3\u679c\uff0c\u56e0\u6b64\u5bf9\u4e8e\u76d1\u89c6\u7c97\u7565\u7684 GC \u4fe1\u606f\u975e\u5e38\u6709\u5e2e\u52a9\u3002</p> \u7edf\u8ba1\u6570\u636e -verbosegc Monitoring Target \u5728\u53ef\u4ee5\u767b\u5f55\u7ec8\u7aef\u7684\u673a\u5668\u4e0a\u8fd0\u884c\u7684 Java \u5e94\u7528\u7a0b\u5e8f\uff0c\u6216\u8005\u53ef\u4ee5\u4f7f\u7528 jstatd \u8fde\u63a5\u5230\u7f51\u7edc\u7684\u8fdc\u7a0b Java \u5e94\u7528\u7a0b\u5e8f \u4ec5\u5f53 -verbosegc \u88ab\u6307\u5b9a\u4e3a JVM \u542f\u52a8\u9009\u9879\u65f6 Output information \u5806\u72b6\u6001\uff08\u4f7f\u7528\u60c5\u51b5\u3001\u6700\u5927\u5927\u5c0f\u3001GC \u6b21\u6570/\u65f6\u95f4\u7b49\uff09 GC \u524d\u540e new \u548c old \u533a\u7684\u5927\u5c0f\uff0c\u4ee5\u53ca GC \u8fd0\u884c\u65f6\u95f4 Output Time \u6bcf\u4e2a\u6307\u5b9a\u65f6\u95f4 \u6bcf\u6b21 GC \u53d1\u751f\u7684\u65f6\u95f4 Whenever useful \u5c1d\u8bd5\u89c2\u5bdf\u5806\u533a\u57df\u5927\u5c0f\u7684\u53d8\u5316\u65f6 \u67e5\u770b\u5355\u4e2a GC \u7684\u6548\u679c <p>\u4ee5\u4e0b\u662f\u53ef\u4e0e-verbosegc\u4e00\u8d77\u4f7f\u7528\u7684\u5176\u4ed6\u9009\u9879\u3002</p> <ul> <li>-XX:+PrintGCDetails</li> <li>-XX:+PrintGCTimeStamps</li> <li>-XX:+PrintHeapAtGC </li> <li>-XX:+PrintGCDateStamps\uff08\u6765\u81ea JDK 6 \u66f4\u65b0 4\uff09</li> </ul> <p>\u5982\u679c\u4ec5\u4f7f\u7528 -verbosegc\uff0c\u5219\u9ed8\u8ba4\u5e94\u7528-XX:+PrintGCDetails\u3002\u2013verbosgc \u9644\u52a0\u9009\u9879\u4e0d\u662f\u552f\u4e00\u7684\uff0c\u53ef\u4ee5\u6df7\u5408\u4f7f\u7528\u3002</p> <p>\u4f7f\u7528 -verbosegc \u65f6\uff0c\u53ea\u8981\u53d1\u751f minor GC\uff0c\u5c31\u53ef\u4ee5\u770b\u5230\u4ee5\u4e0b\u683c\u5f0f\u7684\u7ed3\u679c\u3002</p> <pre><code>[GC [&lt;collector&gt;: &lt;starting occupancy1&gt; -&gt; &lt;ending occupancy1&gt;, &lt;pause time1&gt; secs] &lt;starting occupancy3&gt; -&gt; &lt;ending occupancy3&gt;, &lt;pause time3&gt; secs]\n</code></pre> Collector \u7528\u4e8e\u6b21\u8981 gc \u7684\u6536\u96c6\u5668\u540d\u79f0 starting occupancy1 GC\u524d\u5e74\u8f7b\u533a\u57df\u7684\u5927\u5c0f ending occupancy1 GC\u540e\u5e74\u8f7b\u533a\u57df\u7684\u5927\u5c0f pause time1 Java \u5e94\u7528\u7a0b\u5e8f\u505c\u6b62\u8fd0\u884c\u4ee5\u8fdb\u884c\u6b21\u8981 GC \u7684\u65f6\u95f4 starting occupancy3 GC\u524d\u5806\u533a\u603b\u5927\u5c0f ending occupancy3 GC\u540e\u5806\u533a\u603b\u5927\u5c0f pause time3 Java \u5e94\u7528\u7a0b\u5e8f\u505c\u6b62\u8fd0\u884c\u6574\u4e2a\u5806 GC \u7684\u65f6\u95f4\uff0c\u5305\u62ec\u4e3b\u8981 GC <p>\u8fd9\u662fFull GC\u7684 -verbosegc \u8f93\u51fa\u793a\u4f8b\uff1a</p> <pre><code>[Full GC [Tenured: 3485K-&gt;4095K(4096K), 0.1745373 secs] 61244K-&gt;7418K(63104K), [Perm : 10756K-&gt;10756K(12288K)], 0.1762129 secs] [Times: user=0.19 sys=0.00, real=0.19 secs]\n</code></pre> <p>\u7531\u4e8e-verbosegc\u9009\u9879\u5728\u6bcf\u6b21\u53d1\u751f GC \u4e8b\u4ef6\u65f6\u90fd\u4f1a\u8f93\u51fa\u65e5\u5fd7\uff0c\u56e0\u6b64\u5f88\u5bb9\u6613\u770b\u5230 GC \u64cd\u4f5c\u5bfc\u81f4\u7684\u5806\u4f7f\u7528\u7387\u7684\u53d8\u5316\u3002</p>"},{"location":"java/%E5%A6%82%E4%BD%95%E7%9B%91%E6%8E%A7%20Java%20%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/#java-visualvm-visual-gc","title":"(Java) VisualVM + Visual GC","text":"<p>Java Visual VM \u662f Oracle JDK \u63d0\u4f9b\u7684 GUI \u5206\u6790/\u76d1\u63a7\u5de5\u5177\u3002</p> <p></p> <p>\u56fe 1\uff1aVisualVM \u5c4f\u5e55\u622a\u56fe\u3002</p> <p>\u53ef\u4ee5\u76f4\u63a5\u4ece\u5176\u7f51\u7ad9\u4e0b\u8f7d Visual VM\uff0c\u800c\u4e0d\u662f JDK \u9644\u5e26\u7684\u7248\u672c\u3002\u4e3a\u65b9\u4fbf\u8d77\u89c1\uff0cJDK\u9644\u5e26\u7684\u7248\u672c\u5c06\u88ab\u79f0\u4e3aJava VisualVM\uff08jvisualvm\uff09\uff0c\u7f51\u7ad9\u63d0\u4f9b\u7684\u7248\u672c\u5c06\u88ab\u79f0\u4e3aVisual VM\uff08visualvm\uff09\u3002\u4e24\u8005\u7684\u529f\u80fd\u5e76\u4e0d\u5b8c\u5168\u76f8\u540c\uff0c\u56e0\u4e3a\u5b58\u5728\u7ec6\u5fae\u5dee\u522b\uff0c\u4f8b\u5982\u5728\u5b89\u88c5\u63d2\u4ef6\u65f6\u3002\u6211\u4e2a\u4eba\u66f4\u559c\u6b22 Visual VM \u7248\u672c\uff0c\u53ef\u4ee5\u4ece\u7f51\u7ad9\u4e0b\u8f7d\u3002</p> <p>\u8fd0\u884c Visual VM \u540e\uff0c\u5982\u679c\u4ece\u5de6\u4fa7\u7a97\u53e3\u4e2d\u9009\u62e9\u8981\u76d1\u63a7\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u53ef\u4ee5\u5728\u90a3\u91cc\u627e\u5230\u201c\u76d1\u63a7\u201d\u9009\u9879\u5361\u3002\u60a8\u53ef\u4ee5\u4ece\u6b64\u76d1\u63a7\u9009\u9879\u5361\u4e2d\u83b7\u53d6\u6709\u5173 GC \u548c Heap \u7684\u57fa\u672c\u4fe1\u606f\u3002 </p> <p>\u867d\u7136\u57fa\u672c GC \u72b6\u6001\u4e5f\u53ef\u901a\u8fc7 VisualVM \u7684\u57fa\u672c\u529f\u80fd\u83b7\u5f97\uff0c\u4f46\u60a8\u65e0\u6cd5\u8bbf\u95ee jstat \u6216 -verbosegc \u9009\u9879\u63d0\u4f9b\u7684\u8be6\u7ec6\u4fe1\u606f\u3002 </p> <p>\u5982\u679c\u60f3\u8981jstat\u63d0\u4f9b\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u90a3\u4e48\u5efa\u8bae\u5b89\u88c5Visual GC\u63d2\u4ef6\u3002 </p> <p>\u53ef\u4ee5\u4ece\u201c\u5de5\u5177\u201d\u83dc\u5355\u5b9e\u65f6\u8bbf\u95ee Visual GC \u3002</p> <p></p> <p>\u56fe 2\uff1aViusal GC \u5b89\u88c5\u5c4f\u5e55\u622a\u56fe\u3002</p> <p>\u901a\u8fc7\u4f7f\u7528 Visual GC\uff0c\u60a8\u53ef\u4ee5\u66f4\u76f4\u89c2\u5730\u770b\u5230\u8fd0\u884cjstatd\u63d0\u4f9b\u7684\u4fe1\u606f\u3002  </p> <p></p> <p>\u56fe 3\uff1aVisual GC \u6267\u884c\u622a\u56fe\u3002</p>"},{"location":"java/%E5%A6%82%E4%BD%95%E7%9B%91%E6%8E%A7%20Java%20%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/#hpjmeter","title":"HPJMeter","text":"<p>HPJMeter\u4fbf\u4e8e\u5206\u6790-verbosegc\u8f93\u51fa\u7ed3\u679c\u3002\u5982\u679c\u53ef\u4ee5\u5c06 Visual GC \u89c6\u4e3a jstat \u7684 GUI \u7b49\u4ef7\u7269\uff0c\u90a3\u4e48 HPJMeter \u5c06\u662f -verbosgc \u7684 GUI \u7b49\u4ef7\u7269\u3002\u5f53\u7136\uff0cGC \u5206\u6790\u53ea\u662f HPJMeter \u63d0\u4f9b\u7684\u4f17\u591a\u529f\u80fd\u4e4b\u4e00\u3002HPJMeter \u662f HP \u5f00\u53d1\u7684\u6027\u80fd\u76d1\u63a7\u5de5\u5177\uff0c\u5b83\u53ef\u4ee5\u5728 HP-UX \u4ee5\u53ca Linux \u548c MS Windows \u4e2d\u4f7f\u7528\u3002</p> <p>\u6700\u521d\uff0c\u4e00\u4e2a\u540d\u4e3aHPTune\u7684\u5de5\u5177\u7528\u4e8e\u4e3a-verbosegc\u63d0\u4f9b GUI \u5206\u6790\u529f\u80fd\u3002\u4f46\u662f\uff0c\u7531\u4e8e HPJMeter \u4ece 3.0 \u7248\u672c\u5f00\u59cb\u5df2\u7ecf\u96c6\u6210\u4e86 HPTune \u529f\u80fd\uff0c\u56e0\u6b64\u65e0\u9700\u5355\u72ec\u4e0b\u8f7d HPTune\u3002</p> <p>\u6267\u884c\u5e94\u7528\u7a0b\u5e8f\u65f6\uff0c-verbosegc \u8f93\u51fa\u7ed3\u679c\u5c06\u88ab\u91cd\u5b9a\u5411\u5230\u5355\u72ec\u7684\u6587\u4ef6\u3002</p> <p>\u60a8\u53ef\u4ee5\u4f7f\u7528 HPJMeter \u6253\u5f00\u91cd\u5b9a\u5411\u7684\u6587\u4ef6\uff0c\u4ece\u800c\u901a\u8fc7\u76f4\u89c2\u7684 GUI \u66f4\u5feb\u3001\u66f4\u8f7b\u677e\u5730\u5206\u6790 GC \u6027\u80fd\u6570\u636e\u3002</p> <p></p> <p>\u56fe 4\uff1aHPJMeter\u3002</p>"},{"location":"java/%E5%A6%82%E4%BD%95%E7%9B%91%E6%8E%A7%20Java%20%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/#_1","title":"\u603b\u7ed3","text":"<p>\u5728\u672c\u6587\u4e2d\uff0c\u91cd\u70b9\u4ecb\u7ecd\u4e86\u5982\u4f55\u76d1\u63a7 GC \u64cd\u4f5c\u4fe1\u606f\uff0c\u4f5c\u4e3a GC \u8c03\u4f18\u7684\u51c6\u5907\u9636\u6bb5\u3002\u4ece\u6211\u4e2a\u4eba\u7684\u7ecf\u9a8c\u6765\u770b\uff0c\u6211\u5efa\u8bae\u4f7f\u7528 jstat \u6765\u76d1\u63a7GC\u64cd\u4f5c\uff0c\u5982\u679c\u4f60\u89c9\u5f97\u6267\u884cGC\u7684\u65f6\u95f4\u592a\u957f\uff0c\u90a3\u5c31\u8bd5\u8bd5 -verbosegc \u9009\u9879\u6765\u5206\u6790GC\u3002\u4e00\u822c\u7684 GC \u8c03\u4f18\u8fc7\u7a0b\u662f\u5728\u57fa\u4e8e\u5206\u6790\u5e94\u7528 -verbosegc \u9009\u9879\u540e\uff0c\u6839\u636e\u5206\u6790\u7ed3\u679c\u66f4\u6539\u5e94\u7528\u7684 GC \u9009\u9879\u3002\u5728\u4e0b\u4e00\u7bc7\u6587\u7ae0\u4e2d\uff0c\u6211\u4eec\u5c06\u901a\u8fc7\u4f7f\u7528\u771f\u5b9e\u6848\u4f8b\u4f5c\u4e3a\u793a\u4f8b\u6765\u4e86\u89e3\u6267\u884c GC \u8c03\u4f18\u7684\u6700\u4f73\u9009\u9879\u3002</p> <p>\u53c2\u8003\u6587\u7ae0</p> <p>https://www.cubrid.org/blog/3826417</p>"},{"location":"java/%E5%A6%82%E4%BD%95%E8%B0%83%E4%BC%98%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86/","title":"\u5982\u4f55\u8c03\u4f18 Java \u5783\u573e\u6536\u96c6","text":"<p>\u5728\u7b2c\u4e00\u671f\u300aUnderstanding Java Garbage Collection\u300b\u4e2d\uff0c\u6211\u4eec\u4e86\u89e3\u4e86\u4e0d\u540c GC \u7b97\u6cd5\u7684\u6d41\u7a0b\uff0cGC \u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff0c\u4ec0\u4e48\u662f\u5e74\u8f7b\u4ee3\u548c\u8001\u5e74\u4ee3\uff0c\u4f60\u5e94\u8be5\u4e86\u89e3\u7684 JDK 7 \u4e2d\u7684 5 \u79cd\u7c7b\u578b\u7684 GC\u3002</p> <p>\u5728\u7b2c\u4e8c\u7bc7\u6587\u7ae0\u5982\u4f55\u76d1\u63a7 Java \u5783\u573e\u56de\u6536\u4e2d\uff0c\uff0c\u5df2\u7ecf\u89e3\u91ca\u4e86\u5982\u4f55\u76d1\u63a7 GC\uff0c\u4ee5\u53ca\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u54ea\u4e9b\u5de5\u5177\u6765\u4f7f\u8fd9\u4e2a\u8fc7\u7a0b\u66f4\u5feb\u66f4\u6709\u6548\u3002</p> <p>\u5728\u8fd9\u7bc7\u6587\u7ae0\u4e2d\u5c06\u5c55\u793a\u4e00\u4e9b\u53ef\u7528\u4e8e GC \u8c03\u4f18\u7684\u6700\u4f73\u9009\u9879\uff0c\u9605\u8bfb\u8fd9\u7bc7\u6587\u7ae0\u7684\u524d\u63d0\u662f\u4f60\u5df2\u7ecf\u7406\u89e3\u4e86\u672c\u7cfb\u5217\u7684\u524d\u51e0\u7bc7\u6587\u7ae0\u3002\u56e0\u6b64\uff0c\u4e3a\u4e86\u4f60\u7684\u8fdb\u4e00\u6b65\u7406\u89e3\uff0c\u5982\u679c\u4f60\u8fd8\u6ca1\u6709\u9605\u8bfb\u524d\u4e24\u7bc7\u6587\u7ae0\uff0c\u8bf7\u5728\u9605\u8bfb\u672c\u6587\u4e4b\u524d\u5148\u9605\u8bfb\u3002</p>"},{"location":"java/%E5%A6%82%E4%BD%95%E8%B0%83%E4%BC%98%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86/#gc","title":"\u662f\u5426\u9700\u8981 GC \u8c03\u4f18\uff1f","text":"<p>\u6216\u8005\u66f4\u51c6\u786e\u5730\u8bf4 \u57fa\u4e8e Java \u7684\u670d\u52a1 \u662f\u5426\u9700\u8981 GC \u8c03\u4f18\uff1f\u4e8b\u5b9e\u4e0a\u5e76\u4e0d\u662f\u6240\u6709\u57fa\u4e8e Java \u7684\u670d\u52a1\u90fd\u9700\u8981GC \u8c03\u4f18\uff0c\u4e5f\u5c31\u662f\u8bf4\u8fd0\u884c\u4e2d\u7684\u57fa\u4e8e Java \u7684\u7cfb\u7edf\u5177\u6709\u4ee5\u4e0b\u9009\u9879\u548c\u64cd\u4f5c\u901a\u5e38\u4e0d\u9700\u8981\u8fdb\u884c GC \u8c03\u4f18\uff1a</p> <ul> <li>\u5df2\u4f7f\u7528<code>-Xms</code>\u548c<code>\u2013Xmx</code>\u9009\u9879\u6307\u5b9a\u5185\u5b58\u5927\u5c0f\u3002</li> <li>\u7cfb\u7edf\u4e2d\u6ca1\u6709\u8d85\u65f6\u65e5\u5fd7\u3002</li> </ul> <p>\u6362\u53e5\u8bdd\u8bf4\uff0c\u5982\u679c\u4f60\u6ca1\u6709\u8bbe\u7f6e\u5185\u5b58\u5927\u5c0f\uff0c\u5e76\u4e14\u6253\u5370\u4e86\u592a\u591a\u7684Timeout\u65e5\u5fd7\uff0c\u4f60\u5c31\u9700\u8981\u5bf9\u4f60\u7684\u7cfb\u7edf\u8fdb\u884cGC\u8c03\u4f18\u4e86\u3002</p> <p>\u4f46\u662f\uff0c\u8981\u8bb0\u4f4f\u4e00\u4ef6\u4e8b\uff1aGC \u8c03\u4f18\u662f\u6700\u540e\u4e00\u4e2a\u8981\u5b8c\u6210\u7684\u4efb\u52a1\u3002</p> <p>\u60f3\u60f3GC\u8c03\u4f18\u7684\u6839\u672c\u539f\u56e0\uff1a\u5783\u573e\u6536\u96c6\u5668\u6e05\u9664\u5728 Java \u4e2d\u521b\u5efa\u7684\u5bf9\u8c61\uff0c\u9700\u8981\u6e05\u9664\u7684\u5bf9\u8c61\u6570\u91cf\u4ee5\u53ca\u8981\u6267\u884c\u7684 GC \u6b21\u6570\u53d6\u51b3\u4e8e\u5df2\u521b\u5efa\u7684\u5bf9\u8c61\u6570\u91cf\u3002\u56e0\u6b64\u8981\u63a7\u5236\u7cfb\u7edf\u6267\u884c\u7684 GC\uff0c\u9996\u5148\u5e94\u8be5\u51cf\u5c11\u521b\u5efa\u7684\u5bf9\u8c61\u6570\u91cf\u3002</p> <ul> <li>\u6211\u4eec\u53ef\u4ee5\u7528 <code>StringBuilder</code> \u6216 <code>StringBuffer</code> \u6765\u4ee3\u66ff <code>String</code>\uff0c\u51cf\u5c11\u521b\u5efa\u5b57\u7b26\u4e32\u5bf9\u8c61\u3002</li> <li>\u5e76\u4e14\u6700\u597d\u5c3d\u53ef\u80fd\u5c11\u5730\u79ef\u7d2f\u65e5\u5fd7\u3002</li> </ul> <p>\u6211\u4eec\u77e5\u9053\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u6211\u4eec\u65e0\u80fd\u4e3a\u529b\uff0c\u6211\u4eec\u5df2\u7ecf\u770b\u5230 XML \u548c JSON \u89e3\u6790\u8fc7\u7a0b\u4e2d\u4f1a\u4f7f\u7528\u6bd4\u8f83\u591a\u7684\u5185\u5b58\uff0c\u5c3d\u7ba1\u6211\u4eec\u51cf\u5c11 <code>String</code> \u7684\u4f7f\u7528\uff0c\u5e76\u5c3d\u53ef\u80fd\u5730\u5904\u7406\u65e5\u5fd7\uff0c\u4f46\u4ecd\u4f1a\u4f7f\u7528\u5de8\u5927\u7684\u4e34\u65f6\u5185\u5b58\u6765\u89e3\u6790 XML \u6216 JSON\uff0c\u5927\u7ea6 10-100 MB\u3002\u6211\u4eec\u5f88\u96be\u4e0d\u4f7f\u7528 XML \u548c JSON\uff0c\u53ea\u8981\u660e\u767d\u5b83\u9700\u8981\u592a\u591a\u7684\u5185\u5b58\u3002</p> <p>\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u5185\u5b58\u4f7f\u7528\u7387\u5728\u53cd\u590d\u8c03\u4f18\u540e\u6709\u6240\u6539\u5584\uff0c\u5219\u53ef\u4ee5\u5f00\u59cb GC \u8c03\u4f18\uff0c\u6211\u4eec\u5c06 GC \u8c03\u4f18\u7684\u76ee\u7684\u5206\u4e3a\u4e24\u79cd\uff1a</p> <ol> <li>\u5c3d\u91cf\u51cf\u5c11\u4f20\u9012\u5230\u8001\u5e74\u4ee3\u7684\u5bf9\u8c61\u6570\u91cf\u3002</li> <li>\u51cf\u5c11 Full GC \u7684\u6267\u884c\u65f6\u95f4\u3002</li> </ol>"},{"location":"java/%E5%A6%82%E4%BD%95%E8%B0%83%E4%BC%98%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86/#_1","title":"\u5c3d\u91cf\u51cf\u5c11\u4f20\u9012\u5230\u8001\u5e74\u4ee3\u7684\u5bf9\u8c61\u6570\u91cf","text":"<p>\u5206\u4ee3 GC \u662f Oracle JVM \u63d0\u4f9b\u7684 GC\uff0c\u4e0d\u5305\u62ec JDK 7 \u53ca\u66f4\u9ad8\u7248\u672c\u53ef\u4ee5\u4f7f\u7528\u7684 G1 GC\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u5728 Eden \u533a\u57df\u4e2d\u521b\u5efa\u4e00\u4e2a\u5bf9\u8c61\u5e76\u4ece Survivor0 \u533a\u57df\u8f6c\u79fb\u548c\u8f6c\u79fb\u5230 Survivor1 \u533a\u57df\uff0c\u8fbe\u5230\u4e00\u5b9a\u7684\u6b21\u6570\u4e4b\u540e\uff0c\u5269\u4e0b\u7684\u5bf9\u8c61\u88ab\u79fb\u52a8\u5230\u8001\u5e74\u4ee3\u3002\u6709\u4e9b\u5bf9\u8c61\u662f\u5728Eden\u533a\u521b\u5efa\u7684\uff0c\u56e0\u4e3a\u4f53\u79ef\u5927\uff0c\u76f4\u63a5\u4f20\u9012\u5230Old\u533a\u3002Old \u533a\u7684 GC \u6bd4 New \u533a\u7684 GC \u82b1\u8d39\u7684\u65f6\u95f4\u76f8\u5bf9\u66f4\u591a\u3002\u56e0\u6b64\u51cf\u5c11\u4f20\u9012\u5230 Old \u533a\u57df\u7684\u5bf9\u8c61\u6570\u91cf\u53ef\u4ee5\u964d\u4f4e full GC \u7684\u9891\u7387\uff0c\u51cf\u5c11\u4f20\u9012\u5230 Old \u533a\u7684\u5bf9\u8c61\u6570\u91cf\u53ef\u80fd\u4f1a\u88ab\u8bef\u89e3\u4e3a\u9009\u62e9\u5c06\u5bf9\u8c61\u7559\u5728 New \u533a\uff0c\u7136\u800c\u5e76\u4e0d\u662f\u8fd9\u6837\uff0c\u76f8\u53cd\uff0c\u4f60\u53ef\u4ee5\u8c03\u6574\u65b0\u751f\u4ee3\u533a\u57df\u7684\u5927\u5c0f\u3002</p>"},{"location":"java/%E5%A6%82%E4%BD%95%E8%B0%83%E4%BC%98%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86/#full-gc","title":"\u51cf\u5c11 Full GC \u65f6\u95f4","text":"<p>Full GC \u7684\u6267\u884c\u65f6\u95f4\u6bd4 Minor GC \u7684\u6267\u884c\u65f6\u95f4\u76f8\u5bf9\u8f83\u957f\uff0c\u56e0\u6b64\u5982\u679cFull GC \u6267\u884c\u65f6\u95f4\u8fc7\u957f\uff081 \u79d2\u6216\u4ee5\u4e0a\uff09\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u591a\u4e2a\u8fde\u63a5\u90e8\u5206\u53d1\u751f\u8d85\u65f6\u3002</p> <ul> <li>\u5982\u679c\u5c1d\u8bd5\u51cf\u5c0f Old \u533a\u57df\u5927\u5c0f\u4ee5\u51cf\u5c11 Full GC \u6267\u884c\u65f6\u95f4\uff0c\u5219\u53ef\u80fd\u4f1a\u53d1\u751f <code>OutOfMemoryError</code> \u6216 Full GC \u7684\u6b21\u6570\u53ef\u80fd\u4f1a\u589e\u52a0\u3002</li> <li>\u5982\u679c\u5c1d\u8bd5\u589e\u52a0 Old \u533a\u57df\u5927\u5c0f\u6765\u51cf\u5c11 Full GC \u7684\u6b21\u6570\uff0c\u5219\u4f1a\u589e\u52a0\u6267\u884c\u65f6\u95f4\u3002</li> </ul> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u9700\u8981\u5c06 Old \u533a\u57df\u5927\u5c0f\u8bbe\u7f6e\u4e3a\u201c\u9002\u5f53\u201d\u7684\u503c\u3002</p>"},{"location":"java/%E5%A6%82%E4%BD%95%E8%B0%83%E4%BC%98%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86/#gc_1","title":"\u5f71\u54cd GC \u6027\u80fd\u7684\u9009\u9879","text":"<p>\u524d\u9762\u6211\u4eec\u63d0\u5230\uff0c\u6709\u4eba\u5728\u8bbe\u7f6e\u67d0\u4e2aGC\u9009\u9879\u65f6\u6027\u80fd\u5f88\u597d\uff0c\u4e3a\u4ec0\u4e48\u6211\u4eec\u4e0d\u50cf\u4ed6\u90a3\u6837\u4f7f\u7528\u90a3\u4e2a\u9009\u9879\uff1f \u539f\u56e0\u662f\u4e0d\u540c web \u670d\u52a1\u4e2d\u7684\u5bf9\u8c61\u5927\u5c0f\u548c\u751f\u547d\u5468\u671f\u662f\u4e0d\u540c\u7684\u3002</p> <p>\u7b80\u5355\u60f3\u4e00\u4e0b\uff0c\u5982\u679c\u5728A\u3001B\u3001C\u3001D\u3001E\u7684\u6761\u4ef6\u4e0b\u6267\u884c\u4e00\u9879\u4efb\u52a1\uff0c\u800c\u5728\u53ea\u6709 A \u548c B \u7684\u6761\u4ef6\u4e0b\u6267\u884c\u76f8\u540c\u7684\u4efb\u52a1\uff0c\u90a3\u4e48\u54ea\u4e2a\u4efb\u52a1\u5b8c\u6210\u5f97\u66f4\u5feb\uff1f\u4ece\u5e38\u8bc6\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u7b54\u6848\u5c06\u662f\u5728 A \u548c B \u6761\u4ef6\u4e0b\u6267\u884c\u7684\u4efb\u52a1\u3002Java GC \u9009\u9879\u662f\u76f8\u540c\u7684\uff0c\u8bbe\u7f6e\u591a\u4e2a\u9009\u9879\u5e76\u4e0d\u4f1a\u63d0\u9ad8\u6267\u884c GC \u7684\u901f\u5ea6\uff0c\u76f8\u53cd\u5b83\u53ef\u80fd\u4f1a\u4f7f GC \u53d8\u6162\u3002</p> <p>GC \u8c03\u4f18\u7684\u57fa\u672c\u539f\u7406\u662f\u5c06\u4e0d\u540c\u7684 GC \u9009\u9879\u5e94\u7528\u5230\u4e24\u4e2a\u6216\u591a\u4e2a\u670d\u52a1\u5668\u4e0a\u5e76\u8fdb\u884c\u6bd4\u8f83\uff0c\u7136\u540e\u901a\u8fc7\u6027\u80fd\u5206\u6790\u9009\u62e9\u8868\u73b0\u51fa\u589e\u5f3a\u7684\u6027\u80fd\u6216\u66f4\u597d\u7684 GC \u65f6\u95f4\u7684\u670d\u52a1\u5668\u8bbe\u7f6e\u7684\u9009\u9879\u3002</p> <p>\u4e0b\u8868\u663e\u793a\u4e86\u53ef\u80fd\u5f71\u54cd\u6027\u80fd\u7684 GC \u9009\u9879\u4e2d\u4e0e\u5185\u5b58\u5927\u5c0f\u76f8\u5173\u7684\u9009\u9879\u3002</p> <p>\u8868 1\uff1a\u8981\u4e3a GC \u8c03\u6574\u68c0\u67e5\u7684 JVM \u9009\u9879\u3002</p> \u5206\u7c7b \u9009\u9879 \u63cf\u8ff0 \u5806\u533a\u5927\u5c0f <code>-Xms</code> \u542f\u52a8 JVM \u65f6\u7684\u5806\u533a\u5927\u5c0f <code>-Xmx</code> \u6700\u5927\u5806\u533a\u5927\u5c0f \u65b0\u751f\u4ee3\u533a\u57df\u5927\u5c0f <code>-XX:NewRatio</code> \u65b0\u751f\u4ee3\u4e0e\u8001\u5e74\u4ee3\u6bd4\u4f8b <code>-XX:NewSize</code> \u65b0\u751f\u4ee3\u5927\u5c0f <code>-XX:SurvivorRatio</code> Eden \u533a\u4e0e Survivor \u533a\u7684\u6bd4\u4f8b <p>\u6211\u7ecf\u5e38\u4f7f\u7528 <code>-Xms</code>\u3001<code>-Xmx</code> \u548c <code>-XX:NewRatio</code> \u9009\u9879\u8fdb\u884c GC \u8c03\u6574\u3002  <code>-Xms</code> \u548c <code>-Xmx</code>\u9009\u9879\u662f\u7279\u522b\u9700\u8981\u7684\uff0c\u5e76\u4e14\u5982\u4f55\u8bbe\u7f6e <code>NewRatio</code> \u9009\u9879\u4f1a\u4e5f\u5bf9 GC \u6027\u80fd\u4ea7\u751f\u91cd\u5927\u5f71\u54cd\u3002</p> <p>\u6709\u4eba\u95ee \u5982\u4f55\u8bbe\u7f6ePerm\u533a\u57df\u5927\u5c0f\uff1f\u53ef\u4ee5\u4f7f\u7528<code>-XX:PermSize</code> \u548c <code>-XX:MaxPermSize</code>\u9009\u9879\u8bbe\u7f6e Perm \u533a\u57df\u5927\u5c0f\uff0c\u4f46\u4ec5\u5f53<code>OutOfMemoryError</code>\u53d1\u751f\u4e14\u539f\u56e0\u662f Perm \u533a\u57df\u5927\u5c0f\u65f6\u624d\u9700\u8981\u8bbe\u7f6e\u3002</p> <p>\u53e6\u4e00\u4e2a\u53ef\u80fd\u5f71\u54cd GC \u6027\u80fd\u7684\u9009\u9879\u662fGC \u7c7b\u578b\u3002\u4e0b\u8868\u6309 GC \u7c7b\u578b\u663e\u793a\u4e86\u53ef\u7528\u9009\u9879\uff08\u57fa\u4e8e JDK 6.0\uff09\u3002</p> <p>\u8868 2\uff1aGC \u7c7b\u578b\u7684\u53ef\u7528\u9009\u9879\u3002</p> \u5206\u7c7b \u9009\u9879 \u8bf4\u660e Serial GC -XX:+UseSerialGC Parallel GC -XX:+UseParallelGC -XX:ParallelGCThreads=value Parallel Compacting GC -XX:+UseParallelOldGC CMS GC -XX:+UseConcMarkSweepGC -XX:+UseParNewGC -XX:+CMSParallelRemarkEnabled -XX: CMSInitiatingOccupancyFraction=value -XX:+UseCMSInitiatingOccupancyOnly G1 -XX:+UnlockExperimentalVMOptions-XX:+UseG1GC \u5728 JDK 6 \u4e2d\uff0c\u8fd9\u4e24\u4e2a\u9009\u9879\u5fc5\u987b\u4e00\u8d77\u4f7f\u7528\u3002 <p>\u9664\u4e86 G1 GC\uff0cGC \u7c7b\u578b\u662f\u901a\u8fc7\u5728\u6bcf\u4e2a GC \u7c7b\u578b\u7684\u7b2c\u4e00\u884c\u8bbe\u7f6e\u9009\u9879\u6765\u66f4\u6539\u7684\u3002</p> <p>\u6709\u5f88\u591a\u9009\u9879\u4f1a\u5f71\u54cd GC \u6027\u80fd\uff0c\u4f46\u662f\u4f60\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u4e0a\u9762\u63d0\u5230\u7684\u9009\u9879\u6765\u83b7\u5f97\u663e\u7740\u7684\u6548\u679c\uff0c\u4f46\u662f\u8bf7\u8bb0\u4f4f\u8bbe\u7f6e\u592a\u591a\u9009\u9879\u5e76\u4e0d\u80fd\u4fdd\u8bc1\u51cf\u5c11 GC \u6267\u884c\u65f6\u95f4\u3002</p>"},{"location":"java/%E5%A6%82%E4%BD%95%E8%B0%83%E4%BC%98%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86/#gc_2","title":"GC \u8c03\u4f18\u7a0b\u5e8f","text":"<p>GC \u8c03\u4f18\u7684\u8fc7\u7a0b\u7c7b\u4f3c\u4e8e\u4e00\u822c\u7684\u6027\u80fd\u6539\u8fdb\u8fc7\u7a0b\uff0c\u4ee5\u4e0b\u662f\u6211\u4f7f\u7528\u7684 GC \u8c03\u6574\u8fc7\u7a0b\u3002</p>"},{"location":"java/%E5%A6%82%E4%BD%95%E8%B0%83%E4%BC%98%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86/#1gc","title":"1.\u76d1\u63a7GC\u72b6\u6001","text":"<p>\u9700\u8981\u76d1\u63a7 GC \u72b6\u6001\u4ee5\u68c0\u67e5\u8fd0\u884c\u4e2d\u7cfb\u7edf\u7684 GC \u72b6\u6001\u3002\u8bf7\u53c2\u9605How to Monitor Java Garbage Collection \u4e2d\u7684\u5404\u79cd GC \u76d1\u63a7\u65b9\u6cd5\u3002</p>"},{"location":"java/%E5%A6%82%E4%BD%95%E8%B0%83%E4%BC%98%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86/#2-gc","title":"2. \u5206\u6790\u76d1\u6d4b\u7ed3\u679c\u540e\u51b3\u5b9a\u662f\u5426\u9700\u8981 GC \u8c03\u4f18","text":"<p>\u68c0\u67e5GC\u72b6\u6001\u540e\uff0c\u4f60\u5e94\u8be5\u5206\u6790\u76d1\u63a7\u7ed3\u679c\u5e76\u51b3\u5b9a\u662f\u5426\u8c03\u6574 GC\u3002</p> <p>\u5982\u679c\u5206\u6790\u663e\u793a\u6267\u884c GC \u6240\u82b1\u8d39\u7684\u65f6\u95f4\u4ec5\u4e3a 0.1-0.3\u79d2\uff0c\u90a3\u4e48\u65e0\u9700\u5c06\u65f6\u95f4\u6d6a\u8d39\u5728\u8c03\u6574 GC \u4e0a\u3002</p> <p>\u5982\u679c GC \u6267\u884c\u65f6\u95f4\u5728 1-3 \u79d2\uff0c\u6216\u8005\u8d85\u8fc7 10 \u79d2\uff0c\u5219\u9700\u8981\u8fdb\u884c GC \u8c03\u4f18\u3002</p> <p>\u4f46\u662f\uff0c\u5982\u679c\u4f60\u5206\u914d\u4e86\u5927\u7ea6 10GB \u7684 Java \u5185\u5b58\u5e76\u4e14\u65e0\u6cd5\u51cf\u5c11\u5185\u5b58\u5927\u5c0f\uff0c\u5219\u65e0\u6cd5\u8c03\u6574 GC\u3002\u5728\u8c03\u4f18 GC \u4e4b\u524d\uff0c\u4f60\u9700\u8981\u8003\u8651\u4e3a\u4ec0\u4e48\u9700\u8981\u5206\u914d\u5927\u5185\u5b58\u5927\u5c0f\u3002\u5982\u679c\u4f60\u5206\u914d\u4e861GB\u62162GB\u7684\u5185\u5b58\u5e76<code>OutOfMemoryError</code>\u53d1\u751f\u4e86\uff0c\u5219\u5e94\u6267\u884c <code>heap dump</code> \u6765\u9a8c\u8bc1\u5e76\u6392\u9664\u539f\u56e0\u3002</p> <p>\u6ce8\u610f\uff1a</p> <p>Heap dump \u662f\u4e00\u4e2a\u5185\u5b58\u6587\u4ef6\uff0c\u7528\u4e8e\u68c0\u67e5 Java \u5185\u5b58\u4e2d\u7684\u5bf9\u8c61\u548c\u6570\u636e\uff0c\u53ef\u4ee5\u4f7f\u7528 JDK \u4e2d\u5305\u542b\u7684 jmap \u547d\u4ee4\u521b\u5efa\u6b64\u6587\u4ef6\u3002\u521b\u5efa\u6587\u4ef6\u65f6\uff0cJava \u8fdb\u7a0b\u505c\u6b62\uff0c\u56e0\u6b64\u4e0d\u8981\u5728\u7cfb\u7edf\u8fd0\u884c\u65f6\u521b\u5efa\u6b64\u6587\u4ef6\u3002</p>"},{"location":"java/%E5%A6%82%E4%BD%95%E8%B0%83%E4%BC%98%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86/#3gc","title":"3.\u8bbe\u7f6eGC\u7c7b\u578b/\u5185\u5b58\u5927\u5c0f","text":"<p>\u5982\u679c\u4f60\u5df2\u51b3\u5b9a\u8fdb\u884c GC \u8c03\u4f18\uff0c\u8bf7\u9009\u62e9 GC \u7c7b\u578b\u5e76\u8bbe\u7f6e\u5185\u5b58\u5927\u5c0f\u3002\u8fd9\u65f6\u5019\u5982\u679c\u4f60\u6709\u591a\u53f0\u670d\u52a1\u5668\uff0c\u901a\u8fc7\u4e3a\u6bcf\u4e2a\u670d\u52a1\u5668\u8bbe\u7f6e\u4e0d\u540c\u7684GC\u9009\u9879\u6765\u68c0\u67e5\u6bcf\u4e2aGC\u9009\u9879\u7684\u5dee\u5f02\u5f88\u91cd\u8981\u3002</p>"},{"location":"java/%E5%A6%82%E4%BD%95%E8%B0%83%E4%BC%98%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86/#4","title":"4. \u5206\u6790\u7ed3\u679c","text":"<p>\u5728\u8bbe\u7f6e GC \u9009\u9879\u540e\u6536\u96c6\u6570\u636e\u81f3\u5c11 24 \u5c0f\u65f6\u540e\u5f00\u59cb\u5206\u6790\u7ed3\u679c\uff0c\u5982\u679c\u5e78\u8fd0\u7684\u8bdd\uff0c\u4f60\u4f1a\u627e\u5230\u6700\u9002\u5408\u7cfb\u7edf\u7684 GC \u9009\u9879\u3002\u5982\u679c\u4e0d\u662f\uff0c\u5219\u5e94\u5206\u6790\u65e5\u5fd7\u5e76\u68c0\u67e5\u5185\u5b58\u662f\u5982\u4f55\u5206\u914d\u7684\u3002\u7136\u540e\u4f60\u9700\u8981\u901a\u8fc7\u66f4\u6539 GC \u7c7b\u578b/\u5185\u5b58\u5927\u5c0f\u6765\u627e\u5230\u7cfb\u7edf\u7684\u6700\u4f73\u9009\u9879\u3002</p>"},{"location":"java/%E5%A6%82%E4%BD%95%E8%B0%83%E4%BC%98%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86/#5-gc","title":"5. \u5982\u679c\u7ed3\u679c\u4ee4\u4eba\u6ee1\u610f\uff0c\u5219\u5c06\u8be5\u9009\u9879\u5e94\u7528\u4e8e\u6240\u6709\u670d\u52a1\u5668\u5e76\u7ec8\u6b62 GC \u8c03\u6574\u3002","text":"<p>\u5982\u679c GC \u8c03\u4f18\u7ed3\u679c\u4ee4\u4eba\u6ee1\u610f\uff0c\u5219\u5c06\u8be5\u9009\u9879\u5e94\u7528\u4e8e\u6240\u6709\u670d\u52a1\u5668\u5e76\u7ec8\u6b62 GC \u8c03\u4f18\u3002</p>"},{"location":"java/%E5%A6%82%E4%BD%95%E8%B0%83%E4%BC%98%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86/#gc_3","title":"\u76d1\u63a7 GC \u72b6\u6001\u548c\u5206\u6790\u7ed3\u679c","text":"<p>\u68c0\u67e5\u8fd0\u884c\u4e2d\u7684 Web \u5e94\u7528\u7a0b\u5e8f\u670d\u52a1\u5668 (WAS) \u7684 GC \u72b6\u6001\u7684\u6700\u4f73\u65b9\u6cd5\u662f\u4f7f\u7528 jstat \u547d\u4ee4\u3002\u6211\u5728How To Monitor Java Garbage Collection\u4e2d\u89e3\u91ca\u4e86jstat\u547d\u4ee4\uff0c\u6240\u4ee5\u6211\u5c06\u5728\u672c\u6587\u4e2d\u63cf\u8ff0\u8981\u68c0\u67e5\u7684\u6570\u636e\u3002</p> <p>\u4e0b\u9762\u7684\u4f8b\u5b50\u5c55\u793a\u4e86\u4e00\u4e2a\u6ca1\u6709\u505aGC\u8c03\u4f18\u7684JVM\uff08\u4f46\u662f\u5b83\u4e0d\u662f\u64cd\u4f5c\u670d\u52a1\u5668\uff09\u3002</p> <p>-gcutil \uff1a\u4ee5\u767e\u5206\u6bd4\u7684\u5f62\u5f0f\u663e\u793a\u6bcf\u4e2a\u5806\u533a\u57df\u7684\u4f7f\u7528\u7387\uff0c\u4ee5\u53caGC\u7684\u6b21\u6570\u548c\u7d2f\u8ba1GC\u65f6\u95f4</p> <pre><code>$ jstat -gcutil 21719 1s\nS0    S1    E    O    P    YGC    YGCT    FGC    FGCT GCT\n48.66 0.00 48.10 49.70 77.45 3428 172.623 3 59.050 231.673\n48.66 0.00 48.10 49.70 77.45 3428 172.623 3 59.050 231.673\n</code></pre> <p>\u5728\u8fd9\u91cc\u68c0\u67e5 YGC \u548c YGCT \u7684\u503c\uff0c\u5c06 YGCT \u9664\u4ee5 YGC\uff0c\u7136\u540e\u4f60\u5f97\u5230 0.050 \u79d2\uff0850 \u6beb\u79d2\uff09\uff0c\u8fd9\u610f\u5473\u7740\u5728 Young \u533a\u57df\u6267\u884c GC \u5e73\u5747\u9700\u8981 50 ms\uff0c\u6709\u4e86\u8fd9\u4e2a\u7ed3\u679c\uff0c\u4f60\u5c31\u4e0d\u9700\u8981\u5173\u5fc3 Young \u533a\u57df\u7684 GC \u8c03\u6574\u4e86\u3002</p> <p>\u73b0\u5728\u68c0\u67e5 FGCT \u548c FGC \u7684\u503c\uff0c\u5c06 FGCT \u9664\u4ee5 FGC\uff0c\u7136\u540e\u4f60\u5f97\u5230 19.68 \u79d2\uff0c\u8fd9\u610f\u5473\u7740\u6267\u884c GC \u5e73\u5747\u9700\u8981 19.68 \u79d2\uff0c\u9700\u8981\u8fdb\u884c GC \u8c03\u6574\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 jstat \u547d\u4ee4\u8f7b\u677e\u68c0\u67e5 GC \u72b6\u6001\uff0c\u4f46\u662f\u5206\u6790 GC \u7684\u6700\u4f73\u65b9\u6cd5\u662f\u4f7f\u7528 <code>\u2013verbosegc</code> \u9009\u9879\u751f\u6210\u65e5\u5fd7\uff0c\u5173\u4e8e\u5982\u4f55\u751f\u6210\u65e5\u5fd7\u548c\u5206\u6790\u65e5\u5fd7\u7684\u5de5\u5177\u7684\u8be6\u7ec6\u63cf\u8ff0\uff0c\u5728\u4e0a\u4e00\u7bc7\u6587\u7ae0\u4e2d\u5df2\u7ecf\u89e3\u91ca\u8fc7\u4e86\u3002\u5728\u7528\u4e8e\u5206\u6790\u65e5\u5fd7\u7684\u5de5\u5177\u4e2d\uff0cHPJMeter \u662f\u6211\u6700\u559c\u6b22\u7684\u7528\u6765\u5206\u4eab <code>-verbosegc</code> \u65e5\u5fd7\u7684\u5de5\u5177\uff0c\u5b83\u6613\u4e8e\u4f7f\u7528\u548c\u5206\u6790\uff0c\u4f7f\u7528 HPJmeter\u53ef\u4ee5\u8f7b\u677e\u68c0\u67e5 GC \u6267\u884c\u65f6\u95f4\u7684\u5206\u5e03\u548c GC \u53d1\u751f\u7684\u9891\u7387\u3002</p> <p>\u5982\u679c GC \u6267\u884c\u65f6\u95f4\u6ee1\u8db3\u4ee5\u4e0b\u6240\u6709\u6761\u4ef6\uff0c\u5219\u4e0d\u9700\u8981\u8fdb\u884c GC \u8c03\u4f18\u3002</p> <ul> <li>Minor GC \u5904\u7406\u901f\u5ea6\u5f88\u5feb\uff0850 \u6beb\u79d2\u5185\uff09\u3002</li> <li>Minor GC \u4e0d\u7ecf\u5e38\u6267\u884c\uff08\u5927\u7ea6 10 \u79d2\uff09\u3002</li> <li>Full GC \u5904\u7406\u901f\u5ea6\u5f88\u5feb\uff081 \u79d2\u5185\uff09\u3002</li> <li>Full GC \u4e0d\u7ecf\u5e38\u6267\u884c\uff08\u6bcf 10 \u5206\u949f\u4e00\u6b21\uff09\u3002</li> </ul> <p>\u62ec\u53f7\u5185\u7684\u6570\u503c\u4e0d\u662f\u7edd\u5bf9\u503c\uff0c\u5b83\u4eec\u56e0\u670d\u52a1\u72b6\u6001\u800c\u5f02\uff0c\u6709\u4e9b\u670d\u52a1\u53ef\u80fd\u4f1a\u6ee1\u8db3 0.9 \u79d2\u7684 Full GC \u5904\u7406\u901f\u5ea6\uff0c\u4f46\u6709\u4e9b\u670d\u52a1\u53ef\u80fd\u4e0d\u4f1a\uff0c\u56e0\u6b64\u8bf7\u68c0\u67e5\u8fd9\u4e9b\u503c\u5e76\u901a\u8fc7\u8003\u8651\u6bcf\u4e2a\u670d\u52a1\u7684\u5b9e\u9645\u60c5\u51b5\u6765\u51b3\u5b9a\u662f\u5426\u6267\u884c GC \u8c03\u6574\u3002</p> <p>\u5f53\u68c0\u67e5 GC \u72b6\u6001\u65f6\u5e94\u8be5\u6ce8\u610f\u4e00\u4ef6\u4e8b\uff0c\u4e0d\u8981\u53ea\u68c0\u67e5 Minor GC \u548c Full GC \u7684\u65f6\u95f4\uff0c\u8fd8\u5fc5\u987b\u68c0\u67e5 GC \u6267\u884c\u6b21\u6570\uff0c\u5982\u679c <code>New area size</code> \u592a\u5c0f\uff0c\u4f1a\u5bfc\u81f4Minor GC\u6267\u884c\u8fc7\u4e8e\u9891\u7e41\uff08\u6709\u65f6\u6bcf1\u79d2\u4e00\u6b21\u6216\u591a\u6b21\uff09\uff0c\u6b64\u5916\u4f20\u9012\u5230Old\u533a\u7684\u5bf9\u8c61\u6570\u91cf\u589e\u52a0\uff0c\u5bfc\u81f4Full GC\u6267\u884c\u6b21\u6570\u589e\u52a0\uff0c\u56e0\u6b64\u5e94\u7528<code>jstat \u2013gccapacity</code>  \u547d\u4ee4\u4e2d\u7684\u9009\u9879\u6765\u68c0\u67e5\u8be5\u533a\u57df\u88ab\u5360\u7528\u4e86\u591a\u5c11\u3002</p>"},{"location":"java/%E5%A6%82%E4%BD%95%E8%B0%83%E4%BC%98%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86/#gc_4","title":"\u8bbe\u7f6e GC \u7c7b\u578b/\u5185\u5b58\u5927\u5c0f","text":""},{"location":"java/%E5%A6%82%E4%BD%95%E8%B0%83%E4%BC%98%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86/#gc_5","title":"\u8bbe\u7f6e GC \u7c7b\u578b","text":"<p>Oracle JVM \u6709\u4e94\u79cd GC \u7c7b\u578b\uff0c\u4f46\u662f\u5982\u679c\u4e0d\u662f JDK 7\uff0c\u5219\u5e94\u9009\u62e9 <code>Parallel GC</code>\u3001<code>Parallel Compacting GC</code> \u548c <code>CMS GC</code> \u4e4b\u4e00\uff0c\u6ca1\u6709\u539f\u5219\u6216\u89c4\u5219\u6765\u51b3\u5b9a\u9009\u62e9\u54ea\u4e00\u4e2a\u3002</p> <p>\u5982\u679c\u662f\u8fd9\u6837\uff0c\u6211\u4eec\u5982\u4f55\u9009\u62e9\u5408\u9002\u7684 GC \u7c7b\u578b\uff1f \u6700\u63a8\u8350\u7684\u65b9\u6cd5\u662f\u5e94\u7528\u6240\u6709\u4e09\u4e2a\u3002\u7136\u800c\uff0c\u6709\u4e00\u70b9\u5f88\u6e05\u695a\u2014\u2014CMS GC \u6bd4\u5176\u4ed6\u5e76\u884c GC \u66f4\u5feb\u3002\u8fd9\u65f6\u5019\uff0c\u5982\u679c\u662f\u8fd9\u6837\uff0c\u53ea\u9700\u5e94\u7528CMS GC\u3002\u7136\u800c CMS GC \u5e76\u4e0d\u603b\u662f\u66f4\u5feb\uff0c\u901a\u5e38 CMS GC \u7684 Full GC \u901f\u5ea6\u5f88\u5feb\uff0c\u4f46\u662f\u5f53\u53d1\u751f\u5e76\u53d1\u6a21\u5f0f\u5931\u8d25\u65f6\uff0c\u5b83\u6bd4\u5176\u4ed6 Parallel GC \u6162\u3002</p>"},{"location":"java/%E5%A6%82%E4%BD%95%E8%B0%83%E4%BC%98%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86/#_2","title":"\u5e76\u53d1\u6a21\u5f0f\u5931\u8d25","text":"<p>\u8ba9\u6211\u4eec\u66f4\u6df1\u5165\u5730\u7814\u7a76\u5e76\u53d1\u6a21\u5f0f\u5931\u8d25\u3002</p> <p><code>Parallel GC</code> \u548c <code>CMS GC</code> \u6700\u5927\u7684\u533a\u522b\u5728\u4e8e\u538b\u7f29\u4efb\u52a1\uff0c\u538b\u7f29\u4efb\u52a1\u662f\u901a\u8fc7\u538b\u7f29\u5185\u5b58\u6765\u6d88\u9664\u5185\u5b58\u788e\u7247\uff0c\u4ee5\u53bb\u9664\u5206\u914d\u7684\u5185\u5b58\u533a\u57df\u4e4b\u95f4\u7684\u7a7a\u767d\u7a7a\u95f4\u3002</p> <p>\u5728 Parallel GC \u7c7b\u578b\u4e2d\uff0c\u6bcf\u6b21\u6267\u884c Full GC \u65f6\u90fd\u4f1a\u6267\u884c\u538b\u7f29\uff0c\u82b1\u8d39\u592a\u591a\u65f6\u95f4\u3002\u4f46\u662f\u5728\u6267\u884c Full GC \u540e\uff0c\u5185\u5b58\u53ef\u4ee5\u4ee5\u66f4\u5feb\u7684\u65b9\u5f0f\u5206\u914d\uff0c\u56e0\u4e3a\u53ef\u4ee5\u987a\u5e8f\u5206\u914d\u4e0b\u4e00\u4e2a\u5185\u5b58\u3002</p> <p>\u76f8\u53cd\uff0cCMS GC \u4e0d\u4f34\u968f\u538b\u7f29\uff0c\u56e0\u6b64 CMS GC \u7684\u6267\u884c\u901f\u5ea6\u66f4\u5feb\u3002\u4f46\u662f\uff0c\u5f53\u4e0d\u6267\u884ccompaction\u65f6\uff0c\u5185\u5b58\u4e2d\u4f1a\u4ea7\u751f\u4e00\u4e9b\u7a7a\u767d\u7a7a\u95f4\uff0c\u5c31\u50cf\u6267\u884c\u78c1\u76d8\u788e\u7247\u6574\u7406\u7a0b\u5e8f\u4e4b\u524d\u4e00\u6837\uff0c\u53ef\u80fd\u6ca1\u6709\u7a7a\u95f4\u5bb9\u7eb3\u5927\u5bf9\u8c61\u3002\u4f8b\u5982 Old \u533a\u8fd8\u5269 300 MB\uff0c\u4f46\u6709\u4e9b 10 MB \u7684\u5bf9\u8c61\u65e0\u6cd5\u4f9d\u6b21\u4fdd\u5b58\u5728\u8be5\u533a\u4e2d\uff0c\u56e0\u4e3a\u6ca1\u6709\u8fde\u7eed\u7684 10 MB \u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u4f1a\u51fa\u73b0 \u5e76\u53d1\u6a21\u5f0f\u5931\u8d25 \u8b66\u544a\u5e76\u6267\u884c\u538b\u7f29\u3002\u5982\u679c\u4f7f\u7528 CMS GC\uff0c\u5219\u6267\u884c\u538b\u7f29\u6bd4\u5176\u4ed6 Parallel GC \u9700\u8981\u66f4\u957f\u7684\u65f6\u95f4\u3002</p> <p>\u603b\u4e4b\uff0c\u4f60\u5e94\u8be5\u4e3a\u4f60\u7684\u7cfb\u7edf\u627e\u5230\u6700\u4f73\u7684 GC \u7c7b\u578b\u3002</p> <p>\u6bcf\u4e2a\u7cfb\u7edf\u90fd\u9700\u8981\u5408\u9002\u7684 GC \u7c7b\u578b\uff0c\u56e0\u6b64\u4f60\u9700\u8981\u4e3a\u4f60\u7684\u7cfb\u7edf\u627e\u5230\u6700\u4f73\u7684 GC \u7c7b\u578b\u3002\u5982\u679c\u4f60\u6b63\u5728\u8fd0\u884c\u516d\u53f0\u670d\u52a1\u5668\uff0c\u6211\u5efa\u8bae\u4f60\u4e3a\u4e24\u53f0\u670d\u52a1\u5668\u4e2d\u7684\u6bcf\u53f0\u8bbe\u7f6e\u76f8\u540c\u7684\u9009\u9879\uff0c\u6dfb\u52a0<code>-verbosegc</code>\u9009\u9879\uff0c\u7136\u540e\u5206\u6790\u7ed3\u679c\u3002</p>"},{"location":"java/%E5%A6%82%E4%BD%95%E8%B0%83%E4%BC%98%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86/#_3","title":"\u8bbe\u7f6e\u5185\u5b58\u5927\u5c0f","text":"<p>\u4e0b\u9762\u5c55\u793a\u4e86\u5185\u5b58\u5927\u5c0f\u3001GC\u6267\u884c\u6b21\u6570\u3001GC\u6267\u884c\u65f6\u95f4\u4e4b\u95f4\u7684\u5173\u7cfb\uff1a</p> <ul> <li>\u5927\u5185\u5b58</li> <li>\u51cf\u5c11 GC \u6267\u884c\u7684\u6b21\u6570\u3002</li> <li>\u589e\u52a0 GC \u6267\u884c\u65f6\u95f4\u3002</li> <li>\u5c0f\u5185\u5b58</li> <li>\u51cf\u5c11 GC \u6267\u884c\u65f6\u95f4\u3002</li> <li>\u589e\u52a0 GC \u6267\u884c\u7684\u6b21\u6570\u3002</li> </ul> <p>\u5c06\u5185\u5b58\u5927\u5c0f\u8bbe\u7f6e\u4e3a\u591a\u5927\u6ca1\u6709\u6b63\u786e\u7684\u7b54\u6848\u3002\u5982\u679c\u662f\u8fd9\u6837\uff0c\u6211\u4eec\u5e94\u8be5\u5982\u4f55\u8bbe\u7f6e\u5185\u5b58\u5927\u5c0f\uff1f\u901a\u5e38\u6211\u5efa\u8bae\u4f7f\u7528 500 MB\u3002\u4f46\u8bf7\u6ce8\u610f\uff0c\u8fd9\u5e76\u4e0d\u610f\u5473\u7740\u4f60\u5e94\u8be5\u4f7f\u7528<code>\u2013Xms500m</code> \u548c <code>\u2013Xmx500m</code>\u9009\u9879\u8bbe\u7f6e web \u5e94\u7528\u7684\u5185\u5b58\u3002\u6839\u636eGC\u8c03\u4f18\u524d\u7684\u5f53\u524d\u72b6\u6001\uff0c\u67e5\u770bFull GC\u540e\u5269\u4f59\u7684\u5185\u5b58\u5927\u5c0f\u3002\u5982\u679cFull GC\u540e\u8fd8\u5269300MB\u5de6\u53f3\uff0c\u6700\u597d\u5c06\u5185\u5b58\u8bbe\u7f6e\u4e3a1GB\uff08300MB\uff08\u9ed8\u8ba4\u4f7f\u7528\uff09+500MB\uff08Old\u533a\u6700\u5c0f\uff09+200MB\uff08\u7a7a\u95f2\u5185\u5b58\uff09\uff09\uff0c\u8fd9\u610f\u5473\u7740\u4f60\u5e94\u8be5\u4e3a Old \u533a\u57df\u8bbe\u7f6e\u8d85\u8fc7 500 MB \u7684\u5185\u5b58\u7a7a\u95f4\u3002</p> <p>\u5982\u679c\u4f60\u6709\u4e09\u53f0\u64cd\u4f5c\u670d\u52a1\u5668\uff0c\u8bf7\u5c06\u4e00\u53f0\u670d\u52a1\u5668\u8bbe\u7f6e\u4e3a1 GB\uff0c\u4e00\u53f0\u8bbe\u7f6e\u4e3a1.5 GB\uff0c\u4e00\u53f0\u8bbe\u7f6e\u4e3a2 GB\uff0c\u7136\u540e\u67e5\u770b\u7ed3\u679c\u3002\u7406\u8bba\u4e0a\uff0cGC \u5c06\u6309\u7167 1 GB &gt; 1.5 GB &gt; 2 GB \u7684\u987a\u5e8f\u5feb\u901f\u5b8c\u6210\uff0c\u56e0\u6b64 1 GB \u5c06\u662f\u6267\u884c GC \u7684\u6700\u5feb\u901f\u5ea6\u3002\u4f46\u662f\u4e0d\u80fd\u4fdd\u8bc1\u5728 1 GB \u65f6\u6267\u884c Full GC \u9700\u8981 1 \u79d2\uff0c\u5728 2 GB \u65f6\u6267\u884c Full GC \u9700\u8981 2 \u79d2\u3002\u65f6\u95f4\u53d6\u51b3\u4e8e\u670d\u52a1\u5668\u6027\u80fd\u548c\u5bf9\u8c61\u5927\u5c0f\uff0c\u56e0\u6b64\u521b\u5efa\u6d4b\u91cf\u6570\u636e\u7684\u6700\u4f73\u65b9\u6cd5\u662f\u8bbe\u7f6e\u5c3d\u53ef\u80fd\u591a\u7684\u6570\u636e\u5e76\u5bf9\u5176\u8fdb\u884c\u76d1\u63a7\u3002</p> <p>\u4f60\u5e94\u8be5\u518d\u8bbe\u7f6e\u4e00\u4e2a\u53c2\u6570\uff1a<code>NewRatio</code>\uff0c<code>NewRatio</code>\u662f New \u533a\u548c Old \u533a\u7684\u6bd4\u503c\u3002\u5982\u679c<code>XX:NewRatio=1</code>\uff0cNew \u533a\uff1aOld \u533a\u662f 1:1\uff0c\u5bf9\u4e8e 1 GB\uff0c\u65b0\u533a\uff1a\u65e7\u533a\u4e3a 500MB\uff1a500MB\u3002\u5982\u679c<code>NewRatio</code>\u662f 2\uff0c\u5219New \u533a\uff1aOld \u533a\u662f 1:2\uff0c\u56e0\u6b64\u8be5\u503c\u8d8a\u5927\uff0cOld \u533a\u57df\u5927\u5c0f\u8d8a\u5927\uff0cNew \u533a\u57df\u5927\u5c0f\u8d8a\u5c0f\u3002</p> <p><code>NewRatio</code> \u4f1a\u663e\u7740\u5f71\u54cd\u6574\u4e2a GC \u6027\u80fd\uff0c\u5982\u679cNew area \u5185\u5b58\u592a\u5c0f\uff0c\u5c31\u4f1a\u6709\u5f88\u591a\u5185\u5b58\u5206\u914d\u7ed9 Old area\uff0c\u5bfc\u81f4Full GC\u9891\u7e41\uff0c\u5904\u7406\u65f6\u95f4\u957f\u3002</p> <p>\u4f60\u53ef\u80fd\u53ea\u662f\u8ba4\u4e3a\u90a3<code>NewRatio 1</code> \u662f\u6700\u597d\u7684\uff0c\u7136\u800c\u4e8b\u5b9e\u53ef\u80fd\u5e76\u975e\u5982\u6b64\uff0c\u5f53<code>NewRatio</code>\u8bbe\u7f6e\u4e3a 2 \u6216 3 \u65f6\uff0c\u6574\u4e2a GC \u72b6\u6001\u53ef\u80fd\u4f1a\u66f4\u597d\u3002</p> <p>\u5b8c\u6210 GC \u8c03\u4f18\u7684\u6700\u5feb\u65b9\u6cd5\u662f\u4ec0\u4e48\uff1f\u6bd4\u8f83\u6027\u80fd\u6d4b\u8bd5\u7684\u7ed3\u679c\u662f\u83b7\u5f97\u7ed3\u679c\u7684\u6700\u5feb\u65b9\u6cd5\u3002\u8981\u4e3a\u6bcf\u4e2a\u670d\u52a1\u5668\u8bbe\u7f6e\u4e0d\u540c\u7684\u9009\u9879\u5e76\u76d1\u63a7\u72b6\u6001\uff0c\u5efa\u8bae\u81f3\u5c11\u5728\u4e00\u4e24\u5929\u540e\u68c0\u67e5\u6570\u636e\u3002\u4f46\u662f\uff0c\u901a\u8fc7\u6027\u80fd\u6d4b\u8bd5\u6267\u884cGC\u8c03\u4f18\u65f6\uff0c\u4f60\u5e94\u8be5\u51c6\u5907\u597d\u4e0e\u64cd\u4f5c\u60c5\u51b5\u76f8\u540c\u7684\u8d1f\u8f7d\u3002\u5e76\u4e14\u63d0\u4f9b\u8d1f\u8f7d\u7684URL\u7b49\u8bf7\u6c42\u6bd4\u4f8b\u5fc5\u987b\u4e0e\u64cd\u4f5c\u60c5\u51b5\u4e00\u81f4\u3002\u4f46\u662f\uff0c\u5bf9\u4e8e\u4e13\u4e1a\u7684\u6027\u80fd\u6d4b\u8bd5\u4eba\u5458\u6765\u8bf4\uff0c\u7ed9\u51fa\u51c6\u786e\u7684\u8d1f\u8f7d\u5e76\u4e0d\u5bb9\u6613\uff0c\u800c\u4e14\u51c6\u5907\u65f6\u95f4\u592a\u957f\u3002</p>"},{"location":"java/%E5%A6%82%E4%BD%95%E8%B0%83%E4%BC%98%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86/#gc_6","title":"\u5206\u6790 GC \u8c03\u8c10\u7ed3\u679c","text":"<p>\u5e94\u7528GC\u9009\u9879\u5e76\u8bbe\u7f6e\u8be5 <code>-verbosegc</code> \u9009\u9879\u540e\uff0c\u4f7f\u7528<code>tail</code>\u547d\u4ee4\u68c0\u67e5\u65e5\u5fd7\u662f\u5426\u6309\u9700\u8981\u7d2f\u79ef\u3002\u5982\u679c\u8be5\u9009\u9879\u6ca1\u6709\u51c6\u786e\u8bbe\u7f6e\u5e76\u4e14\u6ca1\u6709\u7d2f\u79ef\u65e5\u5fd7\uff0c\u4f60\u5c06\u6d6a\u8d39\u4f60\u7684\u65f6\u95f4\u3002\u5982\u679c\u65e5\u5fd7\u6309\u9700\u8981\u7d2f\u79ef\uff0c\u8bf7\u5728\u6536\u96c6\u6570\u636e\u4e00\u4e24\u5929\u540e\u67e5\u770b\u7ed3\u679c\u3002\u6700\u7b80\u5355\u7684\u65b9\u6cd5\u662f\u5c06\u65e5\u5fd7\u79fb\u52a8\u5230\u672c\u5730 PC \u5e76\u4f7f\u7528HPJMeter\u5206\u6790\u6570\u636e\u3002</p> <p>\u5728\u5206\u6790\u4e2d\uff0c\u91cd\u70b9\u5173\u6ce8\u4ee5\u4e0b\u5185\u5bb9\uff0c\u51b3\u5b9a GC \u9009\u9879\u7684\u6700\u91cd\u8981\u7684\u4e00\u9879\u662f Full GC \u6267\u884c\u65f6\u95f4\u3002</p> <ul> <li>Full GC \u6267\u884c\u65f6\u95f4</li> <li>Minor GC \u6267\u884c\u65f6\u95f4</li> <li>Full GC \u6267\u884c\u95f4\u9694</li> <li>Minor GC \u6267\u884c\u95f4\u9694</li> <li>\u6574\u4e2a Full GC \u6267\u884c\u65f6\u95f4</li> <li>\u6574\u4e2a Minor GC \u6267\u884c\u65f6\u95f4</li> <li>\u6574\u4e2aGC\u6267\u884c\u65f6\u95f4</li> <li>Full GC \u6267\u884c\u6b21\u6570</li> <li>Minor GC \u6267\u884c\u6b21\u6570</li> </ul> <p>\u627e\u5230\u6700\u5408\u9002\u7684 GC \u9009\u9879\u662f\u4e00\u4e2a\u975e\u5e38\u5e78\u8fd0\u7684\uff0c\u800c\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u4e8b\u5b9e\u5e76\u975e\u5982\u6b64\u3002\u6267\u884c GC \u8c03\u4f18\u65f6\u8981\u5c0f\u5fc3\uff0c\u56e0\u4e3a\u5982\u679c\u4f60\u5c1d\u8bd5\u4e00\u6b21\u5b8c\u6210 GC \u8c03\u4f18\uff0c\u53ef\u80fd\u4f1a\u53d1\u751f<code>OutOfMemoryError</code>\u8fd9\u79cd\u60c5\u51b5\u3002</p>"},{"location":"java/%E5%A6%82%E4%BD%95%E8%B0%83%E4%BC%98%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86/#_4","title":"\u8c03\u4f18\u793a\u4f8b","text":"<p>\u5230\u76ee\u524d\u4e3a\u6b62\uff0c\u6211\u4eec\u5df2\u7ecf\u5728\u6ca1\u6709\u4efb\u4f55\u793a\u4f8b\u7684\u60c5\u51b5\u4e0b\u4ece\u7406\u8bba\u4e0a\u8ba8\u8bba\u4e86 GC \u8c03\u4f18\u3002\u73b0\u5728\u6211\u4eec\u6765\u770b\u770b GC \u8c03\u4f18\u7684\u4f8b\u5b50\u3002</p>"},{"location":"java/%E5%A6%82%E4%BD%95%E8%B0%83%E4%BC%98%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86/#1","title":"\u793a\u4f8b 1","text":"<p>\u4ee5\u4e0b\u793a\u4f8b\u662f Service S \u7684 GC \u8c03\u6574\u3002\u5bf9\u4e8e\u65b0\u5f00\u53d1\u7684Service S\uff0c\u6267\u884cFull GC\u82b1\u8d39\u4e86\u592a\u591a\u65f6\u95f4\u3002</p> <p>\u67e5\u770b\u7ed3\u679c<code>jstat \u2013gcutil</code>\u3002</p> <pre><code>S0     S1    E    O     P   YGC YGCT  FGC FGCT GCT\n12.16 0.00 5.18 63.78 20.32 54  2.047 5  6.946  8.993\n</code></pre> <p>\u6267\u884c Minor GC \u548c Full GC \u4e00\u6b21\u7684\u5e73\u5747\u503c\u8ba1\u7b97\u5982\u4e0b\uff1a</p> <p>\u8868 3\uff1a\u4e3a\u670d\u52a1 S \u6267\u884c Minor GC \u548c Full GC \u6240\u9700\u7684\u5e73\u5747\u65f6\u95f4\u3002</p> GC \u7c7b\u578b GC \u6267\u884c\u65f6\u95f4 GC \u6267\u884c\u65f6\u95f4 \u5e73\u5747\u6570 Minor GC 54 2.047 37 \u6beb\u79d2 Full GC 5 6.946 1,389 \u6beb\u79d2 <p>37 ms \u5bf9\u4e8e Minor GC \u6765\u8bf4\u8fd8\u4e0d\u9519\u3002\u4f46\u662fFull GC\u7684 1.389\u79d2 \u610f\u5473\u7740\u5728 DB Timeout \u8bbe\u7f6e\u4e3a1\u79d2\u7684\u7cfb\u7edf\u4e2d\u53d1\u751fGC\u65f6\uff0c\u53ef\u80fd\u4f1a\u9891\u7e41\u53d1\u751f\u8d85\u65f6\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u7cfb\u7edf\u9700\u8981 GC \u8c03\u4f18\u3002</p> <p>\u9996\u5148\uff0c\u4f60\u5e94\u8be5\u5728\u5f00\u59cb GC \u8c03\u6574\u4e4b\u524d\u68c0\u67e5\u5185\u5b58\u662f\u5982\u4f55\u4f7f\u7528\u7684\uff0c\u4f7f\u7528\u8be5 <code>jstat \u2013gccapacity</code> \u9009\u9879\u68c0\u67e5\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\u3002\u4ece\u8be5\u670d\u52a1\u5668\u68c0\u67e5\u7684\u7ed3\u679c\u5982\u4e0b\u3002</p> <pre><code>NGCMN NGCMX NGC S0C S1C EC OGCMN OGCMX OGC OC PGCMN PGCMX PGC PC YGC FGC\n212992.0 212992.0 212992.0 21248.0 21248.0 170496.0 1884160.0 1884160.0 1884160.0 1884160.0 262144.0 262144.0 262144.0 262144.0 54 5\n</code></pre> <p>\u5173\u952e\u503c\u5982\u4e0b\u3002</p> <ul> <li>New \u533a\u4f7f\u7528\u5927\u5c0f\uff1a212,992 KB</li> <li>Old \u533a\u4f7f\u7528\u5927\u5c0f\uff1a1,884,160 KB</li> </ul> <p>\u56e0\u6b64\uff0c\u603b\u5206\u914d\u7684\u5185\u5b58\u5927\u5c0f\u4e3a 2 GB\uff0c\u4e0d\u5305\u62ec Perm \u533a\u57df\uff0cNew area:Old area \u4e3a 1:9\u3002\u4e3a\u4e86\u4ee5\u6bd4jstat\u66f4\u8be6\u7ec6\u7684\u65b9\u5f0f\u68c0\u67e5\u72b6\u6001\uff0c<code>-verbosegc</code> \u6dfb\u52a0\u4e86\u65e5\u5fd7\u5e76\u4e3a\u4e09\u4e2a\u5b9e\u4f8b\u8bbe\u7f6e\u4e86\u4e09\u4e2a\u9009\u9879\uff0c\u5982\u4e0b\u6240\u793a\u3002\u6ca1\u6709\u6dfb\u52a0\u5176\u4ed6\u9009\u9879\u3002</p> <ul> <li>NewRatio=2</li> <li>NewRatio=3</li> <li>NewRatio=4</li> </ul> <p>\u4e00\u5929\u540e\uff0c\u7cfb\u7edf\u7684GC\u65e5\u5fd7\u5df2\u7ecf\u68c0\u67e5\u8fc7\u4e86\u3002\u5e78\u8fd0\u7684\u662f\uff0c\u8fd9\u4e2a\u7cfb\u7edf\u5728<code>NewRatio</code>\u8bbe\u7f6e\u540e\u6ca1\u6709\u53d1\u751fFull GC \u3002</p> <p>\u4e3a\u4ec0\u4e48\uff1f\u539f\u56e0\u662f\u7cfb\u7edf\u521b\u5efa\u7684\u5927\u90e8\u5206\u5bf9\u8c61\u5f88\u5feb\u5c31\u4f1a\u88ab\u9500\u6bc1\uff0c\u6240\u4ee5\u8fd9\u4e9b\u5bf9\u8c61\u6ca1\u6709\u4f20\u9012\u5230Old\u533a\u800c\u662f\u5728New\u533a\u9500\u6bc1\u3002</p> <p>\u5728\u6b64\u72b6\u6001\u4e0b\uff0c\u65e0\u9700\u66f4\u6539\u5176\u4ed6\u9009\u9879\uff0c\u53ea\u9700\u4e3a\u9009\u62e9\u6700\u4f73\u503c<code>NewRatio</code>\u3002\u90a3\u4e48\u6211\u4eec\u5982\u4f55\u786e\u5b9a\u6700\u4f73\u503c\u5462\uff1f\u8981\u5f97\u5230\u5b83\uff0c\u9700\u8981\u5206\u6790\u6bcf\u4e2a Minor GC \u7684\u5e73\u5747\u6267\u884c\u65f6\u95f4 \u3002</p> <p>Minor GC\u5bf9\u4e8e\u6bcf\u4e2a\u9009\u9879\u7684\u5e73\u5747\u6267\u884c\u65f6\u95f4\u5982\u4e0b\uff1a</p> <ul> <li>NewRatio=2: 45 ms</li> <li>NewRatio=3: 34 ms</li> <li>NewRatio=4: 30 ms</li> </ul> <p>\u6211\u4eec\u5f97\u51fa\u7684\u7ed3\u8bba\u662f NewRatio=4 \u662f\u6700\u597d\u7684\u9009\u62e9\uff0c\u56e0\u4e3a New \u533a\u57df\u5927\u5c0f\u6700\u5c0f\uff0cGC \u65f6\u95f4\u4e5f\u6700\u77ed\uff0c\u5e94\u7528GC\u9009\u9879\u540e\uff0c\u670d\u52a1\u5668\u6ca1\u6709Full GC\u3002</p> <p>\u4ee5\u4e0b\u662f<code>jstat \u2013gcutil</code> \u5728\u670d\u52a1\u7684 JVM \u542f\u52a8\u540e\u51e0\u5929\u6267\u884c\u7684\u7ed3\u679c\u3002</p> <pre><code>S0 S1 E O P YGC YGCT FGC FGCT GCT\n8.61 0.00 30.67 24.62 22.38 2424 30.219 0 0.000 30.219\n</code></pre> <p>\u5f88\u591a\u4eba\u8ba4\u4e3a GC \u4e0d\u7ecf\u5e38\u53d1\u751f\uff0c\u56e0\u4e3a\u670d\u52a1\u5668\u7684\u8bf7\u6c42\u5f88\u5c11\u3002\u4f46\u662f\uff0cFull GC \u6ca1\u6709\u88ab\u6267\u884c\uff0c\u800c Minor GC \u5df2\u7ecf\u6267\u884c\u4e86 2,424 \u6b21\u3002</p>"},{"location":"java/%E5%A6%82%E4%BD%95%E8%B0%83%E4%BC%98%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86/#2","title":"\u793a\u4f8b 2","text":"<p>\u8fd9\u4e2a\u4f8b\u5b50\u662f\u9488\u5bf9\u670d\u52a1A\u7684\u3002\u6211\u4eec\u5728\u516c\u53f8\u7684\u5e94\u7528\u7a0b\u5e8f\u6027\u80fd\u7ba1\u7406\u5668\uff08APM\uff09\u4e2d\u53d1\u73b0JVM\u6709\u5f88\u957f\u4e00\u6bb5\u65f6\u95f4\uff088\u79d2\u6216\u66f4\u957f\u65f6\u95f4\uff09\u6ca1\u6709\u5b9a\u671f\u8fd0\u884c\u3002\u6211\u4eec\u4e00\u76f4\u5728\u5bfb\u627e\u539f\u56e0\uff0c\u53d1\u73b0\u6267\u884cFull GC\u9700\u8981\u5f88\u957f\u65f6\u95f4\uff0c\u6240\u4ee5\u6211\u4eec\u51b3\u5b9a\u6267\u884cGC\u8c03\u4f18\u3002</p> <p>\u4f5c\u4e3aGC\u8c03\u4f18\u7684\u5f00\u59cb\u9636\u6bb5\uff0c\u6211\u4eec\u6dfb\u52a0\u4e86<code>-verbosegc</code>\u9009\u9879\uff0c\u7ed3\u679c\u5982\u4e0b\u3002</p> <p></p> <p>\u56fe 1\uff1aGC \u8c03\u6574\u524d\u7684\u6301\u7eed\u65f6\u95f4\u56fe\u3002</p> <p>\u4e0a\u56fe\u663e\u793a\u4e86\u6301\u7eed\u65f6\u95f4\uff0c\u662fHPJMeter\u5206\u6790\u540e\u81ea\u52a8\u63d0\u4f9b\u7684\u56fe\u8868\u4e4b\u4e00\uff0c X\u8f74 \u663e\u793a\u4e86JVM\u4e4b\u540e\u7684\u65f6\u95f4\u5f00\u59cb\u548c Y\u8f74 \u663e\u793a\u51fa\u4e86\u6bcf\u4e2aGC\u7684\u54cd\u5e94\u65f6\u95f4\u3002\u7eff\u70b9\u8868\u793a  CMS Full GC \u7ed3\u679c\uff0c\u84dd\u70b9\u8868\u793a Parallel Scavenge  Minor GC \u7ed3\u679c\u3002</p> <p>\u4ee5\u524d\u8bf4\u8fc7 CMS GC \u5c06\u662f\u6700\u5feb\u7684\uff0c\u4f46\u662f\u4e0a\u9762\u7684\u7ed3\u679c\u8868\u660e\uff0c\u6709\u4e9b\u60c5\u51b5\u9700\u8981\u957f\u8fbe 15 \u79d2\u3002\u662f\u4ec0\u4e48\u9020\u6210\u4e86\u8fd9\u6837\u7684\u7ed3\u679c\uff1f\u8bf7\u8bb0\u4f4f\u4e4b\u524d\u8bf4\u8fc7\u7684\uff1a\u6267\u884c\u538b\u7f29\u65f6 CMS \u4f1a\u53d8\u6162\u3002\u53e6\u5916\uff0c\u4f7f\u7528 <code>\u2013Xms1g</code> \u548c\u8bbe\u7f6e\u4e86\u670d\u52a1 <code>\u2013Xmx4g</code> \u7684\u5185\u5b58\uff0c\u6700\u5927\u5206\u914d\u7684\u5185\u5b58\u4e3a4GB\u3002</p> <p>\u63a5\u4e0b\u6765\u5c06 GC \u7c7b\u578b\u4ece CMS GC \u66f4\u6539\u4e3a Parallel GC\uff0c\u5c06\u5185\u5b58\u5927\u5c0f\u66f4\u6539\u4e3a2 GB\uff0c\u7136\u540e\u5c06 <code>NewRatio</code> \u8bbe\u7f6e\u4e3a 3\u3002<code>jstat \u2013gcutil</code>\u51e0\u4e2a\u5c0f\u65f6\u540e\u7684\u7ed3\u679c\u5982\u4e0b\u3002</p> <pre><code>S0 S1 E O P YGC YGCT FGC FGCT GCT\n0.00 30.48 3.31 26.54 37.01 226 11.131 4 11.758 22.890\n</code></pre> <p>\u4e0e 4 GB \u7684 15 \u79d2\u76f8\u6bd4\uff0cFull GC \u65f6\u95f4\u66f4\u5feb\uff0c\u6bcf\u6b21 3 \u79d2\u3002\u7136\u800c\uff0c3\u79d2\u4ecd\u7136\u6ca1\u6709\u90a3\u4e48\u5feb\u3002\u6240\u4ee5\u6211\u521b\u5efa\u4e86\u4ee5\u4e0b\u516d\u4e2a\u6848\u4f8b\u3002</p> <ul> <li>\u60c5\u51b51\uff1a <code>-XX:+UseParallelGC -Xms1536m -Xmx1536m -XX:NewRatio=2</code></li> <li>\u6848\u4f8b2\uff1a <code>-XX:+UseParallelGC -Xms1536m -Xmx1536m -XX:NewRatio=3</code></li> <li>\u6848\u4f8b3\uff1a <code>-XX:+UseParallelGC -Xms1g -Xmx1g -XX:NewRatio=3</code></li> <li>\u6848\u4f8b4\uff1a <code>-XX:+UseParallelOldGC -Xms1536m -Xmx1536m -XX:NewRatio=2</code></li> <li>\u6848\u4f8b5\uff1a <code>-XX:+UseParallelOldGC -Xms1536m -Xmx1536m -XX:NewRatio=3</code></li> <li>\u6848\u4f8b6\uff1a <code>-XX:+UseParallelOldGC -Xms1g -Xmx1g -XX:NewRatio=3</code></li> </ul> <p>\u54ea\u4e00\u4e2a\u4f1a\u6700\u5feb\uff1f\u7ed3\u679c\u8868\u660e\uff0c\u5185\u5b58\u8d8a\u5c0f\uff0c\u6548\u679c\u8d8a\u597d\u3002\u4e0b\u56fe\u663e\u793a\u4e86\u6848\u4f8b 6 \u7684\u6301\u7eed\u65f6\u95f4\u56fe\uff0c\u5176\u4e2d\u663e\u793a\u4e86\u6700\u9ad8\u7684 GC \u6539\u8fdb\uff0c\u6700\u6162\u7684\u54cd\u5e94\u65f6\u95f4\u4e3a 1.7 \u79d2\uff0c\u5e73\u5747\u503c\u5df2\u66f4\u6539\u4e3a 1 \u79d2\u4ee5\u5185\uff0c\u663e\u793a\u51fa\u6539\u8fdb\u7684\u7ed3\u679c\u3002</p> <p></p> <p>\u56fe 2\uff1a\u5e94\u7528\u6848\u4f8b 6 \u540e\u7684\u6301\u7eed\u65f6\u95f4\u56fe\u3002</p> <p>\u7ed3\u679c\uff0c\u6211\u628a\u670d\u52a1\u7684\u6240\u6709GC\u9009\u9879\u90fd\u6539\u6210\u4e86Case 6\u3002\u4f46\u662f\u8fd9\u4e2a\u53d8\u5316\u5bfc\u81f4\u6bcf\u5929\u665a\u4e0a\u90fd\u4f1a\u5f15\u8d77 <code>OutOfMemoryError</code>\uff0c\u8fd9\u91cc\u5f88\u96be\u8be6\u7ec6\u8bf4\u660e\u539f\u56e0\uff0c\u4f46\u7b80\u800c\u8a00\u4e4b\uff0c\u6279\u5904\u7406\u6570\u636e\u5904\u7406\u5bfc\u81f4 JVM \u5185\u5b58\u4e0d\u8db3\uff0c\u76ee\u524d\u76f8\u5173\u95ee\u9898\u6b63\u5728\u5904\u7406\u4e2d\u3002</p> <p>\u5206\u6790\u77ed\u65f6\u95f4\u79ef\u7d2f\u7684GC\u65e5\u5fd7\u5e76\u5c06\u7ed3\u679c\u5e94\u7528\u5230\u6240\u6709\u670d\u52a1\u5668\u4f5c\u4e3a\u6267\u884cGC\u8c03\u4f18\u662f\u975e\u5e38\u5371\u9669\u7684\uff0c\u8bf7\u8bb0\u4f4f\u53ea\u6709\u5728\u5206\u6790\u670d\u52a1\u64cd\u4f5c\u548c GC \u65e5\u5fd7\u65f6\uff0c\u624d\u80fd\u65e0\u6545\u969c\u5730\u6267\u884c GC \u8c03\u4f18\u3002</p> <p>\u6211\u4eec\u5df2\u7ecf\u67e5\u770b\u4e86\u4e24\u4e2a GC \u8c03\u4f18\u793a\u4f8b\uff0c\u4ee5\u4e86\u89e3 GC \u8c03\u4f18\u662f\u5982\u4f55\u6267\u884c\u7684\u3002\u6b63\u5982\u6211\u6240\u63d0\u5230\u7684\uff0c\u793a\u4f8b\u4e2d\u8bbe\u7f6e\u7684 GC \u9009\u9879\u53ef\u4ee5\u4e3a\u5177\u6709\u76f8\u540c CPU\u3001\u64cd\u4f5c\u7cfb\u7edf\u7248\u672c\u548c JDK \u7248\u672c\u7684\u670d\u52a1\u5668\u4e0e\u6267\u884c\u76f8\u540c\u529f\u80fd\u7684\u670d\u52a1\u8bbe\u7f6e\u76f8\u540c\u3002\u4f46\u662f\u4e0d\u8981\u5c06\u6211\u6240\u505a\u7684\u9009\u9879\u5e94\u7528\u4e8e\u4f60\u6b63\u5728\u8fd0\u884c\u7684\u670d\u52a1\uff0c\u56e0\u4e3a\u5b83\u4eec\u53ef\u80fd\u5bf9\u4f60\u4e0d\u8d77\u4f5c\u7528\u3002</p>"},{"location":"java/%E5%A6%82%E4%BD%95%E8%B0%83%E4%BC%98%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86/#_5","title":"\u7ed3\u8bba","text":"<p>\u6211\u6839\u636e\u6211\u7684\u7ecf\u9a8c\u6267\u884c GC \u8c03\u4f18\uff0c\u6ca1\u6709\u6267\u884c\u5806\u8f6c\u50a8\u548c\u8be6\u7ec6\u5206\u6790\u5185\u5b58\uff0c\u7cbe\u786e\u7684\u5185\u5b58\u72b6\u6001\u5206\u6790\u53ef\u80fd\u4f1a\u5f97\u51fa\u66f4\u597d\u7684 GC \u8c03\u4f18\u7ed3\u679c\uff0c\u4f46\u662f\u5982\u679c\u8be5\u670d\u52a1\u88ab\u5927\u91cf\u4f7f\u7528\u5e76\u4e14\u5b58\u5728\u5927\u91cf\u5185\u5b58\u4f7f\u7528\u6a21\u5f0f\uff0c\u5219\u53ef\u80fd\u5efa\u8bae\u57fa\u4e8e\u53ef\u9760\u7684\u5148\u524d\u7ecf\u9a8c\u8fdb\u884c GC \u8c03\u4f18\u3002</p> <p>\u6211\u5df2\u7ecf\u901a\u8fc7\u5728\u4e00\u4e9b\u670d\u52a1\u5668\u4e0a\u8bbe\u7f6eG1 GC\u9009\u9879\u6765\u6267\u884c\u6027\u80fd\u6d4b\u8bd5\uff0cG1 GC \u9009\u9879\u663e\u793a\u51fa\u6bd4\u4efb\u4f55\u5176\u4ed6 GC \u7c7b\u578b\u66f4\u5feb\u7684\u7ed3\u679c\u3002\u5728JDK 7\u7a33\u5b9a\u540e\uff08\u8fd9\u5e76\u4e0d\u610f\u5473\u7740\u5b83\u4e0d\u7a33\u5b9a\uff09\u5e76\u4e14WAS\uff08web application service\uff09\u9488\u5bf9JDK 7\u8fdb\u884c\u4e86\u4f18\u5316\uff0c\u4f7f G1 GC \u7684\u7a33\u5b9a\u5e94\u7528\u53ef\u80fd\u6700\u7ec8\u6309\u9884\u671f\u5de5\u4f5c\uff0c\u6709\u4e00\u5929\u6211\u4eec\u53ef\u80fd\u4e0d\u9700\u8981GC\u8c03\u4f18\u3002</p> <p>\u53c2\u8003\u6587\u6863</p> <p>https://www.cubrid.org/blog/3826456</p>"},{"location":"java/%E6%98%AF%E4%BB%80%E4%B9%88%E8%AE%A9Java%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84CPU%E4%BD%BF%E7%94%A8%E7%8E%87%E9%A3%99%E5%8D%87/","title":"\u662f\u4ec0\u4e48\u8ba9 Java \u5e94\u7528\u7a0b\u5e8f\u7684 CPU \u4f7f\u7528\u7387\u98d9\u5347\uff1f","text":"<p>\u5982\u679c\u547d\u8fd0\u662f\u4e00\u6761\u5b64\u72ec\u7684\u6cb3\u6d41\uff0c\u8c01\u4f1a\u662f\u4f60\u7684\u7075\u9b42\u6446\u6e21\u4eba\uff1f \u2014\u2014  \u514b\u83b1\u513f\u00b7\u9ea6\u514b\u798f\u5c14\u300a\u6446\u6e21\u4eba\u300b</p>"},{"location":"java/%E6%98%AF%E4%BB%80%E4%B9%88%E8%AE%A9Java%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84CPU%E4%BD%BF%E7%94%A8%E7%8E%87%E9%A3%99%E5%8D%87/#_1","title":"\u4e00. \u95ee\u9898","text":"<ul> <li>while \u7684\u65e0\u9650\u5faa\u73af\u662f\u5426\u4f1a\u5bfc\u81f4 CPU \u4f7f\u7528\u7387\u98d9\u5347\uff1f</li> <li>\u9891\u7e41\u7684 Young GC \u662f\u5426\u4f1a\u5bfc\u81f4 CPU \u4f7f\u7528\u7387\u98d9\u5347\uff1f</li> <li>\u6709\u5927\u91cf\u7ebf\u7a0b\u7684\u5e94\u7528\u7a0b\u5e8f\u7684 CPU \u4f7f\u7528\u7387\u9ad8\u5417\uff1f</li> <li>CPU \u4f7f\u7528\u7387\u9ad8\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u7ebf\u7a0b\u6570\u662f\u5426\u5f88\u5927\uff1f</li> <li>\u5904\u4e8e BLOCKED \u72b6\u6001\u7684\u7ebf\u7a0b\u662f\u5426\u4f1a\u5bfc\u81f4 CPU \u4f7f\u7528\u7387\u98d9\u5347\uff1f</li> <li>\u5206\u65f6\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684 CPU \u662f\u6d88\u8017 <code>us(\u7528\u6237\u6001)</code> \u8fd8\u662f <code>sy(\u5185\u6838\u6001)</code>?</li> </ul>"},{"location":"java/%E6%98%AF%E4%BB%80%E4%B9%88%E8%AE%A9Java%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84CPU%E4%BD%BF%E7%94%A8%E7%8E%87%E9%A3%99%E5%8D%87/#_2","title":"\u4e8c. \u601d\u8003","text":""},{"location":"java/%E6%98%AF%E4%BB%80%E4%B9%88%E8%AE%A9Java%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84CPU%E4%BD%BF%E7%94%A8%E7%8E%87%E9%A3%99%E5%8D%87/#1-cpu","title":"1. \u6211\u4eec\u5982\u4f55\u8ba1\u7b97 CPU \u4f7f\u7528\u7387\uff1f","text":"<p><code>CPU% = (1 - idleTime / sysTime )  *  100</code></p> <ul> <li> <p><code>idleTime</code>\uff1aCPU \u7684\u7a7a\u95f2\u65f6\u95f4</p> </li> <li> <p><code>sysTime</code>\uff1aCPU \u5904\u4e8e\u7528\u6237\u6001\u548c\u5185\u6838\u6001\u7684\u65f6\u95f4\u603b\u548c</p> </li> </ul>"},{"location":"java/%E6%98%AF%E4%BB%80%E4%B9%88%E8%AE%A9Java%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84CPU%E4%BD%BF%E7%94%A8%E7%8E%87%E9%A3%99%E5%8D%87/#2-cpu","title":"2. \u5e38\u89c1\u7684 CPU \u5bc6\u96c6\u578b\u64cd\u4f5c\u6709\u54ea\u4e9b\uff1f","text":"<p>\u4eba\u4eec\u5e38\u8bf4\uff0c\u8ba1\u7b97\u5bc6\u96c6\u578b\u7a0b\u5e8f\u5c31\u662f CPU \u5bc6\u96c6\u578b\u7684\uff0c\u90a3\u4e48\uff0cJava \u5e94\u7528\u7a0b\u5e8f\u4e2d\u6709\u54ea\u4e9b\u64cd\u4f5c\u662f\u8ba1\u7b97\u5bc6\u96c6\u578b\u7684\u5462\uff1f</p> <p>\u4e0b\u9762\u5217\u51fa\u5e38\u89c1 CPU \u5bc6\u96c6\u578b\u64cd\u4f5c\uff1a</p> <ul> <li>\u9891\u7e41\u7684 GC\uff1b\u5982\u679c\u8bbf\u95ee\u91cf\u5f88\u5927\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u9891\u7e41\u7684GC\u751a\u81f3Full GC\u3002\u5f53\u8c03\u7528\u91cf\u5927\u65f6\uff0c\u5185\u5b58\u5206\u914d\u4f1a\u975e\u5e38\u5feb\uff0c\u4ee5\u81f3\u4e8e GC \u7ebf\u7a0b\u4f1a\u4e0d\u65ad\u6267\u884c\uff0c\u5bfc\u81f4 CPU \u98d9\u5347\u3002</li> <li>\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316</li> <li>\u52a0\u5bc6\u548c\u89e3\u7801</li> <li>\u6b63\u5219\u8868\u8fbe\u5f0f\u3002\u539f\u56e0\u53ef\u80fd\u662fJava\u6b63\u5219\u8868\u8fbe\u5f0f\u4f7f\u7528\u7684\u5f15\u64ce\u5b9e\u73b0\u662fNFA\u81ea\u52a8\u673a\uff0c\u5b83\u4f1a\u5728\u5b57\u7b26\u5339\u914d\u65f6\u8fdb\u884c\u56de\u6eaf\u3002</li> <li>\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u3002\u6709\u5f88\u591a\u542f\u52a8\u7684\u7ebf\u7a0b\uff0c\u8fd9\u4e9b\u7ebf\u7a0b\u7684\u72b6\u6001\u5728 Blocked\uff08\u9501\u7b49\u5f85\u3001IO\u7b49\u5f85\u7b49\uff09\u548c Running \u4e4b\u95f4\u4e0d\u65ad\u53d8\u5316\uff0c\u5f53\u9501\u4e89\u7528\u6fc0\u70c8\u65f6\uff0c\u8fd9\u79cd\u60c5\u51b5\u5f88\u5bb9\u6613\u53d1\u751f\u3002</li> <li>\u4e00\u4e9b\u7ebf\u7a0b\u6b63\u5728\u6267\u884c\u975e\u963b\u585e\u64cd\u4f5c\uff0c\u4f8b\u5982<code>while (true)</code>\u8bed\u53e5\u3002\u5982\u679c\u7a0b\u5e8f\u4e2d\u8ba1\u7b97\u65f6\u95f4\u8f83\u957f\uff0c\u53ef\u4ee5\u4f11\u7720\u7ebf\u7a0b\u3002</li> </ul>"},{"location":"java/%E6%98%AF%E4%BB%80%E4%B9%88%E8%AE%A9Java%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84CPU%E4%BD%BF%E7%94%A8%E7%8E%87%E9%A3%99%E5%8D%87/#3-cpu","title":"3. CPU \u4e0e \u8fdb\u7a0b\u548c\u7ebf\u7a0b\u6709\u5173\u5417\uff1f","text":"<p>\u73b0\u5728\uff0c\u5206\u65f6\u64cd\u4f5c\u7cfb\u7edf\u91c7\u7528\u8f6e\u8be2\u7684\u65b9\u5f0f\u4e3a\u8fdb\u7a0b\u8c03\u5ea6\u5206\u914d\u65f6\u95f4\u7247\u3002\u5982\u679c\u8fdb\u7a0b\u6b63\u5728\u7b49\u5f85\u6216\u963b\u585e\uff0c\u5219\u5b83\u4e0d\u4f1a\u4f7f\u7528 CPU \u8d44\u6e90\u3002\u7ebf\u7a0b\u79f0\u4e3a\u8f7b\u8fdb\u7a0b\uff0c\u5171\u4eab\u8fdb\u7a0b\u8d44\u6e90\uff0c\u56e0\u6b64\u7ebf\u7a0b\u8c03\u5ea6\u5728 CPU \u4e2d\u4e5f\u662f\u5206\u65f6\u7684\u3002\u4f46\u662f\u5728 Java \u4e2d\uff0c\u6211\u4eec\u4f7f\u7528 JVM \u8fdb\u884c\u7ebf\u7a0b\u8c03\u5ea6\uff0c\u6240\u4ee5\u4e00\u822c\u6765\u8bf4\uff0c\u7ebf\u7a0b\u7684\u8c03\u5ea6\u6709\u4e24\u79cd\u6a21\u5f0f\uff1a\u5206\u65f6\u8c03\u5ea6\u548c\u62a2\u5360\u5f0f\u8c03\u5ea6\u3002\u7ebf\u7a0b\u548c\u8fdb\u7a0b\u5728\u963b\u585e\u6216\u8005\u7b49\u5f85\u65f6\uff0c\u90fd\u4e0d\u4f1a\u4f7f\u7528 CPU \u8d44\u6e90\u3002</p>"},{"location":"java/%E6%98%AF%E4%BB%80%E4%B9%88%E8%AE%A9Java%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84CPU%E4%BD%BF%E7%94%A8%E7%8E%87%E9%A3%99%E5%8D%87/#_3","title":"\u4e09. \u7b54\u6848","text":""},{"location":"java/%E6%98%AF%E4%BB%80%E4%B9%88%E8%AE%A9Java%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84CPU%E4%BD%BF%E7%94%A8%E7%8E%87%E9%A3%99%E5%8D%87/#1-whilecpu","title":"1. while\u7684\u65e0\u9650\u5faa\u73af\u662f\u5426\u5bfc\u81f4CPU\u4f7f\u7528\u7387\u98d9\u5347\uff1f","text":"<p>\u56de\u7b54\uff1a\u662f\u7684</p> <p>\u5206\u6790\uff1a\u9996\u5148\uff0c\u65e0\u9650\u5faa\u73af\u4f1a\u8c03\u7528CPU\u5bc4\u5b58\u5668\u8fdb\u884c\u8ba1\u6570\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u4f1a\u5360\u7528CPU\u8d44\u6e90\u3002\u90a3\u4e48\uff0c\u5982\u679c\u7ebf\u7a0b\u4e00\u76f4\u5904\u4e8e\u6b7b\u5faa\u73af\u72b6\u6001\uff0cCPU\u4f1a\u4e0d\u4f1a\u5207\u6362\u7ebf\u7a0b\u5462\uff1f\u9664\u975e\u64cd\u4f5c\u7cfb\u7edf\u65f6\u95f4\u7247\u5230\u671f\uff0c\u5426\u5219\u65e0\u9650\u5faa\u73af\u4e0d\u4f1a\u653e\u5f03\u5360\u7528\u7684CPU\u8d44\u6e90\uff0c\u5e76\u4e14\u65e0\u9650\u5faa\u73af\u4f1a\u7ee7\u7eed\u5411\u7cfb\u7edf\u8bf7\u6c42\u65f6\u95f4\u7247\uff0c\u76f4\u5230\u7cfb\u7edf\u6ca1\u6709\u7a7a\u95f2\u65f6\u95f4\u505a\u5176\u4ed6\u4e8b\u60c5\u3002</p>"},{"location":"java/%E6%98%AF%E4%BB%80%E4%B9%88%E8%AE%A9Java%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84CPU%E4%BD%BF%E7%94%A8%E7%8E%87%E9%A3%99%E5%8D%87/#2-young-gccpu","title":"2. \u9891\u7e41\u7684Young GC\u4f1a\u5bfc\u81f4CPU\u4f7f\u7528\u7387\u98d9\u5347\u5417\uff1f","text":"<p>\u56de\u7b54\uff1a\u662f\u7684</p> <p>\u5206\u6790\uff1aYoung GC \u672c\u8eab\u5c31\u662f JVM \u8fdb\u884c\u5783\u573e\u56de\u6536\u7684\u64cd\u4f5c\uff0c\u9700\u8981\u8ba1\u7b97\u5185\u5b58\u548c\u8c03\u7528\u5bc4\u5b58\u5668\uff0c\u56e0\u6b64\u9891\u7e41\u7684 Young GC \u80af\u5b9a\u4f1a\u5360\u7528 CPU \u8d44\u6e90\u3002</p> <p>\u8ba9\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u771f\u5b9e\u7684\u6848\u4f8b\uff1afor \u5faa\u73af\u4ece\u6570\u636e\u5e93\u4e2d\u67e5\u8be2\u6570\u636e\u96c6\u5408\uff0c\u7136\u540e\u518d\u6b21\u5c01\u88c5\u65b0\u7684\u6570\u636e\u96c6\u5408\u3002\u5982\u679c\u5185\u5b58\u4e0d\u591f\u5b58\u50a8\uff0cJVM \u4f1a\u56de\u6536\u4e0d\u518d\u4f7f\u7528\u7684\u6570\u636e\u3002\u56e0\u6b64\uff0c\u5982\u679c\u9700\u8981\u7684\u5b58\u50a8\u7a7a\u95f4\u5f88\u5927\uff0c\u53ef\u80fd\u4f1a\u6536\u5230 CPU \u4f7f\u7528\u7387\u8b66\u62a5\u3002</p>"},{"location":"java/%E6%98%AF%E4%BB%80%E4%B9%88%E8%AE%A9Java%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84CPU%E4%BD%BF%E7%94%A8%E7%8E%87%E9%A3%99%E5%8D%87/#3-cpu_1","title":"3. \u7ebf\u7a0b\u591a\u7684\u5e94\u7528CPU\u4f7f\u7528\u7387\u4e00\u5b9a\u9ad8\u5417\uff1f","text":"<p>\u56de\u7b54\uff1a\u4e0d\u4e00\u5b9a</p> <p>\u5206\u6790\uff1a\u5982\u679c\u6211\u4eec\u901a\u8fc7 <code>jstack</code> \u67e5\u770b\u7cfb\u7edf\u7ebf\u7a0b\u72b6\u6001\u65f6\u7ebf\u7a0b\u603b\u6570\u5f88\u5927\uff0c\u4f46\u5904\u4e8e <code>Runnable</code> \u548c <code>Running</code> \u72b6\u6001\u7684\u7ebf\u7a0b\u5e76\u4e0d\u591a\uff0c\u90a3\u4e48 CPU \u4f7f\u7528\u7387\u4e0d\u4e00\u5b9a\u9ad8\u3002\u4f46\u662f\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u7ebf\u7a0b\u6570\u5f88\u5927\uff0c\u90a3\u4e48\u5e38\u89c1\u7684\u539f\u56e0\u662f\u5927\u91cf\u7ebf\u7a0b\u5904\u4e8e <code>BLOCKED</code> \u548c <code>WAITING</code> \u72b6\u6001\u3002</p>"},{"location":"java/%E6%98%AF%E4%BB%80%E4%B9%88%E8%AE%A9Java%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84CPU%E4%BD%BF%E7%94%A8%E7%8E%87%E9%A3%99%E5%8D%87/#4-cpu","title":"4. CPU \u4f7f\u7528\u7387\u9ad8\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u7ebf\u7a0b\u6570\u4e00\u5b9a\u5927\u5417\uff1f","text":"<p>\u56de\u7b54\uff1a\u4e0d\u4e00\u5b9a</p> <p>\u5206\u6790\uff1aCPU \u4f7f\u7528\u7387\u9ad8\u7684\u5173\u952e\u56e0\u7d20\u662f\u8ba1\u7b97\u5bc6\u96c6\u578b\u64cd\u4f5c\u3002\u5982\u679c\u4e00\u4e2a\u7ebf\u7a0b\u6709\u5927\u91cf\u8ba1\u7b97\uff0cCPU\u4f7f\u7528\u7387\u4e5f\u53ef\u80fd\u5f88\u9ad8\uff0c\u8fd9\u4e5f\u662f\u4e00\u4e2a\u6570\u636e\u811a\u672c\u4efb\u52a1\u9700\u8981\u5728\u5927\u89c4\u6a21\u96c6\u7fa4\u4e0a\u8fd0\u884c\u7684\u539f\u56e0\u3002</p>"},{"location":"java/%E6%98%AF%E4%BB%80%E4%B9%88%E8%AE%A9Java%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84CPU%E4%BD%BF%E7%94%A8%E7%8E%87%E9%A3%99%E5%8D%87/#5-blockedcpu","title":"5. \u5904\u4e8eBLOCKED\u72b6\u6001\u7684\u7ebf\u7a0b\u662f\u5426\u4f1a\u5bfc\u81f4CPU\u4f7f\u7528\u7387\u98d9\u5347\uff1f","text":"<p>\u56de\u7b54\uff1a\u4e0d\u4e00\u5b9a</p> <p>\u5206\u6790\uff1aCPU \u4f7f\u7528\u7387\u7684\u98d9\u5347\u66f4\u591a\u662f\u56e0\u4e3a\u4e0a\u4e0b\u6587\u5207\u6362\u6216\u8fc7\u591a\u7684\u53ef\u8fd0\u884c\u72b6\u6001\u7ebf\u7a0b\u3002\u5904\u4e8e\u963b\u585e\u72b6\u6001\u7684\u7ebf\u7a0b\u4e0d\u4e00\u5b9a\u4f1a\u5bfc\u81f4 CPU \u4f7f\u7528\u7387\u4e0a\u5347\u3002</p>"},{"location":"java/%E6%98%AF%E4%BB%80%E4%B9%88%E8%AE%A9Java%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84CPU%E4%BD%BF%E7%94%A8%E7%8E%87%E9%A3%99%E5%8D%87/#6-cpuussy","title":"6 . CPU\u7684<code>us</code>\u548c<code>sy</code>\u503c\u5728\u5206\u65f6\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u9ad8\u662f\u4ec0\u4e48\u610f\u601d\uff1f","text":"<p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>top</code> \u547d\u4ee4\u67e5\u770b CPU \u7684 <code>us</code> \u548c <code>sy</code> \u7684\u503c\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <ul> <li>us\uff1a\u7528\u6237\u7a7a\u95f4\u5360\u7528 CPU \u7684\u767e\u5206\u6bd4\u3002\u7b80\u5355\u6765\u8bf4\uff0c\u5982\u679c <code>us</code> \u7684\u503c\u6bd4\u8f83\u9ad8\uff0c\u5219\u662f\u6211\u4eec\u7a0b\u5e8f\u5f15\u8d77\u7684\uff0c\u5e76\u4e14\u5206\u6790\u7ebf\u7a0b\u5806\u6808\u5f88\u5bb9\u6613\u5b9a\u4f4d\u6709\u95ee\u9898\u7684\u7ebf\u7a0b\u3002</li> <li>sy\uff1a\u5185\u6838\u7a7a\u95f4\u5360\u7528 CPU \u7684\u767e\u5206\u6bd4\u3002<code>sy</code> \u9ad8\u7684\u65f6\u5019\uff0c\u5982\u679c\u662f\u7a0b\u5e8f\u5f15\u8d77\u7684\uff0c\u90a3\u4e48\u57fa\u672c\u4e0a\u662f\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u5f15\u8d77\u7684\u3002</li> </ul>"},{"location":"java/%E6%98%AF%E4%BB%80%E4%B9%88%E8%AE%A9Java%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84CPU%E4%BD%BF%E7%94%A8%E7%8E%87%E9%A3%99%E5%8D%87/#_4","title":"\u56db. \u7ecf\u9a8c","text":"<p>\u5982\u4f55\u5b9a\u4f4dCPU\u4f7f\u7528\u7387\u9ad8\u7684\u539f\u56e0\uff1f\u4e0b\u9762\u7b80\u8981\u4ecb\u7ecd\u5206\u6790\u8fc7\u7a0b\u3002</p> <p>\u5982\u679c\u53d1\u73b0\u67d0\u4e2a\u5e94\u7528\u670d\u52a1\u5668\u7684CPU\u4f7f\u7528\u7387\u9ad8\uff0c\u9996\u5148\u68c0\u67e5\u7ebf\u7a0b\u6570\u3001JVM\u3001\u7cfb\u7edf\u8d1f\u8f7d\u7b49\u53c2\u6570\uff0c\u7136\u540e\u7528\u8fd9\u4e9b\u53c2\u6570\u6765\u8bc1\u660e\u95ee\u9898\u7684\u539f\u56e0\u3002\u5176\u6b21\uff0c\u7528 jstack \u6253\u5370\u5806\u6808\u4fe1\u606f\uff0c\u4f7f\u7528\u5de5\u5177\u5206\u6790\u7ebf\u7a0b\u4f7f\u7528\u60c5\u51b5\uff08\u63a8\u8350\u4f7f\u7528\u5728\u7ebf\u7ebf\u7a0b\u5206\u6790\u5de5\u5177fastThread\uff09\u3002</p> <p>\u5728\u7ebf\u7ebf\u7a0b\u5206\u6790\u5de5\u5177fastThread \u5730\u5740\uff1ahttps://fastthread.io/</p> <p></p> <p>\u4e0b\u4e00\u7bc7\u6587\u7ae0\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528\u5728\u7ebf\u7ebf\u7a0b\u5206\u6790\u5de5\u5177 fastThread \u5206\u6790\u7ebf\u7a0b\u5806\u6808\u4fe1\u606f\u3002</p> <p>\u53c2\u8003\u6587\u6863\uff1a</p> <p>https://www.tutorialdocs.com/article/java-cpu-soar.html</p>"},{"location":"java/%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8/","title":"\u7b80\u5355\u7406\u89e3 Java \u5783\u573e\u6536\u96c6\u5668","text":"<p>\u4e86\u89e3\u5783\u573e\u56de\u6536 (GC) \u5728 Java \u4e2d\u7684\u5de5\u4f5c\u539f\u7406\u6709\u4ec0\u4e48\u597d\u5904\uff1f\u6ee1\u8db3\u8f6f\u4ef6\u5de5\u7a0b\u5e08\u7684\u6c42\u77e5\u6b32\u662f\u4e00\u4e2a\u5408\u7406\u7684\u539f\u56e0\uff0c\u800c\u4e14\uff0c\u4e86\u89e3 GC \u7684\u5de5\u4f5c\u539f\u7406\u53ef\u4ee5\u5e2e\u52a9\u4f60\u7f16\u5199\u66f4\u597d\u7684 Java \u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>\u8fd9\u662f\u6211\u975e\u5e38\u4e2a\u4eba\u548c\u4e3b\u89c2\u7684\u610f\u89c1\uff0c\u4f46\u6211\u76f8\u4fe1\u7cbe\u901a GC \u7684\u4eba\u5f80\u5f80\u662f\u66f4\u597d\u7684 Java \u5f00\u53d1\u4eba\u5458\u3002\u5982\u679c\u4f60\u5bf9 GC \u8fc7\u7a0b\u611f\u5174\u8da3\uff0c\u90a3\u610f\u5473\u7740\u4f60\u6709\u5f00\u53d1\u7279\u5b9a\u89c4\u6a21\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u7ecf\u9a8c\u3002\u5982\u679c\u4f60\u4ed4\u7ec6\u8003\u8651\u8fc7\u9009\u62e9\u6b63\u786e\u7684 GC \u7b97\u6cd5\uff0c\u5219\u610f\u5473\u7740\u4f60\u5b8c\u5168\u4e86\u89e3\u4f60\u5f00\u53d1\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u529f\u80fd\u3002\u5f53\u7136\uff0c\u5bf9\u4e8e\u4f18\u79c0\u7684\u5f00\u53d1\u4eba\u5458\u6765\u8bf4\uff0c\u8fd9\u53ef\u80fd\u4e0d\u662f\u901a\u7528\u7684\u6807\u51c6\u3002\u7136\u800c\uff0c\u5f53\u6211\u8bf4\u7406\u89e3 GC \u662f\u6210\u4e3a\u4e00\u540d\u4f18\u79c0\u7684 Java \u5f00\u53d1\u4eba\u5458\u7684\u5fc5\u8981\u6761\u4ef6\u65f6\uff0c\u5f88\u5c11\u6709\u4eba\u4f1a\u53cd\u5bf9\u3002 </p> <p>\u8fd9\u662f\u201c\u6210\u4e3a Java GC \u4e13\u5bb6\u201d\u7cfb\u5217\u6587\u7ae0\u7684\u7b2c\u4e00\u7bc7\u3002\u8fd9\u6b21\u6211\u4f1a\u4ecb\u7ecdGC\u4ecb\u7ecd\uff0c\u4e0b\u4e00\u7bc7\u6211\u4f1a\u5206\u6790GC\u72b6\u6001\u548cGC\u8c03\u4f18\u4f8b\u5b50\u3002</p> <p>\u5728\u5b66\u4e60 GC \u4e4b\u524d\uff0c\u4f60\u5e94\u8be5\u4e86\u89e3\u4e00\u4e2a\u672f\u8bed\u3002\u8be5\u672f\u8bed\u662f Stop-the-world\u3002\u65e0\u8bba\u4f60\u9009\u62e9\u54ea\u79cd GC \u7b97\u6cd5\uff0c\u90fd\u4f1a\u53d1\u751f Stop-the-world\u3002Stop-the-world\u610f\u5473\u7740 JVM \u6b63\u5728\u505c\u6b62\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u4ee5\u6267\u884c GC\u3002\u5f53 stop-the-world \u53d1\u751f\u65f6\uff0c\u9664\u4e86 GC \u6240\u9700\u7684\u7ebf\u7a0b\u4e4b\u5916\u7684\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u5c06\u505c\u6b62\u5b83\u4eec\u7684\u4efb\u52a1\u3002\u88ab\u4e2d\u65ad\u7684\u4efb\u52a1\u53ea\u6709\u5728 GC \u4efb\u52a1\u5b8c\u6210\u540e\u624d\u4f1a\u6062\u590d\u3002</p> <p>GC \u8c03\u4f18\u901a\u5e38\u610f\u5473\u7740\u51cf\u5c11\u8fd9\u79cd Stop-the-world \u7684\u65f6\u95f4\u3002</p>"},{"location":"java/%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8/#_1","title":"\u5206\u4ee3\u5783\u573e\u6536\u96c6","text":"<p>Java \u6ca1\u6709\u5728\u7a0b\u5e8f\u4ee3\u7801\u4e2d\u660e\u786e\u6307\u5b9a\u5185\u5b58\u5e76\u5c06\u5176\u5220\u9664\u3002\u6709\u4e9b\u4eba\u5c06\u76f8\u5173\u5bf9\u8c61\u8bbe\u7f6e\u4e3a null \u6216\u4f7f\u7528 System.gc() \u65b9\u6cd5\u663e\u5f0f\u5220\u9664\u5185\u5b58\u3002\u8bbe\u7f6e\u4e3anull\u6ca1\u4ec0\u4e48\u5927\u4e0d\u4e86\u7684\uff0c\u4f46\u662f\u8c03\u7528System.gc()\u65b9\u6cd5\u4f1a\u4e25\u91cd\u5f71\u54cd\u7cfb\u7edf\u6027\u80fd\uff0c\u5343\u4e07\u4e0d\u8981\u6267\u884c\u3002</p> <p>\u5728Java\u4e2d\uff0c\u7531\u4e8e\u5f00\u53d1\u8005\u5728\u7a0b\u5e8f\u4ee3\u7801\u4e2d\u5e76\u6ca1\u6709\u663e\u5f0f\u5730\u79fb\u9664\u5185\u5b58\uff0c\u5783\u573e\u6536\u96c6\u5668\u4f1a\u53d1\u73b0\u4e0d\u9700\u8981\u7684\uff08\u5783\u573e\uff09\u5bf9\u8c61\u5e76\u79fb\u9664\u5b83\u4eec\u3002\u8fd9\u4e2a\u5783\u573e\u6536\u96c6\u5668\u662f\u57fa\u4e8e\u4ee5\u4e0b\u4e24\u4e2a\u5047\u8bbe\u521b\u5efa\u7684\u3002\uff08\u5c06\u5b83\u4eec\u79f0\u4e3a\u5047\u8bbe\u6216\u524d\u63d0\uff0c\u800c\u4e0d\u662f\u5047\u8bbe\u66f4\u6b63\u786e\u3002\uff09 </p> <ul> <li>\u5927\u591a\u6570\u5bf9\u8c61\u5f88\u5feb\u5c31\u4f1a\u53d8\u5f97\u65e0\u6cd5\u8bbf\u95ee\u3002</li> <li>\u4ece\u65e7\u5bf9\u8c61\u5230\u65b0\u5bf9\u8c61\u7684\u5f15\u7528\u53ea\u5b58\u5728\u5c11\u91cf\u3002</li> </ul> <p>\u8fd9\u4e9b\u5047\u8bbe\u88ab\u79f0\u4e3aweak generational hypothesis\u3002\u6240\u4ee5\u4e3a\u4e86\u4fdd\u6301\u8fd9\u4e2a\u5047\u8bbe\u7684\u4f18\u52bf\uff0c\u5728 HotSpot VM \u4e2d\uff0c\u5b83\u5728\u7269\u7406\u4e0a\u88ab\u5206\u4e3a\u4e24\u4e2a\u2014\u2014\u5e74\u8f7b\u4ee3\u548c\u8001\u5e74\u4ee3\u3002</p> <p>\u5e74\u8f7b\u4ee3\uff1a\u5927\u90e8\u5206\u65b0\u521b\u5efa\u7684\u5bf9\u8c61\u90fd\u4f4d\u4e8e\u8fd9\u91cc\u3002\u7531\u4e8e\u5927\u591a\u6570\u5bf9\u8c61\u5f88\u5feb\u5c31\u65e0\u6cd5\u8bbf\u95ee\uff0c\u56e0\u6b64\u8bb8\u591a\u5bf9\u8c61\u5728\u5e74\u8f7b\u4ee3\u4e2d\u521b\u5efa\uff0c\u7136\u540e\u6d88\u5931\u3002\u5f53\u5bf9\u8c61\u4ece\u8be5\u533a\u57df\u6d88\u5931\u65f6\uff0c\u6211\u4eec\u8bf4\u53d1\u751f\u4e86\u201cminor GC \u201d\u3002 </p> <p>\u8001\u5e74\u4ee3\uff1a\u4ece\u5e74\u8f7b\u4ee3\u4e2d\u6ca1\u6709\u53d8\u5f97\u4e0d\u53ef\u8fbe\u5e76\u5e78\u5b58\u4e0b\u6765\u7684\u5bf9\u8c61\u88ab\u590d\u5236\u5230\u8fd9\u91cc\u3002\u5b83\u901a\u5e38\u6bd4\u5e74\u8f7b\u4ee3\u5927\u3002\u7531\u4e8e\u5185\u5b58\u8f83\u5927\uff0cGC \u53d1\u751f\u7684\u9891\u7387\u4f4e\u4e8e\u5e74\u8f7b\u4ee3\u3002\u5f53\u5bf9\u8c61\u4ece\u8001\u5e74\u4ee3\u6d88\u5931\u65f6\uff0c\u6211\u4eec\u8bf4\u53d1\u751f\u4e86\u201c major GC \u201d\uff08\u6216\u201c full GC \u201d\uff09\u3002 </p> <p>\u8ba9\u6211\u4eec\u7528\u56fe\u8868\u6765\u770b\u770b\u3002</p> <p></p> <p></p> <p>\u56fe 1\uff1aGC \u533a\u57df\u548c\u6570\u636e\u6d41\u3002</p> <p>\u4e0a\u56fe\u4e2d\u7684\u6c38\u4e45\u4ee3\u4e5f\u79f0\u4e3a\u201c\u65b9\u6cd5\u533a\u201d\uff0c\u5b83\u5b58\u50a8\u7c7b\u6216\u5185\u90e8\u5b57\u7b26\u4e32\u3002\u6240\u4ee5\uff0c\u8fd9\u4e2a\u533a\u57df\u7edd\u5bf9\u4e0d\u662f\u8ba9\u8001\u5e74\u4ee3\u5b58\u6d3b\u4e0b\u6765\u7684\u7269\u4f53\u6c38\u4e45\u5b58\u5728\u7684\u3002\u8fd9\u4e2a\u533a\u57df\u53ef\u80fd\u4f1a\u53d1\u751fGC\u3002\u6b64\u5904\u53d1\u751f\u7684 GC \u4ecd\u88ab\u89c6\u4e3a major GC \u3002 </p> <p>\u53ef\u80fd\u6709\u4eba\u4f1a\u7591\u60d1\uff1a</p> <p>\u5982\u679c\u8001\u5e74\u4ee3\u7684\u5bf9\u8c61\u9700\u8981\u5f15\u7528\u5e74\u8f7b\u4ee3\u7684\u5bf9\u8c61\u600e\u4e48\u529e\uff1f</p> <p>\u4e3a\u4e86\u5904\u7406\u8fd9\u4e9b\u60c5\u51b5\uff0c\u8001\u5e74\u4ee3\u6709\u4e00\u4e2a\u53eb\u505a card table \u7684\u4e1c\u897f\uff0c\u5b83\u662f\u4e00\u4e2a512 \u5b57\u8282\u7684\u5757\u3002\u6bcf\u5f53\u8001\u5e74\u4ee3\u7684\u5bf9\u8c61\u5f15\u7528\u5e74\u8f7b\u4ee3\u7684\u5bf9\u8c61\u65f6\uff0c\u90fd\u4f1a\u8bb0\u5f55\u5728\u8fd9\u5f20\u8868\u4e2d\u3002\u5bf9\u5e74\u8f7b\u4ee3\u6267\u884cGC\u65f6\uff0c\u53ea\u67e5\u627e\u8fd9\u5f20\u5361\u7247\u8868\u6765\u5224\u65ad\u5b83\u662f\u5426\u662fGC\u7684\u4e3b\u9898\uff0c\u800c\u4e0d\u662f\u68c0\u67e5\u8001\u5e74\u4ee3\u6240\u6709\u5bf9\u8c61\u7684\u5f15\u7528\u3002\u8fd9\u4e2a\u5361\u8868\u662f\u7528\u5199\u5c4f\u969c*\u7ba1\u7406\u7684\u3002\u8fd9\u4e2a\u5199\u5c4f\u969c\u662f\u4e00\u79cd\u53ef\u4ee5\u4e3a minor GC \u63d0\u4f9b\u66f4\u5feb\u6027\u80fd\u7684\u8bbe\u5907\u3002\u5c3d\u7ba1\u56e0\u6b64\u4f1a\u4ea7\u751f\u4e00\u4e9b\u5f00\u9500\uff0c\u4f46\u603b\u4f53 GC \u65f6\u95f4\u51cf\u5c11\u4e86\u3002 </p> <p></p> <p>\u56fe 2\uff1a\u5361\u7247\u8868\u7ed3\u6784\u3002</p>"},{"location":"java/%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8/#_2","title":"\u5e74\u8f7b\u4e00\u4ee3\u7684\u7ec4\u6210","text":"<p>\u4e3a\u4e86\u7406\u89e3GC\uff0c\u8ba9\u6211\u4eec\u4e86\u89e3\u4e00\u4e0b\u5e74\u8f7b\u4ee3\uff0c\u7b2c\u4e00\u6b21\u521b\u5efa\u5bf9\u8c61\u7684\u5730\u65b9\u3002\u5e74\u8f7b\u4ee3\u5206\u4e3a3\u4e2a\u7a7a\u95f4\u3002 </p> <ul> <li>\u4e00Eden \u7a7a\u95f4</li> <li>\u4e24\u4e2aSurvivor \u7a7a\u95f4</li> </ul> <p>\u603b\u5171\u67093\u4e2a\u7a7a\u95f4\uff0c\u5176\u4e2d\u4e24\u4e2a\u662fSurvivor\u7a7a\u95f4\u3002\u6bcf\u4e2a\u7a7a\u95f4\u7684\u6267\u884c\u8fc7\u7a0b\u987a\u5e8f\u5982\u4e0b\uff1a</p> <ol> <li>\u5927\u591a\u6570\u65b0\u521b\u5efa\u7684\u5bf9\u8c61\u90fd\u4f4d\u4e8e Eden \u7a7a\u95f4\u4e2d\u3002</li> <li>\u5728 Eden \u7a7a\u95f4\u4e2d\u8fdb\u884c\u4e00\u6b21 GC \u540e\uff0c\u5c06\u5e78\u5b58\u7684\u5bf9\u8c61\u79fb\u52a8\u5230 Survivor \u7a7a\u95f4\u4e4b\u4e00\u3002 </li> <li>\u5728 Eden \u7a7a\u95f4\u8fdb\u884c\u4e00\u6b21 GC \u540e\uff0c\u5bf9\u8c61\u88ab\u5806\u79ef\u5230 Survivor \u7a7a\u95f4\u4e2d\uff0c\u8be5\u7a7a\u95f4\u5df2\u7ecf\u5b58\u5728\u5176\u4ed6\u5e78\u5b58\u7684\u5bf9\u8c61\u3002</li> <li>\u4e00\u65e6 Survivor \u7a7a\u95f4\u5df2\u6ee1\uff0c\u5e78\u5b58\u7684\u5bf9\u8c61\u5c31\u4f1a\u79fb\u52a8\u5230\u53e6\u4e00\u4e2a Survivor \u7a7a\u95f4\u3002\u7136\u540e\uff0c\u5df2\u6ee1\u7684 Survivor \u7a7a\u95f4\u5c06\u53d8\u4e3a\u5b8c\u5168\u6ca1\u6709\u6570\u636e\u7684\u72b6\u6001\u3002</li> <li>\u5728\u91cd\u590d\u591a\u6b21\u7684\u8fd9\u4e9b\u6b65\u9aa4\u4e2d\u5e78\u5b58\u4e0b\u6765\u7684\u5bf9\u8c61\u88ab\u79fb\u52a8\u5230\u8001\u5e74\u4ee3\u3002</li> </ol> <p>\u901a\u8fc7\u68c0\u67e5\u8fd9\u4e9b\u6b65\u9aa4\u53ef\u4ee5\u770b\u5230\uff0c\u5e78\u5b58\u8005\u7a7a\u95f4\u4e4b\u4e00\u5fc5\u987b\u4fdd\u6301\u4e3a\u7a7a\u3002\u5982\u679c\u6570\u636e\u5728\u4e24\u4e2a Survivor \u7a7a\u95f4\u4e2d\u90fd\u5b58\u5728\uff0c\u6216\u8005\u4e24\u4e2a\u7a7a\u95f4\u7684\u4f7f\u7528\u91cf\u90fd\u4e3a 0\uff0c\u5219\u5c06\u5176\u89c6\u4e3a\u4f60\u7684\u7cfb\u7edf\u51fa\u73b0\u95ee\u9898\u7684\u6807\u5fd7\u3002</p> <p>\u6570\u636e\u901a\u8fc7minor GC\u5806\u79ef\u5230\u8001\u5e74\u4ee3\u7684\u8fc7\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u56fe 3\uff1aGC \u4e4b\u524d\u548c\u4e4b\u540e\u3002</p> <p>\u8bf7\u6ce8\u610f\uff0c\u5728 HotSpot VM \u4e2d\uff0c\u4f7f\u7528\u4e86\u4e24\u79cd\u6280\u672f\u6765\u5b9e\u73b0\u66f4\u5feb\u7684\u5185\u5b58\u5206\u914d\u3002\u4e00\u79cd\u79f0\u4e3a\u201cbump-the-pointer\u201d\uff0c\u53e6\u4e00\u79cd\u79f0\u4e3a\u201c TLAB\uff08\u7ebf\u7a0b\u672c\u5730\u5206\u914d\u7f13\u51b2\u533a\uff09\u201d\u3002 </p> <p>Bump-the-pointer \u6280\u672f\u8ddf\u8e2a\u5206\u914d\u7ed9 Eden \u7a7a\u95f4\u7684\u6700\u540e\u4e00\u4e2a\u5bf9\u8c61\u3002\u8be5\u7269\u4f53\u5c06\u4f4d\u4e8e\u4f0a\u7538\u56ed\u7a7a\u95f4\u7684\u9876\u90e8\u3002\u5982\u679c\u4e4b\u540e\u521b\u5efa\u4e86\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5b83\u53ea\u4f1a\u68c0\u67e5\u5bf9\u8c61\u7684\u5927\u5c0f\u662f\u5426\u9002\u5408 Eden \u7a7a\u95f4\u3002\u5982\u679c\u6240\u8ff0\u5bf9\u8c61\u770b\u8d77\u6765\u6b63\u786e\uff0c\u5b83\u5c06\u88ab\u653e\u7f6e\u5728\u4f0a\u7538\u56ed\u7a7a\u95f4\u4e2d\uff0c\u800c\u65b0\u5bf9\u8c61\u5c06\u653e\u5728\u6700\u4e0a\u9762\u3002\u56e0\u6b64\uff0c\u5f53\u521b\u5efa\u65b0\u5bf9\u8c61\u65f6\uff0c\u53ea\u9700\u8981\u68c0\u67e5\u6700\u540e\u6dfb\u52a0\u7684\u5bf9\u8c61\uff0c\u8fd9\u6837\u53ef\u4ee5\u66f4\u5feb\u5730\u5206\u914d\u5185\u5b58\u3002\u4f46\u662f\uff0c\u5982\u679c\u6211\u4eec\u8003\u8651\u591a\u7ebf\u7a0b\u73af\u5883\uff0c\u60c5\u51b5\u5c31\u4e0d\u540c\u4e86\u3002\u4e3a\u4e86\u5c06\u591a\u4e2a\u7ebf\u7a0b\u4f7f\u7528\u7684\u5bf9\u8c61\u4fdd\u5b58\u5728 Eden \u7a7a\u95f4\u4e2d\u7528\u4e8e Thread-Safe\uff0c\u4e0d\u53ef\u907f\u514d\u5730\u4f1a\u53d1\u751f\u9501\uff0c\u5e76\u4e14\u7531\u4e8e\u9501\u4e89\u7528\u800c\u5bfc\u81f4\u6027\u80fd\u4e0b\u964d\u3002 </p> <p>TLABs \u662f HotSpot VM \u4e2d\u6b64\u95ee\u9898\u7684\u89e3\u51b3\u65b9\u6848\u3002\u8fd9\u5141\u8bb8\u6bcf\u4e2a\u7ebf\u7a0b\u62e5\u6709\u4e00\u5c0f\u90e8\u5206\u5bf9\u5e94\u4e8e\u81ea\u5df1\u5171\u4eab\u7684 Eden \u7a7a\u95f4\u3002\u7531\u4e8e\u6bcf\u4e2a\u7ebf\u7a0b\u53ea\u80fd\u8bbf\u95ee\u81ea\u5df1\u7684 TLAB\uff0c\u56e0\u6b64\u5373\u4f7f\u662f\u6307\u9488\u78b0\u649e\u6280\u672f\u4e5f\u5141\u8bb8\u5728\u6ca1\u6709\u9501\u5b9a\u7684\u60c5\u51b5\u4e0b\u8fdb\u884c\u5185\u5b58\u5206\u914d\u3002 </p> <p>\u8fd9\u662f\u5bf9\u5e74\u8f7b\u4ee3 GC \u7684\u5feb\u901f\u6982\u89c8\u3002\u4f60\u4e0d\u4e00\u5b9a\u8981\u8bb0\u4f4f\u6211\u521a\u521a\u63d0\u5230\u7684\u4e24\u79cd\u6280\u672f\u3002\u4f60\u4e0d\u4f1a\u56e0\u4e3a\u4e0d\u8ba4\u8bc6\u4ed6\u4eec\u800c\u5165\u72f1\u3002\u4f46\u662f\u8bf7\u8bb0\u4f4f\uff0c\u5728Eden\u7a7a\u95f4\u9996\u5148\u521b\u5efa\u5bf9\u8c61\u4e4b\u540e\uff0c\u901a\u8fc7Survivor\u7a7a\u95f4\u5c06\u957f\u671f\u5b58\u6d3b\u7684\u5bf9\u8c61\u79fb\u52a8\u5230\u8001\u5e74\u4ee3\u3002</p>"},{"location":"java/%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8/#gc","title":"\u8001\u5e74\u4ee3GC","text":"<p>\u8001\u5e74\u4ee3\u57fa\u672c\u4e0a\u662f\u5728\u6570\u636e\u6ee1\u7684\u65f6\u5019\u8fdb\u884c\u4e00\u6b21GC\u3002\u6267\u884c\u8fc7\u7a0b\u56e0GC\u7c7b\u578b\u800c\u5f02\uff0c\u6240\u4ee5\u5982\u679c\u4f60\u4e86\u89e3\u4e0d\u540c\u7c7b\u578b\u7684GC\u4f1a\u66f4\u5bb9\u6613\u7406\u89e3\u3002 </p> <p>\u6839\u636e JDK 7\uff0c\u6709 5 \u79cd GC \u7c7b\u578b\u3002 </p> <ol> <li>\u4e32\u884c\u6c14\u76f8\u8272\u8c31</li> <li>\u5e76\u884cGC</li> <li>Parallel Old GC (Parallel Compacting GC)</li> <li>\u5e76\u53d1\u6807\u8bb0\u548c\u6e05\u9664 GC\uff08\u6216\u201cCMS\u201d\uff09</li> <li>\u5783\u573e\u4f18\u5148 (G1) GC</li> </ol> <p>\u5176\u4e2d\uff0c\u4e32\u884c GC \u4e0d\u5f97\u7528\u4e8e\u6b63\u5728\u8fd0\u884c\u7684\u670d\u52a1\u5668\u4e0a\u3002\u8fd9\u79cd GC \u7c7b\u578b\u662f\u5728\u53f0\u5f0f\u8ba1\u7b97\u673a\u4e0a\u53ea\u6709\u4e00\u4e2a CPU \u6838\u5fc3\u65f6\u521b\u5efa\u7684\u3002\u4f7f\u7528\u6b64\u4e32\u884c GC \u5c06\u663e\u7740\u964d\u4f4e\u5e94\u7528\u7a0b\u5e8f\u6027\u80fd\u3002 </p> <p>\u73b0\u5728\u8ba9\u6211\u4eec\u4e86\u89e3\u6bcf\u79cd GC \u7c7b\u578b\u3002</p>"},{"location":"java/%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8/#serial-gc-xxuseserialgc","title":"Serial GC (-XX:+UseSerialGC)","text":"<p>\u5e74\u8f7b\u4ee3\u4e2d\u7684 GC \u4f7f\u7528\u6211\u4eec\u5728\u4e0a\u4e00\u6bb5\u4e2d\u89e3\u91ca\u7684\u7c7b\u578b\u3002\u8001\u5e74\u4ee3\u7684 GC \u4f7f\u7528\u4e86\u4e00\u79cd\u53eb\u505a\u201c mark-sweep-compact \u201d\u7684\u7b97\u6cd5\u3002</p> <ol> <li>\u8be5\u7b97\u6cd5\u7684\u7b2c\u4e00\u6b65\u662f\u6807\u8bb0\u8001\u5e74\u4ee3\u5e78\u5b58\u7684\u5bf9\u8c61\u3002</li> <li>\u7136\u540e\uff0c\u5b83\u4ece\u524d\u9762\u68c0\u67e5\u5806\uff0c\u53ea\u7559\u4e0b\u5e78\u5b58\u7684\u5806\uff08\u626b\u63cf\uff09\u3002</li> <li>\u5728\u6700\u540e\u4e00\u6b65\uff0c\u5b83\u4ece\u524d\u9762\u7528\u5bf9\u8c61\u586b\u5145\u5806\uff0c\u4f7f\u5bf9\u8c61\u8fde\u7eed\u5806\u79ef\uff0c\u5e76\u5c06\u5806\u5206\u6210\u4e24\u90e8\u5206\uff1a\u6709\u5bf9\u8c61\u7684\u90e8\u5206\u548c\u6ca1\u6709\u5bf9\u8c61\u7684\u90e8\u5206\uff08\u7d27\u51d1\uff09\u3002</li> </ol> <p>\u4e32\u884cGC\u9002\u7528\u4e8e\u5c0f\u5185\u5b58\u548c\u5c11\u91cfCPU\u5185\u6838\u3002</p>"},{"location":"java/%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8/#parallel-gc-xxuseparallelgc","title":"Parallel GC (-XX:+UseParallelGC)","text":"<p>\u56fe 4\uff1a\u4e32\u884c GC \u548c\u5e76\u884c GC \u4e4b\u95f4\u7684\u533a\u522b\u3002</p> <p>\u4ece\u56fe\u4e2d\u53ef\u4ee5\u5f88\u5bb9\u6613\u770b\u51fa\u4e32\u884cGC\u548c\u5e76\u884cGC\u7684\u533a\u522b\u3002\u4e32\u884c GC \u4ec5\u4f7f\u7528\u4e00\u4e2a\u7ebf\u7a0b\u6765\u5904\u7406 GC\uff0c\u800c\u5e76\u884c GC \u4f7f\u7528\u591a\u4e2a\u7ebf\u7a0b\u6765\u5904\u7406 GC\uff0c\u56e0\u6b64\u901f\u5ea6\u66f4\u5feb\u3002\u5f53\u6709\u8db3\u591f\u7684\u5185\u5b58\u548c\u5927\u91cf\u5185\u6838\u65f6\uff0c\u6b64 GC \u5f88\u6709\u7528\u3002\u5b83\u4e5f\u88ab\u79f0\u4e3a\u201c\u541e\u5410\u91cf GC\u201d\u3002 </p>"},{"location":"java/%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8/#parallel-old-gc-xxuseparalleloldgc","title":"Parallel Old GC(-XX:+UseParallelOldGC)","text":"<p>\u81ea JDK 5 \u66f4\u65b0\u4ee5\u6765\uff0c\u652f\u6301 Parallel Old GC\u3002\u4e0e\u5e76\u884c GC \u76f8\u6bd4\uff0c\u552f\u4e00\u7684\u533a\u522b\u662f\u8001\u5e74\u4ee3\u7684 GC \u7b97\u6cd5\u3002\u5b83\u7ecf\u5386\u4e86\u4e09\u4e2a\u6b65\u9aa4\uff1a\u6807\u8bb0 - \u6458\u8981 - \u538b\u7f29\u3002\u6c47\u603b\u6b65\u9aa4\u9488\u5bf9 GC \u5148\u524d\u6267\u884c\u8fc7\u7684\u533a\u57df\u5206\u522b\u8bc6\u522b\u5e78\u5b58\u5bf9\u8c61\uff0c\u56e0\u6b64\u4e0d\u540c\u4e8e\u6807\u8bb0-\u626b\u63cf-\u538b\u7f29\u7b97\u6cd5\u7684\u626b\u63cf\u6b65\u9aa4\u3002\u5b83\u7ecf\u5386\u4e86\u66f4\u590d\u6742\u7684\u6b65\u9aa4\u3002</p>"},{"location":"java/%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8/#cms-gc-xxuseconcmarksweepgc","title":"CMS GC (-XX:+UseConcMarkSweepGC)","text":"<p>\u56fe 5\uff1a\u4e32\u884c GC \u548c CMS GC\u3002</p> <p>\u4ece\u56fe\u4e2d\u53ef\u4ee5\u770b\u51fa\uff0cConcurrent Mark-Sweep GC \u6bd4\u6211\u8fc4\u4eca\u4e3a\u6b62\u89e3\u91ca\u7684\u4efb\u4f55\u5176\u4ed6 GC \u7c7b\u578b\u90fd\u8981\u590d\u6742\u5f97\u591a\u3002\u65e9\u671f\u7684\u521d\u59cb\u6807\u8bb0\u6b65\u9aa4\u5f88\u7b80\u5355\u3002\u5728\u6700\u63a5\u8fd1\u7c7b\u52a0\u8f7d\u5668\u7684\u5bf9\u8c61\u4e2d\u641c\u7d22\u5e78\u5b58\u7684\u5bf9\u8c61\u3002\u6240\u4ee5\uff0c\u6682\u505c\u65f6\u95f4\u5f88\u77ed\u3002\u5728\u5e76\u53d1\u6807\u8bb0\u6b65\u9aa4\u4e2d\uff0c\u5bf9\u521a\u521a\u786e\u8ba4\u7684\u5e78\u5b58\u5bf9\u8c61\u6240\u5f15\u7528\u7684\u5bf9\u8c61\u8fdb\u884c\u8ddf\u8e2a\u548c\u68c0\u67e5\u3002\u8fd9\u4e00\u6b65\u7684\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\u5b83\u5728\u5904\u7406\u5176\u4ed6\u7ebf\u7a0b\u7684\u540c\u65f6\u8fdb\u884c\u3002\u5728remark\u6b65\u9aa4\u4e2d\uff0c\u68c0\u67e5\u5e76\u53d1\u6807\u8bb0\u6b65\u9aa4\u4e2d\u65b0\u6dfb\u52a0\u6216\u505c\u6b62\u5f15\u7528\u7684\u5bf9\u8c61\u3002\u6700\u540e\uff0c\u5728\u5e76\u53d1\u626b\u63cf\u4e2d\u6b65\u9aa4\uff0c\u5783\u573e\u6536\u96c6\u7a0b\u5e8f\u53d1\u751f\u3002\u5728\u5176\u4ed6\u7ebf\u7a0b\u4ecd\u5728\u5904\u7406\u4e2d\u65f6\u6267\u884c\u5783\u573e\u6536\u96c6\u3002\u7531\u4e8e\u8fd9\u79cdGC\u7c7b\u578b\u4ee5\u8fd9\u79cd\u65b9\u5f0f\u6267\u884c\uff0c\u56e0\u6b64GC\u7684\u6682\u505c\u65f6\u95f4\u975e\u5e38\u77ed\u3002CMS GC \u4e5f\u79f0\u4e3a\u4f4e\u5ef6\u8fdf GC\uff0c\u5728\u6240\u6709\u5e94\u7528\u7a0b\u5e8f\u7684\u54cd\u5e94\u65f6\u95f4\u81f3\u5173\u91cd\u8981\u65f6\u4f7f\u7528\u3002 </p> <p>\u867d\u7136\u8fd9\u79cd GC \u7c7b\u578b\u5177\u6709\u505c\u6b62\u4e16\u754c\u65f6\u95f4\u77ed\u7684\u4f18\u70b9\uff0c\u4f46\u5b83\u4e5f\u6709\u4ee5\u4e0b\u7f3a\u70b9\u3002</p> <ul> <li>\u5b83\u6bd4\u5176\u4ed6 GC \u7c7b\u578b\u4f7f\u7528\u66f4\u591a\u7684\u5185\u5b58\u548c CPU\u3002</li> <li>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e0d\u63d0\u4f9b\u538b\u7f29\u6b65\u9aa4\u3002</li> </ul> <p>\u5728\u4f7f\u7528\u8fd9\u79cd\u7c7b\u578b\u4e4b\u524d\uff0c\u4f60\u9700\u8981\u4ed4\u7ec6\u68c0\u67e5\u3002\u6b64\u5916\uff0c\u5982\u679c\u7531\u4e8e\u5185\u5b58\u788e\u7247\u5f88\u591a\u800c\u9700\u8981\u6267\u884c\u538b\u7f29\u4efb\u52a1\uff0c\u5219 stop-the-world \u65f6\u95f4\u53ef\u80fd\u6bd4\u4efb\u4f55\u5176\u4ed6 GC \u7c7b\u578b\u90fd\u957f\u3002\u4f60\u9700\u8981\u68c0\u67e5\u6267\u884c\u538b\u7f29\u4efb\u52a1\u7684\u9891\u7387\u548c\u65f6\u95f4\u3002</p>"},{"location":"java/%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3%20Java%20%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8/#g1-gc","title":"G1 GC","text":"<p>\u6700\u540e\uff0c\u8ba9\u6211\u4eec\u4e86\u89e3\u4e00\u4e0b\u5783\u573e\u4f18\u5148\uff08G1\uff09GC\u3002 </p> <p></p> <p>\u56fe 6\uff1aG1 GC \u7684\u5e03\u5c40\u3002</p> <p>\u5982\u679c\u4f60\u60f3\u4e86\u89e3 G1 GC\uff0c\u5fd8\u8bb0\u4f60\u6240\u77e5\u9053\u7684\u5173\u4e8e\u5e74\u8f7b\u4ee3\u548c\u5e74\u8001\u4ee3\u7684\u4e00\u5207\u3002\u5982\u56fe\u6240\u793a\uff0c\u6bcf\u4e2a\u7f51\u683c\u5206\u914d\u4e00\u4e2a\u5bf9\u8c61\uff0c\u7136\u540e\u6267\u884c\u4e00\u6b21GC\u3002\u7136\u540e\uff0c\u4e00\u65e6\u4e00\u4e2a\u533a\u57df\u5df2\u6ee1\uff0c\u5c06\u5bf9\u8c61\u5206\u914d\u5230\u53e6\u4e00\u4e2a\u533a\u57df\uff0c\u7136\u540e\u6267\u884c GC\u3002\u6570\u636e\u4ece\u5e74\u8f7b\u4ee3\u4e09\u4e2a\u7a7a\u95f4\u79fb\u52a8\u5230\u8001\u5e74\u4ee3\u7684\u6b65\u9aa4\u5728\u8fd9\u79cdGC\u7c7b\u578b\u4e2d\u662f\u627e\u4e0d\u5230\u7684\u3002\u521b\u5efa\u8fd9\u79cd\u7c7b\u578b\u662f\u4e3a\u4e86\u53d6\u4ee3 CMS GC\uff0c\u4ece\u957f\u8fdc\u6765\u770b\uff0c\u5b83\u4f1a\u5f15\u8d77\u5f88\u591a\u95ee\u9898\u548c\u62b1\u6028\u3002G1 GC \u7684\u6700\u5927\u4f18\u52bf\u5728\u4e8e\u5176\u6027\u80fd\u3002\u5b83\u6bd4\u6211\u4eec\u76ee\u524d\u8ba8\u8bba\u7684\u4efb\u4f55\u5176\u4ed6 GC \u7c7b\u578b\u90fd\u5feb\u3002</p> <p>\u53c2\u8003\u6587\u6863\uff1a</p> <p>https://www.cubrid.org/blog/3826410</p>"},{"location":"java/%E9%98%85%E8%AF%BB%E9%98%BF%E9%87%8CJava%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C%E8%AE%B0%E5%BD%95/","title":"\u9605\u8bfb\u963f\u91ccJava\u5f00\u53d1\u624b\u518c\u8bb0\u5f55","text":""},{"location":"java/%E9%98%85%E8%AF%BB%E9%98%BF%E9%87%8CJava%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C%E8%AE%B0%E5%BD%95/#_1","title":"\u4e00. \u6982\u8ff0","text":"<p>\u5728\u9605\u8bfb\u5b8c\u963f\u91ccJava\u5f00\u53d1\u624b\u518c(\u5d69\u5c71\u7248)\u540e\uff0c\u53d1\u73b0\u81ea\u5df1\u5728\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u6709\u4e00\u4e9b\u6ca1\u6709\u6309\u7167\u89c4\u8303\u5f00\u53d1\u7684\u60c5\u51b5\uff0c\u8fd9\u91cc\u5c06\u5bb9\u6613\u5fd8\u8bb0\u7684\u89c4\u8303\u8bb0\u5f55\u4e0b\u6765\uff0c\u5e76\u4e14\u6dfb\u52a0\u81ea\u5df1\u7684\u7406\u89e3\uff0c\u4e00\u65b9\u9762\u65b9\u4fbf\u81ea\u5df1\u5de9\u56fa\u8bb0\u5fc6\uff0c\u53e6\u4e00\u65b9\u9762\u5e0c\u671b\u5bf9\u5176\u4ed6\u540c\u5b66\u80fd\u591f\u63d0\u4f9b\u4e00\u4e0b\u5e2e\u52a9\u3002\u8fd9\u91cc\u5c06\u6536\u96c6\u7684\u963f\u91ccJava\u5f00\u53d1\u624b\u518c\u6587\u6863\u653e\u5728\u4e86 github \u4ed3\u5e93\uff0c\u66f4\u591a\u8be6\u7ec6\u5185\u5bb9\u53ef\u4ee5\u4e0b\u8f7d\u6587\u6863\u67e5\u770b\u3002</p>"},{"location":"java/%E9%98%85%E8%AF%BB%E9%98%BF%E9%87%8CJava%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C%E8%AE%B0%E5%BD%95/#_2","title":"\u7f16\u7a0b\u89c4\u7ea6","text":"<ol> <li> <p>\u3010\u5f3a\u5236\u3011  \u62bd\u8c61\u7c7b\u547d\u540d\u4f7f\u7528 Abstract \u6216 Base \u5f00\u5934\uff1b\u5f02\u5e38\u7c7b\u547d\u540d\u4f7f\u7528 Exception \u7ed3\u5c3e\uff1b\u6d4b\u8bd5\u7c7b \u547d\u540d\u4ee5\u5b83\u8981\u6d4b\u8bd5\u7684\u7c7b\u7684\u540d\u79f0\u5f00\u59cb\uff0c\u4ee5 Test \u7ed3\u5c3e\u3002</p> </li> <li> <p>\u3010\u5f3a\u5236\u3011 <code>POJO</code> \u7c7b\u4e2d\u7684\u4efb\u4f55\u5e03\u5c14\u7c7b\u578b\u7684\u53d8\u91cf\uff0c\u90fd\u4e0d\u8981\u52a0 is \u524d\u7f00\uff0c\u5426\u5219\u90e8\u5206\u6846\u67b6\u89e3\u6790\u4f1a\u5f15\u8d77\u5e8f\u5217 \u5316\u9519\u8bef\u3002 </p> </li> </ol> <p>\u8bf4\u660e\uff1a \u5728\u672c\u6587 <code>MySQL</code> \u89c4\u7ea6\u4e2d\u7684\u5efa\u8868\u7ea6\u5b9a\u7b2c\u4e00\u6761\uff0c\u8868\u8fbe\u662f\u4e0e\u5426\u7684\u53d8\u91cf\u91c7\u7528 <code>is_xxx</code> \u7684\u547d\u540d\u65b9\u5f0f\uff0c\u6240\u4ee5\u9700\u8981\u5728 <code>&lt;resultMap&gt;</code> \u8bbe\u7f6e\u4ece <code>is_xxx</code> \u5230 <code>xxx</code> \u7684\u6620\u5c04\u5173\u7cfb\u3002</p> <p>\u53cd\u4f8b\uff1a \u5b9a\u4e49\u4e3a\u57fa\u672c\u6570\u636e\u7c7b\u578b Boolean <code>isDeleted</code> \u7684\u5c5e\u6027\uff0c\u5b83\u7684\u65b9\u6cd5\u4e5f\u662f <code>isDeleted()</code>\uff0c\u6846\u67b6\u5728\u53cd\u5411\u89e3\u6790\u7684\u65f6 \u5019\uff0c\u201c\u8bef\u4ee5\u4e3a\u201d\u5bf9\u5e94\u7684\u5c5e\u6027\u540d\u79f0\u662f deleted\uff0c\u5bfc\u81f4\u5c5e\u6027\u83b7\u53d6\u4e0d\u5230\uff0c\u8fdb\u800c\u629b\u51fa\u5f02\u5e38\u3002</p> <ol> <li>\u3010\u63a8\u8350\u3011\u5982\u679c\u6a21\u5757\u3001\u63a5\u53e3\u3001\u7c7b\u3001\u65b9\u6cd5\u4f7f\u7528\u4e86\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u5728\u547d\u540d\u65f6\u9700\u4f53\u73b0\u51fa\u5177\u4f53\u6a21\u5f0f\u3002</li> </ol> <p>\u8bf4\u660e\uff1a\u5c06\u8bbe\u8ba1\u6a21\u5f0f\u4f53\u73b0\u5728\u540d\u5b57\u4e2d\uff0c\u6709\u5229\u4e8e\u9605\u8bfb\u8005\u5feb\u901f\u7406\u89e3\u67b6\u6784\u8bbe\u8ba1\u7406\u5ff5\u3002\u4f8b\u5982\u4f7f\u7528\u4e86\u4ee3\u7406\u6a21\u5f0f\u53ef\u4ee5\u547d\u540d\u4e3a\uff1a<code>public class LoginProxy;</code></p> <ol> <li>\u3010\u63a8\u8350\u3011\u679a\u4e3e\u7c7b\u540d\u5e26\u4e0a <code>Enum</code> \u540e\u7f00\uff0c\u679a\u4e3e\u6210\u5458\u540d\u79f0\u9700\u8981\u5168\u5927\u5199\uff0c\u5355\u8bcd\u95f4\u7528\u4e0b\u5212\u7ebf\u9694\u5f00\u3002</li> </ol> <p>\u8bf4\u660e\uff1a\u679a\u4e3e\u5176\u5b9e\u5c31\u662f\u7279\u6b8a\u7684\u5e38\u91cf\u7c7b\uff0c\u4e14\u6784\u9020\u65b9\u6cd5\u88ab\u9ed8\u8ba4\u5f3a\u5236\u662f\u79c1\u6709\u3002</p> <ol> <li> <p>\u3010\u5f3a\u5236\u3011 \u4e0d\u5141\u8bb8\u4efb\u4f55\u9b54\u6cd5\u503c\uff08\u5373\u672a\u7ecf\u9884\u5148\u5b9a\u4e49\u7684\u5e38\u91cf\uff09\u76f4\u63a5\u51fa\u73b0\u5728\u4ee3\u7801\u4e2d\u3002</p> </li> <li> <p>\u3010\u5f3a\u5236\u3011 \u91c7\u7528 4 \u4e2a\u7a7a\u683c\u7f29\u8fdb\uff0c\u7981\u6b62\u4f7f\u7528 Tab \u5b57\u7b26\u3002</p> </li> </ol> <p>\u8bf4\u660e\uff1a\u5982\u679c\u4f7f\u7528 Tab \u7f29\u8fdb\uff0c\u5fc5\u987b\u8bbe\u7f6e 1 \u4e2a Tab \u4e3a 4 \u4e2a\u7a7a\u683c\u3002IDEA \u8bbe\u7f6e Tab \u4e3a 4 \u4e2a\u7a7a\u683c\u65f6\uff0c\u8bf7\u52ff\u52fe\u9009 Use tab character\uff1b\u800c\u5728 Eclipse \u4e2d\uff0c\u5fc5\u987b\u52fe\u9009 insert spaces for tabs\u3002</p> <ol> <li> <p>\u3010\u5f3a\u5236\u3011 \u907f\u514d\u901a\u8fc7\u4e00\u4e2a\u7c7b\u7684\u5bf9\u8c61\u5f15\u7528\u8bbf\u95ee\u6b64\u7c7b\u7684\u9759\u6001\u53d8\u91cf\u6216\u9759\u6001\u65b9\u6cd5\uff0c\u65e0\u8c13\u589e\u52a0\u7f16\u8bd1\u5668\u89e3\u6790\u6210 \u672c\uff0c\u76f4\u63a5\u7528<code>\u7c7b\u540d.\u9759\u6001\u5c5e\u6027\u6216\u9759\u6001\u65b9\u6cd5</code>\u6765\u8bbf\u95ee\u5373\u53ef\u3002</p> </li> <li> <p>\u3010\u5f3a\u5236\u3011 Object \u7684 equals \u65b9\u6cd5\u5bb9\u6613\u629b\u7a7a\u6307\u9488\u5f02\u5e38\uff0c\u5e94\u4f7f\u7528\u5e38\u91cf\u6216\u786e\u5b9a\u6709\u503c\u7684\u5bf9\u8c61\u6765\u8c03\u7528 equals\u3002</p> </li> </ol> <p>\u8bf4\u660e\uff1a\u63a8\u8350\u4f7f\u7528 <code>JDK7</code> \u5f15\u5165\u7684\u5de5\u5177\u7c7b <code>java.util.Objects.equals(Object a, Object b)</code>\uff0c\u6b64\u65b9\u6cd5\u7684\u5185\u90e8\u5b9e\u73b0\u4e3a\uff1a<code>return (a == b) || (a != null &amp;&amp; a.equals(b));</code></p> <ol> <li>\u5173\u4e8e\u57fa\u672c\u6570\u636e\u7c7b\u578b\u4e0e\u5305\u88c5\u6570\u636e\u7c7b\u578b\u7684\u4f7f\u7528\u6807\u51c6\u5982\u4e0b\uff1a</li> </ol> <p>1)\u3010\u5f3a\u5236\u3011 \u6240\u6709\u7684 POJO \u7c7b\u5c5e\u6027\u5fc5\u987b\u4f7f\u7528\u5305\u88c5\u6570\u636e\u7c7b\u578b\u3002</p> <p>2)\u3010\u5f3a\u5236\u3011 RPC \u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u548c\u53c2\u6570\u5fc5\u987b\u4f7f\u7528\u5305\u88c5\u6570\u636e\u7c7b\u578b\u3002</p> <p>3)\u3010\u63a8\u8350\u3011\u6240\u6709\u7684\u5c40\u90e8\u53d8\u91cf\u4f7f\u7528\u57fa\u672c\u6570\u636e\u7c7b\u578b\u3002</p> <p>\u8bf4\u660e\uff1aPOJO \u7c7b\u5c5e\u6027\u6ca1\u6709\u521d\u503c\u662f\u63d0\u9192\u4f7f\u7528\u8005\u5728\u9700\u8981\u4f7f\u7528\u65f6\uff0c\u5fc5\u987b\u81ea\u5df1\u663e\u5f0f\u5730\u8fdb\u884c\u8d4b\u503c\uff0c\u4efb\u4f55 NPE \u95ee\u9898\uff0c\u6216 \u8005\u5165\u5e93\u68c0\u67e5\uff0c\u90fd\u7531\u4f7f\u7528\u8005\u6765\u4fdd\u8bc1\u3002\u6570\u636e\u5e93\u7684\u67e5\u8be2\u7ed3\u679c\u53ef\u80fd\u662f null\uff0c\u56e0\u4e3a\u81ea\u52a8\u62c6\u7bb1\uff0c\u7528\u57fa\u672c\u6570\u636e\u7c7b\u578b\u63a5\u6536\u6709 NPE \u98ce\u9669\u3002</p> <ol> <li> <p>\u3010\u5f3a\u5236\u3011 \u5b9a\u4e49 DO/DTO/VO \u7b49 POJO \u7c7b\u65f6\uff0c\u4e0d\u8981\u8bbe\u5b9a\u4efb\u4f55\u5c5e\u6027\u9ed8\u8ba4\u503c\u3002</p> </li> <li> <p>.\u3010\u5f3a\u5236\u3011 \u6784\u9020\u65b9\u6cd5\u91cc\u9762\u7981\u6b62\u52a0\u5165\u4efb\u4f55\u4e1a\u52a1\u903b\u8f91\uff0c\u5982\u679c\u6709\u521d\u59cb\u5316\u903b\u8f91\uff0c\u8bf7\u653e\u5728 <code>init</code> \u65b9\u6cd5\u4e2d\u3002</p> </li> <li> <p>\u3010\u5f3a\u5236\u3011 POJO \u7c7b\u5fc5\u987b\u5199 toString \u65b9\u6cd5\u3002\u4f7f\u7528 IDE \u4e2d\u7684\u5de5\u5177\uff1a<code>source&gt; generate toString</code> \u65f6\uff0c\u5982\u679c\u7ee7\u627f\u4e86\u53e6\u4e00\u4e2a POJO \u7c7b\uff0c\u6ce8\u610f\u5728\u524d\u9762\u52a0\u4e00\u4e0b <code>super.toString()</code>\u3002</p> <p>\u8bf4\u660e\uff1a\u5728\u65b9\u6cd5\u6267\u884c\u629b\u51fa\u5f02\u5e38\u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528 POJO \u7684 toString()\u65b9\u6cd5\u6253\u5370\u5176\u5c5e\u6027\u503c\uff0c\u4fbf\u4e8e\u6392\u67e5\u95ee\u9898\u3002</p> </li> <li> <p>\u3010\u63a8\u8350\u3011\u614e\u7528 Object \u7684 clone \u65b9\u6cd5\u6765\u62f7\u8d1d\u5bf9\u8c61\u3002</p> <p>\u8bf4\u660e\uff1a\u5bf9\u8c61 clone \u65b9\u6cd5\u9ed8\u8ba4\u662f\u6d45\u62f7\u8d1d\uff0c\u82e5\u60f3\u5b9e\u73b0\u6df1\u62f7\u8d1d\uff0c\u9700\u8986\u5199 clone \u65b9\u6cd5\u5b9e\u73b0\u57df\u5bf9\u8c61\u7684\u6df1\u5ea6\u904d\u5386\u5f0f\u62f7\u8d1d\u3002</p> </li> <li> <p>\u3010\u5f3a\u5236\u3011 \u83b7\u53d6\u5f53\u524d\u6beb\u79d2\u6570\uff1a<code>System.currentTimeMillis();</code> \u800c\u4e0d\u662f <code>new Date().getTime()</code>\u3002</p> <p>\u8bf4\u660e\uff1a\u5982\u679c\u60f3\u83b7\u53d6\u66f4\u52a0\u7cbe\u786e\u7684\u7eb3\u79d2\u7ea7\u65f6\u95f4\u503c\uff0c\u4f7f\u7528 <code>System.nanoTime()</code> \u7684\u65b9\u5f0f\u3002\u5728 JDK8 \u4e2d\uff0c\u9488\u5bf9\u7edf\u8ba1\u65f6\u95f4\u7b49\u573a\u666f\uff0c\u63a8\u8350\u4f7f\u7528 Instant \u7c7b\u3002</p> </li> <li> <p>\u3010\u63a8\u8350\u3011\u524d\u540e\u7aef\u7684\u65f6\u95f4\u683c\u5f0f\u7edf\u4e00\u4e3a<code>\"yyyy-MM-dd HH:mm:ss\"</code>\uff0c\u7edf\u4e00\u4e3a GMT\u3002</p> </li> <li> <p>\u3010\u5f3a\u5236\u3011 \u5728\u524d\u540e\u7aef\u4ea4\u4e92\u7684 <code>JSON</code> \u683c\u5f0f\u6570\u636e\u4e2d\uff0c\u6240\u6709\u7684 key \u5fc5\u987b\u4e3a\u5c0f\u5199\u5b57\u6bcd\u5f00\u59cb\u7684 <code>lowerCamelCase</code> \u98ce\u683c\uff0c\u7b26\u5408\u82f1\u6587\u8868\u8fbe\u4e60\u60ef\uff0c\u4e14\u8868\u610f\u5b8c\u6574\u3002</p> <p>\u6b63\u4f8b\uff1aerrorCode / errorMessage / assetStatus / menuList / orderList / configFlag</p> </li> </ol>"},{"location":"java/%E9%98%85%E8%AF%BB%E9%98%BF%E9%87%8CJava%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C%E8%AE%B0%E5%BD%95/#_3","title":"\u96c6\u5408\u5904\u7406","text":"<ol> <li>\u3010\u5f3a\u5236\u3011  \u53ea\u8981\u8986\u5199 <code>equals</code>\uff0c\u5c31\u5fc5\u987b\u8986\u5199 <code>hashCode</code>\u3002</li> </ol> <p>\u8bf4\u660e\uff1aString \u56e0\u4e3a\u8986\u5199\u4e86 <code>hashCode</code> \u548c <code>equals</code> \u65b9\u6cd5\uff0c\u6240\u4ee5\u53ef\u4ee5\u6109\u5feb\u5730\u5c06 <code>String</code> \u5bf9\u8c61\u4f5c\u4e3a Map \u7684 key \u6765\u4f7f\u7528\u3002</p> <ol> <li>\u3010\u5f3a\u5236\u3011 \u5224\u65ad\u6240\u6709\u96c6\u5408\u5185\u90e8\u7684\u5143\u7d20\u662f\u5426\u4e3a\u7a7a\uff0c\u4f7f\u7528 <code>isEmpty()</code> \u65b9\u6cd5\uff0c\u800c\u4e0d\u662f <code>size()==0</code> \u7684\u65b9\u5f0f\u3002</li> </ol> <p>\u8bf4\u660e\uff1a\u5728\u67d0\u4e9b\u96c6\u5408\u4e2d\uff0c\u524d\u8005\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(1)\uff0c\u800c\u4e14\u53ef\u8bfb\u6027\u66f4\u597d\u3002</p> <ol> <li>\u3010\u5f3a\u5236\u3011 \u4f7f\u7528\u96c6\u5408\u8f6c\u6570\u7ec4\u7684\u65b9\u6cd5\uff0c\u5fc5\u987b\u4f7f\u7528\u96c6\u5408\u7684 <code>toArray(T[] array)</code>\u65b9\u6cd5\uff0c\u4f20\u5165\u7684\u662f\u7c7b\u578b\u5b8c\u5168\u4e00\u81f4\u3001\u957f\u5ea6\u4e3a 0 \u7684\u7a7a\u6570\u7ec4\u3002</li> </ol> <p>\u8bf4\u660e\uff1a\u76f4\u63a5\u4f7f\u7528 <code>toArray()</code> \u65e0\u53c2\u65b9\u6cd5\u5b58\u5728\u95ee\u9898\uff0c\u6b64\u65b9\u6cd5\u8fd4\u56de\u503c\u53ea\u80fd\u662f <code>Object[]</code> \u7c7b\uff0c\u82e5\u5f3a\u8f6c\u5176\u5b83\u7c7b\u578b\u6570\u7ec4\u5c06\u51fa\u73b0 <code>ClassCastException</code> \u9519\u8bef\u3002\u6b63\u4f8b\uff1a<code>String[] array = list.toArray(new String[0]);</code></p> <ol> <li>\u3010\u5f3a\u5236\u3011 \u4f7f\u7528\u5de5\u5177\u7c7b <code>Arrays.asList()</code> \u628a\u6570\u7ec4\u8f6c\u6362\u6210\u96c6\u5408\u65f6\uff0c\u4e0d\u80fd\u4f7f\u7528\u5176\u4fee\u6539\u96c6\u5408\u76f8\u5173\u7684\u65b9\u6cd5\uff0c \u5b83\u7684 <code>add/remove/clear</code> \u65b9\u6cd5\u4f1a\u629b\u51fa <code>UnsupportedOperationException</code> \u5f02\u5e38\u3002</li> </ol> <p>\u8bf4\u660e\uff1a<code>asList()</code> \u7684\u8fd4\u56de\u5bf9\u8c61\u662f\u4e00\u4e2a <code>Arrays</code> \u5185\u90e8\u7c7b\uff0c\u5e76\u6ca1\u6709\u5b9e\u73b0\u96c6\u5408\u7684\u4fee\u6539\u65b9\u6cd5\u3002<code>Arrays.asList</code> \u4f53\u73b0\u7684\u662f\u9002\u914d\u5668\u6a21\u5f0f\uff0c\u53ea\u662f\u8f6c\u6362\u63a5\u53e3\uff0c\u540e\u53f0\u7684\u6570\u636e\u4ecd\u662f\u6570\u7ec4\u3002</p> <ol> <li> <p>\u3010\u5f3a\u5236\u3011 \u4e0d\u8981\u5728 <code>foreach</code> \u5faa\u73af\u91cc\u8fdb\u884c\u5143\u7d20\u7684 <code>remove/add</code> \u64cd\u4f5c\u3002<code>remove</code> \u5143\u7d20\u8bf7\u4f7f\u7528 <code>Iterator</code> \u65b9\u5f0f\uff0c\u5982\u679c\u5e76\u53d1\u64cd\u4f5c\uff0c\u9700\u8981\u5bf9 <code>Iterator</code> \u5bf9\u8c61\u52a0\u9501\u3002</p> </li> <li> <p>.\u3010\u63a8\u8350\u3011\u9ad8\u5ea6\u6ce8\u610f Map \u7c7b\u96c6\u5408 K/V \u80fd\u4e0d\u80fd\u5b58\u50a8 null \u503c\u7684\u60c5\u51b5\uff0c\u5982\u4e0b\u8868\u683c\uff1a</p> </li> </ol> \u96c6\u5408\u7c7b key\uff08\u952e\uff09 value\uff08\u503c\uff09 super\uff08\u7236\u7c7b\uff09 \u8bf4\u660e Hashtable \u4e0d\u5141\u8bb8\u4e3a null \u4e0d\u5141\u8bb8\u4e3a null Dictionary \u7ebf\u7a0b\u5b89\u5168 ConcurrentHashMap \u4e0d\u5141\u8bb8\u4e3a null \u4e0d\u5141\u8bb8\u4e3a null AbstractMap \u7ebf\u7a0b\u5b89\u5168\uff0c\u9501\u5206\u6bb5\uff08jdk8:CAS\uff09 TreeMap \u4e0d\u5141\u8bb8\u4e3a null \u5141\u8bb8\u4e3a null AbstractMap \u7ebf\u7a0b\u4e0d\u5b89\u5168 HashMap \u5141\u8bb8\u4e3a null \u5141\u8bb8\u4e3a null AbstractMap \u7ebf\u7a0b\u4e0d\u5b89\u5168 <p>\u53cd\u4f8b\uff1a\u7531\u4e8e HashMap \u7684\u5e72\u6270\uff0c\u5f88\u591a\u4eba\u8ba4\u4e3a ConcurrentHashMap \u662f\u53ef\u4ee5\u7f6e\u5165 null \u503c\uff0c\u800c\u4e8b\u5b9e\u4e0a\uff0c\u5b58\u50a8 null \u503c\u65f6\u4f1a\u629b\u51fa NPE \u5f02\u5e38\u3002</p>"},{"location":"java/%E9%98%85%E8%AF%BB%E9%98%BF%E9%87%8CJava%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C%E8%AE%B0%E5%BD%95/#_4","title":"\u5e76\u53d1\u5904\u7406","text":"<ol> <li> <p>\u3010\u5f3a\u5236\u3011 \u521b\u5efa\u7ebf\u7a0b\u6216\u7ebf\u7a0b\u6c60\u65f6\u8bf7\u6307\u5b9a\u6709\u610f\u4e49\u7684\u7ebf\u7a0b\u540d\u79f0\uff0c\u65b9\u4fbf\u51fa\u9519\u65f6\u56de\u6eaf\u3002</p> </li> <li> <p>\u3010\u5f3a\u5236\u3011 \u7ebf\u7a0b\u8d44\u6e90\u5fc5\u987b\u901a\u8fc7\u7ebf\u7a0b\u6c60\u63d0\u4f9b\uff0c\u4e0d\u5141\u8bb8\u5728\u5e94\u7528\u4e2d\u81ea\u884c\u663e\u5f0f\u521b\u5efa\u7ebf\u7a0b\u3002</p> </li> </ol> <p>\u8bf4\u660e\uff1a\u7ebf\u7a0b\u6c60\u7684\u597d\u5904\u662f\u51cf\u5c11\u5728\u521b\u5efa\u548c\u9500\u6bc1\u7ebf\u7a0b\u4e0a\u6240\u6d88\u8017\u7684\u65f6\u95f4\u4ee5\u53ca\u7cfb\u7edf\u8d44\u6e90\u7684\u5f00\u9500\uff0c\u89e3\u51b3\u8d44\u6e90\u4e0d\u8db3\u7684\u95ee\u9898\u3002 \u5982\u679c\u4e0d\u4f7f\u7528\u7ebf\u7a0b\u6c60\uff0c\u6709\u53ef\u80fd\u9020\u6210\u7cfb\u7edf\u521b\u5efa\u5927\u91cf\u540c\u7c7b\u7ebf\u7a0b\u800c\u5bfc\u81f4\u6d88\u8017\u5b8c\u5185\u5b58\u6216\u8005\u201c\u8fc7\u5ea6\u5207\u6362\u201d\u7684\u95ee\u9898\u3002</p> <ol> <li>\u3010\u5f3a\u5236\u3011 \u7ebf\u7a0b\u6c60\u4e0d\u5141\u8bb8\u4f7f\u7528 <code>Executors</code> \u53bb\u521b\u5efa\uff0c\u800c\u662f\u901a\u8fc7 <code>ThreadPoolExecutor</code> \u7684\u65b9\u5f0f\uff0c\u8fd9\u6837\u7684\u5904\u7406\u65b9\u5f0f\u8ba9\u5199\u7684\u540c\u5b66\u66f4\u52a0\u660e\u786e\u7ebf\u7a0b\u6c60\u7684\u8fd0\u884c\u89c4\u5219\uff0c\u89c4\u907f\u8d44\u6e90\u8017\u5c3d\u7684\u98ce\u9669\u3002</li> </ol> <p>\u8bf4\u660e\uff1aExecutors \u8fd4\u56de\u7684\u7ebf\u7a0b\u6c60\u5bf9\u8c61\u7684\u5f0a\u7aef\u5982\u4e0b\uff1a</p> <p>1\uff09 <code>FixedThreadPool</code> \u548c <code>SingleThreadPool</code>\uff1a \u5141\u8bb8\u7684\u8bf7\u6c42\u961f\u5217\u957f\u5ea6\u4e3a <code>Integer.MAX_VALUE</code>\uff0c\u53ef\u80fd\u4f1a\u5806\u79ef\u5927\u91cf\u7684\u8bf7\u6c42\uff0c\u4ece\u800c\u5bfc\u81f4 <code>OOM</code>\u3002</p> <p>2\uff09 <code>CachedThreadPool</code>\uff1a \u5141\u8bb8\u7684\u521b\u5efa\u7ebf\u7a0b\u6570\u91cf\u4e3a <code>Integer.MAX_VALUE</code>\uff0c\u53ef\u80fd\u4f1a\u521b\u5efa\u5927\u91cf\u7684\u7ebf\u7a0b\uff0c\u4ece\u800c\u5bfc\u81f4 <code>OOM</code>\u3002</p> <ol> <li>\u3010\u5f3a\u5236\u3011 <code>SimpleDateFormat</code> \u662f\u7ebf\u7a0b\u4e0d\u5b89\u5168\u7684\u7c7b\uff0c\u4e00\u822c\u4e0d\u8981\u5b9a\u4e49\u4e3a <code>static</code> \u53d8\u91cf\uff0c\u5982\u679c\u5b9a\u4e49\u4e3a <code>static</code>\uff0c \u5fc5\u987b\u52a0\u9501\uff0c\u6216\u8005\u4f7f\u7528 <code>DateUtils</code> \u5de5\u5177\u7c7b\u3002</li> </ol> <p>\u8bf4\u660e\uff1a\u5982\u679c\u662f <code>JDK8</code> \u7684\u5e94\u7528\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>Instant</code> \u4ee3\u66ff <code>Date</code>\uff0c<code>LocalDateTime</code> \u4ee3\u66ff <code>Calendar</code>\uff0c <code>DateTimeFormatter</code> \u4ee3\u66ff <code>SimpleDateFormat</code>\uff0c\u5b98\u65b9\u7ed9\u51fa\u7684\u89e3\u91ca\uff1a<code>simple beautiful strong immutable thread-safe</code>\u3002</p> <ol> <li>\u3010\u5f3a\u5236\u3011 \u5e76\u53d1\u4fee\u6539\u540c\u4e00\u8bb0\u5f55\u65f6\uff0c\u907f\u514d\u66f4\u65b0\u4e22\u5931\uff0c\u9700\u8981\u52a0\u9501\u3002\u8981\u4e48\u5728\u5e94\u7528\u5c42\u52a0\u9501\uff0c\u8981\u4e48\u5728\u7f13\u5b58\u52a0 \u9501\uff0c\u8981\u4e48\u5728\u6570\u636e\u5e93\u5c42\u4f7f\u7528\u4e50\u89c2\u9501\uff0c\u4f7f\u7528 version \u4f5c\u4e3a\u66f4\u65b0\u4f9d\u636e\u3002</li> </ol> <p>\u8bf4\u660e\uff1a\u5982\u679c\u6bcf\u6b21\u8bbf\u95ee\u51b2\u7a81\u6982\u7387\u5c0f\u4e8e 20%\uff0c\u63a8\u8350\u4f7f\u7528\u4e50\u89c2\u9501\uff0c\u5426\u5219\u4f7f\u7528\u60b2\u89c2\u9501\u3002\u4e50\u89c2\u9501\u7684\u91cd\u8bd5\u6b21\u6570\u4e0d\u5f97\u5c0f\u4e8e 3 \u6b21\u3002</p> <ol> <li>\u3010\u63a8\u8350\u3011\u8d44\u91d1\u76f8\u5173\u7684\u91d1\u878d\u654f\u611f\u4fe1\u606f\uff0c\u4f7f\u7528\u60b2\u89c2\u9501\u7b56\u7565\u3002</li> </ol> <p>\u8bf4\u660e\uff1a\u4e50\u89c2\u9501\u5728\u83b7\u5f97\u9501\u7684\u540c\u65f6\u5df2\u7ecf\u5b8c\u6210\u4e86\u66f4\u65b0\u64cd\u4f5c\uff0c\u6821\u9a8c\u903b\u8f91\u5bb9\u6613\u51fa\u73b0\u6f0f\u6d1e\uff0c\u53e6\u5916\uff0c\u4e50\u89c2\u9501\u5bf9\u51b2\u7a81\u7684\u89e3\u51b3\u7b56 \u7565\u6709\u8f83\u590d\u6742\u7684\u8981\u6c42\uff0c\u5904\u7406\u4e0d\u5f53\u5bb9\u6613\u9020\u6210\u7cfb\u7edf\u538b\u529b\u6216\u6570\u636e\u5f02\u5e38\uff0c\u6240\u4ee5\u8d44\u91d1\u76f8\u5173\u7684\u91d1\u878d\u654f\u611f\u4fe1\u606f\u4e0d\u5efa\u8bae\u4f7f\u7528\u4e50\u89c2 \u9501\u66f4\u65b0\u3002</p> <p>\u6b63\u4f8b\uff1a\u60b2\u89c2\u9501\u9075\u5faa\u4e00\u9501\u3001\u4e8c\u5224\u3001\u4e09\u66f4\u65b0\u3001\u56db\u91ca\u653e\u7684\u539f\u5219\u3002\\</p> <ol> <li>\u3010\u5f3a\u5236\u3011 \u5728\u9ad8\u5e76\u53d1\u573a\u666f\u4e2d\uff0c\u907f\u514d\u4f7f\u7528\u201d\u7b49\u4e8e\u201d\u5224\u65ad\u4f5c\u4e3a\u4e2d\u65ad\u6216\u9000\u51fa\u7684\u6761\u4ef6\u3002</li> </ol> <p>\u8bf4\u660e\uff1a\u5982\u679c\u5e76\u53d1\u63a7\u5236\u6ca1\u6709\u5904\u7406\u597d\uff0c\u5bb9\u6613\u4ea7\u751f\u7b49\u503c\u5224\u65ad\u88ab\u201c\u51fb\u7a7f\u201d\u7684\u60c5\u51b5\uff0c\u4f7f\u7528\u5927\u4e8e\u6216\u5c0f\u4e8e\u7684\u533a\u95f4\u5224\u65ad\u6761\u4ef6 \u6765\u4ee3\u66ff\u3002 </p> <p>\u53cd\u4f8b\uff1a\u5224\u65ad\u5269\u4f59\u5956\u54c1\u6570\u91cf\u7b49\u4e8e 0 \u65f6\uff0c\u7ec8\u6b62\u53d1\u653e\u5956\u54c1\uff0c\u4f46\u56e0\u4e3a\u5e76\u53d1\u5904\u7406\u9519\u8bef\u5bfc\u81f4\u5956\u54c1\u6570\u91cf\u77ac\u95f4\u53d8\u6210\u4e86\u8d1f\u6570\uff0c \u8fd9\u6837\u7684\u8bdd\uff0c\u6d3b\u52a8\u65e0\u6cd5\u7ec8\u6b62\u3002</p>"},{"location":"java/%E9%98%85%E8%AF%BB%E9%98%BF%E9%87%8CJava%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C%E8%AE%B0%E5%BD%95/#_5","title":"\u5f02\u5e38\u5904\u7406","text":"<ol> <li>*\u3010\u5f3a\u5236\u3011* \u751f\u4ea7\u73af\u5883\u7981\u6b62\u76f4\u63a5\u4f7f\u7528 <code>System.out</code> \u6216 <code>System.err</code> \u8f93\u51fa\u65e5\u5fd7\u6216\u4f7f\u7528 <code>e.printStackTrace()</code>\u6253\u5370\u5f02\u5e38\u5806\u6808\u3002</li> </ol> <p>\u8bf4\u660e\uff1a\u6807\u51c6\u65e5\u5fd7\u8f93\u51fa\u4e0e\u6807\u51c6\u9519\u8bef\u8f93\u51fa\u6587\u4ef6\u6bcf\u6b21 <code>Jboss</code> \u91cd\u542f\u65f6\u624d\u6eda\u52a8\uff0c\u5982\u679c\u5927\u91cf\u8f93\u51fa\u9001\u5f80\u8fd9\u4e24\u4e2a\u6587\u4ef6\uff0c\u5bb9\u6613 \u9020\u6210\u6587\u4ef6\u5927\u5c0f\u8d85\u8fc7\u64cd\u4f5c\u7cfb\u7edf\u5927\u5c0f\u9650\u5236\u3002</p> <ol> <li>\u3010\u5f3a\u5236\u3011 \u9519\u8bef\u7801\u4f7f\u7528\u8005\u907f\u514d\u968f\u610f\u5b9a\u4e49\u65b0\u7684\u9519\u8bef\u7801\u3002</li> </ol> <p>\u8bf4\u660e\uff1a\u5c3d\u53ef\u80fd\u5728\u539f\u6709\u9519\u8bef\u7801\u9644\u8868\u4e2d\u627e\u5230\u8bed\u4e49\u76f8\u540c\u6216\u8005\u76f8\u8fd1\u7684\u9519\u8bef\u7801\u5728\u4ee3\u7801\u4e2d\u4f7f\u7528\u5373\u53ef\u3002</p> <ol> <li>\u3010\u5f3a\u5236\u3011 \u9519\u8bef\u7801\u4e0d\u80fd\u76f4\u63a5\u8f93\u51fa\u7ed9\u7528\u6237\u4f5c\u4e3a\u63d0\u793a\u4fe1\u606f\u4f7f\u7528\u3002</li> </ol> <p>\u8bf4\u660e\uff1a\u5806\u6808\u3001\u9519\u8bef\u4fe1\u606f\u3001\u9519\u8bef\u7801\u3001\u63d0\u793a\u4fe1\u606f \u662f\u4e00\u4e2a\u6709\u6548\u5173\u8054\u5e76\u4e92\u76f8\u8f6c\u4e49\u7684\u548c\u8c10\u6574\u4f53\uff0c\u4f46\u662f\u8bf7\u52ff\u4e92\u76f8\u8d8a\u4fce\u4ee3\u5e96\u3002</p> <ol> <li> <p>\u3010\u5f3a\u5236\u3011 \u6355\u83b7\u5f02\u5e38\u662f\u4e3a\u4e86\u5904\u7406\u5b83\uff0c\u4e0d\u8981\u6355\u83b7\u4e86\u5374\u4ec0\u4e48\u90fd\u4e0d\u5904\u7406\u800c\u629b\u5f03\u4e4b\uff0c\u5982\u679c\u4e0d\u60f3\u5904\u7406\u5b83\uff0c\u8bf7 \u5c06\u8be5\u5f02\u5e38\u629b\u7ed9\u5b83\u7684\u8c03\u7528\u8005\u3002\u6700\u5916\u5c42\u7684\u4e1a\u52a1\u4f7f\u7528\u8005\uff0c\u5fc5\u987b\u5904\u7406\u5f02\u5e38\uff0c\u5c06\u5176\u8f6c\u5316\u4e3a\u7528\u6237\u53ef\u4ee5\u7406\u89e3\u7684 \u5185\u5bb9\u3002</p> </li> <li> <p>\u3010\u5f3a\u5236\u3011 \u4e8b\u52a1\u573a\u666f\u4e2d\uff0c\u629b\u51fa\u5f02\u5e38\u88ab catch \u540e\uff0c\u5982\u679c\u9700\u8981\u56de\u6eda\uff0c\u4e00\u5b9a\u8981\u6ce8\u610f\u624b\u52a8\u56de\u6eda\u4e8b\u52a1\u3002</p> </li> <li> <p>\u3010\u5f3a\u5236\u3011 finally \u5757\u5fc5\u987b\u5bf9\u8d44\u6e90\u5bf9\u8c61\u3001\u6d41\u5bf9\u8c61\u8fdb\u884c\u5173\u95ed\uff0c\u6709\u5f02\u5e38\u4e5f\u8981\u505a try-catch\u3002</p> </li> </ol> <p>\u8bf4\u660e\uff1a\u5982\u679c <code>JDK7</code> \u53ca\u4ee5\u4e0a\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>try-with-resources</code> \u65b9\u5f0f\u3002</p> <ol> <li> <p>\u3010\u5f3a\u5236\u3011 \u5f02\u5e38\u4fe1\u606f\u5e94\u8be5\u5305\u62ec\u4e24\u7c7b\u4fe1\u606f\uff1a\u6848\u53d1\u73b0\u573a\u4fe1\u606f\u548c\u5f02\u5e38\u5806\u6808\u4fe1\u606f\u3002\u5982\u679c\u4e0d\u5904\u7406\uff0c\u90a3\u4e48\u901a\u8fc7 \u5173\u952e\u5b57 throws \u5f80\u4e0a\u629b\u51fa\u3002</p> </li> <li> <p>\u3010\u5f3a\u5236\u3011 \u65e5\u5fd7\u6253\u5370\u65f6\u7981\u6b62\u76f4\u63a5\u7528 JSON \u5de5\u5177\u5c06\u5bf9\u8c61\u8f6c\u6362\u6210 String\u3002</p> </li> </ol> <p>\u8bf4\u660e\uff1a\u5982\u679c\u5bf9\u8c61\u91cc\u67d0\u4e9b get \u65b9\u6cd5\u88ab\u8986\u5199\uff0c\u5b58\u5728\u629b\u51fa\u5f02\u5e38\u7684\u60c5\u51b5\uff0c\u5219\u53ef\u80fd\u4f1a\u56e0\u4e3a\u6253\u5370\u65e5\u5fd7\u800c\u5f71\u54cd\u6b63\u5e38\u4e1a\u52a1\u6d41 \u7a0b\u7684\u6267\u884c\u3002 </p> <p>\u6b63\u4f8b\uff1a\u6253\u5370\u65e5\u5fd7\u65f6\u4ec5\u6253\u5370\u51fa\u4e1a\u52a1\u76f8\u5173\u5c5e\u6027\u503c\u6216\u8005\u8c03\u7528\u5176\u5bf9\u8c61\u7684 <code>toString()</code>\u65b9\u6cd5</p> <ol> <li>\u3010\u63a8\u8350\u3011\u8c28\u614e\u5730\u8bb0\u5f55\u65e5\u5fd7\u3002\u751f\u4ea7\u73af\u5883\u7981\u6b62\u8f93\u51fa debug \u65e5\u5fd7\uff1b\u6709\u9009\u62e9\u5730\u8f93\u51fa info \u65e5\u5fd7\uff1b\u5982\u679c\u4f7f\u7528 warn \u6765\u8bb0\u5f55\u521a\u4e0a\u7ebf\u65f6\u7684\u4e1a\u52a1\u884c\u4e3a\u4fe1\u606f\uff0c\u4e00\u5b9a\u8981\u6ce8\u610f\u65e5\u5fd7\u8f93\u51fa\u91cf\u7684\u95ee\u9898\uff0c\u907f\u514d\u628a\u670d\u52a1\u5668\u78c1\u76d8\u6491 \u7206\uff0c\u5e76\u8bb0\u5f97\u53ca\u65f6\u5220\u9664\u8fd9\u4e9b\u89c2\u5bdf\u65e5\u5fd7\u3002</li> </ol> <p>\u8bf4\u660e\uff1a\u5927\u91cf\u5730\u8f93\u51fa\u65e0\u6548\u65e5\u5fd7\uff0c\u4e0d\u5229\u4e8e\u7cfb\u7edf\u6027\u80fd\u63d0\u5347\uff0c\u4e5f\u4e0d\u5229\u4e8e\u5feb\u901f\u5b9a\u4f4d\u9519\u8bef\u70b9\u3002\u8bb0\u5f55\u65e5\u5fd7\u65f6\u8bf7\u601d\u8003\uff1a\u8fd9\u4e9b \u65e5\u5fd7\u771f\u7684\u6709\u4eba\u770b\u5417\uff1f\u770b\u5230\u8fd9\u6761\u65e5\u5fd7\u4f60\u80fd\u505a\u4ec0\u4e48\uff1f\u80fd\u4e0d\u80fd\u7ed9\u95ee\u9898\u6392\u67e5\u5e26\u6765\u597d\u5904\uff1f</p>"},{"location":"java/%E9%98%85%E8%AF%BB%E9%98%BF%E9%87%8CJava%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C%E8%AE%B0%E5%BD%95/#mysql","title":"<code>MySQL</code> \u6570\u636e\u5e93","text":""},{"location":"java/%E9%98%85%E8%AF%BB%E9%98%BF%E9%87%8CJava%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C%E8%AE%B0%E5%BD%95/#_6","title":"\u5efa\u8868\u89c4\u7ea6","text":"<ol> <li>\u3010\u5f3a\u5236\u3011 \u8868\u8fbe\u662f\u4e0e\u5426\u6982\u5ff5\u7684\u5b57\u6bb5\uff0c\u5fc5\u987b\u4f7f\u7528 <code>is_xxx</code> \u7684\u65b9\u5f0f\u547d\u540d\uff0c\u6570\u636e\u7c7b\u578b\u662f <code>unsigned tinyint</code> \uff081 \u8868\u793a\u662f\uff0c0 \u8868\u793a\u5426\uff09\u3002</li> </ol> <p>\u8bf4\u660e\uff1a\u4efb\u4f55\u5b57\u6bb5\u5982\u679c\u4e3a\u975e\u8d1f\u6570\uff0c\u5fc5\u987b\u662f unsigned\u3002 </p> <p>\u6ce8\u610f\uff1aPOJO \u7c7b\u4e2d\u7684\u4efb\u4f55\u5e03\u5c14\u7c7b\u578b\u7684\u53d8\u91cf\uff0c\u90fd\u4e0d\u8981\u52a0 is \u524d\u7f00\uff0c\u6240\u4ee5\uff0c\u9700\u8981\u5728\u8bbe\u7f6e\u4ece is_xxx \u5230 Xxx \u7684\u6620\u5c04\u5173\u7cfb\u3002\u6570\u636e\u5e93\u8868\u793a\u662f\u4e0e\u5426\u7684\u503c\uff0c\u4f7f\u7528 tinyint \u7c7b\u578b\uff0c\u575a\u6301 is_xxx \u7684\u547d\u540d\u65b9\u5f0f\u662f\u4e3a\u4e86\u660e\u786e\u5176\u53d6\u503c\u542b \u4e49\u4e0e\u53d6\u503c\u8303\u56f4\u3002 </p> <p>\u6b63\u4f8b\uff1a\u8868\u8fbe\u903b\u8f91\u5220\u9664\u7684\u5b57\u6bb5\u540d is_deleted\uff0c1 \u8868\u793a\u5220\u9664\uff0c0 \u8868\u793a\u672a\u5220\u9664\u3002</p> <ol> <li> <p>\u3010\u5f3a\u5236\u3011 \u8868\u540d\u3001\u5b57\u6bb5\u540d\u5fc5\u987b\u4f7f\u7528\u5c0f\u5199\u5b57\u6bcd\u6216\u6570\u5b57\uff0c\u7981\u6b62\u51fa\u73b0\u6570\u5b57\u5f00\u5934\uff0c\u7981\u6b62\u4e24\u4e2a\u4e0b\u5212\u7ebf\u4e2d\u95f4\u53ea \u51fa\u73b0\u6570\u5b57\u3002\u6570\u636e\u5e93\u5b57\u6bb5\u540d\u7684\u4fee\u6539\u4ee3\u4ef7\u5f88\u5927\uff0c\u56e0\u4e3a\u65e0\u6cd5\u8fdb\u884c\u9884\u53d1\u5e03\uff0c\u6240\u4ee5\u5b57\u6bb5\u540d\u79f0\u9700\u8981\u614e\u91cd\u8003\u8651\u3002</p> </li> <li> <p>\u3010\u5f3a\u5236\u3011 \u8868\u540d\u4e0d\u4f7f\u7528\u590d\u6570\u540d\u8bcd\u3002</p> </li> <li> <p>\u3010\u5f3a\u5236\u3011 \u7981\u7528\u4fdd\u7559\u5b57\uff0c\u5982 <code>desc\u3001range\u3001match\u3001delayed</code> \u7b49\uff0c\u8bf7\u53c2\u8003 MySQL \u5b98\u65b9\u4fdd\u7559\u5b57\u3002</p> </li> <li> <p>\u3010\u5f3a\u5236\u3011 \u4e3b\u952e\u7d22\u5f15\u540d\u4e3a pk_\u5b57\u6bb5\u540d\uff1b\u552f\u4e00\u7d22\u5f15\u540d\u4e3a uk_\u5b57\u6bb5\u540d\uff1b\u666e\u901a\u7d22\u5f15\u540d\u5219\u4e3a idx_\u5b57\u6bb5\u540d\u3002</p> </li> </ol> <p>\u8bf4\u660e\uff1apk_ \u5373 primary key\uff1buk_ \u5373 unique key\uff1bidx_ \u5373 index \u7684\u7b80\u79f0\u3002</p> <ol> <li>\u3010\u5f3a\u5236\u3011 \u5c0f\u6570\u7c7b\u578b\u4e3a <code>decimal</code>\uff0c\u7981\u6b62\u4f7f\u7528 <code>float</code> \u548c <code>double</code>\u3002</li> </ol> <p>\u8bf4\u660e\uff1a\u5728\u5b58\u50a8\u7684\u65f6\u5019\uff0cfloat \u548c double \u90fd\u5b58\u5728\u7cbe\u5ea6\u635f\u5931\u7684\u95ee\u9898\uff0c\u5f88\u53ef\u80fd\u5728\u6bd4\u8f83\u503c\u7684\u65f6\u5019\uff0c\u5f97\u5230\u4e0d\u6b63\u786e\u7684 \u7ed3\u679c\u3002\u5982\u679c\u5b58\u50a8\u7684\u6570\u636e\u8303\u56f4\u8d85\u8fc7 decimal \u7684\u8303\u56f4\uff0c\u5efa\u8bae\u5c06\u6570\u636e\u62c6\u6210\u6574\u6570\u548c\u5c0f\u6570\u5e76\u5206\u5f00\u5b58\u50a8\u3002</p> <ol> <li> <p>\u3010\u5f3a\u5236\u3011 \u5982\u679c\u5b58\u50a8\u7684\u5b57\u7b26\u4e32\u957f\u5ea6\u51e0\u4e4e\u76f8\u7b49\uff0c\u4f7f\u7528 char \u5b9a\u957f\u5b57\u7b26\u4e32\u7c7b\u578b\u3002</p> </li> <li> <p>\u3010\u5f3a\u5236\u3011 <code>varchar</code> \u662f\u53ef\u53d8\u957f\u5b57\u7b26\u4e32\uff0c\u4e0d\u9884\u5148\u5206\u914d\u5b58\u50a8\u7a7a\u95f4\uff0c\u957f\u5ea6\u4e0d\u8981\u8d85\u8fc7 5000\uff0c\u5982\u679c\u5b58\u50a8\u957f\u5ea6 \u5927\u4e8e\u6b64\u503c\uff0c\u5b9a\u4e49\u5b57\u6bb5\u7c7b\u578b\u4e3a text\uff0c\u72ec\u7acb\u51fa\u6765\u4e00\u5f20\u8868\uff0c\u7528\u4e3b\u952e\u6765\u5bf9\u5e94\uff0c\u907f\u514d\u5f71\u54cd\u5176\u5b83\u5b57\u6bb5\u7d22\u5f15\u6548\u7387\u3002</p> </li> <li> <p>\u3010\u5f3a\u5236\u3011 \u8868\u5fc5\u5907\u4e09\u5b57\u6bb5\uff1a<code>id, create_time, update_time</code>\u3002</p> </li> </ol> <p>\u8bf4\u660e\uff1a\u5176\u4e2d id \u5fc5\u4e3a\u4e3b\u952e\uff0c\u7c7b\u578b\u4e3a bigint unsigned\u3001\u5355\u8868\u65f6\u81ea\u589e\u3001\u6b65\u957f\u4e3a 1\u3002create_time, update_time \u7684\u7c7b\u578b\u5747\u4e3a datetime \u7c7b\u578b\uff0c\u524d\u8005\u73b0\u5728\u65f6\u8868\u793a\u4e3b\u52a8\u5f0f\u521b\u5efa\uff0c\u540e\u8005\u8fc7\u53bb\u5206\u8bcd\u8868\u793a\u88ab\u52a8\u5f0f\u66f4\u65b0\u3002</p>"},{"location":"java/%E9%98%85%E8%AF%BB%E9%98%BF%E9%87%8CJava%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C%E8%AE%B0%E5%BD%95/#_7","title":"\u7d22\u5f15\u89c4\u7ea6","text":"<ol> <li>\u3010\u5f3a\u5236\u3011 \u4e1a\u52a1\u4e0a\u5177\u6709\u552f\u4e00\u7279\u6027\u7684\u5b57\u6bb5\uff0c\u5373\u4f7f\u662f\u7ec4\u5408\u5b57\u6bb5\uff0c\u4e5f\u5fc5\u987b\u5efa\u6210\u552f\u4e00\u7d22\u5f15\u3002</li> </ol> <p>\u8bf4\u660e\uff1a\u4e0d\u8981\u4ee5\u4e3a\u552f\u4e00\u7d22\u5f15\u5f71\u54cd\u4e86 insert \u901f\u5ea6\uff0c\u8fd9\u4e2a\u901f\u5ea6\u635f\u8017\u53ef\u4ee5\u5ffd\u7565\uff0c\u4f46\u63d0\u9ad8\u67e5\u627e\u901f\u5ea6\u662f\u660e\u663e\u7684\uff1b\u53e6\u5916\uff0c \u5373\u4f7f\u5728\u5e94\u7528\u5c42\u505a\u4e86\u975e\u5e38\u5b8c\u5584\u7684\u6821\u9a8c\u63a7\u5236\uff0c\u53ea\u8981\u6ca1\u6709\u552f\u4e00\u7d22\u5f15\uff0c\u6839\u636e\u58a8\u83f2\u5b9a\u5f8b\uff0c\u5fc5\u7136\u6709\u810f\u6570\u636e\u4ea7\u751f\u3002</p> <ol> <li>\u3010\u5f3a\u5236\u3011 \u8d85\u8fc7\u4e09\u4e2a\u8868\u7981\u6b62 join\u3002\u9700\u8981 join \u7684\u5b57\u6bb5\uff0c\u6570\u636e\u7c7b\u578b\u4fdd\u6301\u7edd\u5bf9\u4e00\u81f4\uff1b\u591a\u8868\u5173\u8054\u67e5\u8be2\u65f6\uff0c \u4fdd\u8bc1\u88ab\u5173\u8054\u7684\u5b57\u6bb5\u9700\u8981\u6709\u7d22\u5f15\u3002</li> </ol> <p>\u8bf4\u660e\uff1a\u5373\u4f7f\u53cc\u8868 join \u4e5f\u8981\u6ce8\u610f\u8868\u7d22\u5f15\u3001SQL \u6027\u80fd\u3002</p> <ol> <li>\u3010\u5f3a\u5236\u3011 \u5728 varchar \u5b57\u6bb5\u4e0a\u5efa\u7acb\u7d22\u5f15\u65f6\uff0c\u5fc5\u987b\u6307\u5b9a\u7d22\u5f15\u957f\u5ea6\uff0c\u6ca1\u5fc5\u8981\u5bf9\u5168\u5b57\u6bb5\u5efa\u7acb\u7d22\u5f15\uff0c\u6839\u636e \u5b9e\u9645\u6587\u672c\u533a\u5206\u5ea6\u51b3\u5b9a\u7d22\u5f15\u957f\u5ea6\u3002</li> </ol> <p>\u8bf4\u660e\uff1a\u7d22\u5f15\u7684\u957f\u5ea6\u4e0e\u533a\u5206\u5ea6\u662f\u4e00\u5bf9\u77db\u76fe\u4f53\uff0c\u4e00\u822c\u5bf9\u5b57\u7b26\u4e32\u7c7b\u578b\u6570\u636e\uff0c\u957f\u5ea6\u4e3a 20 \u7684\u7d22\u5f15\uff0c\u533a\u5206\u5ea6\u4f1a\u9ad8\u8fbe 90% \u4ee5\u4e0a\uff0c\u53ef\u4ee5\u4f7f\u7528 count(distinct left(\u5217\u540d, \u7d22\u5f15\u957f\u5ea6))/count(*)\u7684\u533a\u5206\u5ea6\u6765\u786e\u5b9a\u3002</p> <ol> <li>\u3010\u5f3a\u5236\u3011 \u9875\u9762\u641c\u7d22\u4e25\u7981\u5de6\u6a21\u7cca\u6216\u8005\u5168\u6a21\u7cca\uff0c\u5982\u679c\u9700\u8981\u8bf7\u8d70\u641c\u7d22\u5f15\u64ce\u6765\u89e3\u51b3\u3002</li> </ol> <p>\u8bf4\u660e\uff1a\u7d22\u5f15\u6587\u4ef6\u5177\u6709 B-Tree \u7684\u6700\u5de6\u524d\u7f00\u5339\u914d\u7279\u6027\uff0c\u5982\u679c\u5de6\u8fb9\u7684\u503c\u672a\u786e\u5b9a\uff0c\u90a3\u4e48\u65e0\u6cd5\u4f7f\u7528\u6b64\u7d22\u5f15\u3002</p> <ol> <li>\u3010\u63a8\u8350\u3011\u5229\u7528\u8986\u76d6\u7d22\u5f15\u6765\u8fdb\u884c\u67e5\u8be2\u64cd\u4f5c\uff0c\u907f\u514d\u56de\u8868\u3002</li> </ol> <p>\u6b63\u4f8b\uff1a\u80fd\u591f\u5efa\u7acb\u7d22\u5f15\u7684\u79cd\u7c7b\u5206\u4e3a\u4e3b\u952e\u7d22\u5f15\u3001\u552f\u4e00\u7d22\u5f15\u3001\u666e\u901a\u7d22\u5f15\u4e09\u79cd\uff0c\u800c\u8986\u76d6\u7d22\u5f15\u53ea\u662f\u4e00\u79cd\u67e5\u8be2\u7684\u4e00\u79cd\u6548 \u679c\uff0c\u7528 explain \u7684\u7ed3\u679c\uff0cextra \u5217\u4f1a\u51fa\u73b0\uff1ausing index\u3002</p> <ol> <li>\u3010\u63a8\u8350\u3011\u5229\u7528\u5ef6\u8fdf\u5173\u8054\u6216\u8005\u5b50\u67e5\u8be2\u4f18\u5316\u8d85\u591a\u5206\u9875\u573a\u666f\u3002</li> </ol> <p>\u8bf4\u660e\uff1aMySQL \u5e76\u4e0d\u662f\u8df3\u8fc7 offset \u884c\uff0c\u800c\u662f\u53d6 offset+N \u884c\uff0c\u7136\u540e\u8fd4\u56de\u653e\u5f03\u524d offset \u884c\uff0c\u8fd4\u56de N \u884c\uff0c\u90a3\u5f53 offset \u7279\u522b\u5927\u7684\u65f6\u5019\uff0c\u6548\u7387\u5c31\u975e\u5e38\u7684\u4f4e\u4e0b\uff0c\u8981\u4e48\u63a7\u5236\u8fd4\u56de\u7684\u603b\u9875\u6570\uff0c\u8981\u4e48\u5bf9\u8d85\u8fc7\u7279\u5b9a\u9608\u503c\u7684\u9875\u6570\u8fdb\u884c SQL \u6539\u5199\u3002</p> <p>\u6b63\u4f8b\uff1a\u5148\u5feb\u901f\u5b9a\u4f4d\u9700\u8981\u83b7\u53d6\u7684 id \u6bb5\uff0c\u7136\u540e\u518d\u5173\u8054\uff1a <code>SELECT t1.* FROM \u8868 1 as t1, (select id from \u8868 1 where \u6761\u4ef6 LIMIT 100000,20 ) as t2 where t1.id=t2.id</code></p> <ol> <li>\u3010\u63a8\u8350\u3011\u5efa\u7ec4\u5408\u7d22\u5f15\u7684\u65f6\u5019\uff0c\u533a\u5206\u5ea6\u6700\u9ad8\u7684\u5728\u6700\u5de6\u8fb9\u3002</li> </ol> <p>\u6b63\u4f8b\uff1a\u5982\u679c where a=? and b=?\uff0ca \u5217\u7684\u51e0\u4e4e\u63a5\u8fd1\u4e8e\u552f\u4e00\u503c\uff0c\u90a3\u4e48\u53ea\u9700\u8981\u5355\u5efa idx_a \u7d22\u5f15\u5373\u53ef\u3002</p> <p>\u8bf4\u660e\uff1a\u5b58\u5728\u975e\u7b49\u53f7\u548c\u7b49\u53f7\u6df7\u5408\u5224\u65ad\u6761\u4ef6\u65f6\uff0c\u5728\u5efa\u7d22\u5f15\u65f6\uff0c\u8bf7\u628a\u7b49\u53f7\u6761\u4ef6\u7684\u5217\u524d\u7f6e\u3002\u5982\uff1awhere c&gt;? and d=? \u90a3\u4e48\u5373\u4f7f c \u7684\u533a\u5206\u5ea6\u66f4\u9ad8\uff0c\u4e5f\u5fc5\u987b\u628a d \u653e\u5728\u7d22\u5f15\u7684\u6700\u524d\u5217\uff0c\u5373\u5efa\u7acb\u7ec4\u5408\u7d22\u5f15 idx_d_c\u3002</p>"},{"location":"java/%E9%98%85%E8%AF%BB%E9%98%BF%E9%87%8CJava%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C%E8%AE%B0%E5%BD%95/#sql","title":"SQL \u8bed\u53e5","text":"<ol> <li>\u3010\u5f3a\u5236\u3011 \u4e0d\u8981\u4f7f\u7528 <code>count(\u5217\u540d)</code>\u6216 <code>count(\u5e38\u91cf)</code>\u6765\u66ff\u4ee3 <code>count(*)</code>\uff0c<code>count(*)</code>\u662f <code>SQL92</code> \u5b9a\u4e49\u7684\u6807 \u51c6\u7edf\u8ba1\u884c\u6570\u7684\u8bed\u6cd5\uff0c\u8ddf\u6570\u636e\u5e93\u65e0\u5173\uff0c\u8ddf NULL \u548c\u975e NULL \u65e0\u5173\u3002</li> </ol> <p>\u8bf4\u660e\uff1a<code>count(*)</code>\u4f1a\u7edf\u8ba1\u503c\u4e3a NULL \u7684\u884c\uff0c\u800c <code>count(\u5217\u540d)</code>\u4e0d\u4f1a\u7edf\u8ba1\u6b64\u5217\u4e3a NULL \u503c\u7684\u884c\u3002</p> <ol> <li> <p>\u3010\u5f3a\u5236\u3011 <code>count(distinct col)</code> \u8ba1\u7b97\u8be5\u5217\u9664 NULL \u4e4b\u5916\u7684\u4e0d\u91cd\u590d\u884c\u6570\uff0c\u6ce8\u610f <code>count(distinct col1, col2)</code> \u5982\u679c\u5176\u4e2d\u4e00\u5217\u5168\u4e3a NULL\uff0c\u90a3\u4e48\u5373\u4f7f\u53e6\u4e00\u5217\u6709\u4e0d\u540c\u7684\u503c\uff0c\u4e5f\u8fd4\u56de\u4e3a 0\u3002</p> </li> <li> <p>\u3010\u5f3a\u5236\u3011 \u5f53\u67d0\u4e00\u5217\u7684\u503c\u5168\u662f NULL \u65f6\uff0ccount(col)\u7684\u8fd4\u56de\u7ed3\u679c\u4e3a 0\uff0c\u4f46 sum(col)\u7684\u8fd4\u56de\u7ed3\u679c\u4e3a NULL\uff0c\u56e0\u6b64\u4f7f\u7528 sum()\u65f6\u9700\u6ce8\u610f NPE \u95ee\u9898\u3002</p> </li> </ol> <p>\u6b63\u4f8b\uff1a\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u65b9\u5f0f\u6765\u907f\u514d sum \u7684 NPE \u95ee\u9898\uff1a<code>SELECT IFNULL(SUM(column), 0) FROM table;</code></p> <ol> <li>. \u3010\u5f3a\u5236\u3011 \u4f7f\u7528 ISNULL()\u6765\u5224\u65ad\u662f\u5426\u4e3a NULL \u503c\u3002</li> </ol> <p>\u53cd\u4f8b\uff1a\u5728 SQL \u8bed\u53e5\u4e2d\uff0c\u5982\u679c\u5728 null \u524d\u6362\u884c\uff0c\u5f71\u54cd\u53ef\u8bfb\u6027\u3002<code>select * from table where column1 is null and column3 is not null; \u800cISNULL(column)</code>\u662f\u4e00\u4e2a\u6574\u4f53\uff0c\u7b80\u6d01\u6613\u61c2\u3002\u4ece\u6027\u80fd\u6570\u636e\u4e0a\u5206\u6790\uff0c<code>ISNULL(column)</code> \u6267\u884c\u6548\u7387\u66f4\u5feb\u4e00\u4e9b\u3002</p> <ol> <li>\u3010\u5f3a\u5236\u3011 \u4e0d\u5f97\u4f7f\u7528\u5916\u952e\u4e0e\u7ea7\u8054\uff0c\u4e00\u5207\u5916\u952e\u6982\u5ff5\u5fc5\u987b\u5728\u5e94\u7528\u5c42\u89e3\u51b3\u3002</li> </ol> <p>\u8bf4\u660e\uff1a\uff08\u6982\u5ff5\u89e3\u91ca\uff09\u5b66\u751f\u8868\u4e2d\u7684 student_id \u662f\u4e3b\u952e\uff0c\u90a3\u4e48\u6210\u7ee9\u8868\u4e2d\u7684 student_id \u5219\u4e3a\u5916\u952e\u3002\u5982\u679c\u66f4\u65b0\u5b66 \u751f\u8868\u4e2d\u7684 student_id\uff0c\u540c\u65f6\u89e6\u53d1\u6210\u7ee9\u8868\u4e2d\u7684 student_id \u66f4\u65b0\uff0c\u5373\u4e3a\u7ea7\u8054\u66f4\u65b0\u3002\u5916\u952e\u4e0e\u7ea7\u8054\u66f4\u65b0\u9002\u7528\u4e8e\u5355\u673a \u4f4e\u5e76\u53d1\uff0c\u4e0d\u9002\u5408\u5206\u5e03\u5f0f\u3001\u9ad8\u5e76\u53d1\u96c6\u7fa4\uff1b\u7ea7\u8054\u66f4\u65b0\u662f\u5f3a\u963b\u585e\uff0c\u5b58\u5728\u6570\u636e\u5e93\u66f4\u65b0\u98ce\u66b4\u7684\u98ce\u9669\uff1b\u5916\u952e\u5f71\u54cd\u6570\u636e\u5e93 \u7684\u63d2\u5165\u901f\u5ea6\u3002</p> <ol> <li> <p>\u3010\u5f3a\u5236\u3011 \u7981\u6b62\u4f7f\u7528\u5b58\u50a8\u8fc7\u7a0b\uff0c\u5b58\u50a8\u8fc7\u7a0b\u96be\u4ee5\u8c03\u8bd5\u548c\u6269\u5c55\uff0c\u66f4\u6ca1\u6709\u79fb\u690d\u6027\u3002</p> </li> <li> <p>\u3010\u5f3a\u5236\u3011 \u6570\u636e\u8ba2\u6b63\uff08\u7279\u522b\u662f\u5220\u9664\u6216\u4fee\u6539\u8bb0\u5f55\u64cd\u4f5c\uff09\u65f6\uff0c\u8981\u5148 select\uff0c\u907f\u514d\u51fa\u73b0\u8bef\u5220\u9664\uff0c\u786e\u8ba4\u65e0 \u8bef\u624d\u80fd\u6267\u884c\u66f4\u65b0\u8bed\u53e5\u3002</p> </li> </ol>"},{"location":"java/%E9%98%85%E8%AF%BB%E9%98%BF%E9%87%8CJava%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C%E8%AE%B0%E5%BD%95/#orm","title":"ORM \u6620\u5c04","text":"<ol> <li>\u3010\u5f3a\u5236\u3011 \u5728\u8868\u67e5\u8be2\u4e2d\uff0c\u4e00\u5f8b\u4e0d\u8981\u4f7f\u7528 <code>*</code> \u4f5c\u4e3a\u67e5\u8be2\u7684\u5b57\u6bb5\u5217\u8868\uff0c\u9700\u8981\u54ea\u4e9b\u5b57\u6bb5\u5fc5\u987b\u660e\u786e\u5199\u660e\u3002</li> </ol> <p>\u8bf4\u660e\uff1a</p> <p>1\uff09\u589e\u52a0\u67e5\u8be2\u5206\u6790\u5668\u89e3\u6790\u6210\u672c\u3002</p> <p>2\uff09\u589e\u51cf\u5b57\u6bb5\u5bb9\u6613\u4e0e <code>resultMap</code> \u914d\u7f6e\u4e0d\u4e00\u81f4\u3002</p> <p>3\uff09\u65e0\u7528\u5b57\u6bb5\u589e\u52a0\u7f51\u7edc \u6d88\u8017\uff0c\u5c24\u5176\u662f text \u7c7b\u578b\u7684\u5b57\u6bb5\u3002</p> <ol> <li>\u3010\u5f3a\u5236\u3011 \u4e0d\u8981\u7528 resultClass \u5f53\u8fd4\u56de\u53c2\u6570\uff0c\u5373\u4f7f\u6240\u6709\u7c7b\u5c5e\u6027\u540d\u4e0e\u6570\u636e\u5e93\u5b57\u6bb5\u4e00\u4e00\u5bf9\u5e94\uff0c\u4e5f\u9700\u8981 \u5b9a\u4e49\uff1b\u53cd\u8fc7\u6765\uff0c\u6bcf\u4e00\u4e2a\u8868\u4e5f\u5fc5\u7136\u6709\u4e00\u4e2a\u4e0e\u4e4b\u5bf9\u5e94\u3002</li> </ol> <p>\u8bf4\u660e\uff1a\u914d\u7f6e\u6620\u5c04\u5173\u7cfb\uff0c\u4f7f\u5b57\u6bb5\u4e0e DO \u7c7b\u89e3\u8026\uff0c\u65b9\u4fbf\u7ef4\u62a4\u3002</p> <ol> <li> <p>\u3010\u5f3a\u5236\u3011 sql.xml \u914d\u7f6e\u53c2\u6570\u4f7f\u7528\uff1a<code>#{}\uff0c#param#</code> \u4e0d\u8981\u4f7f\u7528 <code>${}</code> \u6b64\u79cd\u65b9\u5f0f\u5bb9\u6613\u51fa\u73b0 SQL \u6ce8\u5165\u3002</p> </li> <li> <p>\u3010\u5f3a\u5236\u3011 \u4e0d\u5141\u8bb8\u76f4\u63a5\u62ff HashMap \u4e0e Hashtable \u4f5c\u4e3a\u67e5\u8be2\u7ed3\u679c\u96c6\u7684\u8f93\u51fa\u3002</p> </li> <li> <p>\u3010\u5f3a\u5236\u3011 \u66f4\u65b0\u6570\u636e\u8868\u8bb0\u5f55\u65f6\uff0c\u5fc5\u987b\u540c\u65f6\u66f4\u65b0\u8bb0\u5f55\u5bf9\u5e94\u7684 update_time \u5b57\u6bb5\u503c\u4e3a\u5f53\u524d\u65f6\u95f4\u3002</p> </li> </ol>"},{"location":"other/Python%E8%84%9A%E6%9C%AC%E5%A4%84%E7%90%86Markdown%E5%9B%BE%E7%89%87%E6%9C%AC%E5%9C%B0%E5%8C%96/","title":"Python\u811a\u672c\u5904\u7406Markdown\u56fe\u7247\u672c\u5730\u5316","text":""},{"location":"other/Python%E8%84%9A%E6%9C%AC%E5%A4%84%E7%90%86Markdown%E5%9B%BE%E7%89%87%E6%9C%AC%E5%9C%B0%E5%8C%96/#_1","title":"\u9700\u6c42\u63cf\u8ff0","text":"<p>\u4f7f\u7528python\u5199\u4e00\u4e2a\u65b9\u6cd5\u5b9e\u73b0\u5c06markdown\u6587\u4ef6\u4e2d\u7684\u56fe\u7247\u8def\u5f84\u4fdd\u5b58\u5230\u4ee5markdown\u6587\u4ef6\u547d\u540d\u7684\u76ee\u5f55\u4e2d\uff0c\u5e76\u4e14\u5c06markdown\u6587\u4ef6\u4e2d\u8fdc\u7a0b\u56fe\u7247\u5730\u5740\u66ff\u6362\u4e3a\u672c\u5730\u56fe\u7247\u5730\u5740\u3002</p>"},{"location":"other/Python%E8%84%9A%E6%9C%AC%E5%A4%84%E7%90%86Markdown%E5%9B%BE%E7%89%87%E6%9C%AC%E5%9C%B0%E5%8C%96/#_2","title":"\u9700\u6c42\u5206\u6790","text":"<p>\u6839\u636e\u9700\u6c42\u63cf\u8ff0\uff0c\u9700\u8981\u5b8c\u6210\u4ee5\u4e0b\u4efb\u52a1\uff1a 1. \u89e3\u6790Markdown\u6587\u4ef6\uff0c\u63d0\u53d6\u5176\u4e2d\u7684\u56fe\u7247\u94fe\u63a5\uff08\u53ef\u80fd\u662f\u8fdc\u7a0bURL\uff0c\u4e5f\u53ef\u80fd\u662f\u672c\u5730\u8def\u5f84\uff0c\u4f46\u6211\u4eec\u4e3b\u8981\u5173\u6ce8\u8fdc\u7a0bURL\uff0c\u56e0\u4e3a\u672c\u5730\u8def\u5f84\u53ef\u80fd\u5df2\u7ecf\u662f\u6211\u4eec\u60f3\u8981\u7684\uff09\u3002 2. \u5c06\u8fdc\u7a0b\u56fe\u7247\u4e0b\u8f7d\u5230\u672c\u5730\uff0c\u4fdd\u5b58\u5230\u4e00\u4e2a\u4ee5Markdown\u6587\u4ef6\u547d\u540d\u7684\u76ee\u5f55\u4e2d\uff08\u4f8b\u5982\uff0c\u5982\u679cMarkdown\u6587\u4ef6\u540d\u4e3a\"example.md\"\uff0c\u5219\u521b\u5efa\"example\"\u76ee\u5f55\uff09\u3002 3. \u5c06Markdown\u6587\u4ef6\u4e2d\u7684\u8fdc\u7a0b\u56fe\u7247\u5730\u5740\u66ff\u6362\u4e3a\u672c\u5730\u56fe\u7247\u5730\u5740\uff08\u5373\u521a\u521a\u4e0b\u8f7d\u4fdd\u5b58\u7684\u56fe\u7247\u7684\u76f8\u5bf9\u8def\u5f84\u6216\u7edd\u5bf9\u8def\u5f84\uff1f\u8fd9\u91cc\u6211\u4eec\u4e00\u822c\u4f7f\u7528\u76f8\u5bf9\u8def\u5f84\uff0c\u4ee5\u4fbf\u4e8e\u79fb\u52a8\u6574\u4e2a\u76ee\u5f55\u65f6\u4ecd\u80fd\u8bbf\u95ee\uff09\u3002</p> <p>\u4ee3\u7801\u5b9e\u73b0\u6b65\u9aa4\uff1a</p> <ol> <li>\u8bfb\u53d6Markdown\u6587\u4ef6\u5185\u5bb9\u3002</li> <li>\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914dMarkdown\u4e2d\u7684\u56fe\u7247\u8bed\u6cd5\uff08\u5982<code>![alt](url)</code>\uff09\u3002</li> <li>\u5bf9\u4e8e\u5339\u914d\u5230\u7684\u6bcf\u4e00\u4e2a\u56fe\u7247URL\uff1a     a. \u5982\u679cURL\u662f\u8fdc\u7a0b\u7684\uff08\u4ee5http\u6216https\u5f00\u5934\uff09\uff0c\u5219\u4e0b\u8f7d\u56fe\u7247\u5230\u672c\u5730\u76ee\u5f55\uff08\u4ee5Markdown\u6587\u4ef6\u540d\u547d\u540d\u7684\u76ee\u5f55\uff09\u3002     b. \u5982\u679c\u662f\u672c\u5730\u8def\u5f84\uff0c\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u8df3\u8fc7\uff0c\u6216\u8005\u4e5f\u5c06\u5176\u590d\u5236\u5230\u76ee\u6807\u76ee\u5f55\uff1f\u6839\u636e\u9700\u6c42\uff0c\u8fd9\u91cc\u4e3b\u8981\u662f\u5904\u7406\u8fdc\u7a0b\u56fe\u7247\uff0c\u6240\u4ee5\u8df3\u8fc7\u672c\u5730\u8def\u5f84\u3002</li> <li>\u5c06\u4e0b\u8f7d\u540e\u7684\u56fe\u7247\u672c\u5730\u8def\u5f84\uff08\u76f8\u5bf9\u4e8eMarkdown\u6587\u4ef6\u7684\u8def\u5f84\uff09\u66ff\u6362\u5230\u539fMarkdown\u6587\u672c\u4e2d\u3002</li> <li>\u5c06\u4fee\u6539\u540e\u7684Markdown\u5185\u5bb9\u5199\u56de\u539f\u6587\u4ef6\u6216\u65b0\u6587\u4ef6\uff0c\u53ef\u4ee5\u63d0\u4f9b\u9009\u9879\u6765\u63a7\u5236\u662f\u5426\u8986\u76d6\u539f\u6587\u4ef6\u3002</li> </ol> <p>\u6ce8\u610f\uff1a\u9700\u8981\u5904\u7406\u7f51\u7edc\u8bf7\u6c42\u548c\u6587\u4ef6\u64cd\u4f5c\uff0c\u56e0\u6b64\u9700\u8981\u5f15\u5165\u76f8\u5173\u5e93\u3002 \u5177\u4f53\u5b9e\u73b0\uff1a    - \u4f7f\u7528os\u6a21\u5757\u5904\u7406\u8def\u5f84\u548c\u76ee\u5f55\u3002    - \u4f7f\u7528re\u6a21\u5757\u5339\u914d\u56fe\u7247\u94fe\u63a5\u3002    - \u4f7f\u7528requests\u4e0b\u8f7d\u56fe\u7247\uff08\u6ce8\u610f\u5904\u7406\u5f02\u5e38\uff09\u3002</p> <p>\u53e6\u5916\uff0c\u4e3a\u4e86\u907f\u514d\u91cd\u590d\u4e0b\u8f7d\u540c\u4e00\u4e2a\u8fdc\u7a0b\u56fe\u7247\uff08\u5982\u679c\u540c\u4e00\u56fe\u7247\u5728\u6587\u4ef6\u4e2d\u591a\u6b21\u4f7f\u7528\uff09\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u7f13\u5b58\u5df2\u4e0b\u8f7d\u7684\u56fe\u7247\uff0c\u4f46\u4e5f\u53ef\u4ee5\u6bcf\u6b21\u9047\u5230\u90fd\u91cd\u65b0\u4e0b\u8f7d\uff08\u4e3a\u4e86\u7b80\u5355\uff0c\u6211\u4eec\u6bcf\u6b21\u9047\u5230\u90fd\u4e0b\u8f7d\uff0c\u4f46\u8fd9\u6837\u6548\u7387\u4f4e\uff0c\u6240\u4ee5\u6211\u4eec\u7528\u5b57\u5178\u7f13\u5b58\u5df2\u4e0b\u8f7d\u7684URL\u5bf9\u5e94\u7684\u672c\u5730\u8def\u5f84\uff09\u3002</p> <p>\u4f46\u662f\u6ce8\u610f\uff1a\u540c\u4e00\u4e2aURL\u53ef\u80fd\u5728\u4e0d\u540c\u4f4d\u7f6e\u9700\u8981\u4e0d\u540c\u7684\u6587\u4ef6\u540d\uff1f\u6216\u8005\u6211\u4eec\u53ef\u4ee5\u7528URL\u7684\u54c8\u5e0c\u6765\u547d\u540d\uff1f\u4f46\u8fd9\u6837\u53ef\u80fd\u4e0d\u4fbf\u4e8e\u7ba1\u7406\u3002\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528\u539f\u56fe\u7247\u6587\u4ef6\u540d\uff08\u4eceURL\u4e2d\u63d0\u53d6\uff09\u5e76\u4fdd\u5b58\u5230\u672c\u5730\u76ee\u5f55\u3002\u5982\u679c\u6587\u4ef6\u540d\u91cd\u590d\uff0c\u6211\u4eec\u53ef\u4ee5\u6dfb\u52a0\u540e\u7f00\u3002</p> <p>\u6b65\u9aa4\u7ec6\u5316\uff1a</p> <ol> <li>\u89e3\u6790Markdown\u6587\u4ef6\u8def\u5f84\uff0c\u5f97\u5230\u6587\u4ef6\u6240\u5728\u76ee\u5f55\u3001\u6587\u4ef6\u540d\uff08\u4e0d\u542b\u6269\u5c55\u540d\uff09\u7b49\u3002</li> <li>\u521b\u5efa\u4ee5Markdown\u6587\u4ef6\u540d\uff08\u4e0d\u542b\u6269\u5c55\u540d\uff09\u547d\u540d\u7684\u76ee\u5f55\uff0c\u4f4d\u4e8eMarkdown\u6587\u4ef6\u540c\u4e00\u76ee\u5f55\u4e0b\u3002</li> <li>\u8bfb\u53d6Markdown\u5185\u5bb9\u3002</li> <li>\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u627e\u5230\u6240\u6709\u56fe\u7247\u94fe\u63a5\u3002</li> <li>\u904d\u5386\u6bcf\u4e2a\u5339\u914d\u5230\u7684\u56fe\u7247\u94fe\u63a5\uff0c\u5bf9\u4e8e\u8fdc\u7a0bURL\uff1a<ul> <li>\u4eceURL\u4e2d\u63d0\u53d6\u6587\u4ef6\u540d\uff08\u5982\u679cURL\u672b\u5c3e\u6709\u6587\u4ef6\u540d\uff0c\u5219\u4f7f\u7528\uff1b\u5426\u5219\uff0c\u6839\u636e\u5185\u5bb9\u7c7b\u578b\u751f\u6210\u6587\u4ef6\u540d\uff0c\u4f46\u4e3a\u4e86\u7b80\u5355\uff0c\u6211\u4eec\u53ef\u4ee5\u7528URL\u7684\u54c8\u5e0c\u503c\u4f5c\u4e3a\u6587\u4ef6\u540d\uff0c\u5e76\u52a0\u4e0a\u6269\u5c55\u540d\uff0c\u4f46\u6269\u5c55\u540d\u9700\u8981\u4eceContent-Type\u83b7\u53d6\uff0c\u5982\u679c\u6ca1\u6709\u5219\u7528\u9ed8\u8ba4.jpg\uff09\u3002</li> <li>\u4e0b\u8f7d\u56fe\u7247\u5230\u521b\u5efa\u7684\u76ee\u5f55\u4e2d\u3002</li> <li>\u8bb0\u5f55\u4e0b\u8f7d\u540e\u7684\u672c\u5730\u76f8\u5bf9\u8def\u5f84\uff08\u76f8\u5bf9\u4e8eMarkdown\u6587\u4ef6\u7684\u8def\u5f84\uff0c\u4f8b\u5982\uff1a\"./markdown\u6587\u4ef6\u540d\u76ee\u5f55/image.jpg\"\uff09\u3002</li> <li>\u5c06\u539fMarkdown\u4e2d\u7684\u8fd9\u4e2aURL\u66ff\u6362\u4e3a\u672c\u5730\u8def\u5f84\u3002</li> </ul> </li> <li>\u5c06\u66ff\u6362\u540e\u7684\u5185\u5bb9\u5199\u56deMarkdown\u6587\u4ef6\u3002</li> </ol>"},{"location":"other/Python%E8%84%9A%E6%9C%AC%E5%A4%84%E7%90%86Markdown%E5%9B%BE%E7%89%87%E6%9C%AC%E5%9C%B0%E5%8C%96/#_3","title":"\u4ee3\u7801\u5b9e\u73b0","text":"<ol> <li>\u5b9a\u4e49\u51fd\u6570\uff1a<code>def convert_markdown_images(md_file_path, overwrite=False):</code>      \u5176\u4e2d\uff0c<code>overwrite</code>\u53c2\u6570\u7528\u4e8e\u63a7\u5236\u662f\u5426\u8986\u76d6\u539f\u6587\u4ef6\u3002\u5982\u679c\u4e0d\u8986\u76d6\uff0c\u5219\u751f\u6210\u65b0\u6587\u4ef6\uff0c\u6bd4\u5982\u5728\u539f\u6587\u4ef6\u540d\u540e\u52a0\u201c_local.md\u201d\u3002</li> <li>\u521b\u5efa\u76ee\u6807\u56fe\u7247\u76ee\u5f55\uff1a     <pre><code> base_name = os.path.basename(md_file_path)  # \u4f8b\u5982\uff1a'example.md'\n dir_name = os.path.splitext(base_name)[0]  # \u4f8b\u5982\uff1a'example'\n parent_dir = os.path.dirname(md_file_path)\n image_dir = os.path.join(parent_dir, dir_name)  # \u56fe\u7247\u5b58\u50a8\u76ee\u5f55\n # \u5982\u679c\u76ee\u5f55\u4e0d\u5b58\u5728\uff0c\u5219\u521b\u5efa\u3002\n</code></pre></li> <li>\u8bfb\u53d6Markdown\u6587\u4ef6\u5185\u5bb9\u3002</li> <li>\u6b63\u5219\u5339\u914d\uff1a<code>pattern = r'!\\[(.*?)\\]\\((.*?)\\)'</code>     \u6ce8\u610f\uff1a\u8fd9\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0f\u53ef\u80fd\u5339\u914d\u5230\u591a\u4e2a\uff0c\u6211\u4eec\u4f7f\u7528findall\u3002</li> <li>\u904d\u5386\u6240\u6709\u5339\u914d\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u5339\u914d\uff0calt_text\u662f\u7b2c\u4e00\u4e2a\u5206\u7ec4\uff0curl\u662f\u7b2c\u4e8c\u4e2a\u5206\u7ec4\u3002     \u5982\u679curl\u4ee5http://\u6216https://\u5f00\u5934\uff0c\u5219\u662f\u8fdc\u7a0b\u56fe\u7247\u3002     \u4e0b\u8f7d\u56fe\u7247\uff0c\u5e76\u4fdd\u5b58\u5230image_dir\u76ee\u5f55\u4e0b\u3002     \u4e0b\u8f7d\u65f6\uff0c\u6211\u4eec\u5c1d\u8bd5\u4eceurl\u4e2d\u83b7\u53d6\u6587\u4ef6\u540d\uff1a\u4f7f\u7528<code>url.split('/')[-1]</code>\uff0c\u7136\u540e\u53bb\u6389\u53ef\u80fd\u5305\u542b\u7684\u67e5\u8be2\u53c2\u6570\uff08\u7528?\u5206\u5272\u53d6\u7b2c\u4e00\u90e8\u5206\uff09\u3002     \u5982\u679c\u6587\u4ef6\u540d\u6ca1\u6709\u6269\u5c55\u540d\uff0c\u90a3\u4e48\u6211\u4eec\u4ece<code>Content-Type</code>\u4e2d\u83b7\u53d6\u6269\u5c55\u540d\uff08\u4f8b\u5982image/jpeg\u5219\u6269\u5c55\u540d\u4e3a.jpg\uff09\u3002     \u5982\u679c\u6587\u4ef6\u540d\u5df2\u7ecf\u5b58\u5728\uff0c\u4e3a\u4e86\u907f\u514d\u8986\u76d6\uff0c\u4e3a\u4e86\u7b80\u5355\uff0c\u6211\u4eec\u4f7f\u7528\u4e00\u4e2a\u51fd\u6570\u6765\u751f\u6210\u552f\u4e00\u7684\u6587\u4ef6\u540d\u3002</li> <li>\u4e0b\u8f7d\u56fe\u7247\u5e76\u4fdd\u5b58\u5230\u672c\u5730\u6587\u4ef6\uff0c\u540c\u65f6\u8bb0\u5f55\u672c\u5730\u76f8\u5bf9\u8def\u5f84\uff08\u76f8\u5bf9\u4e8eMarkdown\u6587\u4ef6\uff09\u3002     \u76f8\u5bf9\u8def\u5f84\uff1a\u4f8b\u5982\uff0c\u5982\u679cMarkdown\u6587\u4ef6\u5728<code>parent_dir</code>\uff0c\u56fe\u7247\u5728<code>parent_dir/dir_name</code>\uff0c\u90a3\u4e48\u76f8\u5bf9\u8def\u5f84\u5c31\u662f<code>./dir_name/filename.jpg</code></li> <li>\u66ff\u6362\u539f\u5b57\u7b26\u4e32\u4e2d\u7684url\u4e3a\u8fd9\u4e2a\u76f8\u5bf9\u8def\u5f84\u3002</li> <li>\u6ce8\u610f\uff1a\u540c\u4e00\u4e2aurl\u5728\u6587\u4ef6\u4e2d\u51fa\u73b0\u591a\u6b21\uff0c\u6211\u4eec\u53ef\u4ee5\u53ea\u4e0b\u8f7d\u4e00\u6b21\uff0c\u7136\u540e\u591a\u6b21\u66ff\u6362\u3002\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u7528\u4e00\u4e2a\u5b57\u5178\u6765\u7f13\u5b58url\u5230\u672c\u5730\u8def\u5f84\u7684\u6620\u5c04\u3002</li> <li>\u5c06\u4fee\u6539\u540e\u7684\u5185\u5bb9\u5199\u56de\u6587\u4ef6\uff08\u8986\u76d6\u539f\u6587\u4ef6\u6216\u65b0\u6587\u4ef6\uff09\u3002</li> <li>\u5f02\u5e38\u5904\u7406\uff1a\u4e0b\u8f7d\u56fe\u7247\u65f6\u53ef\u80fd\u5931\u8d25\uff0c\u53ef\u4ee5\u9009\u62e9\u8df3\u8fc7\u5e76\u6253\u5370\u8b66\u544a\u3002</li> </ol> <p>\u4ee5\u4e0b\u662f\u4e00\u4e2aPython\u811a\u672c\uff0c\u7528\u4e8e\u5904\u7406Markdown\u6587\u4ef6\u4e2d\u7684\u8fdc\u7a0b\u56fe\u7247\uff0c\u5c06\u5176\u4e0b\u8f7d\u5230\u672c\u5730\u76ee\u5f55\u5e76\u66ff\u6362\u94fe\u63a5\uff0c\u5e76\u652f\u6301\u4ece\u547d\u4ee4\u884c\u63a5\u6536Markdown\u6587\u4ef6\u8def\u5f84\u8fdb\u884c\u8f6c\u6362\uff1a</p> <pre><code>import os\nimport re\nimport requests\nimport uuid\nimport argparse\nimport sys\nimport glob\nfrom pathlib import Path\nfrom urllib.parse import urlparse\n\ndef process_markdown_images(md_file_path, overwrite=True):\n    \"\"\"\n    \u5904\u7406Markdown\u6587\u4ef6\u4e2d\u7684\u8fdc\u7a0b\u56fe\u7247\uff1a\n    1. \u521b\u5efa\u4e0eMarkdown\u6587\u4ef6\u540c\u540d\u7684\u76ee\u5f55\n    2. \u4e0b\u8f7d\u6240\u6709\u8fdc\u7a0b\u56fe\u7247\u5230\u8be5\u76ee\u5f55\n    3. \u66ff\u6362Markdown\u4e2d\u7684\u56fe\u7247\u94fe\u63a5\u4e3a\u672c\u5730\u76f8\u5bf9\u8def\u5f84\n\n    :param md_file_path: Markdown\u6587\u4ef6\u8def\u5f84\n    :param overwrite: \u662f\u5426\u8986\u76d6\u539f\u59cb\u6587\u4ef6\n    :return: (\u4e0b\u8f7d\u7684\u56fe\u7247\u6570\u91cf, \u8f93\u51fa\u6587\u4ef6\u8def\u5f84)\n    \"\"\"\n    # \u9a8c\u8bc1\u6587\u4ef6\u662f\u5426\u5b58\u5728\u4e14\u4e3a.md\u6587\u4ef6\n    if not os.path.isfile(md_file_path):\n        raise FileNotFoundError(f\"\u6587\u4ef6\u4e0d\u5b58\u5728: {md_file_path}\")\n\n    if not md_file_path.lower().endswith(('.md', '.markdown')):\n        raise ValueError(f\"\u4e0d\u662fMarkdown\u6587\u4ef6: {md_file_path}\")\n\n    # \u8bfb\u53d6Markdown\u5185\u5bb9\n    with open(md_file_path, 'r', encoding='utf-8') as f:\n        content = f.read()\n\n    # \u521b\u5efa\u56fe\u7247\u5b58\u50a8\u76ee\u5f55\n    base_name = Path(md_file_path).stem\n    parent_dir = Path(md_file_path).parent\n    image_dir = parent_dir / base_name\n    image_dir.mkdir(exist_ok=True)\n\n    # \u67e5\u627e\u6240\u6709\u56fe\u7247\u6807\u8bb0\n    pattern = r'!\\[(.*?)\\]\\((.*?)\\)'\n    matches = re.findall(pattern, content)\n\n    # \u7528\u4e8e\u8ddf\u8e2a\u5df2\u4e0b\u8f7d\u56fe\u7247\u907f\u514d\u91cd\u590d\u4e0b\u8f7d\n    downloaded = {}\n\n    # \u5904\u7406\u6bcf\u4e2a\u5339\u914d\u9879\n    def replace_match(match):\n        alt_text = match.group(1)\n        img_url = match.group(2).strip()  # \u53bb\u9664\u53ef\u80fd\u7684\u7a7a\u683c\n\n        # \u8df3\u8fc7\u975eHTTP\u94fe\u63a5\u548c\u7a7a\u94fe\u63a5\n        if not (img_url.startswith('http') and img_url):\n            return match.group(0)\n\n        # \u68c0\u67e5\u662f\u5426\u5df2\u4e0b\u8f7d\n        if img_url in downloaded:\n            return f'![{alt_text}]({downloaded[img_url]})'\n\n        try:\n            # \u4e0b\u8f7d\u56fe\u7247\n            response = requests.get(img_url, stream=True, timeout=30)\n            response.raise_for_status()\n\n            # \u83b7\u53d6\u6587\u4ef6\u6269\u5c55\u540d\n            content_type = response.headers.get('content-type', '')\n            ext = '.jpg'  # \u9ed8\u8ba4\u503c\n            if 'image/' in content_type:\n                ext = '.' + content_type.split('/')[-1]\n                # \u5904\u7406\u7279\u6b8a\u6269\u5c55\u540d\n                if ext == '.jpeg':\n                    ext = '.jpg'\n                elif ext == '.svg+xml':\n                    ext = '.svg'\n\n            # \u751f\u6210\u552f\u4e00\u6587\u4ef6\u540d\n            img_name = f\"{uuid.uuid4().hex[:8]}{ext}\"\n            img_path = image_dir / img_name\n            rel_path = f\"{base_name}/{img_name}\"\n\n            # \u4fdd\u5b58\u56fe\u7247\n            with open(img_path, 'wb') as img_file:\n                for chunk in response.iter_content(1024):\n                    img_file.write(chunk)\n\n            # \u8bb0\u5f55\u5df2\u4e0b\u8f7d\u56fe\u7247\n            downloaded[img_url] = rel_path\n            return f'![{alt_text}]({rel_path})'\n\n        except Exception as e:\n            print(f\"\u8b66\u544a: \u4e0b\u8f7d\u5931\u8d25 [{img_url}] - {str(e)}\")\n            return match.group(0)\n\n    # \u66ff\u6362\u6240\u6709\u8fdc\u7a0b\u56fe\u7247\u94fe\u63a5\n    new_content = re.sub(pattern, replace_match, content)\n\n    # \u786e\u5b9a\u8f93\u51fa\u6587\u4ef6\u8def\u5f84\n    if overwrite:\n        output_path = md_file_path\n    else:\n        # \u6dfb\u52a0\u540e\u7f00 \"_local\" \u5230\u6587\u4ef6\u540d\n        path_obj = Path(md_file_path)\n        output_path = path_obj.with_name(f\"{path_obj.stem}_local{path_obj.suffix}\")\n\n    # \u5199\u5165\u8f93\u51fa\u6587\u4ef6\n    with open(output_path, 'w', encoding='utf-8') as f:\n        f.write(new_content)\n\n    return len(downloaded), output_path\n\ndef expand_file_patterns(patterns, recursive=False):\n    \"\"\"\u6269\u5c55\u6587\u4ef6\u6a21\u5f0f\u4e3a\u5b9e\u9645\u6587\u4ef6\u5217\u8868\"\"\"\n    files = []\n    for pattern in patterns:\n        # \u5904\u7406\u76ee\u5f55\n        if os.path.isdir(pattern):\n            files.extend(glob.glob(os.path.join(pattern, '*.md')))\n            files.extend(glob.glob(os.path.join(pattern, '*.markdown')))\n            if recursive:\n                for root, dirs, filenames in os.walk(pattern):\n                    files.extend(glob.glob(os.path.join(root, '*.md')))\n                    files.extend(glob.glob(os.path.join(root, '*.markdown')))\n        # \u5904\u7406\u901a\u914d\u7b26\n        else:\n            expanded = glob.glob(pattern, recursive=recursive)\n            if not expanded:\n                # \u5982\u679c\u6ca1\u6709\u5339\u914d\u9879\uff0c\u5c1d\u8bd5\u6dfb\u52a0\u901a\u914d\u7b26\n                if not pattern.endswith('*'):\n                    expanded = glob.glob(pattern + '*', recursive=recursive)\n                # \u5982\u679c\u8fd8\u662f\u6ca1\u6709\u5339\u914d\u9879\uff0c\u5c1d\u8bd5\u4f5c\u4e3a\u6587\u4ef6\u5904\u7406\n                if not expanded and os.path.isfile(pattern):\n                    expanded = [pattern]\n            files.extend(expanded)\n\n    # \u53bb\u91cd\u5e76\u8fc7\u6ee4\u975eMarkdown\u6587\u4ef6\n    unique_files = set()\n    for file in files:\n        if os.path.isfile(file) and file.lower().endswith(('.md', '.markdown')):\n            unique_files.add(os.path.abspath(file))\n\n    return sorted(unique_files)\n\ndef main():\n    # \u8bbe\u7f6e\u547d\u4ee4\u884c\u53c2\u6570\u89e3\u6790\n    parser = argparse.ArgumentParser(\n        description='\u5c06Markdown\u4e2d\u7684\u8fdc\u7a0b\u56fe\u7247\u4e0b\u8f7d\u5230\u672c\u5730\u5e76\u66ff\u6362\u94fe\u63a5',\n        epilog='\u793a\u4f8b:\\n'\n               '  \u5904\u7406\u5355\u4e2a\u6587\u4ef6: python md_image_localizer.py doc.md\\n'\n               '  \u5904\u7406\u591a\u4e2a\u6587\u4ef6: python md_image_localizer.py doc1.md doc2.md\\n'\n               '  \u5904\u7406\u76ee\u5f55: python md_image_localizer.py docs/\\n'\n               '  \u4f7f\u7528\u901a\u914d\u7b26: python md_image_localizer.py \"*.md\" \"chapter_*/*.md\"'\n    )\n    parser.add_argument(\n        'paths', \n        nargs='+',\n        help='\u8981\u5904\u7406\u7684Markdown\u6587\u4ef6\u8def\u5f84\u3001\u76ee\u5f55\u6216\u901a\u914d\u7b26\u6a21\u5f0f'\n    )\n    parser.add_argument(\n        '-v', '--verbose',\n        action='store_true',\n        help='\u663e\u793a\u8be6\u7ec6\u5904\u7406\u4fe1\u606f'\n    )\n    parser.add_argument(\n        '-r', '--recursive',\n        action='store_true',\n        help='\u9012\u5f52\u5904\u7406\u76ee\u5f55\u4e2d\u7684Markdown\u6587\u4ef6'\n    )\n    parser.add_argument(\n        '--no-overwrite',\n        action='store_true',\n        help='\u4e0d\u8986\u76d6\u539f\u59cb\u6587\u4ef6\uff0c\u751f\u6210\u65b0\u6587\u4ef6\uff08\u6dfb\u52a0\"_local\"\u540e\u7f00\uff09'\n    )\n\n    args = parser.parse_args()\n\n    # \u6269\u5c55\u6587\u4ef6\u5217\u8868\n    files_to_process = expand_file_patterns(args.paths, args.recursive)\n\n    if not files_to_process:\n        print(\"\u9519\u8bef: \u6ca1\u6709\u627e\u5230\u53ef\u5904\u7406\u7684Markdown\u6587\u4ef6\", file=sys.stderr)\n        sys.exit(1)\n\n    if args.verbose:\n        print(f\"\u627e\u5230 {len(files_to_process)} \u4e2aMarkdown\u6587\u4ef6:\")\n        for i, file in enumerate(files_to_process, 1):\n            print(f\"  {i}. {file}\")\n\n    # \u5904\u7406\u6bcf\u4e2a\u6587\u4ef6\n    total_images = 0\n    processed_files = 0\n\n    for file_path in files_to_process:\n        try:\n            if args.verbose:\n                print(f\"\\n\u6b63\u5728\u5904\u7406: {file_path}\")\n                print(f\"  \u8986\u76d6\u6a21\u5f0f: {'\u662f' if not args.no_overwrite else '\u5426'}\")\n\n            count, output_path = process_markdown_images(\n                file_path, \n                overwrite=not args.no_overwrite\n            )\n            total_images += count\n            processed_files += 1\n\n            if args.verbose:\n                print(f\"  \u4e0b\u8f7d\u4e86 {count} \u5f20\u56fe\u7247\")\n                print(f\"  \u8f93\u51fa\u6587\u4ef6: {output_path}\")\n            else:\n                print(f\"\u5904\u7406\u5b8c\u6210: {output_path} (\u4e0b\u8f7d {count} \u5f20\u56fe\u7247)\")\n\n        except Exception as e:\n            print(f\"\u9519\u8bef: \u5904\u7406\u6587\u4ef6 {file_path} \u5931\u8d25 - {str(e)}\", file=sys.stderr)\n\n    # \u8f93\u51fa\u603b\u7ed3\n    print(\"\\n\u5904\u7406\u5b8c\u6210!\")\n    print(f\"\u5df2\u5904\u7406\u6587\u4ef6: {processed_files}/{len(files_to_process)}\")\n    print(f\"\u603b\u4e0b\u8f7d\u56fe\u7247: {total_images} \u5f20\")\n    if args.no_overwrite:\n        print(\"\u6ce8\u610f: \u539f\u59cb\u6587\u4ef6\u672a\u4fee\u6539\uff0c\u5df2\u751f\u6210\u65b0\u6587\u4ef6\uff08\u6dfb\u52a0\u4e86'_local'\u540e\u7f00\uff09\")\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"other/Python%E8%84%9A%E6%9C%AC%E5%A4%84%E7%90%86Markdown%E5%9B%BE%E7%89%87%E6%9C%AC%E5%9C%B0%E5%8C%96/#_4","title":"\u4f7f\u7528\u793a\u4f8b","text":"<ol> <li> <p>\u9ed8\u8ba4\u884c\u4e3a\uff08\u8986\u76d6\u539f\u59cb\u6587\u4ef6\uff09\uff1a    <pre><code>python md_image_localizer.py document.md\n</code></pre></p> </li> <li> <p>\u4fdd\u7559\u539f\u59cb\u6587\u4ef6\uff08\u751f\u6210\u65b0\u6587\u4ef6\uff09\uff1a    <pre><code>python md_image_localizer.py document.md --no-overwrite\n# \u751f\u6210 document_local.md\n</code></pre></p> </li> <li> <p>\u6279\u91cf\u5904\u7406\u5e76\u4fdd\u7559\u539f\u59cb\u6587\u4ef6\uff1a    <pre><code>python md_image_localizer.py *.md --no-overwrite\n# \u4e3a\u6bcf\u4e2a.md\u6587\u4ef6\u751f\u6210\u5bf9\u5e94\u7684_local.md\u6587\u4ef6\n</code></pre></p> </li> <li> <p>\u7ed3\u5408\u5176\u4ed6\u9009\u9879\uff1a    <pre><code>python md_image_localizer.py docs/ -r --no-overwrite -v\n# \u9012\u5f52\u5904\u7406docs\u76ee\u5f55\uff0c\u4fdd\u7559\u539f\u59cb\u6587\u4ef6\uff0c\u663e\u793a\u8be6\u7ec6\u4fe1\u606f\n</code></pre></p> </li> </ol> <p>\u8f93\u51fa\u793a\u4f8b\uff08\u4f7f\u7528 <code>--no-overwrite</code>\uff09\uff1a</p> <pre><code>\u627e\u5230 2 \u4e2aMarkdown\u6587\u4ef6:\n  1. /projects/docs/chapter1.md\n  2. /projects/docs/chapter2.md\n\n\u6b63\u5728\u5904\u7406: /projects/docs/chapter1.md\n  \u8986\u76d6\u6a21\u5f0f: \u5426\n  \u4e0b\u8f7d\u4e86 3 \u5f20\u56fe\u7247\n  \u8f93\u51fa\u6587\u4ef6: /projects/docs/chapter1_local.md\n\n\u6b63\u5728\u5904\u7406: /projects/docs/chapter2.md\n  \u8986\u76d6\u6a21\u5f0f: \u5426\n  \u4e0b\u8f7d\u4e86 5 \u5f20\u56fe\u7247\n  \u8f93\u51fa\u6587\u4ef6: /projects/docs/chapter2_local.md\n\n\u5904\u7406\u5b8c\u6210!\n\u5df2\u5904\u7406\u6587\u4ef6: 2/2\n\u603b\u4e0b\u8f7d\u56fe\u7247: 8 \u5f20\n\u6ce8\u610f: \u539f\u59cb\u6587\u4ef6\u672a\u4fee\u6539\uff0c\u5df2\u751f\u6210\u65b0\u6587\u4ef6\uff08\u6dfb\u52a0\u4e86'_local'\u540e\u7f00\uff09\n</code></pre>"},{"location":"other/%E4%BC%98%E7%A7%80%E5%8D%9A%E5%AE%A2%E6%B1%87%E6%80%BB/","title":"\u4f18\u79c0\u535a\u5ba2\u6c47\u603b","text":"<ol> <li>\u5b66\u4e60 k8s \u7684\u4f18\u79c0\u535a\u5ba2</li> </ol> <p>https://www.guji.work/?cat=15</p>"},{"location":"other/%E4%BD%BF%E7%94%A8Awescnb%E6%9E%84%E5%BB%BA%E9%85%B7%E7%82%AB%E7%9A%84%E5%8D%9A%E5%AE%A2%E5%9B%AD%E7%9A%AE%E8%82%A4/","title":"\u4f7f\u7528Awescnb\u6784\u5efa\u9177\u70ab\u7684\u535a\u5ba2\u56ed\u76ae\u80a4","text":""},{"location":"other/%E4%BD%BF%E7%94%A8Awescnb%E6%9E%84%E5%BB%BA%E9%85%B7%E7%82%AB%E7%9A%84%E5%8D%9A%E5%AE%A2%E5%9B%AD%E7%9A%AE%E8%82%A4/#_1","title":"\u4e00. \u6982\u8ff0","text":"<p>\u57fa\u4e8e vite \u548c webpack 5\uff0c\u6784\u5efa\u3001\u5b89\u88c5\u3001\u5207\u6362\u535a\u5ba2\u56ed\u76ae\u80a4</p> <p>\u6e90\u7801\u5730\u5740\uff1ahttps://gitee.com/guangzan/awescnb</p> <p>\u7ecf\u5e38\u6d4f\u89c8\u535a\u5ba2\u56ed\uff0c\u770b\u5230\u522b\u4eba\u7684\u535a\u5ba2\u975e\u5e38\u9177\u70ab\uff0c\u6240\u4ee5\u4e5f\u60f3\u5b9a\u4e49\u4e00\u4e2a\u9177\u70ab\u7684\u9875\u9762\uff0c\u4f46\u662f\u53d1\u73b0\u81ea\u5df1\u7684\u524d\u7aef css \u6c34\u5e73\u592a\u5dee\uff0c\u53ea\u4f1a\u4fee\u6539\u535a\u5ba2\u56ed\u7684\u5b57\u4f53\u5927\u5c0f\u548c\u989c\u8272\uff0c\u767e\u5ea6\u4e86\u4e00\u4e0b\u76f8\u5173\u7684\u6587\u6863\uff0c\u627e\u5230\u4e86 <code>awescnb</code> \u8fd9\u4e2a\u5f00\u6e90\u4ed3\u5e93\uff0c\u80fd\u591f\u6ee1\u8db3\u6211\u7684\u9700\u6c42\uff0c\u63a5\u4e0b\u6765\u6211\u5c06\u8bb0\u5f55\u4e00\u4e0b\u81ea\u5df1\u4f7f\u7528  <code>awescnb</code> \u6784\u5efa\u535a\u5ba2\u56ed\u76ae\u80a4\u7684\u8fc7\u7a0b\uff0c\u66f4\u591a\u8be6\u7ec6\u7684\u914d\u7f6e\u53ef\u4ee5\u67e5\u770b\u6587\u7ae0\u540e\u9762\u7684\u53c2\u8003\u6587\u6863\u3002</p> <p>\u4e0b\u9762\u662f\u6211\u4f7f\u7528  <code>awescnb</code> \u6784\u5efa\u7684\u535a\u5ba2\u56ed\uff1a</p> <p></p>"},{"location":"other/%E4%BD%BF%E7%94%A8Awescnb%E6%9E%84%E5%BB%BA%E9%85%B7%E7%82%AB%E7%9A%84%E5%8D%9A%E5%AE%A2%E5%9B%AD%E7%9A%AE%E8%82%A4/#awescnb_1","title":"\u4e8c. \u4f7f\u7528Awescnb\u5b89\u88c5\u535a\u5ba2\u56ed\u76ae\u80a4","text":"<ol> <li>\u6253\u5f00\u4f60\u7684\u535a\u5ba2\u9996\u9875 -&gt; \u7ba1\u7406 -&gt; \u8bbe\u7f6e</li> </ol> <ol> <li>\u8bbe\u7f6e\u535a\u5ba2\u76ae\u80a4\u4e3a <code>Custom</code> \uff0c\u6e32\u67d3\u5f15\u64ce\u9009\u62e9 <code>highlight.js</code>\uff0c\u53d6\u6d88\u52fe\u9009\u663e\u793a\u884c\u53f7\uff0c\u4e3b\u9898\u6837\u5f0f\u9009\u62e9\u9ed8\u8ba4\u7684 <code>cnblogs</code></li> </ol> <ol> <li>\u590d\u5236\u5982\u4e0b\u4ee3\u7801\u7c98\u8d34\u5230\u3010\u9875\u9762\u5b9a\u5236 CSS\u3011\u5e76\u7981\u7528\u9ed8\u8ba4 CSS \u6837\u5f0f</li> </ol> <p><pre><code>#loading{bottom:0;left:0;position:fixed;right:0;top:0;z-index:9999;background-color:#f4f5f5;pointer-events:none;}.loader-inner{will-change:transform;width:40px;height:40px;position:absolute;top:50%;left:50%;margin:-20px 0 0 -20px;background-color:#3742fa;border-radius:50%;animation:scaleout 0.6s infinite ease-in-out forwards;text-indent:-99999px;z-index:999991;}@keyframes scaleout{0%{transform:scale(0);opacity:0;}40%{opacity:1;}100%{transform:scale(1);opacity:0;}}\n</code></pre> </p> <ol> <li>\u590d\u5236\u5982\u4e0b\u4ee3\u7801\u7c98\u8d34\u5230\u3010\u9875\u9996 HTML\u3011</li> </ol> <pre><code>&lt;div id=\"loading\"&gt;&lt;div class=\"loader-inner\"&gt;&lt;/div&gt;&lt;/div&gt;\n</code></pre> <p></p> <ol> <li>\u590d\u5236\u5982\u4e0b\u4ee3\u7801\u7c98\u8d34\u5230\u3010\u9875\u811a HTML \u4ee3\u7801\u3011\uff08\u5982\u6ca1\u5f00\u901a js \u6743\u9650\u8bf7\u5148\u5f00\u901a\uff0c\u7406\u7531\u586b\u201c\u9002\u5ea6\u7f8e\u5316\u535a\u5ba2\u201d\uff09\u3002</li> </ol> <pre><code>&lt;!-- @format --&gt;\n\n&lt;script src=\"https://guangzan.gitee.io/awescnb/index.js\"&gt;&lt;/script&gt;\n&lt;script&gt;\n  const opts = {\n    // \u57fa\u672c\u914d\u7f6e\n    theme: {\n      name: 'reacg',\n      color: '#88b8f5',\n      title: '',\n      avatar: 'https://gitee.com/peterwd/pic-oss/raw/master/image/202112031032364.jpeg',\n      favicon: 'https://gitee.com/peterwd/pic-oss/raw/master/image/202112031032364.jpeg',\n      headerBackground: 'https://api.uomg.com/api/rand.avatar',\n      log: false,\n    },\n    // \u4ee3\u7801\u9ad8\u4eae\n    highLight: {\n      enable: true,\n    },\n    // \u4ee3\u7801\u884c\u53f7\n    lineNumbers: {\n      enable: true,\n    },\n    // \u7801\u4e91\u56fe\u6807\n    gitee: {\n      enable: true,\n      url: 'https://gitee.com/peterwd',\n    },\n    // \u56fe\u7247\u706f\u7bb1\n    imagebox: {\n      enable: true,\n    },\n    // \u6587\u7ae0\u76ee\u5f55\n    catalog: {\n      enable: true,\n    },\n    // \u53f3\u4e0b\u89d2\u6309\u94ae\u7ec4\n    tools: {\n      enable: true,\n    },\n    // live2d\u6a21\u578b\n    live2d: {\n      enable: true,\n      model: 'haru-01',\n    },\n    // \u70b9\u51fb\u7279\u6548\n    click: {\n      enable: true,\n    },\n    // \u8bc4\u8bba\u8f93\u5165\u6846\u8868\u60c5\n    emoji: {\n      enable: true,\n    },\n    // \u6697\u8272\u6a21\u5f0f\n    darkMode: {\n      enable: true,\n      autoDark: false,\n      autoLight: false,\n    },\n    // \u97f3\u4e50\u64ad\u653e\u5668\n    musicPlayer: {\n      enable: true,\n      page: 'all',\n      agent: 'pc',\n      autoplay: false,\n      volume: 0.4,\n      lrc: {\n        enable: true, // \u542f\u7528\u6b4c\u8bcd\n        type: 1, // 1 -&gt; \u5b57\u7b26\u4e32\u6b4c\u8bcd 3 -&gt; url \u6b4c\u8bcd\n        color: '', // \u989c\u8272\n      },\n      audio: [\n        {\n          name: '\u4e0d\u8981\u8bf4\u8bdd',\n          artist: 'REOL',\n          url: 'http://music.163.com/song/media/outer/url?id=25906124.mp3',\n          cover: 'https://guangzan.gitee.io/imagehost/awescnb/music/demo.jpg',\n          lrc: ``,\n        },\n        {\n          name: '\u8fd9\u4e16\u754c\u90a3\u4e48\u591a\u4eba',\n          artist: 'REOL',\n          url: 'http://music.163.com/song/media/outer/url?id=1842025914.mp3',\n          cover: 'https://gitee.com/peterwd/pic-oss/raw/master/image/202112031124807.jpeg',\n          lrc: ``,\n        },\n        {\n          name: '\u76db\u590f\u7684\u679c\u5b9e',\n          artist: 'REOL',\n          url: 'http://music.163.com/song/media/outer/url?id=277382.mp3',\n          cover: 'https://gitee.com/peterwd/pic-oss/raw/master/image/202112031128356.jpg',\n          lrc: ``,\n        },\n      ],\n    },\n    // \u968f\u7b14\u5934\u56fe\n    postTopimage: {\n      enable: true,\n    },\n    // \u968f\u7b14\u5c3e\u56fe\n    postBottomimage: {\n      enable: true,\n    },\n    // \u6253\u8d4f\u4e8c\u7ef4\u7801\n    donation: {\n      enable: false,\n      qrcodes: [],\n    },\n    // \u4e2a\u6027\u7b7e\u540d\n    signature: {\n      enable: false,\n      contents: [],\n    },\n    // \u4fa7\u8fb9\u680f\u4e8c\u7ef4\u7801\n    qrcode: {\n      enable: false,\n      img: '',\n      desc: '',\n    },\n\n    // \u968f\u7b14\u9875\u5c3e\u90e8\u7b7e\u540d\n    postSignature: {\n      enable: true,\n      content: [],\n      licenseName: '',\n      licenseLink: '',\n    },\n    // \u80cc\u666f\u56fe\u7247\u6216\u989c\u8272\n    bodyBackground: {\n      enable: true,\n      value: '#88b8f5',\n      opacity: 1,\n      repeat: false,\n    },\n    // \u81ea\u5b9a\u4e49\u94fe\u63a5\u94fe\u63a5\n    links: [\n      {\n        name: '\u81ea\u5b9a\u4e49\u94fe\u63a5',\n        link: '',\n      },\n    ],\n  }\n  $.awesCnb(opts)\n&lt;/script&gt;\n</code></pre> <p></p> <ol> <li>\u70b9\u51fb\u4fdd\u5b58\uff0c\u8fdb\u5165\u4f60\u7684\u535a\u5ba2\u67e5\u770b\u6548\u679c\u3002</li> </ol> <p>\u53c2\u8003\u6587\u6863</p> <p>https://www.yuque.com/awescnb/user/tmpomo</p>"},{"location":"other/%E5%9C%A8markdown%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%A1%A8%E6%83%85%E7%AC%A6%E5%8F%B7/","title":"\u5728 markdown \u4e2d\u4f7f\u7528\u8868\u60c5\u7b26\u53f7\ud83d\ude0d","text":""},{"location":"other/%E5%9C%A8markdown%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%A1%A8%E6%83%85%E7%AC%A6%E5%8F%B7/#1","title":"1\ufe0f\u20e3 \u6982\u8ff0","text":"<p>\u7ecf\u5e38\u770b\u5230\u522b\u4eba\u5199\u7684\u6587\u7ae0\u4e2d\u6709\u5404\u79cd\u6709\u8da3\u7684\u8868\u60c5\u7b26\u53f7\uff0c\u50cf\u662f\u8fd9\u6837\u7684\ud83d\ude02\uff0c\u5728\u6587\u7ae0\u4e2d\u6dfb\u52a0\u4e00\u4e9b\u8868\u60c5\u7b26\u53f7\u80fd\u591f\u589e\u5f3a\u6587\u7ae0\u7684\u8da3\u5473\u6027\ud83d\ude0a\uff0c\u5bf9\u4e8e\u8fd9\u4e9b\u8868\u60c5\u7b26\u53f7\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u590d\u5236\u7c98\u8d34\u4f7f\u7528\uff0c\u8fd9\u4e9b\u8868\u60c5\u7b26\u53f7\u5230\u5e95\u662f\u4ec0\u4e48\u5462\uff1f</p> <p>\u8fd9\u79cd\u8868\u60c5\u7b26\u53f7\u7684\u5b98\u65b9\u540d\u5b57\u53eb\u505a <code>emoji</code> \uff0c\u6765\u81ea\u65e5\u8bed\u8bcd\u6c47\u201c\u7d75\u6587\u5b57\u201d\uff08\u5047\u540d\u4e3a\u201c\u3048\u3082\u3058\u201d\uff0c\u8bfb\u97f3\u5373 <code>emoji</code>\uff09\uff0c<code>emoji</code> \u7684\u521b\u9020\u8005\u662f\u65e5\u672c\u4eba\u6817\u7530\u7a70\u5d07\u3002</p> <p><code>emoji</code> \u662f\u4e00\u79cd\u6587\u672c\u7c7b\u578b\u7684\u8c61\u5f62\u7b26\u53f7\uff0c \u5b83\u548c\u56fe\u7247\u3001\u8868\u60c5\u5305\u4e0d\u540c\uff0c\u5b83\u80fd\u591f\u5728\u4efb\u4f55\u6587\u672c\u8f93\u5165\u7684\u5730\u65b9\u4f7f\u7528\uff0c\u56e0\u4e3a\u5b83\u672c\u8eab\u5c31\u662f\u4e00\u79cd\u6587\u5b57 \uff1b\u6700\u65b0\u7684 <code>emoji 13.1</code>\u7248\u672c\u5305\u542b1816\u4e2a\u72ec\u7acb\u7684\u8868\u60c5\u7b26\u53f7\uff08\u8be5\u7edf\u8ba1\u4e0d\u5305\u542b\u7531\u591a\u7b26\u53f7\u7ec4\u6210\u548c\u5176\u4ed6\u80a4\u8272\u7684\u8868\u60c5\u7b26\u53f7\uff09\uff0c<code>emoji</code> \u80fd\u591f\u5728\u5404\u4e2a\u4e0d\u540c\u7684\u64cd\u4f5c\u5e73\u53f0\u4e0a\u663e\u793a\uff0c\u4f46\u663e\u793a\u6548\u679c\u4f1a\u6709\u4e00\u4e9b\u4e0d\u540c\uff0c\u5982\u4e0b\u56fe\u663e\u793a\u4e86\u4e0d\u540c\u64cd\u4f5c\u5e73\u53f0\u4e0a\u7684\u8868\u60c5\u7b26\u53f7\uff1a</p> <p></p> <p><code>emoji</code> \u53d1\u660e\u7684\u521d\u8877\u662f\u4e3a\u4e86\u8ba9\u4eba\u4eec\u7684\u8868\u8fbe\u66f4\u52a0\u7684\u591a\u6837\u5316\u548c\u8da3\u5473\u6027\uff0c\u53d1\u5c55\u5230\u73b0\u5728\u66f4\u50cf\u662f\u4e00\u79cd\u65b0\u7684\u8bed\u8a00\uff0c\u5e76\u6709\u81ea\u5df1\u72ec\u7279\u7684\u9b45\u529b\uff0c\u5b83\u5728\u6211\u4eec\u65e5\u5e38\u7684\u7f51\u7edc\u804a\u5929\u4e2d\u968f\u5904\u53ef\u89c1\uff0c\u901a\u8fc7\u5b83\u4f60\u53ef\u4ee5\u4e86\u89e3\u5230\u884c\u884c\u6587\u5b57\u540e\u7684\u611f\u60c5\uff0c\u751a\u81f3\u4e8e\u4e00\u4e2a <code>emoji</code> \u5c31\u53ef\u4ee5\u8868\u8fbe\u6211\u4eec\u5f53\u4e0b\u7684\u5fc3\u60c5\uff0c</p> <p>\u7edf\u4e00\u7801\u8054\u76df(Unicode Consortium)\u6bcf\u5e74\u90fd\u4f1a\u63a8\u51fa\u8bb8\u591a\u65b0\u7684 <code>emoji</code>\uff0c\u5927\u5bb6\u53ea\u8981\u53ca\u65f6\u66f4\u65b0\u81ea\u5df1\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5c31\u53ef\u4ee5\u66f4\u597d\u7684\u663e\u793a\u8fd9\u4e9b\u53c8\u65b0\u53c8\u6709\u8da3\u7684 <code>emoji</code> \u4e86\u3002</p> <p>\u8bf4\u660e\uff1a\u4e00\u4e2a <code>emoji</code> \u5b57\u7b26\u5360 4 \u4e2a\u5b57\u8282\uff0c\u5728 <code>MySQL</code> \u5efa\u8868\u65f6\uff0c\u5efa\u8bae\u4f7f\u7528 <code>utf8mb4</code> \u5b57\u7b26\u96c6\uff0c\u53ef\u4ee5\u5b58\u50a8\u8868\u60c5\u7b26\u53f7\u3002</p> <p><code>MySQL 8.0</code>\u5f00\u59cb\uff1a \u9ed8\u8ba4\u5b57\u7b26\u96c6\u4e3a<code>utf8mb4</code></p>"},{"location":"other/%E5%9C%A8markdown%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%A1%A8%E6%83%85%E7%AC%A6%E5%8F%B7/#2","title":"2\ufe0f\u20e3 \u8868\u60c5\u7b26\u53f7\u8d44\u6e90\u7f51\u7ad9","text":"<ul> <li>\u5b8c\u6574\u7684\u8868\u60c5\u7b26\u53f7\u6c47\u603b  v13.1</li> </ul> <p>\u53ef\u4ee5\u5728\u8fd9\u91cc\u67e5\u770b\u8868\u60c5\u7b26\u53f7\u7684 Code \u4ee5\u53ca\u4e0d\u540c\u5e73\u53f0\u7684\u663e\u793a\u6548\u679c\u3002</p> <ul> <li>\u8868\u60c5\u7b26\u53f7 Unicode \u5217\u8868</li> </ul> <p></p> <ul> <li>\u8868\u60c5\u7b26\u53f7\u5907\u5fd8\u6e05\u5355</li> </ul> <p></p> <p>\u5728 markdown \u4ee5\u53ca\u90e8\u5206\u5e73\u53f0\u53ef\u4ee5\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\u7684\u8868\u60c5\u7b26\u53f7\uff0c\u683c\u5f0f\u4e3a <code>:smile:</code>\uff0c\u5728\u540e\u9762\u5c06\u5217\u51fa\u54ea\u4e9b\u5e38\u7528\u7684\u5e73\u53f0\u652f\u6301\u4f7f\u7528\u8fd9\u79cd\u8868\u60c5\u7b26\u53f7\u3002</p> <ul> <li>\u8868\u60c5\u7b26\u53f7\u4e2d\u6587\u7f51</li> </ul> <p></p> <p>\u8868\u60c5\u7b26\u53f7\u4e2d\u6587\u7f51\u7ad9\u6709\u6700\u5168\u6700\u8be6\u7ec6\u7684 <code>emoji</code> \u56fe\u6807\uff0c\u540c\u65f6\u652f\u6301\u5206\u7c7b\u3001\u68c0\u7d22\u3001\u4e13\u680f\u63a8\u8350\u3001<code>emoji</code> \u5c0f\u6e38\u620f\u7b49\u529f\u80fd\u3002\u53ef\u4ee5\u76f4\u63a5\u5728\u7f51\u7ad9\u4e2d\u641c\u7d22\u9700\u8981\u7684\u8868\u60c5\u7b26\u53f7\uff0c\u590d\u5236\u7c98\u8d34\u5373\u53ef\u4f7f\u7528\uff0c\u975e\u5e38\u65b9\u4fbf\u3002</p>"},{"location":"other/%E5%9C%A8markdown%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%A1%A8%E6%83%85%E7%AC%A6%E5%8F%B7/#3-markdown","title":"3\ufe0f\u20e3 \u5728 markdown \u4e2d\u4f7f\u7528\u8868\u60c5\u7b26\u53f7","text":""},{"location":"other/%E5%9C%A8markdown%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%A1%A8%E6%83%85%E7%AC%A6%E5%8F%B7/#1_1","title":"1. \u57fa\u672c\u7528\u6cd5","text":"<p>\u8bed\u6cd5\uff1a<code>&amp;#xc;ode;</code>  (\u6ce8\u610f\u6700\u540e\u7684\u5206\u53f7 <code>;</code> \u4e0d\u53ef\u5c11)</p> <p>\u5176\u4e2d code \u53ef\u4ee5\u4ece\u8868\u60c5\u7b26\u53f7 Unicode \u5217\u8868\u4e2d\u67e5\u5230</p> <p>\u4f8b\u5b50\uff1a \u67e5\u5230\u4e86 \u8868\u60c5\u5bf9\u5e94\u7684 Unicode \u7f16\u7801\u4e3a <code>U+1F600</code>\uff0c\u5219\u4e0e\u6b64\u8868\u60c5\u5bf9\u5e94\u7684 <code>CODE</code> \u4e3a <code>1F600</code> (\u820d\u5f03\u524d\u9762\u7684 U+)\u3002\u6211\u4eec\u53ea\u9700\u5728 Markdown \u6587\u6863\u4e2d\u8f93\u5165 <code>&amp;#x1F600;</code> \u5373\u53ef\u663e\u793a\u4e3a \ud83d\ude00\u3002</p> <p>\u4e0b\u9762\u7684\u7b26\u53f7\u663e\u793a\u5982\u4e0b\uff1a</p> <pre><code>&amp;#x1F600;\n&amp;#x1F601;\n&amp;#x1F602;\n&amp;#x1F603;\n&amp;#x1F604;\n&amp;#x1F605;\n</code></pre> <p>\ud83d\ude00 \ud83d\ude01 \ud83d\ude02 \ud83d\ude03 \ud83d\ude04 \ud83d\ude05</p>"},{"location":"other/%E5%9C%A8markdown%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%A1%A8%E6%83%85%E7%AC%A6%E5%8F%B7/#2_1","title":"2. \u5e38\u7528\u7684\u8868\u60c5\uff1a\u76f4\u63a5\u590d\u5236\u7c98\u8d34\u5373\u53ef\u4f7f\u7528","text":"<p>\ud83d\ude00 \ud83d\ude03 \ud83e\udd70 \ud83d\ude0d \ud83d\ude18</p> <p>\u2764\ufe0f \u2728\u2b50 \u2757\u2753\u2755\u2754 </p> <p>\u270a\u270c\ufe0f \u270b\u270b \u261d\ufe0f \ud83d\udc4f \ud83e\udd1d</p> <p>\u2600\ufe0f \u2614 \u2601\ufe0f \u2744\ufe0f \u26c4 \u26a1 \u26c5</p> <p>\u26ea \u26fa \u26f2 \u26f5 \u26f5 \u2693 \u2708\ufe0f \u26fd \u26a0\ufe0f \u2668\ufe0f</p> <p>1\ufe0f\u20e3 2\ufe0f\u20e3 3\ufe0f\u20e3 4\ufe0f\u20e3 5\ufe0f\u20e3 6\ufe0f\u20e3 7\ufe0f\u20e3 8\ufe0f\u20e3 9\ufe0f\u20e3 0\ufe0f\u20e3</p>"},{"location":"other/%E5%9C%A8markdown%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%A1%A8%E6%83%85%E7%AC%A6%E5%8F%B7/#_1","title":"\ufe0f\u20e3 \u25c0\ufe0f \u2b07\ufe0f \u25b6\ufe0f \u2b05\ufe0f \u2199\ufe0f \u2198\ufe0f \u27a1\ufe0f \u2b06\ufe0f \u2196\ufe0f \u2197\ufe0f","text":"<p>\u23ec \u23eb \u2935\ufe0f \u2934\ufe0f \u21a9\ufe0f \u21aa\ufe0f \u2194\ufe0f \u2195\ufe0f \u23ea \u23e9 \u2139\ufe0f \ufe0f \ufe0f \ufe0f </p> <p>\u267f \u3299\ufe0f \u3297\ufe0f \u24c2\ufe0f \u26d4 \u2733\ufe0f \u2747\ufe0f \u2734\ufe0f </p> <p>\u2648 \u2649 \u264a \u264b \u264c \u264d \u264e \u264f \u2650 \u2651 \u2652 \u2653 \u26ce </p> <p>\u274e \ufe0f \ufe0f \ufe0f \u267b\ufe0f \u00a9\ufe0f \u00ae\ufe0f \u2122\ufe0f \u274c \u2757 \u203c\ufe0f \u2049\ufe0f \u2b55 \u2716\ufe0f \u2795 \u2796 \u2797 \u2714\ufe0f </p> <p>\u2611\ufe0f \u27b0 \u3030\ufe0f \u303d\ufe0f \u25aa\ufe0f \u25ab\ufe0f \u25fe \u25fd \u25fc\ufe0f \u25fb\ufe0f \u2b1b \u2b1c \u2705 \u26ab \u26aa</p>"},{"location":"other/%E5%9C%A8markdown%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%A1%A8%E6%83%85%E7%AC%A6%E5%8F%B7/#4","title":"4\ufe0f\u20e3 \u5728\u5e38\u7528\u535a\u5ba2\u4e2d\u4f7f\u7528\u8868\u60c5\u7b26\u53f7","text":"<p>\u7b80\u4e66\u652f\u6301 <code>&amp;#x1f602;</code>  \ud83d\ude02\u7684\u8868\u60c5\u7b26\u53f7\uff0c\u4e0d\u652f\u6301<code>:smile:</code> \u7684\u8868\u60c5\u7b26\u53f7\uff0c\u652f\u6301\u76f4\u63a5\u590d\u5236\u7684\u8868\u60c5  \ud83d\ude01</p> <p>\u6398\u91d1\u4e0d\u652f\u6301<code>&amp;#x1f602;</code> \u7684\u8868\u60c5\u7b26\u53f7\uff0c\u4e0d\u652f\u6301<code>:smile:</code> \u7684\u8868\u60c5\u7b26\u53f7\uff0c\u652f\u6301\u76f4\u63a5\u590d\u5236\u7684\u8868\u60c5  \ud83d\ude01</p> <p>\u601d\u5426\u652f\u6301 <code>&amp;#x1f602;</code>  \ud83d\ude02\u7684\u8868\u60c5\u7b26\u53f7\uff0c\u4e0d\u652f\u6301<code>:smile:</code> \u7684\u8868\u60c5\u7b26\u53f7\uff0c\u652f\u6301\u76f4\u63a5\u590d\u5236\u7684\u8868\u60c5  \ud83d\ude01</p> <p>CSDN \u652f\u6301 <code>&amp;#x1f602;</code>  \ud83d\ude02\u7684\u8868\u60c5\u7b26\u53f7\uff0c\u652f\u6301<code>:smile:</code>  \u7684\u8868\u60c5\u7b26\u53f7\uff0c\u652f\u6301\u76f4\u63a5\u590d\u5236\u7684\u8868\u60c5 \ud83d\ude01</p> <p>GitHub \u652f\u6301 <code>&amp;#x1f602;</code>  \ud83d\ude02\u7684\u8868\u60c5\u7b26\u53f7\uff0c\u652f\u6301<code>:smile:</code>  \u7684\u8868\u60c5\u7b26\u53f7\uff0c\u652f\u6301\u76f4\u63a5\u590d\u5236\u7684\u8868\u60c5 \ud83d\ude01</p> <p>Markdown \u652f\u6301 <code>&amp;#x1f602;</code>  \ud83d\ude02\u7684\u8868\u60c5\u7b26\u53f7\uff0c\u652f\u6301<code>:smile:</code>  \u7684\u8868\u60c5\u7b26\u53f7\uff0c\u652f\u6301\u76f4\u63a5\u590d\u5236\u7684\u8868\u60c5 \ud83d\ude01</p> \u535a\u5ba2\u5e73\u53f0 \u683c\u5f0f\uff1a<code>&amp;#x1f602;</code> \u683c\u5f0f\uff1a<code>:smile:</code> \u76f4\u63a5\u590d\u5236\u7684\u8868\u60c5 markdown \u652f\u6301 \u652f\u6301 \u652f\u6301 github \u652f\u6301 \u652f\u6301 \u652f\u6301 CSDN \u652f\u6301 \u652f\u6301 \u652f\u6301 \u601d\u5426 \u652f\u6301 \u4e0d\u652f\u6301 \u652f\u6301 \u6398\u91d1 \u4e0d\u652f\u6301 \u4e0d\u652f\u6301 \u652f\u6301 \u7b80\u4e66 \u652f\u6301 \u4e0d\u652f\u6301 \u652f\u6301 <p>\u53c2\u8003\u6587\u6863</p> <p>https://zhuanlan.zhihu.com/p/147764147</p>"},{"location":"other/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","title":"\u5b66\u4e60\u7b14\u8bb0","text":""},{"location":"other/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#java","title":"Java \u57fa\u7840","text":""},{"location":"other/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#java_1","title":"Java \u6ce8\u89e3","text":"<p>\u6ce8\u89e3\u5c31\u662f\u4ee3\u7801\u4e2d\u7684\u4e00\u79cd\u7279\u6b8a\u6807\u8bb0\uff0c\u6700\u5f00\u59cb\u662f\u5728 java doc \u4e2d\u4f7f\u7528\uff0c\u8fd9\u4e9b\u6807\u8bb0\u53ef\u4ee5\u5728\u7f16\u8bd1\uff0c\u8fd0\u884c\u65f6\u88ab\u8bfb\u53d6\uff0c\u5e76\u6267\u884c\u76f8\u5e94\u7684\u5904\u7406\u3002</p> <p>spring \u4e2d\u7684\u6ce8\u89e3\uff1a@Controller\u3001@Component\u3001@Service\u3001@Repository\u3001@Configuration\u3001@Bean</p> <p>Java \u4e2d\u7684\u6ce8\u89e3\uff1a@Override \u3001@Deprecated\u3001@FuncationalInterface</p> <p>Java \u4e2d\u7684\u5143\u6ce8\u89e3\uff1a@Retention\uff08\u6ce8\u89e3\u7684\u751f\u547d\u5468\u671f\uff09\u3001@Target\uff08\u6ce8\u89e3\u7684\u4f7f\u7528\u8303\u56f4\uff09\u3001@Inherited\u3001@Documented</p> <p>\u81ea\u5b9a\u4e49\u6ce8\u89e3 + AOP \u5b9e\u73b0\u63a5\u53e3\u8c03\u7528\u7edf\u8ba1\uff0c\u5982\u679c\u63a5\u53e3\u5e26\u6709\u81ea\u5b9a\u4e49\u7684\u6ce8\u89e3\uff0c\u5219\u8bb0\u5f55\u76f8\u5173\u8c03\u7528\u60c5\u51b5</p>"},{"location":"other/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#java_2","title":"Java \u6cdb\u578b","text":"<p>Java \u6cdb\u578b\u662f\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u7684\u4e00\u79cd\u98ce\u683c\u6216\u8303\u5f0f\uff0c\u5141\u8bb8\u7a0b\u5e8f\u5458\u5728\u7f16\u5199\u4ee3\u7801\u65f6\u4e0d\u6307\u5b9a\u5177\u4f53\u7684\u7c7b\u578b\uff0c\u800c\u662f\u5728\u521b\u5efa\u5b9e\u4f8b\u6216\u8005\u8c03\u7528\u65b9\u6cd5\u65f6\u624d\u660e\u786e\u6307\u5b9a\u5177\u4f53\u7684\u7c7b\u578b\u3002</p> <p>\u4f7f\u7528\u6cdb\u578b\u7684\u597d\u5904\u662f\uff0c\u8ba9\u4ee3\u7801\u66f4\u7b80\u6d01\uff0c\u4e0d\u9700\u8981\u624b\u52a8\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\uff1b\u8ba9\u7a0b\u5e8f\u66f4\u52a0\u5065\u58ee\uff0c\u5728\u7f16\u8bd1\u671f\u4e0d\u4f1a\u544a\u8b66\uff0c\u51cf\u5c11\u51fa\u73b0  ClassCastException \u5f02\u5e38\u3002</p>"},{"location":"other/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#java-nio","title":"Java NIO","text":"<p>\u4e0e\u4f20\u7edf io \u7684\u533a\u522b</p> <p>\u4f20\u7edf IO \u662f\u4e00\u6b21\u4e00\u4e2a\u5b57\u8282\u5904\u7406\u6570\u636e\uff0cNIO \u662f\u4ee5\u5757\u7684\u5f62\u5f0f\u5904\u7406\u6570\u636e</p> <p>\u4f20\u7edfIO\u662f\u963b\u585e\u7684\uff0cNIO \u662f\u975e\u963b\u585e\u7684</p> <p>NIO \u6709\u4e09\u4e2a\u6838\u5fc3\u7ec4\u6210\u90e8\u5206\uff1aBuffer \u3001Channel \u3001Selector</p>"},{"location":"other/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#java_3","title":"Java \u53cd\u5c04","text":"<p>Java \u53cd\u5c04\u53ef\u4ee5\u8ba9\u6211\u4eec\u5728\u8fd0\u884c\u65f6\u83b7\u53d6\u7c7b\u7684\u4fe1\u606f</p>"},{"location":"other/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#java_4","title":"Java \u5e76\u53d1","text":""},{"location":"other/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#_2","title":"\u591a\u7ebf\u7a0b\u57fa\u7840","text":"<p>\u8fdb\u7a0b\u662f\u8d44\u6e90\u5206\u914d\u7684\u57fa\u672c\u5355\u4f4d\uff0c\u7ebf\u7a0b\u662f\u8d44\u6e90\u8c03\u5ea6\u7684\u57fa\u672c\u5355\u4f4d</p> <p>\u4f7f\u7528\u591a\u7ebf\u7a0b\u662f\u4e3a\u4e86\u63d0\u9ad8\u8d44\u6e90\u7684\u5229\u7528\u7387\uff0c\u591a\u6838\u5904\u7406\u5668</p> <p>Tomcat \u4e00\u4e2a\u8bf7\u6c42\u4f1a\u4ece\u7ebf\u7a0b\u6c60\u4e2d\u83b7\u53d6\u4e00\u4e2a\u7ebf\u7a0b\u8fdb\u884c\u5904\u7406</p> <p>\u6570\u636e\u5e93\u8fde\u63a5\u6c60\u4e5f\u662f\u4f7f\u7528\u591a\u7ebf\u7a0b</p>"},{"location":"other/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#cas","title":"CAS","text":"<p>compare and swap \u6bd4\u8f83\u5e76\u4ea4\u6362</p> <p>\u4e09\u4e2a\u64cd\u4f5c\u6570\uff1a\u5f53\u524d\u503c\uff0c\u5185\u5b58\u503c\uff0c\u65b0\u503c</p> <p>\u95ee\u9898 ABA\uff0cAtomicStamppedReference  \u5185\u5b58\u503c + \u7248\u672c\u53f7</p>"},{"location":"other/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#synchronized","title":"Synchronized","text":""},{"location":"python/gunicorn%E8%B6%85%E6%97%B6%E6%8A%A5%E9%94%99/","title":"gunicorn \u8d85\u65f6\u62a5\u9519\uff1a[1] [CRITICAL] WORKER TIMEOUT \u89e3\u51b3","text":""},{"location":"python/gunicorn%E8%B6%85%E6%97%B6%E6%8A%A5%E9%94%99/#_1","title":"\u4e00. \u95ee\u9898\u63cf\u8ff0","text":"<p>\u5728\u4f7f\u7528 Gunicorn +  flask \u642d\u5efa\u7684\u4e00\u4e2a web \u9879\u76ee\u4e2d\uff0c\u7531\u4e8e\u4f7f\u7528\u4e86\u673a\u5668\u5b66\u4e60\u6a21\u578b\uff0c\u5728\u7b2c\u4e00\u6b21\u8bf7\u6c42\u63a5\u53e3\u7684\u65f6\u5019\u9700\u8981\u52a0\u8f7d\u6a21\u578b\uff0c\u5728\u672c\u5730\u8fd0\u884c\u7684\u65f6\u5019\u52a0\u8f7d\u6a21\u578b\u5f88\u5feb\u6240\u4ee5\u6b63\u5e38\u8fd0\u884c\uff0c\u5c06\u5e94\u7528\u4f7f\u7528 docker \u7684\u65b9\u5f0f\u90e8\u7f72\u5230\u670d\u52a1\u5668\u4e0a\u9762\uff08\u6a21\u578b\u662f\u901a\u8fc7 volume \u7684\u65b9\u5f0f\u6302\u8f7d\u5230\u5bb9\u5668\u4e2d\u7684\uff09\uff0c \u7b2c\u4e00\u6b21\u8bf7\u6c42\u52a0\u8f7d\u6a21\u578b\u8017\u65f6\u6bd4\u8f83\u957f\uff0c\u62a5\u51fa\u5982\u4e0b\u9519\u8bef\uff1a</p> <pre><code>[2021-09-11 07:22:33 +0000] [1] [CRITICAL] WORKER TIMEOUT (pid:12)\n[2021-09-11 07:22:35 +0000] [12] [INFO] Worker exiting (pid: 12)\n</code></pre> <p>Gunicorn 'Green Unicorn'\u662fUNIX\u7684Python WSGI HTTP\u670d\u52a1\u5668\u3002\u5b83\u662f\u4e00\u4e2a\u4eceRuby\u7684Unicorn\u9879\u76ee\u79fb\u690d\u8fc7\u6765\u7684\u9884\u5206\u53c9worker\u6a21\u578b\u3002Gunicorn\u670d\u52a1\u5668\u5e7f\u6cdb\u517c\u5bb9\u5404\u79cdweb\u6846\u67b6\uff0c\u5b9e\u73b0\u7b80\u5355\uff0c\u670d\u52a1\u5668\u8d44\u6e90\u4f7f\u7528\u5c11\uff0c\u901f\u5ea6\u76f8\u5f53\u5feb\u3002</p>"},{"location":"python/gunicorn%E8%B6%85%E6%97%B6%E6%8A%A5%E9%94%99/#_2","title":"\u4e8c. \u539f\u56e0\u5206\u6790","text":"<p>\u4ece\u62a5\u9519\u4fe1\u606f\u53ef\u4ee5\u770b\u51fa\uff0cgunicorn \u7684 worker \u8fdb\u7a0b\u8d85\u65f6\u5bfc\u81f4\u8fdb\u7a0b\u9000\u51fa\u91cd\u542f\u3002 \u67e5\u9605 gunicorn \u5b98\u65b9\u6587\u6863\uff0c\u6709\u4e0b\u56fe\u6240\u793a\u7684\u63cf\u8ff0\uff1a </p> <p>\u7ffb\u8bd1\u5982\u4e0b\uff1a</p> <p><code>timeout</code></p> <p>\u547d\u4ee4\u884c\uff1a<code>-t INT \u6216 --timeout INT</code></p> <p>\u9ed8\u8ba4\uff1a <code>30</code></p> <p>\u9ed8\u8ba4\u8d85\u8fc7\u8fd9\u4e48\u591a\u79d2\u7684 worker \u8fdb\u7a0b\u5c06\u88ab\u6740\u6b7b\u5e76\u91cd\u65b0\u542f\u52a8\u3002</p> <p>\u503c\u4e3a\u6b63\u6570\u6216 0\u3002\u5c06\u5176\u8bbe\u7f6e\u4e3a 0 \u4f1a\u901a\u8fc7\u5b8c\u5168\u7981\u7528\u6240\u6709 worker \u7684\u8d85\u65f6\u6765\u5b9e\u73b0\u65e0\u9650\u8d85\u65f6\u3002</p> <p>\u901a\u5e38\uff0c\u9ed8\u8ba4\u503c 30 \u79d2\u5c31\u8db3\u591f\u4e86\u3002\u5982\u679c\u60a8\u786e\u5b9a\u5bf9\u540c\u6b65 worker \u7684\u5f71\u54cd\uff0c\u5219\u4ec5\u5c06\u6b64\u8bbe\u7f6e\u66f4\u9ad8\u3002\u5bf9\u4e8e\u975e\u540c\u6b65 worker\uff0c\u8fd9\u4ec5\u610f\u5473\u7740\u5de5\u4f5c\u8fdb\u7a0b\u4ecd\u5728\u901a\u4fe1\uff0c\u5e76\u4e14\u4e0e\u5904\u7406\u5355\u4e2a\u8bf7\u6c42\u6240\u9700\u7684\u65f6\u95f4\u957f\u5ea6\u65e0\u5173\u3002</p>"},{"location":"python/gunicorn%E8%B6%85%E6%97%B6%E6%8A%A5%E9%94%99/#_3","title":"\u4e09. \u89e3\u51b3\u65b9\u6cd5","text":"<p>\u4ece\u5b98\u7f51\u7684\u6587\u6863\u8bf4\u660e\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0cgunicorn \u9ed8\u8ba4\u7684\u8d85\u65f6\u65f6\u95f4\u4e3a 30s \uff0c\u5982\u679c\u8d85\u8fc7 30s\uff0c\u5219 worker \u8fdb\u7a0b\u5c06\u88ab\u6740\u6b7b\u5e76\u91cd\u65b0\u542f\u52a8\u3002</p> <p>\u6240\u4ee5\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u53ea\u9700\u8981\u8bbe\u7f6e\u8f83\u5927\u7684\u8d85\u65f6\u65f6\u95f4\u5373\u53ef\uff1a</p> <ol> <li>\u4f7f\u7528 <code>gunicorn</code> \u7684\u547d\u4ee4\u884c\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4</li> </ol> <pre><code>gunicorn -w 2 -b 0.0.0.0:4343  manage:app --timeout 120 \n</code></pre> <p>\u5728 gunicorn \u7684\u542f\u52a8\u547d\u4ee4\u4e2d\u52a0\u4e0a\uff1a<code>--timeout 120</code>  \u8868\u793a\u8d85\u65f6\u65f6\u95f4\u8bbe\u7f6e\u4e3a 120 \u79d2\u3002</p> <ol> <li>\u5728 <code>gunicorn</code> \u7684\u914d\u7f6e\u6587\u4ef6 <code>gunicorn.conf.py</code> \u6587\u4ef6\u4e2d\u914d\u7f6e\u8d85\u65f6\u65f6\u95f4</li> </ol> <pre><code>workers = 4  # \u5b9a\u4e49\u540c\u65f6\u5f00\u542f\u7684\u5904\u7406\u8bf7\u6c42\u7684\u8fdb\u7a0b\u6570\u91cf\uff0c\u6839\u636e\u7f51\u7ad9\u6d41\u91cf\u9002\u5f53\u8c03\u6574\nworker_class = \"gevent\"  # \u91c7\u7528gevent\u5e93\uff0c\u652f\u6301\u5f02\u6b65\u5904\u7406\u8bf7\u6c42\uff0c\u63d0\u9ad8\u541e\u5410\u91cf\nbind = \"0.0.0.0:8500\"  # \u76d1\u542cIP\u653e\u5bbd\uff0c\u4ee5\u4fbf\u4e8eDocker\u4e4b\u95f4\u3001Docker\u548c\u5bbf\u4e3b\u673a\u4e4b\u95f4\u7684\u901a\u4fe1\ntimeout = 120  # \u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\u4e3a 120 \u79d2\n</code></pre> <p>\u5173\u4e8e  <code>gunicorn.conf.py</code> \u6587\u4ef6\u7684\u66f4\u591a\u914d\u7f6e\u67e5\u770b\u5b98\u7f51</p> <p>\u53c2\u8003\u6587\u6863\uff1a gunicorn \u5b98\u65b9\u6587\u6863 gunicorn\u670d\u52a1\u5668gunicorn_conf.py\u5e38\u7528\u914d\u7f6e\u8be6\u89e3</p>"},{"location":"python/python%E4%B8%ADThreadPoolExecutor%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/","title":"python\u4e2dThreadPoolExecutor\u8fd0\u884c\u539f\u7406\u89e3\u6790","text":"<p><code>ThreadPoolExecutor</code> \u662f <code>Python</code> \u4e2d\u7528\u4e8e\u521b\u5efa\u548c\u7ba1\u7406\u7ebf\u7a0b\u6c60\u7684\u7c7b\uff0c\u5b83\u57fa\u4e8e <code>concurrent.futures</code> \u6a21\u5757\u3002\u4e0b\u9762\u6211\u4eec\u901a\u8fc7\u5206\u6790\u6e90\u7801\u6765\u4ecb\u7ecd\u5176\u8fd0\u884c\u539f\u7406\u3002</p> <pre><code># Copyright 2009 Brian Quinlan. All Rights Reserved.\n# Licensed to PSF under a Contributor Agreement.\n\n\"\"\"Implements ThreadPoolExecutor.\"\"\"\n\n__author__ = 'Brian Quinlan (brian@sweetapp.com)'\n\nfrom concurrent.futures import _base\nimport itertools\nimport queue\nimport threading\nimport types\nimport weakref\nimport os\n\n\n_threads_queues = weakref.WeakKeyDictionary()\n_shutdown = False\n# Lock that ensures that new workers are not created while the interpreter is\n# shutting down. Must be held while mutating _threads_queues and _shutdown.\n_global_shutdown_lock = threading.Lock()\n\ndef _python_exit():\n    global _shutdown\n    with _global_shutdown_lock:\n        _shutdown = True\n    items = list(_threads_queues.items())\n    for t, q in items:\n        q.put(None)\n    for t, q in items:\n        t.join()\n\n# Register for `_python_exit()` to be called just before joining all\n# non-daemon threads. This is used instead of `atexit.register()` for\n# compatibility with subinterpreters, which no longer support daemon threads.\n# See bpo-39812 for context.\nthreading._register_atexit(_python_exit)\n\n# At fork, reinitialize the `_global_shutdown_lock` lock in the child process\nif hasattr(os, 'register_at_fork'):\n    os.register_at_fork(before=_global_shutdown_lock.acquire,\n                        after_in_child=_global_shutdown_lock._at_fork_reinit,\n                        after_in_parent=_global_shutdown_lock.release)\n\n\nclass _WorkItem(object):\n    def __init__(self, future, fn, args, kwargs):\n        self.future = future\n        self.fn = fn\n        self.args = args\n        self.kwargs = kwargs\n\n    def run(self):\n        if not self.future.set_running_or_notify_cancel():\n            return\n\n        try:\n            result = self.fn(*self.args, **self.kwargs)\n        except BaseException as exc:\n            self.future.set_exception(exc)\n            # Break a reference cycle with the exception 'exc'\n            self = None\n        else:\n            self.future.set_result(result)\n\n    __class_getitem__ = classmethod(types.GenericAlias)\n\n\ndef _worker(executor_reference, work_queue, initializer, initargs):\n    if initializer is not None:\n        try:\n            initializer(*initargs)\n        except BaseException:\n            _base.LOGGER.critical('Exception in initializer:', exc_info=True)\n            executor = executor_reference()\n            if executor is not None:\n                executor._initializer_failed()\n            return\n    try:\n        while True:\n            work_item = work_queue.get(block=True)\n            if work_item is not None:\n                work_item.run()\n                # Delete references to object. See issue16284\n                del work_item\n\n                # attempt to increment idle count\n                executor = executor_reference()\n                if executor is not None:\n                    executor._idle_semaphore.release()\n                del executor\n                continue\n\n            executor = executor_reference()\n            # Exit if:\n            #   - The interpreter is shutting down OR\n            #   - The executor that owns the worker has been collected OR\n            #   - The executor that owns the worker has been shutdown.\n            if _shutdown or executor is None or executor._shutdown:\n                # Flag the executor as shutting down as early as possible if it\n                # is not gc-ed yet.\n                if executor is not None:\n                    executor._shutdown = True\n                # Notice other workers\n                work_queue.put(None)\n                return\n            del executor\n    except BaseException:\n        _base.LOGGER.critical('Exception in worker', exc_info=True)\n\n\nclass BrokenThreadPool(_base.BrokenExecutor):\n    \"\"\"\n    Raised when a worker thread in a ThreadPoolExecutor failed initializing.\n    \"\"\"\n\n\nclass ThreadPoolExecutor(_base.Executor):\n\n    # Used to assign unique thread names when thread_name_prefix is not supplied.\n    _counter = itertools.count().__next__\n\n    def __init__(self, max_workers=None, thread_name_prefix='',\n                 initializer=None, initargs=()):\n        \"\"\"Initializes a new ThreadPoolExecutor instance.\n\n        Args:\n            max_workers: The maximum number of threads that can be used to\n                execute the given calls.\n            thread_name_prefix: An optional name prefix to give our threads.\n            initializer: A callable used to initialize worker threads.\n            initargs: A tuple of arguments to pass to the initializer.\n        \"\"\"\n        if max_workers is None:\n            # ThreadPoolExecutor is often used to:\n            # * CPU bound task which releases GIL\n            # * I/O bound task (which releases GIL, of course)\n            #\n            # We use cpu_count + 4 for both types of tasks.\n            # But we limit it to 32 to avoid consuming surprisingly large resource\n            # on many core machine.\n            max_workers = min(32, (os.cpu_count() or 1) + 4)\n        if max_workers &lt;= 0:\n            raise ValueError(\"max_workers must be greater than 0\")\n\n        if initializer is not None and not callable(initializer):\n            raise TypeError(\"initializer must be a callable\")\n\n        self._max_workers = max_workers\n        self._work_queue = queue.SimpleQueue()\n        self._idle_semaphore = threading.Semaphore(0)\n        self._threads = set()\n        self._broken = False\n        self._shutdown = False\n        self._shutdown_lock = threading.Lock()\n        self._thread_name_prefix = (thread_name_prefix or\n                                    (\"ThreadPoolExecutor-%d\" % self._counter()))\n        self._initializer = initializer\n        self._initargs = initargs\n\n    def submit(self, fn, /, *args, **kwargs):\n        with self._shutdown_lock, _global_shutdown_lock:\n            if self._broken:\n                raise BrokenThreadPool(self._broken)\n\n            if self._shutdown:\n                raise RuntimeError('cannot schedule new futures after shutdown')\n            if _shutdown:\n                raise RuntimeError('cannot schedule new futures after '\n                                   'interpreter shutdown')\n\n            f = _base.Future()\n            w = _WorkItem(f, fn, args, kwargs)\n\n            self._work_queue.put(w)\n            self._adjust_thread_count()\n            return f\n    submit.__doc__ = _base.Executor.submit.__doc__\n\n    def _adjust_thread_count(self):\n        # if idle threads are available, don't spin new threads\n        if self._idle_semaphore.acquire(timeout=0):\n            return\n\n        # When the executor gets lost, the weakref callback will wake up\n        # the worker threads.\n        def weakref_cb(_, q=self._work_queue):\n            q.put(None)\n\n        num_threads = len(self._threads)\n        if num_threads &lt; self._max_workers:\n            thread_name = '%s_%d' % (self._thread_name_prefix or self,\n                                     num_threads)\n            t = threading.Thread(name=thread_name, target=_worker,\n                                 args=(weakref.ref(self, weakref_cb),\n                                       self._work_queue,\n                                       self._initializer,\n                                       self._initargs))\n            t.start()\n            self._threads.add(t)\n            _threads_queues[t] = self._work_queue\n\n    def _initializer_failed(self):\n        with self._shutdown_lock:\n            self._broken = ('A thread initializer failed, the thread pool '\n                            'is not usable anymore')\n            # Drain work queue and mark pending futures failed\n            while True:\n                try:\n                    work_item = self._work_queue.get_nowait()\n                except queue.Empty:\n                    break\n                if work_item is not None:\n                    work_item.future.set_exception(BrokenThreadPool(self._broken))\n\n    def shutdown(self, wait=True, *, cancel_futures=False):\n        with self._shutdown_lock:\n            self._shutdown = True\n            if cancel_futures:\n                # Drain all work items from the queue, and then cancel their\n                # associated futures.\n                while True:\n                    try:\n                        work_item = self._work_queue.get_nowait()\n                    except queue.Empty:\n                        break\n                    if work_item is not None:\n                        work_item.future.cancel()\n\n            # Send a wake-up to prevent threads calling\n            # _work_queue.get(block=True) from permanently blocking.\n            self._work_queue.put(None)\n        if wait:\n            for t in self._threads:\n                t.join()\n    shutdown.__doc__ = _base.Executor.shutdown.__doc__\n</code></pre> <p>\u901a\u8fc7\u5206\u6790 <code>ThreadPoolExecutor</code> \u7684\u6e90\u7801\uff0c\u63a5\u4e0b\u6765\u8be6\u7ec6\u4ecb\u7ecd\u7ebf\u7a0b\u6c60\u7684\u8fd0\u884c\u539f\u7406\uff1a</p>"},{"location":"python/python%E4%B8%ADThreadPoolExecutor%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/#_1","title":"\u6838\u5fc3\u7ec4\u4ef6","text":""},{"location":"python/python%E4%B8%ADThreadPoolExecutor%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/#1-_workitem","title":"1. \u5de5\u4f5c\u9879 (<code>_WorkItem</code>)","text":"<p><code>_WorkItem</code> \u7c7b\uff1a\u5c01\u88c5\u4e86\u8981\u6267\u884c\u7684\u4efb\u52a1\uff0c\u5305\u62ec\u4e00\u4e2a Future \u5bf9\u8c61\u3001\u53ef\u8c03\u7528\u5bf9\u8c61 <code>fn</code> \u4ee5\u53ca\u5176\u53c2\u6570 <code>args</code> \u548c <code>kwargs</code>\u3002\u5f53\u8fd0\u884c <code>run</code> \u65b9\u6cd5\u65f6\uff0c\u4f1a\u8c03\u7528 <code>fn</code> \u5e76\u8bbe\u7f6e Future \u7684\u7ed3\u679c\u6216\u5f02\u5e38\u3002</p> <pre><code>class _WorkItem(object):\n    def __init__(self, future, fn, args, kwargs):\n        self.future = future\n        self.fn = fn\n        self.args = args\n        self.kwargs = kwargs\n\n    def run(self):\n        if not self.future.set_running_or_notify_cancel():\n            return\n        try:\n            result = self.fn(*self.args, **self.kwargs)\n            self.future.set_result(result)\n        except BaseException as exc:\n            self.future.set_exception(exc)\n</code></pre>"},{"location":"python/python%E4%B8%ADThreadPoolExecutor%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/#2-_worker","title":"2. \u5de5\u4f5c\u7ebf\u7a0b (<code>_worker</code>)","text":"<p><code>_worker</code> \u51fd\u6570\uff1a\u662f\u5de5\u4f5c\u7ebf\u7a0b\u7684\u4e3b\u51fd\u6570\uff08\u5b9e\u73b0\u4e86\u7ebf\u7a0b\u590d\u7528\u7684\u673a\u5236\uff09\uff0c\u5b83\u4ece\u5de5\u4f5c\u961f\u5217\u4e2d\u83b7\u53d6\u4efb\u52a1\u5e76\u6267\u884c\u3002\u5728<code>_worker</code>\u51fd\u6570\u4e2d\uff0c\u6709\u4e00\u4e2awhile\u5faa\u73af\uff0c\u8fd9\u4e2a\u5faa\u73af\u4f1a\u4e00\u76f4\u4ece\u5de5\u4f5c\u961f\u5217\u4e2d\u83b7\u53d6\u4efb\u52a1\uff08<code>work_queue.get(block=True)</code>\uff09\uff0c\u7136\u540e\u6267\u884c\u4efb\u52a1\uff08<code>work_item.run()</code>\uff09\u3002\u5f53\u4e00\u4e2a\u4efb\u52a1\u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u5b83\u4f1a\u7ee7\u7eed\u83b7\u53d6\u4e0b\u4e00\u4e2a\u4efb\u52a1\uff0c\u76f4\u5230\u83b7\u53d6\u5230<code>None</code>\uff08\u9000\u51fa\u4fe1\u53f7\uff09\u6216\u8005\u51fa\u73b0\u5f02\u5e38\u3002</p> <p>\u6240\u4ee5\uff0c\u7ebf\u7a0b\u6c60\u4e2d\u7684\u6bcf\u4e2a\u7ebf\u7a0b\u4e00\u65e6\u88ab\u521b\u5efa\uff0c\u5c31\u4f1a\u5728\u8fd9\u4e2a\u5faa\u73af\u4e2d\u4e0d\u65ad\u6267\u884c\u4efb\u52a1\uff0c\u800c\u4e0d\u662f\u6267\u884c\u4e00\u4e2a\u4efb\u52a1\u5c31\u9000\u51fa\u3002\u8fd9\u5c31\u662f\u7ebf\u7a0b\u590d\u7528\u7684\u539f\u7406\u3002</p> <pre><code>def _worker(executor_reference, work_queue, initializer, initargs):\n    try:\n        while True:  # \u2b50\ufe0f \u5173\u952e\uff1a\u65e0\u9650\u5faa\u73af\uff01\n            work_item = work_queue.get(block=True)  # \u963b\u585e\u7b49\u5f85\u4efb\u52a1\uff0c\u7ebf\u7a0b\u5728\u6b64\u963b\u585e\uff0c\u4e0d\u6d88\u8017CPU\uff0c\u6709\u65b0\u4efb\u52a1\u65f6\u81ea\u52a8\u5524\u9192\n            if work_item is not None:\n                work_item.run()  # \u6267\u884c\u4efb\u52a1\n                del work_item\n\n                # \u6807\u8bb0\u7ebf\u7a0b\u4e3a\u7a7a\u95f2\u72b6\u6001\n                executor = executor_reference()\n                if executor is not None:\n                    executor._idle_semaphore.release()  # \u2b50\ufe0f \u7a7a\u95f2\u4fe1\u53f7\u91cf+1\n                del executor\n                continue  # \u2b50\ufe0f \u7ee7\u7eed\u5faa\u73af\uff0c\u7b49\u5f85\u4e0b\u4e00\u4e2a\u4efb\u52a1\n\n            # \u6536\u5230\u9000\u51fa\u4fe1\u53f7\u65f6\u7684\u5904\u7406\n            executor = executor_reference()\n            if _shutdown or executor is None or executor._shutdown:\n                if executor is not None:\n                    executor._shutdown = True\n                work_queue.put(None)  # \u901a\u77e5\u5176\u4ed6worker\n                return  # \u2b50\ufe0f \u53ea\u6709\u8fd9\u91cc\u624d\u4f1a\u9000\u51fa\u5faa\u73af\uff0c\u7ebf\u7a0b\u7ed3\u675f\n            del executor\n    except BaseException:\n        _base.LOGGER.critical('Exception in worker', exc_info=True)\n</code></pre> <p>\u5728<code>_worker</code>\u4e2d\uff0c\u5f53\u4e00\u4e2a\u4efb\u52a1\u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u4f1a\u8c03\u7528<code>executor._idle_semaphore.release()</code>\u6765\u589e\u52a0\u4fe1\u53f7\u91cf\uff0c\u8868\u793a\u6709\u4e00\u4e2a\u7ebf\u7a0b\u7a7a\u95f2\u4e86\u3002\u800c\u5f53\u63d0\u4ea4\u4efb\u52a1\u65f6\uff0c\u5728<code>_adjust_thread_count</code>\u4e2d\uff0c\u4f1a\u5c1d\u8bd5\u83b7\u53d6\u4fe1\u53f7\u91cf\uff08\u5373\u6d88\u8017\u4e00\u4e2a\u7a7a\u95f2\u7ebf\u7a0b\uff09\u6765\u907f\u514d\u521b\u5efa\u65b0\u7ebf\u7a0b\u3002\u5982\u679c\u83b7\u53d6\u6210\u529f\uff0c\u8bf4\u660e\u6709\u7a7a\u95f2\u7ebf\u7a0b\uff0c\u90a3\u4e48\u5c31\u4e0d\u521b\u5efa\u65b0\u7ebf\u7a0b\uff0c\u56e0\u4e3a\u7a7a\u95f2\u7ebf\u7a0b\u4f1a\u53bb\u5904\u7406\u961f\u5217\u4e2d\u7684\u4efb\u52a1\u3002</p> <p>\u6240\u4ee5\uff0c\u7ebf\u7a0b\u590d\u7528\u7684\u673a\u5236\u53ef\u4ee5\u603b\u7ed3\u4e3a\uff1a</p> <ol> <li>\u5de5\u4f5c\u7ebf\u7a0b\u88ab\u521b\u5efa\u540e\uff0c\u8fdb\u5165\u4e00\u4e2a\u5faa\u73af\uff0c\u4e0d\u65ad\u4ece\u5de5\u4f5c\u961f\u5217\u4e2d\u53d6\u4efb\u52a1\u6267\u884c\u3002</li> <li>\u5f53\u4efb\u52a1\u5230\u8fbe\u65f6\uff0c\u7a7a\u95f2\u7ebf\u7a0b\uff08\u6b63\u5728\u7b49\u5f85\u961f\u5217\u7684\u7ebf\u7a0b\uff09\u4f1a\u83b7\u53d6\u5230\u4efb\u52a1\u5e76\u6267\u884c\u3002</li> <li>\u7ebf\u7a0b\u6267\u884c\u5b8c\u4efb\u52a1\u540e\uff0c\u4e0d\u4f1a\u9000\u51fa\uff0c\u800c\u662f\u7ee7\u7eed\u7b49\u5f85\u4e0b\u4e00\u4e2a\u4efb\u52a1\uff0c\u7b49\u5f85\u4efb\u52a1\u65f6\u4e0d\u6d88\u8017CPU\uff0c\u907f\u514d\u4e86\u5fd9\u7b49\u5f85\u3002</li> <li>\u901a\u8fc7\u4fe1\u53f7\u91cf\u673a\u5236\uff0c\u7ebf\u7a0b\u6c60\u5728\u63d0\u4ea4\u4efb\u52a1\u65f6\u4f18\u5148\u4f7f\u7528\u7a7a\u95f2\u7ebf\u7a0b\uff0c\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u7ebf\u7a0b\u521b\u5efa\u3002</li> </ol> <p>\u8fd9\u6837\uff0c\u7ebf\u7a0b\u6c60\u901a\u8fc7\u7ef4\u62a4\u4e00\u5b9a\u6570\u91cf\u7684\u7ebf\u7a0b\uff0c\u8ba9\u5b83\u4eec\u91cd\u590d\u4f7f\u7528\u6765\u6267\u884c\u591a\u4e2a\u4efb\u52a1\uff0c\u4ece\u800c\u907f\u514d\u4e86\u9891\u7e41\u521b\u5efa\u548c\u9500\u6bc1\u7ebf\u7a0b\u7684\u5f00\u9500\u3002</p>"},{"location":"python/python%E4%B8%ADThreadPoolExecutor%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/#_2","title":"\u7ebf\u7a0b\u6c60\u8fd0\u884c\u539f\u7406","text":""},{"location":"python/python%E4%B8%ADThreadPoolExecutor%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/#1","title":"1. \u521d\u59cb\u5316","text":"<p>\u521d\u59cb\u5316\uff1a\u521b\u5efa <code>ThreadPoolExecutor</code> \u5b9e\u4f8b\u65f6\uff0c\u53ef\u4ee5\u6307\u5b9a\u6700\u5927\u7ebf\u7a0b\u6570 <code>max_workers</code>\u3001\u7ebf\u7a0b\u540d\u524d\u7f00 <code>thread_name_prefix</code>\u3001\u521d\u59cb\u5316\u5668 <code>initializer</code> \u548c\u521d\u59cb\u5316\u53c2\u6570 <code>initargs</code>\u3002\u5982\u679c\u6ca1\u6709\u6307\u5b9a <code>max_workers</code>\uff0c\u5219\u9ed8\u8ba4\u4f7f\u7528 <code>min(32, (os.cpu_count() or 1) + 4)</code>\u3002</p> <pre><code>def __init__(self, max_workers=None, thread_name_prefix='', initializer=None, initargs=()):\n    # \u81ea\u52a8\u8ba1\u7b97\u6700\u5927\u7ebf\u7a0b\u6570\n    if max_workers is None:\n        max_workers = min(32, (os.cpu_count() or 1) + 4)\n\n    self._max_workers = max_workers\n    self._work_queue = queue.SimpleQueue()  # \u4efb\u52a1\u961f\u5217\uff0c\u65e0\u754c\u5148\u8fdb\u5148\u51fa\u961f\u5217\n    self._idle_semaphore = threading.Semaphore(0)  # \u7a7a\u95f2\u7ebf\u7a0b\u4fe1\u53f7\u91cf\uff0c\u9ed8\u8ba4\u4e3a0\u8868\u793a\u6ca1\u6709\u7a7a\u95f2\u7ebf\u7a0b\uff0c\u9700\u8981\u521b\u5efa\u65b0\u7ebf\u7a0b\n    self._threads = set()  # \u5de5\u4f5c\u7ebf\u7a0b\u96c6\u5408\n    self._shutdown = False\n</code></pre>"},{"location":"python/python%E4%B8%ADThreadPoolExecutor%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/#2","title":"2. \u4efb\u52a1\u63d0\u4ea4\u6d41\u7a0b","text":"<p>\u63d0\u4ea4\u4efb\u52a1\uff1a\u5f53\u8c03\u7528 <code>submit</code> \u65b9\u6cd5\u65f6\uff0c\u4f1a\u521b\u5efa\u4e00\u4e2a <code>_WorkItem</code> \u5bf9\u8c61\uff0c\u5e76\u5c06\u5176\u653e\u5165\u5de5\u4f5c\u961f\u5217 <code>_work_queue</code> \u4e2d\u3002\u7136\u540e\uff0c\u8c03\u7528 <code>_adjust_thread_count</code> \u65b9\u6cd5\u6765\u8c03\u6574\u7ebf\u7a0b\u6570\u91cf\u3002</p> <pre><code>def submit(self, fn, /, *args, **kwargs):\n    with self._shutdown_lock, _global_shutdown_lock:\n        # \u521b\u5efaFuture\u548c\u5de5\u4f5c\u9879\n        f = _base.Future()\n        w = _WorkItem(f, fn, args, kwargs)\n\n        self._work_queue.put(w)  # \u4efb\u52a1\u5165\u961f\n        self._adjust_thread_count()  # \u8c03\u6574\u7ebf\u7a0b\u6570\u91cf\n        return f\n</code></pre>"},{"location":"python/python%E4%B8%ADThreadPoolExecutor%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/#3","title":"3. \u52a8\u6001\u7ebf\u7a0b\u7ba1\u7406","text":"<ol> <li>\u7ebf\u7a0b\u521b\u5efa\uff1a<code>_adjust_thread_count</code> \u65b9\u6cd5\u8d1f\u8d23\u521b\u5efa\u65b0\u7684\u7ebf\u7a0b\u3002\u5b83\u901a\u8fc7\u68c0\u67e5\u7a7a\u95f2\u4fe1\u53f7\u91cf\uff08<code>_idle_semaphore</code>\uff09\u548c\u5f53\u524d\u7ebf\u7a0b\u6570\u6765\u51b3\u5b9a\u662f\u5426\u521b\u5efa\u65b0\u7ebf\u7a0b\u3002\u5982\u679c\u6ca1\u6709\u7a7a\u95f2\u7ebf\u7a0b\uff0c\u5e76\u4e14\u5f53\u524d\u7ebf\u7a0b\u6570\u5c0f\u4e8e\u6700\u5927\u7ebf\u7a0b\u6570\uff0c\u5219\u521b\u5efa\u65b0\u7ebf\u7a0b\u3002<ul> <li>\u7a7a\u95f2\u4fe1\u53f7\u91cf\uff1a\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u5b8c\u6210\u4e00\u4e2a\u4efb\u52a1\u540e\uff0c\u4f1a\u91ca\u653e\u4e00\u4e2a\u7a7a\u95f2\u4fe1\u53f7\u91cf\uff08\u5728<code>_worker</code>\u51fd\u6570\u4e2d\u5b9e\u73b0\uff09\u3002\u5728\u83b7\u53d6\u65b0\u4efb\u52a1\u65f6\uff0c\u4f1a\u5148\u5c1d\u8bd5\u83b7\u53d6\u7a7a\u95f2\u4fe1\u53f7\u91cf\uff0c\u5982\u679c\u83b7\u53d6\u6210\u529f\uff0c\u5219\u8868\u793a\u6709\u7a7a\u95f2\u7ebf\u7a0b\uff0c\u4e0d\u9700\u8981\u521b\u5efa\u65b0\u7ebf\u7a0b\u3002</li> </ul> </li> <li>\u5de5\u4f5c\u7ebf\u7a0b\u7684\u4e3b\u5faa\u73af\uff1a\u5728 <code>_worker</code> \u51fd\u6570\u4e2d\uff0c\u7ebf\u7a0b\u4e0d\u65ad\u4ece\u5de5\u4f5c\u961f\u5217\u4e2d\u83b7\u53d6\u4efb\u52a1\u3002\u5982\u679c\u83b7\u53d6\u5230 <code>None</code>\uff0c\u5219\u9000\u51fa\u5faa\u73af\u3002\u5426\u5219\uff0c\u6267\u884c\u4efb\u52a1\u7684 <code>run</code> \u65b9\u6cd5\u3002<ul> <li>\u5f53\u7ebf\u7a0b\u83b7\u53d6\u5230\u4e00\u4e2a\u4efb\u52a1\u5e76\u6267\u884c\u540e\uff0c\u4f1a\u91ca\u653e\u4e00\u4e2a\u7a7a\u95f2\u4fe1\u53f7\u91cf\uff08\u901a\u8fc7 <code>executor._idle_semaphore.release()</code>\uff09\u3002</li> </ul> </li> <li>\u7ebf\u7a0b\u7684\u9000\u51fa\uff1a\u5f53\u5de5\u4f5c\u961f\u5217\u83b7\u53d6\u5230 <code>None</code> \u65f6\uff0c\u7ebf\u7a0b\u4f1a\u68c0\u67e5\u9000\u51fa\u6761\u4ef6\uff08\u89e3\u91ca\u5668\u5173\u95ed\u3001Executor \u88ab\u5783\u573e\u56de\u6536\u6216 Executor \u5df2\u5173\u95ed\uff09\u3002\u5982\u679c\u6ee1\u8db3\u9000\u51fa\u6761\u4ef6\uff0c\u5219\u7ebf\u7a0b\u9000\u51fa\u3002</li> </ol> <pre><code>def _adjust_thread_count(self):\n    # \u5982\u679c\u6709\u7a7a\u95f2\u7ebf\u7a0b\uff0c\u4e0d\u521b\u5efa\u65b0\u7ebf\u7a0b\n    if self._idle_semaphore.acquire(timeout=0):\n        return\n\n    # \u521b\u5efa\u65b0\u5de5\u4f5c\u7ebf\u7a0b\n    if len(self._threads) &lt; self._max_workers:\n        thread_name = '%s_%d' % (self._thread_name_prefix, num_threads)\n        t = threading.Thread(name=thread_name, target=_worker,\n                             args=(weakref.ref(self, weakref_cb),\n                                   self._work_queue,\n                                   self._initializer,\n                                   self._initargs))\n        t.start()\n        self._threads.add(t)\n        _threads_queues[t] = self._work_queue  # \u5168\u5c40\u6ce8\u518c\n</code></pre>"},{"location":"python/python%E4%B8%ADThreadPoolExecutor%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/#_3","title":"\u5173\u952e\u673a\u5236","text":""},{"location":"python/python%E4%B8%ADThreadPoolExecutor%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/#1_1","title":"1. \u4efb\u52a1\u8c03\u5ea6","text":"<ul> <li>\u4f7f\u7528 <code>queue.SimpleQueue</code> \u4f5c\u4e3a\u4efb\u52a1\u961f\u5217\uff0c\u7ebf\u7a0b\u5b89\u5168</li> <li>\u6240\u6709\u7ebf\u7a0b\u5171\u4eab\u540c\u4e00\u4e2a\u4efb\u52a1\u961f\u5217</li> <li>\u5de5\u4f5c\u7ebf\u7a0b\u963b\u585e\u5728 <code>work_queue.get(block=True)</code> \u7b49\u5f85\u4efb\u52a1\uff0c\u7ebf\u7a0b\u5728\u961f\u5217\u7a7a\u65f6\u5904\u4e8e\u4f11\u7720\u72b6\u6001</li> <li>\u63d0\u4ea4\u4efb\u52a1\u65f6\u7acb\u5373\u8fd4\u56de Future \u5bf9\u8c61</li> </ul>"},{"location":"python/python%E4%B8%ADThreadPoolExecutor%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/#2_1","title":"2. \u7ebf\u7a0b\u751f\u547d\u5468\u671f\u7ba1\u7406","text":"<ul> <li>\u61d2\u52a0\u8f7d\uff1a\u7ebf\u7a0b\u5728\u9700\u8981\u65f6\u521b\u5efa\uff0c\u4e0d\u8d85\u8fc7 <code>max_workers</code></li> <li>\u7a7a\u95f2\u7ba1\u7406\uff1a\u901a\u8fc7\u4fe1\u53f7\u91cf\u8ddf\u8e2a\u7a7a\u95f2\u7ebf\u7a0b</li> <li>\u4f18\u96c5\u5173\u95ed\uff1a\u5411\u961f\u5217\u53d1\u9001 <code>None</code> \u4f5c\u4e3a\u9000\u51fa\u4fe1\u53f7</li> </ul>"},{"location":"python/python%E4%B8%ADThreadPoolExecutor%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/#3_1","title":"3. \u8d44\u6e90\u6e05\u7406","text":"<p>\u8c03\u7528 <code>shutdown</code> \u65b9\u6cd5\u53ef\u4ee5\u5173\u95ed\u7ebf\u7a0b\u6c60\u3002\u5b83\u9996\u5148\u8bbe\u7f6e <code>_shutdown</code> \u4e3a <code>True</code>\uff0c\u7136\u540e\u6839\u636e <code>cancel_futures</code> \u53c2\u6570\u51b3\u5b9a\u662f\u5426\u53d6\u6d88\u961f\u5217\u4e2d\u7684\u4efb\u52a1\u3002\u6700\u540e\uff0c\u5411\u5de5\u4f5c\u961f\u5217\u4e2d\u653e\u5165\u4e0e\u7ebf\u7a0b\u6570\u91cf\u76f8\u540c\u7684 <code>None</code> \u503c\uff0c\u4ee5\u5524\u9192\u6240\u6709\u7ebf\u7a0b\u5e76\u8ba9\u5b83\u4eec\u9000\u51fa\u3002\u5982\u679c <code>wait</code> \u53c2\u6570\u4e3a <code>True</code>\uff0c\u5219\u7b49\u5f85\u6240\u6709\u7ebf\u7a0b\u7ed3\u675f\u3002</p> <pre><code>def shutdown(self, wait=True, *, cancel_futures=False):\n    with self._shutdown_lock:\n        self._shutdown = True\n        if cancel_futures:\n            # \u53d6\u6d88\u672a\u5f00\u59cb\u7684\u4efb\u52a1\n            while True:\n                try:\n                    work_item = self._work_queue.get_nowait()\n                    if work_item is not None:\n                        work_item.future.cancel()\n                except queue.Empty:\n                    break\n        # \u901a\u77e5\u6240\u6709\u7ebf\u7a0b\u9000\u51fa\n        self._work_queue.put(None)\n    if wait:\n        for t in self._threads:\n            t.join()  # \u7b49\u5f85\u7ebf\u7a0b\u7ed3\u675f\n</code></pre>"},{"location":"python/python%E4%B8%ADThreadPoolExecutor%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/#4","title":"4. \u5168\u5c40\u5173\u95ed\u534f\u8c03","text":"<ul> <li>\u4f7f\u7528 <code>_global_shutdown_lock</code> \u6765\u786e\u4fdd\u5728\u89e3\u91ca\u5668\u5173\u95ed\u65f6\u4e0d\u4f1a\u521b\u5efa\u65b0\u7684\u7ebf\u7a0b\u3002</li> <li>\u901a\u8fc7 <code>threading._register_atexit</code> \u6ce8\u518c <code>_python_exit</code> \u51fd\u6570\uff0c\u5728\u89e3\u91ca\u5668\u9000\u51fa\u65f6\u901a\u77e5\u6240\u6709\u7ebf\u7a0b\u9000\u51fa\u3002</li> </ul> <pre><code>def _python_exit():\n    global _shutdown\n    with _global_shutdown_lock:\n        _shutdown = True\n    items = list(_threads_queues.items())\n    for t, q in items:\n        q.put(None)\n    for t, q in items:\n        t.join()\n\n# Register for `_python_exit()` to be called just before joining all\n# non-daemon threads. This is used instead of `atexit.register()` for\n# compatibility with subinterpreters, which no longer support daemon threads.\n# See bpo-39812 for context.\nthreading._register_atexit(_python_exit)\n</code></pre>"},{"location":"python/python%E4%B8%ADThreadPoolExecutor%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/#5","title":"5.\u5f02\u5e38\u5904\u7406","text":"<ul> <li>\u5982\u679c\u7ebf\u7a0b\u521d\u59cb\u5316\u5668\uff08<code>initializer</code>\uff09\u629b\u51fa\u5f02\u5e38\uff0c\u5219\u7ebf\u7a0b\u6c60\u4f1a\u88ab\u6807\u8bb0\u4e3a\u635f\u574f\uff08<code>_broken</code>\uff09\uff0c\u5e76\u4e14\u6240\u6709\u7b49\u5f85\u4e2d\u7684\u4efb\u52a1\u90fd\u4f1a\u6536\u5230 <code>BrokenThreadPool</code> \u5f02\u5e38\u3002</li> <li>\u5de5\u4f5c\u7ebf\u7a0b\u4e2d\u7684\u5f02\u5e38\u4f1a\u88ab\u6355\u83b7\u5e76\u8bb0\u5f55\uff0c\u4f46\u4e0d\u4f1a\u5f71\u54cd\u5176\u4ed6\u7ebf\u7a0b\u3002</li> </ul>"},{"location":"python/python%E4%B8%ADThreadPoolExecutor%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/#_4","title":"\u5b9e\u9645\u6267\u884c\u6d41\u7a0b\u793a\u4f8b","text":"<p>\u5047\u8bbe <code>max_workers=2</code>\uff1a</p> <ol> <li>\u63d0\u4ea4\u7b2c\u4e00\u4e2a\u4efb\u52a1 \u2192 \u521b\u5efa\u7ebf\u7a0b1 \u2192 \u7ebf\u7a0b1\u5f00\u59cb\u6267\u884c\u4efb\u52a1</li> <li>\u63d0\u4ea4\u7b2c\u4e8c\u4e2a\u4efb\u52a1 \u2192 \u521b\u5efa\u7ebf\u7a0b2 \u2192 \u7ebf\u7a0b2\u5f00\u59cb\u6267\u884c\u4efb\u52a1</li> <li>\u63d0\u4ea4\u7b2c\u4e09\u4e2a\u4efb\u52a1 \u2192 \u653e\u5165\u961f\u5217 \u2192 \u7ebf\u7a0b1\u62162\u5b8c\u6210\u5f53\u524d\u4efb\u52a1\u540e\u4ece\u961f\u5217\u83b7\u53d6\u5e76\u6267\u884c</li> <li>\u6301\u7eed\u63d0\u4ea4\u4efb\u52a1 \u2192 \u7ebf\u7a0b1\u548c\u7ebf\u7a0b2\u8f6e\u6d41\u4ece\u961f\u5217\u83b7\u53d6\u4efb\u52a1\u6267\u884c</li> <li>\u4efb\u52a1\u63d0\u4ea4\u5b8c\u6bd5 \u2192 \u7ebf\u7a0b1\u548c\u7ebf\u7a0b2\u5728 <code>work_queue.get()</code> \u5904\u963b\u585e\u7b49\u5f85\u65b0\u4efb\u52a1</li> </ol>"},{"location":"python/python%E4%B8%ADThreadPoolExecutor%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/#_5","title":"\u5de5\u4f5c\u6d41\u7a0b\u603b\u7ed3","text":"<ol> <li>\u63d0\u4ea4\u4efb\u52a1 \u2192 \u521b\u5efa Future \u548c WorkItem \u2192 \u4efb\u52a1\u5165\u961f</li> <li>\u7ebf\u7a0b\u7ba1\u7406 \u2192 \u68c0\u67e5\u7a7a\u95f2\u7ebf\u7a0b \u2192 \u5fc5\u8981\u65f6\u521b\u5efa\u65b0\u7ebf\u7a0b</li> <li>\u4efb\u52a1\u6267\u884c \u2192 \u5de5\u4f5c\u7ebf\u7a0b\u83b7\u53d6\u4efb\u52a1 \u2192 \u6267\u884c\u51fd\u6570 \u2192 \u8bbe\u7f6e Future \u7ed3\u679c</li> <li>\u8d44\u6e90\u56de\u6536 \u2192 \u4efb\u52a1\u5b8c\u6210\u91ca\u653e\u8d44\u6e90 \u2192 \u7a7a\u95f2\u8ba1\u6570\u66f4\u65b0</li> <li>\u5173\u95ed\u8fc7\u7a0b \u2192 \u8bbe\u7f6e\u5173\u95ed\u6807\u5fd7 \u2192 \u53d1\u9001\u9000\u51fa\u4fe1\u53f7 \u2192 \u7b49\u5f85\u7ebf\u7a0b\u7ed3\u675f</li> </ol> <p>\u8fd9\u79cd\u8bbe\u8ba1\u5b9e\u73b0\u4e86\u9ad8\u6548\u7684\u7ebf\u7a0b\u590d\u7528\u3001\u52a8\u6001\u8d44\u6e90\u7ba1\u7406\u548c\u4f18\u96c5\u7684\u5173\u95ed\u673a\u5236\u3002</p>"},{"location":"python/python%E4%B8%ADThreadPoolExecutor%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/#threadpoolexecutor","title":"ThreadPoolExecutor\u4f7f\u7528\u7684\u6700\u4f73\u5b9e\u8df5","text":"<p>\u6ce8\u610f\uff1a\u7531\u4e8eGIL\u7684\u5b58\u5728\uff0cCPU\u5bc6\u96c6\u578b\u4efb\u52a1\u5728Python\u4e2d\u4f7f\u7528\u591a\u7ebf\u7a0b\u5e76\u4e0d\u4f1a\u63d0\u9ad8\u6027\u80fd\uff0c\u56e0\u6b64ThreadPoolExecutor\u66f4\u9002\u5408I/O\u5bc6\u96c6\u578b\u4efb\u52a1\u3002 </p> <p>\u5728Python\u4e2d\u4f7f\u7528<code>ThreadPoolExecutor</code>\u65f6\uff0c\u9075\u5faa\u4e00\u4e9b\u6700\u4f73\u5b9e\u8df5\u53ef\u4ee5\u786e\u4fdd\u4ee3\u7801\u9ad8\u6548\u3001\u53ef\u9760\u4e14\u6613\u4e8e\u7ef4\u62a4\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u5173\u952e\u7684\u6700\u4f73\u5b9e\u8df5\uff1a</p> <ol> <li>\u4f7f\u7528\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668\uff08with\u8bed\u53e5\uff09\uff1a\u786e\u4fdd\u7ebf\u7a0b\u6c60\u5728\u4f7f\u7528\u540e\u6b63\u786e\u5173\u95ed\uff0c\u5373\u4f7f\u53d1\u751f\u5f02\u5e38\u4e5f\u80fd\u6b63\u786e\u6e05\u7406\u8d44\u6e90\u3002</li> <li>\u5408\u7406\u8bbe\u7f6e\u7ebf\u7a0b\u6570\u91cf\uff1a\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>ThreadPoolExecutor</code>\u4f1a\u6839\u636e\u9700\u8981\u521b\u5efa\u7ebf\u7a0b\uff0c\u4f46\u4f60\u53ef\u4ee5\u901a\u8fc7<code>max_workers</code>\u53c2\u6570\u63a7\u5236\u6700\u5927\u7ebf\u7a0b\u6570\u3002\u6839\u636e\u4efb\u52a1\u7c7b\u578b\uff08I/O\u5bc6\u96c6\u578b\u6216CPU\u5bc6\u96c6\u578b\uff09\u8c03\u6574\u7ebf\u7a0b\u6570\u3002</li> <li>\u5904\u7406\u5f02\u5e38\uff1a\u4f7f\u7528<code>Future</code>\u5bf9\u8c61\u65f6\uff0c\u52a1\u5fc5\u5904\u7406\u53ef\u80fd\u51fa\u73b0\u7684\u5f02\u5e38\uff0c\u907f\u514d\u5f02\u5e38\u88ab\u5ffd\u7565\u3002</li> <li>\u907f\u514d\u957f\u65f6\u95f4\u963b\u585e\u4e3b\u7ebf\u7a0b\uff1a\u4f7f\u7528<code>as_completed</code>\u6216<code>wait</code>\u7b49\u65b9\u6cd5\u6765\u83b7\u53d6\u5df2\u5b8c\u6210\u7684\u4efb\u52a1\u7ed3\u679c\uff0c\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u7b49\u5f85\u3002</li> <li>\u4f7f\u7528<code>map</code>\u65b9\u6cd5\u7b80\u5316\u4ee3\u7801\uff1a\u5f53\u9700\u8981\u4e3a\u591a\u4e2a\u53c2\u6570\u8c03\u7528\u540c\u4e00\u4e2a\u51fd\u6570\u65f6\uff0c\u4f7f\u7528<code>map</code>\u65b9\u6cd5\u53ef\u4ee5\u7b80\u5316\u4ee3\u7801\uff08\u4f46\u6ce8\u610fmap\u4f1a\u6309\u7167\u8f93\u5165\u987a\u5e8f\u8fd4\u56de\u7ed3\u679c\uff0c\u800cas_completed\u6309\u7167\u5b8c\u6210\u987a\u5e8f\u8fd4\u56de\uff09\u3002</li> <li>\u6ce8\u610f\u4efb\u52a1\u4e4b\u95f4\u7684\u72ec\u7acb\u6027\uff1a\u786e\u4fdd\u63d0\u4ea4\u7684\u4efb\u52a1\u662f\u76f8\u4e92\u72ec\u7acb\u7684\uff0c\u907f\u514d\u7ade\u4e89\u6761\u4ef6\u6216\u4f9d\u8d56\u5173\u7cfb\uff0c\u5426\u5219\u53ef\u80fd\u9700\u8981\u4f7f\u7528\u9501\u673a\u5236\uff0c\u4f46\u8fd9\u4f1a\u589e\u52a0\u590d\u6742\u6027\u5e76\u964d\u4f4e\u6027\u80fd\u3002</li> <li>\u4f7f\u7528<code>thread_name_prefix</code>\u8fdb\u884c\u8c03\u8bd5\uff1a\u4e3a\u7ebf\u7a0b\u8bbe\u7f6e\u540d\u79f0\u524d\u7f00\uff0c\u4fbf\u4e8e\u8c03\u8bd5\u548c\u65e5\u5fd7\u8bb0\u5f55\u3002</li> <li>\u8003\u8651\u4f7f\u7528<code>initializer</code>\u548c<code>initargs</code>\uff1a\u5982\u679c\u6bcf\u4e2a\u7ebf\u7a0b\u9700\u8981\u6267\u884c\u4e00\u4e9b\u521d\u59cb\u5316\u64cd\u4f5c\uff08\u5982\u8bbe\u7f6e\u6570\u636e\u5e93\u8fde\u63a5\uff09\uff0c\u53ef\u4ee5\u4f7f\u7528\u521d\u59cb\u5668\u3002</li> <li>\u907f\u514d\u5728\u4efb\u52a1\u4e2d\u4fee\u6539\u5168\u5c40\u72b6\u6001\uff1a\u5c3d\u91cf\u4f7f\u4efb\u52a1\u51fd\u6570\u65e0\u72b6\u6001\uff0c\u4f7f\u7528\u7ebf\u7a0b\u5c40\u90e8\u53d8\u91cf\u6765\u5b58\u50a8\u6bcf\u4e2a\u7ebf\u7a0b\u7684\u72b6\u6001\uff0c\u5982\u679c\u5fc5\u987b\u4fee\u6539\u5171\u4eab\u6570\u636e\uff0c\u4f7f\u7528\u9002\u5f53\u7684\u540c\u6b65\u673a\u5236\u3002</li> <li>\u8c28\u614e\u4f7f\u7528<code>shutdown</code>\u4e2d\u7684<code>cancel_futures</code>\uff1a\u5728Python 3.9\u53ca\u4ee5\u4e0a\u7248\u672c\uff0c\u53ef\u4ee5\u5728\u5173\u95ed\u65f6\u53d6\u6d88\u6240\u6709\u672a\u5f00\u59cb\u7684\u4efb\u52a1\uff0c\u4f46\u8981\u6ce8\u610f\u5df2\u7ecf\u5f00\u59cb\u7684\u4efb\u52a1\u4f1a\u7ee7\u7eed\u6267\u884c\u3002</li> </ol> <p>\u4ee5\u4e0b\u662f\u4f7f\u7528<code>ThreadPoolExecutor</code>\u7684\u6700\u4f73\u5b9e\u8df5\u4ee3\u7801\u793a\u4f8b\uff0c\u8be6\u7ec6\u6f14\u793a\u4e86\u4e0a\u8ff0\u8981\u70b9\uff1a</p> <pre><code>import concurrent.futures\nimport threading\nimport time\nimport random\n\n# \u7528\u4e8e\u6f14\u793a\u7ebf\u7a0b\u5c40\u90e8\u6570\u636e\u548c\u521d\u59cb\u5316\u5668\nthread_local = threading.local()\n\ndef initializer_function(initial_data):\n    \"\"\"\u7ebf\u7a0b\u521d\u59cb\u5316\u5668\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u542f\u52a8\u65f6\u8c03\u7528\u4e00\u6b21\"\"\"\n    thread_local.counter = 0\n    thread_local.initial_data = initial_data\n    print(f\"\u7ebf\u7a0b {threading.current_thread().name} \u521d\u59cb\u5316\u5b8c\u6210\uff0c\u521d\u59cb\u6570\u636e: {initial_data}\")\n\ndef io_bound_task(parameter):\n    \"\"\"\n    \u6a21\u62dfI/O\u5bc6\u96c6\u578b\u4efb\u52a1\n    \u786e\u4fdd\u4efb\u52a1\u51fd\u6570\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u6216\u8005\u4f7f\u7528\u9002\u5f53\u7684\u540c\u6b65\u673a\u5236\n    \"\"\"\n    try:\n        # \u4f7f\u7528\u7ebf\u7a0b\u5c40\u90e8\u6570\u636e\n        thread_local.counter += 1\n\n        # \u6a21\u62df\u968f\u673a\u5ef6\u8fdf\uff080.1-0.5\u79d2\uff09\n        delay = random.uniform(0.1, 0.5)\n        time.sleep(delay)\n\n        # \u6a21\u62df\u5076\u5c14\u7684\u5f02\u5e38\n        if parameter % 7 == 0:  # \u6bcf7\u4e2a\u4efb\u52a1\u6a21\u62df\u4e00\u4e2a\u5f02\u5e38\n            raise ValueError(f\"\u53c2\u6570 {parameter} \u89e6\u53d1\u4e86\u6a21\u62df\u5f02\u5e38\")\n\n        # \u6a21\u62df\u4e00\u4e9b\u5904\u7406\u903b\u8f91\n        result = parameter * parameter\n        thread_id = threading.current_thread().ident\n\n        print(f\"\u7ebf\u7a0b {threading.current_thread().name} \u5904\u7406\u53c2\u6570 {parameter}, \"\n              f\"\u5c40\u90e8\u8ba1\u6570\u5668: {thread_local.counter}, \u7ed3\u679c: {result}\")\n\n        return result\n\n    except Exception as e:\n        print(f\"\u4efb\u52a1 {parameter} \u6267\u884c\u5931\u8d25: {e}\")\n        raise  # \u91cd\u65b0\u629b\u51fa\u5f02\u5e38\uff0c\u8ba9Future\u5bf9\u8c61\u80fd\u591f\u6355\u83b7\n\ndef process_completed_tasks(futures_dict):\n    \"\"\"\u5904\u7406\u5df2\u5b8c\u6210\u7684\u4efb\u52a1\uff0c\u6f14\u793a\u5f02\u5e38\u5904\u7406\u548c\u7ed3\u679c\u6536\u96c6\"\"\"\n    completed_count = 0\n    failed_count = 0\n\n    for future in concurrent.futures.as_completed(futures_dict):\n        parameter = futures_dict[future]\n\n        try:\n            result = future.result()\n            print(f\"\u4efb\u52a1\u5b8c\u6210: \u53c2\u6570 {parameter} -&gt; \u7ed3\u679c {result}\")\n            completed_count += 1\n\n        except Exception as e:\n            print(f\"\u4efb\u52a1\u5931\u8d25: \u53c2\u6570 {parameter}, \u9519\u8bef: {e}\")\n            failed_count += 1\n\n    return completed_count, failed_count\n\ndef demonstrate_thread_pool_best_practices():\n    \"\"\"\u6f14\u793aThreadPoolExecutor\u7684\u6700\u4f73\u5b9e\u8df5\"\"\"\n\n    # \u6700\u4f73\u5b9e\u8df51: \u4f7f\u7528\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668\n    # \u6700\u4f73\u5b9e\u8df52: \u5408\u7406\u8bbe\u7f6e\u7ebf\u7a0b\u6570\u91cf\uff08\u8fd9\u91cc\u8bbe\u7f6e\u4e3a4\uff0c\u9002\u5408I/O\u5bc6\u96c6\u578b\u4efb\u52a1\uff09\n    # \u6700\u4f73\u5b9e\u8df57: \u8bbe\u7f6e\u7ebf\u7a0b\u540d\u79f0\u524d\u7f00\u4fbf\u4e8e\u8c03\u8bd5\n    # \u6700\u4f73\u5b9e\u8df58: \u4f7f\u7528\u521d\u59cb\u5316\u5668\n    with concurrent.futures.ThreadPoolExecutor(\n            max_workers=4,\n            thread_name_prefix=\"WorkerThread\",\n            initializer=initializer_function,\n            initargs=(\"\u5171\u4eab\u521d\u59cb\u5316\u6570\u636e\",)\n    ) as executor:\n\n        print(\"=== \u5f00\u59cb\u6f14\u793aThreadPoolExecutor\u6700\u4f73\u5b9e\u8df5 ===\\n\")\n\n        # \u51c6\u5907\u4efb\u52a1\u53c2\u6570\n        task_parameters = list(range(1, 21))  # 20\u4e2a\u4efb\u52a1\n\n        # \u65b9\u6cd5A: \u4f7f\u7528submit\u63d0\u4ea4\u5355\u4e2a\u4efb\u52a1\n        print(\"1. \u4f7f\u7528submit\u65b9\u6cd5\u63d0\u4ea4\u4efb\u52a1:\")\n        futures_dict = {}\n\n        for param in task_parameters[:5]:  # \u5148\u63d0\u4ea45\u4e2a\u4efb\u52a1\u6f14\u793a\n            future = executor.submit(io_bound_task, param)\n            futures_dict[future] = param\n            print(f\"\u5df2\u63d0\u4ea4\u4efb\u52a1: \u53c2\u6570 {param}\")\n\n        # \u6700\u4f73\u5b9e\u8df54: \u4f7f\u7528as_completed\u5904\u7406\u5df2\u5b8c\u6210\u4efb\u52a1\n        print(\"\\n2. \u4f7f\u7528as_completed\u5904\u7406\u5b8c\u6210\u7684\u4efb\u52a1:\")\n        completed, failed = process_completed_tasks(futures_dict)\n        print(f\"\u5df2\u5b8c\u6210: {completed}, \u5931\u8d25: {failed}\")\n\n        # \u65b9\u6cd5B: \u4f7f\u7528map\u65b9\u6cd5\uff08\u6700\u4f73\u5b9e\u8df55\uff09\n        print(\"\\n3. \u4f7f\u7528map\u65b9\u6cd5\u6279\u91cf\u5904\u7406\u4efb\u52a1:\")\n        try:\n            # map\u4f1a\u4fdd\u6301\u8f93\u5165\u987a\u5e8f\uff0c\u4f46\u6309\u5b8c\u6210\u987a\u5e8f\u8fd4\u56de\u53ef\u80fd\u4e0d\u662f\u6700\u4f18\u7684\n            results = list(executor.map(\n                io_bound_task,\n                task_parameters[5:15],  # \u63a5\u4e0b\u6765\u768410\u4e2a\u4efb\u52a1\n                timeout=10  # \u8bbe\u7f6e\u8d85\u65f6\n            ))\n            print(f\"map\u65b9\u6cd5\u6210\u529f\u5904\u7406 {len(results)} \u4e2a\u4efb\u52a1\")\n\n        except concurrent.futures.TimeoutError:\n            print(\"\u4efb\u52a1\u6267\u884c\u8d85\u65f6!\")\n        except Exception as e:\n            print(f\"map\u6267\u884c\u8fc7\u7a0b\u4e2d\u53d1\u751f\u9519\u8bef: {e}\")\n\n        # \u65b9\u6cd5C: \u6279\u91cf\u63d0\u4ea4\u5269\u4f59\u4efb\u52a1\n        print(\"\\n4. \u6279\u91cf\u63d0\u4ea4\u5269\u4f59\u4efb\u52a1\u5e76\u7b49\u5f85\u5b8c\u6210:\")\n        remaining_futures = {\n            executor.submit(io_bound_task, param): param\n            for param in task_parameters[15:]\n        }\n\n        completed, failed = process_completed_tasks(remaining_futures)\n        print(f\"\u6700\u7ec8\u7edf\u8ba1 - \u603b\u8ba1\u5b8c\u6210: {completed}, \u5931\u8d25: {failed}\")\n\n    print(\"\\n=== \u6240\u6709\u4efb\u52a1\u6267\u884c\u5b8c\u6210\uff0c\u7ebf\u7a0b\u6c60\u5df2\u81ea\u52a8\u5173\u95ed ===\")\n\ndef demonstrate_advanced_scenarios():\n    \"\"\"\u6f14\u793a\u4e00\u4e9b\u9ad8\u7ea7\u573a\u666f\"\"\"\n    print(\"\\n=== \u9ad8\u7ea7\u573a\u666f\u6f14\u793a ===\\n\")\n\n    # \u573a\u666f\uff1a\u4f7f\u7528\u4e0d\u540c\u7684\u5f02\u5e38\u5904\u7406\u7b56\u7565\n    def robust_task(x):\n        try:\n            if x % 3 == 0:\n                raise RuntimeError(f\"\u4efb\u52a1 {x} \u7684\u6a21\u62df\u9519\u8bef\")\n            return x * 2\n        except Exception as e:\n            return f\"\u9519\u8bef: {e}\"\n\n    with concurrent.futures.ThreadPoolExecutor(max_workers=2) as executor:\n        # \u63d0\u4ea4\u4efb\u52a1\n        futures = [executor.submit(robust_task, i) for i in range(10)]\n\n        # \u6536\u96c6\u7ed3\u679c\uff0c\u6f14\u793a\u4e0d\u540c\u7684\u5f02\u5e38\u5904\u7406\u65b9\u5f0f\n        for future in concurrent.futures.as_completed(futures):\n            try:\n                result = future.result(timeout=5)\n                print(f\"\u4efb\u52a1\u7ed3\u679c: {result}\")\n            except concurrent.futures.TimeoutError:\n                print(\"\u4efb\u52a1\u8d85\u65f6\")\n            except Exception as e:\n                print(f\"\u4efb\u52a1\u6267\u884c\u5f02\u5e38: {e}\")\n\nif __name__ == \"__main__\":\n    # \u6f14\u793a\u4e3b\u8981\u7684\u6700\u4f73\u5b9e\u8df5\n    demonstrate_thread_pool_best_practices()\n\n    # \u6f14\u793a\u9ad8\u7ea7\u573a\u666f\n    demonstrate_advanced_scenarios()\n\n    print(\"\\n=== \u6240\u6709\u6f14\u793a\u5b8c\u6210 ===\")\n</code></pre>"},{"location":"python/python%E4%B8%ADThreadPoolExecutor%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/#_6","title":"\u603b\u7ed3","text":"<p><code>ThreadPoolExecutor</code> \u7684\u7ebf\u7a0b\u590d\u7528\u662f\u901a\u8fc7 \u5de5\u4f5c\u7ebf\u7a0b\u7684\u65e0\u9650\u5faa\u73af + \u963b\u585e\u961f\u5217\u5b9e\u73b0\u7684\uff1a</p> <ul> <li>\u7ebf\u7a0b\u4e0d\u9000\u51fa\uff1a\u5de5\u4f5c\u7ebf\u7a0b\u521b\u5efa\u540e\u9664\u975e\u6536\u5230\u5173\u95ed\u4fe1\u53f7\uff0c\u5426\u5219\u6c38\u4e0d\u9000\u51fa</li> <li>\u4efb\u52a1\u9a71\u52a8\uff1a\u7ebf\u7a0b\u5728\u961f\u5217\u5904\u963b\u585e\u7b49\u5f85\uff0c\u6709\u4efb\u52a1\u65f6\u624d\u6fc0\u6d3b</li> <li>\u8d44\u6e90\u5171\u4eab\uff1a\u6240\u6709\u7ebf\u7a0b\u5171\u4eab\u540c\u4e00\u4e2a\u4efb\u52a1\u961f\u5217\uff0c\u5b9e\u73b0\u8d1f\u8f7d\u5747\u8861</li> <li>\u907f\u514d\u91cd\u590d\u521b\u5efa\uff1a\u901a\u8fc7\u4fe1\u53f7\u91cf\u673a\u5236\u907f\u514d\u521b\u5efa\u4e0d\u5fc5\u8981\u7684\u7ebf\u7a0b</li> </ul> <p><code>ThreadPoolExecutor</code> \u901a\u8fc7\u4e00\u4e2a\u5de5\u4f5c\u961f\u5217\u548c\u4e00\u7ec4\u5de5\u4f5c\u7ebf\u7a0b\u6765\u5b9e\u73b0\u7ebf\u7a0b\u6c60\u3002\u4efb\u52a1\u88ab\u63d0\u4ea4\u5230\u5de5\u4f5c\u961f\u5217\uff0c\u5de5\u4f5c\u7ebf\u7a0b\u4ece\u961f\u5217\u4e2d\u83b7\u53d6\u4efb\u52a1\u5e76\u6267\u884c\u3002\u7ebf\u7a0b\u6c60\u6839\u636e\u4efb\u52a1\u6570\u91cf\u52a8\u6001\u8c03\u6574\u7ebf\u7a0b\u6570\u91cf\uff0c\u4f46\u4e0d\u4f1a\u8d85\u8fc7\u6700\u5927\u7ebf\u7a0b\u6570\u3002\u5f53\u7ebf\u7a0b\u6c60\u5173\u95ed\u65f6\uff0c\u4f1a\u901a\u77e5\u6240\u6709\u7ebf\u7a0b\u9000\u51fa\uff0c\u5e76\u53ef\u4ee5\u6839\u636e\u9700\u8981\u53d6\u6d88\u672a\u6267\u884c\u7684\u4efb\u52a1\u3002</p> <p>\u8fd9\u79cd\u8bbe\u8ba1\u4f7f\u5f97 ThreadPoolExecutor \u80fd\u591f\u9ad8\u6548\u5730\u7ba1\u7406\u7ebf\u7a0b\u5e76\u6267\u884c\u5927\u91cf\u4efb\u52a1\uff0c\u540c\u65f6\u907f\u514d\u4e86\u9891\u7e41\u521b\u5efa\u548c\u9500\u6bc1\u7ebf\u7a0b\u7684\u5f00\u9500\uff0c\u5b9e\u73b0\u4e86\u771f\u6b63\u7684\u7ebf\u7a0b\u590d\u7528\u3002</p>"},{"location":"python/python%E4%BD%BF%E7%94%A8%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%8F%90%E5%8F%96json%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E5%80%BC/","title":"python \u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u4ecejson\u5b57\u7b26\u4e32\u4e2d\u53d6\u51fa\u7279\u5b9a\u5b57\u6bb5\u7684\u503c","text":"<p>\u5b64\u72ec\u4e2d\uff0c\u4f60\u53ef\u4ee5\u83b7\u5f97\u4e00\u5207\uff0c\u9664\u4e86\u54c1\u683c\u3002\u2014\u2014 \u53f8\u6c64\u8fbe\u300a\u7ea2\u4e0e\u9ed1\u300b</p>"},{"location":"python/python%E4%BD%BF%E7%94%A8%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%8F%90%E5%8F%96json%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E5%80%BC/#_1","title":"\u4e00. \u6982\u8ff0","text":"<p>\u6700\u8fd1\u5728\u4f7f\u7528\u722c\u866b\u6293\u53d6\u4e00\u4e9b\u6570\u636e\uff0c\u4ece\u83b7\u53d6\u5230\u7684 <code>html</code> \u6587\u672c\u4e2d\u65e0\u6cd5\u76f4\u63a5\u901a\u8fc7 <code>xpath</code> \u89e3\u6790\u51fa\u5bf9\u5e94\u7684\u6570\u636e\uff0c\u9700\u8981\u4ece <code>js</code> \u811a\u672c\u4e2d\u89e3\u6790\u4e00\u4e9b\u7c7b\u4f3c\u4e8e <code>json</code> \u7684\u6570\u636e\uff0c\u6570\u636e\u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>&lt;script src=\"//mat1.gtimg.com/pingjs/ext2020/configF2017/5df6e3b3.js\" charset=\"utf-8\"&gt;&lt;/script&gt;\n&lt;script src=\"//mat1.gtimg.com/pingjs/ext2020/configF2017/5a978a31.js\" charset=\"utf-8\"&gt;&lt;/script&gt;\n&lt;script&gt;window.conf_dcom = apub_5a978a31 &lt;/script&gt;&lt;!--[if !IE]&gt;|xGv00|61438c491c69d576aec9846de884f28b&lt;![endif]--&gt;\n&lt;!--[if !IE]&gt;|xGv00|038d6e161753081e56c192d04873c65c&lt;![endif]--&gt;\n    &lt;script&gt;window.DATA = {\n        \"article_id\": \"20210808A034KU\",\n        \"article_type\": \"0\",\n        \"title\": \"\u7a81\u53d1\uff01\u4e0a\u6d77\u51fa\u53f0\u623f\u8d37\u91cd\u78c5\u65b0\u89c4\uff01\u4f60\u7684\u8d37\u6b3e\u989d\u5ea6\u6807\u51c6\u53ef\u80fd\u8981\u53d8\u4e86\",\n        \"abstract\": null,\n        \"catalog1\": \"house\",\n        \"catalog2\": \"house_zhengce\",\n        \"media\": \"\u4e2d\u56fd\u8bc1\u5238\u62a5\",\n        \"media_id\": \"1368\",\n        \"pubtime\": \"2021-08-08 13:45:25\",\n        \"comment_id\": \"7221092095\",\n        \"tags\": \"\u94f6\u884c,\u4e0a\u6d77,\u623f\u8d37,\u8d37\u6b3e,\u4e0a\u6d77\u5e02\u623f\u7ba1\u5c40,\u4e8c\u624b\u623f\",\n        \"political\": 0,\n        \"artTemplate\": null,\n        \"FztCompetition\": null,\n        \"FCompetitionName\": null,\n        \"is_deleted\": 0,\n        \"cms_id\": \"20210808A034KU00\",\n        \"videoArr\": []\n}\n\n    &lt;/script&gt;\n  &lt;/head&gt;\n</code></pre>"},{"location":"python/python%E4%BD%BF%E7%94%A8%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%8F%90%E5%8F%96json%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E5%80%BC/#_2","title":"\u4e8c\u3001\u901a\u8fc7\u6b63\u5219\u8868\u8fbe\u5f0f\u63d0\u53d6\u6307\u5b9a\u5b57\u6bb5\u7684\u503c","text":"<p>\u9700\u8981\u5c06\u4e0a\u9762\u6587\u672c\u4e2d\u6307\u5b9a\u7684\u5b57\u6bb5\u7684\u503c\u89e3\u6790\u51fa\u6765</p> <p>\u5206\u6790\u5b57\u7b26\u4e32\u7684\u7ed3\u6784\u53ef\u4ee5\u770b\u51fa\u9700\u8981\u5339\u914d\u5185\u5bb9\u7684\u7ed3\u6784\u4e3a\uff1a<code>\"key\": \"(.*)\"</code></p> <p>\u4e0b\u9762\u81ea\u5df1\u5b9a\u4e49\u4e00\u4e2a\u51fd\u6570\u6765\u5b9e\u73b0\u6b64\u9700\u6c42\uff1a</p> <pre><code>import re\n\ndef find_value_by_regex(key, text):\n    \"\"\"\n    \u901a\u8fc7\u6b63\u5219\u8868\u8fbe\u5f0f\u63d0\u53d6json\u6307\u5b9a\u5b57\u6bb5\u7684\u503c\n    :param key: \u5b57\u6bb5\u540d\u79f0\n    :param text: \u8981\u63d0\u53d6\u7684\u6587\u672c\n    :return: \u5b57\u6bb5\u5bf9\u5e94\u7684\u503c\uff0c\u4e0d\u5b58\u5728\u5219\u8fd4\u56de\u7a7a\u5b57\u7b26\u4e32\n    \"\"\"\n    regex = r'\"key\": \"(.*)\"'.replace(\"key\", key)\n    match = re.compile(regex).findall(text)\n    val = ''\n    if match:\n        val = match[0]\n    return val\n\n\nif __name__ == \"__main__\":\n    text = '''\n         {\n                \"article_id\": \"20210808A034KU\",\n                \"article_type\": \"0\",\n                \"title\": \"\u7a81\u53d1\uff01\u4e0a\u6d77\u51fa\u53f0\u623f\u8d37\u91cd\u78c5\u65b0\u89c4\uff01\u4f60\u7684\u8d37\u6b3e\u989d\u5ea6\u6807\u51c6\u53ef\u80fd\u8981\u53d8\u4e86\",\n                \"abstract\": null,\n                \"catalog1\": \"house\",\n                \"catalog2\": \"house_zhengce\",\n                \"media\": \"\u4e2d\u56fd\u8bc1\u5238\u62a5\",\n                \"media_id\": \"1368\",\n                \"pubtime\": \"2021-08-08 13:45:25\",\n                \"comment_id\": \"7221092095\",\n                \"tags\": \"\u94f6\u884c,\u4e0a\u6d77,\u623f\u8d37,\u8d37\u6b3e,\u4e0a\u6d77\u5e02\u623f\u7ba1\u5c40,\u4e8c\u624b\u623f\",\n                \"political\": 0,\n                \"artTemplate\": null,\n                \"FztCompetition\": null,\n                \"FCompetitionName\": null,\n                \"is_deleted\": 0,\n                \"cms_id\": \"20210808A034KU00\",\n                \"videoArr\": []\n        }\n\n    '''\n    title = find_value_by_regex(\"title\", text)\n    pubtime = find_value_by_regex(\"pubtime\", text)\n    print(title)\n    print(pubtime)\n</code></pre> <p>\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>\u7a81\u53d1\uff01\u4e0a\u6d77\u51fa\u53f0\u623f\u8d37\u91cd\u78c5\u65b0\u89c4\uff01\u4f60\u7684\u8d37\u6b3e\u989d\u5ea6\u6807\u51c6\u53ef\u80fd\u8981\u53d8\u4e86\n2021-08-08 13:45:25\n</code></pre> <p>\u4e0a\u9762\u5b9a\u4e49\u7684\u65b9\u6cd5\u5df2\u7ecf\u89e3\u51b3\u4e86\u8fd9\u4e2a\u9700\u6c42\uff0c\u63a5\u4e0b\u6765\u5c06\u63d0\u53d6\u4e00\u4e9b\u722c\u53d6\u7f51\u9875\u7684\u5de5\u5177\u65b9\u6cd5\u65b9\u4fbf\u590d\u7528\uff0c\u8be6\u7ec6\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>#!/usr/bin/env python\n# -*- coding:utf-8 -*-\nimport random\nimport requests\nimport urllib3\n\n\ndef get_random_agent():\n    \"\"\"\n    \u968f\u673a\u83b7\u53d6 agent\n    :return:\n    \"\"\"\n    agent_list = [\n        \"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; AcooBrowser; .NET CLR 1.1.4322; .NET CLR 2.0.50727)\",\n        \"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; Acoo Browser; SLCC1; .NET CLR 2.0.50727; Media Center PC 5.0; .NET CLR 3.0.04506)\",\n        \"Mozilla/4.0 (compatible; MSIE 7.0; AOL 9.5; AOLBuild 4337.35; Windows NT 5.1; .NET CLR 1.1.4322; .NET CLR 2.0.50727)\",\n        \"Mozilla/5.0 (Windows; U; MSIE 9.0; Windows NT 9.0; en-US)\",\n        \"Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET CLR 2.0.50727; Media Center PC 6.0)\",\n        \"Mozilla/5.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET CLR 1.0.3705; .NET CLR 1.1.4322)\",\n        \"Mozilla/4.0 (compatible; MSIE 7.0b; Windows NT 5.2; .NET CLR 1.1.4322; .NET CLR 2.0.50727; InfoPath.2; .NET CLR 3.0.04506.30)\",\n        \"Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN) AppleWebKit/523.15 (KHTML, like Gecko, Safari/419.3) Arora/0.3 (Change: 287 c9dfb30)\",\n        \"Mozilla/5.0 (X11; U; Linux; en-US) AppleWebKit/527+ (KHTML, like Gecko, Safari/419.3) Arora/0.6\",\n        \"Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.2pre) Gecko/20070215 K-Ninja/2.1.1\",\n        \"Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN; rv:1.9) Gecko/20080705 Firefox/3.0 Kapiko/3.0\",\n        \"Mozilla/5.0 (X11; Linux i686; U;) Gecko/20070322 Kazehakase/0.4.5\",\n        \"Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.0.8) Gecko Fedora/1.9.0.8-1.fc10 Kazehakase/0.5.6\",\n        \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.56 Safari/535.11\",\n        \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_3) AppleWebKit/535.20 (KHTML, like Gecko) Chrome/19.0.1036.7 Safari/535.20\",\n        \"Opera/9.80 (Macintosh; Intel Mac OS X 10.6.8; U; fr) Presto/2.9.168 Version/11.52\",\n    ]\n    agent = random.choice(agent_list)\n    return agent\n\n\ndef get_headers():\n    \"\"\"\n    \u53d1\u9001HTTP\u8bf7\u6c42\u65f6\u7684HEAD\u4fe1\u606f\n    :return:\n    \"\"\"\n    headers = {\n        'Connection': 'Keep-Alive',\n        'Accept': 'text/html, application/xhtml+xml, */*',\n        'Accept-Language': 'en-US,en;q=0.8,zh-Hans-CN;q=0.5,zh-Hans;q=0.3',\n        'Accept-Encoding': 'gzip, deflate',\n        'User-Agent': get_random_agent()\n    }\n    return headers\n\n\ndef get_html(url):\n    \"\"\"\n    \u901a\u8fc7 url \u83b7\u53d6\u7f51\u9875 html \u6587\u672c \n    :param url: \n    :return: \n    \"\"\"\n    # \u8bbe\u7f6e\u7981\u7528 https \u8b66\u544a\n    urllib3.disable_warnings()\n    response = requests.get(url, headers=get_headers(), verify=False)\n    get_encoding = response.apparent_encoding  # \u83b7\u53d6\u7f16\u7801\n\n    response.encoding = get_encoding\n    return response.text\n</code></pre>"},{"location":"python/python%E4%BD%BF%E7%94%A8%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%8F%90%E5%8F%96json%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E5%80%BC/#pythonre","title":"\u4e09. python\u7684re\u6a21\u5757\u603b\u7ed3","text":"<p>\u4f7f\u7528\u722c\u866b\u722c\u53d6\u7f51\u9875\u6570\u636e\u7684\u8fc7\u7a0b\u4e2d\uff0c\u9700\u8981\u5229\u7528\u5404\u79cd\u5de5\u5177\u89e3\u6790\u7f51\u9875\u4e2d\u7684\u6570\u636e\uff0c\u6bd4\u5982\uff1a<code>etree</code>\uff0c<code>BeautifulSoup</code>\uff0c<code>scrapy</code> \u7b49\u5de5\u5177\uff0c\u4f46\u662f\u529f\u80fd\u6700\u5f3a\u5927\u7684\u8fd8\u662f\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u4e0b\u9762\u5c06\u5bf9 python \u7684 re \u6a21\u5757\u65b9\u6cd5\u505a\u4e00\u4e2a\u603b\u7ed3\u3002</p> <p><code>Python</code> \u901a\u8fc7 <code>re</code> \u6a21\u5757\u63d0\u4f9b\u5bf9\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u652f\u6301\u3002\u4f7f\u7528 <code>re</code> \u7684\u4e00\u822c\u6b65\u9aa4\u662f\uff1a</p> <ol> <li>\u4f7f\u7528 <code>re.compile(\u6b63\u5219\u8868\u8fbe\u5f0f)</code> \u5c06\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u5b57\u7b26\u4e32\u5f62\u5f0f\u7f16\u8bd1\u4e3a<code>Pattern</code>\u5b9e\u4f8b</li> <li>\u4f7f\u7528<code>Pattern</code>\u5b9e\u4f8b\u63d0\u4f9b\u7684\u65b9\u6cd5\u5904\u7406\u6587\u672c\u5e76\u83b7\u5f97\u5339\u914d\u7ed3\u679c\uff08\u4e00\u4e2a<code>Match</code>\u5b9e\u4f8b\uff09</li> <li>\u4f7f\u7528<code>Match</code>\u5b9e\u4f8b\u83b7\u5f97\u4fe1\u606f\uff0c\u8fdb\u884c\u5176\u4ed6\u7684\u64cd\u4f5c</li> </ol> <p>\u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\uff1a</p> <pre><code># -*- coding: utf-8 -*-\nimport re\n\nif __name__ == '__main__':\n    # \u5c06\u6b63\u5219\u8868\u8fbe\u5f0f\u7f16\u8bd1\u6210Pattern\u5bf9\u8c61\n    pattern = re.compile(r'hello')\n\n    # \u4f7f\u7528Pattern\u5339\u914d\u6587\u672c\uff0c\u83b7\u5f97\u5339\u914d\u7ed3\u679c\uff0c\u65e0\u6cd5\u5339\u914d\u65f6\u5c06\u8fd4\u56deNone\n    match = pattern.match('hello world!')\n\n    if match:\n        # \u4f7f\u7528Match\u83b7\u5f97\u5206\u7ec4\u4fe1\u606f\n        print(match.group()) # \u8f93\u51fa\u7ed3\u679c\uff1ahello\n</code></pre> <p>\u4f7f\u7528\u539f\u751f\u5b57\u7b26\u4e32\u5b9a\u4e49\u6b63\u5219\u8868\u8fbe\u5f0f\u53ef\u4ee5\u65b9\u4fbf\u7684\u89e3\u51b3\u8f6c\u4e49\u5b57\u7b26\u7684\u95ee\u9898</p> <p>\u539f\u751f\u5b57\u7b26\u4e32\u7684\u5b9a\u4e49\u65b9\u5f0f\u4e3a\uff1a<code>r''</code></p> <p>\u6709\u4e86\u539f\u751f\u5b57\u7b26\u4e32\uff0c\u4e0d\u9700\u8981\u624b\u52a8\u6dfb\u52a0\u8f6c\u4e49\u7b26\u53f7\uff0c\u5b83\u4f1a\u81ea\u52a8\u8f6c\u4e49\uff0c\u5199\u51fa\u6765\u7684\u8868\u8fbe\u5f0f\u4e5f\u66f4\u76f4\u89c2\u3002</p>"},{"location":"python/python%E4%BD%BF%E7%94%A8%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%8F%90%E5%8F%96json%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E5%80%BC/#1-re","title":"1. \u4f7f\u7528 re","text":"<p>re.compile(strPattern[, flag]): </p> <p>\u8fd9\u4e2a\u65b9\u6cd5\u662fPattern\u7c7b\u7684\u5de5\u5382\u65b9\u6cd5\uff0c\u7528\u4e8e\u5c06\u5b57\u7b26\u4e32\u5f62\u5f0f\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u7f16\u8bd1\u4e3aPattern\u5bf9\u8c61\u3002</p> <p>\u7b2c\u4e00\u4e2a\u53c2\u6570\uff1a\u6b63\u5219\u8868\u8fbe\u5f0f\u5b57\u7b26\u4e32</p> <p>\u7b2c\u4e8c\u4e2a\u53c2\u6570\uff08\u53ef\u9009\uff09\uff1a\u662f\u5339\u914d\u6a21\u5f0f\uff0c\u53d6\u503c\u53ef\u4ee5\u4f7f\u7528\u6309\u4f4d\u6216\u8fd0\u7b97\u7b26'|'\u8868\u793a\u540c\u65f6\u751f\u6548\uff0c\u6bd4\u5982 <code>re.I | re.M</code>\u3002</p> <p>\u53ef\u9009\u503c\u5982\u4e0b\uff1a</p> <ul> <li><code>re.I(re.IGNORECASE)</code>: \u5ffd\u7565\u5927\u5c0f\u5199\uff08\u62ec\u53f7\u5185\u662f\u5b8c\u6574\u5199\u6cd5\uff0c\u4e0b\u540c\uff09</li> <li><code>M(MULTILINE)</code>: \u591a\u884c\u6a21\u5f0f\uff0c\u6539\u53d8'^'\u548c'$'\u7684\u884c\u4e3a</li> <li><code>S(DOTALL)</code>: \u70b9\u4efb\u610f\u5339\u914d\u6a21\u5f0f\uff0c\u6539\u53d8'.'\u7684\u884c\u4e3a</li> <li><code>L(LOCALE)</code>: \u4f7f\u9884\u5b9a\u5b57\u7b26\u7c7b \\w \\W \\b \\B \\s \\S \u53d6\u51b3\u4e8e\u5f53\u524d\u533a\u57df\u8bbe\u5b9a</li> <li> <p><code>U(UNICODE)</code>: \u4f7f\u9884\u5b9a\u5b57\u7b26\u7c7b \\w \\W \\b \\B \\s \\S \\d \\D \u53d6\u51b3\u4e8eunicode\u5b9a\u4e49\u7684\u5b57\u7b26\u5c5e\u6027</p> </li> <li> <p><code>X(VERBOSE)</code>: \u8be6\u7ec6\u6a21\u5f0f\u3002\u8fd9\u4e2a\u6a21\u5f0f\u4e0b\u6b63\u5219\u8868\u8fbe\u5f0f\u53ef\u4ee5\u662f\u591a\u884c\uff0c\u5ffd\u7565\u7a7a\u767d\u5b57\u7b26\uff0c\u5e76\u53ef\u4ee5\u52a0\u5165\u6ce8\u91ca\u3002\u4ee5\u4e0b\u4e24\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0f\u662f\u7b49\u4ef7\u7684\uff1a</p> </li> </ul> <pre><code>a = re.compile(r\"\"\"\\d +  # the integral part\n                   \\.    # the decimal point\n                   \\d *  # some fractional digits\"\"\", re.X)\nb = re.compile(r\"\\d+\\.\\d*\")\n</code></pre> <p><code>re</code> \u63d0\u4f9b\u4e86\u4f17\u591a\u6a21\u5757\u65b9\u6cd5\u7528\u4e8e\u5b8c\u6210\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u529f\u80fd\u3002\u8fd9\u4e9b\u65b9\u6cd5\u53ef\u4ee5\u4f7f\u7528<code>Pattern</code>\u5b9e\u4f8b\u7684\u76f8\u5e94\u65b9\u6cd5\u66ff\u4ee3\uff0c\u552f\u4e00\u7684\u597d\u5904\u662f\u5c11\u5199\u4e00\u884c<code>re.compile()</code>\u4ee3\u7801\uff0c\u4f46\u540c\u65f6\u4e5f\u65e0\u6cd5\u590d\u7528\u7f16\u8bd1\u540e\u7684<code>Pattern</code>\u5bf9\u8c61\u3002\u8fd9\u4e9b\u65b9\u6cd5\u5c06\u5728Pattern\u7c7b\u7684\u5b9e\u4f8b\u65b9\u6cd5\u90e8\u5206\u4e00\u8d77\u4ecb\u7ecd\u3002\u5982\u4e0a\u9762\u8fd9\u4e2a\u4f8b\u5b50\u53ef\u4ee5\u7b80\u5199\u4e3a\uff1a</p> <pre><code>m = re.match(r'hello', 'hello world!')\nprint m.group()\n</code></pre>"},{"location":"python/python%E4%BD%BF%E7%94%A8%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%8F%90%E5%8F%96json%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E5%80%BC/#2-pattern","title":"2. \u4f7f\u7528 Pattern","text":"<p><code>Pattern</code> \u5bf9\u8c61\u662f\u4e00\u4e2a\u7f16\u8bd1\u597d\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u901a\u8fc7 <code>Pattern</code> \u63d0\u4f9b\u7684\u4e00\u7cfb\u5217\u65b9\u6cd5\u53ef\u4ee5\u5bf9\u6587\u672c\u8fdb\u884c\u5339\u914d\u67e5\u627e\u3002</p> <p><code>Pattern</code> \u5bf9\u8c61\u4e0d\u80fd\u76f4\u63a5\u5b9e\u4f8b\u5316\uff0c\u5fc5\u987b\u4f7f\u7528 <code>re.compile()</code> \u6765\u83b7\u53d6\u3002</p>"},{"location":"python/python%E4%BD%BF%E7%94%A8%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%8F%90%E5%8F%96json%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E5%80%BC/#21-pattern","title":"2.1 Pattern \u5bf9\u8c61\u7684\u5c5e\u6027","text":"<p><code>Pattern</code> \u63d0\u4f9b\u4e86\u51e0\u4e2a\u53ef\u8bfb\u5c5e\u6027\u7528\u4e8e\u83b7\u53d6\u8868\u8fbe\u5f0f\u7684\u76f8\u5173\u4fe1\u606f\uff1a</p> <ol> <li> <p>pattern: \u7f16\u8bd1\u65f6\u7528\u7684\u8868\u8fbe\u5f0f\u5b57\u7b26\u4e32\u3002</p> </li> <li> <p>flags: \u7f16\u8bd1\u65f6\u7528\u7684\u5339\u914d\u6a21\u5f0f\uff0c\u6570\u5b57\u5f62\u5f0f\u3002</p> </li> <li> <p>groups: \u8868\u8fbe\u5f0f\u4e2d\u5206\u7ec4\u7684\u6570\u91cf\u3002</p> </li> <li> <p>groupindex: \u4ee5\u8868\u8fbe\u5f0f\u4e2d\u6709\u522b\u540d\u7684\u7ec4\u7684\u522b\u540d\u4e3a\u952e\u3001\u4ee5\u8be5\u7ec4\u5bf9\u5e94\u7684\u7f16\u53f7\u4e3a\u503c\u7684\u5b57\u5178\uff0c\u6ca1\u6709\u522b\u540d\u7684\u7ec4\u4e0d\u5305\u542b\u5728\u5185\u3002</p> </li> </ol> <pre><code># -*- coding: utf-8 -*-\nimport re\n\nif __name__ == '__main__':\n    text = 'hello world'\n    p = re.compile(r'(\\w+) (\\w+)(?P&lt;sign&gt;.*)', re.DOTALL)\n\n    print(\"p.pattern:\", p.pattern)\n    print(\"p.flags:\", p.flags)\n    print(\"p.groups:\", p.groups)\n    print(\"p.groupindex:\", p.groupindex)\n</code></pre> <p>\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>p.pattern: (\\w+) (\\w+)(?P&lt;sign&gt;.*)\np.flags: 48\np.groups: 3\np.groupindex: {'sign': 3}\n</code></pre>"},{"location":"python/python%E4%BD%BF%E7%94%A8%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%8F%90%E5%8F%96json%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E5%80%BC/#22-pattern","title":"2.2 Pattern \u5bf9\u8c61\u7684\u65b9\u6cd5","text":"<p>1. match(string[, pos[, endpos]]) | re.match(pattern, string[, flags]):</p> <p>\u5982\u679c string \u7684 \u5f00\u59cb\u4f4d\u7f6e \u80fd\u591f\u627e\u5230\u8fd9\u4e2a\u6b63\u5219\u6837\u5f0f\u7684\u4efb\u610f\u4e2a\u5339\u914d\uff0c\u5c31\u8fd4\u56de\u4e00\u4e2a\u76f8\u5e94\u7684 <code>Match</code>\u5bf9\u8c61\u3002</p> <p>\u5982\u679c\u5339\u914d\u8fc7\u7a0b\u4e2d<code>pattern</code>\u65e0\u6cd5\u5339\u914d\uff0c\u6216\u8005\u5339\u914d\u672a\u7ed3\u675f\u5c31\u5df2\u5230\u8fbe<code>endpos</code>\uff0c\u5219\u8fd4\u56de<code>None</code>\u3002</p> <p><code>pos</code> \u548c<code>endpos</code> \u7684\u9ed8\u8ba4\u503c\u5206\u522b\u4e3a <code>0</code> \u548c <code>len(string)</code>\uff1b</p> <p><code>re.match()</code> \u65e0\u6cd5\u6307\u5b9a\u8fd9\u4e24\u4e2a\u53c2\u6570\uff0c\u53c2\u6570<code>flags</code>\u7528\u4e8e\u7f16\u8bd1<code>pattern</code>\u65f6\u6307\u5b9a\u5339\u914d\u6a21\u5f0f\u3002</p> <p>\u6ce8\u610f\uff1a\u8fd9\u4e2a\u65b9\u6cd5\u5e76\u4e0d\u662f\u5b8c\u5168\u5339\u914d\u3002\u5f53pattern\u7ed3\u675f\u65f6\u82e5string\u8fd8\u6709\u5269\u4f59\u5b57\u7b26\uff0c\u4ecd\u7136\u89c6\u4e3a\u6210\u529f\u3002\u60f3\u8981\u5b8c\u5168\u5339\u914d\uff0c\u53ef\u4ee5\u5728\u8868\u8fbe\u5f0f\u672b\u5c3e\u52a0\u4e0a\u8fb9\u754c\u5339\u914d\u7b26'$'\u3002</p> <p>2. search(string[, pos[, endpos]]) | re.search(pattern, string[, flags]):</p> <p>\u8fd9\u4e2a\u65b9\u6cd5\u7528\u4e8e\u67e5\u627e\u5b57\u7b26\u4e32\u4e2d\u53ef\u4ee5\u5339\u914d\u6210\u529f\u7684\u5b50\u4e32\u3002</p> <p>\u4ece<code>string</code>\u7684<code>pos</code>\u4e0b\u6807\u5904\u8d77\u5c1d\u8bd5\u5339\u914d<code>pattern</code>\uff0c\u5982\u679c<code>pattern</code>\u7ed3\u675f\u65f6\u4ecd\u53ef\u5339\u914d\uff0c\u5219\u8fd4\u56de\u4e00\u4e2a<code>Match</code>\u5bf9\u8c61\uff1b</p> <p>\u82e5\u65e0\u6cd5\u5339\u914d\uff0c\u5219\u5c06<code>pos</code>\u52a0<code>1</code>\u540e\u91cd\u65b0\u5c1d\u8bd5\u5339\u914d\uff1b\u76f4\u5230<code>pos=endpos</code>\u65f6\u4ecd\u65e0\u6cd5\u5339\u914d\u5219\u8fd4\u56deNone\u3002</p> <p><code>pos</code>\u548c<code>endpos</code>\u7684\u9ed8\u8ba4\u503c\u5206\u522b\u4e3a <code>0</code> \u548c <code>len(string)</code>\uff1b</p> <p><code>re.search()</code>\u65e0\u6cd5\u6307\u5b9a\u8fd9\u4e24\u4e2a\u53c2\u6570\uff0c\u53c2\u6570<code>flags</code>\u7528\u4e8e\u7f16\u8bd1<code>pattern</code>\u65f6\u6307\u5b9a\u5339\u914d\u6a21\u5f0f\u3002</p> <p>\u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\uff1a</p> <pre><code># -*- coding: utf-8 -*-\nimport re\n\nif __name__ == '__main__':\n    # \u5c06\u6b63\u5219\u8868\u8fbe\u5f0f\u7f16\u8bd1\u6210Pattern\u5bf9\u8c61\n    pattern = re.compile(r'world')\n\n    # \u4f7f\u7528search()\u67e5\u627e\u5339\u914d\u7684\u5b50\u4e32\uff0c\u4e0d\u5b58\u5728\u80fd\u5339\u914d\u7684\u5b50\u4e32\u65f6\u5c06\u8fd4\u56deNone\n    # \u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u4f7f\u7528match()\u65e0\u6cd5\u6210\u529f\u5339\u914d\n    match = pattern.search('hello world!')\n\n    if match:\n        # \u4f7f\u7528Match\u83b7\u5f97\u5206\u7ec4\u4fe1\u606f\n        print(match.group()) # \u8f93\u51fa\u7ed3\u679c\uff1aworld\n</code></pre> <p>\u6ce8\u610f match \u65b9\u6cd5 \u548c search \u65b9\u6cd5\u7684\u533a\u522b</p> <p>3. split(string[, maxsplit]) | re.split(pattern, string[, maxsplit]):</p> <p>\u6309\u7167\u80fd\u591f\u5339\u914d\u7684\u5b50\u4e32\u5c06string\u5206\u5272\u540e\u8fd4\u56de\u5217\u8868\u3002</p> <p><code>maxsplit</code> \u7528\u4e8e\u6307\u5b9a\u6700\u5927\u5206\u5272\u6b21\u6570\uff0c\u4e0d\u6307\u5b9a\u5c06\u5168\u90e8\u5206\u5272\u3002</p> <pre><code># -*- coding: utf-8 -*-\nimport re\n\nif __name__ == '__main__':\n    p = re.compile(r'\\d+')\n    # \u6309\u7167\u6570\u5b57\u5206\u9694\u5b57\u7b26\u4e32\n    print(p.split('one1two2three3four4')) # \u8f93\u51fa\u7ed3\u679c\uff1a['one', 'two', 'three', 'four', '']\n</code></pre> <p>4. findall(string[, pos[, endpos]]) | re.findall(pattern, string[, flags]):</p> <p>\u641c\u7d22 string\uff0c\u4ee5\u5217\u8868\u5f62\u5f0f\u8fd4\u56de\u5168\u90e8\u80fd\u5339\u914d\u7684\u5b50\u4e32\u3002</p> <pre><code>#!/usr/bin/env python\n# -*- coding:utf-8 -*-\nimport re\n\nif __name__ == '__main__':\n    p = re.compile(r'\\d+')\n    # \u627e\u5230\u6240\u6709\u7684\u6570\u5b57\uff0c\u4ee5\u5217\u8868\u7684\u5f62\u5f0f\u8fd4\u56de\n    print(p.findall('one1two2three3four4')) # \u8f93\u51fa\u7ed3\u679c\uff1a['1', '2', '3', '4']\n</code></pre> <p>5. finditer(string[, pos[, endpos]]) | re.finditer(pattern, string[, flags]):</p> <p>\u641c\u7d22 string\uff0c\u8fd4\u56de\u4e00\u4e2a\u987a\u5e8f\u8bbf\u95ee\u6bcf\u4e00\u4e2a\u5339\u914d\u7ed3\u679c\uff08<code>Match</code>\u5bf9\u8c61\uff09\u7684\u8fed\u4ee3\u5668\u3002</p> <pre><code>#!/usr/bin/env python\n# -*- coding:utf-8 -*-\nimport re\n\nif __name__ == '__main__':\n    p = re.compile(r'\\d+')\n    # \u8fd4\u56de\u4e00\u4e2a\u987a\u5e8f\u8bbf\u95ee\u6bcf\u4e00\u4e2a\u5339\u914d\u7ed3\u679c\uff08`Match`\u5bf9\u8c61\uff09\u7684\u8fed\u4ee3\u5668\n    for m in p.finditer('one1two2three3four4'):\n        print(m.group())  # \u8f93\u51fa\u7ed3\u679c\uff1a1 2 3 4\n</code></pre> <p>6. sub(repl, string[, count]) | re.sub(pattern, repl, string[, count]):</p> <p>\u4f7f\u7528 <code>repl</code> \u66ff\u6362 <code>string</code> \u4e2d\u6bcf\u4e00\u4e2a\u5339\u914d\u7684\u5b50\u4e32\u540e\u8fd4\u56de\u66ff\u6362\u540e\u7684\u5b57\u7b26\u4e32\u3002 \u5f53 <code>repl</code> \u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>\\id</code> \u6216 <code>\\g&lt;id&gt;</code> \u3001<code>\\g&lt;name&gt;</code>\u5f15\u7528\u5206\u7ec4\uff0c\u4f46\u4e0d\u80fd\u4f7f\u7528\u7f16\u53f70\u3002 \u5f53 <code>repl</code> \u662f\u4e00\u4e2a\u65b9\u6cd5\u65f6\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u5e94\u5f53\u53ea\u63a5\u53d7\u4e00\u4e2a\u53c2\u6570\uff08<code>Match</code>\u5bf9\u8c61\uff09\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2a\u5b57\u7b26\u4e32\u7528\u4e8e\u66ff\u6362\uff08\u8fd4\u56de\u7684\u5b57\u7b26\u4e32\u4e2d\u4e0d\u80fd\u518d\u5f15\u7528\u5206\u7ec4\uff09\u3002 count\u7528\u4e8e\u6307\u5b9a\u6700\u591a\u66ff\u6362\u6b21\u6570\uff0c\u4e0d\u6307\u5b9a\u65f6\u5168\u90e8\u66ff\u6362\u3002</p> <pre><code>#!/usr/bin/env python\n# -*- coding:utf-8 -*-\nimport re\n\nif __name__ == '__main__':\n    p = re.compile(r'(\\w+) (\\w+)')\n    s = 'i say, hello world!'\n\n    print(p.sub(r'\\1 \\2 hi', s))  # \u8f93\u51fa\u7ed3\u679c\uff1ai say hi, hello world hi!\n\n    def func(m):\n        return m.group(1).title() + ' ' + m.group(2).title()\n\n    print(p.sub(func, s))  # \u8f93\u51fa\u7ed3\u679c\uff1aI Say, Hello World!\n</code></pre> <p>7. subn(repl, string[, count]) |re.sub(pattern, repl, string[, count]):</p> <p>subn() \u65b9\u6cd5\u4e0e sub() \u65b9\u6cd5\u7684\u533a\u522b\u662f\u8fd4\u56de\u7ed3\u679c\u4e0d\u540c\uff1a</p> <p>subn() \u65b9\u6cd5\u8fd4\u56de\u7684\u7ed3\u679c\u662f\u4e00\u4e2a\u5143\u7ec4\uff1a(\u66ff\u6362\u540e\u7684\u5b57\u7b26\u4e32\uff0c\u66ff\u6362\u6b21\u6570)</p> <p>sub() \u65b9\u6cd5\u8fd4\u56de\u7684\u7ed3\u679c\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff1a\u66ff\u6362\u540e\u7684\u5b57\u7b26\u4e32</p> <pre><code>#!/usr/bin/env python\n# -*- coding:utf-8 -*-\nimport re\n\nif __name__ == '__main__':\n    p = re.compile(r'(\\w+) (\\w+)')\n    s = 'i say, hello world!'\n\n    print(p.subn(r'\\1 \\2 hi', s))  # \u8f93\u51fa\u7ed3\u679c\uff1a('i say hi, hello world hi!', 2)\n\n    def func(m):\n        return m.group(1).title() + ' ' + m.group(2).title()\n\n    print(p.subn(func, s))  # \u8f93\u51fa\u7ed3\u679c\uff1a('I Say, Hello World!', 2)\n</code></pre>"},{"location":"python/python%E4%BD%BF%E7%94%A8%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%8F%90%E5%8F%96json%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E5%80%BC/#3-match","title":"3. \u4f7f\u7528 Match","text":"<p>Match\u5bf9\u8c61\u662f\u4e00\u6b21\u5339\u914d\u7684\u7ed3\u679c\uff0c\u5305\u542b\u4e86\u5f88\u591a\u5173\u4e8e\u6b64\u6b21\u5339\u914d\u7684\u4fe1\u606f\uff0c\u53ef\u4ee5\u4f7f\u7528Match\u63d0\u4f9b\u7684\u53ef\u8bfb\u5c5e\u6027\u6216\u65b9\u6cd5\u6765\u83b7\u53d6\u8fd9\u4e9b\u4fe1\u606f\u3002</p>"},{"location":"python/python%E4%BD%BF%E7%94%A8%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%8F%90%E5%8F%96json%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E5%80%BC/#31-match","title":"3.1 Match \u5bf9\u8c61\u7684\u5c5e\u6027","text":"<ol> <li>string: \u5339\u914d\u65f6\u4f7f\u7528\u7684\u6587\u672c\u3002</li> <li>re: \u5339\u914d\u65f6\u4f7f\u7528\u7684Pattern\u5bf9\u8c61\u3002</li> <li>pos: \u6587\u672c\u4e2d\u6b63\u5219\u8868\u8fbe\u5f0f\u5f00\u59cb\u641c\u7d22\u7684\u7d22\u5f15\u3002\u503c\u4e0e<code>Pattern.match()</code>\u548c<code>Pattern.seach()</code>\u65b9\u6cd5\u7684\u540c\u540d\u53c2\u6570\u76f8\u540c\u3002</li> <li>endpos: \u6587\u672c\u4e2d\u6b63\u5219\u8868\u8fbe\u5f0f\u7ed3\u675f\u641c\u7d22\u7684\u7d22\u5f15\u3002\u503c\u4e0e<code>Pattern.match()</code>\u548c<code>Pattern.seach()</code>\u65b9\u6cd5\u7684\u540c\u540d\u53c2\u6570\u76f8\u540c\u3002</li> <li>lastindex: \u6700\u540e\u4e00\u4e2a\u88ab\u6355\u83b7\u7684\u5206\u7ec4\u7684\u7d22\u5f15\u3002\u5982\u679c\u6ca1\u6709\u88ab\u6355\u83b7\u7684\u5206\u7ec4\uff0c\u5c06\u4e3aNone\u3002</li> <li>lastgroup: \u6700\u540e\u4e00\u4e2a\u88ab\u6355\u83b7\u7684\u5206\u7ec4\u7684\u522b\u540d\u3002\u5982\u679c\u8fd9\u4e2a\u5206\u7ec4\u6ca1\u6709\u522b\u540d\u6216\u8005\u6ca1\u6709\u88ab\u6355\u83b7\u7684\u5206\u7ec4\uff0c\u5c06\u4e3aNone\u3002</li> </ol> <pre><code># -*- coding: utf-8 -*-\nimport re\n\nif __name__ == '__main__':\n    text = 'hello world'\n    p = re.compile(r'(\\w+) (\\w+)(?P&lt;sign&gt;.*)', re.DOTALL)\n    match = p.match(text)\n    if match:\n        print(\"match.re:\", match.re)\n        print(\"match.string:\", match.string)\n        print(\"match.endpos:\", match.endpos)\n        print(\"match.pos:\", match.pos)\n        print(\"match.lastgroup:\", match.lastgroup)\n        print(\"match.lastindex:\", match.lastindex)\n\n\n# \u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff1a\n# match.re: re.compile('(\\\\w+) (\\\\w+)(?P&lt;sign&gt;.*)', re.DOTALL)\n# match.string: hello world\n# match.endpos: 11\n# match.pos: 0\n# match.lastgroup: sign\n# match.lastindex: 3\n</code></pre>"},{"location":"python/python%E4%BD%BF%E7%94%A8%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%8F%90%E5%8F%96json%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E5%80%BC/#32-match","title":"3.2 Match \u5bf9\u8c61\u7684\u65b9\u6cd5","text":"<ol> <li>group([group1, \u2026]):    \u83b7\u5f97\u4e00\u4e2a\u6216\u591a\u4e2a\u5206\u7ec4\u622a\u83b7\u7684\u5b57\u7b26\u4e32\uff0c\u6307\u5b9a\u591a\u4e2a\u53c2\u6570\u65f6\u5c06\u4ee5\u5143\u7ec4\u5f62\u5f0f\u8fd4\u56de\u3002</li> </ol> <p>group()\u53ef\u4ee5\u4f7f\u7528\u7f16\u53f7\u4e5f\u53ef\u4ee5\u4f7f\u7528\u522b\u540d\uff1b</p> <p>\u7f16\u53f70\u4ee3\u8868\u6574\u4e2a\u5339\u914d\u7684\u5b50\u4e32\uff1b</p> <p>\u4e0d\u586b\u5199\u53c2\u6570\u65f6\uff0c\u8fd4\u56degroup(0)\uff1b</p> <p>\u6ca1\u6709\u622a\u83b7\u5b57\u7b26\u4e32\u7684\u7ec4\u8fd4\u56deNone\uff1b</p> <ol> <li>groups([default]):    \u4ee5\u5143\u7ec4\u5f62\u5f0f\u8fd4\u56de\u5168\u90e8\u5206\u7ec4\u622a\u83b7\u7684\u5b57\u7b26\u4e32\uff0c\u76f8\u5f53\u4e8e\u8c03\u7528group(1,2,\u2026last)\uff1b</li> </ol> <p>default\u8868\u793a\u6ca1\u6709\u622a\u83b7\u5b57\u7b26\u4e32\u7684\u7ec4\u4ee5\u8fd9\u4e2a\u503c\u66ff\u4ee3\uff0c\u9ed8\u8ba4\u4e3aNone\uff1b</p> <ol> <li> <p>groupdict([default]):    \u8fd4\u56de\u5df2\u6709\u522b\u540d\u7684\u7ec4\u7684\u522b\u540d\u4e3a\u952e\u3001\u4ee5\u8be5\u7ec4\u622a\u83b7\u7684\u5b50\u4e32\u4e3a\u503c\u7684\u5b57\u5178\uff0c\u6ca1\u6709\u522b\u540d\u7684\u7ec4\u4e0d\u5305\u542b\u5728\u5185\u3002default\u542b\u4e49\u540c\u4e0a\u3002</p> </li> <li> <p>start([group]):    \u8fd4\u56de\u6307\u5b9a\u7684\u7ec4\u622a\u83b7\u7684\u5b50\u4e32\u5728string\u4e2d\u7684\u8d77\u59cb\u7d22\u5f15\uff08\u5b50\u4e32\u7b2c\u4e00\u4e2a\u5b57\u7b26\u7684\u7d22\u5f15\uff09\u3002group\u9ed8\u8ba4\u503c\u4e3a0\u3002</p> </li> <li> <p>end([group]):    \u8fd4\u56de\u6307\u5b9a\u7684\u7ec4\u622a\u83b7\u7684\u5b50\u4e32\u5728string\u4e2d\u7684\u7ed3\u675f\u7d22\u5f15\uff08\u5b50\u4e32\u6700\u540e\u4e00\u4e2a\u5b57\u7b26\u7684\u7d22\u5f15+1\uff09\u3002group\u9ed8\u8ba4\u503c\u4e3a0\u3002</p> </li> <li> <p>span([group]):    \u8fd4\u56de(start(group), end(group))\u3002</p> </li> <li> <p>expand(template):    \u5c06\u5339\u914d\u5230\u7684\u5206\u7ec4\u4ee3\u5165template\u4e2d\u7136\u540e\u8fd4\u56de\u3002template\u4e2d\u53ef\u4ee5\u4f7f\u7528<code>\\id</code>\u6216<code>\\g&lt;id&gt;</code>\u3001<code>\\g&lt;name&gt;</code>\u5f15\u7528\u5206\u7ec4\uff0c\u4f46\u4e0d\u80fd\u4f7f\u7528\u7f16\u53f70\u3002<code>\\id</code>\u4e0e<code>\\g&lt;id&gt;</code>\u662f\u7b49\u4ef7\u7684\uff1b\u4f46<code>\\10</code>\u5c06\u88ab\u8ba4\u4e3a\u662f\u7b2c10\u4e2a\u5206\u7ec4\uff0c\u5982\u679c\u4f60\u60f3\u8868\u8fbe<code>\\1</code>\u4e4b\u540e\u662f\u5b57\u7b26'0'\uff0c\u53ea\u80fd\u4f7f\u7528<code>\\g&lt;1&gt;0</code>\u3002</p> </li> </ol> <pre><code># -*- coding: utf-8 -*-\nimport re\n\nif __name__ == '__main__':\n    import re\n    m = re.match(r'(\\w+) (\\w+)(?P&lt;sign&gt;.*)', 'hello world!')\n    print(\"m.group(1,2):\", m.group(0, 1, 2, 3))\n    print(\"m.groups():\", m.groups())\n    print(\"m.groupdict():\", m.groupdict())\n    print(\"m.start(2):\", m.start(2))\n    print(\"m.end(2):\", m.end(2))\n    print(\"m.span(2):\", m.span(2))\n    print(r\"m.expand(r'\\2 \\1\\3'):\", m.expand(r'\\2 \\1\\3'))\n\n\n# \u8f93\u51fa\u7ed3\u679c\uff1a\n# m.group(1,2): ('hello world!', 'hello', 'world', '!')\n# m.groups(): ('hello', 'world', '!')\n# m.groupdict(): {'sign': '!'}\n# m.start(2): 6\n# m.end(2): 11\n# m.span(2): (6, 11)\n# m.expand(r'\\2 \\1\\3'): world hello!\n</code></pre> <p>\u53c2\u8003\u6587\u7ae0</p> <p>python  \u5b98\u65b9\u6587\u6863</p> <p>https://www.cnblogs.com/huxi/archive/2010/07/04/1771073.html</p>"},{"location":"python/python%E5%AE%9E%E7%8E%B0%E6%8E%98%E9%87%91%E5%AE%9A%E6%97%B6%E7%AD%BE%E5%88%B0%E6%8A%BD%E5%A5%96/","title":"python\u5b9e\u73b0\u6398\u91d1\u5b9a\u65f6\u7b7e\u5230\u62bd\u5956","text":""},{"location":"python/python%E5%AE%9E%E7%8E%B0%E6%8E%98%E9%87%91%E5%AE%9A%E6%97%B6%E7%AD%BE%E5%88%B0%E6%8A%BD%E5%A5%96/#_1","title":"\u4e00. \u6982\u8ff0","text":"<p>\u8fd9\u91cc\u8bb0\u5f55\u4e00\u4e0b\u4f7f\u7528 python \u5b9e\u73b0\u6398\u91d1\u5b9a\u65f6\u7b7e\u5230\u62bd\u5956\u3002\u9996\u5148\u9700\u8981\u767b\u5f55\u6398\u91d1\uff0c\u8fdb\u5165\u7b7e\u5230\u9875\u9762\uff0c\u6309 <code>F12</code> \u6253\u5f00\u6d4f\u89c8\u5668\u7684\u8c03\u8bd5\u9762\u677f\uff0c\u9009\u62e9 <code>Network</code>\uff0c\u9009\u62e9 <code>XHR</code>\uff0c\u7136\u540e\u6309 <code>F5</code> \u5237\u65b0\u9875\u9762\uff0c\u627e\u5230 <code>check_in_rules</code> \u8fd9\u4e2a\u8bf7\u6c42\uff0c\u83b7\u53d6\u7b7e\u5230\u8bf7\u6c42\u63a5\u53e3\u7684\u53c2\u6570\u5c31\u53ef\u4ee5\u4e86\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u7684\u9875\u9762\uff1a</p> <p></p> <p>\u4ece\u4e0a\u56fe\u4e2d\u9700\u8981\u83b7\u53d6\u5982\u4e0b\u51e0\u4e2a\u53c2\u6570\u7684\u5185\u5bb9\uff1a</p> <ul> <li>aid</li> <li>uuid</li> <li>_signature</li> <li>cookie</li> </ul>"},{"location":"python/python%E5%AE%9E%E7%8E%B0%E6%8E%98%E9%87%91%E5%AE%9A%E6%97%B6%E7%AD%BE%E5%88%B0%E6%8A%BD%E5%A5%96/#python_1","title":"\u4e8c. python \u4ee3\u7801\u5b9e\u73b0","text":"<p>\u521b\u5efa\u4e00\u4e2a <code>juejin.py</code> \u6587\u4ef6\uff0c\u8f93\u5165\u5982\u4e0b\u5185\u5bb9\uff0c\u5e76\u4e14\u8f93\u5165\u524d\u9762\u83b7\u53d6\u5230\u7684\u5185\u5bb9\uff1a</p> <pre><code>import requests\nfrom apscheduler.schedulers.blocking import BlockingScheduler\nfrom datetime import datetime\nimport time\n\n\n# \u586b\u5199\u5bf9\u5e94\u53c2\u6570\u7684\u503c\ndata = {\n    'aid': 'xxx',\n    'uuid': 'xxx',\n    '_signature': 'xxx',\n    'cookie': 'xxx'\n}\n\nheader = {\n    \"cookie\": data.get('cookie')\n}\n\n\ndef sign_in():\n    \"\"\"\n    \u8bf7\u6c42\u7b7e\u5230\u63a5\u53e3\n    :return: \n    \"\"\"\n    url = 'https://api.juejin.cn/growth_api/v1/check_in'\n    r = requests.post(url, data, headers=header)\n    print(r.text)\n\n\ndef draw():\n    \"\"\"\n    \u7b7e\u5230\u540e\u62bd\u5956\n    :return: \n    \"\"\"\n    urlD = 'https://api.juejin.cn/growth_api/v1/lottery/draw'\n    dataD = {\n        'aid': data.get('aid'),\n        'uuid': data.get('uuid'),\n    }\n    r = requests.post(urlD, dataD, headers=header)\n    print(r.text)\n\n\ndef job():\n    \"\"\"\n    \u542f\u52a8\u4efb\u52a1\n    :return: \n    \"\"\"\n    print(datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\"))\n    sign_in()\n    time.sleep(10)\n    draw()\n\n\nif __name__ == \"__main__\":\n    # \u6bcf\u5929\u65e9\u4e0a\u516d\u70b9\u534a\u7b7e\u5230\n    scheduler = BlockingScheduler()\n    scheduler.add_job(job, 'cron', day_of_week='0-6', hour=6, minute=30)\n    scheduler.start()\n</code></pre> <p>\u8fd9\u4e2a\u811a\u672c\u4e2d\u7528\u5230\u4e86 <code>Python</code> \u5b9a\u65f6\u5e93 <code>apscheduler</code>\uff0c\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u5b89\u88c5\uff1a</p> <pre><code>pip install apscheduler\n</code></pre> <p>\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u542f\u52a8 python \u811a\u672c\u5373\u53ef\uff1a</p> <pre><code>python juejin.py\n</code></pre> <p>\u5728 linux \u670d\u52a1\u5668\u4e2d\u53ef\u4ee5\u901a\u8fc7 nohup \u547d\u4ee4\u5728\u540e\u53f0\u542f\u52a8\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>nohup python juejin.py &amp;\n</code></pre>"},{"location":"python/%E4%BD%BF%E7%94%A8python%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/","title":"\u8bb0\u5f55\u4f7f\u7528 python \u8fc7\u7a0b\u4e2d\u7684\u95ee\u9898\u603b\u7ed3","text":""},{"location":"python/%E4%BD%BF%E7%94%A8python%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/#dataframe","title":"\u600e\u6837\u521b\u5efa\u4e00\u4e2a dataframe?","text":""},{"location":"python/%E4%BD%BF%E7%94%A8python%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/#pandasdataframe","title":"\u5728pandas\u4e2ddataframe\u600e\u4e48\u8f6c\u5316\u4e3a\u5b57\u5178\uff1f","text":"<p><code>DataFrame.to_dict</code> (*self*, orient='dict', into=)</p>"},{"location":"python/%E4%BD%BF%E7%94%A8python%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/#python-list","title":"python \u4e2d\u7684 list \u5982\u4f55\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\uff1f","text":""},{"location":"python/%E4%BD%BF%E7%94%A8python%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/#1list-string","title":"1.list \u8f6c string","text":"<p>\u547d\u4ee4\uff1a<code>''.join(list)</code></p> <pre><code>list = ['a', 'b', 'c', 'd']\ns1 = ''.join(list)\ns2 = ','.join(list)\nprint(s1) # abcd\nprint(s2) # a,b,c,d\n</code></pre> <p></p> <p>\u9762\u5411\u5bf9\u8c61\u8bbe\u8ba1\u4e94\u4e2a\u57fa\u672c\u539f\u5219</p> <ul> <li>\u5355\u4e00\u804c\u8d23\u539f\u5219\uff1a\u4e00\u4e2a\u65b9\u6cd5\u53ea\u505a\u4e00\u4ef6\u4e8b</li> <li>\u5f00\u653e\u5c01\u95ed\u539f\u5219\uff1a\u5bf9\u6269\u5c55\u5f00\u653e\uff0c\u5bf9\u4fee\u6539\u5173\u95ed</li> <li>\u63a5\u53e3\u9694\u79bb\u539f\u5219\uff1a\u5b9e\u73b0\u4e13\u95e8\u7684\u591a\u4e2a\u63a5\u53e3\u6bd4\u5b9e\u73b0\u4e00\u4e2a\u603b\u63a5\u53e3\u8981\u597d</li> <li>\u91cc\u6c0f\u66ff\u6362\u539f\u5219\uff1a\u5b50\u7c7b\u53ef\u4ee5\u5728\u7a0b\u5e8f\u4e2d\u4ee3\u66ff\u57fa\u7c7b</li> <li>\u4f9d\u8d56\u5012\u7f6e\u539f\u5219\uff1a\u7a0b\u5e8f\u8981\u4f9d\u8d56\u62bd\u8c61\u63a5\u53e3\uff0c\u4e0d\u8981\u4f9d\u8d56\u5177\u4f53\u5b9e\u73b0\uff0c\u7b80\u5355\u7684\u8bf4\u5c31\u662f\u9762\u5411\u63a5\u53e3\u7f16\u7a0b\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u964d\u4f4e\u8026\u5408</li> </ul>"},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/","title":"PDF\u9875\u7709\u9875\u811a\u8bc6\u522b\u4e0e\u53bb\u9664\u65b9\u6848","text":"<p>\u6700\u8fd1\u5728\u4f18\u5316RAG\u5e94\u7528\uff0c\u53d1\u73b0\u5728\u8f6c\u6362PDF\u6587\u4ef6\u4e3a markdown \u683c\u5f0f\u65f6\u53d1\u73b0\u6709\u5f88\u591a\u9875\u7709\u9875\u811a\u88ab\u5305\u542b\u5728\u4e86\u6b63\u6587\u4e2d\uff0c\u4e3a\u4e86\u907f\u514d\u9875\u7709\u9875\u811a\u7684\u5f71\u54cd\uff0c\u67e5\u9605\u4e86\u76f8\u5173\u8d44\u6599\uff0c\u5b9e\u73b0\u4e86\u4e00\u4e2aPDF\u6587\u6863\u9875\u7709\u9875\u811a\u8bc6\u522b\u4e0e\u53bb\u9664\u7684\u65b9\u6848\uff0c\u5728\u8fd9\u91cc\u5206\u4eab\u4e00\u4e0b\u3002</p> <p>\u5173\u4e8e\u5982\u4f55\u4f7f\u7528\u591a\u6a21\u6001\u6a21\u578bNanonets-OCR-s\u5c06PDF\u6587\u4ef6\u8f6c\u5316\u4e3a markdown \u683c\u5f0f\u6587\u4ef6\uff0c\u5c06\u5728\u4e0b\u4e00\u7bc7\u6587\u7ae0\u4e2d\u8fdb\u884c\u4ecb\u7ecd\uff0c\u8bf7\u7ee7\u7eed\u5173\u6ce8\u3002</p> <p>\u63a5\u4e0b\u6765\u5c06\u4f7f\u7528PyMuPDF\uff08fitz\uff09\u5e93\u5b9e\u73b0\uff0c\u56e0\u4e3a\u5b83\u53ef\u4ee5\u5904\u7406\u6587\u672c\u548c\u56fe\u50cf\uff0c\u5e76\u4e14\u53ef\u4ee5\u7f16\u8f91PDF\u3002</p> <p>\u672c\u6587\u4ece\u5982\u4e0b\u51e0\u4e2a\u65b9\u9762\u8fdb\u884c\u4ecb\u7ecd\uff1a - PyMuPDF\u65e7\u7248\u672c\u4f7f\u7528fitz\u539f\u56e0\u5206\u6790 - \u7406\u89e3PyMuPDF\u4e2dbbox\u5750\u6807\u7cfb - \u4f7f\u7528PyMuPD\u7f16\u8f91PDF\u6587\u4ef6\u5185\u5bb9 - PDF\u6587\u4ef6\u9875\u7709\u548c\u9875\u811a\u8bc6\u522b - PDF\u6587\u4ef6\u9875\u7709\u548c\u9875\u811a\u53bb\u9664</p>"},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/#pymupdffitz","title":"PyMuPDF\u65e7\u7248\u672c\u4f7f\u7528fitz\u539f\u56e0\u5206\u6790","text":"<p>PyMuPDF\u662f\u4e00\u4e2a\u7528\u4e8e\u5904\u7406PDF\u6587\u4ef6\u7684Python\u5e93\uff0c\u5b83\u5b9e\u9645\u4e0a\u662f\u57fa\u4e8eMuPDF\u7684\u5c01\u88c5\u3002\u5728\u65e7\u7248\u672c\u4e2d\uff0c\u5bfc\u5165\u8fd9\u4e2a\u5e93\u65f6\u4f7f\u7528\u7684\u540d\u79f0\u662f<code>fitz</code>\uff0c\u4e5f\u5c31\u662f\u901a\u8fc7<code>import fitz</code>\uff0c\u800c\u4e0d\u662f<code>import pymupdf</code>\u3002\u8fd9\u53ef\u80fd\u4f1a\u8ba9\u6211\u4eec\u611f\u5230\u56f0\u60d1\uff0c\u56e0\u4e3a\u901a\u5e38\u6211\u4eec\u671f\u671b\u5bfc\u5165\u7684\u6a21\u5757\u540d\u4e0e\u5b89\u88c5\u7684\u5305\u540d\u4e00\u81f4\u3002</p> <p>\u539f\u56e0\u5982\u4e0b\uff1a 1. \u5386\u53f2\u539f\u56e0\uff1aPyMuPDF\u6700\u521d\u662f\u4f5c\u4e3aMuPDF\u7684Python\u7ed1\u5b9a\u800c\u5f00\u53d1\u7684\u3002MuPDF\u662f\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u7684PDF\u3001XPS\u548c\u7535\u5b50\u4e66\u67e5\u770b\u5668\uff0c\u7531Artifex Software\u5f00\u53d1\u548c\u7ef4\u62a4\u3002MuPDF\u7684\u6838\u5fc3\u6e32\u67d3\u5e93\u53eb\u505aFitz\uff0c\u8fd9\u4e2a\u540d\u79f0\u6765\u6e90\u4e8eMarcel Duchamp\u7684\u865a\u6784\u4eba\u7269\u201cFitz\u201d\uff0c\u4e5f\u662fMuPDF\u9879\u76ee\u6700\u521d\u4ee3\u7801\u5e93\u7684\u4ee3\u53f7\u3002 2. \u4fdd\u6301\u5411\u540e\u517c\u5bb9\u6027\uff1a\u5c3d\u7ba1\u73b0\u5728\u5b98\u65b9\u63a8\u8350\u4f7f\u7528<code>pymupdf</code>\u4f5c\u4e3a\u5305\u540d\uff08\u901a\u8fc7<code>pip install pymupdf</code>\u5b89\u88c5\uff09\uff0c\u4f46\u4e3a\u4e86\u4fdd\u6301\u65e7\u4ee3\u7801\u7684\u517c\u5bb9\u6027\uff0c\u5bfc\u5165\u540d\u79f0\u4ecd\u7136\u4fdd\u7559\u4e3a<code>fitz</code>\u3002\u8fd9\u6837\uff0c\u90a3\u4e9b\u4f7f\u7528\u65e7\u7248\u672c\u7f16\u5199\u7684\u4ee3\u7801\u65e0\u9700\u4fee\u6539\u5bfc\u5165\u8bed\u53e5\u3002 3. \u907f\u514d\u51b2\u7a81\uff1a\u4f7f\u7528\u4e0d\u540c\u7684\u5bfc\u5165\u540d\u4e5f\u53ef\u4ee5\u907f\u514d\u4e0e\u5176\u4ed6\u53ef\u80fd\u7684\u540c\u540d\u5305\u51b2\u7a81\u3002</p> <p>\u793a\u4f8b\u4ee3\u7801\uff1a <pre><code>import fitz  # \u8fd9\u5c31\u662fPyMuPDF\ndoc = fitz.open(\"example.pdf\")\nfor page in doc:\n    text = page.get_text()\n    print(text)\n</code></pre> \u56e0\u6b64\uff0c\u5373\u4f7f\u5b89\u88c5\u4e86<code>pymupdf</code>\uff0c\u4ecd\u7136\u53ef\u4ee5\u4f7f\u7528<code>import fitz</code>\u6765\u5bfc\u5165\u5b83\u3002\u8fd9\u662f\u8be5\u5e93\u7684\u4e00\u4e2a\u7279\u70b9\u3002</p> <p>\u6ce8\u610f\uff1a\u5728\u6781\u5c11\u6570\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u4f60\u540c\u65f6\u5b89\u88c5\u4e86\u53e6\u4e00\u4e2a\u540d\u4e3a<code>fitz</code>\u7684\u5305\uff0c\u53ef\u80fd\u4f1a\u5f15\u8d77\u51b2\u7a81\u3002\u4f46\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c<code>fitz</code>\u8fd9\u4e2a\u540d\u79f0\u662f\u4e13\u4e3aPyMuPDF\u4fdd\u7559\u7684\u3002</p> <p>\u4e3a\u4ec0\u4e48\u63a8\u8350\u4f7f\u7528 <code>import pymupdf</code> \u800c\u4e0d\u662f <code>import fitz</code>\uff1f</p> <ol> <li> <p>\u4e00\u81f4\u6027\uff1a\u5728\u6700\u65b0\u7248\u672c\u7684 PyMuPDF \u4e2d\uff0c\u5b98\u65b9\u5df2\u7ecf\u5efa\u8bae\u4f7f\u7528 <code>import pymupdf</code> \u6765\u63d0\u9ad8\u4ee3\u7801\u7684\u53ef\u8bfb\u6027\u548c\u4e00\u81f4\u6027\u3002</p> </li> <li> <p>\u5411\u540e\u517c\u5bb9\u6027\uff1a\u867d\u7136 <code>import fitz</code> \u5728\u5f88\u591a\u5730\u65b9\u4ecd\u7136\u80fd\u5de5\u4f5c\uff0c\u4f46\u968f\u7740\u5e93\u7684\u66f4\u65b0\uff0c\u672a\u6765\u7248\u672c\u7684 PyMuPDF \u5f88\u53ef\u80fd\u4f1a\u66f4\u5f3a\u8c03 <code>import pymupdf</code>\uff0c\u8fd9\u4e5f\u6709\u52a9\u4e8e\u907f\u514d\u672a\u6765\u51fa\u73b0\u5f03\u7528 <code>fitz</code> \u7684\u60c5\u51b5\u3002</p> </li> <li> <p>\u4ee3\u7801\u6e05\u6670\uff1a\u76f4\u63a5\u4f7f\u7528 <code>PyMuPDF</code> \u4f5c\u4e3a\u5e93\u7684\u5bfc\u5165\uff0c\u53ef\u4ee5\u5e2e\u52a9\u5176\u4ed6\u5f00\u53d1\u8005\u66f4\u5bb9\u6613\u7406\u89e3\u4ee3\u7801\uff0c\u56e0\u4e3a <code>PyMuPDF</code> \u66f4\u5177\u63cf\u8ff0\u6027\uff0c\u8868\u660e\u8fd9\u662f\u4e00\u4e2a\u7528\u4e8e\u64cd\u4f5c PDF \u6587\u6863\u7684\u5e93\u3002</p> </li> </ol> <p>\u603b\u7ed3\uff1aPyMuPDF\u4f7f\u7528<code>fitz</code>\u4f5c\u4e3a\u5bfc\u5165\u540d\uff0c\u4e3b\u8981\u662f\u7531\u4e8e\u5386\u53f2\u539f\u56e0\uff08\u5e95\u5c42\u5f15\u64ce\u540d\u79f0\uff09\u548c\u4fdd\u6301\u5411\u540e\u517c\u5bb9\u6027\u3002\u5982\u679c\u4f60\u5728\u5199\u65b0\u4ee3\u7801\u6216\u66f4\u65b0\u73b0\u6709\u4ee3\u7801\uff0c\u5efa\u8bae\u4f7f\u7528\uff1a</p> <pre><code>import pymupdf\n</code></pre> <p>\u8fd9\u6837\u4f1a\u8ba9\u4f60\u7684\u4ee3\u7801\u66f4\u5177\u517c\u5bb9\u6027\u548c\u53ef\u8bfb\u6027\uff0c\u540c\u65f6\u907f\u514d\u672a\u6765\u7248\u672c\u66f4\u65b0\u65f6\u51fa\u73b0\u95ee\u9898\u3002</p>"},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/#pymupdfbbox","title":"\u7406\u89e3PyMuPDF\u4e2dbbox\u5750\u6807\u7cfb","text":"<p>\u5728PDF\u4e2d\uff0cBounding Box\uff08bbox\uff09 \u8868\u793a\u4e00\u4e2a\u77e9\u5f62\u533a\u57df\uff0c\u7528\u4e8e\u5b9a\u4e49\u9875\u9762\u5143\u7d20\uff08\u5982\u6587\u672c\u3001\u56fe\u50cf\u6216\u6ce8\u91ca\uff09\u7684\u4f4d\u7f6e\u548c\u8303\u56f4\uff0c\u7406\u89e3bbox\u7684\u5750\u6807\u7cfb\u5bf9\u4e8e\u5904\u7406PDF\u5185\u5bb9\u81f3\u5173\u91cd\u8981\u3002 \u5b9e\u9645\u4e0a\uff0cPyMuPDF\uff08\u57fa\u4e8eMuPDF\uff09\u4f7f\u7528\u4e86\u4e00\u4e2a\u7edf\u4e00\u7684\u5750\u6807\u7cfb\uff0c\u5176\u539f\u70b9\u5728\u9875\u9762\u7684\u5de6\u4e0a\u89d2\uff0cY\u8f74\u5411\u4e0b\u4e3a\u6b63\u65b9\u5411\u3002\u8fd9\u4e0ePDF\u7684\u539f\u751f\u5750\u6807\u7cfb\uff08\u5de6\u4e0b\u89d2\u539f\u70b9\uff0cY\u8f74\u5411\u4e0a\uff09\u4e0d\u540c\uff0c\u4f46\u4e0e\u56fe\u50cf\u5750\u6807\u7cfb\u4e00\u81f4\u3002\u4ee5\u4e0b\u662f\u8be6\u7ec6\u5206\u6790\uff1a</p>"},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/#1-mupdf","title":"1. MuPDF\u7684\u901a\u7528\u5750\u6807\u7cfb","text":"<p>MuPDF\u4f5c\u4e3a\u4e00\u4e2a\u591a\u683c\u5f0f\u6587\u6863\u5e93\uff0c\u4e3a\u6240\u6709\u652f\u6301\u7684\u6587\u6863\u7c7b\u578b\uff08\u5305\u62ecPDF\u3001\u56fe\u50cf\u7b49\uff09\u5b9a\u4e49\u4e86\u4e00\u4e2a\u7edf\u4e00\u7684\u5750\u6807\u7cfb\uff1a - \u539f\u70b9 <code>(0, 0)</code>\uff1a\u4f4d\u4e8e\u9875\u9762\u7684\u5de6\u4e0a\u89d2\u3002 - Y\u8f74\u65b9\u5411\uff1a\u5411\u4e0b\u4e3a\u6b63\uff08\u4e0e\u56fe\u50cf\u5750\u6807\u7cfb\u76f8\u540c\uff09\u3002 - \u5355\u4f4d\uff1a\u4f7f\u7528\u70b9\uff08Point\uff09\uff081/72\u82f1\u5bf8\uff09\u4f5c\u4e3a\u57fa\u672c\u5355\u4f4d\uff08\u5bf9\u4e8ePDF\uff09\uff0c\u5bf9\u4e8e\u56fe\u50cf\u5219\u4f7f\u7528\u50cf\u7d20\u3002</p> <p>1\u70b9(point) = 1/72\u82f1\u5bf8 \u2248 0.3528\u6beb\u7c73</p> <p>MuPDF\u7684\u7edf\u4e00\u5750\u6807\u7cfb\u4f7f\u5f97\u5904\u7406\u4e0d\u540c\u683c\u5f0f\u65f6\u65e0\u9700\u5207\u6362\u5750\u6807\u7cfb\u903b\u8f91\uff0c\u6709\u5982\u4e0b\u4f18\u52bf\uff1a</p> <ol> <li> <p>\u683c\u5f0f\u4e00\u81f4\u6027\uff1a\u7528\u76f8\u540c\u903b\u8f91\u5904\u7406PDF/XPS/ePub/CBZ\u7b4910+\u683c\u5f0f</p> </li> <li> <p>\u56fe\u50cf\u517c\u5bb9\uff1a\u56fe\u50cf\u4f5c\u4e3a\"\u5355\u9875\u6587\u6863\"\u81ea\u7136\u9002\u914d\u7cfb\u7edf</p> </li> <li> <p>\u6e32\u67d3\u4f18\u5316\uff1a\u907f\u514d\u91cd\u590d\u5750\u6807\u8f6c\u6362\uff0c\u63d0\u5347\u6027\u80fd</p> </li> <li> <p>\u5f00\u53d1\u8005\u53cb\u597d\uff1a\u53ea\u9700\u5b66\u4e60\u4e00\u5957\u5750\u6807\u89c4\u5219</p> </li> </ol>"},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/#2-pdf-vs-mupdf","title":"2. PDF\u539f\u751f\u5750\u6807\u7cfb vs. MuPDF\u5750\u6807\u7cfb","text":"<ul> <li>PDF\u539f\u751f\u5750\u6807\u7cfb\uff08\u5b58\u50a8\u683c\u5f0f\uff09\uff1a</li> <li>\u539f\u70b9\uff1a\u5de6\u4e0b\u89d2</li> <li>Y\u8f74\uff1a\u5411\u4e0a\u4e3a\u6b63</li> <li>\u77e9\u5f62\u8fb9\u754c\u6846\u8868\u793a\u4e3a <code>[x0, y0, x1, y1]</code><ul> <li>(x0, y0) = \u5de6\u4e0b\u89d2\u5750\u6807</li> <li>(x1, y1) = \u53f3\u4e0a\u89d2\u5750\u6807</li> </ul> </li> </ul> <p>PDF\u539f\u751f\u5750\u6807\u7cfb\u53ef\u89c6\u5316\u7406\u89e3 <pre><code>Y\u8f74 \u2191 (\u5411\u4e0a\u589e\u52a0)\n   \u2191\n   |   (x0,y1) +-----------------+ (x1,y1)\n   |           |                 |\n   |           |      PDF\u9875\u9762    |\n   |           |                 |\n   |   (x0,y0) +-----------------+ (x1,y0)\n   +------------------------------------\u2192 X\u8f74 (\u5411\u53f3\u589e\u52a0)\n (0,0) - \u5de6\u4e0b\u89d2\u539f\u70b9\n</code></pre></p> <ul> <li>MuPDF\u5185\u90e8\u5750\u6807\u7cfb\uff08\u5904\u7406\u65f6\uff09\uff1a</li> <li>\u539f\u70b9\uff1a\u5de6\u4e0a\u89d2</li> <li>Y\u8f74\uff1a\u5411\u4e0b\u4e3a\u6b63</li> <li>\u77e9\u5f62\u8fb9\u754c\u6846\u8868\u793a\u4e3a <code>[x0, y0, x1, y1]</code><ul> <li>(x0, y0) = \u5de6\u4e0a\u89d2\u5750\u6807</li> <li>(x1, y1) = \u53f3\u4e0b\u89d2\u5750\u6807</li> </ul> </li> </ul> <p>MuPDF/PyMuPDF\u5750\u6807\u7cfb\u53ef\u89c6\u5316\u7406\u89e3 <pre><code> (0,0) - \u5de6\u4e0a\u89d2\u539f\u70b9\n   +------------------------------------\u2192 X\u8f74 (\u5411\u53f3\u589e\u52a0)\n   |   (x0,y0) +-----------------+ (x1,y0)\n   |           |                 |\n   |           |     \u6587\u6863\u9875\u9762    |\n   |           |                 |\n   |   (x0,y1) +-----------------+ (x1,y1)\n   \u2193\nY\u8f74 \u2193 (\u5411\u4e0b\u589e\u52a0)\n</code></pre> \u4e0ePDF\u539f\u751f\u5750\u6807\u7cfb\u548c\u56fe\u50cf\u5750\u6807\u7cfb\u7684\u6bd4\u8f83</p> \u7279\u6027 PDF\u539f\u751f\u5750\u6807\u7cfb PyMuPDF (MuPDF) \u5750\u6807\u7cfb \u56fe\u50cf\u5750\u6807\u7cfb \u539f\u70b9 \u5de6\u4e0b\u89d2 \u9875\u9762\u5de6\u4e0a\u89d2 \u56fe\u50cf\u5de6\u4e0a\u89d2 Y\u8f74\u65b9\u5411 \u5411\u4e0a \u2191 \u4e3a\u6b63 \u5411\u4e0b \u2193\u4e3a\u6b63 \u5411\u4e0b \u2193\u4e3a\u6b63 \u5355\u4f4d \u70b9 (Point) \u70b9\uff08PDF\uff09\u6216\u50cf\u7d20\uff08\u56fe\u50cf\uff09 \u50cf\u7d20 \u5178\u578b\u4f7f\u7528\u573a\u666f PDF\u6587\u4ef6\u5b58\u50a8 PDF\u6587\u672c/\u56fe\u5f62\u63d0\u53d6 \u5c4f\u5e55\u663e\u793a/\u56fe\u50cf\u5904\u7406 <p>\u5173\u952e\u7ed3\u8bba\uff1aPyMuPDF\u8fd4\u56de\u7684\u5750\u6807\u4e0e\u56fe\u50cf\u5750\u6807\u7cfb\u5728\u65b9\u5411\u4e0a\u5b8c\u5168\u4e00\u81f4\uff08\u539f\u70b9\u5de6\u4e0a\u89d2\uff0cY\u5411\u4e0b\uff09\uff0c\u4f46\u5355\u4f4d\u53ef\u80fd\u4e0d\u540c\uff08PDF\u7528\u70b9\uff0c\u56fe\u50cf\u7528\u50cf\u7d20\uff09\u3002</p> <p>\u5f53MuPDF\u52a0\u8f7dPDF\u9875\u9762\u65f6\uff0c\u5b83\u4f1a\u81ea\u52a8\u8fdb\u884c\u5750\u6807\u7cfb\u8f6c\u6362\uff1a   1. \u5c06\u539f\u70b9\u4ece\u5de6\u4e0b\u89d2\u5e73\u79fb\u5230\u5de6\u4e0a\u89d2\u3002   2. \u53cd\u8f6cY\u8f74\u65b9\u5411\uff08\u4e58\u4ee5\u53d8\u6362\u77e9\u9635 <code>[1, 0, 0, -1, 0, page_height]</code>\uff09\u3002</p> <p>\u8fd9\u6837\uff0c\u5728MuPDF\u4e2d\u5904\u7406\u7684PDF\u9875\u9762\u5750\u6807\u5c31\u4e0e\u56fe\u50cf\u5750\u6807\u7cfb\u5bf9\u9f50\u4e86\u3002</p>"},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/#3-pymupdf","title":"3. PyMuPDF\u7684\u5750\u6807\u7cfb\u4f7f\u7528","text":"<p>PyMuPDF\u4f5c\u4e3aMuPDF\u7684Python\u7ed1\u5b9a\uff0c\u76f4\u63a5\u66b4\u9732\u4e86MuPDF\u7684\u5750\u6807\u7cfb\uff1a - \u6240\u6709\u8fd4\u56de\u7684\u5750\u6807\uff08\u5982<code>page.get_text(\"dict\")</code>\u4e2d\u7684<code>bbox</code>\u3001<code>page.search_for()</code>\u7684\u7ed3\u679c\uff09\u90fd\u4f7f\u7528\u5de6\u4e0a\u89d2\u539f\u70b9\uff0cY\u8f74\u5411\u4e0b\u3002 - \u6e32\u67d3\u56fe\u50cf\uff08<code>page.get_pixmap()</code>\uff09\u65f6\uff0c\u8f93\u51fa\u7684\u50cf\u7d20\u56fe\u4e5f\u4f7f\u7528\u76f8\u540c\u7684\u5750\u6807\u7cfb\uff08\u65e0\u9700\u989d\u5916\u8f6c\u6362\uff09\u3002</p> <p>\u793a\u4f8b\u4ee3\u7801\u9a8c\u8bc1\uff1a <pre><code>import pymupdf\ndoc = pymupdf.open(\"example.pdf\")\npage = doc[0]\n# \u83b7\u53d6\u9875\u9762\u5c3a\u5bf8\uff08\u5355\u4f4d\u4e3a\u70b9\uff09\npage_rect = page.rect\nprint(\"Page rectangle (top-left origin):\", page_rect)  # \u683c\u5f0f: (x0, y0, x1, y1), \u5176\u4e2dy0=0, y1=\u9875\u9762\u9ad8\u5ea6\n# \u83b7\u53d6\u7b2c\u4e00\u4e2a\u6587\u672c\u5757\u7684bbox\ntext_blocks = page.get_text(\"blocks\")\nif text_blocks:\n    block = text_blocks[0]\n    print(\"Text block bbox (top-left based):\", block)\n    # \u6b64\u65f6block\u7684y0\u662f\u8ddd\u79bb\u9875\u9762\u9876\u90e8\u7684\u8ddd\u79bb\uff0cy1\u662f\u5411\u4e0b\u5ef6\u4f38\u7684\u8ddd\u79bb\n</code></pre></p>"},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/#4","title":"4. \u5e38\u89c1\u8bef\u533a\u6f84\u6e05","text":"<ul> <li> <p>\u8bef\u533a1\uff1aPyMuPDF\u8fd4\u56dePDF\u539f\u751f\u5750\u6807\u3002 \u7ea0\u6b63\uff1aPyMuPDF\u8fd4\u56de\u7684\u662f\u8f6c\u6362\u540e\u7684\u5750\u6807\uff08\u5de6\u4e0a\u89d2\u539f\u70b9\uff0cY\u5411\u4e0b\uff09\uff0c\u4e0eMuPDF\u4e00\u81f4\u3002</p> </li> <li> <p>\u8bef\u533a2\uff1a\u6e32\u67d3\u56fe\u50cf\u9700\u8981\u624b\u52a8\u7ffb\u8f6cY\u8f74\u3002 \u7ea0\u6b63\uff1a<code>page.get_pixmap()</code>\u8f93\u51fa\u7684\u56fe\u50cf\u5750\u6807\u7cfb\u4e0ePyMuPDF\u5185\u90e8\u5750\u6807\u7cfb\u4e00\u81f4\uff0c\u65e0\u9700\u989d\u5916\u7ffb\u8f6c\u3002</p> </li> </ul>"},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/#5","title":"5. \u603b\u7ed3","text":"<ul> <li>PyMuPDF\u5750\u6807\u7cfb\uff1a\u7edf\u4e00\u4f7f\u7528\u5de6\u4e0a\u89d2\u539f\u70b9\uff0cY\u8f74\u5411\u4e0b\uff08\u4e0e\u56fe\u50cf\u5750\u6807\u7cfb\u65b9\u5411\u76f8\u540c\uff09\u3002</li> <li>\u4e0ePDF\u539f\u751f\u5750\u6807\u5173\u7cfb\uff1a\u52a0\u8f7d\u65f6\u81ea\u52a8\u8f6c\u6362\uff08Y\u8f74\u7ffb\u8f6c + \u539f\u70b9\u5e73\u79fb\uff09\u3002</li> <li>\u5b9e\u8df5\u5efa\u8bae\uff1a</li> <li>\u5904\u7406PyMuPDF\u5750\u6807\u65f6\uff0c\u76f4\u63a5\u6309\u5de6\u4e0a\u89d2\u53c2\u8003\u5373\u53ef\u3002</li> <li>\u4ec5\u5728\u4e0e\u5176\u4ed6\u5de5\u5177\u4ea4\u4e92\uff08\u8981\u6c42PDF\u539f\u751f\u5750\u6807\uff09\u65f6\u624d\u9700\u8981\u8f6c\u6362\u3002</li> <li>\u6e32\u67d3\u56fe\u50cf\u65f6\uff0c\u4f7f\u7528<code>pymupdf.Matrix</code>\u5904\u7406\u7f29\u653e\uff0c\u5750\u6807\u7cfb\u5df2\u5bf9\u9f50\u3002</li> </ul>"},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/#pymupdpdf","title":"\u4f7f\u7528PyMuPD\u7f16\u8f91PDF\u6587\u4ef6\u5185\u5bb9","text":""},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/#add_redact_annot","title":"add_redact_annot \u65b9\u6cd5\u7684\u4f7f\u7528","text":"<p>\u5728PyMuPDF\u4e2d\uff0c<code>add_redact_annot</code>\u65b9\u6cd5\u7528\u4e8e\u5728PDF\u9875\u9762\u4e0a\u521b\u5efa\u201c\u6d82\u7ea2\u201d\uff08redaction\uff09\u6ce8\u91ca\u3002\u6d82\u7ea2\u6ce8\u91ca\u901a\u5e38\u7528\u4e8e\u6807\u8bb0\u9700\u8981\u5220\u9664\u6216\u9690\u85cf\u7684\u5185\u5bb9\u3002\u4f46\u662f\uff0c\u4ec5\u4ec5\u6dfb\u52a0\u6d82\u7ea2\u6ce8\u91ca\u5e76\u4e0d\u4f1a\u7acb\u5373\u5220\u9664\u5185\u5bb9\uff0c\u8fd8\u9700\u8981\u8c03\u7528<code>apply_redactions</code>\u65b9\u6cd5\u6765\u5b9e\u9645\u6267\u884c\u5220\u9664\u64cd\u4f5c\u3002\u6d82\u7ea2\u64cd\u4f5c\u4f1a\u6c38\u4e45\u5220\u9664\u6307\u5b9a\u533a\u57df\u5185\u7684\u5185\u5bb9\uff08\u6587\u672c\u548c\u56fe\u50cf\uff09\uff0c\u5e76\u7528\u6307\u5b9a\u7684\u989c\u8272\uff08\u9ed8\u8ba4\u662f\u767d\u8272\uff09\u586b\u5145\u8be5\u533a\u57df\u3002 \u901a\u8fc7\u7ed3\u5408 add_redact_annot \u7684\u7cbe\u51c6\u533a\u57df\u6807\u8bb0\u548c apply_redactions \u7684\u7075\u6d3b\u5220\u9664\u7b56\u7565\uff0c\u53ef\u9ad8\u6548\u5b9e\u73b0 PDF \u5185\u5bb9\u7684\u5b89\u5168\u64e6\u9664\u4e0e\u66ff\u6362\u3002</p> <p>\u4e0b\u9762\u662f\u5173\u4e8e<code>add_redact_annot</code>\u65b9\u6cd5\u7684\u8be6\u7ec6\u8bf4\u660e\u548c\u4f7f\u7528\u6b65\u9aa4\uff1a \u65b9\u6cd5\u7b7e\u540d</p> <p><pre><code>add_redact_annot(quad, text=None, fontname=None, fontsize=11, align=TEXT_ALIGN_LEFT, fill=(1, 1, 1), text_color=(0, 0, 0), cross_out=True)\n</code></pre> \u53c2\u6570\u8bf4\u660e - quad: \u6307\u5b9a\u8981\u5220\u9664\u7684\u77e9\u5f62\u533a\u57df\u3002\u53ef\u4ee5\u662f\u77e9\u5f62\uff08rect_like\uff0c\u7531\u5de6\u4e0a\u89d2\u548c\u53f3\u4e0b\u89d2\u5750\u6807\u5b9a\u4e49\uff09\u6216\u56db\u8fb9\u5f62\uff08quad_like\uff0c\u7531\u56db\u4e2a\u70b9\u5b9a\u4e49\uff09\u3002\u5982\u679c\u662f\u56db\u8fb9\u5f62\uff0c\u5c06\u53d6\u5176\u5916\u63a5\u77e9\u5f62\u3002 - text: (\u53ef\u9009) \u5728\u5e94\u7528\u7ea2\u6279\u6ce8\u540e\uff0c\u5728\u77e9\u5f62\u533a\u57df\u4e2d\u653e\u7f6e\u7684\u65b0\u6587\u672c\u3002\u5982\u679c\u4e0d\u63d0\u4f9b\uff0c\u5219\u533a\u57df\u5c06\u88ab\u586b\u5145\u989c\u8272\uff08\u9ed8\u8ba4\u767d\u8272\uff09\u800c\u6ca1\u6709\u6587\u672c\u3002 - fontname: \u7528\u4e8e\u65b0\u6587\u672c\u7684\u5b57\u4f53\u3002\u53ea\u652f\u6301CJK\u548cPDF\u57fa\u784014\u79cd\u5b57\u4f53\uff08\u5982\"Helvetica\", \"Times-Roman\"\u7b49\uff09\u3002\u5982\u679c\u4e0d\u63d0\u4f9b\uff0c\u5c06\u4f7f\u7528\u9ed8\u8ba4\u5b57\u4f53\uff08\u901a\u5e38\u662fHelvetica\uff09\u3002 - fontsize: \u65b0\u6587\u672c\u7684\u5b57\u4f53\u5927\u5c0f\u3002\u9ed8\u8ba411\u3002\u5982\u679c\u6587\u672c\u592a\u957f\uff0c\u4f1a\u5c1d\u8bd5\u7f29\u5c0f\u5b57\u4f53\uff08\u6700\u5c0f\u52304\uff09\u4ee5\u9002\u5e94\u3002\u5982\u679c\u4ecd\u7136\u653e\u4e0d\u4e0b\uff0c\u5219\u4e0d\u4f1a\u6dfb\u52a0\u6587\u672c\u3002 - align: \u6587\u672c\u7684\u6c34\u5e73\u5bf9\u9f50\u65b9\u5f0f\uff08\u4f8b\u5982TEXT_ALIGN_LEFT, TEXT_ALIGN_CENTER, TEXT_ALIGN_RIGHT\u7b49\uff09\u3002\u5782\u76f4\u65b9\u5411\u5927\u81f4\u5c45\u4e2d\u3002 - fill: \u5e94\u7528\u7ea2\u6279\u6ce8\u540e\u77e9\u5f62\u7684\u586b\u5145\u989c\u8272\u3002\u9ed8\u8ba4\u662f\u767d\u8272(1,1,1)\u3002\u5982\u679c\u6307\u5b9a\u4e3aFalse\uff0c\u5219\u6ca1\u6709\u586b\u5145\uff08\u900f\u660e\uff09\u3002 - text_color: \u65b0\u6587\u672c\u7684\u989c\u8272\uff0c\u9ed8\u8ba4\u9ed1\u8272(0,0,0)\u3002 - cross_out: \u662f\u5426\u5728\u7ea2\u6279\u6ce8\u77e9\u5f62\u4e0a\u753b\u4e24\u6761\u5bf9\u89d2\u7ebf\uff08\u9ed8\u8ba4\u4e3aTrue\uff0c\u5373\u753b\u5bf9\u89d2\u7ebf\uff09\u3002</p>"},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/#apply_redactions","title":"apply_redactions\u65b9\u6cd5\u7684\u4f7f\u7528","text":"<p>\u5728\u6dfb\u52a0\u5b8c\u6240\u6709\u7ea2\u6279\u6ce8\u540e\uff0c\u8c03\u7528apply_redactions\u65b9\u6cd5\u6765\u5b9e\u9645\u6267\u884c\u5220\u9664\u64cd\u4f5c\u3002 \u65b9\u6cd5\u7b7e\u540d</p> <p><pre><code>apply_redactions(images=PDF_REDACT_IMAGE_PIXELS | 2, graphics=PDF_REDACT_LINE_ART_REMOVE_IF_TOUCHED | 2, text=PDF_REDACT_TEXT_REMOVE | 0)\n</code></pre> \u53c2\u6570\u8bf4\u660e\uff1a - images: \u63a7\u5236\u5982\u4f55\u5904\u7406\u4e0e\u7ea2\u6279\u6ce8\u91cd\u53e0\u7684\u56fe\u50cf\u3002\u9ed8\u8ba4\u503c2\uff08PDF_REDACT_IMAGE_PIXELS\uff09\u8868\u793a\u5c06\u91cd\u53e0\u7684\u50cf\u7d20\u53d8\u4e3a\u7a7a\u767d\uff08\u5373\u7528\u767d\u8272\u8986\u76d6\uff09\u3002\u5176\u4ed6\u9009\u9879\uff1a0\uff08\u5ffd\u7565\u56fe\u50cf\uff09\uff0c1\uff08\u5b8c\u5168\u5220\u9664\u91cd\u53e0\u7684\u56fe\u50cf\uff09\uff0c3\uff08\u4ec5\u5220\u9664\u53ef\u89c1\u7684\u56fe\u50cf\uff09\u3002 - graphics: \u63a7\u5236\u5982\u4f55\u5904\u7406\u4e0e\u7ea2\u6279\u6ce8\u91cd\u53e0\u7684\u77e2\u91cf\u56fe\u5f62\u3002\u9ed8\u8ba4\u503c2\uff08PDF_REDACT_LINE_ART_REMOVE_IF_TOUCHED\uff09\u8868\u793a\u5220\u9664\u4efb\u4f55\u6709\u91cd\u53e0\u7684\u77e2\u91cf\u56fe\u5f62\u3002\u5176\u4ed6\u9009\u9879\uff1a0\uff08\u5ffd\u7565\uff09\uff0c1\uff08\u4ec5\u5220\u9664\u5b8c\u5168\u5305\u542b\u5728\u7ea2\u6279\u6ce8\u5185\u7684\u77e2\u91cf\u56fe\u5f62\uff09\u3002 - text: \u63a7\u5236\u5982\u4f55\u5904\u7406\u91cd\u53e0\u7684\u6587\u672c\u3002\u9ed8\u8ba4\u503c0\uff08PDF_REDACT_TEXT_REMOVE\uff09\u8868\u793a\u5220\u9664\u6240\u6709\u8fb9\u754c\u6846\u4e0e\u7ea2\u6279\u6ce8\u77e9\u5f62\u91cd\u53e0\u7684\u5b57\u7b26\u3002\u8bbe\u7f6e\u4e3a1\uff08PDF_REDACT_TEXT_NONE\uff09\u5219\u4fdd\u7559\u6587\u672c\uff08\u4f46\u8fd9\u6837\u4e0d\u7b26\u5408\u6570\u636e\u4fdd\u62a4\u76ee\u7684\uff0c\u614e\u7528\uff09\u3002</p> <p>\u6ce8\u610f\uff1aapply_redactions\u8fd4\u56de\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u8868\u793a\u662f\u5426\u5904\u7406\u4e86\u81f3\u5c11\u4e00\u4e2a\u7ea2\u6279\u6ce8\u3002</p>"},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/#_1","title":"\u793a\u4f8b\u4ee3\u7801","text":"<p>\u4ee5\u4e0b\u793a\u4f8b\u6f14\u793a\u5982\u4f55\u5220\u9664\u4e00\u9875\u4e2d\u7684\u9875\u7709\u548c\u9875\u811a\uff0c\u6b65\u9aa4\u5982\u4e0b\uff1a 1. \u6253\u5f00PDF\u6587\u6863\uff0c\u9009\u62e9\u8981\u5904\u7406\u7684\u9875\u9762\u3002 2. \u5b9a\u4e49\u6d82\u7ea2\u533a\u57df\uff08\u4e00\u4e2a\u6216\u591a\u4e2a\u77e9\u5f62\uff09\u3002 3. \u4e3a\u6bcf\u4e2a\u533a\u57df\u8c03\u7528<code>add_redact_annot</code>\u65b9\u6cd5\u6dfb\u52a0\u6d82\u7ea2\u6ce8\u91ca\u3002 4. \u8c03\u7528\u9875\u9762\u7684<code>apply_redactions()</code>\u65b9\u6cd5\u5e94\u7528\u6d82\u7ea2\u64cd\u4f5c\u3002\u6b64\u64cd\u4f5c\u4f1a\u5220\u9664\u533a\u57df\u5185\u7684\u5185\u5bb9\uff0c\u5e76\u7528\u6307\u5b9a\u989c\u8272\u586b\u5145\uff08\u5982\u679c\u6ca1\u6709\u6307\u5b9a\u6587\u672c\uff0c\u5219\u53ea\u586b\u5145\u989c\u8272\uff1b\u5982\u679c\u6307\u5b9a\u4e86\u6587\u672c\uff0c\u5219\u8fd8\u4f1a\u5728\u533a\u57df\u4e2d\u7ed8\u5236\u6587\u672c\uff09\u3002 5. \u4fdd\u5b58\u6587\u6863\u3002</p> <pre><code>import fitz  # PyMuPDF\n# \u6253\u5f00PDF\u6587\u6863\ndoc = fitz.open(\"input.pdf\")\npage = doc[0]  # \u7b2c\u4e00\u9875\n# \u5047\u8bbe\u9875\u7709\u5728\u9875\u9762\u9876\u90e850\u4e2a\u70b9\u7684\u9ad8\u5ea6\uff0c\u9875\u811a\u5728\u9875\u9762\u5e95\u90e850\u4e2a\u70b9\u7684\u9ad8\u5ea6\npage_rect = page.rect\nheader_rect = fitz.Rect(0, 0, page_rect.width, 50)   # \u9875\u7709\u533a\u57df\nfooter_rect = fitz.Rect(0, page_rect.height - 50, page_rect.width, page_rect.height)  # \u9875\u811a\u533a\u57df\n# \u6dfb\u52a0\u6d82\u7ea2\u6ce8\u91ca\uff08\u4e0d\u663e\u793a\u8986\u76d6\u6587\u672c\uff0c\u4ec5\u7528\u767d\u8272\u586b\u5145\uff09\npage.add_redact_annot(header_rect)\npage.add_redact_annot(footer_rect)\n# \u5e94\u7528\u6d82\u7ea2\u64cd\u4f5c\npage.apply_redactions()\n# \u4fdd\u5b58\u6587\u6863\ndoc.save(\"output.pdf\")\ndoc.close()\n</code></pre>"},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/#_2","title":"\u6ce8\u610f\u4e8b\u9879","text":"<ol> <li>\u533a\u57df\u91cd\u53e0\uff1a\u5982\u679c\u6d82\u7ea2\u533a\u57df\u6709\u91cd\u53e0\uff0c<code>apply_redactions</code>\u65b9\u6cd5\u4f1a\u5408\u5e76\u91cd\u53e0\u7684\u533a\u57df\u3002</li> <li>\u5185\u5bb9\u5220\u9664\uff1a\u6d82\u7ea2\u64cd\u4f5c\u4f1a\u6c38\u4e45\u5220\u9664\u533a\u57df\u5185\u7684\u6240\u6709\u5185\u5bb9\uff08\u5305\u62ec\u6587\u672c\u548c\u56fe\u50cf\uff09\uff0c\u6240\u4ee5\u5728\u64cd\u4f5c\u524d\u6700\u597d\u5907\u4efd\u539f\u6587\u6863\u3002</li> <li>\u6587\u672c\u8986\u76d6\uff1a\u5982\u679c\u9700\u8981\u5728\u6d82\u7ea2\u533a\u57df\u4e0a\u663e\u793a\u66ff\u4ee3\u6587\u672c\uff08\u4f8b\u5982\"[REDACTED]\"\uff09\uff0c\u53ef\u4ee5\u8bbe\u7f6e<code>text</code>\u53c2\u6570\u3002</li> <li>\u989c\u8272\u8bbe\u7f6e\uff1a\u9ed8\u8ba4\u586b\u5145\u989c\u8272\u662f\u767d\u8272\uff0c\u4f46\u53ef\u4ee5\u901a\u8fc7<code>fill</code>\u53c2\u6570\u66f4\u6539\u3002\u4f8b\u5982\uff0c\u7528\u7ea2\u8272\u586b\u5145\u5e76\u663e\u793a\u767d\u8272\u6587\u5b57\uff1a    <pre><code>page.add_redact_annot(rect, text=\"REDACTED\", fill=(1, 0, 0), text_color=(1,1,1))\n</code></pre></li> <li>\u6027\u80fd\uff1a\u5bf9\u6bcf\u4e00\u9875\u7684\u6d82\u7ea2\u64cd\u4f5c\u90fd\u662f\u72ec\u7acb\u7684\u3002\u5982\u679c\u6587\u6863\u6709\u591a\u9875\uff0c\u9700\u8981\u9010\u9875\u5904\u7406\u3002</li> </ol>"},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/#pdf_1","title":"PDF\u6587\u4ef6\u9875\u7709\u548c\u9875\u811a\u8bc6\u522b","text":""},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/#_3","title":"\u9875\u7709\u548c\u9875\u811a\u81ea\u52a8\u68c0\u6d4b\u601d\u8def\u5206\u6790","text":"<p>\u81ea\u52a8\u8bc6\u522b\u9875\u7709\u548c\u9875\u811a\u7684\u4f4d\u7f6e\u662f\u4e00\u4e2a\u6311\u6218\u3002\u6211\u4eec\u53ef\u4ee5\u5047\u8bbe\uff1a    - \u9875\u7709\u901a\u5e38\u4f4d\u4e8e\u6bcf\u4e00\u9875\u7684\u9876\u90e8\uff08\u6bd4\u5982\u4ece\u4e0a\u5230\u4e0b0\u523050\u50cf\u7d20\u7684\u533a\u57df\uff09\uff0c\u9875\u811a\u4f4d\u4e8e\u5e95\u90e8\uff08\u6bd4\u5982\u4ece\u9875\u9762\u9ad8\u5ea6-50\u5230\u9875\u9762\u9ad8\u5ea6\uff09\u3002    - \u4f46\u662f\uff0c\u4e0d\u540c\u7684PDF\u9875\u7709\u9875\u811a\u4f4d\u7f6e\u53ef\u80fd\u4e0d\u540c\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u80fd\u9700\u8981\u7528\u6237\u6307\u5b9a\u533a\u57df\uff0c\u6216\u8005\u901a\u8fc7\u5206\u6790\u591a\u4e2a\u9875\u9762\u6765\u52a8\u6001\u786e\u5b9a\u3002  \u4e3a\u4e86\u7b80\u5316\uff0c\u6211\u4eec\u53ef\u4ee5\u8bbe\u8ba1\u5982\u4e0b\uff1a   \u65b9\u68481\uff1a\u7528\u6237\u63d0\u4f9b\u9875\u7709\u548c\u9875\u811a\u7684\u533a\u57df\u5750\u6807\uff08\u76f8\u5bf9\u4e8e\u6bcf\u4e00\u9875\uff09\u3002   \u65b9\u68482\uff1a\u81ea\u52a8\u68c0\u6d4b\uff1a\u901a\u8fc7\u5206\u6790\u7b2c\u4e00\u9875\uff08\u6216\u51e0\u9875\uff09\u7684\u9876\u90e8\u548c\u5e95\u90e8\u533a\u57df\uff0c\u63d0\u53d6\u91cd\u590d\u51fa\u73b0\u7684\u6587\u672c\uff08\u6216\u5bf9\u8c61\uff09\u6765\u8bc6\u522b\u9875\u7709\u9875\u811a\u3002\u4f46\u6ce8\u610f\uff0c\u9875\u7709\u9875\u811a\u53ef\u80fd\u5305\u542b\u9875\u7801\uff0c\u9875\u7801\u662f\u53d8\u5316\u7684\u3002</p> <p>\u81ea\u52a8\u68c0\u6d4b\u601d\u8def\uff1a    - \u63d0\u53d6\u6bcf\u4e00\u9875\u7684\u9876\u90e8\u533a\u57df\uff08\u6bd4\u5982\u524d10%\u9ad8\u5ea6\uff09\u548c\u5e95\u90e8\u533a\u57df\uff08\u540e10%\u9ad8\u5ea6\uff09\u7684\u6587\u672c\u548c\u56fe\u50cf\u3002    - \u5bf9\u4e8e\u6587\u672c\uff0c\u6211\u4eec\u53ef\u4ee5\u6bd4\u8f83\u4e0d\u540c\u9875\u9762\u7684\u8fd9\u4e9b\u533a\u57df\uff0c\u627e\u51fa\u91cd\u590d\u51fa\u73b0\u7684\u6587\u672c\uff08\u5ffd\u7565\u9875\u7801\u7b49\u53d8\u5316\u90e8\u5206\uff09\u3002    - \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8ba1\u7b97\u591a\u4e2a\u9875\u9762\u9876\u90e8\u548c\u5e95\u90e8\u533a\u57df\u7684\u76f8\u4f3c\u6027\uff0c\u786e\u5b9a\u4e00\u4e2a\u56fa\u5b9a\u7684\u533a\u57df\uff08\u5373\u6bcf\u9875\u90fd\u6709\u7684\u90e8\u5206\uff09\u3002\u6211\u4eec\u5047\u8bbe\u9875\u7709\u9875\u811a\u5728\u6bcf\u4e00\u9875\u7684\u4f4d\u7f6e\u548c\u5927\u5c0f\u662f\u56fa\u5b9a\u7684\u3002</p> <p>\u7136\u800c\uff0c\u5728\u5b9e\u8df5\u4e2d\uff0c\u6211\u4eec\u53ef\u80fd\u4e0d\u9700\u8981\u4fdd\u7559\u9875\u7709\u9875\u811a\u4e2d\u7684\u53d8\u5316\u90e8\u5206\uff08\u5982\u9875\u7801\uff09\uff0c\u800c\u662f\u5e0c\u671b\u53bb\u9664\u6574\u4e2a\u533a\u57df\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u8ba9\u7528\u6237\u6307\u5b9a\u4e00\u4e2a\u56fa\u5b9a\u7684\u533a\u57df\uff08\u6bd4\u5982\u4ece\u9876\u90e80\u523050\u50cf\u7d20\uff0c\u5e95\u90e8\u4ece\u9875\u9762\u9ad8\u5ea6-50\u5230\u9875\u9762\u9ad8\u5ea6\uff09\uff0c\u7136\u540e\u8986\u76d6\u8fd9\u4e2a\u533a\u57df\u3002</p> <p>\u8fd9\u91cc\uff0c\u6211\u4eec\u63d0\u4f9b\u4e00\u4e2a\u6298\u4e2d\u7684\u65b9\u6848\uff1a - \u51fd\u65701\uff1a\u901a\u8fc7\u624b\u52a8\u6307\u5b9a\u533a\u57df\u53bb\u9664\u9875\u7709\u9875\u811a\u3002 - \u51fd\u65702\uff1a\u81ea\u52a8\u68c0\u6d4b\u9875\u7709\u9875\u811a\u533a\u57df\uff08\u901a\u8fc7\u6bd4\u8f83\u7b2c\u4e00\u9875\u548c\u540e\u7eed\u51e0\u9875\u7684\u9876\u90e8\u548c\u5e95\u90e8\u533a\u57df\uff0c\u627e\u51fa\u5171\u540c\u7684\u5143\u7d20\uff0c\u7136\u540e\u786e\u5b9a\u4e00\u4e2a\u8fb9\u754c\u6846\uff09\u3002\u4f46\u662f\uff0c\u8fd9\u79cd\u65b9\u6cd5\u53ef\u80fd\u4e0d\u51c6\u786e\uff0c\u7279\u522b\u662f\u5f53\u9875\u7709\u9875\u811a\u5185\u5bb9\u53d8\u5316\u8f83\u5927\u65f6\u3002</p> <p>\u5177\u4f53\u5b9e\u73b0 1. \u624b\u52a8\u6a21\u5f0f\uff1a \u8f93\u5165\uff1a<code>pdf_path, output_path, header_bbox\uff08\u9875\u7709\u533a\u57df\uff0c\u4f8b\u5982(0,0, page_width, 50)\uff09, footer_bbox\uff08\u9875\u811a\u533a\u57df\uff0c\u4f8b\u5982(0, page_height-50, page_width, page_height)\uff09</code> 1. \u81ea\u52a8\u68c0\u6d4b\u6a21\u5f0f\uff08\u5c1d\u8bd5\u57fa\u4e8e\u6587\u672c\u91cd\u590d\u6027\uff09\uff1a   \u6b65\u9aa4\uff1a    1. \u9009\u62e9\u524dn\u9875\uff08\u4f8b\u59825\u9875\uff09\u8fdb\u884c\u5206\u6790\u3002    2. \u63d0\u53d6\u6bcf\u4e00\u9875\u9876\u90e8\u533a\u57df\uff08\u6bd4\u59820\u5230100\u70b9\uff09\u7684\u6587\u672c\u5757\uff08\u4f7f\u7528<code>page.get_text(\"dict\")</code>\u6216<code>page.get_text(\"blocks\")</code>\uff09\u548c\u5e95\u90e8\u533a\u57df\uff08page_height-100\u5230page_height\uff09\u7684\u6587\u672c\u5757\u3002    3. \u627e\u51fa\u8fd9\u4e9b\u533a\u57df\u4e2d\u91cd\u590d\u51fa\u73b0\u7684\u6587\u672c\uff08\u5ffd\u7565\u6570\u5b57\u3001\u65e5\u671f\u7b49\u53ef\u80fd\u53d8\u5316\u7684\u5185\u5bb9\uff09\u6216\u8005\u56fe\u50cf\uff08\u56fe\u50cf\u53ef\u4ee5\u901a\u8fc7\u6bd4\u8f83\u56fe\u50cf\u7684\u54c8\u5e0c\u503c\u6216\u76f4\u63a5\u6bd4\u8f83\u50cf\u7d20\u6570\u636e\uff0c\u4f46\u6bd4\u8f83\u590d\u6742\uff0c\u8fd9\u91cc\u5148\u53ea\u8003\u8651\u6587\u672c\uff09\u3002    4. \u6839\u636e\u8fd9\u4e9b\u91cd\u590d\u51fa\u73b0\u7684\u6587\u672c\u5757\u7684\u4f4d\u7f6e\uff0c\u786e\u5b9a\u4e00\u4e2a\u5171\u540c\u7684\u8fb9\u754c\u6846\uff08\u6bd4\u5982\u53d6\u6240\u6709\u9875\u9762\u4e0a\u8be5\u6587\u672c\u5757\u7684\u6700\u5c0f\u5916\u63a5\u77e9\u5f62\uff09\u3002    5. \u5982\u679c\u627e\u4e0d\u5230\u91cd\u590d\u7684\u6587\u672c\uff0c\u5219\u53ef\u80fd\u9700\u8981\u7528\u6237\u624b\u52a8\u6307\u5b9a\u3002</p> <p>\u81ea\u52a8\u68c0\u6d4b\u6a21\u5f0f\u57fa\u672c\u601d\u8def\uff1a \u6211\u4eec\u5c1d\u8bd5\u901a\u8fc7\u6587\u672c\u5757\u6765\u68c0\u6d4b\u3002\u6211\u4eec\u4f7f\u7528<code>page.get_text(\"blocks\")</code>\uff0c\u5b83\u4f1a\u8fd4\u56de\u6587\u672c\u5757\u7684\u5217\u8868\uff0c\u6bcf\u4e2a\u5757\u662f\u4e00\u4e2a\u5143\u7ec4\uff1a<code>(x0,y0,x1,y1, \"text\", block_no, block_type)</code>    1. \u5206\u6790\u524dn\u9875\uff0c\u6536\u96c6\u6bcf\u4e00\u9875\u9876\u90e8\u533a\u57df\uff08\u6bd4\u59820\u5230100\u50cf\u7d20\uff09\u7684\u6240\u6709\u6587\u672c\u5757\u3002    2. \u7136\u540e\uff0c\u6bd4\u8f83\u4e0d\u540c\u9875\u9762\u7684\u8fd9\u4e9b\u6587\u672c\u5757\uff0c\u5982\u679c\u591a\u4e2a\u9875\u9762\u5728\u76f8\u540c\u4f4d\u7f6e\uff08\u6bd4\u5982y\u5750\u6807\u76f8\u5dee\u4e0d\u8d85\u8fc75\u50cf\u7d20\uff09\u6709\u6587\u672c\u5757\uff0c\u5e76\u4e14\u6587\u672c\u5185\u5bb9\u76f8\u540c\uff08\u6216\u8005\u76f8\u4f3c\uff09\uff0c\u90a3\u4e48\u8ba4\u4e3a\u8fd9\u662f\u9875\u7709\u3002    3. \u9875\u7709\u53ef\u80fd\u5305\u542b\u65e5\u671f\u3001\u9875\u7801\u7b49\u53d8\u5316\u7684\u5185\u5bb9\uff0c\u6240\u4ee5\u76f4\u63a5\u6bd4\u8f83\u6587\u672c\u5185\u5bb9\u53ef\u80fd\u627e\u4e0d\u5230\u5b8c\u5168\u76f8\u540c\u7684\u3002\u56e0\u6b64\u53ef\u4ee5\u901a\u8fc7\u6b63\u5219\u8868\u8fbe\u5f0f\u8fc7\u6ee4\u6389\u5305\u542b\u9875\u7801\u7684\u6587\u672c\uff0c\u7136\u540e\u5224\u65ad\u6587\u672c\u7684\u91cd\u590d\u6027\u3002 \u9875\u811a\u540c\u7406</p> <p>\u786e\u5b9a\u9875\u7709\u9875\u811a\u533a\u57df\u5177\u4f53\u65b9\u6cd5\uff1a \u5bf9\u4e8e\u9876\u90e8\u533a\u57df\uff0c\u6211\u4eec\u8bb0\u5f55\u6bcf\u4e00\u9875\u7684\u9876\u90e8\u6587\u672c\u5757\u7684\u8fb9\u754c\uff08y0,y1\uff09\u7684\u533a\u95f4\u3002\u7136\u540e\uff0c\u6211\u4eec\u627e\u51fa\u5728\u591a\u9875\u4e2d\u90fd\u6709\u6587\u672c\u5757\u91cd\u53e0\u7684y\u533a\u95f4\u3002</p> <p>\u6211\u4eec\u53d6\u6bcf\u4e00\u9875\u9876\u90e8\u533a\u57df\u6587\u672c\u5757\u7684\u6700\u5927y1\uff08\u5373\u8be5\u9875\u9875\u7709\u7684\u5e95\u90e8\u8fb9\u754c\uff09\uff0c\u7136\u540e\u53d6\u8fd9\u4e9by1\u7684\u6700\u5c0f\u503c\uff08\u5373\u6240\u6709\u9875\u4e2d\u6700\u9760\u4e0a\u7684\u9875\u7709\u5e95\u90e8\u8fb9\u754c\uff09\u4f5c\u4e3a\u9875\u7709\u533a\u57df\u7684y1\u3002 \u540c\u6837\uff0c\u53d6\u6bcf\u4e00\u9875\u5e95\u90e8\u533a\u57df\u6587\u672c\u5757\u7684\u6700\u5c0fy0\uff08\u5373\u8be5\u9875\u9875\u811a\u7684\u9876\u90e8\u8fb9\u754c\uff09\uff0c\u7136\u540e\u53d6\u8fd9\u4e9by0\u7684\u6700\u5927\u503c\uff08\u5373\u6240\u6709\u9875\u4e2d\u6700\u9760\u4e0b\u7684\u9875\u811a\u9876\u90e8\u8fb9\u754c\uff09\u4f5c\u4e3a\u9875\u811a\u533a\u57df\u7684y0\u3002</p> <p>\u4e3a\u4ec0\u4e48\u8fd9\u6837\uff1f \u56e0\u4e3a\u9875\u7709\u5e94\u8be5\u5c3d\u53ef\u80fd\u9760\u8fd1\u9876\u90e8\uff0c\u6240\u4ee5\u6bcf\u4e00\u9875\u7684\u9875\u7709\u5e95\u90e8\u8fb9\u754c\u5e94\u8be5\u6bd4\u8f83\u5c0f\uff08\u5373\u79bb\u9876\u90e8\u8fd1\uff09\u3002\u6211\u4eec\u53d6\u6700\u5c0f\u7684y1\uff08\u5373\u6240\u6709\u9875\u7709\u5e95\u90e8\u8fb9\u754c\u4e2d\u6700\u9760\u4e0a\u7684\u90a3\u4e2a\uff09\u4f5c\u4e3a\u9875\u7709\u533a\u57df\u7684\u5e95\u90e8\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u5305\u542b\u540e\u9762\u9875\u9762\u7684\u53ef\u80fd\u66f4\u5927\u7684\u9875\u7709\u533a\u57df\uff08\u53ef\u80fd\u662f\u6807\u9898\uff09\u3002 \u540c\u6837\uff0c\u9875\u811a\u5e94\u8be5\u5c3d\u53ef\u80fd\u9760\u8fd1\u5e95\u90e8\uff0c\u6240\u4ee5\u6bcf\u4e00\u9875\u7684\u9875\u811a\u9876\u90e8\u8fb9\u754c\u5e94\u8be5\u6bd4\u8f83\u5927\uff08\u79bb\u5e95\u90e8\u8fd1\uff09\u3002\u6211\u4eec\u53d6\u6700\u5927\u7684y0\uff08\u5373\u6240\u6709\u9875\u811a\u9876\u90e8\u8fb9\u754c\u4e2d\u6700\u9760\u4e0b\u7684\u90a3\u4e2a\uff09\u4f5c\u4e3a\u9875\u811a\u533a\u57df\u7684\u9876\u90e8\u3002</p> <ul> <li>\u5bf9\u4e8e\u9875\u7709\uff1a   <code>header_y1 = min( [\u8be5\u9875\u9876\u90e8\u533a\u57df\u6240\u6709\u6587\u672c\u5757\u7684\u6700\u5927y1] for \u6bcf\u4e00\u9875 )</code>   # \u6ce8\u610f\uff1a\u5982\u679c\u4e00\u9875\u6709\u591a\u4e2a\u6587\u672c\u5757\uff0c\u6211\u4eec\u53d6\u8be5\u9875\u9876\u90e8\u533a\u57df\u6240\u6709\u6587\u672c\u5757\u7684\u6700\u5927y1\uff08\u5373\u8be5\u9875\u9875\u7709\u533a\u57df\u7684\u6700\u4e0b\u6cbf\uff09     \u4f46\u662f\uff0c\u6211\u4eec\u53ef\u80fd\u5e0c\u671b\u9875\u7709\u533a\u57df\u662f\u4ece0\u5230header_y1\uff08\u8fd9\u4e2aheader_y1\u662f\u524d\u9762\u8ba1\u7b97\u7684\u6700\u5c0f\u503c\uff09\u3002\u8fd9\u6837\uff0c\u9875\u7709\u533a\u57df\u5c31\u8986\u76d6\u4e86\u6240\u6709\u9875\u7684\u9875\u7709\u5185\u5bb9\uff08\u56e0\u4e3a\u6bcf\u4e00\u9875\u7684\u9875\u7709\u5e95\u90e8\u8fb9\u754c\u90fd\u4e0d\u4f1a\u8d85\u8fc7\u8fd9\u4e2aheader_y1\uff1f\u4e0d\u5bf9\uff0c\u6211\u4eec\u53d6\u7684\u662f\u6240\u6709\u9875\u4e2d\u9875\u7709\u5e95\u90e8\u8fb9\u754c\u7684\u6700\u5c0f\u503c\uff0c\u90a3\u4e48\u6709\u4e9b\u9875\u7684\u9875\u7709\u53ef\u80fd\u8d85\u8fc7\u8fd9\u4e2a\u9ad8\u5ea6\uff1f\u4f46\u662f\uff0c\u6211\u4eec\u8981\u6c42\u7684\u662f\u5171\u540c\u533a\u57df\uff0c\u6240\u4ee5\u8fd9\u6837\u53d6\u53ef\u80fd\u6f0f\u6389\u4e00\u4e9b\u9875\u7684\u9875\u7709\u5185\u5bb9\uff1f\uff09   \u53e6\u4e00\u79cd\u601d\u8def\uff1a\u6211\u4eec\u53d6\u6bcf\u4e00\u9875\u9876\u90e8\u533a\u57df\u6587\u672c\u5757\u7684\u6700\u5927y1\uff0c\u7136\u540e\u53d6\u8fd9\u4e9by1\u7684\u6700\u5927\u503c\uff08\u5373\u6700\u9760\u4e0b\u7684\u90a3\u4e2a\uff09\u4f5c\u4e3aheader_y1\u3002\u8fd9\u6837\u80fd\u8986\u76d6\u6240\u6709\u9875\u7684\u9875\u7709\uff0c\u4f46\u53ef\u80fd\u4f1a\u628a\u4e00\u4e9b\u975e\u9875\u7709\u7684\u5185\u5bb9\u5305\u62ec\u8fdb\u6765\uff08\u6bd4\u5982\u67d0\u4e00\u9875\u9876\u90e8\u6709\u4e2a\u6807\u9898\uff09\u3002   \u56e0\u6b64\uff0c\u6211\u4eec\u91c7\u7528\u4ee5\u4e0b\u6298\u4e2d\uff1a   \u6211\u4eec\u8981\u6c42\u9875\u7709\u533a\u57df\u7684\u9ad8\u5ea6\u4e0d\u80fd\u8d85\u8fc750\u50cf\u7d20\uff0c\u6240\u4ee5\uff1a</li> <li><code>header_y0 = 0</code></li> <li><code>header_y1 = min( max( [\u8be5\u9875\u9876\u90e8\u533a\u57df\u6240\u6709\u6587\u672c\u5757\u7684\u6700\u5927y1] for \u6bcf\u4e00\u9875 ), 50)</code>   \u8fd9\u6837\uff0c\u5982\u679c\u6240\u6709\u9875\u7684\u9875\u7709\u5e95\u90e8\u8fb9\u754c\u6700\u5927\u503c\u4e0d\u8d85\u8fc750\uff0c\u6211\u4eec\u5c31\u7528\u8fd9\u4e2a\u6700\u5927\u503c\uff1b\u5982\u679c\u8d85\u8fc750\uff0c\u6211\u4eec\u5c31\u752850\u3002\u8fd9\u6837\u907f\u514d\u5305\u542b\u8fc7\u957f\u7684\u6807\u9898\u3002</li> <li>\u540c\u6837\uff0c\u5bf9\u4e8e\u9875\u811a\uff1a</li> <li><code>footer_y0 = max( min( [\u8be5\u9875\u5e95\u90e8\u533a\u57df\u6240\u6709\u6587\u672c\u5757\u7684\u6700\u5c0fy0] for \u6bcf\u4e00\u9875 ), page_height-50)</code></li> <li><code>footer_y1 = page_height</code></li> </ul> <p>\u6ce8\u610f\uff1a\u81ea\u52a8\u68c0\u6d4b\u53ef\u80fd\u4e0d\u51c6\u786e\uff0c\u6240\u4ee5\u6700\u597d\u63d0\u4f9b\u624b\u52a8\u6a21\u5f0f\u3002 </p>"},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/#_4","title":"\u4ee3\u7801\u5b9e\u73b0\u81ea\u52a8\u68c0\u6d4b\u51fd\u6570","text":"<p>\u4e0b\u9762\u662f\u4e00\u4e2a\u4f7f\u7528 PyMuPDF \u5b9e\u73b0\u81ea\u52a8\u68c0\u6d4b\u9875\u7709\u9875\u811a\u533a\u57df\u7684\u65b9\u6848\u3002\u8be5\u65b9\u6848\u57fa\u4e8e\u524d\u9762\u7684\u601d\u8def\uff1a\u5206\u6790\u524d n \u9875\u7684\u9876\u90e8\u548c\u5e95\u90e8\u533a\u57df\uff0c\u627e\u51fa\u91cd\u590d\u51fa\u73b0\u7684\u6587\u672c\u5757\u4f4d\u7f6e\uff0c\u4ece\u800c\u786e\u5b9a\u9875\u7709\u9875\u811a\u533a\u57df\u3002</p> <pre><code>import re\nimport pymupdf  # PyMuPDF\nimport numpy as np\nfrom collections import defaultdict\n\n\ndef auto_detect_header_footer_regions(pdf_path,\n                                      sample_pages: int = 6,\n                                      top_margin: int = 100,\n                                      bottom_margin: int = 100,\n                                      min_overlap: float = 0.8,\n                                      min_occurrence: int = 2,\n                                      default_region: int = 80):\n    \"\"\"\n    \u81ea\u52a8\u68c0\u6d4bPDF\u6587\u6863\u7684\u9875\u7709\u548c\u9875\u811a\u533a\u57df\n\n    \u53c2\u6570:\n        doc: \u6253\u5f00\u7684PyMuPDF\u6587\u6863\u5bf9\u8c61\n        sample_pages: \u5206\u6790\u7684\u6837\u672c\u9875\u6570\n        top_margin: \u9876\u90e8\u533a\u57df\u9ad8\u5ea6(\u50cf\u7d20)\n        bottom_margin: \u5e95\u90e8\u533a\u57df\u9ad8\u5ea6(\u50cf\u7d20)\n        min_overlap: \u4f4d\u7f6e\u91cd\u53e0\u9608\u503c(0-1)\n        min_occurrence: \u6587\u672c\u5757\u5728\u591a\u9875\u4e2d\u51fa\u73b0\u7684\u6700\u5c0f\u6b21\u6570\n        default_region: \u9ed8\u8ba4\u533a\u57df\u9ad8\u5ea6(\u50cf\u7d20)\n\n    \u8fd4\u56de:\n        header_rect: \u9875\u7709\u533a\u57df\u77e9\u5f62 (pymupdf.Rect)\n        footer_rect: \u9875\u811a\u533a\u57df\u77e9\u5f62 (pymupdf.Rect)\n    \"\"\"\n\n    doc = pymupdf.open(pdf_path)\n    # \u5b58\u50a8\u6240\u6709\u9875\u9762\u7684\u9876\u90e8\u548c\u5e95\u90e8\u6587\u672c\u5757\n    top_blocks = defaultdict(list)\n    bottom_blocks = defaultdict(list)\n\n    # \u5b58\u50a8\u6240\u6709\u9875\u9762\u7684\u9ad8\u5ea6\n    page_heights = []\n\n    # \u5206\u6790\u6837\u672c\u9875\u9762\n    num_pages = min(sample_pages, len(doc))\n    for page_num in range(num_pages):\n        page = doc.load_page(page_num)\n        page_rect = page.rect\n        page_heights.append(page_rect.height)\n\n        # \u5b9a\u4e49\u9876\u90e8\u548c\u5e95\u90e8\u533a\u57df\n        top_zone = pymupdf.Rect(0, 0, page_rect.width, top_margin)\n        bottom_zone = pymupdf.Rect(0, page_rect.height - bottom_margin,\n                                   page_rect.width, page_rect.height)\n\n        # \u83b7\u53d6\u9875\u9762\u6587\u672c\u5757\n        blocks = page.get_text(\"blocks\")\n\n        # \u6536\u96c6\u9876\u90e8\u533a\u57df\u6587\u672c\u5757\n        for block in blocks:\n            x0, y0, x1, y1, text, block_no, block_type = block\n            block_rect = pymupdf.Rect(x0, y0, x1, y1)\n\n            # \u68c0\u67e5\u662f\u5426\u5728\u9876\u90e8\u533a\u57df\n            if block_rect.intersects(top_zone):\n                # \u89c4\u8303\u5316\u4f4d\u7f6e (\u76f8\u5bf9\u4f4d\u7f6e)\n                norm_y = (y0 + y1) / 2 / page_rect.height\n                top_blocks[page_num].append((norm_y, text.strip(), block_rect))\n\n        # \u6536\u96c6\u5e95\u90e8\u533a\u57df\u6587\u672c\u5757\n        for block in blocks:\n            x0, y0, x1, y1, text, block_no, block_type = block\n            block_rect = pymupdf.Rect(x0, y0, x1, y1)\n\n            # \u68c0\u67e5\u662f\u5426\u5728\u5e95\u90e8\u533a\u57df\n            if block_rect.intersects(bottom_zone):\n                # \u89c4\u8303\u5316\u4f4d\u7f6e (\u76f8\u5bf9\u4f4d\u7f6e)\n                norm_y = (y0 + y1) / 2 / page_rect.height\n                bottom_blocks[page_num].append((norm_y, text.strip(), block_rect))\n\n    # \u8ba1\u7b97\u5e73\u5747\u9875\u9762\u9ad8\u5ea6\n    avg_height = np.mean(page_heights) if page_heights else 0\n\n    # \u68c0\u6d4b\u9875\u7709\u533a\u57df\n    header_candidates = detect_common_region(top_blocks, min_occurrence, min_overlap)\n    header_rect = pymupdf.Rect(0, 0, 0, 0)\n\n    if header_candidates:\n        # \u8bbe\u7f6e\u9875\u7709\u533a\u57df\u77e9\u5f62 min( max( [page_top_blocks_max_y1] ), 50 )\n        header_y1 = min(max(cand[2] for cand in header_candidates), default_region)\n        header_rect = pymupdf.Rect(0, 0, page_rect.width, header_y1)\n\n    # \u68c0\u6d4b\u9875\u811a\u533a\u57df\n    footer_candidates = detect_common_region(bottom_blocks, min_occurrence, min_overlap)\n    footer_rect = pymupdf.Rect(0, 0, 0, 0)\n\n    if footer_candidates:\n        # \u8ba1\u7b97\u9875\u811a\u533a\u57df\u7684Y\u8303\u56f4  max( min( [page_bottom_blocks_min_y0] ), page_height-50 )\n        footer_y0 = max(min(cand[1] for cand in footer_candidates), avg_height - default_region)\n        # \u8bbe\u7f6e\u9875\u811a\u533a\u57df\u77e9\u5f62\n        footer_rect = pymupdf.Rect(0, footer_y0, page_rect.width, page_rect.height)\n\n    return header_rect, footer_rect\n\n\ndef detect_common_region(blocks_dict, min_occurrence: int, min_overlap: float):\n    \"\"\"\n    \u68c0\u6d4b\u591a\u4e2a\u9875\u9762\u4e2d\u5171\u540c\u51fa\u73b0\u7684\u6587\u672c\u5757\u533a\u57df\n\n    \u53c2\u6570:\n        blocks_dict: \u9875\u9762\u6587\u672c\u5757\u5b57\u5178 {page_num: [(norm_y, text, rect)]}\n        min_occurrence: \u5728\u591a\u9875\u4e2d\u51fa\u73b0\u7684\u6700\u5c0f\u6b21\u6570\n        min_overlap: \u4f4d\u7f6e\u91cd\u53e0\u9608\u503c\n\n    \u8fd4\u56de:\n        \u5019\u9009\u533a\u57df\u5217\u8868 [(norm_y, min_y, max_y, text)]\n    \"\"\"\n    # \u6309Y\u4f4d\u7f6e\u805a\u7c7b\u6587\u672c\u5757\n    position_clusters = defaultdict(list)\n\n    # \u6536\u96c6\u6240\u6709\u6587\u672c\u5757\u4f4d\u7f6e\n    for page_blocks in blocks_dict.values():\n        for norm_y, text, rect in page_blocks:\n            # \u8df3\u8fc7\u7a7a\u6587\u672c\n            if not text:\n                continue\n            position_clusters[round(norm_y, 3)].append((norm_y, text, rect))\n\n    # \u5408\u5e76\u4f4d\u7f6e\u76f8\u8fd1\u7684\u805a\u7c7b\n    merged_clusters = []\n    positions = sorted(position_clusters.keys())\n    current_cluster = []\n\n    for pos in positions:\n        if not current_cluster:\n            current_cluster = position_clusters[pos]\n            continue\n\n        # \u68c0\u67e5\u4f4d\u7f6e\u662f\u5426\u63a5\u8fd1\n        last_pos = current_cluster[-1][0]\n        if abs(pos - last_pos) &lt;= 0.01:  # \u7ea61%\u9875\u9762\u9ad8\u5ea6\u7684\u5dee\u5f02\n            current_cluster.extend(position_clusters[pos])\n        else:\n            merged_clusters.append(current_cluster)\n            current_cluster = position_clusters[pos]\n\n    if current_cluster:\n        merged_clusters.append(current_cluster)\n\n    # \u627e\u51fa\u5728\u591a\u9875\u4e2d\u51fa\u73b0\u7684\u533a\u57df\n    candidates = []\n    for cluster in merged_clusters:\n        # \u8df3\u8fc7\u51fa\u73b0\u6b21\u6570\u4e0d\u8db3\u7684\u533a\u57df\n        if len(cluster) &lt; min_occurrence:\n            continue\n\n        # \u8ba1\u7b97\u4f4d\u7f6e\u8303\u56f4\n        min_y = min(rect.y0 for _, _, rect in cluster)\n        max_y = max(rect.y1 for _, _, rect in cluster)\n        texts = [text for _, text, _ in cluster]\n\n        # \u8ba1\u7b97\u5e73\u5747\u4f4d\u7f6e\n        avg_y = np.mean([y for y, _, _ in cluster])\n\n        # \u8ba1\u7b97\u6587\u672c\u76f8\u4f3c\u5ea6\n        common_text = find_common_text(texts, min_overlap)\n        if common_text:\n            candidates.append((avg_y, min_y, max_y, common_text))\n\n    return candidates\n\n\ndef find_common_text(texts, min_overlap=0.8):\n    \"\"\"\n    \u5728\u4e00\u7ec4\u6587\u672c\u4e2d\u627e\u51fa\u5171\u540c\u7684\u90e8\u5206\n\n    \u53c2\u6570:\n        texts: \u6587\u672c\u5217\u8868\n        min_overlap: \u6700\u5c0f\u91cd\u53e0\u6bd4\u4f8b\n\n    \u8fd4\u56de:\n        \u5171\u540c\u6587\u672c\u6216None\n    \"\"\"\n    if not texts:\n        return None\n    # \u79fb\u9664\u9875\u7801\n    texts = [extract_and_remove_page_number(text) for text in texts]\n    # \u5982\u679c\u9875\u7801\u53ea\u662f\u6570\u5b57\uff0c\u79fb\u9664\u9875\u7801\u540e\u6587\u672c\u76f8\u540c\uff0c\u5219\u8ba4\u4e3a\u6587\u672c\u91cd\u590d\n    if len(set(texts)) == 1:\n        return f'\u6709\u91cd\u590d\u5185\u5bb9: {set(texts)}'\n\n    # \u4f7f\u7528\u6700\u957f\u6587\u672c\u4f5c\u4e3a\u53c2\u8003\n    reference = max(texts, key=len)\n    common_chars = list(reference)\n\n    # \u68c0\u67e5\u6bcf\u4e2a\u4f4d\u7f6e\u5728\u6240\u6709\u6587\u672c\u4e2d\u662f\u5426\u76f8\u540c\n    for text in texts:\n        if text == reference:\n            continue\n\n        # \u9010\u5b57\u7b26\u6bd4\u8f83\n        for i, char in enumerate(common_chars):\n            if i &gt;= len(text) or text[i] != char:\n                common_chars[i] = None\n\n    # \u6784\u5efa\u5171\u540c\u6587\u672c\n    result = []\n    current_segment = []\n\n    for char in common_chars:\n        if char is not None:\n            current_segment.append(char)\n        elif current_segment:\n            result.append(''.join(current_segment))\n            current_segment = []\n\n    if current_segment:\n        result.append(''.join(current_segment))\n\n    common_text = ' '.join(result).strip()\n\n    # \u68c0\u67e5\u662f\u5426\u6ee1\u8db3\u6700\u5c0f\u91cd\u53e0\u8981\u6c42\n    if common_text and len(common_text) / len(reference) &gt;= min_overlap:\n        return common_text\n\n    return None\n\n\ndef extract_and_remove_page_number(text):\n    \"\"\"\n    \u4ece\u6587\u672c\u4e2d\u8bc6\u522b\u5e76\u5206\u79bb\u9875\u7801\n    \"\"\"\n    # \u5e38\u89c1\u9875\u7801\u6a21\u5f0f\n    patterns = [\n        r'\\b(\\d{1,4})\\b',  # \u7b80\u5355\u6570\u5b57: 1, 23, 456\n        r'[-\u2013\u2014]\\s*(\\d+)\\s*[-\u2013\u2014]',  # \u88c5\u9970\u9875\u7801: - 1 -, \u20132\u2013\n        r'Page\\s*(\\d+)\\s*of\\s*\\d+',  # Page 1 of 10\n        r'\u7b2c\\s*(\\d+)\\s*\u9875',  # \u4e2d\u6587: \u7b2c1\u9875\n        r'\\b([ivxlcdm]+)\\b',  # \u7f57\u9a6c\u6570\u5b57: i, ii, iii\n        r'(\\d+)\\s*/\\s*\\d+'  # \u5206\u6570\u5f62\u5f0f: 1/10\n    ]\n\n    page_number = \"\"\n    cleaned_text = text\n\n    for pattern in patterns:\n        match = re.search(pattern, text)\n        if match:\n            page_number = match.group(1)\n            # \u79fb\u9664\u5339\u914d\u5230\u7684\u6574\u4e2a\u6a21\u5f0f\uff08\u800c\u4e0d\u4ec5\u4ec5\u662f\u6570\u5b57\uff09\uff0c\u4ee5\u6e05\u9664\u5206\u9694\u7b26\n            cleaned_text = cleaned_text.replace(match.group(0), '').strip()\n            break  # \u627e\u5230\u4e00\u4e2a\u5c31\u505c\u6b62\n\n    return cleaned_text\n\n\ndef visualize_regions(pdf_path, out_path, header_rect, footer_rect):\n    \"\"\"\n    \u53ef\u89c6\u5316\u9875\u7709\u548c\u9875\u811a\u533a\u57df\n\n    \u53c2\u6570:\n        pdf_path: PDF\u6587\u4ef6\u8def\u5f84\n        out_path: \u8f93\u51fa\u6587\u4ef6\u8def\u5f84\n        header_rect: \u9875\u7709\u533a\u57df\u77e9\u5f62 (pymupdf.Rect)\n        footer_rect: \u9875\u811a\u533a\u57df\u77e9\u5f62 (pymupdf.Rect)\n    \"\"\"\n    if out_path is None:\n        out_path = pdf_path.replace('.pdf', '_visual.pdf')\n    doc = pymupdf.open(pdf_path)\n    header_rect = pymupdf.Rect(header_rect)\n    footer_rect = pymupdf.Rect(footer_rect)\n    for page in doc:\n        if header_rect.height:\n            page.add_rect_annot(header_rect)\n        if footer_rect.height:\n            page.add_rect_annot(footer_rect)\n\n    doc.save(out_path)\n    print(f\"Visualization saved to {out_path}\")\n    doc.close()\n\n\n# \u4f7f\u7528\u793a\u4f8b\nif __name__ == \"__main__\":\n    pdf_file = \"/Users/xiniao/Downloads/FATF-ME-FATF&amp;MONEYVAL-IL-MER-4-0-201812.pdf\"\n\n    # \u63d0\u53d6\u9875\u7709\u9875\u811a\n    headers, footers = auto_detect_header_footer_regions(pdf_file)\n    print(f\"Header region: {headers}\")\n    print(f\"Footer region: {footers}\")\n    visualize_regions(pdf_file, None, headers, footers)\n</code></pre>"},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/#_5","title":"\u6838\u5fc3\u7b97\u6cd5\u8bf4\u660e","text":"<ol> <li>\u81ea\u52a8\u68c0\u6d4b\u533a\u57df\u6d41\u7a0b\uff1a</li> <li>\u5206\u6790\u524d n \u9875\uff08\u9ed8\u8ba4\u4e3a5\u9875\uff09\u7684\u9876\u90e8\u548c\u5e95\u90e8\u533a\u57df</li> <li>\u6536\u96c6\u8fd9\u4e9b\u533a\u57df\u4e2d\u7684\u6240\u6709\u6587\u672c\u5757\u53ca\u5176\u4f4d\u7f6e</li> <li>\u4f7f\u7528\u89c4\u8303\u5316\u4f4d\u7f6e\uff08\u76f8\u5bf9\u4e8e\u9875\u9762\u9ad8\u5ea6\u7684\u6bd4\u4f8b\uff09\u6765\u5904\u7406\u4e0d\u540c\u5927\u5c0f\u7684\u9875\u9762</li> <li>\u805a\u7c7b\u76f8\u4f3c\u4f4d\u7f6e\u7684\u6587\u672c\u5757</li> <li> <p>\u627e\u51fa\u5728\u591a\u9875\u4e2d\u91cd\u590d\u51fa\u73b0\u7684\u533a\u57df</p> </li> <li> <p>\u6587\u672c\u5757\u805a\u7c7b\uff1a</p> </li> <li>\u6309\u5782\u76f4\u4f4d\u7f6e\u805a\u7c7b\u6587\u672c\u5757\uff08\u4f7f\u7528\u56db\u820d\u4e94\u5165\u5230\u5c0f\u6570\u70b9\u540e3\u4f4d\u7684\u4f4d\u7f6e\uff09</li> <li>\u5408\u5e76\u4f4d\u7f6e\u76f8\u8fd1\u7684\u805a\u7c7b\uff08&lt;1%\u9875\u9762\u9ad8\u5ea6\u7684\u5dee\u5f02\uff09</li> <li> <p>\u4fdd\u7559\u5728\u591a\u9875\u4e2d\u51fa\u73b0\u7684\u805a\u7c7b\uff08\u9ed8\u8ba4\u81f3\u5c112\u9875\uff09</p> </li> <li> <p>\u5171\u540c\u6587\u672c\u63d0\u53d6\uff1a</p> </li> <li>\u4f7f\u7528\u6700\u957f\u6587\u672c\u4f5c\u4e3a\u53c2\u8003</li> <li>\u9010\u5b57\u7b26\u6bd4\u8f83\u627e\u51fa\u5171\u540c\u90e8\u5206</li> <li> <p>\u53ea\u4fdd\u7559\u91cd\u53e0\u6bd4\u4f8b\u8d85\u8fc7\u9608\u503c\uff08\u9ed8\u8ba450%\uff09\u7684\u6587\u672c \uff08\u96be\u70b9\uff0c\u56e0\u4e3a\u5b58\u5728\u9875\u7801\u7b49\u53d8\u5316\u5185\u5bb9\uff0c\u5982\u4f55\u6b63\u786e\u8bc6\u522b\u9875\u7709\u9875\u811a\u533a\u57df\uff09</p> </li> <li> <p>\u533a\u57df\u786e\u5b9a\uff1a</p> </li> <li>\u9875\u7709\u533a\u57df\uff1a<ul> <li><code>header_y0 = 0</code></li> <li><code>header_y1 = min( max( [\u8be5\u9875\u9876\u90e8\u533a\u57df\u6240\u6709\u6587\u672c\u5757\u7684\u6700\u5927y1] for \u6bcf\u4e00\u9875 ), 50)</code>    \u6ce8\u610f\uff1a\u8fd9\u91cc\u6211\u4eec\u53d6\u6bcf\u4e00\u9875\u9876\u90e8\u6587\u672c\u5757\u7684\u6700\u5927y1\uff0c\u7136\u540e\u53d6\u8fd9\u4e9by1\u7684\u6700\u5927\u503c\uff08\u5373\u6700\u9760\u4e0b\u7684\u90a3\u4e2a\uff09\uff0c\u518d\u548c50\u53d6\u6700\u5c0f  \u8fd9\u6837\uff0c\u5982\u679c\u67d0\u4e00\u9875\u7684\u9875\u7709\u5e95\u90e8\u8fb9\u754c\u572840\uff0c\u53e6\u4e00\u9875\u572845\uff0c\u6211\u4eec\u53d645\uff0c\u4f46\u4e0d\u8d85\u8fc750\u3002\u8fd9\u6837\u80fd\u8986\u76d6\u8fd9\u4e24\u9875\u7684\u9875\u7709\u3002</li> </ul> </li> <li>\u9875\u811a\u533a\u57df\uff1a<ul> <li><code>footer_y0 = max( min( [\u8be5\u9875\u5e95\u90e8\u533a\u57df\u6240\u6709\u6587\u672c\u5757\u7684\u6700\u5c0fy0] for \u6bcf\u4e00\u9875 ), page_height-50)</code></li> <li><code>footer_y1 = page_height</code>   \u8fd9\u91cc\u6211\u4eec\u53d6\u6bcf\u4e00\u9875\u5e95\u90e8\u6587\u672c\u5757\u7684\u6700\u5c0fy0\uff0c\u7136\u540e\u53d6\u8fd9\u4e9by0\u7684\u6700\u5c0f\u503c\uff08\u5373\u6700\u9760\u4e0a\u7684\u90a3\u4e2a\uff09\uff0c\u518d\u548cpage_height-50\u53d6\u6700\u5927</li> </ul> </li> </ol>"},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/#_6","title":"\u9ad8\u7ea7\u7279\u6027","text":"<ol> <li>\u81ea\u9002\u5e94\u9875\u9762\u5927\u5c0f\uff1a</li> <li>\u4f7f\u7528\u89c4\u8303\u5316\u4f4d\u7f6e\uff08\u4f4d\u7f6e/\u9875\u9762\u9ad8\u5ea6\uff09\u5904\u7406\u4e0d\u540c\u5927\u5c0f\u7684\u9875\u9762</li> <li> <p>\u63d0\u53d6\u65f6\u6839\u636e\u5f53\u524d\u9875\u9762\u9ad8\u5ea6\u8c03\u6574\u533a\u57df</p> </li> <li> <p>\u667a\u80fd\u6587\u672c\u5206\u6790\uff1a</p> </li> <li>\u627e\u51fa\u6587\u672c\u4e2d\u7684\u5171\u540c\u90e8\u5206\uff0c\u5ffd\u7565\u53d8\u5316\u5185\u5bb9\uff08\u5982\u9875\u7801\uff09</li> <li> <p>\u4f7f\u7528\u91cd\u53e0\u6bd4\u4f8b\u9608\u503c\u8fc7\u6ee4\u566a\u58f0</p> </li> <li> <p>\u53c2\u6570\u53ef\u914d\u7f6e\uff1a</p> </li> <li><code>sample_pages</code>\uff1a\u63a7\u5236\u5206\u6790\u7684\u6837\u672c\u9875\u6570</li> <li><code>top_margin</code>/<code>bottom_margin</code>\uff1a\u5b9a\u4e49\u521d\u59cb\u68c0\u6d4b\u533a\u57df</li> <li><code>min_occurrence</code>\uff1a\u8bbe\u7f6e\u533a\u57df\u5728\u591a\u9875\u4e2d\u51fa\u73b0\u7684\u6700\u5c0f\u6b21\u6570</li> <li><code>min_overlap</code>\uff1a\u8bbe\u7f6e\u6587\u672c\u76f8\u4f3c\u5ea6\u9608\u503c</li> </ol>"},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/#_7","title":"\u4f7f\u7528\u5efa\u8bae","text":"<ol> <li> <p>\u5904\u7406\u590d\u6742\u6587\u6863\uff1a    <pre><code># \u5bf9\u4e8e\u5927\u578b\u6587\u6863\u589e\u52a0\u6837\u672c\u9875\u6570\nheaders, footers = extract_header_footer_with_auto_detection(pdf_file, sample_pages=10)\n\n# \u5bf9\u4e8e\u7279\u6b8a\u5e03\u5c40\u8c03\u6574\u533a\u57df\u5927\u5c0f\nheaders, footers = extract_header_footer_with_auto_detection(\n    pdf_file, \n    top_margin=150,  # \u6269\u5927\u9876\u90e8\u533a\u57df\n    bottom_margin=120  # \u6269\u5927\u5e95\u90e8\u533a\u57df\n)\n</code></pre></p> </li> <li> <p>\u5904\u7406\u5947\u5076\u9875\u4e0d\u540c\u7684\u6587\u6863\uff1a    <pre><code># \u5206\u522b\u5904\u7406\u5947\u5076\u9875\neven_headers = []\nodd_headers = []\n\nfor i, header in enumerate(headers):\n    if i % 2 == 0:  # \u5076\u6570\u9875\n        even_headers.append(header)\n    else:  # \u5947\u6570\u9875\n        odd_headers.append(header)\n</code></pre></p> </li> <li> <p>\u53ef\u89c6\u5316\u68c0\u6d4b\u7ed3\u679c\uff1a    <pre><code> def visualize_regions(pdf_path, out_path, header_rect, footer_rect):\n     \"\"\"\n     \u53ef\u89c6\u5316\u9875\u7709\u548c\u9875\u811a\u533a\u57df\n\n     \u53c2\u6570:\n         pdf_path: PDF\u6587\u4ef6\u8def\u5f84\n         out_path: \u8f93\u51fa\u6587\u4ef6\u8def\u5f84\n         header_rect: \u9875\u7709\u533a\u57df\u77e9\u5f62 (pymupdf.Rect)\n         footer_rect: \u9875\u811a\u533a\u57df\u77e9\u5f62 (pymupdf.Rect)\n     \"\"\"\n     if out_path is None:\n         out_path = pdf_path.replace('.pdf', '_visual.pdf')\n     doc = pymupdf.open(pdf_path)\n     header_rect = pymupdf.Rect(header_rect)\n     footer_rect = pymupdf.Rect(footer_rect)\n     for page in doc:\n         if header_rect.height:\n             page.add_rect_annot(header_rect)\n         if footer_rect.height:\n             page.add_rect_annot(footer_rect)\n\n     doc.save(out_path)\n     print(f\"Visualization saved to {out_path}\")\n     doc.close()\n</code></pre></p> </li> <li> <p>\u5904\u7406\u626b\u63cf\u6587\u6863\uff1a    <pre><code># OCR\u9884\u5904\u7406\u51fd\u6570\uff08\u9700\u5b89\u88c5pytesseract\uff09\ndef ocr_page(page):\n    import pytesseract\n    from PIL import Image\n\n    pix = page.get_pixmap(dpi=200)\n    img = Image.frombytes(\"RGB\", [pix.width, pix.height], pix.samples)\n    return pytesseract.image_to_string(img)\n\n# \u5728\u63d0\u53d6\u524d\u6dfb\u52a0OCR\u5904\u7406\ndoc = fitz.open(pdf_path)\npage = doc.load_page(0)\nif not page.get_text(\"text\"):  # \u68c0\u67e5\u662f\u5426\u6709\u6587\u672c\u5c42\n    ocr_text = ocr_page(page)\n    # \u5c06OCR\u7ed3\u679c\u6dfb\u52a0\u5230\u9875\u9762\uff08\u4f2a\u4ee3\u7801\uff09\n</code></pre></p> </li> </ol>"},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/#_8","title":"\u6ce8\u610f\u4e8b\u9879","text":"<ol> <li>\u9875\u9762\u5927\u5c0f\u53d8\u5316\uff1a</li> <li>\u7b97\u6cd5\u4f7f\u7528\u89c4\u8303\u5316\u4f4d\u7f6e\u5904\u7406\u4e0d\u540c\u5927\u5c0f\u7684\u9875\u9762</li> <li> <p>\u5bf9\u4e8e\u9875\u9762\u5927\u5c0f\u53d8\u5316\u8f83\u5927\u7684\u6587\u6863\uff0c\u7ed3\u679c\u53ef\u80fd\u4e0d\u51c6\u786e</p> </li> <li> <p>\u590d\u6742\u5e03\u5c40\uff1a</p> </li> <li>\u5bf9\u4e8e\u591a\u680f\u5e03\u5c40\u6216\u590d\u6742\u9875\u7709\u9875\u811a\uff0c\u53ef\u80fd\u9700\u8981\u8c03\u6574\u53c2\u6570</li> <li> <p>\u9996\u9875\u548c\u7ae0\u8282\u9875\u53ef\u80fd\u9700\u8981\u7279\u6b8a\u5904\u7406</p> </li> <li> <p>\u6027\u80fd\u8003\u8651\uff1a</p> </li> <li>\u5206\u6790\u5927\u91cf\u9875\u9762\u53ef\u80fd\u5f71\u54cd\u6027\u80fd</li> <li> <p>\u5bf9\u4e8e\u5927\u578b\u6587\u6863\uff0c\u5efa\u8bae\u8bbe\u7f6e\u5408\u7406\u7684sample_pages\u503c</p> </li> <li> <p>\u7279\u6b8a\u5185\u5bb9\uff1a</p> </li> <li>\u6c34\u5370\u6216\u88c5\u9970\u6027\u5143\u7d20\u53ef\u80fd\u88ab\u8bef\u8bc6\u522b\u4e3a\u9875\u7709\u9875\u811a</li> <li>\u8868\u683c\u8de8\u9875\u7684\u8868\u5934\u53ef\u80fd\u88ab\u8bef\u8bc6\u522b\u4e3a\u9875\u7709</li> </ol> <p>\u6b64\u5b9e\u73b0\u63d0\u4f9b\u4e86\u81ea\u52a8\u68c0\u6d4b\u9875\u7709\u9875\u811a\u7684\u5f3a\u5927\u5de5\u5177\uff0c\u4f46\u5b9e\u9645\u5e94\u7528\u4e2d\u53ef\u80fd\u9700\u8981\u6839\u636e\u5177\u4f53\u6587\u6863\u7279\u5f81\u8c03\u6574\u53c2\u6570\u3002\u5bf9\u4e8e\u5173\u952e\u4efb\u52a1\uff0c\u5efa\u8bae\u6dfb\u52a0\u4eba\u5de5\u5ba1\u6838\u73af\u8282\u9a8c\u8bc1\u68c0\u6d4b\u7ed3\u679c\u3002</p>"},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/#pdf_2","title":"PDF\u6587\u4ef6\u9875\u7709\u9875\u811a\u53bb\u9664","text":""},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/#pdf_3","title":"\u53bb\u9664PDF\u9875\u7709\u9875\u811a\u5206\u6790","text":"<p>\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u4f7f\u7528Python\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u80fd\u591f\u8bc6\u522b\u5e76\u53bb\u9664PDF\u7684\u9875\u7709\u548c\u9875\u811a\u3002\u8003\u8651\u5230PDF\u53ef\u80fd\u662f\u6587\u672c\u578b\u6216\u626b\u63cf\u56fe\u50cf\u578b\uff0c\u6211\u4eec\u5c06\u91c7\u53d6\u4ee5\u4e0b\u6b65\u9aa4\uff1a  1. \u5bf9\u4e8e\u6587\u672c\u578bPDF\uff1a\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u5b9a\u4f4d\u9875\u7709\u9875\u811a\u533a\u57df\uff08\u901a\u5e38\u4f4d\u4e8e\u9875\u9762\u9876\u90e8\u548c\u5e95\u90e8\uff09\u7684\u6587\u672c\u6216\u5bf9\u8c61\uff0c\u7136\u540e\u5220\u9664\u6216\u8986\u76d6\u5b83\u4eec\u3002  2. \u5bf9\u4e8e\u626b\u63cf\u56fe\u50cf\u578bPDF\uff1a\u6211\u4eec\u53ef\u80fd\u9700\u8981\u5148\u8fdb\u884cOCR\u8bc6\u522b\uff0c\u4f46\u8fd9\u6837\u6bd4\u8f83\u590d\u6742\u3002\u53e6\u4e00\u79cd\u7b80\u5355\u7684\u65b9\u6cd5\u662f\u4f7f\u7528\u767d\u8272\u77e9\u5f62\u8986\u76d6\u9875\u7709\u9875\u811a\u533a\u57df\uff08\u524d\u63d0\u662f\u9875\u7709\u9875\u811a\u7684\u4f4d\u7f6e\u56fa\u5b9a\uff09\u3002</p> <p>\u8003\u8651\u5230\u590d\u6742\u6027\uff0c\u6211\u4eec\u53ef\u80fd\u53ea\u5904\u7406\u6587\u672c\u578bPDF\uff0c\u5e76\u4e14\u5047\u8bbe\u9875\u7709\u9875\u811a\u662f\u6587\u672c\u3002</p> <p>\u53e6\u5916\uff0c\u6211\u4eec\u53ef\u4ee5\u63d0\u4f9b\u7b2c\u4e09\u79cd\u65b9\u6cd5\uff1a\u8986\u76d6\u6cd5\uff08\u7528\u767d\u8272\u77e9\u5f62\u8986\u76d6\uff09\uff0c\u8fd9\u79cd\u65b9\u6cd5\u5bf9\u4e8e\u626b\u63cf\u4ef6\u4e5f\u9002\u7528\u3002</p> <p>\u5728\u624b\u52a8\u6a21\u5f0f\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u4f7f\u7528\u8986\u76d6\u6cd5\uff08\u7528\u767d\u8272\u77e9\u5f62\uff09\u6216\u8005\u4f7f\u7528redaction\uff08\u5220\u9664\u6587\u672c\uff09\u3002\u5bf9\u4e8e\u626b\u63cf\u4ef6\uff0credaction\u53ef\u80fd\u4e0d\u8d77\u4f5c\u7528\uff0c\u56e0\u4e3a\u626b\u63cf\u4ef6\u4e2d\u7684\u201c\u6587\u672c\u201d\u5b9e\u9645\u4e0a\u662f\u56fe\u50cf\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u7edf\u4e00\u4f7f\u7528\u8986\u76d6\u6cd5\uff08\u5373\u753b\u767d\u8272\u77e9\u5f62\uff09\u6765\u540c\u65f6\u652f\u6301\u6587\u672c\u578b\u548c\u626b\u63cf\u4ef6\u3002</p> <p>\u6ce8\u610f\uff1a\u4f7f\u7528\u7ed8\u56fe\u51fd\u6570\u4f1a\u6dfb\u52a0\u65b0\u7684\u5185\u5bb9\uff0c\u8986\u76d6\u539f\u6709\u5185\u5bb9\u3002 \u793a\u4f8b\u4ee3\u7801\uff08\u624b\u52a8\u6a21\u5f0f\uff09\uff1a   <pre><code>import fitz\ndef remove_header_footer_manual(pdf_path, output_path, header_rect=None, footer_rect=None):\n    doc = fitz.open(pdf_path)\n    for page in doc:\n        # \u83b7\u53d6\u9875\u9762\u7684\u8fb9\u754c\u6846\n        page_rect = page.rect\n        # \u521b\u5efa\u767d\u8272\u77e9\u5f62\u8986\u76d6\u9875\u7709\n        if header_rect is not None:\n            # \u786e\u4fddheader_rect\u662ffitz.Rect\u7c7b\u578b\n            if not isinstance(header_rect, fitz.Rect):\n                header_rect = fitz.Rect(header_rect)\n            # \u7ed8\u5236\u4e00\u4e2a\u767d\u8272\u77e9\u5f62\n            page.draw_rect(header_rect, color=(1,1,1), fill=(1,1,1), overlay=True)\n        # \u521b\u5efa\u767d\u8272\u77e9\u5f62\u8986\u76d6\u9875\u811a\n        if footer_rect is not None:\n            if not isinstance(footer_rect, fitz.Rect):\n                footer_rect = fitz.Rect(footer_rect)\n            page.draw_rect(footer_rect, color=(1,1,1), fill=(1,1,1), overlay=True)\n    doc.save(output_path)\n</code></pre></p>"},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/#_9","title":"\u4ee3\u7801\u5b9e\u73b0","text":"<p>\u4ee5\u4e0b\u662f\u4f7f\u7528Python\u5b9e\u73b0PDF\u9875\u7709\u9875\u811a\u8bc6\u522b\u4e0e\u53bb\u9664\u7684\u5b8c\u6574\u89e3\u51b3\u65b9\u6848\uff0c\u7ed3\u5408\u4e86\u6587\u672c\u5b9a\u4f4d\u3001\u533a\u57df\u68c0\u6d4b\uff1a</p> <pre><code>import re\nimport pymupdf  # PyMuPDF\nimport numpy as np\nfrom collections import defaultdict\n\n\ndef auto_detect_header_footer_regions(pdf_path,\n                                      sample_pages: int = 6,\n                                      header_margin: int = 100,\n                                      footer_margin: int = 100,\n                                      min_overlap: float = 0.5,\n                                      min_occurrence: int = 2,\n                                      default_region: int = 90):\n    \"\"\"\n    \u81ea\u52a8\u68c0\u6d4bPDF\u6587\u6863\u7684\u9875\u7709\u548c\u9875\u811a\u533a\u57df\n\n    \u53c2\u6570:\n        doc: \u6253\u5f00\u7684PyMuPDF\u6587\u6863\u5bf9\u8c61\n        sample_pages: \u5206\u6790\u7684\u6837\u672c\u9875\u6570\n        header_margin: \u9876\u90e8\u533a\u57df\u9ad8\u5ea6(\u50cf\u7d20)\n        footer_margin: \u5e95\u90e8\u533a\u57df\u9ad8\u5ea6(\u50cf\u7d20)\n        min_overlap: \u5185\u5bb9\u91cd\u53e0\u9608\u503c(0-1)\n        min_occurrence: \u6587\u672c\u5757\u5728\u591a\u9875\u4e2d\u51fa\u73b0\u7684\u6700\u5c0f\u6b21\u6570\n        default_region: \u9ed8\u8ba4\u533a\u57df\u9ad8\u5ea6(\u50cf\u7d20)\n\n    \u8fd4\u56de:\n        header_rect: \u9875\u7709\u533a\u57df\u77e9\u5f62 (pymupdf.Rect)\n        footer_rect: \u9875\u811a\u533a\u57df\u77e9\u5f62 (pymupdf.Rect)\n    \"\"\"\n\n    doc = pymupdf.open(pdf_path)\n    # \u5b58\u50a8\u6240\u6709\u9875\u9762\u7684\u9876\u90e8\u548c\u5e95\u90e8\u6587\u672c\u5757\n    top_blocks = defaultdict(list)\n    bottom_blocks = defaultdict(list)\n\n    # \u5b58\u50a8\u6240\u6709\u9875\u9762\u7684\u9ad8\u5ea6\n    page_heights = []\n\n    # \u5206\u6790\u6837\u672c\u9875\u9762\n    num_pages = min(sample_pages, len(doc))\n    # \u5982\u679c\u6ca1\u6709\u9875\u9762\uff0c\u8fd4\u56de\u7a7a\u77e9\u5f62\n    if num_pages == 0:\n        return pymupdf.Rect(0, 0, 0, 0), pymupdf.Rect(0, 0, 0, 0)\n\n    for page_num in range(num_pages):\n        page = doc.load_page(page_num)\n        page_rect = page.rect\n        page_heights.append(page_rect.height)\n\n        # \u5b9a\u4e49\u9876\u90e8\u548c\u5e95\u90e8\u533a\u57df\n        top_zone = pymupdf.Rect(0, 0, page_rect.width, header_margin)\n        bottom_zone = pymupdf.Rect(0, page_rect.height - footer_margin,\n                                   page_rect.width, page_rect.height)\n\n        # \u83b7\u53d6\u9875\u9762\u6587\u672c\u5757\n        blocks = page.get_text(\"blocks\")\n\n        # \u6536\u96c6\u9876\u90e8\u533a\u57df\u6587\u672c\u5757\n        for block in blocks:\n            x0, y0, x1, y1, text, block_no, block_type = block\n            block_rect = pymupdf.Rect(x0, y0, x1, y1)\n\n            # \u68c0\u67e5\u662f\u5426\u5728\u9876\u90e8\u533a\u57df\n            if block_rect.intersects(top_zone):\n                # \u89c4\u8303\u5316\u4f4d\u7f6e (\u76f8\u5bf9\u4f4d\u7f6e)\n                norm_y = (y0 + y1) / 2 / page_rect.height\n                top_blocks[page_num].append((norm_y, text.strip(), block_rect))\n\n        # \u6536\u96c6\u5e95\u90e8\u533a\u57df\u6587\u672c\u5757\n        for block in blocks:\n            x0, y0, x1, y1, text, block_no, block_type = block\n            block_rect = pymupdf.Rect(x0, y0, x1, y1)\n\n            # \u68c0\u67e5\u662f\u5426\u5728\u5e95\u90e8\u533a\u57df\n            if block_rect.intersects(bottom_zone):\n                # \u89c4\u8303\u5316\u4f4d\u7f6e (\u76f8\u5bf9\u4f4d\u7f6e)\n                norm_y = (y0 + y1) / 2 / page_rect.height\n                bottom_blocks[page_num].append((norm_y, text.strip(), block_rect))\n\n    # \u8ba1\u7b97\u5e73\u5747\u9875\u9762\u9ad8\u5ea6\n    avg_height = np.mean(page_heights) if page_heights else 0\n\n    # \u68c0\u6d4b\u9875\u7709\u533a\u57df\n    header_candidates = detect_common_region(top_blocks, min_occurrence, min_overlap)\n    header_rect = pymupdf.Rect(0, 0, 0, 0)\n\n    if header_candidates:\n        # \u8bbe\u7f6e\u9875\u7709\u533a\u57df\u77e9\u5f62 min( max( [page_top_blocks_max_y1] ), 50 )\n        header_y1 = min(max(cand[2] for cand in header_candidates), default_region)\n        header_rect = pymupdf.Rect(0, 0, page_rect.width, header_y1)\n\n    # \u68c0\u6d4b\u9875\u811a\u533a\u57df\n    footer_candidates = detect_common_region(bottom_blocks, min_occurrence, min_overlap)\n    footer_rect = pymupdf.Rect(0, 0, 0, 0)\n\n    if footer_candidates:\n        # \u8ba1\u7b97\u9875\u811a\u533a\u57df\u7684Y\u8303\u56f4  max( min( [page_bottom_blocks_min_y0] ), page_height-50 )\n        footer_y0 = max(min(cand[1] for cand in footer_candidates), avg_height - default_region)\n        # \u8bbe\u7f6e\u9875\u811a\u533a\u57df\u77e9\u5f62\n        footer_rect = pymupdf.Rect(0, footer_y0, page_rect.width, page_rect.height)\n\n    return header_rect, footer_rect\n\n\ndef detect_common_region(blocks_dict, min_occurrence: int, min_overlap: float):\n    \"\"\"\n    \u68c0\u6d4b\u591a\u4e2a\u9875\u9762\u4e2d\u5171\u540c\u51fa\u73b0\u7684\u6587\u672c\u5757\u533a\u57df\n\n    \u53c2\u6570:\n        blocks_dict: \u9875\u9762\u6587\u672c\u5757\u5b57\u5178 {page_num: [(norm_y, text, rect)]}\n        min_occurrence: \u5728\u591a\u9875\u4e2d\u51fa\u73b0\u7684\u6700\u5c0f\u6b21\u6570\n        min_overlap: \u4f4d\u7f6e\u91cd\u53e0\u9608\u503c\n\n    \u8fd4\u56de:\n        \u5019\u9009\u533a\u57df\u5217\u8868 [(norm_y, min_y, max_y, text)]\n    \"\"\"\n    # \u6309Y\u4f4d\u7f6e\u805a\u7c7b\u6587\u672c\u5757\n    position_clusters = defaultdict(list)\n\n    # \u6536\u96c6\u6240\u6709\u6587\u672c\u5757\u4f4d\u7f6e\n    for page_blocks in blocks_dict.values():\n        for norm_y, text, rect in page_blocks:\n            # \u8df3\u8fc7\u7a7a\u6587\u672c\n            if not text:\n                continue\n            position_clusters[round(norm_y, 3)].append((norm_y, text, rect))\n\n    # \u5408\u5e76\u4f4d\u7f6e\u76f8\u8fd1\u7684\u805a\u7c7b\n    merged_clusters = []\n    positions = sorted(position_clusters.keys())\n    current_cluster = []\n\n    for pos in positions:\n        if not current_cluster:\n            current_cluster = position_clusters[pos]\n            continue\n\n        # \u68c0\u67e5\u4f4d\u7f6e\u662f\u5426\u63a5\u8fd1\n        last_pos = current_cluster[-1][0]\n        if abs(pos - last_pos) &lt;= 0.01:  # \u7ea61%\u9875\u9762\u9ad8\u5ea6\u7684\u5dee\u5f02\n            current_cluster.extend(position_clusters[pos])\n        else:\n            merged_clusters.append(current_cluster)\n            current_cluster = position_clusters[pos]\n\n    if current_cluster:\n        merged_clusters.append(current_cluster)\n\n    # \u627e\u51fa\u5728\u591a\u9875\u4e2d\u51fa\u73b0\u7684\u533a\u57df\n    candidates = []\n    for cluster in merged_clusters:\n        # \u8df3\u8fc7\u51fa\u73b0\u6b21\u6570\u4e0d\u8db3\u7684\u533a\u57df\n        if len(cluster) &lt; min_occurrence:\n            continue\n\n        # \u8ba1\u7b97\u4f4d\u7f6e\u8303\u56f4\n        min_y = min(rect.y0 for _, _, rect in cluster)\n        max_y = max(rect.y1 for _, _, rect in cluster)\n        texts = [text for _, text, _ in cluster]\n\n        # \u8ba1\u7b97\u5e73\u5747\u4f4d\u7f6e\n        avg_y = np.mean([y for y, _, _ in cluster])\n\n        # \u8ba1\u7b97\u6587\u672c\u76f8\u4f3c\u5ea6\n        common_text = find_common_text(texts, min_occurrence, min_overlap)\n        if common_text:\n            candidates.append((avg_y, min_y, max_y, common_text))\n\n    return candidates\n\n\ndef longest_common_substring(strs: list[str]):\n    \"\"\"\n    \u627e\u51fa\u5b57\u7b26\u4e32\u5217\u8868\u4e2d\u6700\u957f\u7684\u516c\u5171\u5b50\u4e32\u3002\n\n    \u53c2\u6570:\n    strs: \u5b57\u7b26\u4e32\u5217\u8868\uff0c\u4f8b\u5982 [\"flower\", \"flow\", \"flight\"]\n\n    \u8fd4\u56de:\n    \u6700\u957f\u7684\u516c\u5171\u5b50\u4e32\uff0c\u5982\u679c\u6ca1\u6709\u5219\u8fd4\u56de\u7a7a\u5b57\u7b26\u4e32\u3002\n    \"\"\"\n    if not strs:\n        return \"\"\n    if len(strs) == 1:\n        return strs[0]\n\n    # \u627e\u5230\u6700\u77ed\u5b57\u7b26\u4e32\n    min_str = min(strs, key=len)\n    min_len = len(min_str)\n\n    # \u4ece\u6700\u957f\u957f\u5ea6\u5f00\u59cb\uff0c\u9010\u6b65\u51cf\u5c0f\u957f\u5ea6\n    for length in range(min_len, 0, -1):\n        # \u904d\u5386\u6bcf\u4e2a\u8d77\u59cb\u4f4d\u7f6e\n        for start in range(0, min_len - length + 1):\n            substr = min_str[start:start + length]\n            # \u68c0\u67e5\u5b50\u4e32\u662f\u5426\u5728\u6240\u6709\u5b57\u7b26\u4e32\u4e2d\n            if all(substr in s for s in strs):\n                return substr\n\n    return \"\"  # \u65e0\u516c\u5171\u5b50\u4e32\n\n\ndef find_common_text(texts, min_occurrence=3, min_overlap=0.5):\n    \"\"\"\n    \u5728\u4e00\u7ec4\u6587\u672c\u4e2d\u627e\u51fa\u5171\u540c\u7684\u90e8\u5206\n\n    \u53c2\u6570:\n        texts: \u6587\u672c\u5217\u8868\n        min_overlap: \u6700\u5c0f\u91cd\u53e0\u6bd4\u4f8b\n\n    \u8fd4\u56de:\n        \u5171\u540c\u6587\u672c\u6216None\n    \"\"\"\n    if not texts:\n        return None\n\n    # \u4f7f\u7528\u6700\u957f\u6587\u672c\u4f5c\u4e3a\u53c2\u8003\n    reference = max(texts, key=len)\n    common_text = longest_common_substring(texts)\n\n    overlap_rate = len(common_text) / len(reference)\n    # \u68c0\u67e5\u662f\u5426\u6ee1\u8db3\u6700\u5c0f\u91cd\u53e0\u8981\u6c42\n    if common_text and overlap_rate &gt;= min_overlap:\n        return common_text\n\n    # \u79fb\u9664\u9875\u7801\n    clean_texts = [extract_and_remove_page_number(text) for text in texts]\n    # \u5982\u679c\u6709min_occurrence\u4e2a\u4ee5\u4e0a\u7684\u6587\u672c\u91cd\u590d\uff0c\u5219\u8ba4\u4e3a\u662f\u91cd\u590d\u7684\n    count_text = defaultdict(int)\n    for text in clean_texts:\n        count_text[text] += 1\n\n    for text, count in count_text.items():\n        if count &gt;= min_occurrence:\n            return text\n\n    return None\n\n\ndef extract_and_remove_page_number(text):\n    \"\"\"\n    \u4ece\u6587\u672c\u4e2d\u8bc6\u522b\u5e76\u5206\u79bb\u9875\u7801\n    \"\"\"\n    # \u5e38\u89c1\u9875\u7801\u6a21\u5f0f\n    patterns = [\n        r'\\b(\\d{1,4})\\b',  # \u7b80\u5355\u6570\u5b57: 1, 23, 456\n        r'[-\u2013\u2014]\\s*(\\d+)\\s*[-\u2013\u2014]',  # \u88c5\u9970\u9875\u7801: - 1 -, \u20132\u2013\n        r'Page\\s*(\\d+)\\s*of\\s*\\d+',  # Page 1 of 10\n        r'\u7b2c\\s*(\\d+)\\s*\u9875',  # \u4e2d\u6587: \u7b2c1\u9875\n        r'\\b([ivxlcdm]+)\\b',  # \u7f57\u9a6c\u6570\u5b57: i, ii, iii\n        r'(\\d+)\\s*/\\s*\\d+'  # \u5206\u6570\u5f62\u5f0f: 1/10\n    ]\n    # text\u53bb\u9664\u7279\u6b8a\u5b57\u7b26\n    text = re.sub(r'[^\\w\\s]', '', text)\n    # text\u53bb\u9664\u6570\u5b57\n    text = re.sub(r'\\d+', '', text)\n    page_number = \"\"\n    cleaned_text = text\n\n    for pattern in patterns:\n        match = re.search(pattern, text)\n        if match:\n            page_number = match.group(1)\n            # \u79fb\u9664\u5339\u914d\u5230\u7684\u6574\u4e2a\u6a21\u5f0f\uff08\u800c\u4e0d\u4ec5\u4ec5\u662f\u6570\u5b57\uff09\uff0c\u4ee5\u6e05\u9664\u5206\u9694\u7b26\n            cleaned_text = cleaned_text.replace(match.group(0), '').strip()\n            break  # \u627e\u5230\u4e00\u4e2a\u5c31\u505c\u6b62\n\n    return cleaned_text\n\n\ndef visualize_regions(pdf_path, out_path, header_rect, footer_rect):\n    \"\"\"\n    \u53ef\u89c6\u5316\u9875\u7709\u548c\u9875\u811a\u533a\u57df\n\n    \u53c2\u6570:\n        pdf_path: PDF\u6587\u4ef6\u8def\u5f84\n        out_path: \u8f93\u51fa\u6587\u4ef6\u8def\u5f84\n        header_rect: \u9875\u7709\u533a\u57df\u77e9\u5f62 (pymupdf.Rect)\n        footer_rect: \u9875\u811a\u533a\u57df\u77e9\u5f62 (pymupdf.Rect)\n    \"\"\"\n    if out_path is None:\n        out_path = pdf_path.replace('.pdf', '_visual.pdf')\n    doc = pymupdf.open(pdf_path)\n    header_rect = pymupdf.Rect(header_rect)\n    footer_rect = pymupdf.Rect(footer_rect)\n    for page in doc:\n        if header_rect.height:\n            page.add_rect_annot(header_rect)\n        if footer_rect.height:\n            page.add_rect_annot(footer_rect)\n\n    doc.save(out_path)\n    print(f\"Visualization saved to {out_path}\")\n    doc.close()\n\n\ndef remove_pdf_header_footer(pdf_path, output_path,\n                             header_margin=50, footer_margin=50,\n                             auto_detect=True,\n                             header_rect=None, footer_rect=None,\n                             min_overlap=0.5,\n                             remove_mode='redact'):\n    \"\"\"\n    PDF\u9875\u7709\u9875\u811a\u8bc6\u522b\u4e0e\u53bb\u9664\u5de5\u5177\n\n    \u53c2\u6570:\n    input_path: \u8f93\u5165PDF\u8def\u5f84\n    output_path: \u8f93\u51faPDF\u8def\u5f84\n    header_margin: \u9875\u7709\u68c0\u6d4b\u533a\u57df\u9ad8\u5ea6(\u50cf\u7d20)\u8ddd\u79bb\u9876\u90e8\n    footer_margin: \u9875\u811a\u68c0\u6d4b\u533a\u57df\u9ad8\u5ea6(\u50cf\u7d20)\u8ddd\u79bb\u5e95\u90e8\n    auto_detect: \u662f\u5426\u81ea\u52a8\u68c0\u6d4b\u9875\u7709\u9875\u811a\u533a\u57df\n    header_rect: \u624b\u52a8\u6307\u5b9a\u7684\u9875\u7709\u533a\u57df(x0, y0, x1, y1)\n    footer_rect: \u624b\u52a8\u6307\u5b9a\u7684\u9875\u811a\u533a\u57df(x0, y0, x1, y1)\n    min_overlap: \u5185\u5bb9\u91cd\u53e0\u9608\u503c(0-1)\n    remove_mode: \u53bb\u9664\u6a21\u5f0f('redact'\u5220\u9664\u5185\u5bb9, 'cover'\u767d\u5757\u8986\u76d6)\n    \"\"\"\n\n    doc = pymupdf.open(pdf_path)\n    total_pages = len(doc)\n\n    # \u5982\u679c\u6ca1\u6709\u624b\u52a8\u6307\u5b9a\u533a\u57df\uff0c\u81ea\u52a8\u68c0\u6d4b\n    if auto_detect and (header_rect is None or footer_rect is None):\n        print(f\"\u5f00\u59cb\u81ea\u52a8\u68c0\u6d4b\u9875\u7709\u9875\u811a\u533a\u57df...\")\n        header_rect, footer_rect = auto_detect_header_footer_regions(pdf_path=pdf_path,\n                                                                     header_margin=header_margin,\n                                                                     footer_margin=footer_margin,\n                                                                     min_overlap=min_overlap\n                                                                     )\n        print(f\"\u81ea\u52a8\u68c0\u6d4b\u5b8c\u6210!\")\n        print(f\"Header region: {header_rect}\")\n        print(f\"Footer region: {footer_rect}\")\n\n    # \u5904\u7406\u6240\u6709\u9875\u9762\n    for page_num in range(total_pages):\n        page = doc[page_num]\n\n        if remove_mode == 'redact':\n            # \u4f7f\u7528\u7ea2action\u5220\u9664\u5185\u5bb9\n            if header_rect:\n                page.add_redact_annot(header_rect)\n            if footer_rect:\n                page.add_redact_annot(footer_rect)\n            page.apply_redactions()\n        else:\n            # \u4f7f\u7528\u767d\u5757\u8986\u76d6\n            if header_rect:\n                draw_white_rectangle(page, header_rect)\n            if footer_rect:\n                draw_white_rectangle(page, footer_rect)\n\n    # \u4fdd\u5b58\u5904\u7406\u540e\u7684PDF\n    doc.save(output_path)\n    doc.close()\n    print(f\"\u5904\u7406\u5b8c\u6210! \u8f93\u51fa\u6587\u4ef6: {output_path}\")\n\n\ndef draw_white_rectangle(page, rect):\n    \"\"\"\n    \u7ed8\u5236\u767d\u8272\u77e9\u5f62\u8986\u76d6\u533a\u57df\n    \"\"\"\n    page.draw_rect(rect, color=(1, 1, 1), fill=(1, 1, 1), overlay=True)\n\n\ndef main():\n    # \u4f7f\u7528\u793a\u4f8b\n    input_pdf = \"/Users/xiniao/Downloads/FATF-ME-FATF-TR-MER-4-0-201912.pdf\"\n    output_pdf = \"output.pdf\"\n    # \u81ea\u52a8\u68c0\u6d4b\u9875\u7709\u9875\u811a\u533a\u57df\n    header_rect, footer_rect = auto_detect_header_footer_regions(input_pdf)\n    print(f\"Header region: {header_rect}\")\n    print(f\"Footer region: {footer_rect}\")\n    # \u53ef\u89c6\u5316\u9875\u7709\u9875\u811a\u533a\u57df\n    visualize_regions(input_pdf, output_pdf.replace('.pdf', '_visual.pdf'), header_rect, footer_rect)\n\n    # \u53bb\u9664\u9875\u7709\u9875\u811a\n    remove_pdf_header_footer(input_pdf, output_pdf, header_rect=header_rect, footer_rect=footer_rect)\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/#_10","title":"\u89e3\u51b3\u65b9\u6848\u7279\u70b9","text":"<ol> <li>\u667a\u80fd\u533a\u57df\u68c0\u6d4b</li> <li>\u6587\u672c\u5206\u6790\uff1a\u8bc6\u522b\u9875\u7709\u9875\u811a\u533a\u57df\u7684\u6587\u672c\u5757</li> <li>\u591a\u9875\u91c7\u6837\uff1a\u5206\u6790\u591a\u4e2a\u9875\u9762\u786e\u5b9a\u7a33\u5b9a\u533a\u57df</li> <li>\u654f\u611f\u5ea6\u63a7\u5236\uff1a\u53ef\u8c03\u6574\u68c0\u6d4b\u51c6\u786e\u5ea6</li> <li> <p>\u53ef\u89c6\u5316\uff1a\u63d0\u4f9b\u533a\u57df\u53ef\u89c6\u5316\u5de5\u5177</p> </li> <li> <p>\u4e24\u79cd\u53bb\u9664\u6a21\u5f0f</p> </li> <li>Redact\u6a21\u5f0f\uff1a\u76f4\u63a5\u5220\u9664\u6587\u672c\u5185\u5bb9\uff08\u9002\u5408\u6587\u672c\u578bPDF\uff09</li> <li> <p>Cover\u6a21\u5f0f\uff1a\u7528\u767d\u8272\u77e9\u5f62\u8986\u76d6\uff08\u9002\u5408\u626b\u63cf\u4ef6/\u56fe\u50cf\u578bPDF\uff09</p> </li> <li> <p>\u7075\u6d3b\u7684\u8c03\u7528\u65b9\u5f0f</p> </li> <li>\u5168\u81ea\u52a8\u68c0\u6d4b\uff1a<code>remove_pdf_header_footer(input_pdf, output_pdf)</code></li> <li>\u624b\u52a8\u6307\u5b9a\u533a\u57df\uff1a\u63d0\u4f9bheader_rect\u548cfooter_rect\u53c2\u6570</li> <li>\u6df7\u5408\u6a21\u5f0f\uff1a\u81ea\u52a8\u68c0\u6d4b+\u624b\u52a8\u8c03\u6574</li> </ol>"},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/#_11","title":"\u4f7f\u7528\u793a\u4f8b\uff1a","text":"<pre><code># \u57fa\u672c\u7528\u6cd5\uff08\u5168\u81ea\u52a8\u68c0\u6d4b\uff09\nremove_pdf_header_footer(\"input.pdf\", \"output.pdf\")\n\n# \u6307\u5b9a\u533a\u57df\u6a21\u5f0f\nremove_pdf_header_footer(\n    \"input.pdf\", \n    \"output.pdf\",\n    auto_detect=False,\n    header_rect=(50, 50, 550, 70),  # (x0, y0, x1, y1)\n    footer_rect=(50, 770, 550, 790)\n)\n\n# \u56fe\u50cf\u8986\u76d6\u6a21\u5f0f\uff08\u9002\u5408\u626b\u63cf\u4ef6\uff09\nremove_pdf_header_footer(\n    \"scanned.pdf\", \n    \"cleaned.pdf\",\n    header_rect=(50, 50, 550, 70),  # (x0, y0, x1, y1)\n    footer_rect=(50, 770, 550, 790)\n    remove_mode='cover'\n)\n\n# \u8c03\u6574\u68c0\u6d4b\u654f\u611f\u5ea6\nremove_pdf_header_footer(\n    \"complex.pdf\", \n    \"processed.pdf\",\n    min_overlap=0.3  # \u964d\u4f4e\u91cd\u590d\u5185\u5bb9\u68c0\u6d4b\u654f\u611f\u5ea6\u5e94\u5bf9\u590d\u6742\u5e03\u5c40\n)\n\n\n# \u4f7f\u7528\u793a\u4f8b\ninput_pdf = \"input.pdf\"\noutput_pdf = \"output.pdf\"\n# \u81ea\u52a8\u68c0\u6d4b\u9875\u7709\u9875\u811a\u533a\u57df\nheader_rect, footer_rect = auto_detect_header_footer_regions(input_pdf)\nprint(f\"Header region: {header_rect}\")\nprint(f\"Footer region: {footer_rect}\")\n# \u53ef\u89c6\u5316\u9875\u7709\u9875\u811a\u533a\u57df\nvisualize_regions(input_pdf, output_pdf.replace('.pdf', '_visual.pdf'), header_rect, footer_rect)\n\n# \u53bb\u9664\u9875\u7709\u9875\u811a\nremove_pdf_header_footer(input_pdf, output_pdf, header_rect=header_rect, footer_rect=footer_rect)\n</code></pre>"},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/#_12","title":"\u6548\u679c\u6f14\u793a","text":""},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/#_13","title":"\u793a\u4f8b\u4e00","text":"<p>\u4e0b\u9762\u770b\u4e00\u4e2a\u6bd4\u8f83\u590d\u6742\u7684\u9875\u7709\u9875\u811a\u8bc6\u522b\u7684\u4f8b\u5b50</p> \u7c7b\u578b \u539fPDF\u9875\u811a \u81ea\u52a8\u68c0\u6d4b\u7684\u9875\u811a\u533a\u57df \u53bb\u9664\u9875\u811a\u540e\u7684\u6548\u679c \u7b2c\u4e09\u9875\u793a\u4f8b \u7b2c\u56db\u9875\u793a\u4f8b <p>\u53ef\u4ee5\u770b\u5230\uff0c\u9875\u811a\u7684\u533a\u57df\u6bd4\u8f83\u590d\u6742\uff0c\u5305\u542b\u4e86\u9875\u7801\uff0c\u4e0d\u540c\u9875\u9762\u7684\u9875\u811a\u5185\u5bb9\u4e5f\u4e0d\u540c\uff08\u9875\u7801\u6240\u5728\u7684\u4f4d\u7f6e\u4e0d\u662f\u56fa\u5b9a\u7684\uff09\u3002</p>"},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/#_14","title":"\u793a\u4f8b\u4e8c","text":"\u7c7b\u578b \u539fPDF\u9875\u811a \u81ea\u52a8\u68c0\u6d4b\u7684\u9875\u811a\u533a\u57df \u53bb\u9664\u9875\u811a\u540e\u7684\u6548\u679c \u793a\u4f8b"},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/#_15","title":"\u6280\u672f\u8bf4\u660e\uff1a","text":"<ol> <li> <p>\u5b89\u88c5\u4f9d\u8d56\uff1a    <pre><code>pip install PyMuPDF \n</code></pre></p> </li> <li> <p>\u5904\u7406\u6d41\u7a0b\uff1a</p> </li> <li>\u5206\u6790PDF\u9875\u9762\u7ed3\u6784</li> <li>\u68c0\u6d4b\u9875\u7709\u9875\u811a\u533a\u57df\uff08\u6587\u672c+\u56fe\u50cf\u5206\u6790\uff09</li> <li>\u5e94\u7528\u533a\u57df\u5220\u9664\u6216\u8986\u76d6</li> <li> <p>\u4fdd\u5b58\u5904\u7406\u540e\u7684PDF</p> </li> <li> <p>\u9002\u7528\u573a\u666f\uff1a</p> </li> <li>\u5b66\u672f\u8bba\u6587\u683c\u5f0f\u6574\u7406</li> <li>\u5546\u4e1a\u62a5\u544a\u6807\u51c6\u5316</li> <li>\u6587\u6863\u6570\u5b57\u5316\u5904\u7406</li> <li>PDF\u6279\u91cf\u5904\u7406\u81ea\u52a8\u5316</li> </ol> <p>\u6b64\u89e3\u51b3\u65b9\u6848\u80fd\u6709\u6548\u5904\u7406\u5927\u591a\u6570\u9875\u7709\u9875\u811a\u573a\u666f\uff0c\u5305\u62ec\u52a8\u6001\u9875\u7801\u3001\u516c\u53f8logo\u7b49\u590d\u6742\u5143\u7d20\uff0c\u901a\u8fc7\u8c03\u6574\u53c2\u6570\u53ef\u9002\u5e94\u4e0d\u540cPDF\u683c\u5f0f\u9700\u6c42\u3002</p>"},{"location":"rag/PDF%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E8%AF%86%E5%88%AB%E4%B8%8E%E5%8E%BB%E9%99%A4%E6%96%B9%E6%A1%88/#_16","title":"\u53c2\u8003\u6587\u6863","text":"<ol> <li>PyMuPDF\u57fa\u672c\u4f7f\u7528\u5b98\u65b9\u6559\u7a0b</li> <li>\u7406\u89e3PDF\u8fb9\u754c\u6846(bbox)\u7684\u5750\u6807\u7cfb</li> <li>\u7f16\u8f91PDF\u4e2d\u7684\u5185\u5bb9</li> </ol>"},{"location":"rag/RAG%E6%8A%80%E6%9C%AF%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%E6%8C%91%E6%88%98%E5%88%86%E6%9E%90/","title":"RAG\u6280\u672f\u53ca\u5176\u5e94\u7528\u6311\u6218\u5206\u6790","text":"<p>\u6700\u8fd1\u770b\u4e86\u4e00\u4e9b\u6784\u5efaRAG\u5e94\u7528\u76f8\u5173\u7684\u6587\u7ae0\uff08\u653e\u5728\u540e\u9762\u7684\u53c2\u8003\u6587\u6863\u4e2d\uff09\uff0c\u6709\u4e0b\u9762\u7684\u4e00\u4e9b\u89c2\u70b9\u3002</p> <p>\u6784\u5efa\u4e00\u4e2aRAG\u5e94\u7528\u5f88\u7b80\u5355\uff0c\u628aRAG\u5e94\u7528\u505a\u597d\u5f88\u96be\u3002</p> <p>RAG\u7684\u5c3d\u5934\u662fAgent </p> <p>\u672c\u6587\u5c06\u5bf9\u8fd9\u4e9b\u6587\u6863\u505a\u4e00\u4e2a\u68b3\u7406\uff0c\u7528\u81ea\u5df1\u7406\u89e3\u7684\u65b9\u5f0f\u7ed3\u5408\u5927\u6a21\u578b\u7684\u603b\u7ed3\u5c06\u76f8\u5173\u5185\u5bb9\u8bb0\u5f55\u4e0b\u6765\uff0c\u4e00\u65b9\u9762\uff0c\u5e2e\u52a9\u81ea\u5df1\u5bf9RAG\u5e94\u7528\u6709\u4e00\u4e2a\u66f4\u52a0\u5168\u9762\u7684\u7406\u89e3\uff0c\u53e6\u4e00\u65b9\u9762\uff0c\u53ef\u4ee5\u5e2e\u52a9\u6307\u5bfc\u5982\u4f55\u4f18\u5316RAG\uff0c\u4f7fRAG\u5411\u7740Agent\u7684\u65b9\u5411\u524d\u8fdb\u3002</p> <p>\u672c\u6587\u5c06\u4ece\u5982\u4e0b\u51e0\u4e2a\u65b9\u9762\u8fdb\u884c\u4ecb\u7ecd\uff1a</p> <ul> <li>RAG\u662f\u4ec0\u4e48</li> <li>RAG\u548c\u5fae\u8c03\u5bf9\u6bd4</li> <li>RAG\u7684\u4f18\u52bf/\u9002\u7528\u573a\u666f</li> <li>RAG\u5b58\u5728\u7684\u6311\u6218</li> </ul>"},{"location":"rag/RAG%E6%8A%80%E6%9C%AF%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%E6%8C%91%E6%88%98%E5%88%86%E6%9E%90/#1-rag","title":"1. RAG\u662f\u4ec0\u4e48\uff1f","text":"<ul> <li>\u6838\u5fc3\u6982\u5ff5\uff1a RAG\uff08Retrieval augmented generation\uff09\u662f\u4e00\u79cd\u7ed3\u5408\u4e86\u4fe1\u606f\u68c0\u7d22\u548c\u6587\u672c\u751f\u6210\u7684\u4eba\u5de5\u667a\u80fd\u67b6\u6784\u3002\u5b83\u65e8\u5728\u89e3\u51b3\u5927\u578b\u8bed\u8a00\u6a21\u578b\u56fa\u6709\u7684\u5c40\u9650\u6027\uff0c\u7279\u522b\u662f\u5176\u77e5\u8bc6\u53ef\u80fd\u8fc7\u65f6\u3001\u4e0d\u5b8c\u6574\u6216\u65e0\u6cd5\u8bbf\u95ee\u7279\u5b9a\u79c1\u6709\u6570\u636e\u7684\u95ee\u9898\u3002</li> <li> <p>\u5de5\u4f5c\u539f\u7406\uff1a</p> <ol> <li>\u68c0\u7d22\uff1a \u5f53\u7528\u6237\u8f93\u5165\u4e00\u4e2a\u95ee\u9898\u6216\u6307\u4ee4\u65f6\uff0cRAG\u7cfb\u7edf\u9996\u5148\u5229\u7528\u8fd9\u4e2a\u67e5\u8be2\u53bb\u68c0\u7d22\u4e00\u4e2a\u5916\u90e8\u7684\u3001\u901a\u5e38\u662f\u6d77\u91cf\u7684\u77e5\u8bc6\u5e93\uff08\u5982\u6587\u6863\u96c6\u5408\u3001\u6570\u636e\u5e93\u3001\u7f51\u9875\u7b49\uff09\u3002\u5b83\u4f7f\u7528\u9ad8\u6548\u7684\u68c0\u7d22\u7b97\u6cd5\uff08\u5982\u57fa\u4e8e\u5411\u91cf\u7684\u76f8\u4f3c\u5ea6\u641c\u7d22\uff09\u6765\u627e\u5230\u4e0e\u67e5\u8be2\u6700\u76f8\u5173\u7684\u6587\u672c\u7247\u6bb5\u6216\u6587\u6863\u3002</li> <li>\u589e\u5f3a\uff1a \u68c0\u7d22\u5230\u7684\u76f8\u5173\u6587\u672c\u7247\u6bb5\uff08\u79f0\u4e3a\u201c\u4e0a\u4e0b\u6587\u201d\u6216\u201c\u8bc1\u636e\u201d\uff09\u88ab\u6ce8\u5165\u5230\u53d1\u9001\u7ed9LLM\u7684\u539f\u59cb\u63d0\u793a\u4e2d\u3002\u8fd9\u610f\u5473\u7740LLM\u5728\u751f\u6210\u56de\u7b54\u65f6\uff0c\u4e0d\u4ec5\u80fd\u5229\u7528\u81ea\u8eab\u9884\u8bad\u7ec3\u7684\u77e5\u8bc6\uff0c\u8fd8\u80fd\u201c\u770b\u5230\u201d\u8fd9\u4e9b\u5916\u90e8\u68c0\u7d22\u5230\u7684\u3001\u4e0e\u5f53\u524d\u95ee\u9898\u9ad8\u5ea6\u76f8\u5173\u7684\u5177\u4f53\u4fe1\u606f\u3002</li> <li>\u751f\u6210\uff1a LLM\u57fa\u4e8e\u539f\u59cb\u67e5\u8be2 + \u68c0\u7d22\u5230\u7684\u4e0a\u4e0b\u6587\u8fdb\u884c\u7406\u89e3\u3001\u63a8\u7406\u548c\u6574\u5408\uff0c\u6700\u7ec8\u751f\u6210\u66f4\u51c6\u786e\u3001\u76f8\u5173\u3001\u4fe1\u606f\u4e30\u5bcc\u4e14\u4e8b\u5b9e\u4f9d\u636e\u66f4\u5f3a\u7684\u56de\u7b54\u3002</li> </ol> </li> <li> <p>\u7c7b\u6bd4\uff1a \u60f3\u8c61\u4e00\u4e2a\u5b66\u8005\u5199\u8bba\u6587\u3002\u4ed6\u4e0d\u4f1a\u53ea\u51ed\u8bb0\u5fc6\u5199\uff0c\u800c\u662f\u5148\u53bb\u56fe\u4e66\u9986\uff08\u68c0\u7d22\uff09\u67e5\u627e\u76f8\u5173\u7684\u4e66\u7c4d\u548c\u8bba\u6587\uff08\u83b7\u53d6\u4e0a\u4e0b\u6587\uff09\uff0c\u7136\u540e\u9605\u8bfb\u3001\u7406\u89e3\u548c\u6574\u5408\u8fd9\u4e9b\u8d44\u6599\uff08\u589e\u5f3a\uff09\uff0c\u6700\u540e\u7ed3\u5408\u81ea\u5df1\u7684\u77e5\u8bc6\u548c\u627e\u5230\u7684\u8d44\u6599\u5199\u51fa\u8bba\u6587\uff08\u751f\u6210\uff09\u3002RAG\u5c31\u662f\u8ba9LLM\u5b8c\u6210\u7c7b\u4f3c\u7684\u8fc7\u7a0b\u3002</p> </li> <li> <p>\u57fa\u672c\u6d41\u7a0b\u56fe\uff1a <pre><code>graph TB\n\nretriver[\u68c0\u7d22\uff08Retrieval\uff09] --&gt; augmentation[\u589e\u5f3a\uff08Augmented\uff09]\naugmentation --&gt; generation[\u751f\u6210\uff08Generation\uff09]\n</code></pre></p> </li> </ul>"},{"location":"rag/RAG%E6%8A%80%E6%9C%AF%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%E6%8C%91%E6%88%98%E5%88%86%E6%9E%90/#2-rag","title":"2. RAG\u548c\u5fae\u8c03\u5bf9\u6bd4","text":"\u7279\u6027 RAG (\u68c0\u7d22\u589e\u5f3a\u751f\u6210) \u5fae\u8c03 (Fine-Tuning) \u6838\u5fc3\u673a\u5236 \u8fd0\u884c\u65f6\u68c0\u7d22 + \u63d0\u793a\u589e\u5f3a\uff1a\u6bcf\u6b21\u67e5\u8be2\u65f6\u52a8\u6001\u67e5\u627e\u76f8\u5173\u4fe1\u606f\u5e76\u5165\u63d0\u793a\u3002 \u6a21\u578b\u53c2\u6570\u66f4\u65b0\uff1a\u5728\u7279\u5b9a\u6570\u636e\u96c6\u4e0a\u8bad\u7ec3\u6a21\u578b\uff0c\u8c03\u6574\u5176\u5185\u90e8\u6743\u91cd\u3002 \u77e5\u8bc6\u6765\u6e90 \u5916\u90e8\u77e5\u8bc6\u5e93\uff08\u53ef\u968f\u65f6\u66f4\u65b0\uff09\u3002\u6a21\u578b\u77e5\u8bc6\u662f\u9759\u6001\u57fa\u7840\u3002 \u6a21\u578b\u53c2\u6570\u5185\u90e8\u3002\u77e5\u8bc6\u56fa\u5316\u5728\u66f4\u65b0\u540e\u7684\u6a21\u578b\u4e2d\u3002 \u77e5\u8bc6\u66f4\u65b0 \u5373\u65f6\u3001\u4f4e\u6210\u672c\uff1a\u53ea\u9700\u66f4\u65b0\u77e5\u8bc6\u5e93\uff0c\u65e0\u9700\u6539\u52a8\u6a21\u578b\u672c\u8eab\u3002 \u590d\u6742\u3001\u9ad8\u6210\u672c\uff1a\u9700\u8981\u6536\u96c6\u65b0\u6570\u636e\u3001\u91cd\u65b0\u8bad\u7ec3\u6a21\u578b\u3002 \u6210\u672c \u76f8\u5bf9\u8f83\u4f4e\uff1a\u65e0\u9700\u5927\u89c4\u6a21\u8bad\u7ec3\uff0c\u4e3b\u8981\u6210\u672c\u5728\u68c0\u7d22\u57fa\u7840\u8bbe\u65bd\u548c\u63a8\u7406\u3002 \u76f8\u5bf9\u8f83\u9ad8\uff1a\u9700\u8981\u5927\u91cf\u8ba1\u7b97\u8d44\u6e90\u8fdb\u884c\u8bad\u7ec3\u3002 \u4e8b\u5b9e\u6027/\u5e7b\u89c9 \u901a\u5e38\u66f4\u597d\uff1a\u7b54\u6848\u57fa\u4e8e\u68c0\u7d22\u5230\u7684\u5177\u4f53\u8bc1\u636e\uff0c\u53ef\u8ffd\u6eaf\u6765\u6e90\uff0c\u51cf\u5c11\u5e7b\u89c9\u3002 \u4f9d\u8d56\u6a21\u578b\uff1a\u6a21\u578b\u53ef\u80fd\u57fa\u4e8e\u8fc7\u65f6\u6216\u9519\u8bef\u8bb0\u5fc6\u751f\u6210\u5185\u5bb9\uff0c\u5e7b\u89c9\u98ce\u9669\u4ecd\u5b58\u5728\u3002 \u53ef\u89e3\u91ca\u6027 \u8f83\u9ad8\uff1a\u751f\u6210\u7684\u7b54\u6848\u53ef\u4ee5\u5173\u8054\u56de\u5177\u4f53\u7684\u68c0\u7d22\u6765\u6e90\u7247\u6bb5\u3002 \u8f83\u4f4e\uff1a\u6a21\u578b\u662f\u9ed1\u76d2\uff0c\u96be\u4ee5\u89e3\u91ca\u7b54\u6848\u5177\u4f53\u57fa\u4e8e\u54ea\u4e9b\u4fe1\u606f\u3002 \u64c5\u957f\u9886\u57df \u52a8\u6001\u4fe1\u606f\u3001\u7279\u5b9a\u9886\u57df\u77e5\u8bc6\u3001\u4e8b\u5b9e\u5bc6\u96c6\u578b\u4efb\u52a1\u3001\u9700\u8981\u6eaf\u6e90\u3002 \u5b66\u4e60\u7279\u5b9a\u98ce\u683c\u3001\u590d\u6742\u6a21\u5f0f\u3001\u9886\u57df\u8bed\u8a00\u3001\u4efb\u52a1\u6307\u4ee4\u9075\u5faa\u3002 \u6570\u636e\u9700\u6c42 \u4f9d\u8d56\u9ad8\u8d28\u91cf\u77e5\u8bc6\u5e93\u548c\u68c0\u7d22\u6548\u679c\uff0c\u5bf9\u6807\u6ce8\u6570\u636e\u9700\u6c42\u76f8\u5bf9\u8f83\u4f4e\u3002 \u9700\u8981\u5927\u91cf\u9ad8\u8d28\u91cf\u7684\u9886\u57df\u7279\u5b9a\u6807\u6ce8\u6570\u636e\u3002 \u7075\u6d3b\u6027 \u9ad8\uff1a\u540c\u4e00\u6a21\u578b\u53ef\u8f7b\u677e\u5207\u6362\u4e0d\u540c\u77e5\u8bc6\u5e93\u5e94\u5bf9\u4e0d\u540c\u4efb\u52a1\u3002 \u4f4e\uff1a\u6a21\u578b\u7ed1\u5b9a\u5230\u8bad\u7ec3\u6570\u636e\u4efb\u52a1\uff0c\u5207\u6362\u9700\u91cd\u65b0\u5fae\u8c03\u3002 <p>\u603b\u7ed3\u5bf9\u6bd4\u5173\u952e\u70b9\uff1a *   \u77e5\u8bc6\u65b0\u9c9c\u5ea6 &amp; \u7279\u5b9a\u6027\uff1a RAG \u80dc\u5728\u8bbf\u95ee\u6700\u65b0\u3001\u7279\u5b9a\u3001\u5916\u90e8\u6d77\u91cf\u77e5\u8bc6\uff1b\u5fae\u8c03\u4f9d\u8d56\u6a21\u578b\u5185\u90e8\u5df2\u7f16\u7801\u7684\u77e5\u8bc6\uff08\u8bad\u7ec3\u65f6\u7684\u72b6\u6001\uff09\u3002 *   \u6210\u672c &amp; \u654f\u6377\u6027\uff1a RAG \u66f4\u65b0\u77e5\u8bc6\u66f4\u4fbf\u5b9c\u5feb\u6377\uff1b\u5fae\u8c03\u66f4\u65b0\u6162\u4e14\u8d35\u3002 *   \u4e8b\u5b9e\u6027 &amp; \u53ef\u89e3\u91ca\u6027\uff1a RAG \u901a\u5e38\u63d0\u4f9b\u66f4\u53ef\u9760\u3001\u53ef\u9a8c\u8bc1\u7684\u7b54\u6848\uff1b\u5fae\u8c03\u6a21\u578b\u53ef\u80fd\u201c\u81ea\u4fe1\u5730\u80e1\u8bf4\u201d\u3002 *   \u5b66\u4e60\u80fd\u529b\uff1a \u5fae\u8c03\u80fd\u66f4\u6df1\u5165\u5730\u5b66\u4e60\u7279\u5b9a\u4efb\u52a1\u6a21\u5f0f\u3001\u98ce\u683c\u548c\u590d\u6742\u6307\u4ee4\uff1bRAG \u66f4\u4fa7\u91cd\u4e8e\u5229\u7528\u5916\u90e8\u4fe1\u606f\u589e\u5f3a\u56de\u7b54\u3002</p>"},{"location":"rag/RAG%E6%8A%80%E6%9C%AF%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%E6%8C%91%E6%88%98%E5%88%86%E6%9E%90/#3-rag","title":"3. RAG\u7684\u4f18\u52bf/\u9002\u7528\u573a\u666f","text":"<ul> <li>\u4f18\u52bf\uff1a<ul> <li>\u8bbf\u95ee\u6700\u65b0/\u7279\u5b9a\u77e5\u8bc6\uff1a \u7a81\u7834LLM\u8bad\u7ec3\u6570\u636e\u7684\u65f6\u95f4\u9650\u5236\u548c\u901a\u7528\u6027\u9650\u5236\uff0c\u5229\u7528\u6700\u65b0\u4fe1\u606f\u6216\u4f01\u4e1a\u79c1\u6709\u6570\u636e\u3002</li> <li>\u63d0\u9ad8\u4e8b\u5b9e\u51c6\u786e\u6027\u4e0e\u51cf\u5c11\u5e7b\u89c9\uff1a \u7b54\u6848\u57fa\u4e8e\u68c0\u7d22\u5230\u7684\u5177\u4f53\u8bc1\u636e\uff0c\u964d\u4f4e\u4e86\u6a21\u578b\u7f16\u9020\u4fe1\u606f\u7684\u53ef\u80fd\u6027\u3002</li> <li>\u589e\u5f3a\u7b54\u6848\u76f8\u5173\u6027\uff1a \u786e\u4fdd\u56de\u7b54\u7d27\u6263\u67e5\u8be2\uff0c\u5e76\u5305\u542b\u5177\u4f53\u7ec6\u8282\u3002</li> <li>\u53ef\u89e3\u91ca\u6027\u4e0e\u53ef\u6eaf\u6e90\uff1a \u53ef\u4ee5\u5c55\u793a\u7b54\u6848\u6240\u4f9d\u636e\u7684\u68c0\u7d22\u6765\u6e90\u7247\u6bb5\uff0c\u589e\u52a0\u900f\u660e\u5ea6\u548c\u53ef\u4fe1\u5ea6\u3002</li> <li>\u6210\u672c\u6548\u76ca\uff1a \u65e0\u9700\u9891\u7e41\u91cd\u65b0\u8bad\u7ec3\u6602\u8d35\u7684LLM\uff0c\u66f4\u65b0\u77e5\u8bc6\u53ea\u9700\u7ef4\u62a4\u77e5\u8bc6\u5e93\u3002</li> <li>\u7075\u6d3b\u6027\uff1a \u540c\u4e00\u4e2a\u57fa\u7840LLM\u53ef\u4ee5\u8f7b\u677e\u8fde\u63a5\u5230\u4e0d\u540c\u7684\u77e5\u8bc6\u5e93\uff0c\u670d\u52a1\u4e8e\u591a\u79cd\u4e0d\u540c\u9886\u57df\u6216\u4efb\u52a1\u3002</li> <li>\u964d\u4f4e\u7b97\u529b\u8981\u6c42\uff1a \u76f8\u8f83\u4e8e\u8bad\u7ec3\u8d85\u5927\u6a21\u578b\u5bb9\u7eb3\u6240\u6709\u77e5\u8bc6\uff0cRAG\u5229\u7528\u9ad8\u6548\u68c0\u7d22+\u8f83\u5c0fLLM\u53ef\u80fd\u66f4\u7ecf\u6d4e\u3002</li> </ul> </li> <li>\u9002\u7528\u573a\u666f\uff1a<ul> <li>\u95ee\u7b54\u7cfb\u7edf\uff1a \u9700\u8981\u57fa\u4e8e\u6700\u65b0\u6587\u6863\uff08\u65b0\u95fb\u3001\u7814\u7a76\u8bba\u6587\uff09\u6216\u5185\u90e8\u6587\u6863\uff08\u4f01\u4e1a\u77e5\u8bc6\u5e93\u3001\u4ea7\u54c1\u624b\u518c\uff09\u56de\u7b54\u4e8b\u5b9e\u6027\u95ee\u9898\u3002</li> <li>\u5ba2\u670d\u804a\u5929\u673a\u5668\u4eba\uff1a \u6839\u636e\u4ea7\u54c1\u6587\u6863\u3001FAQ\u3001\u5ba2\u670d\u8bb0\u5f55\u63d0\u4f9b\u51c6\u786e\u3001\u6700\u65b0\u7684\u89e3\u51b3\u65b9\u6848\u3002</li> <li>\u5185\u5bb9\u6458\u8981\uff1a \u9488\u5bf9\u7279\u5b9a\u957f\u6587\u6863\u6216\u6587\u6863\u96c6\u5408\u751f\u6210\u6458\u8981\uff08\u68c0\u7d22\u76f8\u5173\u90e8\u5206\u518d\u603b\u7ed3\uff09\u3002</li> <li>\u7814\u7a76\u62a5\u544a/\u6587\u732e\u7efc\u8ff0\u8f85\u52a9\uff1a \u5feb\u901f\u67e5\u627e\u548c\u6574\u5408\u76f8\u5173\u7814\u7a76\u8d44\u6599\u3002</li> <li>\u4ee3\u7801\u8f85\u52a9/\u6587\u6863\u751f\u6210\uff1a \u6839\u636e\u9879\u76ee\u7279\u5b9a\u4ee3\u7801\u5e93\u6216\u6587\u6863\u751f\u6210\u4ee3\u7801\u7247\u6bb5\u6216\u89e3\u91ca\u3002</li> <li>\u9700\u8981\u9ad8\u4e8b\u5b9e\u6027\u548c\u53ef\u9a8c\u8bc1\u6027\u7684\u9886\u57df\uff1a \u533b\u7597\u54a8\u8be2\uff08\u57fa\u4e8e\u6700\u65b0\u6307\u5357\uff09\u3001\u6cd5\u5f8b\u7814\u7a76\uff08\u57fa\u4e8e\u6cd5\u89c4\u6848\u4f8b\uff09\u3001\u91d1\u878d\u5206\u6790\uff08\u57fa\u4e8e\u62a5\u544a\u6570\u636e\uff09\u3002</li> <li>\u4f01\u4e1a\u77e5\u8bc6\u7ba1\u7406\uff1a \u8ba9\u5458\u5de5\u80fd\u81ea\u7136\u8bed\u8a00\u67e5\u8be2\u5185\u90e8\u6587\u6863\u3001\u624b\u518c\u3001\u4f1a\u8bae\u8bb0\u5f55\u7b49\u3002</li> </ul> </li> </ul>"},{"location":"rag/RAG%E6%8A%80%E6%9C%AF%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%E6%8C%91%E6%88%98%E5%88%86%E6%9E%90/#4-rag","title":"4. RAG\u5b58\u5728\u7684\u6311\u6218","text":"<ul> <li>\u68c0\u7d22\u8d28\u91cf\u662f\u5173\u952e\u74f6\u9888\uff1a<ul> <li>\u68c0\u7d22\u4e0d\u76f8\u5173\uff1a \u68c0\u7d22\u7cfb\u7edf\u672a\u80fd\u627e\u5230\u771f\u6b63\u76f8\u5173\u7684\u6587\u6863\u7247\u6bb5\uff0c\u5bfc\u81f4LLM\u57fa\u4e8e\u9519\u8bef\u4fe1\u606f\u751f\u6210\u7b54\u6848\u3002</li> <li>\u68c0\u7d22\u4e0d\u5b8c\u6574\uff1a \u9057\u6f0f\u4e86\u5173\u952e\u4fe1\u606f\u7247\u6bb5\uff0c\u5bfc\u81f4\u7b54\u6848\u7247\u9762\u6216\u4e0d\u51c6\u786e\u3002</li> <li>\u566a\u58f0\u5e72\u6270\uff1a \u68c0\u7d22\u5230\u7684\u7247\u6bb5\u5305\u542b\u65e0\u5173\u6216\u4f4e\u8d28\u91cf\u4fe1\u606f\uff0c\u5e72\u6270LLM\u751f\u6210\u3002</li> </ul> </li> <li>\u591a\u8df3\u63a8\u7406\u80fd\u529b\u6709\u9650\uff1a \u5bf9\u4e8e\u9700\u8981\u4e32\u8054\u591a\u4e2a\u68c0\u7d22\u6b65\u9aa4\uff08\u68c0\u7d22A -&gt; \u57fa\u4e8eA\u68c0\u7d22B -&gt; \u7efc\u5408A&amp;B\u56de\u7b54\uff09\u7684\u590d\u6742\u95ee\u9898\uff0c\u5f53\u524dRAG\u7cfb\u7edf\u8868\u73b0\u5f80\u5f80\u4e0d\u4f73\u3002</li> <li>\u4e0a\u4e0b\u6587\u957f\u5ea6\u9650\u5236\uff1a LLM\u6709\u8f93\u5165\u957f\u5ea6\u9650\u5236\u3002\u68c0\u7d22\u5230\u8fc7\u591a\u6216\u8fc7\u957f\u7684\u76f8\u5173\u7247\u6bb5\u53ef\u80fd\u65e0\u6cd5\u5168\u90e8\u653e\u5165\u63d0\u793a\u4e2d\uff0c\u9700\u8981\u6709\u6548\u7684\u4fe1\u606f\u538b\u7f29\u6216\u9009\u62e9\u7b56\u7565\uff0c\u53ef\u80fd\u5bfc\u81f4\u4fe1\u606f\u4e22\u5931\u3002</li> <li>\u4fe1\u606f\u6574\u5408\u4e0e\u751f\u6210\u8d28\u91cf\uff1a<ul> <li>\u201c\u6284\u4f5c\u4e1a\u201d\u95ee\u9898\uff1a LLM\u53ef\u80fd\u53ea\u662f\u7b80\u5355\u5730\u590d\u5236\u7c98\u8d34\u68c0\u7d22\u5230\u7684\u7247\u6bb5\uff0c\u7f3a\u4e4f\u6709\u6548\u7684\u6574\u5408\u3001\u91cd\u8ff0\u548c\u63a8\u7406\u3002</li> <li>\u5ffd\u7565\u81ea\u8eab\u77e5\u8bc6\uff1a \u6709\u65f6LLM\u53ef\u80fd\u8fc7\u5206\u4f9d\u8d56\u68c0\u7d22\u5185\u5bb9\uff0c\u800c\u5ffd\u7565\u4e86\u81ea\u8eab\u6709\u7528\u7684\u901a\u7528\u77e5\u8bc6\u3002</li> <li>\u77db\u76fe\u4fe1\u606f\u5904\u7406\uff1a \u5f53\u68c0\u7d22\u5230\u76f8\u4e92\u77db\u76fe\u7684\u8bc1\u636e\u65f6\uff0cLLM\u53ef\u80fd\u65e0\u6cd5\u6709\u6548\u8fa8\u522b\u548c\u8c03\u548c\u3002</li> </ul> </li> <li>\u77e5\u8bc6\u5e93\u6784\u5efa\u4e0e\u7ef4\u62a4\uff1a<ul> <li>\u6210\u672c\u4e0e\u590d\u6742\u6027\uff1a \u6784\u5efa\u9ad8\u8d28\u91cf\u3001\u7ed3\u6784\u826f\u597d\u3001\u8986\u76d6\u9762\u5e7f\u3001\u66f4\u65b0\u53ca\u65f6\u7684\u77e5\u8bc6\u5e93\u672c\u8eab\u662f\u4e00\u9879\u91cd\u5927\u5de5\u7a0b\u3002</li> <li>\u6570\u636e\u8d28\u91cf\uff1a \u77e5\u8bc6\u5e93\u4e2d\u7684\u9519\u8bef\u3001\u8fc7\u65f6\u6216\u504f\u89c1\u4fe1\u606f\u4f1a\u76f4\u63a5\u5f71\u54cdRAG\u7684\u8f93\u51fa\u3002</li> </ul> </li> <li>\u8bc4\u4f30\u56f0\u96be\uff1a \u8bc4\u4f30RAG\u7cfb\u7edf\u6bd4\u8bc4\u4f30\u7eafLLM\u66f4\u590d\u6742\u3002\u9700\u8981\u540c\u65f6\u8bc4\u4f30\u68c0\u7d22\u8d28\u91cf\uff08\u53ec\u56de\u7387\u3001\u51c6\u786e\u7387\uff09\u548c\u751f\u6210\u8d28\u91cf\uff08\u4e8b\u5b9e\u6027\u3001\u76f8\u5173\u6027\u3001\u6d41\u7545\u6027\uff09\uff0c\u4ee5\u53ca\u4e24\u8005\u5982\u4f55\u534f\u540c\u4f5c\u7528\u3002\u4f20\u7edfNLP\u6307\u6807\u53ef\u80fd\u4e0d\u591f\u5168\u9762\u3002</li> <li>\u5ef6\u8fdf\uff1a \u68c0\u7d22\u6b65\u9aa4\u589e\u52a0\u4e86\u6574\u4f53\u54cd\u5e94\u65f6\u95f4\uff0c\u53ef\u80fd\u5f71\u54cd\u7528\u6237\u4f53\u9a8c\uff0c\u5c24\u5176\u662f\u5728\u9700\u8981\u4f4e\u5ef6\u8fdf\u7684\u573a\u666f\u3002</li> <li>\u5b89\u5168\u6027\uff1a \u5982\u679c\u77e5\u8bc6\u5e93\u5305\u542b\u654f\u611f\u6216\u6709\u5bb3\u4fe1\u606f\uff0cRAG\u53ef\u80fd\u65e0\u610f\u4e2d\u5c06\u5176\u68c0\u7d22\u5e76\u6574\u5408\u5230\u8f93\u51fa\u4e2d\u3002</li> </ul>"},{"location":"rag/RAG%E6%8A%80%E6%9C%AF%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%E6%8C%91%E6%88%98%E5%88%86%E6%9E%90/#5-rag","title":"5. \u5982\u4f55\u6784\u5efa\u4e00\u4e2aRAG\u5e94\u7528","text":"<p>\u4ee5\u4e0b\u662f\u4e00\u4e2a\u9488\u5bf9\u524d\u8ff0RAG\u6311\u6218\u8bbe\u8ba1\u7684\u590d\u6742\u4f01\u4e1a\u7ea7RAG\u5e94\u7528\u67b6\u6784\uff0c\u878d\u5408\u524d\u6cbf\u6280\u672f\u89e3\u51b3\u6838\u5fc3\u75db\u70b9\uff1a</p>"},{"location":"rag/RAG%E6%8A%80%E6%9C%AF%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%E6%8C%91%E6%88%98%E5%88%86%E6%9E%90/#_1","title":"\u67b6\u6784\u6838\u5fc3\u8bbe\u8ba1","text":"<pre><code>graph LR\nA[\u7528\u6237\u67e5\u8be2] --&gt; B{\u667a\u80fd\u67e5\u8be2\u8def\u7531\u6a21\u5757}\nB --&gt; C[\u57fa\u7840\u68c0\u7d22\u5c42] \nB --&gt; D[\u590d\u6742\u67e5\u8be2\u89e3\u6790\u5c42]\nC --&gt; E[\u6df7\u5408\u68c0\u7d22\u5f15\u64ce]\nD --&gt; F[\u591a\u8df3\u63a8\u7406\u4ee3\u7406]\nE --&gt; G[\u52a8\u6001\u4e0a\u4e0b\u6587\u538b\u7f29]\nF --&gt; G\nG --&gt; H[LLM\u751f\u6210\u5c42]\nH --&gt; I[\u4e8b\u5b9e\u6838\u67e5\u4e0e\u4fee\u6b63]\nI --&gt; J[\u8f93\u51fa+\u6eaf\u6e90]</code></pre>"},{"location":"rag/RAG%E6%8A%80%E6%9C%AF%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%E6%8C%91%E6%88%98%E5%88%86%E6%9E%90/#_2","title":"\u5173\u952e\u6280\u672f\u65b9\u6848\u4e0e\u6311\u6218\u5e94\u5bf9","text":""},{"location":"rag/RAG%E6%8A%80%E6%9C%AF%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%E6%8C%91%E6%88%98%E5%88%86%E6%9E%90/#1","title":"1. \u6311\u6218\uff1a\u68c0\u7d22\u8d28\u91cf\u74f6\u9888","text":"<ul> <li>\u89e3\u51b3\u65b9\u6848\uff1a  <ul> <li>\u6df7\u5408\u68c0\u7d22\u5f15\u64ce\uff1a <pre><code># \u5e76\u884c\u68c0\u7d22 + \u81ea\u9002\u5e94\u6743\u91cd\u878d\u5408\nretriever = HybridRetriever(\n    vector_store = Milvus(embedding=\"bge-large-zh\", k=10),  # \u7a20\u5bc6\u68c0\u7d22\n    sparse_retriever = Elasticsearch(bm25, k=15),          # \u7a00\u758f\u68c0\u7d22\n    fusion_algorithm = \"RRF\"                               # \u4e92\u9006\u6392\u5e8f\u878d\u5408\n)\n</code></pre></li> <li>\u67e5\u8be2\u6269\u5c55\u6280\u672f\uff1a  </li> <li>\u4f7f\u7528 Query2Doc\uff1aLLM\u6839\u636e\u539f\u59cb\u67e5\u8be2\u751f\u6210\u4f2a\u76f8\u5173\u6587\u6863\uff0c\u6269\u5c55\u68c0\u7d22\u5173\u952e\u8bcd  </li> <li>\u5d4c\u5165 HyDE\uff08\u5047\u8bbe\u6027\u6587\u6863\u5d4c\u5165\uff09\uff1a\u751f\u6210\u5047\u8bbe\u7b54\u6848\u5e76\u4ee5\u5176\u5411\u91cf\u68c0\u7d22  </li> </ul> </li> </ul>"},{"location":"rag/RAG%E6%8A%80%E6%9C%AF%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%E6%8C%91%E6%88%98%E5%88%86%E6%9E%90/#2","title":"2. \u6311\u6218\uff1a\u591a\u8df3\u63a8\u7406\u80fd\u529b\u5f31","text":"<ul> <li>\u89e3\u51b3\u65b9\u6848\uff1a<ul> <li>\u67e5\u8be2\u6539\u5199\uff1a\u5c06\u539f\u59cb\u67e5\u8be2\u8fdb\u884c\u5206\u89e3 \u793a\u4f8b\u6d41\u7a0b\uff1a <code>\u7528\u6237\u95ee\uff1a\u201c\u516c\u53f8A 2023\u5e74\u6bdb\u5229\u7387\u76f8\u6bd4\u7ade\u4e89\u5bf9\u624bB\u7684\u53d8\u5316\u539f\u56e0\uff1f\u201d \u2192 \u5206\u89e3\uff1a1) \u68c0\u7d22A\u7684\u6bdb\u5229\u7387 2) \u68c0\u7d22B\u7684\u6bdb\u5229\u7387 3) \u68c0\u7d22\u884c\u4e1a\u5206\u6790\u62a5\u544a \u2192 \u7efc\u5408\u5bf9\u6bd4</code> </li> <li>\u9012\u5f52\u68c0\u7d22\u4ee3\u7406\uff08Recursive RAG Agent\uff09 <pre><code>agent = MultiHopAgent(\n    step_planner = \"ReAct\",              # \u601d\u7ef4\u94fe\u89c4\u5212\uff1aReason\u2192Act\n    tools = [ \n        Tool(\"\u68c0\u7d222023\u5e74\u62a5\", retriever),  \n        Tool(\"\u8ba1\u7b97\u8d22\u52a1\u6bd4\u7387\", calculator)\n    ],\n    verifier = \"BERT-based NLI\"           # \u9a8c\u8bc1\u4e2d\u95f4\u6b65\u9aa4\u5408\u7406\u6027\n)\n</code></pre></li> </ul> </li> </ul>"},{"location":"rag/RAG%E6%8A%80%E6%9C%AF%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%E6%8C%91%E6%88%98%E5%88%86%E6%9E%90/#3","title":"3. \u6311\u6218\uff1a\u4e0a\u4e0b\u6587\u957f\u5ea6\u9650\u5236","text":"<ul> <li>\u89e3\u51b3\u65b9\u6848\uff1a\u52a8\u6001\u4e0a\u4e0b\u6587\u538b\u7f29 <ul> <li>SummaRerank \u7b56\u7565\uff1a      \u68c0\u7d22Top-50\u6587\u6863\u7247\u6bb5 \u2192 2. \u7528\u5c0f\u578bT5\u6a21\u578b\u751f\u6210\u6bcf\u4e2a\u7247\u6bb5\u6458\u8981 \u2192 3. \u6309\u6458\u8981\u76f8\u5173\u6027\u91cd\u6392 \u2192 4. \u4ec5\u8f93\u5165Top-3\u5b8c\u6574\u7247\u6bb5+\u5176\u4ed6\u6458\u8981  </li> <li>FlashAttention-2 \u4f18\u5316\uff1a    \u4f7f\u7528\u652f\u6301128K\u4e0a\u4e0b\u6587\u7684 DeepSeek-V2 \u6a21\u578b\uff0c\u964d\u4f4e\u957f\u6587\u672c\u5904\u7406\u6210\u672c <p>SummaRerank: \u662f\u4e00\u79cd\u4e13\u95e8\u9488\u5bf9 RAG \u4e0a\u4e0b\u6587\u957f\u5ea6\u9650\u5236\u8bbe\u8ba1\u7684\u52a8\u6001\u4e0a\u4e0b\u6587\u538b\u7f29\u4e0e\u91cd\u6392\u7b56\u7565\uff0c\u5176\u6838\u5fc3\u601d\u60f3\u662f\u901a\u8fc7\u201c\u6458\u8981\u4ee3\u66ff\u539f\u6587\u201d\u6765\u7a81\u7834\u5927\u6a21\u578b\u8f93\u5165\u957f\u5ea6\u9650\u5236\uff0c\u540c\u65f6\u4fdd\u8bc1\u5173\u952e\u4fe1\u606f\u4e0d\u4e22\u5931\u3002</p> </li> </ul> </li> </ul>"},{"location":"rag/RAG%E6%8A%80%E6%9C%AF%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%E6%8C%91%E6%88%98%E5%88%86%E6%9E%90/#4","title":"4. \u6311\u6218\uff1a\u77e5\u8bc6\u5e93\u66f4\u65b0\u5ef6\u8fdf","text":"<ul> <li>\u5b9e\u65f6\u6570\u636e\u7ba1\u9053\uff1a <pre><code>graph TB\nDataSource[\u6570\u636e\u6e90] --&gt;|\u6d88\u606f\u961f\u5217| Stream[\u6d41\u5904\u7406\u5f15\u64ce]\nStream --&gt;|\u589e\u91cf\u66f4\u65b0| VectorDB[\u5411\u91cf\u6570\u636e\u5e93]\nStream --&gt;|\u8bed\u4e49\u89e3\u6790| Graph[\u77e5\u8bc6\u56fe\u8c31]</code></pre><ul> <li>\u652f\u6301\uff1aPDF\u62a5\u544a\u81ea\u52a8\u89e3\u6790\u3001\u7535\u8bdd\u4f1a\u8bae\u8bed\u97f3\u8f6c\u6587\u672c\u3001\u7ec8\u7aefAPI\u5b9e\u65f6\u63a5\u5165  </li> <li>\u7248\u672c\u5316\u77e5\u8bc6\u56fe\u8c31\uff1a\u5b58\u50a8\u5386\u53f2\u4e8b\u5b9e\u5173\u7cfb\uff08\u5982\uff1a\u201c2023Q4\u21922024Q1\u6bdb\u5229\u7387\u53d8\u5316\u201d\uff09</li> </ul> </li> </ul>"},{"location":"rag/RAG%E6%8A%80%E6%9C%AF%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%E6%8C%91%E6%88%98%E5%88%86%E6%9E%90/#5","title":"5. \u6311\u6218\uff1a\u5e7b\u89c9\u4e0e\u4e8b\u5b9e\u6027\u9519\u8bef","text":"<ul> <li>\u4e09\u5c42\u9a8c\u8bc1\u673a\u5236\uff1a  <ol> <li>\u68c0\u7d22\u8bc1\u636e\u6807\u6ce8\uff1a\u751f\u6210\u7b54\u6848\u65f6\u5f3a\u5236\u5f15\u7528\u6765\u6e90ID  </li> <li>\u795e\u7ecf\u903b\u8f91\u63a8\u7406\u5c42\uff1a <pre><code># \u4f7f\u7528DeBERTa-v3\u8bad\u7ec3\u7684\u4e8b\u5b9e\u6838\u67e5\u6a21\u578b\nif FactChecker(query, answer, context).score &lt; 0.8:\n    answer = \"\u6839\u636e\u73b0\u6709\u8d44\u6599\u6682\u65e0\u6cd5\u786e\u8ba4\"\n</code></pre></li> <li>\u8f93\u51fa\u7ea6\u675f\uff1a\u7528 Constrained Decoding \u7981\u6b62\u751f\u6210\u672a\u68c0\u7d22\u5230\u7684\u6570\u5b57\u5b9e\u4f53</li> </ol> </li> </ul>"},{"location":"rag/RAG%E6%8A%80%E6%9C%AF%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%E6%8C%91%E6%88%98%E5%88%86%E6%9E%90/#6","title":"6. \u6311\u6218\uff1a\u8bc4\u4f30\u56f0\u96be","text":"<ul> <li>\u91cf\u5316\u6307\u6807\u4f53\u7cfb\uff1a      | \u6307\u6807                | \u6d4b\u91cf\u5de5\u5177                     |      |---------------------|-----------------------------|      | \u68c0\u7d22\u53ec\u56de\u7387@k        | TREC-style annotation      |      | \u4e8b\u5b9e\u4e00\u81f4\u6027(FActScore) | \u57fa\u4e8e\u77e5\u8bc6\u56fe\u8c31\u7684\u539f\u5b50\u4e8b\u5b9e\u5206\u89e3   |      | \u7528\u6237\u4fee\u6b63\u7387          | \u524d\u7aef\u53cd\u9988\u57cb\u70b9                |      | \u591a\u8df3\u63a8\u7406\u6210\u529f\u7387       | HotpotQA\u8bc4\u6d4b\u96c6\u8fc1\u79fb\u6d4b\u8bd5      |</li> </ul> <p>\u540e\u7eed\u4f1a\u5bf9\u6bcf\u4e00\u4e2a\u6311\u6218\u8fdb\u884c\u8be6\u7ec6\u4ecb\u7ecd\u3002</p>"},{"location":"rag/RAG%E6%8A%80%E6%9C%AF%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%E6%8C%91%E6%88%98%E5%88%86%E6%9E%90/#_3","title":"\u90e8\u7f72\u67b6\u6784","text":"<pre><code>graph TD\n    Client[Web/API\u5ba2\u6237\u7aef] --&gt; Gateway[API\u7f51\u5173]\n    Gateway --&gt; Auth[RBAC\u9274\u6743]\n    Auth --&gt; Cache[Redis\u7f13\u5b58]\n    Cache --&gt; Router[\u67e5\u8be2\u8def\u7531\u5668]\n    Router --&gt;|\u7b80\u5355\u67e5\u8be2| StandardRAG[\u6807\u51c6RAG\u6d41\u7a0b]\n    Router --&gt;|\u590d\u6742\u5206\u6790| Agent[\u591a\u8df3\u4ee3\u7406]\n    StandardRAG --&gt; VectorDB[(\u5411\u91cf\u5e93)]\n    Agent --&gt; Graph[(\u77e5\u8bc6\u56fe\u8c31)]\n    Agent --&gt; Tools[Python\u8ba1\u7b97\u5f15\u64ce]</code></pre>"},{"location":"rag/RAG%E6%8A%80%E6%9C%AF%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%E6%8C%91%E6%88%98%E5%88%86%E6%9E%90/#_4","title":"\u9002\u7528\u573a\u666f\u6269\u5c55","text":"<ol> <li>\u5408\u89c4\u5ba1\u8ba1\uff1a\u81ea\u52a8\u6bd4\u5bf9\u76d1\u7ba1\u6587\u4ef6\u4e0e\u516c\u53f8\u62ab\u9732  </li> <li>\u7d27\u6025\u4e8b\u4ef6\u5206\u6790\uff1a\u5b9e\u65f6\u6293\u53d6\u65b0\u95fb+\u5386\u53f2\u62a5\u544a\u751f\u6210\u5f71\u54cd\u7b80\u62a5  </li> <li>\u6295\u7814\u52a9\u624b\uff1a\u8de8\u6587\u6863\u5bf9\u6bd4\u7ade\u4e89\u5bf9\u624b\u6280\u672f\u8def\u7ebf  </li> </ol> <p>\u901a\u8fc7\u878d\u5408\u591a\u6a21\u6001\u68c0\u7d22\uff08\u56fe\u8868\u6570\u636e\uff09\u4e0e\u8054\u90a6\u5b66\u4e60\uff08\u8de8\u673a\u6784\u5b89\u5168\u534f\u4f5c\uff09\uff0c\u53ef\u8fdb\u4e00\u6b65\u6269\u5c55\u8fb9\u754c\u3002</p>"},{"location":"rag/RAG%E6%8A%80%E6%9C%AF%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%E6%8C%91%E6%88%98%E5%88%86%E6%9E%90/#_5","title":"\u603b\u7ed3","text":"<p>RAG\u662f\u4e00\u79cd\u5f3a\u5927\u7684\u8303\u5f0f\uff0c\u901a\u8fc7\u5c06\u52a8\u6001\u4fe1\u606f\u68c0\u7d22\u4e0eLLM\u7684\u751f\u6210\u80fd\u529b\u76f8\u7ed3\u5408\uff0c\u6709\u6548\u5f25\u8865\u4e86\u7eafLLM\u5728\u77e5\u8bc6\u65f6\u6548\u6027\u3001\u7279\u5b9a\u6027\u548c\u4e8b\u5b9e\u51c6\u786e\u6027\u65b9\u9762\u7684\u4e0d\u8db3\u3002\u5b83\u5728\u9700\u8981\u8bbf\u95ee\u6700\u65b0\u6216\u4e13\u6709\u4fe1\u606f\u3001\u5f3a\u8c03\u7b54\u6848\u53ef\u9a8c\u8bc1\u6027\u548c\u4e8b\u5b9e\u6027\u7684\u573a\u666f\u4e2d\u5177\u6709\u663e\u8457\u4f18\u52bf\uff0c\u4e14\u6210\u672c\u76f8\u5bf9\u53ef\u63a7\u3002\u7136\u800c\uff0c\u5176\u6027\u80fd\u9ad8\u5ea6\u4f9d\u8d56\u4e8e\u68c0\u7d22\u5b50\u7cfb\u7edf\u7684\u8d28\u91cf\uff0c\u5e76\u4e14\u5728\u5904\u7406\u590d\u6742\u63a8\u7406\u3001\u957f\u4e0a\u4e0b\u6587\u6574\u5408\u4ee5\u53ca\u77e5\u8bc6\u5e93\u7ef4\u62a4\u65b9\u9762\u4ecd\u9762\u4e34\u6311\u6218\u3002\u9009\u62e9RAG\u8fd8\u662f\u5fae\u8c03\uff08\u6216\u7ed3\u5408\u4f7f\u7528\uff09\u53d6\u51b3\u4e8e\u5177\u4f53\u7684\u5e94\u7528\u9700\u6c42\u3001\u6570\u636e\u53ef\u7528\u6027\u3001\u6210\u672c\u9884\u7b97\u4ee5\u53ca\u5bf9\u77e5\u8bc6\u65b0\u9c9c\u5ea6\u3001\u4e8b\u5b9e\u6027\u548c\u7075\u6d3b\u6027\u7684\u8981\u6c42\u3002</p> <p>\u53c2\u8003\u6587\u6863</p> <ol> <li>https://python.langchain.com/docs/concepts/rag/</li> <li>ChatGPT\u5e94\u7528\uff1a\u5982\u4f55\u5f81\u670d\u5e02\u573a\u773c\u4e2d\u7684\u201c\u4e07\u80fdRAG\u201d</li> <li>\u5927\u6a21\u578b\u5fae\u8c03\u4e0eRAG\u68c0\u7d22\u589e\u5f3a\u6709\u4f55\u533a\u522b\uff1f\u4e00\u6587\u5168\u9762\u8be6\u89e3-\u4ece\u57fa\u7840\u539f\u7406\u5230\u6848\u4f8b\u5206\u6790</li> <li>\u5927\u5bb6\u89c9\u5f97\u505a\u4e00\u4e2a\u5927\u6a21\u578b\u68c0\u7d22\u589e\u5f3a\u751f\u6210\uff08RAG\uff09\u7cfb\u7edf\uff0c\u6700\u96be\u641e\u5b9a\u7684\u662f\u90a3\u90e8\u5206\u5de5\u4f5c\uff1f</li> <li>https://arxiv.org/pdf/2312.10997</li> </ol>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/","title":"chunk\u5206\u5757\u5b9e\u8df5\u7bc7","text":"<p>RAG \u7684\u5c3d\u5934\u5c31\u662f Agent </p>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#_1","title":"\u6982\u8ff0","text":"<p>\u672c\u6587\u662fchunk\u5206\u5757\u7684\u5b9e\u8df5\u7bc7\uff0cchunk\u5206\u5757\u7684\u7406\u8bba\u53ef\u4ee5\u67e5\u770b\u524d\u4e00\u7bc7\u6587\u7ae0chunk\u5206\u5757\u7406\u8bba\u7bc7\u3002</p> <p>\u63a5\u4e0b\u6765\u4e3b\u8981\u4f7f\u7528 langchain \u63d0\u4f9b\u7684\u5de5\u5177\u5bf9\u524d\u9762\u7684chunk\u5206\u5757\u65b9\u6cd5\u8fdb\u884c\u5b9e\u8df5\uff0c\u4e0b\u9762\u5185\u5bb9\u90fd\u662f\u5728jupyter notebook\u4e2d\u8fdb\u884c\u5b9e\u8df5\u7684\uff0c\u7136\u540e\u5c06\u5185\u5bb9\u8f6c\u6362\u4e3amarkdown\u683c\u5f0f\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u5c06 jupyter notebook \u8f6c\u6362\u4e3a markdown \u683c\u5f0f\u6587\u4ef6\uff1a</p> <ol> <li>\u5b89\u88c5 nbconvert\uff1a<code>pip install nbconvert</code></li> <li>\u6267\u884c\u8f6c\u6362\u547d\u4ee4\uff1a<code>jupyter nbconvert --to markdown your_notebook.ipynb</code> </li> </ol> <p>\u8fdb\u884c\u5b9e\u8df5\u4e4b\u524d\u9700\u8981\u5b89\u88c5\u76f8\u5173\u4f9d\u8d56 </p> <p>\u67e5\u770b\u76f8\u5173\u63a5\u53e3\u6587\u6863\uff1alangchain-text-splitters\u63a5\u53e3\u6587\u6863 </p> <pre><code>pip install -qU langchain-text-splitters\n</code></pre>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#_2","title":"\u6309\u5b57\u7b26\u5206\u5757","text":""},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#_3","title":"\u6309\u5355\u5b57\u7b26\u5206\u5757","text":"<p>\u4f7f\u7528 <code>langchain</code> \u7684 <code>CharacterTextSplitter</code> \u8fd9\u662f\u6700\u7b80\u5355\u7684\u65b9\u6cd5(\u5728\u5e94\u7528\u4e2d\u4e0d\u63a8\u8350\u4f7f\u7528)\uff0c\u5b83\u6839\u636e\u7ed9\u5b9a\u7684\u5b57\u7b26\u5e8f\u5217\u8fdb\u884c\u62c6\u5206\uff0c\u9ed8\u8ba4\u4e3a<code>\\n\\n</code>\uff0cchunk\u957f\u5ea6\u4ee5\u5b57\u7b26\u6570\u6765\u8861\u91cf\u3002</p> <ul> <li>\u6587\u672c\u7684\u5206\u5272\u65b9\u5f0f\uff1a\u6309\u5355\u4e2a\u5b57\u7b26\u5206\u9694\u7b26\u3002</li> <li>\u5982\u4f55\u6d4b\u91cf\u5757\u5927\u5c0f\uff1a\u6309\u5b57\u7b26\u6570\u3002</li> <li>\u8981\u76f4\u63a5\u83b7\u53d6\u5b57\u7b26\u4e32\u5185\u5bb9\uff0c\u4f7f\u7528.split_text\u3002</li> <li>\u8981\u521b\u5efa LangChain Document\u5bf9\u8c61\uff08\u4f8b\u5982\uff0c\u7528\u4e8e\u4e0b\u6e38\u4efb\u52a1\uff09\uff0c\u4f7f\u7528.create_documents\u3002</li> <li>\u5185\u90e8\u4f7f\u7528\u7684\u662f <code>_splits = re.split(f\"({separator})\", text)</code> \u8fdb\u884c\u5b9e\u73b0\u7684</li> </ul> <pre><code>from langchain_text_splitters import CharacterTextSplitter\n\ntext = \"\"\"\n# \u56fa\u5b9a\u957f\u5ea6\u5206\u5757\n\u4f7f\u7528 `langchain` \u7684 `CharacterTextSplitter` \u8fd9\u662f\u6700\u7b80\u5355\u7684\u65b9\u6cd5\uff0c\u5b83\u6839\u636e\u7ed9\u5b9a\u7684\u5b57\u7b26\u5e8f\u5217\u8fdb\u884c\u62c6\u5206\uff0c\u9ed8\u8ba4\u4e3a`\\n\\n`\uff0cchunk\u957f\u5ea6\u4ee5\u5b57\u7b26\u6570\u6765\u8861\u91cf\u3002\n\n- \u6587\u672c\u7684\u5206\u5272\u65b9\u5f0f\uff1a\u6309\u5355\u4e2a\u5b57\u7b26\u5206\u9694\u7b26\u3002\n- \u5982\u4f55\u6d4b\u91cf\u5757\u5927\u5c0f\uff1a\u6309\u5b57\u7b26\u6570\u3002\n- \u8981\u76f4\u63a5\u83b7\u53d6\u5b57\u7b26\u4e32\u5185\u5bb9\uff0c\u4f7f\u7528.split_text\u3002\n- \u8981\u521b\u5efa LangChain Document\u5bf9\u8c61\uff08\u4f8b\u5982\uff0c\u7528\u4e8e\u4e0b\u6e38\u4efb\u52a1\uff09\uff0c\u4f7f\u7528.create_documents\u3002\n- \u5185\u90e8\u4f7f\u7528\u7684\u662f `_splits = re.split(f\"({separator})\", text)` \u8fdb\u884c\u5b9e\u73b0\u7684\n\"\"\"\n\ntext_splitter = CharacterTextSplitter(\n    separator=\"\\n\\n\",\n    chunk_size=100,\n    chunk_overlap=0,\n    length_function=len,\n    is_separator_regex=False,\n)\nchunks = text_splitter.create_documents([text])\nprint(chunks)\n</code></pre> <p>\u8f93\u51fa\u7ed3\u679c\uff1a</p> <pre><code>[Document(metadata={}, page_content='# \u56fa\u5b9a\u957f\u5ea6\u5206\u5757\\n\u4f7f\u7528 `langchain` \u7684 `CharacterTextSplitter` \u8fd9\u662f\u6700\u7b80\u5355\u7684\u65b9\u6cd5\uff0c\u5b83\u6839\u636e\u7ed9\u5b9a\u7684\u5b57\u7b26\u5e8f\u5217\u8fdb\u884c\u62c6\u5206\uff0c\u9ed8\u8ba4\u4e3a`\\n\\n`\uff0cchunk\u957f\u5ea6\u4ee5\u5b57\u7b26\u6570\u6765\u8861\u91cf\u3002'), Document(metadata={}, page_content='- \u6587\u672c\u7684\u5206\u5272\u65b9\u5f0f\uff1a\u6309\u5355\u4e2a\u5b57\u7b26\u5206\u9694\u7b26\u3002\\n- \u5982\u4f55\u6d4b\u91cf\u5757\u5927\u5c0f\uff1a\u6309\u5b57\u7b26\u6570\u3002\\n- \u8981\u76f4\u63a5\u83b7\u53d6\u5b57\u7b26\u4e32\u5185\u5bb9\uff0c\u4f7f\u7528.split_text\u3002\\n- \u8981\u521b\u5efa LangChain Document\u5bf9\u8c61\uff08\u4f8b\u5982\uff0c\u7528\u4e8e\u4e0b\u6e38\u4efb\u52a1\uff09\uff0c\u4f7f\u7528.create_documents\u3002\\n- \u5185\u90e8\u4f7f\u7528\u7684\u662f `_splits = re.split(f\"({separator})\", text)` \u8fdb\u884c\u5b9e\u73b0\u7684')]\n</code></pre> <p>\u8ba9\u6211\u4eec\u6765\u770b\u770b\u4e0a\u9762\u8bbe\u7f6e\u7684\u53c2\u6570\uff1a</p> <ul> <li><code>chunk_size</code>\uff1a\u5757\u7684\u6700\u5927\u5927\u5c0f\uff0c\u5176\u4e2d\u5927\u5c0f\u7531\u51b3\u5b9a <code>length_function</code>\u3002</li> <li><code>chunk_overlap</code>\uff1a\u76ee\u6807\u5757\u4e4b\u95f4\u7684\u91cd\u53e0\u3002\u91cd\u53e0\u5757\u6709\u52a9\u4e8e\u51cf\u5c11\u4e0a\u4e0b\u6587\u5728\u5757\u4e4b\u95f4\u5212\u5206\u65f6\u7684\u4fe1\u606f\u4e22\u5931\u3002</li> <li><code>length_function</code>\uff1a\u786e\u5b9a\u5757\u5927\u5c0f\u7684\u51fd\u6570\uff0c\u9ed8\u8ba4\u4e3a <code>len</code>\u3002</li> <li><code>is_separator_regex</code>\uff1a\u5206\u9694\u7b26\uff08\u9ed8\u8ba4\u4e3a\"\\n\\n\"\uff09\u662f\u5426\u5e94\u89e3\u91ca\u4e3a\u6b63\u5219\u8868\u8fbe\u5f0f\u3002</li> </ul> <p>\u5728\u4f7f\u7528.create_documents\u7684\u4f7f\u7528\uff0c\u6307\u5b9ametadatas\u5c06\u4e0e\u6bcf\u4e2a\u6587\u6863\u5173\u8054\u7684\u5143\u6570\u636e\u4e0echunk\u5173\u8054\uff1a</p> <pre><code>metadatas = [{\"document\": 1}, {\"document\": 2}]\nchunks = text_splitter.create_documents(\n    [text], metadatas=metadatas\n)\nprint(chunks)\n</code></pre> <p>\u8f93\u51fa\u7ed3\u679c\uff1a</p> <pre><code>[Document(metadata={'document': 1}, page_content='# \u56fa\u5b9a\u957f\u5ea6\u5206\u5757\\n\u4f7f\u7528 `langchain` \u7684 `CharacterTextSplitter` \u8fd9\u662f\u6700\u7b80\u5355\u7684\u65b9\u6cd5\uff0c\u5b83\u6839\u636e\u7ed9\u5b9a\u7684\u5b57\u7b26\u5e8f\u5217\u8fdb\u884c\u62c6\u5206\uff0c\u9ed8\u8ba4\u4e3a`\\n\\n`\uff0cchunk\u957f\u5ea6\u4ee5\u5b57\u7b26\u6570\u6765\u8861\u91cf\u3002'), Document(metadata={'document': 1}, page_content='- \u6587\u672c\u7684\u5206\u5272\u65b9\u5f0f\uff1a\u6309\u5355\u4e2a\u5b57\u7b26\u5206\u9694\u7b26\u3002\\n- \u5982\u4f55\u6d4b\u91cf\u5757\u5927\u5c0f\uff1a\u6309\u5b57\u7b26\u6570\u3002\\n- \u8981\u76f4\u63a5\u83b7\u53d6\u5b57\u7b26\u4e32\u5185\u5bb9\uff0c\u4f7f\u7528.split_text\u3002\\n- \u8981\u521b\u5efa LangChain Document\u5bf9\u8c61\uff08\u4f8b\u5982\uff0c\u7528\u4e8e\u4e0b\u6e38\u4efb\u52a1\uff09\uff0c\u4f7f\u7528.create_documents\u3002\\n- \u5185\u90e8\u4f7f\u7528\u7684\u662f `_splits = re.split(f\"({separator})\", text)` \u8fdb\u884c\u5b9e\u73b0\u7684')]\n</code></pre> <p>\u4f7f\u7528.split_text\uff0c\u76f4\u63a5\u83b7\u53d6\u5207\u5206\u540e\u7684\u5b57\u7b26\u4e32\u5185\u5bb9\u5217\u8868</p> <pre><code>text_splitter.split_text(text)\n</code></pre> <p>\u8f93\u51fa\u7ed3\u679c\uff1a</p> <pre><code>['# \u56fa\u5b9a\u957f\u5ea6\u5206\u5757\\n\u4f7f\u7528 `langchain` \u7684 `CharacterTextSplitter` \u8fd9\u662f\u6700\u7b80\u5355\u7684\u65b9\u6cd5\uff0c\u5b83\u6839\u636e\u7ed9\u5b9a\u7684\u5b57\u7b26\u5e8f\u5217\u8fdb\u884c\u62c6\u5206\uff0c\u9ed8\u8ba4\u4e3a`\\n\\n`\uff0cchunk\u957f\u5ea6\u4ee5\u5b57\u7b26\u6570\u6765\u8861\u91cf\u3002',\n '- \u6587\u672c\u7684\u5206\u5272\u65b9\u5f0f\uff1a\u6309\u5355\u4e2a\u5b57\u7b26\u5206\u9694\u7b26\u3002\\n- \u5982\u4f55\u6d4b\u91cf\u5757\u5927\u5c0f\uff1a\u6309\u5b57\u7b26\u6570\u3002\\n- \u8981\u76f4\u63a5\u83b7\u53d6\u5b57\u7b26\u4e32\u5185\u5bb9\uff0c\u4f7f\u7528.split_text\u3002\\n- \u8981\u521b\u5efa LangChain Document\u5bf9\u8c61\uff08\u4f8b\u5982\uff0c\u7528\u4e8e\u4e0b\u6e38\u4efb\u52a1\uff09\uff0c\u4f7f\u7528.create_documents\u3002\\n- \u5185\u90e8\u4f7f\u7528\u7684\u662f `_splits = re.split(f\"({separator})\", text)` \u8fdb\u884c\u5b9e\u73b0\u7684']\n</code></pre>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#_4","title":"\u6309\u591a\u5b57\u7b26\u9012\u5f52\u5206\u5757","text":"<p>\u6587\u672c\u5206\u5272\u5668 <code>RecursiveCharacterTextSplitter</code> \u662f\u63a8\u8350\u7528\u4e8e\u901a\u7528\u6587\u672c\u7684\u5206\u5272\u5668\uff0c\u5b83\u4f1a\u4f7f\u7528\u4e00\u4e2a\u5b57\u7b26\u5217\u8868(\u9ed8\u8ba4\u5217\u8868\u4e3a <code>[\"\\n\\n\", \"\\n\", \" \", \"\"]</code>)\u6309\u987a\u5e8f\u5206\u5272\u6587\u672c\uff0c\u76f4\u5230\u5757\u7684\u5927\u5c0f\u8fbe\u5230\u6307\u5b9a\u957f\u5ea6\u3002\u8fd9\u6837\u505a\u7684\u76ee\u7684\u662f\u5c3d\u53ef\u80fd\u5730\u5c06\u6240\u6709\u6bb5\u843d\uff08\u7136\u540e\u662f\u53e5\u5b50\uff0c\u6700\u540e\u662f\u5355\u8bcd\uff09\u4fdd\u6301\u5728\u4e00\u8d77\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u6bb5\u843d\u901a\u5e38\u770b\u8d77\u6765\u662f\u8bed\u4e49\u4e0a\u6700\u76f8\u5173\u7684\u6587\u672c\u7247\u6bb5\u3002</p> <ul> <li>\u6587\u672c\u7684\u62c6\u5206\u65b9\u5f0f\uff1a\u6309\u5b57\u7b26\u5217\u8868\u3002</li> <li>\u5982\u4f55\u6d4b\u91cf\u5757\u5927\u5c0f\uff1a\u6309\u5b57\u7b26\u6570\u3002</li> </ul> <p>\u4e0b\u9762\u6211\u4eec\u5c55\u793a\u793a\u4f8b\u7528\u6cd5\u3002</p> <ul> <li>\u8981\u76f4\u63a5\u83b7\u53d6\u5b57\u7b26\u4e32\u5185\u5bb9\uff0c\u8bf7\u4f7f\u7528<code>.split_text</code>\u3002</li> <li>\u8981\u521b\u5efa LangChain <code>Document</code>\u5bf9\u8c61\uff08\u4f8b\u5982\uff0c\u7528\u4e8e\u4e0b\u6e38\u4efb\u52a1\uff09\uff0c\u8bf7\u4f7f\u7528 <code>.create_documents</code>\u3002</li> </ul> <pre><code>from langchain_text_splitters import RecursiveCharacterTextSplitter\n\ntext = \"\"\"\n## \u6309\u591a\u5b57\u7b26\u9012\u5f52\u5206\u5757\n\n\u6587\u672c\u5206\u5272\u5668 `RecursiveCharacterTextSplitter` \u662f**\u63a8\u8350\u7528\u4e8e\u901a\u7528\u6587\u672c\u7684\u5206\u5272\u5668**\uff0c\u5b83\u4f1a\u4f7f\u7528\u4e00\u4e2a\u5b57\u7b26\u5217\u8868(\u9ed8\u8ba4\u5217\u8868\u4e3a`[\"\\n\\n\", \"\\n\", \" \", \"\"]`)\u6309\u987a\u5e8f\u5206\u5272\u6587\u672c\uff0c\u76f4\u5230\u5757\u7684\u5927\u5c0f\u8fbe\u5230\u6307\u5b9a\u957f\u5ea6\u3002\u8fd9\u6837\u505a\u7684\u76ee\u7684\u662f\u5c3d\u53ef\u80fd\u5730\u5c06\u6240\u6709\u6bb5\u843d\uff08\u7136\u540e\u662f\u53e5\u5b50\uff0c\u6700\u540e\u662f\u5355\u8bcd\uff09\u4fdd\u6301\u5728\u4e00\u8d77\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u6bb5\u843d\u901a\u5e38\u770b\u8d77\u6765\u662f\u8bed\u4e49\u4e0a\u6700\u76f8\u5173\u7684\u6587\u672c\u7247\u6bb5\u3002\n\n- \u6587\u672c\u7684\u62c6\u5206\u65b9\u5f0f\uff1a\u6309\u5b57\u7b26\u5217\u8868\u3002\n- \u5982\u4f55\u6d4b\u91cf\u5757\u5927\u5c0f\uff1a\u6309\u5b57\u7b26\u6570\u3002\n\n\u4e0b\u9762\u6211\u4eec\u5c55\u793a\u793a\u4f8b\u7528\u6cd5\u3002\n\n- \u8981\u76f4\u63a5\u83b7\u53d6\u5b57\u7b26\u4e32\u5185\u5bb9\uff0c\u8bf7\u4f7f\u7528`.split_text`\u3002\n\n- \u8981\u521b\u5efa LangChain `Document`\u5bf9\u8c61\uff08\u4f8b\u5982\uff0c\u7528\u4e8e\u4e0b\u6e38\u4efb\u52a1\uff09\uff0c\u8bf7\u4f7f\u7528 `.create_documents`\u3002\n\"\"\"\n\ntext_splitter = RecursiveCharacterTextSplitter(\n    # Set a really small chunk size, just to show.\n    chunk_size=70,\n    chunk_overlap=0,\n    length_function=len,\n    is_separator_regex=False,  # \u9ed8\u8ba4\u4e3a False\n)\nchunks = text_splitter.create_documents([text])\nchunks\n</code></pre> <p>\u8f93\u51fa\u7ed3\u679c\uff1a</p> <pre><code>[Document(metadata={}, page_content='## \u6309\u591a\u5b57\u7b26\u9012\u5f52\u5206\u5757'),\n Document(metadata={}, page_content='\u6587\u672c\u5206\u5272\u5668 `RecursiveCharacterTextSplitter`'),\n Document(metadata={}, page_content='\u662f**\u63a8\u8350\u7528\u4e8e\u901a\u7528\u6587\u672c\u7684\u5206\u5272\u5668**\uff0c\u5b83\u4f1a\u4f7f\u7528\u4e00\u4e2a\u5b57\u7b26\u5217\u8868(\u9ed8\u8ba4\u5217\u8868\u4e3a`[\"'),\n Document(metadata={}, page_content='\", \"'),\n Document(metadata={}, page_content='\", \" \",'),\n Document(metadata={}, page_content='\"\"]`)\u6309\u987a\u5e8f\u5206\u5272\u6587\u672c\uff0c\u76f4\u5230\u5757\u7684\u5927\u5c0f\u8fbe\u5230\u6307\u5b9a\u957f\u5ea6\u3002\u8fd9\u6837\u505a\u7684\u76ee\u7684\u662f\u5c3d\u53ef\u80fd\u5730\u5c06\u6240\u6709\u6bb5\u843d\uff08\u7136\u540e\u662f\u53e5\u5b50\uff0c\u6700\u540e\u662f\u5355\u8bcd\uff09\u4fdd\u6301\u5728\u4e00\u8d77\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u6bb5\u843d\u901a\u5e38'),\n Document(metadata={}, page_content='\u770b\u8d77\u6765\u662f\u8bed\u4e49\u4e0a\u6700\u76f8\u5173\u7684\u6587\u672c\u7247\u6bb5\u3002'),\n Document(metadata={}, page_content='- \u6587\u672c\u7684\u62c6\u5206\u65b9\u5f0f\uff1a\u6309\u5b57\u7b26\u5217\u8868\u3002\\n- \u5982\u4f55\u6d4b\u91cf\u5757\u5927\u5c0f\uff1a\u6309\u5b57\u7b26\u6570\u3002\\n\\n\u4e0b\u9762\u6211\u4eec\u5c55\u793a\u793a\u4f8b\u7528\u6cd5\u3002'),\n Document(metadata={}, page_content='- \u8981\u76f4\u63a5\u83b7\u53d6\u5b57\u7b26\u4e32\u5185\u5bb9\uff0c\u8bf7\u4f7f\u7528`.split_text`\u3002'),\n Document(metadata={}, page_content='- \u8981\u521b\u5efa LangChain `Document`\u5bf9\u8c61\uff08\u4f8b\u5982\uff0c\u7528\u4e8e\u4e0b\u6e38\u4efb\u52a1\uff09\uff0c\u8bf7\u4f7f\u7528 `.create_documents`\u3002')]\n</code></pre> <p>\u8ba9\u6211\u4eec\u6765\u770b\u770b\u4e0a\u9762\u8bbe\u7f6e\u7684\u53c2\u6570\uff1a</p> <ul> <li><code>chunk_size</code>\uff1a\u5757\u7684\u6700\u5927\u5927\u5c0f\uff0c\u5176\u4e2d\u5927\u5c0f\u7531\u51b3\u5b9a <code>length_function</code>\u3002</li> <li><code>chunk_overlap</code>\uff1a\u76ee\u6807\u5757\u4e4b\u95f4\u7684\u91cd\u53e0\u3002\u91cd\u53e0\u5757\u6709\u52a9\u4e8e\u51cf\u5c11\u4e0a\u4e0b\u6587\u5728\u5757\u4e4b\u95f4\u5212\u5206\u65f6\u7684\u4fe1\u606f\u4e22\u5931\u3002</li> <li><code>length_function</code>\uff1a\u786e\u5b9a\u5757\u5927\u5c0f\u7684\u51fd\u6570\uff0c\u9ed8\u8ba4\u4e3a <code>len</code>\u3002</li> <li><code>is_separator_regex</code>\uff1a\u5206\u9694\u7b26\u5217\u8868\uff08\u9ed8\u8ba4\u4e3a[\"\\n\\n\", \"\\n\", \" \", \"\"]\uff09\u662f\u5426\u5e94\u89e3\u91ca\u4e3a\u6b63\u5219\u8868\u8fbe\u5f0f\u3002</li> </ul> <p>\u67d0\u4e9b\u6587\u5b57\u6ca1\u6709\u5355\u8bcd\u8fb9\u754c\uff0c\u4f8b\u5982\u4e2d\u6587\u3001\u65e5\u8bed\u548c\u6cf0\u8bed\uff0c\u4f7f\u7528\u9ed8\u8ba4\u5206\u9694\u7b26\u5217\u8868\u62c6\u5206\u6587\u672c[\"\\n\\n\", \"\\n\", \" \", \"\"]\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5355\u8bcd\u88ab\u62c6\u5206\u6210\u591a\u4e2a\u5757\u3002\u4e3a\u4e86\u4fdd\u6301\u5355\u8bcd\u5b8c\u6574\uff0c\u53ef\u4ee5\u8986\u76d6\u5206\u9694\u7b26\u5217\u8868\u4ee5\u6dfb\u52a0\u5176\u4ed6\u6807\u70b9\u7b26\u53f7\u3002</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#_5","title":"\u8bbe\u7f6e\u4e2d\u6587\u573a\u666f\u5206\u9694\u7b26","text":"<p>RecursiveCharacterTextSplitter\u7684\u5de5\u4f5c\u6d41\u7a0b\uff1a\u5b83\u9996\u5148\u5c1d\u8bd5\u7528\u7b2c\u4e00\u4e2a\u5206\u9694\u7b26\u5206\u5272\u6587\u672c\uff0c\u5982\u679c\u751f\u6210\u7684\u5757\u592a\u5927\uff0c\u5c31\u7ee7\u7eed\u7528\u4e0b\u4e00\u4e2a\u5206\u9694\u7b26\u8fdb\u884c\u9012\u5f52\u5206\u5272\uff0c\u76f4\u5230\u6240\u6709\u5757\u90fd\u7b26\u5408\u5927\u5c0f\u8981\u6c42\u3002\u56e0\u6b64\uff0c\u5206\u9694\u7b26\u7684\u987a\u5e8f\u5f88\u91cd\u8981\uff0c\u5e94\u8be5\u4ece\u6700\u81ea\u7136\u7684\u5206\u9694\u7b26\u5f00\u59cb\uff0c\u6bd4\u5982\u6bb5\u843d\u5206\u9694\u7b26\uff0c\u7136\u540e\u662f\u53e5\u5b50\u5206\u9694\u7b26\uff0c\u518d\u662f\u5176\u4ed6\u53ef\u80fd\u7684\u7b26\u53f7\u3002</p> <p>\u4e2d\u6587\u5e38\u7528\u7684\u6bb5\u843d\u5206\u9694\u7b26\u662f\u4e24\u4e2a\u6362\u884c\u7b26\uff08\\n\\n\uff09\uff0c\u800c\u53e5\u5b50\u901a\u5e38\u4ee5\u53e5\u53f7\u3001\u95ee\u53f7\u3001\u611f\u53f9\u53f7\u7ed3\u5c3e\uff0c\u4f46\u4e2d\u6587\u7684\u53e5\u53f7\u662f\u201c\u3002\u201d\uff0c\u4e0d\u540c\u4e8e\u82f1\u6587\u7684\u201c.\u201d\u3002\u56e0\u6b64\uff0c\u5728separators\u4e2d\u5e94\u8be5\u5305\u542b\u8fd9\u4e9b\u4e2d\u6587\u6807\u70b9\u3002\u53e6\u5916\uff0c\u4e2d\u6587\u6709\u65f6\u4e5f\u4f1a\u4f7f\u7528\u5206\u53f7\u3001\u9017\u53f7\u6765\u5206\u9694\uff0c\u4f46\u9017\u53f7\u5206\u9694\u53ef\u80fd\u592a\u7ec6\uff0c\u5bfc\u81f4\u5206\u5757\u8fc7\u5c0f\uff0c\u9700\u8981\u6839\u636e\u5177\u4f53\u60c5\u51b5\u8c03\u6574\u3002</p> <p>\u53ef\u80fd\u8fd8\u9700\u8981\u8003\u8651\u4e00\u4e9b\u7279\u6b8a\u60c5\u51b5\uff0c\u6bd4\u5982\u7701\u7565\u53f7\u201c\u2026\u2026\u201d\uff0c\u6216\u8005\u987f\u53f7\u201c\u3001\u201d\uff0c\u4f46\u8fd9\u4e9b\u53ef\u80fd\u4e0d\u9002\u5408\u4f5c\u4e3a\u5206\u9694\u7b26\uff0c\u56e0\u4e3a\u5206\u5272\u5f97\u592a\u7ec6\u3002\u6b64\u5916\uff0c\u4e2d\u6587\u7684\u5f15\u53f7\u5982\u201c\u201d\u548c\u2018\u2019\u53ef\u80fd\u5305\u56f4\u91cd\u8981\u5185\u5bb9\uff0c\u5206\u5272\u65f6\u9700\u8981\u907f\u514d\u5728\u8fd9\u4e9b\u4f4d\u7f6e\u62c6\u5206\u3002</p> <p>\u56e0\u6b64\uff0c\u5408\u7406\u7684separators\u8bbe\u7f6e\u53ef\u80fd\u662f\u5148\u6309\u6bb5\u843d\u5206\u9694\uff0c\u518d\u6309\u53e5\u5b50\u5206\u9694\uff0c\u7136\u540e\u6309\u5176\u4ed6\u6807\u70b9\u3002\u4f8b\u5982\uff1a<code>[\"\\n\\n\", \"\\n\", \"\u3002\", \"\uff01\", \"\uff1f\", \"\uff1b\", \"\uff0c\"]</code>\uff0c\u4f46\u9700\u8981\u8003\u8651\u5206\u5272\u540e\u7684\u5757\u5927\u5c0f\u662f\u5426\u7b26\u5408chunk_size\u7684\u8981\u6c42\uff0c\u5982\u679c\u4f7f\u7528\u592a\u591a\u5206\u9694\u7b26\uff0c\u53ef\u80fd\u5bfc\u81f4\u9012\u5f52\u5206\u5272\u6b21\u6570\u589e\u52a0\uff0c\u5f71\u54cd\u6548\u7387\u3002</p> <p>\u4e2d\u6587\u573a\u666f\u4e0b\u7684\u63a8\u8350\u8bbe\u7f6e</p> <p>\u9ed8\u8ba4\u7684\u82f1\u6587\u5206\u9694\u7b26\u4e3a <code>[\"\\n\\n\", \"\\n\", \" \", \"\"]</code>\uff0c\u4f46\u4e2d\u6587\u6587\u672c\u5177\u6709\u4ee5\u4e0b\u7279\u70b9\uff1a</p> <ul> <li>\u65e0\u7a7a\u683c\u5206\u8bcd\uff1a\u4e2d\u6587\u8bcd\u8bed\u95f4\u65e0\u7a7a\u683c\u5206\u9694\u3002</li> <li>\u6807\u70b9\u5dee\u5f02\uff1a\u4e2d\u6587\u4f7f\u7528\u5168\u89d2\u6807\u70b9\uff08\u5982 \u3002\uff01\uff1f\uff09\uff0c\u800c\u975e\u82f1\u6587\u534a\u89d2\u6807\u70b9\uff08\u5982 .!?\uff09\u3002</li> <li>\u6bb5\u843d\u7ed3\u6784\uff1a\u6bb5\u843d\u901a\u5e38\u4ee5\u6362\u884c\u7b26\u5206\u9694\u3002</li> </ul> <p>\u4f18\u5316\u540e\u7684\u4e2d\u6587\u5206\u9694\u7b26</p> <pre><code>separators = [\n    \"\\n\\n\",    # \u4f18\u5148\u6309\u6bb5\u843d\u5207\u5206\uff08\u53cc\u6362\u884c\u7b26\uff09\n    \"\\n\",      # \u5176\u6b21\u6309\u5355\u6362\u884c\u7b26\u5207\u5206\n    \"\u3002\",      # \u6309\u53e5\u53f7\u5207\u5206\n    \"\uff01\",      # \u6309\u611f\u53f9\u53f7\u5207\u5206\n    \"\uff1f\",      # \u6309\u95ee\u53f7\u5207\u5206\n    \"\uff1b\",      # \u6309\u5206\u53f7\u5207\u5206\n    \"\uff0c\",      # \u6309\u9017\u53f7\u5207\u5206\uff08\u614e\u7528\uff0c\u53ef\u80fd\u8fc7\u7ec6\uff09\n    \"\u201d\",       # \u6309\u53f3\u5f15\u53f7\u5207\u5206\uff08\u9002\u914d\u5bf9\u8bdd\u573a\u666f\uff09\n    \"\u2026\",       # \u6309\u7701\u7565\u53f7\u5207\u5206\n    \"\",        # \u6700\u540e\u6309\u5b57\u7b26\u5207\u5206\uff08\u4fdd\u5e95\uff09\n]\n</code></pre> <pre><code>from langchain.text_splitter import RecursiveCharacterTextSplitter\n\ntext_splitter = RecursiveCharacterTextSplitter(\n    chunk_size=70,          # \u76ee\u6807\u5757\u5927\u5c0f\uff08\u5355\u4f4d\uff1a\u5b57\u7b26\uff09\n    chunk_overlap=0,        # \u5757\u95f4\u91cd\u53e0\u5b57\u7b26\u6570\n    separators=separators,   # \u81ea\u5b9a\u4e49\u4e2d\u6587\u5206\u9694\u7b26\n    length_function=len,     # \u957f\u5ea6\u8ba1\u7b97\u51fd\u6570\uff08\u6309\u5b57\u7b26\u6570\uff09\n)\n\nchunks = text_splitter.create_documents([text])\nchunks\n</code></pre> <pre><code>[Document(metadata={}, page_content='## \u6309\u591a\u5b57\u7b26\u9012\u5f52\u5206\u5757'),\n Document(metadata={}, page_content='\u6587\u672c\u5206\u5272\u5668 `RecursiveCharacterTextSplitter` \u662f**\u63a8\u8350\u7528\u4e8e\u901a\u7528\u6587\u672c\u7684\u5206\u5272\u5668**'),\n Document(metadata={}, page_content='\uff0c\u5b83\u4f1a\u4f7f\u7528\u4e00\u4e2a\u5b57\u7b26\u5217\u8868(\u9ed8\u8ba4\u5217\u8868\u4e3a`[\"'),\n Document(metadata={}, page_content='\", \"'),\n Document(metadata={}, page_content='\", \" \", \"\"]`)\u6309\u987a\u5e8f\u5206\u5272\u6587\u672c\uff0c\u76f4\u5230\u5757\u7684\u5927\u5c0f\u8fbe\u5230\u6307\u5b9a\u957f\u5ea6'),\n Document(metadata={}, page_content='\u3002\u8fd9\u6837\u505a\u7684\u76ee\u7684\u662f\u5c3d\u53ef\u80fd\u5730\u5c06\u6240\u6709\u6bb5\u843d\uff08\u7136\u540e\u662f\u53e5\u5b50\uff0c\u6700\u540e\u662f\u5355\u8bcd\uff09\u4fdd\u6301\u5728\u4e00\u8d77\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u6bb5\u843d\u901a\u5e38\u770b\u8d77\u6765\u662f\u8bed\u4e49\u4e0a\u6700\u76f8\u5173\u7684\u6587\u672c\u7247\u6bb5\u3002'),\n Document(metadata={}, page_content='- \u6587\u672c\u7684\u62c6\u5206\u65b9\u5f0f\uff1a\u6309\u5b57\u7b26\u5217\u8868\u3002\\n- \u5982\u4f55\u6d4b\u91cf\u5757\u5927\u5c0f\uff1a\u6309\u5b57\u7b26\u6570\u3002\\n\\n\u4e0b\u9762\u6211\u4eec\u5c55\u793a\u793a\u4f8b\u7528\u6cd5\u3002'),\n Document(metadata={}, page_content='- \u8981\u76f4\u63a5\u83b7\u53d6\u5b57\u7b26\u4e32\u5185\u5bb9\uff0c\u8bf7\u4f7f\u7528`.split_text`\u3002'),\n Document(metadata={}, page_content='- \u8981\u521b\u5efa LangChain `Document`\u5bf9\u8c61\uff08\u4f8b\u5982\uff0c\u7528\u4e8e\u4e0b\u6e38\u4efb\u52a1\uff09\uff0c\u8bf7\u4f7f\u7528 `.create_documents`\u3002')]\n</code></pre>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#token","title":"\u6309 token \u5206\u5757","text":"<p>\u8bed\u8a00\u6a21\u578b\u6709 token \u6570\u91cf\u9650\u5236\uff0c\u6211\u4eec\u5728\u4f7f\u7528\u65f6\u4e0d\u5e94\u8d85\u8fc7\u8be5\u9650\u5236\uff0c\u56e0\u6b64\u5728\u5c06\u6587\u672c\u62c6\u5206\u6210\u5757\u65f6\uff0c\u6700\u597d\u8ba1\u7b97 token \u7684\u6570\u91cf\u3002tokenizer \u6709\u5f88\u591a\uff0c\u8ba1\u7b97\u6587\u672c\u4e2d\u7684 token \u6570\u91cf\u65f6\uff0c\u5efa\u8bae\u4f7f\u7528\u4e0e\u8bed\u8a00\u6a21\u578b\u4e2d\u76f8\u540c\u7684tokenizer\uff08\u5728\u6a21\u578b\u4ed3\u5e93\u4e2d\u6a21\u578b\u6587\u4ef6\u548c tokenizer \u6587\u4ef6\u653e\u5728\u4e00\u8d77\u7684\uff09\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 tokenizer \u6765\u8ba1\u7b97\u6587\u672c\u4e2d\u7684 token \u957f\u5ea6\uff0c\u6309\u7167 token \u5207\u5206\u7684\u903b\u8f91\u5982\u4e0b\uff1a</p> <ul> <li>\u6587\u672c\u7684\u5206\u5272\u65b9\u5f0f\uff1a\u6309\u4f20\u5165\u7684\u5b57\u7b26\u3002</li> <li>\u5982\u4f55\u6d4b\u91cf\u5757\u5927\u5c0f\uff1a\u901a\u8fc7 <code>len(tokenizer.tokenize(text))</code> \u8ba1\u7b97\u7684 token \u6570\u3002</li> </ul> <p>\u6309 token \u5206\u5757\u6b65\u9aa4\uff1a</p> <ul> <li>\u4e0b\u8f7d tokenizer\uff0c\u56e0\u4e3a\u5728\u56fd\u5185\u65e0\u6cd5\u76f4\u63a5\u8bbf\u95ee HuggingFace\uff0c\u6240\u4ee5\u8fd9\u91cc\u4ece modelscope \u4e2d\u7684\u6a21\u578b\u4ed3\u5e93\u4e2d\u4e0b\u8f7d\uff0c\u53ea\u9700\u8981\u4e0b\u8f7d tokenizer \u6587\u4ef6\uff0c\u4e0d\u9700\u8981\u4e0b\u8f7d\u6a21\u578b\u6587\u4ef6\uff08<code>*.bin</code>, <code>*.safetensors</code>\u7ed3\u5c3e\u7684\u6587\u4ef6\u662f\u6a21\u578b\u6587\u4ef6\uff09</li> <li>\u4f7f\u7528 <code>AutoTokenizer.from_pretrained</code> \u52a0\u8f7d tokenizer </li> <li>\u4f7f\u7528 <code>TextSplitter.from_huggingface_tokenizer</code>\u65b9\u6cd5\u6307\u5b9a <code>tokenizer</code> \u53c2\u6570\uff0c\u5176\u4ed6\u53c2\u6570\u4e0e\u524d\u9762\u7684\u76f8\u540c</li> </ul>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#modelscope-tokenizer","title":"\u4ece modelscope \u4e0b\u8f7d tokenizer","text":"<pre><code># \u4ece modelscope \u4e0b\u8f7d tokenizer\nfrom typing import List\nimport logging\nlogger = logging.getLogger(__name__)\n\ndef download_from_modelscope(model_id: str,\n                             local_dir: str = None,\n                             ignore_patterns: List[str] =None,\n                             **kwargs\n                             ):\n    \"\"\"\n    \u4ecemodelscope\u4e0b\u8f7d\u6a21\u578b\n\n    \u5982\u4f55\u6ca1\u6709\u6307\u5b9alocal_dir\uff0c\u9ed8\u8ba4\u4fdd\u5b58\u6a21\u578b\u6587\u4ef6\u5230 ~/.cache/modelscope/hub/models/ \u6587\u4ef6\u5939\u4e2d\n    modelscope \u5730\u5740\uff1ahttps://modelscope.cn/models\n    \"\"\"\n    from modelscope.hub.snapshot_download import snapshot_download\n\n    logger.info(f\"\u5f00\u59cb\u4e0b\u8f7d\u6a21\u578b: {model_id}\")\n\n    model_dir = snapshot_download(model_id=model_id,\n                                  local_dir=local_dir,\n                                  ignore_patterns=ignore_patterns,\n                                  **kwargs)\n    logger.info(f\"\u6a21\u578b\u4e0b\u8f7d\u5b8c\u6210\u4fdd\u5b58\u76ee\u5f55: {model_dir}\")\n    return model_dir\n\nmodelscope_args = {\n    # \u53ef\u914d\u7f6e\u53c2\u6570\uff0c\u67e5\u770b\uff1amodelscope.hub.snapshot_download\n    \"model_id\": \"Qwen/Qwen2.5-72B-Instruct\",\n    \"ignore_patterns\": [\"*.bin\", \"*.safetensors\"],\n    \"local_dir\": './Qwen2.5-72B-Instruct'\n}\n\nmodel_dir = download_from_modelscope(**modelscope_args)\nprint(model_dir)\n</code></pre> <pre><code>./Qwen2.5-72B-Instruct\n</code></pre>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#from_huggingface_tokenizer-token","title":"\u4f7f\u7528 from_huggingface_tokenizer \u65b9\u6cd5\u6309\u7167token\u5206\u5757","text":"<pre><code># \u4f7f\u7528 `AutoTokenizer.from_pretrained` \u52a0\u8f7d tokenizer \nfrom transformers import AutoTokenizer\nfrom langchain.text_splitter import RecursiveCharacterTextSplitter\n\ntokenizer = AutoTokenizer.from_pretrained(model_dir, trust_remote_code=True)\n\n# \u4f7f\u7528 `TextSplitter.from_huggingface_tokenizer`\u65b9\u6cd5\u6307\u5b9a `tokenizer` \u53c2\u6570\uff0c\u5176\u4ed6\u53c2\u6570\u4e0e\u524d\u9762\u7684\u76f8\u540c\ntext = \"\"\"\n## \u6309\u591a\u5b57\u7b26\u9012\u5f52\u5206\u5757\n\n\u6587\u672c\u5206\u5272\u5668 `RecursiveCharacterTextSplitter` \u662f**\u63a8\u8350\u7528\u4e8e\u901a\u7528\u6587\u672c\u7684\u5206\u5272\u5668**\uff0c\u5b83\u4f1a\u4f7f\u7528\u4e00\u4e2a\u5b57\u7b26\u5217\u8868(\u9ed8\u8ba4\u5217\u8868\u4e3a`[\"\\n\\n\", \"\\n\", \" \", \"\"]`)\u6309\u987a\u5e8f\u5206\u5272\u6587\u672c\uff0c\u76f4\u5230\u5757\u7684\u5927\u5c0f\u8fbe\u5230\u6307\u5b9a\u957f\u5ea6\u3002\u8fd9\u6837\u505a\u7684\u76ee\u7684\u662f\u5c3d\u53ef\u80fd\u5730\u5c06\u6240\u6709\u6bb5\u843d\uff08\u7136\u540e\u662f\u53e5\u5b50\uff0c\u6700\u540e\u662f\u5355\u8bcd\uff09\u4fdd\u6301\u5728\u4e00\u8d77\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u6bb5\u843d\u901a\u5e38\u770b\u8d77\u6765\u662f\u8bed\u4e49\u4e0a\u6700\u76f8\u5173\u7684\u6587\u672c\u7247\u6bb5\u3002\n\n- \u6587\u672c\u7684\u62c6\u5206\u65b9\u5f0f\uff1a\u6309\u5b57\u7b26\u5217\u8868\u3002\n- \u5982\u4f55\u6d4b\u91cf\u5757\u5927\u5c0f\uff1a\u6309\u5b57\u7b26\u6570\u3002\n\n\u4e0b\u9762\u6211\u4eec\u5c55\u793a\u793a\u4f8b\u7528\u6cd5\u3002\n\n- \u8981\u76f4\u63a5\u83b7\u53d6\u5b57\u7b26\u4e32\u5185\u5bb9\uff0c\u8bf7\u4f7f\u7528`.split_text`\u3002\n\n- \u8981\u521b\u5efa LangChain `Document`\u5bf9\u8c61\uff08\u4f8b\u5982\uff0c\u7528\u4e8e\u4e0b\u6e38\u4efb\u52a1\uff09\uff0c\u8bf7\u4f7f\u7528 `.create_documents`\u3002\n\"\"\"\n\ntext_splitter = RecursiveCharacterTextSplitter.from_huggingface_tokenizer(\n    tokenizer=tokenizer,\n    chunk_size=70,\n    chunk_overlap=0,\n    # separators=separators,\n)\nchunks = text_splitter.create_documents([text])\nchunks\n</code></pre> <pre><code>[Document(metadata={}, page_content='## \u6309\u591a\u5b57\u7b26\u9012\u5f52\u5206\u5757\\n\\n\u6587\u672c\u5206\u5272\u5668 `RecursiveCharacterTextSplitter` \u662f**\u63a8\u8350\u7528\u4e8e\u901a\u7528\u6587\u672c\u7684\u5206\u5272\u5668**\uff0c\u5b83\u4f1a\u4f7f\u7528\u4e00\u4e2a\u5b57\u7b26\u5217\u8868(\u9ed8\u8ba4\u5217\u8868\u4e3a`[\"'),\n Document(metadata={}, page_content='\", \"\\n\", \" \", \"\"]`)\u6309\u987a\u5e8f\u5206\u5272\u6587\u672c\uff0c\u76f4\u5230\u5757\u7684\u5927\u5c0f\u8fbe\u5230\u6307\u5b9a\u957f\u5ea6\u3002\u8fd9\u6837\u505a\u7684\u76ee\u7684\u662f\u5c3d\u53ef\u80fd\u5730\u5c06\u6240\u6709\u6bb5\u843d\uff08\u7136\u540e\u662f\u53e5\u5b50\uff0c\u6700\u540e\u662f\u5355\u8bcd\uff09\u4fdd\u6301\u5728\u4e00\u8d77\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u6bb5\u843d\u901a\u5e38\u770b\u8d77\u6765\u662f\u8bed\u4e49\u4e0a\u6700\u76f8\u5173\u7684\u6587\u672c\u7247\u6bb5\u3002'),\n Document(metadata={}, page_content='- \u6587\u672c\u7684\u62c6\u5206\u65b9\u5f0f\uff1a\u6309\u5b57\u7b26\u5217\u8868\u3002\\n- \u5982\u4f55\u6d4b\u91cf\u5757\u5927\u5c0f\uff1a\u6309\u5b57\u7b26\u6570\u3002\\n\\n\u4e0b\u9762\u6211\u4eec\u5c55\u793a\u793a\u4f8b\u7528\u6cd5\u3002\\n\\n- \u8981\u76f4\u63a5\u83b7\u53d6\u5b57\u7b26\u4e32\u5185\u5bb9\uff0c\u8bf7\u4f7f\u7528`.split_text`\u3002'),\n Document(metadata={}, page_content='- \u8981\u521b\u5efa LangChain `Document`\u5bf9\u8c61\uff08\u4f8b\u5982\uff0c\u7528\u4e8e\u4e0b\u6e38\u4efb\u52a1\uff09\uff0c\u8bf7\u4f7f\u7528 `.create_documents`\u3002')]\n</code></pre>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#token_1","title":"\u5b57\u7b26\u5206\u5757\u548ctoken\u5206\u5757\u5bf9\u6bd4","text":"<p>\u4ece\u524d\u9762\u7684\u7ed3\u679c\u5bf9\u6bd4\u53ef\u4ee5\u770b\u5230\uff0c\u4f7f\u7528\u76f8\u540c\u7684 chunk_size\uff0c\u6309\u7167\u5b57\u7b26\u6570\u548ctoken\u6570\u5206\u5757\u540e\uff0c\u6309\u5b57\u7b26\u5206\u5757\u7684\u6570\u91cf\u6bd4\u6309token\u5206\u5757\u7684\u6570\u91cf\u8981\u591a\uff0c\u539f\u56e0\u5982\u4e0b\uff1a</p> <p>token\u5206\u5757\u5219\u662f\u6839\u636e\u6a21\u578b\u7684\u5206\u8bcd\u5668\uff0c\u6bd4\u5982BERT\u6216GPT\u4f7f\u7528\u7684WordPiece\u6216BPE\u7b97\u6cd5\uff0c\u5c06\u6587\u672c\u5206\u6210\u6709\u610f\u4e49\u7684\u5b50\u8bcd\u5355\u5143\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e00\u4e2atoken\u53ef\u80fd\u662f\u4e00\u4e2a\u8bcd\u8bed\uff0c\u6240\u4ee5\u5206\u5757\u7684\u6570\u91cf\u66f4\u5c11\u3002</p> <p>\u4ee5\u4e0b\u662f \u5b57\u7b26\u5206\u5757 \u548c Token \u5206\u5757 \u7684\u6838\u5fc3\u533a\u522b\u603b\u7ed3\uff1a</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#1","title":"1. \u5b9a\u4e49\u4e0e\u539f\u7406","text":"\u7ef4\u5ea6 \u5b57\u7b26\u5206\u5757 Token \u5206\u5757 \u5206\u5757\u5355\u4f4d \u6309\u5b57\u7b26\u6570\u5207\u5206\uff08\u5982\u6bcf 200 \u4e2a\u5b57\u7b26\u4e00\u4e2a\u5757\uff09\u3002 \u6309\u6a21\u578b\u5206\u8bcd\u5668\uff08Tokenizer\uff09\u7684 Token \u6570 \u5207\u5206\uff08\u5982\u6bcf 256 tokens \u4e00\u4e2a\u5757\uff09\u3002 \u5e95\u5c42\u903b\u8f91 \u76f4\u63a5\u57fa\u4e8e\u6587\u672c\u7684\u7269\u7406\u957f\u5ea6\u5207\u5272\uff0c\u65e0\u8bed\u8a00\u8bed\u4e49\u5206\u6790\u3002 \u4f9d\u8d56\u5206\u8bcd\u7b97\u6cd5\uff08\u5982 BPE\u3001WordPiece\uff09\u5c06\u6587\u672c\u8f6c\u6362\u4e3a\u6709\u610f\u4e49\u7684\u5b50\u8bcd\u5355\u5143\u3002 \u5178\u578b\u573a\u666f \u7b80\u5355\u6587\u672c\u9884\u5904\u7406\u3001\u65e5\u5fd7\u5207\u5272\u3001\u591a\u8bed\u8a00\u6df7\u5408\u6587\u672c\u3002 \u9002\u914d\u9884\u8bad\u7ec3\u6a21\u578b\uff08\u5982 BERT\u3001GPT\uff09\u7684\u8f93\u5165\u9650\u5236\uff0c\u9700\u4e0e\u6a21\u578b\u5206\u8bcd\u903b\u8f91\u5bf9\u9f50\u3002"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#2","title":"2. \u4f18\u7f3a\u70b9\u5bf9\u6bd4","text":"\u7ef4\u5ea6 \u5b57\u7b26\u5206\u5757 Token \u5206\u5757 \u4f18\u70b9 \u2705 \u5b9e\u73b0\u7b80\u5355\uff0c\u65e0\u9700\u4f9d\u8d56\u5206\u8bcd\u5de5\u5177   \u2705 \u65e0\u89c6\u8bed\u8a00\u5dee\u5f02\uff08\u5982\u4e2d\u6587\u3001\u963f\u62c9\u4f2f\u6587\uff09 \u2705 \u9002\u914d\u6a21\u578b\u8f93\u5165\u9650\u5236\uff08\u5982 GPT-4 \u7684 8k tokens\uff09   \u2705 \u4fdd\u7559\u8bcd\u8bed\u5b8c\u6574\u6027\uff08\u5982 <code>\"ChatGPT\"</code> \u4e0d\u88ab\u5207\u5206\uff09 \u7f3a\u70b9 \u274c \u7834\u574f\u8bed\u4e49\u5355\u5143\uff08\u5982\u5207\u5206\u8bcd\u8bed/\u53e5\u5b50\uff09   \u274c \u65e0\u6cd5\u9002\u914d\u6a21\u578b\u9700\u6c42 \u274c \u4f9d\u8d56\u5206\u8bcd\u5668\u6027\u80fd\uff08\u5982\u672a\u767b\u5f55\u8bcd\u5904\u7406\uff09   \u274c \u4e0d\u540c\u6a21\u578b\u5206\u8bcd\u7ed3\u679c\u4e0d\u540c\uff08\u5982 BERT vs GPT\uff09"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#3","title":"3. \u793a\u4f8b\u5bf9\u6bd4","text":""},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#_6","title":"\u8f93\u5165\u6587\u672c","text":"<pre><code>\u81ea\u7136\u8bed\u8a00\u5904\u7406\uff08NLP\uff09\u662f\u4eba\u5de5\u667a\u80fd\u7684\u6838\u5fc3\u9886\u57df\u4e4b\u4e00\u3002\n</code></pre>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#_7","title":"\u5206\u5757\u7ed3\u679c","text":"\u65b9\u6cd5 \u5206\u5757\u7ed3\u679c\uff08\u5047\u8bbe\u5757\u5927\u5c0f=10\uff09 \u95ee\u9898\u8bf4\u660e \u5b57\u7b26\u5206\u5757 <code>[\"\u81ea\u7136\u8bed\u8a00\u5904\u7406\uff08NLP\", \"\uff09\u662f\u4eba\u5de5\u667a\u80fd\u7684\u6838\"]</code> \u5207\u5206\u8bcd\u8bed\uff08<code>NLP)</code> \u88ab\u62c6\u5f00\uff09\u3001\u7834\u574f\u6807\u70b9\u7ed3\u6784\u3002 Token \u5206\u5757 <code>[\"\u81ea\u7136\", \"\u8bed\u8a00\", \"\u5904\u7406\", \"\uff08\", \"NLP\", \"\uff09\", \"...\"]</code> \u2192 \u5408\u5e76\u4e3a\u6709\u6548\u5757 \u4fdd\u7559\u5b8c\u6574\u8bcd\u8bed\uff0c\u9002\u914d\u6a21\u578b\u8f93\u5165\u3002"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#4","title":"4. \u9002\u7528\u573a\u666f","text":"\u65b9\u6cd5 \u63a8\u8350\u573a\u666f \u907f\u514d\u573a\u666f \u5b57\u7b26\u5206\u5757 - \u65e5\u5fd7\u6587\u4ef6\u5207\u5272   - \u591a\u8bed\u8a00\u6df7\u5408\u6587\u672c\u5feb\u901f\u5904\u7406   - \u65e0\u6a21\u578b\u4f9d\u8d56\u7684\u7b80\u5355\u4efb\u52a1 - \u9700\u8bed\u4e49\u8fde\u8d2f\u7684\u4efb\u52a1\uff08\u5982\u95ee\u7b54\u3001\u6458\u8981\uff09   - \u9002\u914d\u9884\u8bad\u7ec3\u6a21\u578b Token \u5206\u5757 - \u9884\u8bad\u7ec3\u6a21\u578b\u8f93\u5165\uff08\u5982 BERT\u3001GPT\uff09   - \u8bed\u4e49\u654f\u611f\u4efb\u52a1\uff08\u5982\u673a\u5668\u7ffb\u8bd1\uff09   - \u7cbe\u786e\u63a7\u5236\u6a21\u578b\u8ba1\u7b97\u6210\u672c - \u65e0\u5206\u8bcd\u5de5\u5177\u7684\u7b80\u5355\u7cfb\u7edf"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#5","title":"5. \u5173\u952e\u5dee\u5f02\u603b\u7ed3","text":"\u7ef4\u5ea6 \u5b57\u7b26\u5206\u5757 Token \u5206\u5757 \u8bed\u8a00\u9002\u914d\u6027 \u901a\u7528\u6240\u6709\u8bed\u8a00\uff0c\u4f46\u7834\u574f\u8bed\u4e49 \u4f9d\u8d56\u5206\u8bcd\u5668\uff0c\u9002\u914d\u7279\u5b9a\u8bed\u8a00\uff08\u5982\u4e2d\u6587\u9700\u4e13\u7528\u5206\u8bcd\u5668\uff09 \u6a21\u578b\u9002\u914d\u6027 \u4e0e\u6a21\u578b\u65e0\u5173 \u9700\u4e0e\u6a21\u578b\u7684\u5206\u8bcd\u5668\u5bf9\u9f50\uff08\u5982 GPT-3 \u7528 BPE\uff09 \u8ba1\u7b97\u6548\u7387 \u9ad8\uff08\u76f4\u63a5\u5207\u7247\uff09 \u4e2d\uff08\u9700\u5206\u8bcd\u8ba1\u7b97\uff09 \u8bed\u4e49\u4fdd\u7559\u80fd\u529b \u4f4e \u9ad8"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#6","title":"6. \u9009\u62e9\u5efa\u8bae","text":"<ul> <li>\u4f18\u5148 Token \u5206\u5757\uff1a\u6d89\u53ca\u9884\u8bad\u7ec3\u6a21\u578b\u7684\u4efb\u52a1\uff08\u5982 RAG\u3001\u6587\u672c\u751f\u6210\uff09\u3002</li> <li>\u4ec5\u7528\u5b57\u7b26\u5206\u5757\uff1a\u7b80\u5355\u6587\u672c\u5904\u7406\u3001\u591a\u8bed\u8a00\u6df7\u5408\u4e14\u65e0\u9700\u8bed\u4e49\u4fdd\u7559\u7684\u573a\u666f\uff08\u5982\u65e5\u5fd7\u5206\u6790\uff09\u3002</li> <li>\u4e2d\u6587\u7279\u522b\u6ce8\u610f\uff1a  <ul> <li>\u5b57\u7b26\u5206\u5757\u6613\u7834\u574f\u4e2d\u6587\u8bcd\u8bed\uff08\u5982 <code>\u201c\u4eba\u5de5\u667a\u80fd\u201d</code> \u2192 <code>\u201c\u4eba\u5de5\u667a \u80fd\u201d</code>\uff09\u3002  </li> <li>Token \u5206\u5757\u9700\u4f7f\u7528\u4e2d\u6587\u5206\u8bcd\u5668\uff08\u5982 <code>bert-base-chinese</code>\uff09\u3002</li> </ul> </li> </ul>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#_8","title":"\u6309\u7167\u8bed\u4e49\u5206\u5757","text":"<p><code>langchain</code> \u7684 <code>SemanticChunker</code> \u8bed\u4e49\u5206\u5757\u662f\u53c2\u8003\uff1a5_Levels_Of_Text_Splitting \u5b9e\u73b0\u7684\u3002</p> <p>\u8981\u4f7f\u7528 <code>SemanticChunker</code> \u9700\u8981\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u5b89\u88c5 <code>langchain_experimental</code>: <code>pip install --quiet langchain_experimental</code></p> <p>\u4ee5\u4e0b\u662f\u57fa\u4e8e\u8bed\u4e49\u76f8\u4f3c\u5ea6\u7684\u5206\u5757\u5b9e\u73b0\u601d\u8def\u603b\u7ed3\uff0c\u8be5\u65b9\u6cd5\u901a\u8fc7 \u5d4c\u5165\u8ddd\u79bb\u68c0\u6d4b\u8bed\u4e49\u8fb9\u754c \u5b9e\u73b0\u667a\u80fd\u5206\u5757\uff1a</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#_9","title":"\u6838\u5fc3\u601d\u8def","text":"<ol> <li>\u5206\u53e5\u5904\u7406 \u5c06\u539f\u59cb\u6587\u672c\u6309\u53e5\u5b50\u7c92\u5ea6\u62c6\u5206\uff08\u5982\u4f7f\u7528 <code>spaCy</code>\u3001<code>nltk</code> \u6216\u6807\u70b9\u89c4\u5219\uff09\u3002</li> <li>\u6ed1\u52a8\u7a97\u53e3\u805a\u5408 \u5c06\u8fde\u7eed\u53e5\u5b50\u7ec4\u6210 \u7a97\u53e3\uff08\u5982 3 \u4e2a\u53e5\u5b50\u4e3a\u4e00\u4e2a\u7a97\u53e3\uff09\uff0c\u8ba1\u7b97\u7a97\u53e3\u7684\u5d4c\u5165\u8868\u793a\u3002</li> <li>\u5d4c\u5165\u8ddd\u79bb\u8ba1\u7b97 \u6ed1\u52a8\u7a97\u53e3\u9010\u6b65\u540e\u79fb\uff08\u5982\u6bcf\u6b21\u79fb\u9664\u524d\u4e00\u53e5\uff0c\u6dfb\u52a0\u4e0b\u4e00\u53e5\uff09\uff0c\u8ba1\u7b97\u76f8\u90bb\u7a97\u53e3\u5d4c\u5165\u7684\u76f8\u4f3c\u5ea6\uff08\u5982\u4f59\u5f26\u8ddd\u79bb\uff09\u3002</li> <li>\u65ad\u70b9\u68c0\u6d4b \u82e5\u76f8\u90bb\u7a97\u53e3\u7684\u5d4c\u5165\u8ddd\u79bb\u8d85\u8fc7\u9884\u8bbe \u9608\u503c\uff0c\u5219\u8ba4\u4e3a\u6b64\u5904\u5b58\u5728\u8bed\u4e49\u8fb9\u754c\uff0c\u89e6\u53d1\u5206\u5757\u3002</li> <li>\u5408\u5e76\u76f8\u90bb\u5757 \u5c06\u672a\u89e6\u53d1\u65ad\u70b9\u7684\u76f8\u90bb\u7a97\u53e3\u5408\u5e76\u4e3a\u540c\u4e00\u5757\uff0c\u4fdd\u6301\u8bed\u4e49\u8fde\u8d2f\u6027\u3002</li> </ol>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#_10","title":"\u5177\u4f53\u6b65\u9aa4\u793a\u4f8b","text":""},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#_11","title":"\u8f93\u5165\u6587\u672c","text":"<pre><code>\u53e5\u5b501\uff1a\u6df1\u5ea6\u5b66\u4e60\u662f\u673a\u5668\u5b66\u4e60\u7684\u5206\u652f\u3002  \n\u53e5\u5b502\uff1a\u5b83\u901a\u8fc7\u795e\u7ecf\u7f51\u7edc\u6a21\u62df\u4eba\u8111\u7684\u5b66\u4e60\u8fc7\u7a0b\u3002  \n\u53e5\u5b503\uff1a\u5e38\u89c1\u7684\u6a21\u578b\u5305\u62ecCNN\u548cRNN\u3002  \n\u53e5\u5b504\uff1a\u81ea\u7136\u8bed\u8a00\u5904\u7406\uff08NLP\uff09\u662f\u5176\u91cd\u8981\u5e94\u7528\u9886\u57df\u3002  \n\u53e5\u5b505\uff1aBERT\u548cGPT\u662fNLP\u4e2d\u7684\u4ee3\u8868\u6027\u6a21\u578b\u3002  \n</code></pre>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#_12","title":"\u5206\u5757\u8fc7\u7a0b","text":"<ol> <li>\u7a97\u53e3\u751f\u6210 <ul> <li>\u7a97\u53e31\uff1a[\u53e5\u5b501, \u53e5\u5b502, \u53e5\u5b503]  </li> <li>\u7a97\u53e32\uff1a[\u53e5\u5b502, \u53e5\u5b503, \u53e5\u5b504]  </li> <li>\u7a97\u53e33\uff1a[\u53e5\u5b503, \u53e5\u5b504, \u53e5\u5b505]</li> </ul> </li> <li>\u5d4c\u5165\u8ba1\u7b97 <ul> <li>\u83b7\u53d6\u6bcf\u4e2a\u7a97\u53e3\u7684\u5d4c\u5165\u5411\u91cf\uff08\u5982\u4f7f\u7528 Sentence-BERT\uff09\u3002</li> </ul> </li> <li>\u8ddd\u79bb\u6bd4\u8f83 <ul> <li>\u8ba1\u7b97\u7a97\u53e31\u4e0e\u7a97\u53e32\u7684\u5d4c\u5165\u8ddd\u79bb \u2192 \u5047\u8bbe\u8ddd\u79bb\u8f83\u5c0f\uff08\u4e3b\u9898\u8fde\u7eed\uff1a\u6df1\u5ea6\u5b66\u4e60\u2192\u6a21\u578b\uff09\u3002  </li> <li>\u8ba1\u7b97\u7a97\u53e32\u4e0e\u7a97\u53e33\u7684\u5d4c\u5165\u8ddd\u79bb \u2192 \u5047\u8bbe\u8ddd\u79bb\u8f83\u5927\uff08\u4e3b\u9898\u5207\u6362\uff1a\u6a21\u578b\u2192NLP\u5e94\u7528\uff09\u3002</li> </ul> </li> <li>\u65ad\u70b9\u89e6\u53d1 <ul> <li>\u5728\u7a97\u53e32\u4e0e\u7a97\u53e33\u4e4b\u95f4\u89e6\u53d1\u5206\u5757\u3002</li> </ul> </li> <li>\u6700\u7ec8\u5206\u5757 <ul> <li>\u57571\uff1a[\u53e5\u5b501, \u53e5\u5b502, \u53e5\u5b503]  </li> <li>\u57572\uff1a[\u53e5\u5b504, \u53e5\u5b505]</li> </ul> </li> </ol>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#_13","title":"\u4f18\u70b9\u4e0e\u7f3a\u70b9","text":"\u4f18\u70b9 \u7f3a\u70b9 \u2705 \u81ea\u9002\u5e94\u8bed\u4e49\u8fb9\u754c\uff0c\u907f\u514d\u673a\u68b0\u5207\u5206 \u274c \u8ba1\u7b97\u6210\u672c\u9ad8\uff08\u9700\u591a\u6b21\u5d4c\u5165\u8ba1\u7b97\u548c\u76f8\u4f3c\u5ea6\u6bd4\u8f83\uff09 \u2705 \u51cf\u5c11\u566a\u58f0\uff08\u7a97\u53e3\u805a\u5408\u964d\u4f4e\u5355\u53e5\u6ce2\u52a8\u5f71\u54cd\uff09 \u274c \u4f9d\u8d56\u5d4c\u5165\u6a21\u578b\u8d28\u91cf\uff08\u5982\u8bed\u4e49\u8868\u793a\u4e0d\u51c6\u786e\u5219\u5206\u5757\u5931\u6548\uff09 \u2705 \u9002\u914d\u4e0d\u540c\u6587\u672c\u7c7b\u578b\uff08\u6280\u672f\u6587\u6863\u3001\u5bf9\u8bdd\u7b49\uff09 \u274c \u53c2\u6570\u654f\u611f\uff08\u9700\u8c03\u4f18\u7a97\u53e3\u5927\u5c0f\u3001\u9608\u503c\uff09"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#_14","title":"\u5173\u952e\u53c2\u6570\u4e0e\u8c03\u4f18\u5efa\u8bae","text":"<ol> <li>\u7a97\u53e3\u5927\u5c0f <ul> <li>\u8fc7\u5c0f\uff1a\u566a\u58f0\u654f\u611f\uff08\u5982\u7a97\u53e3=1\u65f6\u9000\u5316\u4e3a\u5355\u53e5\u6bd4\u8f83\uff09\u3002  </li> <li>\u8fc7\u5927\uff1a\u8bed\u4e49\u8fb9\u754c\u6a21\u7cca\uff08\u5982\u7a97\u53e3=5\u53ef\u80fd\u63a9\u76d6\u5c40\u90e8\u53d8\u5316\uff09\u3002  </li> <li>\u5efa\u8bae\u503c\uff1a2-4 \u4e2a\u53e5\u5b50\uff08\u6839\u636e\u6587\u672c\u5bc6\u5ea6\u8c03\u6574\uff09\u3002</li> </ul> </li> <li>\u76f8\u4f3c\u5ea6\u9608\u503c <ul> <li>\u8fc7\u9ad8\uff1a\u5206\u5757\u8fc7\u5c11\uff0c\u5757\u5185\u8bed\u4e49\u6df7\u6742\u3002  </li> <li>\u8fc7\u4f4e\uff1a\u5206\u5757\u8fc7\u591a\uff0c\u7834\u574f\u8fde\u8d2f\u6027\u3002  </li> <li>\u8c03\u4f18\u65b9\u6cd5\uff1a\u901a\u8fc7\u9a8c\u8bc1\u96c6\u6d4b\u8bd5\u4e0d\u540c\u9608\u503c\u4e0b\u7684\u5206\u5757\u8d28\u91cf\uff08\u5982\u4eba\u5de5\u8bc4\u4f30\u6216\u68c0\u7d22\u53ec\u56de\u7387\uff09\u3002</li> </ul> </li> <li>\u5d4c\u5165\u6a21\u578b\u9009\u62e9 <ul> <li>\u4f18\u5148\u9886\u57df\u9002\u914d\u6a21\u578b\uff08\u5982\u6280\u672f\u6587\u672c\u7528 <code>all-mpnet-base-v2</code>\uff0c\u901a\u7528\u6587\u672c\u7528 <code>text-embedding-3-small</code>\uff09\u3002</li> </ul> </li> </ol>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#_15","title":"\u6539\u8fdb\u65b9\u5411","text":"<ol> <li>\u52a8\u6001\u7a97\u53e3\u8c03\u6574 \u6839\u636e\u6587\u672c\u590d\u6742\u5ea6\u81ea\u52a8\u6269\u5c55/\u6536\u7f29\u7a97\u53e3\uff08\u5982\u5bc6\u96c6\u6bb5\u843d\u7528\u5c0f\u7a97\u53e3\uff0c\u5197\u4f59\u5185\u5bb9\u7528\u5927\u7a97\u53e3\uff09\u3002  </li> <li>\u6df7\u5408\u5206\u5757\u7b56\u7565 \u5148\u6309\u6807\u9898/\u6bb5\u843d\u7c97\u5206\u5757\uff0c\u518d\u5bf9\u957f\u6bb5\u843d\u5e94\u7528\u8bed\u4e49\u5206\u5757\u3002  </li> <li>\u8f7b\u91cf\u5316\u8ba1\u7b97 <ul> <li>\u4f7f\u7528\u4f4e\u7ef4\u5d4c\u5165\uff08\u5982 PCA \u964d\u7ef4\uff09\u3002  </li> <li>\u7f13\u5b58\u5d4c\u5165\u7ed3\u679c\u51cf\u5c11\u91cd\u590d\u8ba1\u7b97\u3002</li> </ul> </li> </ol>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#_16","title":"\u9002\u7528\u573a\u666f","text":"<ul> <li>\u6280\u672f\u6587\u6863\uff1a\u7cbe\u51c6\u5207\u5206\u7ae0\u8282\u3001\u6848\u4f8b\u3001\u4ee3\u7801\u5757\u3002  </li> <li>\u957f\u5bf9\u8bdd\u8bb0\u5f55\uff1a\u6309\u8bdd\u9898\u5207\u6362\u5206\u5272\u4f1a\u8bdd\u9636\u6bb5\u3002  </li> <li>\u8de8\u6bb5\u843d\u63a8\u7406\u4efb\u52a1\uff1a\u786e\u4fdd\u5757\u5185\u8bed\u4e49\u9ad8\u5ea6\u76f8\u5173\u3002</li> </ul> <p>\u901a\u8fc7\u8be5\u65b9\u6cd5\uff0c\u53ef\u663e\u8457\u63d0\u5347 RAG \u7b49\u5e94\u7528\u4e2d\u68c0\u7d22\u5185\u5bb9\u7684\u8bed\u4e49\u8fde\u8d2f\u6027\u548c\u76f8\u5173\u6027\u3002</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#_17","title":"\u8bed\u4e49\u5206\u5757\u4ee3\u7801\u5b9e\u73b0","text":"<p>\u63a5\u4e0b\u6765\u4f7f\u7528 langchain \u7684 <code>SemanticChunker</code> \u6765\u6f14\u793a\u8bed\u4e49\u5206\u5757\u4ee3\u7801\u5b9e\u73b0\u3002</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#embedding","title":"\u9009\u62e9embedding\u6a21\u578b","text":"<p>\u8981\u5b9e\u4f8b\u5316 <code>SemanticChunker</code>\uff0c\u5fc5\u987b\u6307\u5b9a\u4e00\u4e2a embedding \u6a21\u578b\u3002\u56e0\u4e3a\u5728\u56fd\u5185\u65e0\u6cd5\u76f4\u63a5\u4ece huggingface \u4e0b\u8f7d\u6a21\u578b\uff0c\u6240\u4ee5\u8fd9\u91cc\u9009\u62e9\u4ece modelscope \u4e0b\u8f7d embedding \u6a21\u578b\u3002 \u5728 modelscope \u7684\u6a21\u578b\u5e93\u4e2d\u627e\u5230\u6587\u672c\u5411\u91cf\u6a21\u578b\uff0c\u6211\u8fd9\u91cc\u9009\u62e9\u4e0b\u8f7d\u91cf\u548c\u559c\u6b22\u6570\u6700\u591a\u7684 embedding \u6a21\u578b <code>iic/nlp_gte_sentence-embedding_chinese-large</code>\u3002</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#embedding_1","title":"\u52a0\u8f7dembedding\u6a21\u578b","text":"<p>\u5728 modelscope \u4e2d\u67e5\u770b <code>iic/nlp_gte_sentence-embedding_chinese-large</code> \u7684\u6a21\u578b\u4ecb\u7ecd\uff0c\u53ef\u4ee5\u77e5\u9053\u5b83\u7684\u4f7f\u7528\u65b9\u6cd5\uff0c\u5373\u53ef\u4ee5\u901a\u8fc7\u7b80\u5355ModelScope\u6846\u67b6\u7684Pipeline\u8c03\u7528\u6765\u4f7f\u7528GTE\u6587\u672c\u5411\u91cf\u8868\u793a\u6a21\u578b\u3002ModelScope\u5c01\u88c5\u4e86\u7edf\u4e00\u7684\u63a5\u53e3\u5bf9\u5916\u63d0\u4f9b\u5355\u53e5\u5411\u91cf\u8868\u793a\u3001\u53cc\u53e5\u6587\u672c\u76f8\u4f3c\u5ea6\u3001\u591a\u5019\u9009\u76f8\u4f3c\u5ea6\u8ba1\u7b97\u529f\u80fd\u3002</p> <p>\u5728 <code>langchain_community</code> \u4e2d\u5bf9 ModelScope \u6846\u67b6\u7684 Pipeline \u52a0\u8f7d embedding \u6a21\u578b\u8fdb\u884c\u4e86\u96c6\u6210\uff0c\u4f7f\u7528 <code>from langchain_community.embeddings import ModelScopeEmbeddings</code> \u5373\u53ef\uff0c\u65b9\u4fbf\u5728langchain\u7684\u6280\u672f\u4f53\u7cfb\u4f7f\u7528\u3002</p> <p>\u63a5\u4e0b\u6765\u4f7f\u7528 <code>ModelScopeEmbeddings</code> \u52a0\u8f7d embedding \u6a21\u578b\u3002</p> <pre><code>from langchain_community.embeddings import ModelScopeEmbeddings\n# \u56e0\u4e3a\u8bed\u4e49\u5206\u5757\u662f\u6309\u7167\u8bed\u4e49\u76f8\u4f3c\u5ea6\u8fdb\u884c\u5206\u5757\u7684\uff0c\u6240\u4ee5\u9700\u8981\u4e00\u4e2a\u8ba1\u7b97\u8bed\u4e49\u76f8\u4f3c\u5ea6\u7684 embedding \u6a21\u578b\u3002\nmodel_id = \"iic/nlp_gte_sentence-embedding_chinese-large\"\nembed = ModelScopeEmbeddings(model_id=model_id)\nprint(embed)\n\nembedding = embed.embed_query('\u6d4b\u8bd5embedding')\nlen(embedding)\n</code></pre> <pre><code>2025-05-22 10:15:44,137 - modelscope - WARNING - Model revision not specified, use revision: v1.1.0\n2025-05-22 10:15:45,588 - modelscope - WARNING - Model revision not specified, use revision: v1.1.0\n\n\nDownloading Model from https://www.modelscope.cn to directory: /Users/xiniao/.cache/modelscope/hub/models/iic/nlp_gte_sentence-embedding_chinese-large\n\n\n2025-05-22 10:15:45,800 - modelscope - INFO - initiate model from /Users/xiniao/.cache/modelscope/hub/models/iic/nlp_gte_sentence-embedding_chinese-large\n2025-05-22 10:15:45,802 - modelscope - INFO - initiate model from location /Users/xiniao/.cache/modelscope/hub/models/iic/nlp_gte_sentence-embedding_chinese-large.\n2025-05-22 10:15:45,818 - modelscope - INFO - initialize model from /Users/xiniao/.cache/modelscope/hub/models/iic/nlp_gte_sentence-embedding_chinese-large\n2025-05-22 10:15:49,278 - modelscope - WARNING - No preprocessor field found in cfg.\n2025-05-22 10:15:49,278 - modelscope - WARNING - No val key and type key found in preprocessor domain of configuration.json file.\n2025-05-22 10:15:49,278 - modelscope - WARNING - Cannot find available config to build preprocessor at mode inference, current config: {'model_dir': '/Users/xiniao/.cache/modelscope/hub/models/iic/nlp_gte_sentence-embedding_chinese-large'}. trying to build by task and model information.\n2025-05-22 10:15:49,309 - modelscope - INFO - cuda is not available, using cpu instead.\n2025-05-22 10:15:49,311 - modelscope - WARNING - No preprocessor field found in cfg.\n2025-05-22 10:15:49,312 - modelscope - WARNING - No val key and type key found in preprocessor domain of configuration.json file.\n2025-05-22 10:15:49,312 - modelscope - WARNING - Cannot find available config to build preprocessor at mode inference, current config: {'model_dir': '/Users/xiniao/.cache/modelscope/hub/models/iic/nlp_gte_sentence-embedding_chinese-large', 'sequence_length': 128}. trying to build by task and model information.\n\n\nembed=&lt;modelscope.pipelines.nlp.sentence_embedding_pipeline.SentenceEmbeddingPipeline object at 0x1766e5d60&gt; model_id='iic/nlp_gte_sentence-embedding_chinese-large' model_revision=None\n\n\n\n\n\n1024\n</code></pre> <p>\u6ce8\u610f\u26a0\ufe0f\uff1a \u5728\u4f7f\u7528 langchain_community \u5b9e\u73b0\u7684 ModelScopeEmbeddings \u65f6\uff0c\u4ece\u524d\u9762\u7684 WARNING \u5185\u5bb9\u4e2d\u53ef\u4ee5\u770b\u5230\uff0cembedding\u6a21\u578b\u9ed8\u8ba4\u6700\u957f\u6587\u672c\u957f\u5ea6\u4e3a128<code>'sequence_length': 128</code>\uff0c\u5e76\u4e14\u65e0\u6cd5\u4fee\u6539\u3002 </p> <p>\u4e3a\u4e86\u5141\u8bb8\u63a5\u53d7\u66f4\u957f\u7684\u6587\u672c\uff0c\u4e0b\u9762\u5c06 ModelScopeEmbeddings \u7684\u5b9e\u73b0\u8fdb\u884c\u91cd\u5199\uff0c\u6dfb\u52a0\u4e86 sequence_length \u8bbe\u7f6e\u53c2\u6570\uff0c\u4ee3\u7801\u5b9e\u73b0\u5982\u4e0b\uff1a</p> <pre><code>from typing import Any, List, Optional\n\nfrom langchain_core.embeddings import Embeddings\nfrom pydantic import BaseModel, ConfigDict\n\n\nclass ModelScopeEmbeddings(BaseModel, Embeddings):\n    \"\"\"ModelScopeHub embedding models.\n\n    To use, you should have the ``modelscope`` python package installed.\n\n    Example:\n        .. code-block:: python\n\n            from langchain_community.embeddings import ModelScopeEmbeddings\n            model_id = \"damo/nlp_corom_sentence-embedding_english-base\"\n            embed = ModelScopeEmbeddings(model_id=model_id, model_revision=\"v1.0.0\")\n    \"\"\"\n\n    embed: Any = None\n    model_id: str = \"damo/nlp_corom_sentence-embedding_english-base\"\n    \"\"\"Model name to use.\"\"\"\n    model_revision: Optional[str] = None\n    sequence_length: int = 512 # sequence_length \u4ee3\u8868\u6700\u5927\u6587\u672c\u957f\u5ea6\n\n    def __init__(self, **kwargs: Any):\n        \"\"\"Initialize the modelscope\"\"\"\n        super().__init__(**kwargs)\n        try:\n            from modelscope.pipelines import pipeline\n            from modelscope.utils.constant import Tasks\n        except ImportError as e:\n            raise ImportError(\n                \"Could not import some python packages.\"\n                \"Please install it with `pip install modelscope`.\"\n            ) from e\n        self.embed = pipeline(\n            Tasks.sentence_embedding,\n            model=self.model_id,\n            model_revision=self.model_revision,\n            sequence_length=self.sequence_length\n        )\n\n    model_config = ConfigDict(extra=\"forbid\", protected_namespaces=())\n\n    def embed_documents(self, texts: List[str]) -&gt; List[List[float]]:\n        \"\"\"Compute doc embeddings using a modelscope embedding model.\n\n        Args:\n            texts: The list of texts to embed.\n\n        Returns:\n            List of embeddings, one for each text.\n        \"\"\"\n        texts = list(map(lambda x: x.replace(\"\\n\", \" \"), texts))\n        inputs = {\"source_sentence\": texts}\n        embeddings = self.embed(input=inputs)[\"text_embedding\"]\n        return embeddings.tolist()\n\n    def embed_query(self, text: str) -&gt; List[float]:\n        \"\"\"Compute query embeddings using a modelscope embedding model.\n\n        Args:\n            text: The text to embed.\n\n        Returns:\n            Embeddings for the text.\n        \"\"\"\n        text = text.replace(\"\\n\", \" \")\n        inputs = {\"source_sentence\": [text]}\n        embedding = self.embed(input=inputs)[\"text_embedding\"][0]\n        return embedding.tolist()\n\n\nmodel_id = \"iic/nlp_gte_sentence-embedding_chinese-large\"\nembed = ModelScopeEmbeddings(model_id=model_id, sequence_length=1024)\nprint(embed)\nembedding = embed.embed_query('\u6d4b\u8bd5embedding')\nlen(embedding)\n</code></pre> <pre><code>2025-05-22 10:21:51,892 - modelscope - WARNING - Model revision not specified, use revision: v1.1.0\n2025-05-22 10:21:53,263 - modelscope - WARNING - Model revision not specified, use revision: v1.1.0\n\n\nDownloading Model from https://www.modelscope.cn to directory: /Users/xiniao/.cache/modelscope/hub/models/iic/nlp_gte_sentence-embedding_chinese-large\n\n\n2025-05-22 10:21:53,541 - modelscope - INFO - initiate model from /Users/xiniao/.cache/modelscope/hub/models/iic/nlp_gte_sentence-embedding_chinese-large\n2025-05-22 10:21:53,543 - modelscope - INFO - initiate model from location /Users/xiniao/.cache/modelscope/hub/models/iic/nlp_gte_sentence-embedding_chinese-large.\n2025-05-22 10:21:53,562 - modelscope - INFO - initialize model from /Users/xiniao/.cache/modelscope/hub/models/iic/nlp_gte_sentence-embedding_chinese-large\n2025-05-22 10:21:56,991 - modelscope - WARNING - No preprocessor field found in cfg.\n2025-05-22 10:21:56,991 - modelscope - WARNING - No val key and type key found in preprocessor domain of configuration.json file.\n2025-05-22 10:21:56,992 - modelscope - WARNING - Cannot find available config to build preprocessor at mode inference, current config: {'model_dir': '/Users/xiniao/.cache/modelscope/hub/models/iic/nlp_gte_sentence-embedding_chinese-large'}. trying to build by task and model information.\n2025-05-22 10:21:57,014 - modelscope - INFO - cuda is not available, using cpu instead.\n2025-05-22 10:21:57,018 - modelscope - WARNING - No preprocessor field found in cfg.\n2025-05-22 10:21:57,019 - modelscope - WARNING - No val key and type key found in preprocessor domain of configuration.json file.\n2025-05-22 10:21:57,019 - modelscope - WARNING - Cannot find available config to build preprocessor at mode inference, current config: {'model_dir': '/Users/xiniao/.cache/modelscope/hub/models/iic/nlp_gte_sentence-embedding_chinese-large', 'sequence_length': 1024}. trying to build by task and model information.\n\n\nembed=&lt;modelscope.pipelines.nlp.sentence_embedding_pipeline.SentenceEmbeddingPipeline object at 0x1766e44a0&gt; model_id='iic/nlp_gte_sentence-embedding_chinese-large' model_revision=None sequence_length=1024\n\n\n\n\n\n1024\n</code></pre>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#semanticchunker","title":"\u4f7f\u7528 SemanticChunker","text":"<p>\u8981\u5b9e\u4f8b\u5316SemanticChunker\uff0c\u5fc5\u987b\u6307\u5b9a\u4e00\u4e2aEmbeddings\u5b9e\u4f8b\u3002</p> <p>\u8bed\u4e49\u5206\u5757\u5668\u7684\u5de5\u4f5c\u539f\u7406\u662f\u786e\u5b9a\u4f55\u65f6\u201c\u62c6\u5206\u201d\u53e5\u5b50\uff0c\u5177\u4f53\u65b9\u6cd5\u662f\u67e5\u627e\u4efb\u610f\u4e24\u4e2a\u53e5\u5b50\u4e4b\u95f4\u5d4c\u5165\u7684\u5dee\u5f02\uff0c\u5f53\u5dee\u5f02\u8d85\u8fc7\u67d0\u4e2a\u9608\u503c\u65f6\uff0c\u53e5\u5b50\u5c31\u4f1a\u88ab\u62c6\u5206\u3002</p> <p><code>SemanticChunker</code> \u9ed8\u8ba4\u53e5\u5b50\u62c6\u5206\u7684\u903b\u8f91\u662f\u5c06\u6587\u7ae0\u6309\u9ed8\u8ba4\u7684 '.', '?', \u548c '!' \u8fdb\u884c\u5206\u5272\uff0c\u9ed8\u8ba4\u53c2\u6570\u4e3a\uff1a<code>sentence_split_regex: str = r\"(?&lt;=[.?!])\\s+\"</code></p> <p>\u6709\u51e0\u79cd\u53ef\u4ee5\u7528\u6765\u8ba1\u7b97\u76f8\u4f3c\u5ea6\u7684\u65b9\u6cd5\u548c\u9608\u503c\uff0c\u8fd9\u4e9b\u65b9\u6cd5\u7531\u53c2\u6570 <code>breakpoint_threshold_type</code> \u63a7\u5236\u3002</p> <ul> <li>percentile: \u767e\u5206\u4f4d\u6570\uff0c\u9ed8\u8ba4 95\uff0c\u8be5\u53c2\u6570\u7684\u53d6\u503c\u8303\u56f4\u4e3a 0.0 \u5230 100.0 \u4e4b\u95f4\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>breakpoint_threshold_amount</code> \u8c03\u6574\u53d6\u503c\uff08\u9ed8\u8ba4\u7c7b\u578b\uff09\u3002</li> <li>standard_deviation\uff1a\u6807\u51c6\u5dee\uff0c\u9ed8\u8ba4 3\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>breakpoint_threshold_amount</code> \u8c03\u6574\u53d6\u503c\u3002</li> <li>interquartile\uff1a\u56db\u5206\u4f4d\u6570\uff0c\u9ed8\u8ba4 1.5\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>breakpoint_threshold_amount</code> \u8c03\u6574\u53d6\u503c\u3002</li> <li>gradient\uff1a\u68af\u5ea6\uff0c\u9ed8\u8ba4 95\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>breakpoint_threshold_amount</code> \u8c03\u6574\u53d6\u503c\u3002</li> </ul> <p>\u6ce8\u610f\uff1a\u5982\u679c\u751f\u6210\u7684\u5757\u5927\u5c0f\u592a\u5c0f/\u592a\u5927\uff0c\u53ef\u4ee5\u4f7f\u7528 min_chunk_size \u8fdb\u884c\u8c03\u6574\u3002</p> <pre><code>BreakpointThresholdType = Literal[\n    \"percentile\", \"standard_deviation\", \"interquartile\", \"gradient\"\n]\nBREAKPOINT_DEFAULTS: Dict[BreakpointThresholdType, float] = {\n    \"percentile\": 95,\n    \"standard_deviation\": 3,\n    \"interquartile\": 1.5,\n    \"gradient\": 95,\n}\n</code></pre> <p>\u63a5\u4e0b\u6765\u4f7f\u7528 SemanticChunker \u8fdb\u884c\u6587\u672c\u8bed\u4e49\u5206\u5757</p> <pre><code>from langchain_experimental.text_splitter import SemanticChunker\ntext = \"\"\"\n\u8981\u5b9e\u4f8b\u5316SemanticChunker\uff0c\u5fc5\u987b\u6307\u5b9a\u4e00\u4e2aEmbeddings\u5b9e\u4f8b\u3002\n\n\u8bed\u4e49\u5206\u5757\u5668\u7684\u5de5\u4f5c\u539f\u7406\u662f\u786e\u5b9a\u4f55\u65f6\u201c\u62c6\u5206\u201d\u53e5\u5b50\uff0c\u5177\u4f53\u65b9\u6cd5\u662f\u67e5\u627e\u4efb\u610f\u4e24\u4e2a\u53e5\u5b50\u4e4b\u95f4\u5d4c\u5165\u7684\u5dee\u5f02\uff0c\u5f53\u5dee\u5f02\u8d85\u8fc7\u67d0\u4e2a\u9608\u503c\u65f6\uff0c\u53e5\u5b50\u5c31\u4f1a\u88ab\u62c6\u5206\u3002\n\n\u6709\u51e0\u79cd\u65b9\u6cd5\u53ef\u4ee5\u786e\u5b9a\u8be5\u9608\u503c\uff0c\u8fd9\u4e9b\u65b9\u6cd5\u7531\u53c2\u6570 breakpoint_threshold_type \u63a7\u5236\u3002\n\npercentile: \u767e\u5206\u4f4d\u6570\uff0c\u9ed8\u8ba4 95\uff0c\u8be5\u53c2\u6570\u7684\u53d6\u503c\u8303\u56f4\u4e3a 0.0 \u5230 100.0 \u4e4b\u95f4\uff0c\u53ef\u4ee5\u4f7f\u7528 breakpoint_threshold_amount \u8c03\u6574\u53d6\u503c\uff08\u9ed8\u8ba4\u7c7b\u578b\uff09\u3002\nstandard_deviation\uff1a\u6807\u51c6\u5dee\uff0c\u9ed8\u8ba4 3\uff0c\u53ef\u4ee5\u4f7f\u7528 breakpoint_threshold_amount \u8c03\u6574\u53d6\u503c\u3002\ninterquartile\uff1a\u56db\u5206\u4f4d\u6570\uff0c\u9ed8\u8ba4 1.5\uff0c\u53ef\u4ee5\u4f7f\u7528 breakpoint_threshold_amount \u8c03\u6574\u53d6\u503c\u3002\ngradient\uff1a\u68af\u5ea6\uff0c\u9ed8\u8ba4 95\uff0c\u53ef\u4ee5\u4f7f\u7528 breakpoint_threshold_amount \u8c03\u6574\u53d6\u503c\u3002\n\u6ce8\u610f\uff1a\u5982\u679c\u751f\u6210\u7684\u5757\u5927\u5c0f\u592a\u5c0f/\u592a\u5927\uff0c\u53ef\u4ee5\u4f7f\u7528 min_chunk_size \u8fdb\u884c\u8c03\u6574\u3002\n\"\"\"\n\ntext_splitter = SemanticChunker(\n    embeddings=embed,\n    breakpoint_threshold_type='percentile',\n    breakpoint_threshold_amount=95,\n    sentence_split_regex=r\"(?&lt;=[\u3002\uff1f\uff01])\\s+\" # \u81ea\u5b9a\u4e49\u53e5\u5b50\u5207\u5206\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5185\u90e8\u4f7f\u7528 re.split(self.sentence_split_regex, text) \u5207\u5206\u53e5\u5b50\n)\n\ndocs = text_splitter.create_documents([text])\nprint(docs)\nprint(f'\u5206\u5757\u6570\u91cf\uff1a{len(docs)}')\n</code></pre> <pre><code>[Document(metadata={}, page_content='\\n\u8981\u5b9e\u4f8b\u5316SemanticChunker\uff0c\u5fc5\u987b\u6307\u5b9a\u4e00\u4e2aEmbeddings\u5b9e\u4f8b\u3002 \u8bed\u4e49\u5206\u5757\u5668\u7684\u5de5\u4f5c\u539f\u7406\u662f\u786e\u5b9a\u4f55\u65f6\u201c\u62c6\u5206\u201d\u53e5\u5b50\uff0c\u5177\u4f53\u65b9\u6cd5\u662f\u67e5\u627e\u4efb\u610f\u4e24\u4e2a\u53e5\u5b50\u4e4b\u95f4\u5d4c\u5165\u7684\u5dee\u5f02\uff0c\u5f53\u5dee\u5f02\u8d85\u8fc7\u67d0\u4e2a\u9608\u503c\u65f6\uff0c\u53e5\u5b50\u5c31\u4f1a\u88ab\u62c6\u5206\u3002 \u6709\u51e0\u79cd\u65b9\u6cd5\u53ef\u4ee5\u786e\u5b9a\u8be5\u9608\u503c\uff0c\u8fd9\u4e9b\u65b9\u6cd5\u7531\u53c2\u6570 breakpoint_threshold_type \u63a7\u5236\u3002'), Document(metadata={}, page_content='percentile: \u767e\u5206\u4f4d\u6570\uff0c\u9ed8\u8ba4 95\uff0c\u8be5\u53c2\u6570\u7684\u53d6\u503c\u8303\u56f4\u4e3a 0.0 \u5230 100.0 \u4e4b\u95f4\uff0c\u53ef\u4ee5\u4f7f\u7528 breakpoint_threshold_amount \u8c03\u6574\u53d6\u503c\uff08\u9ed8\u8ba4\u7c7b\u578b\uff09\u3002 standard_deviation\uff1a\u6807\u51c6\u5dee\uff0c\u9ed8\u8ba4 3\uff0c\u53ef\u4ee5\u4f7f\u7528 breakpoint_threshold_amount \u8c03\u6574\u53d6\u503c\u3002 interquartile\uff1a\u56db\u5206\u4f4d\u6570\uff0c\u9ed8\u8ba4 1.5\uff0c\u53ef\u4ee5\u4f7f\u7528 breakpoint_threshold_amount \u8c03\u6574\u53d6\u503c\u3002 gradient\uff1a\u68af\u5ea6\uff0c\u9ed8\u8ba4 95\uff0c\u53ef\u4ee5\u4f7f\u7528 breakpoint_threshold_amount \u8c03\u6574\u53d6\u503c\u3002 \u6ce8\u610f\uff1a\u5982\u679c\u751f\u6210\u7684\u5757\u5927\u5c0f\u592a\u5c0f/\u592a\u5927\uff0c\u53ef\u4ee5\u4f7f\u7528 min_chunk_size \u8fdb\u884c\u8c03\u6574\u3002 ')]\n\u5206\u5757\u6570\u91cf\uff1a2\n</code></pre> <p>\u8c03\u6574\u53e5\u5b50\u65ad\u70b9\u7684\u9608\u503c <code>breakpoint_threshold_amount=50</code>\uff0c\u6d4b\u8bd5\u5206\u5757\u7684\u6548\u679c\u5982\u4e0b\uff1a</p> <pre><code>text_splitter = SemanticChunker(\n    embeddings=embed,\n    breakpoint_threshold_type='percentile',\n    breakpoint_threshold_amount=50,\n    sentence_split_regex=r\"(?&lt;=[\u3002\uff1f\uff01])\\s+\" # \u81ea\u5b9a\u4e49\u53e5\u5b50\u5207\u5206\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5185\u90e8\u4f7f\u7528 re.split(self.sentence_split_regex, text) \u5207\u5206\u53e5\u5b50\n)\n\ndocs = text_splitter.create_documents([text])\nprint(docs)\nprint(f'\u5206\u5757\u6570\u91cf\uff1a{len(docs)}')\n</code></pre> <pre><code>[Document(metadata={}, page_content='\\n\u8981\u5b9e\u4f8b\u5316SemanticChunker\uff0c\u5fc5\u987b\u6307\u5b9a\u4e00\u4e2aEmbeddings\u5b9e\u4f8b\u3002 \u8bed\u4e49\u5206\u5757\u5668\u7684\u5de5\u4f5c\u539f\u7406\u662f\u786e\u5b9a\u4f55\u65f6\u201c\u62c6\u5206\u201d\u53e5\u5b50\uff0c\u5177\u4f53\u65b9\u6cd5\u662f\u67e5\u627e\u4efb\u610f\u4e24\u4e2a\u53e5\u5b50\u4e4b\u95f4\u5d4c\u5165\u7684\u5dee\u5f02\uff0c\u5f53\u5dee\u5f02\u8d85\u8fc7\u67d0\u4e2a\u9608\u503c\u65f6\uff0c\u53e5\u5b50\u5c31\u4f1a\u88ab\u62c6\u5206\u3002 \u6709\u51e0\u79cd\u65b9\u6cd5\u53ef\u4ee5\u786e\u5b9a\u8be5\u9608\u503c\uff0c\u8fd9\u4e9b\u65b9\u6cd5\u7531\u53c2\u6570 breakpoint_threshold_type \u63a7\u5236\u3002'), Document(metadata={}, page_content='percentile: \u767e\u5206\u4f4d\u6570\uff0c\u9ed8\u8ba4 95\uff0c\u8be5\u53c2\u6570\u7684\u53d6\u503c\u8303\u56f4\u4e3a 0.0 \u5230 100.0 \u4e4b\u95f4\uff0c\u53ef\u4ee5\u4f7f\u7528 breakpoint_threshold_amount \u8c03\u6574\u53d6\u503c\uff08\u9ed8\u8ba4\u7c7b\u578b\uff09\u3002 standard_deviation\uff1a\u6807\u51c6\u5dee\uff0c\u9ed8\u8ba4 3\uff0c\u53ef\u4ee5\u4f7f\u7528 breakpoint_threshold_amount \u8c03\u6574\u53d6\u503c\u3002'), Document(metadata={}, page_content='interquartile\uff1a\u56db\u5206\u4f4d\u6570\uff0c\u9ed8\u8ba4 1.5\uff0c\u53ef\u4ee5\u4f7f\u7528 breakpoint_threshold_amount \u8c03\u6574\u53d6\u503c\u3002'), Document(metadata={}, page_content='gradient\uff1a\u68af\u5ea6\uff0c\u9ed8\u8ba4 95\uff0c\u53ef\u4ee5\u4f7f\u7528 breakpoint_threshold_amount \u8c03\u6574\u53d6\u503c\u3002 \u6ce8\u610f\uff1a\u5982\u679c\u751f\u6210\u7684\u5757\u5927\u5c0f\u592a\u5c0f/\u592a\u5927\uff0c\u53ef\u4ee5\u4f7f\u7528 min_chunk_size \u8fdb\u884c\u8c03\u6574\u3002'), Document(metadata={}, page_content='')]\n\u5206\u5757\u6570\u91cf\uff1a5\n</code></pre> <p>\u5176\u4ed6\u51e0\u79cd\u8ba1\u7b97\u76f8\u4f3c\u5ea6\u7684\u65b9\u6cd5\u548c\u9608\u503c\u4e0d\u5728\u8fd9\u91cc\u6f14\u793a\uff0c\u6709\u5174\u8da3\u7684\u53ef\u4ee5\u5c1d\u8bd5\u4fee\u6539 <code>breakpoint_threshold_type</code> \u548c h<code>breakpoint_threshold_amount</code> \u8fdb\u884c\u6d4b\u8bd5 </p>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#markdown","title":"\u6309\u6807\u9898\u62c6\u5206 Markdown","text":""},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#markdownheadertextsplitter","title":"\u4f7f\u7528 MarkdownHeaderTextSplitter","text":"<p><code>MarkdownHeaderTextSplitter</code> \u7c7b\u7684\u4f5c\u7528\u662f\u6839\u636e\u6307\u5b9a\u7684Markdown\u6807\u9898\uff08headers\uff09\u6765\u5206\u5272Markdown\u6587\u6863\u3002\u5b83\u80fd\u591f\u8bc6\u522b\u5e76\u5229\u7528\u6587\u6863\u4e2d\u7684\u6807\u9898\u7ed3\u6784\uff0c\u5c06\u5185\u5bb9\u6309\u7167\u8fd9\u4e9b\u6807\u9898\u8fdb\u884c\u5206\u7ec4\u6216\u5206\u5272\uff0c\u4ece\u800c\u751f\u6210\u5305\u542b\u7279\u5b9a\u6807\u9898\u4e0b\u5185\u5bb9\u7684\u5757\u3002\u6bcf\u4e2a\u5757\u4e0d\u4ec5\u5305\u542b\u4e86\u8be5\u6807\u9898\u4e0b\u7684\u6587\u672c\u5185\u5bb9\uff0c\u8fd8\u4fdd\u7559\u4e86\u4e0e\u8be5\u5185\u5bb9\u76f8\u5173\u7684\u5143\u6570\u636e\uff0c\u5982\u6807\u9898\u5c42\u7ea7\u548c\u6807\u9898\u540d\u79f0\u3002</p> <p>\u5177\u4f53\u6765\u8bf4\uff0c<code>MarkdownHeaderTextSplitter</code> \u7684\u4e3b\u8981\u529f\u80fd\u5305\u62ec\uff1a</p> <ol> <li>\u8bc6\u522b\u6807\u9898\uff1a\u6839\u636e\u63d0\u4f9b\u7684\u6807\u9898\u6807\u8bc6\u7b26\uff08\u4f8b\u5982 #, ## \u7b49\uff09\uff0c\u8bc6\u522b\u51faMarkdown\u6587\u6863\u4e2d\u7684\u5404\u4e2a\u6807\u9898\u3002</li> <li>\u5206\u7ec4\u5185\u5bb9\uff1a\u5c06\u6bcf\u4e2a\u6807\u9898\u4e0b\u7684\u5185\u5bb9\u4f5c\u4e3a\u4e00\u4e2a\u72ec\u7acb\u7684\u5757\u8fdb\u884c\u5206\u7ec4\uff0c\u786e\u4fdd\u6bcf\u4e2a\u5757\u7684\u5185\u5bb9\u90fd\u4e0e\u5176\u6807\u9898\u7d27\u5bc6\u76f8\u5173\u3002</li> <li>\u4fdd\u7559\u5143\u6570\u636e\uff1a\u5728\u751f\u6210\u7684\u6bcf\u4e2a\u5757\u4e2d\uff0c\u4fdd\u7559\u4e0e\u8be5\u5757\u5185\u5bb9\u76f8\u5173\u7684\u5143\u6570\u636e\uff0c\u5982\u6807\u9898\u7684\u5c42\u7ea7\u548c\u540d\u79f0\uff0c\u4ee5\u4fbf\u540e\u7eed\u5904\u7406\u65f6\u80fd\u591f\u66f4\u597d\u5730\u7406\u89e3\u5185\u5bb9\u7684\u4e0a\u4e0b\u6587\u3002</li> </ol> <p>\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c<code>MarkdownHeaderTextSplitter</code> \u80fd\u591f\u5e2e\u52a9\u7528\u6237\u66f4\u6709\u6548\u5730\u7ba1\u7406\u548c\u5904\u7406 <code>Markdown</code> \u6587\u6863\uff0c\u7279\u522b\u662f\u5728\u9700\u8981\u5bf9\u6587\u6863\u8fdb\u884c\u5d4c\u5165\u3001\u5b58\u50a8\u548c\u68c0\u7d22\u7b49\u64cd\u4f5c\u65f6\uff0c\u80fd\u591f\u66f4\u597d\u5730\u4fdd\u6301\u5185\u5bb9\u7684\u7ed3\u6784\u548c\u8bed\u4e49\u5b8c\u6574\u6027\u3002\u8fd9\u5bf9\u4e8e\u6784\u5efa\u9ad8\u6548\u7684\u77e5\u8bc6\u5e93\u3001\u95ee\u7b54\u7cfb\u7edf\u548c\u5176\u4ed6\u57fa\u4e8e\u6587\u672c\u7684\u5e94\u7528\u975e\u5e38\u6709\u5e2e\u52a9\u3002</p> <p>\u5982\u4f55\u5c06 pdf \u548c docx \u6587\u4ef6\u8f6c\u6362\u4e3a markdown \u683c\u5f0f\u6587\u4ef6\uff0c\u53ef\u4ee5\u67e5\u770b\u6211\u524d\u9762\u5199\u7684\u6587\u7ae0 </p> <p>\u8be6\u7ec6\u4f7f\u7528\u793a\u4f8b\u67e5\u770b How to split Markdown by Headers</p> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u4f7f\u7528 markdown \u6587\u672c\u8fdb\u884c\u5206\u5757\u7684\u793a\u4f8b\u3002</p> <p>\u793a\u4f8b\u6587\u672c\uff1a</p> <pre><code>text = \"\"\"\n\u4ee5\u4e0b\u662f\u57fa\u4e8e\u8bed\u4e49\u76f8\u4f3c\u5ea6\u7684\u5206\u5757\u5b9e\u73b0\u601d\u8def\u603b\u7ed3\uff0c\u8be5\u65b9\u6cd5\u901a\u8fc7 **\u5d4c\u5165\u8ddd\u79bb\u68c0\u6d4b\u8bed\u4e49\u8fb9\u754c** \u5b9e\u73b0\u667a\u80fd\u5206\u5757\uff1a\n\n---\n\n### **\u6838\u5fc3\u601d\u8def**\n1. **\u5206\u53e5\u5904\u7406**  \n   \u5c06\u539f\u59cb\u6587\u672c\u6309\u53e5\u5b50\u7c92\u5ea6\u62c6\u5206\uff08\u5982\u4f7f\u7528 `spaCy`\u3001`nltk` \u6216\u6807\u70b9\u89c4\u5219\uff09\u3002\n2. **\u6ed1\u52a8\u7a97\u53e3\u805a\u5408**  \n   \u5c06\u8fde\u7eed\u53e5\u5b50\u7ec4\u6210 **\u7a97\u53e3**\uff08\u5982 3 \u4e2a\u53e5\u5b50\u4e3a\u4e00\u4e2a\u7a97\u53e3\uff09\uff0c\u8ba1\u7b97\u7a97\u53e3\u7684\u5d4c\u5165\u8868\u793a\u3002\n3. **\u5d4c\u5165\u8ddd\u79bb\u8ba1\u7b97**  \n   \u6ed1\u52a8\u7a97\u53e3\u9010\u6b65\u540e\u79fb\uff08\u5982\u6bcf\u6b21\u79fb\u9664\u524d\u4e00\u53e5\uff0c\u6dfb\u52a0\u4e0b\u4e00\u53e5\uff09\uff0c\u8ba1\u7b97\u76f8\u90bb\u7a97\u53e3\u5d4c\u5165\u7684\u76f8\u4f3c\u5ea6\uff08\u5982\u4f59\u5f26\u8ddd\u79bb\uff09\u3002\n4. **\u65ad\u70b9\u68c0\u6d4b**  \n   \u82e5\u76f8\u90bb\u7a97\u53e3\u7684\u5d4c\u5165\u8ddd\u79bb\u8d85\u8fc7\u9884\u8bbe **\u9608\u503c**\uff0c\u5219\u8ba4\u4e3a\u6b64\u5904\u5b58\u5728\u8bed\u4e49\u8fb9\u754c\uff0c\u89e6\u53d1\u5206\u5757\u3002\n5. **\u5408\u5e76\u76f8\u90bb\u5757**  \n   \u5c06\u672a\u89e6\u53d1\u65ad\u70b9\u7684\u76f8\u90bb\u7a97\u53e3\u5408\u5e76\u4e3a\u540c\u4e00\u5757\uff0c\u4fdd\u6301\u8bed\u4e49\u8fde\u8d2f\u6027\u3002\n\n---\n\n### **\u5177\u4f53\u6b65\u9aa4\u793a\u4f8b**\n#### **\u8f93\u5165\u6587\u672c**\n\u53e5\u5b501\uff1a\u6df1\u5ea6\u5b66\u4e60\u662f\u673a\u5668\u5b66\u4e60\u7684\u5206\u652f\u3002\n\u53e5\u5b502\uff1a\u5b83\u901a\u8fc7\u795e\u7ecf\u7f51\u7edc\u6a21\u62df\u4eba\u8111\u7684\u5b66\u4e60\u8fc7\u7a0b\u3002\n\u53e5\u5b503\uff1a\u5e38\u89c1\u7684\u6a21\u578b\u5305\u62ecCNN\u548cRNN\u3002\n\u53e5\u5b504\uff1a\u81ea\u7136\u8bed\u8a00\u5904\u7406\uff08NLP\uff09\u662f\u5176\u91cd\u8981\u5e94\u7528\u9886\u57df\u3002\n\u53e5\u5b505\uff1aBERT\u548cGPT\u662fNLP\u4e2d\u7684\u4ee3\u8868\u6027\u6a21\u578b\u3002  \n\n#### **\u5206\u5757\u8fc7\u7a0b**\n1. **\u7a97\u53e3\u751f\u6210**  \n   - \u7a97\u53e31\uff1a[\u53e5\u5b501, \u53e5\u5b502, \u53e5\u5b503]  \n   - \u7a97\u53e32\uff1a[\u53e5\u5b502, \u53e5\u5b503, \u53e5\u5b504]  \n   - \u7a97\u53e33\uff1a[\u53e5\u5b503, \u53e5\u5b504, \u53e5\u5b505]  \n2. **\u5d4c\u5165\u8ba1\u7b97**  \n   - \u83b7\u53d6\u6bcf\u4e2a\u7a97\u53e3\u7684\u5d4c\u5165\u5411\u91cf\uff08\u5982\u4f7f\u7528 Sentence-BERT\uff09\u3002  \n3. **\u8ddd\u79bb\u6bd4\u8f83**  \n   - \u8ba1\u7b97\u7a97\u53e31\u4e0e\u7a97\u53e32\u7684\u5d4c\u5165\u8ddd\u79bb \u2192 \u5047\u8bbe\u8ddd\u79bb\u8f83\u5c0f\uff08\u4e3b\u9898\u8fde\u7eed\uff1a\u6df1\u5ea6\u5b66\u4e60\u2192\u6a21\u578b\uff09\u3002  \n   - \u8ba1\u7b97\u7a97\u53e32\u4e0e\u7a97\u53e33\u7684\u5d4c\u5165\u8ddd\u79bb \u2192 \u5047\u8bbe\u8ddd\u79bb\u8f83\u5927\uff08\u4e3b\u9898\u5207\u6362\uff1a\u6a21\u578b\u2192NLP\u5e94\u7528\uff09\u3002  \n4. **\u65ad\u70b9\u89e6\u53d1**  \n   - \u5728\u7a97\u53e32\u4e0e\u7a97\u53e33\u4e4b\u95f4\u89e6\u53d1\u5206\u5757\u3002  \n5. **\u6700\u7ec8\u5206\u5757**  \n   - \u57571\uff1a[\u53e5\u5b501, \u53e5\u5b502, \u53e5\u5b503]  \n   - \u57572\uff1a[\u53e5\u5b504, \u53e5\u5b505]\n\n---\n\n### **\u4f18\u70b9\u4e0e\u7f3a\u70b9**\n| **\u4f18\u70b9**                                      | **\u7f3a\u70b9**                                      |\n|----------------------------------------------|----------------------------------------------|\n| \u2705 \u81ea\u9002\u5e94\u8bed\u4e49\u8fb9\u754c\uff0c\u907f\u514d\u673a\u68b0\u5207\u5206                 | \u274c \u8ba1\u7b97\u6210\u672c\u9ad8\uff08\u9700\u591a\u6b21\u5d4c\u5165\u8ba1\u7b97\u548c\u76f8\u4f3c\u5ea6\u6bd4\u8f83\uff09     |\n| \u2705 \u51cf\u5c11\u566a\u58f0\uff08\u7a97\u53e3\u805a\u5408\u964d\u4f4e\u5355\u53e5\u6ce2\u52a8\u5f71\u54cd\uff09          | \u274c \u4f9d\u8d56\u5d4c\u5165\u6a21\u578b\u8d28\u91cf\uff08\u5982\u8bed\u4e49\u8868\u793a\u4e0d\u51c6\u786e\u5219\u5206\u5757\u5931\u6548\uff09|\n| \u2705 \u9002\u914d\u4e0d\u540c\u6587\u672c\u7c7b\u578b\uff08\u6280\u672f\u6587\u6863\u3001\u5bf9\u8bdd\u7b49\uff09          | \u274c \u53c2\u6570\u654f\u611f\uff08\u9700\u8c03\u4f18\u7a97\u53e3\u5927\u5c0f\u3001\u9608\u503c\uff09             |\n\n---\n\n### **\u5173\u952e\u53c2\u6570\u4e0e\u8c03\u4f18\u5efa\u8bae**\n1. **\u7a97\u53e3\u5927\u5c0f**  \n   - \u8fc7\u5c0f\uff1a\u566a\u58f0\u654f\u611f\uff08\u5982\u7a97\u53e3=1\u65f6\u9000\u5316\u4e3a\u5355\u53e5\u6bd4\u8f83\uff09\u3002  \n   - \u8fc7\u5927\uff1a\u8bed\u4e49\u8fb9\u754c\u6a21\u7cca\uff08\u5982\u7a97\u53e3=5\u53ef\u80fd\u63a9\u76d6\u5c40\u90e8\u53d8\u5316\uff09\u3002  \n   - **\u5efa\u8bae\u503c**\uff1a2-4 \u4e2a\u53e5\u5b50\uff08\u6839\u636e\u6587\u672c\u5bc6\u5ea6\u8c03\u6574\uff09\u3002  \n2. **\u76f8\u4f3c\u5ea6\u9608\u503c**  \n   - \u8fc7\u9ad8\uff1a\u5206\u5757\u8fc7\u5c11\uff0c\u5757\u5185\u8bed\u4e49\u6df7\u6742\u3002  \n   - \u8fc7\u4f4e\uff1a\u5206\u5757\u8fc7\u591a\uff0c\u7834\u574f\u8fde\u8d2f\u6027\u3002  \n   - **\u8c03\u4f18\u65b9\u6cd5**\uff1a\u901a\u8fc7\u9a8c\u8bc1\u96c6\u6d4b\u8bd5\u4e0d\u540c\u9608\u503c\u4e0b\u7684\u5206\u5757\u8d28\u91cf\uff08\u5982\u4eba\u5de5\u8bc4\u4f30\u6216\u68c0\u7d22\u53ec\u56de\u7387\uff09\u3002  \n3. **\u5d4c\u5165\u6a21\u578b\u9009\u62e9**  \n   - \u4f18\u5148\u9886\u57df\u9002\u914d\u6a21\u578b\uff08\u5982\u6280\u672f\u6587\u672c\u7528 `all-mpnet-base-v2`\uff0c\u901a\u7528\u6587\u672c\u7528 `text-embedding-3-small`\uff09\u3002\n\n---\n\n### **\u6539\u8fdb\u65b9\u5411**\n1. **\u52a8\u6001\u7a97\u53e3\u8c03\u6574**  \n   \u6839\u636e\u6587\u672c\u590d\u6742\u5ea6\u81ea\u52a8\u6269\u5c55/\u6536\u7f29\u7a97\u53e3\uff08\u5982\u5bc6\u96c6\u6bb5\u843d\u7528\u5c0f\u7a97\u53e3\uff0c\u5197\u4f59\u5185\u5bb9\u7528\u5927\u7a97\u53e3\uff09\u3002  \n2. **\u6df7\u5408\u5206\u5757\u7b56\u7565**  \n   \u5148\u6309\u6807\u9898/\u6bb5\u843d\u7c97\u5206\u5757\uff0c\u518d\u5bf9\u957f\u6bb5\u843d\u5e94\u7528\u8bed\u4e49\u5206\u5757\u3002  \n3. **\u8f7b\u91cf\u5316\u8ba1\u7b97**  \n   - \u4f7f\u7528\u4f4e\u7ef4\u5d4c\u5165\uff08\u5982 PCA \u964d\u7ef4\uff09\u3002  \n   - \u7f13\u5b58\u5d4c\u5165\u7ed3\u679c\u51cf\u5c11\u91cd\u590d\u8ba1\u7b97\u3002  \n\n---\n\n### **\u9002\u7528\u573a\u666f**\n- **\u6280\u672f\u6587\u6863**\uff1a\u7cbe\u51c6\u5207\u5206\u7ae0\u8282\u3001\u6848\u4f8b\u3001\u4ee3\u7801\u5757\u3002  \n- **\u957f\u5bf9\u8bdd\u8bb0\u5f55**\uff1a\u6309\u8bdd\u9898\u5207\u6362\u5206\u5272\u4f1a\u8bdd\u9636\u6bb5\u3002  \n- **\u8de8\u6bb5\u843d\u63a8\u7406\u4efb\u52a1**\uff1a\u786e\u4fdd\u5757\u5185\u8bed\u4e49\u9ad8\u5ea6\u76f8\u5173\u3002  \n\n\u901a\u8fc7\u8be5\u65b9\u6cd5\uff0c\u53ef\u663e\u8457\u63d0\u5347 RAG \u7b49\u5e94\u7528\u4e2d\u68c0\u7d22\u5185\u5bb9\u7684\u8bed\u4e49\u8fde\u8d2f\u6027\u548c\u76f8\u5173\u6027\u3002\n\"\"\"\n</code></pre> <p>\u5206\u5757\u4ee3\u7801\uff1a</p> <pre><code>from langchain_text_splitters import MarkdownHeaderTextSplitter\nfrom langchain_core.documents import Document\nimport json\n\ndef markdown_splitter_by_header(markdown_content: str) -&gt; List[Document]:\n    headers_to_split_on = [\n        (\"#\", \"Header 1\"),\n        (\"##\", \"Header 2\"),\n        (\"###\", \"Header 3\"),\n        (\"####\", \"Header 4\"),\n        (\"#####\", \"Header 5\"),\n        (\"######\", \"Header 6\"),\n        (\"#######\", \"Header 7\"),\n    ]\n\n    # MD splits\n    markdown_splitter = MarkdownHeaderTextSplitter(\n        headers_to_split_on=headers_to_split_on,  # \u5206\u5757\u7684\u6807\u9898\u7ea7\u522b\n        strip_headers=False,  # \u662f\u5426\u53bb\u9664content\u4e2d\u7684\u6807\u9898\n        return_each_line = False # \u662f\u5426\u8fd4\u56de\u5355\u72ec\u884c\uff0c\u4e5f\u5c31\u662f\u6bcf\u4e00\u4e2a\u5355\u72ec\u884c\u4f5c\u4e3a\u4e00\u4e2a\u5206\u5757\n    )\n    md_header_splits = markdown_splitter.split_text(markdown_content)\n    return md_header_splits\n\nchunks = markdown_splitter_by_header(text)\n\nfor chunk in chunks:\n    chunk_dict = chunk.model_dump()\n    json_str = json.dumps(chunk_dict, indent=4, ensure_ascii=False)\n    print(json_str)\n</code></pre> <p>\u8f93\u51fa\u7ed3\u679c\uff1a</p> <pre><code>{\n    \"id\": null,\n    \"metadata\": {},\n    \"page_content\": \"\u4ee5\u4e0b\u662f\u57fa\u4e8e\u8bed\u4e49\u76f8\u4f3c\u5ea6\u7684\u5206\u5757\u5b9e\u73b0\u601d\u8def\u603b\u7ed3\uff0c\u8be5\u65b9\u6cd5\u901a\u8fc7 **\u5d4c\u5165\u8ddd\u79bb\u68c0\u6d4b\u8bed\u4e49\u8fb9\u754c** \u5b9e\u73b0\u667a\u80fd\u5206\u5757\uff1a  \\n---\",\n    \"type\": \"Document\"\n}\n{\n    \"id\": null,\n    \"metadata\": {\n        \"Header 3\": \"**\u6838\u5fc3\u601d\u8def**\"\n    },\n    \"page_content\": \"### **\u6838\u5fc3\u601d\u8def**\\n1. **\u5206\u53e5\u5904\u7406**\\n\u5c06\u539f\u59cb\u6587\u672c\u6309\u53e5\u5b50\u7c92\u5ea6\u62c6\u5206\uff08\u5982\u4f7f\u7528 `spaCy`\u3001`nltk` \u6216\u6807\u70b9\u89c4\u5219\uff09\u3002\\n2. **\u6ed1\u52a8\u7a97\u53e3\u805a\u5408**\\n\u5c06\u8fde\u7eed\u53e5\u5b50\u7ec4\u6210 **\u7a97\u53e3**\uff08\u5982 3 \u4e2a\u53e5\u5b50\u4e3a\u4e00\u4e2a\u7a97\u53e3\uff09\uff0c\u8ba1\u7b97\u7a97\u53e3\u7684\u5d4c\u5165\u8868\u793a\u3002\\n3. **\u5d4c\u5165\u8ddd\u79bb\u8ba1\u7b97**\\n\u6ed1\u52a8\u7a97\u53e3\u9010\u6b65\u540e\u79fb\uff08\u5982\u6bcf\u6b21\u79fb\u9664\u524d\u4e00\u53e5\uff0c\u6dfb\u52a0\u4e0b\u4e00\u53e5\uff09\uff0c\u8ba1\u7b97\u76f8\u90bb\u7a97\u53e3\u5d4c\u5165\u7684\u76f8\u4f3c\u5ea6\uff08\u5982\u4f59\u5f26\u8ddd\u79bb\uff09\u3002\\n4. **\u65ad\u70b9\u68c0\u6d4b**\\n\u82e5\u76f8\u90bb\u7a97\u53e3\u7684\u5d4c\u5165\u8ddd\u79bb\u8d85\u8fc7\u9884\u8bbe **\u9608\u503c**\uff0c\u5219\u8ba4\u4e3a\u6b64\u5904\u5b58\u5728\u8bed\u4e49\u8fb9\u754c\uff0c\u89e6\u53d1\u5206\u5757\u3002\\n5. **\u5408\u5e76\u76f8\u90bb\u5757**\\n\u5c06\u672a\u89e6\u53d1\u65ad\u70b9\u7684\u76f8\u90bb\u7a97\u53e3\u5408\u5e76\u4e3a\u540c\u4e00\u5757\uff0c\u4fdd\u6301\u8bed\u4e49\u8fde\u8d2f\u6027\u3002  \\n---\",\n    \"type\": \"Document\"\n}\n{\n    \"id\": null,\n    \"metadata\": {\n        \"Header 3\": \"**\u5177\u4f53\u6b65\u9aa4\u793a\u4f8b**\",\n        \"Header 4\": \"**\u8f93\u5165\u6587\u672c**\"\n    },\n    \"page_content\": \"### **\u5177\u4f53\u6b65\u9aa4\u793a\u4f8b**  \\n#### **\u8f93\u5165\u6587\u672c**\\n```\\n\u53e5\u5b501\uff1a\u6df1\u5ea6\u5b66\u4e60\u662f\u673a\u5668\u5b66\u4e60\u7684\u5206\u652f\u3002\\n\u53e5\u5b502\uff1a\u5b83\u901a\u8fc7\u795e\u7ecf\u7f51\u7edc\u6a21\u62df\u4eba\u8111\u7684\u5b66\u4e60\u8fc7\u7a0b\u3002\\n\u53e5\u5b503\uff1a\u5e38\u89c1\u7684\u6a21\u578b\u5305\u62ecCNN\u548cRNN\u3002\\n\u53e5\u5b504\uff1a\u81ea\u7136\u8bed\u8a00\u5904\u7406\uff08NLP\uff09\u662f\u5176\u91cd\u8981\u5e94\u7528\u9886\u57df\u3002\\n\u53e5\u5b505\uff1aBERT\u548cGPT\u662fNLP\u4e2d\u7684\u4ee3\u8868\u6027\u6a21\u578b\u3002\\n```\",\n    \"type\": \"Document\"\n}\n{\n    \"id\": null,\n    \"metadata\": {\n        \"Header 3\": \"**\u5177\u4f53\u6b65\u9aa4\u793a\u4f8b**\",\n        \"Header 4\": \"**\u5206\u5757\u8fc7\u7a0b**\"\n    },\n    \"page_content\": \"#### **\u5206\u5757\u8fc7\u7a0b**\\n1. **\u7a97\u53e3\u751f\u6210**\\n- \u7a97\u53e31\uff1a[\u53e5\u5b501, \u53e5\u5b502, \u53e5\u5b503]\\n- \u7a97\u53e32\uff1a[\u53e5\u5b502, \u53e5\u5b503, \u53e5\u5b504]\\n- \u7a97\u53e33\uff1a[\u53e5\u5b503, \u53e5\u5b504, \u53e5\u5b505]\\n2. **\u5d4c\u5165\u8ba1\u7b97**\\n- \u83b7\u53d6\u6bcf\u4e2a\u7a97\u53e3\u7684\u5d4c\u5165\u5411\u91cf\uff08\u5982\u4f7f\u7528 Sentence-BERT\uff09\u3002\\n3. **\u8ddd\u79bb\u6bd4\u8f83**\\n- \u8ba1\u7b97\u7a97\u53e31\u4e0e\u7a97\u53e32\u7684\u5d4c\u5165\u8ddd\u79bb \u2192 \u5047\u8bbe\u8ddd\u79bb\u8f83\u5c0f\uff08\u4e3b\u9898\u8fde\u7eed\uff1a\u6df1\u5ea6\u5b66\u4e60\u2192\u6a21\u578b\uff09\u3002\\n- \u8ba1\u7b97\u7a97\u53e32\u4e0e\u7a97\u53e33\u7684\u5d4c\u5165\u8ddd\u79bb \u2192 \u5047\u8bbe\u8ddd\u79bb\u8f83\u5927\uff08\u4e3b\u9898\u5207\u6362\uff1a\u6a21\u578b\u2192NLP\u5e94\u7528\uff09\u3002\\n4. **\u65ad\u70b9\u89e6\u53d1**\\n- \u5728\u7a97\u53e32\u4e0e\u7a97\u53e33\u4e4b\u95f4\u89e6\u53d1\u5206\u5757\u3002\\n5. **\u6700\u7ec8\u5206\u5757**\\n- \u57571\uff1a[\u53e5\u5b501, \u53e5\u5b502, \u53e5\u5b503]\\n- \u57572\uff1a[\u53e5\u5b504, \u53e5\u5b505]  \\n---\",\n    \"type\": \"Document\"\n}\n{\n    \"id\": null,\n    \"metadata\": {\n        \"Header 3\": \"**\u4f18\u70b9\u4e0e\u7f3a\u70b9**\"\n    },\n    \"page_content\": \"### **\u4f18\u70b9\u4e0e\u7f3a\u70b9**\\n| **\u4f18\u70b9**                                      | **\u7f3a\u70b9**                                      |\\n|----------------------------------------------|----------------------------------------------|\\n| \u2705 \u81ea\u9002\u5e94\u8bed\u4e49\u8fb9\u754c\uff0c\u907f\u514d\u673a\u68b0\u5207\u5206                 | \u274c \u8ba1\u7b97\u6210\u672c\u9ad8\uff08\u9700\u591a\u6b21\u5d4c\u5165\u8ba1\u7b97\u548c\u76f8\u4f3c\u5ea6\u6bd4\u8f83\uff09     |\\n| \u2705 \u51cf\u5c11\u566a\u58f0\uff08\u7a97\u53e3\u805a\u5408\u964d\u4f4e\u5355\u53e5\u6ce2\u52a8\u5f71\u54cd\uff09          | \u274c \u4f9d\u8d56\u5d4c\u5165\u6a21\u578b\u8d28\u91cf\uff08\u5982\u8bed\u4e49\u8868\u793a\u4e0d\u51c6\u786e\u5219\u5206\u5757\u5931\u6548\uff09|\\n| \u2705 \u9002\u914d\u4e0d\u540c\u6587\u672c\u7c7b\u578b\uff08\u6280\u672f\u6587\u6863\u3001\u5bf9\u8bdd\u7b49\uff09          | \u274c \u53c2\u6570\u654f\u611f\uff08\u9700\u8c03\u4f18\u7a97\u53e3\u5927\u5c0f\u3001\u9608\u503c\uff09             |  \\n---\",\n    \"type\": \"Document\"\n}\n{\n    \"id\": null,\n    \"metadata\": {\n        \"Header 3\": \"**\u5173\u952e\u53c2\u6570\u4e0e\u8c03\u4f18\u5efa\u8bae**\"\n    },\n    \"page_content\": \"### **\u5173\u952e\u53c2\u6570\u4e0e\u8c03\u4f18\u5efa\u8bae**\\n1. **\u7a97\u53e3\u5927\u5c0f**\\n- \u8fc7\u5c0f\uff1a\u566a\u58f0\u654f\u611f\uff08\u5982\u7a97\u53e3=1\u65f6\u9000\u5316\u4e3a\u5355\u53e5\u6bd4\u8f83\uff09\u3002\\n- \u8fc7\u5927\uff1a\u8bed\u4e49\u8fb9\u754c\u6a21\u7cca\uff08\u5982\u7a97\u53e3=5\u53ef\u80fd\u63a9\u76d6\u5c40\u90e8\u53d8\u5316\uff09\u3002\\n- **\u5efa\u8bae\u503c**\uff1a2-4 \u4e2a\u53e5\u5b50\uff08\u6839\u636e\u6587\u672c\u5bc6\u5ea6\u8c03\u6574\uff09\u3002\\n2. **\u76f8\u4f3c\u5ea6\u9608\u503c**\\n- \u8fc7\u9ad8\uff1a\u5206\u5757\u8fc7\u5c11\uff0c\u5757\u5185\u8bed\u4e49\u6df7\u6742\u3002\\n- \u8fc7\u4f4e\uff1a\u5206\u5757\u8fc7\u591a\uff0c\u7834\u574f\u8fde\u8d2f\u6027\u3002\\n- **\u8c03\u4f18\u65b9\u6cd5**\uff1a\u901a\u8fc7\u9a8c\u8bc1\u96c6\u6d4b\u8bd5\u4e0d\u540c\u9608\u503c\u4e0b\u7684\u5206\u5757\u8d28\u91cf\uff08\u5982\u4eba\u5de5\u8bc4\u4f30\u6216\u68c0\u7d22\u53ec\u56de\u7387\uff09\u3002\\n3. **\u5d4c\u5165\u6a21\u578b\u9009\u62e9**\\n- \u4f18\u5148\u9886\u57df\u9002\u914d\u6a21\u578b\uff08\u5982\u6280\u672f\u6587\u672c\u7528 `all-mpnet-base-v2`\uff0c\u901a\u7528\u6587\u672c\u7528 `text-embedding-3-small`\uff09\u3002  \\n---\",\n    \"type\": \"Document\"\n}\n{\n    \"id\": null,\n    \"metadata\": {\n        \"Header 3\": \"**\u6539\u8fdb\u65b9\u5411**\"\n    },\n    \"page_content\": \"### **\u6539\u8fdb\u65b9\u5411**\\n1. **\u52a8\u6001\u7a97\u53e3\u8c03\u6574**\\n\u6839\u636e\u6587\u672c\u590d\u6742\u5ea6\u81ea\u52a8\u6269\u5c55/\u6536\u7f29\u7a97\u53e3\uff08\u5982\u5bc6\u96c6\u6bb5\u843d\u7528\u5c0f\u7a97\u53e3\uff0c\u5197\u4f59\u5185\u5bb9\u7528\u5927\u7a97\u53e3\uff09\u3002\\n2. **\u6df7\u5408\u5206\u5757\u7b56\u7565**\\n\u5148\u6309\u6807\u9898/\u6bb5\u843d\u7c97\u5206\u5757\uff0c\u518d\u5bf9\u957f\u6bb5\u843d\u5e94\u7528\u8bed\u4e49\u5206\u5757\u3002\\n3. **\u8f7b\u91cf\u5316\u8ba1\u7b97**\\n- \u4f7f\u7528\u4f4e\u7ef4\u5d4c\u5165\uff08\u5982 PCA \u964d\u7ef4\uff09\u3002\\n- \u7f13\u5b58\u5d4c\u5165\u7ed3\u679c\u51cf\u5c11\u91cd\u590d\u8ba1\u7b97\u3002  \\n---\",\n    \"type\": \"Document\"\n}\n{\n    \"id\": null,\n    \"metadata\": {\n        \"Header 3\": \"**\u9002\u7528\u573a\u666f**\"\n    },\n    \"page_content\": \"### **\u9002\u7528\u573a\u666f**\\n- **\u6280\u672f\u6587\u6863**\uff1a\u7cbe\u51c6\u5207\u5206\u7ae0\u8282\u3001\u6848\u4f8b\u3001\u4ee3\u7801\u5757\u3002\\n- **\u957f\u5bf9\u8bdd\u8bb0\u5f55**\uff1a\u6309\u8bdd\u9898\u5207\u6362\u5206\u5272\u4f1a\u8bdd\u9636\u6bb5\u3002\\n- **\u8de8\u6bb5\u843d\u63a8\u7406\u4efb\u52a1**\uff1a\u786e\u4fdd\u5757\u5185\u8bed\u4e49\u9ad8\u5ea6\u76f8\u5173\u3002  \\n\u901a\u8fc7\u8be5\u65b9\u6cd5\uff0c\u53ef\u663e\u8457\u63d0\u5347 RAG \u7b49\u5e94\u7528\u4e2d\u68c0\u7d22\u5185\u5bb9\u7684\u8bed\u4e49\u8fde\u8d2f\u6027\u548c\u76f8\u5173\u6027\u3002\",\n    \"type\": \"Document\"\n}\n</code></pre>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#_18","title":"\u5982\u4f55\u9650\u5236\u5757\u7684\u5927\u5c0f","text":"<p>\u4ece\u524d\u9762\u5206\u5757\u7684\u7ed3\u679c\u53ef\u4ee5\u770b\u5230\uff0cmarkdown \u6587\u672c\u6309\u7167\u6807\u9898\u7684\u5c42\u7ea7\u7ed3\u6784\u5206\u5757\uff0c\u4ece\u524d\u9762\u7684\u7ed3\u679c\u53ef\u4ee5\u5206\u5757\u8fd8\u662f\u6bd4\u8f83\u7b26\u5408\u9884\u671f\u7684\u3002</p> <p>\u4f46\u662f\u5b58\u5728\u4e00\u4e2a\u95ee\u9898\uff0c\u5982\u679c\u4e00\u4e2a\u6807\u9898\u4e0b\u9762\u7684\u6587\u672c\u5185\u5bb9\u592a\u957f\uff0c\u90a3\u4e48\u9700\u8981\u9650\u5236\u5757\u7684\u5927\u5c0f\uff0c\u4e5f\u5c31\u662f\u9700\u8981\u5bf9\u540c\u4e00\u4e2a\u6807\u9898\u4e0b\u7684\u6587\u672c\u7ee7\u7eed\u5206\u5757\uff0c\u53ef\u4ee5\u7ed3\u5408 <code>RecursiveCharacterTextSplitter</code> \u6765\u8fdb\u4e00\u6b65\u63a7\u5236\u5757\u7684\u5927\u5c0f</p> <pre><code>from transformers import PreTrainedTokenizerBase\n\ndef text_splitter_by_token_num(docs: List[Document],\n                               chunk_size: int = 512,\n                               chunk_overlap: int = 0,\n                               tokenizer: Optional[PreTrainedTokenizerBase] = None,\n                               separators: Optional[List[str]] = None) -&gt; List[Document]:\n    \"\"\"\n    \u6309\u7167token\u6570\u62c6\u5206\u6587\u672c\n    :param separators: chunk \u5206\u9694\u7b26\u5217\u8868\n    :param docs: \u6587\u6863\u5217\u8868\n    :param tokenizer: \u5206\u8bcd\u5668\n    :param chunk_size: \u6bcf\u4e2achunk\u7684token\u6570\n    :param chunk_overlap: \u91cd\u53e0\u90e8\u5206\u7684token\u6570\n\n    :return:\n    \"\"\"\n    if separators is None:\n        separators = [\"\\n\\n\", \"\\n\", \".\", \"\u3002\"]\n    if tokenizer:\n        text_splitter = RecursiveCharacterTextSplitter.from_huggingface_tokenizer(\n            tokenizer,\n            chunk_size=chunk_size,\n            chunk_overlap=chunk_overlap,\n            separators=separators,\n        )\n    else:\n        text_splitter = RecursiveCharacterTextSplitter(\n            chunk_size=chunk_size,\n            chunk_overlap=chunk_overlap,\n            separators=separators,\n        )\n    results = []\n    for doc in docs:\n        if not doc.page_content:\n            continue\n        else:\n            content = doc.page_content\n            splits = text_splitter.split_text(text=content)\n            for split in splits:\n                if not split:\n                    continue\n                else:\n                    metadata = deepcopy(doc.metadata)\n                    new_doc = Document(page_content=split, metadata=metadata)\n                    results.append(new_doc)\n    return results\n</code></pre>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#markdown_1","title":"markdown \u5206\u5757\u5176\u4ed6\u6311\u6218","text":"<ul> <li>\u5982\u4f55\u63d0\u53d6markdown\u6587\u4ef6\u4e2d\u7684\u5b8c\u6574\u8868\u683c\uff0c\u4e5f\u5c31\u662f\u5c3d\u53ef\u80fd\u5c06\u8868\u683c\u653e\u5728\u4e00\u4e2a\u5206\u5757\u4e2d\u3002</li> <li>\u5982\u4f55\u63d0\u53d6markdown\u6587\u4ef6\u4e2d\u7684\u5b8c\u6574\u4ee3\u7801\u5757\uff0c\u4e5f\u5c31\u662f\u5c3d\u53ef\u80fd\u5c06\u4ee3\u7801\u5757\u653e\u5728\u4e00\u4e2a\u5206\u5757\u4e2d\u3002</li> <li>\u5982\u4f55\u63d0\u53d6\u548c\u8bc6\u522bmarkdown\u6587\u4ef6\u4e2d\u7684\u56fe\u7247\uff0c\u5c06\u56fe\u7247\u5185\u5bb9\u8bc6\u522b\u51fa\u6765\u653e\u5728\u4e00\u4e2a\u5206\u5757\u4e2d\u3002</li> </ul> <p>\u5173\u4e8e\u8fd9\u51e0\u4e2a\u95ee\u9898\uff0c\u4f1a\u5728\u540e\u7eed\u6587\u7ae0\u4e2d\u4ecb\u7ecd\uff0c\u8bf7\u7ee7\u7eed\u5173\u6ce8\u3002</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#_19","title":"\u52a8\u6001\u5206\u5757","text":"<p>\u5173\u4e8e\u52a8\u6001\u5206\u5757\u7684\u57fa\u672c\u601d\u8def\u662f\uff1a\u6839\u636e\u8f93\u5165\u6587\u4ef6\u7684\u7c7b\u578b\u52a8\u6001\u7684\u9009\u9879\u5bf9\u5e94\u7684\u5206\u5757\u903b\u8f91\uff0c\u5206\u5757\u903b\u8f91\u4f7f\u7528langchain\u7684\u5b9e\u73b0\uff1a</p> <p>json\u6587\u4ef6\uff1a<code>RecursiveJsonSplitter</code></p> <p>html\u6587\u4ef6\u9009\u62e9\u5408\u9002\u7684\uff1a</p> <ul> <li>\u4f7f\u7528<code>HTMLHeaderTextSplitter</code>\u60c5\u51b5\uff1a\u9700\u8981\u6839\u636e\u6807\u9898\u5c42\u6b21\u7ed3\u6784\u62c6\u5206 HTML \u6587\u6863\u5e76\u7ef4\u62a4\u6709\u5173\u6807\u9898\u7684\u5143\u6570\u636e\u3002</li> <li>\u4f7f\u7528<code>HTMLSectionSplitter</code>\u60c5\u51b5\uff1a\u9700\u8981\u5c06\u6587\u6863\u62c6\u5206\u4e3a\u66f4\u5927\u3001\u66f4\u901a\u7528\u7684\u90e8\u5206\uff0c\u53ef\u80fd\u57fa\u4e8e\u81ea\u5b9a\u4e49\u6807\u7b7e\u6216\u5b57\u4f53\u5927\u5c0f\u3002</li> <li>\u4f7f\u7528<code>HTMLSemanticPreservingSplitter</code>\u60c5\u51b5\uff1a\u9700\u8981\u5c06\u6587\u6863\u62c6\u5206\u6210\u5757\uff0c\u540c\u65f6\u4fdd\u7559\u8868\u683c\u548c\u5217\u8868\u7b49\u8bed\u4e49\u5143\u7d20\uff0c\u786e\u4fdd\u5b83\u4eec\u4e0d\u4f1a\u88ab\u62c6\u5206\u5e76\u4e14\u5b83\u4eec\u7684\u4e0a\u4e0b\u6587\u5f97\u5230\u7ef4\u62a4\u3002</li> </ul> <p>markdown\u6587\u4ef6\uff1a<code>MarkdownHeaderTextSplitter</code></p>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E5%AE%9E%E8%B7%B5%E7%AF%87/#_20","title":"\u603b\u7ed3","text":"<p>\u6700\u540e\u603b\u7ed3\u4e00\u4e0b\u5404\u4e2a\u5206\u5757\u65b9\u6cd5\u7684\u4f18\u7f3a\u70b9\u5982\u4e0b\uff1a</p> \u5206\u5757\u65b9\u6cd5 \u65b9\u6cd5\u63cf\u8ff0 \u4f18\u70b9 \u7f3a\u70b9 \u6309\u5b57\u7b26\u5206\u5757 \u57fa\u4e8e\u56fa\u5b9a\u5b57\u7b26\u6570\u5207\u5206\u6587\u672c\uff08\u5982\u6bcf 200 \u4e2a\u5b57\u7b26\u4e00\u4e2a\u5757\uff09\u3002 \u2705 \u5b9e\u73b0\u7b80\u5355   \u2705 \u65e0\u9700\u4f9d\u8d56\u5206\u8bcd\u5de5\u5177 \u274c \u7834\u574f\u5355\u8bcd/\u53e5\u5b50\u7ed3\u6784   \u274c \u591a\u8bed\u8a00\u9002\u914d\u6027\u5dee \u6309 Token \u5206\u5757 \u57fa\u4e8e\u6a21\u578b\u5206\u8bcd\u5668\uff08Tokenizer\uff09\u7684 token \u6570\u5207\u5206\uff08\u5982\u6bcf 256 tokens \u4e00\u4e2a\u5757\uff09\u3002 \u2705 \u9002\u914d\u6a21\u578b\u8f93\u5165\u9650\u5236   \u2705 \u8ba1\u7b97\u6210\u672c\u4f4e \u274c \u53ef\u80fd\u5207\u65ad\u8bed\u4e49\u8fb9\u754c   \u274c \u4f9d\u8d56\u5206\u8bcd\u5668\u6027\u80fd \u6309\u8bed\u4e49\u5206\u5757 \u5229\u7528 NLP \u5de5\u5177\u6216\u89c4\u5219\u8bc6\u522b\u8bed\u4e49\u8fb9\u754c\uff08\u5982\u53e5\u5b50\u3001\u6bb5\u843d\u3001\u7ae0\u8282\uff09\u3002 \u2705 \u4fdd\u7559\u8bed\u4e49\u5b8c\u6574\u6027   \u2705 \u9002\u914d\u7ed3\u6784\u5316\u6587\u672c \u274c \u4f9d\u8d56\u6587\u672c\u7ed3\u6784\u6216\u6a21\u578b   \u274c \u8ba1\u7b97\u6210\u672c\u9ad8 \u6309 Markdown \u5c42\u6b21\u5316\u5206\u5757 \u6839\u636e Markdown \u6807\u9898\u5c42\u7ea7\uff08\u5982 <code>#</code>\u3001<code>##</code>\uff09\u5212\u5206\u5757\uff0c\u4fdd\u7559\u6587\u6863\u7ed3\u6784\u3002 \u2705 \u4fdd\u6301\u6587\u6863\u903b\u8f91\u7ed3\u6784   \u2705 \u65e0\u9700\u590d\u6742 NLP \u5904\u7406 \u274c \u4ec5\u652f\u6301 Markdown \u683c\u5f0f   \u274c \u683c\u5f0f\u9519\u8bef\u5bfc\u81f4\u5206\u5757\u5931\u8d25 \u52a8\u6001\u5206\u5757 \u6839\u636e\u6587\u6863\u7c7b\u578b\u548c\u5185\u5bb9\u52a8\u6001\u8c03\u6574\u5757\u5927\u5c0f\uff08\u5982html\u6587\u4ef6\uff0cjson\u6587\u4ef6\uff0c\u4ee3\u7801\u7b49\u4f7f\u7528\u4e0d\u540c\u7684\u5206\u5757\u7b56\u7565\uff09\u3002 \u2705 \u7075\u6d3b\u9002\u914d\u6587\u672c\u7279\u6027   \u2705 \u4f18\u5316\u4fe1\u606f\u8986\u76d6\u7387 \u274c \u5b9e\u73b0\u590d\u6742\u5ea6\u9ad8   \u274c \u9700\u5b9a\u5236\u89c4\u5219\u6216\u6a21\u578b <p>\u4e0b\u4e00\u7bc7\u6587\u7ae0\u5c06\u4ecb\u7ecd\u5982\u4f55\u5c06\u5206\u5757\u540e\u7684\u5185\u5bb9\u5b58\u50a8\u5230\u5411\u91cf\u6570\u636e\u5e93\u4e2d\uff0c\u4ee5\u4fbfRAG\u5e94\u7528\u68c0\u7d22\uff0c\u8bf7\u7ee7\u7eed\u5173\u6ce8\u3002</p> <p>\u53c2\u8003\u6587\u6863\uff1a</p> <p>https://python.langchain.com/docs/how_to/</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E7%90%86%E8%AE%BA%E7%AF%87/","title":"\u3010RAG\u3011chunk\u5206\u5757\u7406\u8bba\u7bc7","text":"<p>RAG \u7684\u5c3d\u5934\u5c31\u662f Agent </p>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E7%90%86%E8%AE%BA%E7%AF%87/#_1","title":"\u6982\u8ff0","text":"<p>\u672c\u6587\u662fRAG\u4f18\u5316\u7cfb\u5217\u7684\u7b2c\u4e09\u7bc7\u6587\u7ae0\uff0c\u524d\u9762\u4e24\u7bc7\u6587\u7ae0\u5206\u522b\u662f\uff1a</p> <ul> <li>\u3010RAG\u4f18\u5316\u3011\u5c06pdf\u548cdocx\u8f6c\u6362\u4e3amarkdown\u683c\u5f0f</li> <li>\u3010RAG\u4f18\u5316\u3011docling\u7ed3\u5408OCR\u5b9e\u73b0pdf\u8f6cmarkdown</li> </ul> <p>\u524d\u9762\u4e24\u7bc7\u6587\u7ae0\u4e3b\u8981\u4ecb\u7ecd\u4e86\u5982\u4f55\u5c06 pdf \u548c docx \u6587\u4ef6\u8f6c\u6362\u4e3a markdown \u683c\u5f0f\u6587\u4ef6\uff0c\u63a5\u4e0b\u6765\u6211\u4ece\u4e0b\u9762\u51e0\u4e2a\u65b9\u9762\u4ecb\u7ecd RAG \u5e94\u7528\u4e2d\u975e\u5e38\u91cd\u8981\u7684\u4e00\u5757 chunk \u5206\u5757\uff1a</p> <ol> <li>RAG\u4e0eLong-Context\u4e4b\u4e89</li> <li>\u4e3a\u4ec0\u4e48\u5728RAG\uff08\u68c0\u7d22\u589e\u5f3a\u751f\u6210\uff09\u5e94\u7528\u4e2d\u9700\u8981\u5206\u5757chunk\uff1f</li> <li>chunk\u5206\u5757\u9700\u8981\u8003\u8651\u54ea\u4e9b\u95ee\u9898\uff1f</li> <li>chunk\u5206\u5757\u65b9\u6cd5\u6709\u54ea\u4e9b\uff1f</li> </ol> <p>\u901a\u8fc7\u672c\u6587\u7684\u5b66\u4e60\u4f60\u5c06\u5bf9 chunk \u5206\u5757\u6709\u66f4\u52a0\u6df1\u5165\u7684\u4e86\u89e3\uff0c\u53ef\u4ee5\u5e2e\u52a9\u5728 RAG \u5e94\u7528\u4e2d\u4e00\u5b9a\u7a0b\u5ea6\u63d0\u9ad8\u95ee\u7b54\u7684\u51c6\u786e\u7387\u3002</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E7%90%86%E8%AE%BA%E7%AF%87/#raglong-context","title":"RAG\u4e0eLong-Context\u4e4b\u4e89","text":"<p>\u5728\u7ee7\u7eed\u4ecb\u7ecd chunk \u5206\u5757\u65b9\u6cd5\u4e4b\u524d\uff0c\u6709\u5fc5\u8981\u5148\u4e86\u89e3\u4e00\u4e0b RAG \u548c Long-Context\uff0c\u5728\u77e5\u4e4e\u4e0a\u9762\u6709\u4e00\u4e2a\u8bdd\u9898\uff1a</p> <p>RAG\uff08\u68c0\u7d22\u589e\u5f3a\u751f\u6210\uff09\u4f1a\u4e0d\u4f1a\u6d88\u4ea1\u5462\uff1f\u4e00\u65e6\u5927\u6a21\u578b\u7684Context Length\u53d8\u5927\uff0cRAG\u8fd8\u6709\u5b58\u6d3b\u7684\u5fc5\u8981\u5417\uff1f</p> <p>\u968f\u7740\u5927\u6a21\u578b\u4e0a\u4e0b\u6587 sequence \u652f\u6301\u957f\u5ea6\u8d8a\u6765\u8d8a\u957f\uff0c\u5f88\u591a\u5b9e\u8df5\u548c\u5de5\u4f5c\u53d1\u73b0\uff0c\u5176\u5b9e RAG \u505a\u7684\u4e8b\u60c5\u4f3c\u4e4e\u53ef\u4ee5\u7528\u5f88\u957f\u7684\u4e0a\u4e0b\u6587\u7ed9\u5230\u5927\u6a21\u578b\u7406\u89e3\u3002\u6bd4\u5982\u53ef\u4ee5\u5c06\u4e00\u672c\u4e66\u76f4\u63a5\u4e22\u7ed9\u5927\u6a21\u578b\uff0c\u662f\u4e0d\u662f\u5c31\u4e0d\u9700\u8981\u5206\u5757chunk\u548c\u68c0\u7d22\u4e86\u5462\uff1f\u8fd9\u4e5f\u662f\u5927\u5bb6\u7684\u6240\u201c\u4e89\u201d\u4e4b\u5904\uff0c\u56e0\u4e3a\u5927\u6a21\u578b\u53ef\u4ee5\u63a5\u53d7\u7684\u957f\u5ea6\u8d8a\u957f\uff0c\u90a3\u4e48\u68c0\u7d22\u7684\u91cd\u8981\u6027\u5c31\u4f1a\u964d\u4f4e\uff0c\u5bf9\u68c0\u7d22\u6548\u679c\u7684\u4f9d\u8d56\u5c31\u4f1a\u964d\u4f4e\uff0c\u4e5f\u5c31\u662f\u4e3a\u4ec0\u4e48\u6709\u4eba\u6301\u89c2\u70b9\uff0c\u672a\u6765\u6ca1\u6709RAG\uff0c\u53ea\u6709Long-Context\u3002\u4f46\u5927\u6a21\u578b\u968f\u7740\u8f93\u5165\u957f\u5ea6\u8d8a\u957f\uff0cKV Cache\u6240\u5360\u8d44\u6e90\u5c31\u8d8a\u591a\uff0c\u6210\u672c\u4e5f\u4f1a\u5267\u589e\uff0c\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48\u6709\u4eba\u6301\u89c2\u70b9\uff0c\u672a\u6765\u4e5f\u4f1a\u6709RAG\u3002</p> <p>\u63a5\u4e0b\u6765\u5206\u6790RAG\uff08\u68c0\u7d22\u589e\u5f3a\u751f\u6210\uff09\u4e0e\u957f\u4e0a\u4e0b\u6587\u6a21\u578b\uff08Long-Context Models\uff09\u4e4b\u95f4\u7684\u533a\u522b\u3002</p> <p>\u5728\u81ea\u7136\u8bed\u8a00\u5904\u7406\u9886\u57df\uff0cRAG\uff08\u68c0\u7d22\u589e\u5f3a\u751f\u6210\uff09\u4e0e\u957f\u4e0a\u4e0b\u6587\u6a21\u578b\uff08Long-Context Models\uff09\u4ee3\u8868\u4e86\u4e24\u79cd\u5904\u7406\u957f\u6587\u672c\u7684\u6838\u5fc3\u6280\u672f\u8def\u7ebf\u3002\u4e8c\u8005\u7684\u6838\u5fc3\u76ee\u6807\u90fd\u662f\u89e3\u51b3\u6a21\u578b\u5bf9\u957f\u6587\u672c\u7684\u7406\u89e3\u548c\u751f\u6210\u95ee\u9898\uff0c\u4f46\u5b9e\u73b0\u65b9\u5f0f\u4e0e\u9002\u7528\u573a\u666f\u5b58\u5728\u663e\u8457\u5dee\u5f02\u3002\u4ee5\u4e0b\u4ece\u6280\u672f\u539f\u7406\u3001\u4f18\u52bf\u52a3\u52bf\u3001\u9002\u7528\u573a\u666f\u548c\u672a\u6765\u8d8b\u52bf\u56db\u4e2a\u7ef4\u5ea6\u5c55\u5f00\u5bf9\u6bd4\u5206\u6790\uff1a</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E7%90%86%E8%AE%BA%E7%AF%87/#_2","title":"\u6280\u672f\u539f\u7406\u5bf9\u6bd4","text":"\u6280\u672f \u6838\u5fc3\u601d\u60f3 \u5178\u578b\u5b9e\u73b0 RAG \u901a\u8fc7\u68c0\u7d22\u5916\u90e8\u77e5\u8bc6\u5e93\u83b7\u53d6\u76f8\u5173\u4fe1\u606f\uff0c\u4e0e\u7528\u6237\u8f93\u5165\u5408\u5e76\u540e\u8f93\u5165\u751f\u6210\u6a21\u578b\u3002 \u5206\u5757\u7d22\u5f15\u6587\u6863 \u2192 \u68c0\u7d22\u76f8\u5173\u6bb5\u843d \u2192 \u62fc\u63a5\u4e0a\u4e0b\u6587\u8f93\u5165\u751f\u6210\u6a21\u578b\uff08\u5982 GPT-3 + FAISS \u7d22\u5f15\uff09\u3002 \u957f\u4e0a\u4e0b\u6587\u6a21\u578b \u76f4\u63a5\u6269\u5c55\u6a21\u578b\u7684\u6700\u5927\u4e0a\u4e0b\u6587\u7a97\u53e3\uff0c\u652f\u6301\u4e00\u6b21\u6027\u8f93\u5165\u8d85\u957f\u6587\u672c\uff08\u5982\u6570\u4e07 token\uff09\u3002 \u6539\u8fdb\u4f4d\u7f6e\u7f16\u7801\uff08\u5982 RoPE\u3001ALiBi\uff09\u3001\u4f18\u5316\u6ce8\u610f\u529b\u673a\u5236\uff08\u5982\u7a00\u758f\u6ce8\u610f\u529b\uff09\u7684\u6a21\u578b\uff08\u5982 GPT-4 Turbo\u3001Claude 3\uff09\u3002"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E7%90%86%E8%AE%BA%E7%AF%87/#_3","title":"\u4f18\u52bf\u4e0e\u52a3\u52bf\u5bf9\u6bd4","text":""},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E7%90%86%E8%AE%BA%E7%AF%87/#rag","title":"RAG \u7684\u4f18\u7f3a\u70b9","text":"\u4f18\u52bf \u52a3\u52bf \u2705 \u8f7b\u91cf\u5316\uff1a\u65e0\u9700\u4fee\u6539\u6a21\u578b\u67b6\u6784\uff0c\u9002\u914d\u73b0\u6709\u6a21\u578b\uff08\u5982 GPT-3.5\uff09\u3002 \u274c \u68c0\u7d22\u4f9d\u8d56\u6027\u5f3a\uff1a\u68c0\u7d22\u8d28\u91cf\u76f4\u63a5\u5f71\u54cd\u751f\u6210\u7ed3\u679c\uff0c\u5206\u5757\u4e0d\u5f53\u5bfc\u81f4\u4fe1\u606f\u4e22\u5931\u3002 \u2705 \u52a8\u6001\u77e5\u8bc6\u66f4\u65b0\uff1a\u901a\u8fc7\u66f4\u65b0\u5916\u90e8\u77e5\u8bc6\u5e93\u5feb\u901f\u96c6\u6210\u65b0\u6570\u636e\uff0c\u907f\u514d\u91cd\u65b0\u8bad\u7ec3\u6a21\u578b\u3002 \u274c \u4e0a\u4e0b\u6587\u62fc\u63a5\u566a\u58f0\uff1a\u68c0\u7d22\u7247\u6bb5\u62fc\u63a5\u53ef\u80fd\u5f15\u5165\u65e0\u5173\u5185\u5bb9\uff0c\u5f71\u54cd\u751f\u6210\u8fde\u8d2f\u6027\u3002 \u2705 \u53ef\u63a7\u6027\u9ad8\uff1a\u53ef\u5e72\u9884\u68c0\u7d22\u9636\u6bb5\uff08\u5982\u8fc7\u6ee4\u6765\u6e90\u3001\u8c03\u6574\u5206\u5757\u7b56\u7565\uff09\u3002 \u274c \u5ef6\u8fdf\u589e\u52a0\uff1a\u68c0\u7d22\u6b65\u9aa4\u5f15\u5165\u989d\u5916\u8ba1\u7b97\u548c I/O \u5f00\u9500\uff0c\u5b9e\u65f6\u6027\u53d7\u9650\u3002"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E7%90%86%E8%AE%BA%E7%AF%87/#_4","title":"\u957f\u4e0a\u4e0b\u6587\u6a21\u578b\u7684\u4f18\u7f3a\u70b9","text":"\u4f18\u52bf \u52a3\u52bf \u2705 \u7aef\u5230\u7aef\u5904\u7406\uff1a\u65e0\u9700\u989d\u5916\u68c0\u7d22\u6b65\u9aa4\uff0c\u76f4\u63a5\u5904\u7406\u5b8c\u6574\u957f\u6587\u672c\uff0c\u4e0a\u4e0b\u6587\u66f4\u8fde\u8d2f\u3002 \u274c \u9759\u6001\u77e5\u8bc6\u9650\u5236\uff1a\u4f9d\u8d56\u8bad\u7ec3\u6570\u636e\uff0c\u65e0\u6cd5\u52a8\u6001\u66f4\u65b0\u5916\u90e8\u77e5\u8bc6\u3002 \u2705 \u5168\u5c40\u7406\u89e3\u80fd\u529b\uff1a\u6a21\u578b\u76f4\u63a5\u611f\u77e5\u5168\u6587\u7ed3\u6784\uff08\u5982\u5c0f\u8bf4\u4f0f\u7b14\u3001\u957f\u4ee3\u7801\u6587\u4ef6\u903b\u8f91\uff09\u3002 \u274c \u8ba1\u7b97\u6210\u672c\u9ad8\uff1a\u957f\u5e8f\u5217\u6ce8\u610f\u529b\u8ba1\u7b97\u590d\u6742\u5ea6\u4e3a O(n\u00b2)\uff0c\u63a8\u7406\u6210\u672c\u98d9\u5347\u3002 \u2705 \u65e0\u4fe1\u606f\u5272\u88c2\uff1a\u907f\u514d\u5206\u5757\u5bfc\u81f4\u7684\u5173\u952e\u4fe1\u606f\u5206\u6563\u95ee\u9898\uff08\u5982\u8de8\u6bb5\u843d\u63a8\u7406\uff09\u3002 \u274c \u5b9e\u73b0\u95e8\u69db\u9ad8\uff1a\u9700\u6539\u8fdb\u6a21\u578b\u67b6\u6784\uff08\u5982\u4f4d\u7f6e\u7f16\u7801\u3001\u7a00\u758f\u5316\uff09\uff0c\u6280\u672f\u96be\u5ea6\u5927\u3002"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E7%90%86%E8%AE%BA%E7%AF%87/#_5","title":"\u9002\u7528\u573a\u666f\u5bf9\u6bd4","text":"\u573a\u666f RAG \u66f4\u4f18 \u957f\u4e0a\u4e0b\u6587\u6a21\u578b\u66f4\u4f18 \u5f00\u653e\u57df\u95ee\u7b54 \u9700\u5b9e\u65f6\u68c0\u7d22\u6700\u65b0\u77e5\u8bc6\uff08\u5982\u5929\u6c14\u3001\u65b0\u95fb\uff09\u3002 \u9700\u6df1\u5ea6\u7406\u89e3\u957f\u6587\u6863\u5185\u90e8\u903b\u8f91\uff08\u5982\u6cd5\u5f8b\u6761\u6b3e\u5173\u8054\u6027\uff09\u3002 \u6587\u6863\u6458\u8981 \u591a\u6587\u6863\u805a\u5408\u6458\u8981\uff08\u5982\u4ece 100 \u7bc7\u8bba\u6587\u4e2d\u63d0\u53d6\u9886\u57df\u8d8b\u52bf\uff09\u3002 \u5355\u7bc7\u957f\u6587\u6863\u6458\u8981\uff08\u5982\u6280\u672f\u767d\u76ae\u4e66\u7684\u7ed3\u6784\u5316\u603b\u7ed3\uff09\u3002 \u5bf9\u8bdd\u7cfb\u7edf \u9700\u8981\u7ed3\u5408\u7528\u6237\u5386\u53f2\u5bf9\u8bdd\u548c\u5916\u90e8\u77e5\u8bc6\u5e93\uff08\u5982\u5ba2\u670d\u7cfb\u7edf\u8c03\u7528\u4ea7\u54c1\u624b\u518c\uff09\u3002 \u957f\u5bf9\u8bdd\u8fde\u8d2f\u6027\u7ef4\u62a4\uff08\u5982\u5fc3\u7406\u6cbb\u7597\u5bf9\u8bdd\u9700\u56de\u987e\u65e9\u671f\u4f1a\u8bdd\uff09\u3002 \u4ee3\u7801\u751f\u6210 \u9700\u68c0\u7d22 API \u6587\u6863\u6216\u4ee3\u7801\u7247\u6bb5\u8865\u5168\uff08\u5982\u6839\u636e\u9700\u6c42\u5339\u914d\u76f8\u4f3c\u4ee3\u7801\uff09\u3002 \u7406\u89e3\u957f\u4ee3\u7801\u6587\u4ef6\u4e0a\u4e0b\u6587\uff08\u5982\u8de8\u51fd\u6570\u53d8\u91cf\u8ffd\u8e2a\uff09\u3002"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E7%90%86%E8%AE%BA%E7%AF%87/#_6","title":"\u6280\u672f\u6311\u6218\u5bf9\u6bd4","text":"\u6311\u6218 RAG \u957f\u4e0a\u4e0b\u6587\u6a21\u578b \u957f\u6587\u672c\u5904\u7406 \u5206\u5757\u7b56\u7565\u9700\u5e73\u8861\u8bed\u4e49\u5b8c\u6574\u6027\u4e0e\u68c0\u7d22\u6548\u7387\uff08\u5982\u91cd\u53e0\u6bd4\u4f8b\u3001\u52a8\u6001\u5206\u5757\uff09\u3002 \u4f4d\u7f6e\u7f16\u7801\u5916\u63a8\uff08Positional Encoding Extrapolation\uff09\u80fd\u529b\u4e0d\u8db3\uff0c\u957f\u8ddd\u79bb\u4f9d\u8d56\u8870\u51cf\u3002 \u77e5\u8bc6\u66f4\u65b0 \u77e5\u8bc6\u5e93\u66f4\u65b0\u5ef6\u8fdf\u5bfc\u81f4\u751f\u6210\u7ed3\u679c\u8fc7\u65f6\uff08\u5982\u91d1\u878d\u6570\u636e\u65f6\u6548\u6027\uff09\u3002 \u6a21\u578b\u91cd\u65b0\u8bad\u7ec3\u6210\u672c\u9ad8\uff0c\u96be\u4ee5\u5feb\u901f\u5438\u6536\u65b0\u77e5\u8bc6\u3002 \u8ba1\u7b97\u6548\u7387 \u68c0\u7d22\u9636\u6bb5\u5f15\u5165\u5411\u91cf\u6570\u636e\u5e93\u67e5\u8be2\u5f00\u9500\uff0c\u4f46\u751f\u6210\u9636\u6bb5\u8f7b\u91cf\u3002 \u957f\u5e8f\u5217\u6ce8\u610f\u529b\u8ba1\u7b97\u8d44\u6e90\u6d88\u8017\u5927\uff08\u5982 100k token \u8f93\u5165\u9700\u6570\u767e GB \u663e\u5b58\uff09\u3002 <p>\u603b\u7ed3\uff1aRAG\u7684\u4f18\u70b9\u5728\u4e8e\u80fd\u591f\u5229\u7528\u5916\u90e8\u77e5\u8bc6\uff0c\u51cf\u5c11\u6a21\u578b\u5e7b\u89c9\uff0c\u4f46\u9700\u8981\u6709\u6548\u7684\u5206\u5757\u548c\u68c0\u7d22\u673a\u5236\uff1b\u957f\u4e0a\u4e0b\u6587\u6a21\u578b\u53ef\u4ee5\u5904\u7406\u66f4\u957f\u7684\u6587\u672c\uff0c\u4f46\u53ef\u80fd\u5728\u8ba1\u7b97\u8d44\u6e90\u548c\u6548\u7387\u4e0a\u6709\u6311\u6218\u3002</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E7%90%86%E8%AE%BA%E7%AF%87/#_7","title":"\u672a\u6765\u8d8b\u52bf\uff1a\u878d\u5408\u800c\u975e\u5bf9\u7acb","text":""},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E7%90%86%E8%AE%BA%E7%AF%87/#hybrid-approach","title":"\u6df7\u5408\u67b6\u6784\uff08Hybrid Approach\uff09","text":"<ul> <li>RAG \u589e\u5f3a\u957f\u4e0a\u4e0b\u6587\u6a21\u578b\uff1a \u957f\u4e0a\u4e0b\u6587\u6a21\u578b\u5904\u7406\u539f\u59cb\u6587\u672c\uff0cRAG \u8865\u5145\u5916\u90e8\u77e5\u8bc6\uff08\u5982 GPT-4 \u7ed3\u5408\u5b9e\u65f6\u68c0\u7d22\uff09\u3002 \u6848\u4f8b\uff1aPerplexity.ai \u7ed3\u5408 GPT-4 \u4e0e\u7f51\u7edc\u641c\u7d22\uff0c\u63d0\u5347\u56de\u7b54\u51c6\u786e\u6027\u3002</li> <li>\u5206\u7ea7\u5904\u7406\uff08Hierarchical Processing\uff09\uff1a \u5148\u7528\u957f\u4e0a\u4e0b\u6587\u6a21\u578b\u7c97\u7b5b\u6587\u6863\uff0c\u518d\u7528 RAG \u7ec6\u7c92\u5ea6\u68c0\u7d22\u5173\u952e\u6bb5\u843d\u3002 \u6848\u4f8b\uff1a\u6cd5\u5f8b\u6587\u4ef6\u5206\u6790\u4e2d\uff0c\u5148\u5b9a\u4f4d\u76f8\u5173\u7ae0\u8282\uff0c\u518d\u63d0\u53d6\u5177\u4f53\u6761\u6b3e\u3002</li> </ul>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E7%90%86%E8%AE%BA%E7%AF%87/#_8","title":"\u6280\u672f\u4e92\u8865\u65b9\u5411","text":"\u6280\u672f \u89e3\u51b3 RAG \u75db\u70b9 \u89e3\u51b3\u957f\u4e0a\u4e0b\u6587\u6a21\u578b\u75db\u70b9 \u68c0\u7d22\u6a21\u578b\u8f7b\u91cf\u5316 \u964d\u4f4e\u68c0\u7d22\u5ef6\u8fdf\uff08\u5982 TinyBERT \u52a0\u901f\u5411\u91cf\u8ba1\u7b97\uff09\u3002 - \u9ad8\u6548\u6ce8\u610f\u529b\u673a\u5236 - \u964d\u4f4e\u957f\u5e8f\u5217\u8ba1\u7b97\u6210\u672c\uff08\u5982 FlashAttention\uff09\u3002 \u52a8\u6001\u5206\u5757\u7b97\u6cd5 \u63d0\u5347\u5206\u5757\u8bed\u4e49\u8fde\u8d2f\u6027\uff08\u5982\u57fa\u4e8e\u5d4c\u5165\u76f8\u4f3c\u5ea6\u5206\u5757\uff09\u3002 -"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E7%90%86%E8%AE%BA%E7%AF%87/#_9","title":"\u603b\u7ed3\uff1a\u5982\u4f55\u9009\u62e9\uff1f","text":"\u7ef4\u5ea6 \u9009\u62e9 RAG \u9009\u62e9\u957f\u4e0a\u4e0b\u6587\u6a21\u578b \u77e5\u8bc6\u65f6\u6548\u6027 \u9700\u8981\u9891\u7e41\u66f4\u65b0\u5916\u90e8\u77e5\u8bc6\uff08\u5982\u65b0\u95fb\u3001\u5b9e\u65f6\u6570\u636e\uff09\u3002 \u4f9d\u8d56\u9759\u6001\u77e5\u8bc6\u5e93\uff08\u5982\u7ecf\u5178\u6587\u5b66\u5206\u6790\uff09\u3002 \u6587\u672c\u957f\u5ea6 \u5904\u7406\u8d85\u957f\u591a\u6587\u6863\uff08\u5982\u767e\u4e07 token \u7ea7\u4f01\u4e1a\u77e5\u8bc6\u5e93\uff09\u3002 \u5904\u7406\u5355\u6587\u6863\u957f\u6587\u672c\uff08\u5982\u5b66\u672f\u8bba\u6587\u3001\u957f\u7bc7\u5c0f\u8bf4\uff09\u3002 \u786c\u4ef6\u8d44\u6e90 \u4f4e\u663e\u5b58\u8bbe\u5907\uff0c\u53ef\u63a5\u53d7\u5ef6\u8fdf\uff08\u5982\u8fb9\u7f18\u8ba1\u7b97\u573a\u666f\uff09\u3002 \u9ad8\u6027\u80fd GPU \u96c6\u7fa4\uff0c\u8ffd\u6c42\u7aef\u5230\u7aef\u4f4e\u5ef6\u8fdf\uff08\u5982\u4e91\u670d\u52a1\uff09\u3002 \u4efb\u52a1\u590d\u6742\u5ea6 \u9700\u7ed3\u5408\u591a\u6e90\u5f02\u6784\u6570\u636e\uff08\u5982\u8de8\u6570\u636e\u5e93\u3001API\u3001\u6587\u6863\u7684\u95ee\u7b54\uff09\u3002 \u9700\u6df1\u5ea6\u7406\u89e3\u957f\u6587\u672c\u5185\u90e8\u7ed3\u6784\uff08\u5982\u4ee3\u7801\u751f\u6210\u3001\u590d\u6742\u63a8\u7406\uff09\u3002 <p>\u6700\u7ec8\u5efa\u8bae\uff1a  </p> <ul> <li>\u8d44\u6e90\u6709\u9650 + \u52a8\u6001\u77e5\u8bc6\u9700\u6c42 \u2192 \u4f18\u5148 RAG\u3002  </li> <li>\u5355\u6587\u6863\u6df1\u5ea6\u5206\u6790 + \u9ad8\u7b97\u529b \u2192 \u9009\u62e9\u957f\u4e0a\u4e0b\u6587\u6a21\u578b\u3002  </li> <li>\u5de5\u4e1a\u7ea7\u590d\u6742\u573a\u666f \u2192 \u63a2\u7d22\u6df7\u5408\u67b6\u6784\uff08\u5982 Claude 3 + \u81ea\u5efa\u77e5\u8bc6\u5e93\u68c0\u7d22\uff09\u3002</li> </ul>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E7%90%86%E8%AE%BA%E7%AF%87/#chunk","title":"\u4e3a\u4ec0\u4e48\u9700\u8981chunk\u5206\u5757","text":"<p>RAG \u7ed3\u5408\u4e86\u68c0\u7d22\u548c\u751f\u6210\u4e24\u90e8\u5206\uff0c\u5b83\u7684\u5de5\u4f5c\u6d41\u7a0b\u5927\u6982\u662f\u8fd9\u6837\u7684\uff1a\u5f53\u6709\u4e00\u4e2a\u67e5\u8be2\u8fdb\u6765\u65f6\uff0c\u7cfb\u7edf\u4f1a\u5148\u4ece\u5927\u91cf\u7684\u6587\u6863\u4e2d\u68c0\u7d22\u51fa\u76f8\u5173\u7684\u4fe1\u606f\uff0c\u7136\u540e\u628a\u8fd9\u4e9b\u4fe1\u606f\u8f93\u5165\u5230\u751f\u6210\u6a21\u578b\u91cc\uff0c\u751f\u6210\u6700\u7ec8\u7684\u7b54\u6848\u3002\u90a3\u4e3a\u4ec0\u4e48\u4e2d\u95f4\u9700\u8981\u5206\u5757chunk\u5462\uff1f</p> <p>\u56e0\u4e3a\u6a21\u578b\u6709\u8f93\u5165\u957f\u5ea6\u7684\u9650\u5236\uff0c\u5982\u679c\u6587\u6863\u592a\u5927\u4e86\uff0c\u6bd4\u5982\u6574\u4e2a\u6587\u6863\u6709\u51e0\u767e\u9875\uff0c\u76f4\u63a5\u8f93\u5165\u5230\u68c0\u7d22\u6a21\u578b\u6216\u8005\u751f\u6210\u6a21\u578b\u91cc\u53ef\u80fd\u4e0d\u592a\u884c\u3002\u6bd4\u5982\u50cfBERT\u8fd9\u6837\u7684\u6a21\u578b\uff0c\u901a\u5e38\u53ea\u80fd\u5904\u7406512\u4e2atoken\u3002\u5982\u679c\u6587\u6863\u592a\u957f\uff0c\u8d85\u8fc7\u8fd9\u4e2a\u9650\u5236\u7684\u8bdd\uff0c\u5c31\u65e0\u6cd5\u5904\u7406\u6574\u4e2a\u6587\u6863\u4e86\u3002\u8fd9\u65f6\u5019\u5c31\u9700\u8981\u628a\u6587\u6863\u5207\u6210\u5c0f\u5757\uff0c\u4e5f\u5c31\u662fchunk\uff0c\u6bcf\u4e2achunk\u7684\u5927\u5c0f\u5728\u6a21\u578b\u80fd\u5904\u7406\u7684\u8303\u56f4\u5185\u3002</p> <p>\u53e6\u5916\uff0c\u68c0\u7d22\u7684\u6548\u7387\u4e5f\u662f\u4e00\u4e2a\u539f\u56e0\u3002\u5982\u679c\u6587\u6863\u6ca1\u6709\u88ab\u5206\u5757\uff0c\u76f4\u63a5\u5bf9\u6574\u4e2a\u5927\u6587\u6863\u8fdb\u884c\u68c0\u7d22\uff0c\u8ba1\u7b97\u76f8\u4f3c\u5ea6\u53ef\u80fd\u4f1a\u5f88\u8017\u65f6\u95f4\u548c\u8d44\u6e90\uff0c\u800c\u5206\u5757\u6210\u5c0fchunk\u540e\uff0c\u53ef\u4ee5\u5e76\u884c\u5904\u7406\uff0c\u6216\u8005\u66f4\u9ad8\u6548\u5730\u5efa\u7acb\u7d22\u5f15\uff0c\u52a0\u5feb\u68c0\u7d22\u901f\u5ea6\u3002\u6bd4\u5982\uff0c\u4f7f\u7528\u5411\u91cf\u6570\u636e\u5e93\u7684\u8bdd\uff0c\u6bcf\u4e2achunk\u4f1a\u88ab\u7f16\u7801\u6210\u5411\u91cf\uff0c\u7136\u540e\u5728\u67e5\u8be2\u65f6\u53ea\u9700\u8981\u8ba1\u7b97\u67e5\u8be2\u5411\u91cf\u4e0e\u5404\u4e2achunk\u5411\u91cf\u7684\u76f8\u4f3c\u5ea6\uff0c\u627e\u5230\u6700\u76f8\u5173\u7684\u51e0\u4e2achunk\u3002</p> <p>\u603b\u7ed3\uff1a</p> <ul> <li>\u6a21\u578b\u8f93\u5165\u9650\u5236 \u65e0\u8bba\u662f\u68c0\u7d22\u6a21\u578b\uff08\u5982 BERT\uff09\u8fd8\u662f\u751f\u6210\u6a21\u578b\uff08\u5982 GPT\uff09\uff0c\u5747\u6709\u56fa\u5b9a\u6700\u5927\u4e0a\u4e0b\u6587\u957f\u5ea6\uff08\u5982 512 \u6216 4096 tokens\uff09\u3002\u672a\u5206\u5757\u7684\u957f\u6587\u672c\u4f1a\u88ab\u622a\u65ad\uff0c\u5bfc\u81f4\u5173\u952e\u4fe1\u606f\u4e22\u5931\u3002</li> <li>\u68c0\u7d22\u6548\u7387\u4e0e\u7cbe\u5ea6 \u5927\u6bb5\u6587\u672c\u76f4\u63a5\u68c0\u7d22\u65f6\uff0c\u8ba1\u7b97\u76f8\u4f3c\u5ea6\u7684\u590d\u6742\u5ea6\u9ad8\u4e14\u566a\u58f0\u591a\uff1b\u7ec6\u7c92\u5ea6\u5206\u5757\u53ef\u7cbe\u51c6\u5b9a\u4f4d\u76f8\u5173\u6bb5\u843d\uff0c\u51cf\u5c11\u65e0\u5173\u5185\u5bb9\u5e72\u6270\u3002</li> <li>\u4fe1\u606f\u5b8c\u6574\u6027 \u5408\u7406\u7684\u5206\u5757\u80fd\u4fdd\u7559\u6bb5\u843d\u5185\u7684\u8bed\u4e49\u8fde\u8d2f\u6027\uff08\u5982\u5b8c\u6574\u4fdd\u7559\u4e00\u4e2a\u8bba\u70b9\u6216\u6848\u4f8b\uff09\uff0c\u907f\u514d\u4e0a\u4e0b\u6587\u65ad\u88c2\u3002</li> <li>\u6210\u672c\u63a7\u5236 \u8fc7\u5927\u7684\u5757\u4f1a\u589e\u52a0\u5411\u91cf\u5316\u5b58\u50a8\u548c\u8ba1\u7b97\u6210\u672c\uff0c\u8fc7\u5c0f\u7684\u5757\u53ef\u80fd\u65e0\u6cd5\u63d0\u4f9b\u8db3\u591f\u4e0a\u4e0b\u6587\uff0c\u5206\u5757\u53ef\u5e73\u8861\u6210\u672c\u4e0e\u6548\u679c\u3002</li> </ul>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E7%90%86%E8%AE%BA%E7%AF%87/#_10","title":"\u67e5\u770b\u6a21\u578b\u63a5\u53d7\u7684\u6700\u5927\u4e0a\u4e0b\u6587\u957f\u5ea6","text":"<p>\u4ece\u524d\u9762\u7684\u5206\u6790\u53ef\u4ee5\u77e5\u9053\uff1achunk\u5206\u5757\u7684\u4e00\u4e2a\u539f\u56e0\u662f\u6a21\u578b\u8f93\u5165\u957f\u5ea6\u7684\u9650\u5236\uff0c\u6240\u4ee5\u81ea\u7136\u5730\u60f3\u77e5\u9053\u5982\u4f55\u67e5\u770b\u6a21\u578b\u53ef\u63a5\u53d7\u7684\u6700\u5927\u4e0a\u4e0b\u6587\u957f\u5ea6\uff0c\u8fd9\u4e2a\u5bf9\u4e8e\u540e\u7eedchunk\u5206\u5757\u975e\u5e38\u6709\u7528\u3002</p> <p>\u4e0d\u540c\u7684\u6a21\u578b\u53ef\u4ee5\u63a5\u53d7\u4e0d\u540c\u7684\u4e0a\u4e0b\u6587\u957f\u5ea6\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u6a21\u578b\u7684\u914d\u7f6e\u6587\u4ef6 <code>config.json</code> \u548c <code>tokenizer</code> \u7684\u914d\u7f6e\u6587\u4ef6 <code>tokenizer_config.json</code>\u67e5\u770b\u6a21\u578b\u53ef\u63a5\u53d7\u7684\u6700\u5927\u4e0a\u4e0b\u6587\u957f\u5ea6\u3002</p> <p>\u5728 huggingface \u4e0a\u9762\u627e\u5230 <code>[DeepSeek-R1](https://huggingface.co/deepseek-ai/DeepSeek-R1/tree/main)</code>\uff0c\u5728<code>config.json</code>\u4e2d\u6709<code>\"max_position_embeddings\":163840</code>\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5728<code>tokenizer_config.json</code>\u4e2d\u6709<code>\"model_max_length\":16384</code>\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u8868\u793a\u53ef\u4ee5\u63a5\u53d7\u7684\u6700\u5927 token \u6570\u4e3a 16K\uff1a</p> <p></p>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E7%90%86%E8%AE%BA%E7%AF%87/#model_max_length","title":"model_max_length \u6838\u5fc3\u4f5c\u7528","text":"<p><code>**model_max_length**</code> \u5b9a\u4e49\u4e86\u8be5\u5206\u8bcd\u5668\u5728\u8bbe\u8ba1\u65f6\u6240\u9002\u914d\u7684\u6a21\u578b\u80fd\u5904\u7406\u7684\u6700\u5927\u5355\u6b21\u8f93\u5165\u957f\u5ea6\uff08\u4ee5token\u6570\u4e3a\u5355\u4f4d\uff09\u3002\u4f8b\u5982\uff1a</p> <ul> <li>DeepSeek-R1\u6a21\u578b\u8bbe\u7f6e\u4e3a 16384\u3002</li> <li>Qwen3\u7b49\u957f\u4e0a\u4e0b\u6587\u6a21\u578b\u53ef\u80fd\u8bbe\u7f6e\u4e3a 131072 \u6216\u66f4\u9ad8\u3002</li> </ul> <p>\u5b83\u7684\u4e3b\u8981\u529f\u80fd\u662f\uff1a</p> <ul> <li>\u81ea\u52a8\u622a\u65ad\uff1a\u5f53\u8f93\u5165\u6587\u672c\u8f6c\u6362\u540e\u7684token\u6570\u8d85\u8fc7\u8be5\u503c\u65f6\uff0c\u9ed8\u8ba4\u89e6\u53d1\u622a\u65ad\uff08\u9700\u914d\u5408<code>**truncation=True**</code>\u53c2\u6570\uff09\u3002</li> <li>\u8b66\u544a\u673a\u5236\uff1a\u82e5\u8f93\u5165\u8d85\u8fc7\u6b64\u957f\u5ea6\u4e14\u672a\u542f\u7528\u622a\u65ad\uff0c\u53ef\u80fd\u5f15\u53d1\u8b66\u544a\u6216\u9519\u8bef\u3002</li> <li>\u6307\u5bfc\u9884\u5904\u7406\uff1a\u4e3a\u5f00\u53d1\u8005\u63d0\u4f9b\u53c2\u8003\uff0c\u786e\u4fdd\u8f93\u5165\u9002\u914d\u6a21\u578b\u80fd\u529b\u3002</li> </ul> <p>\u6ce8\u610f\uff1a\u76f4\u63a5\u4fee\u6539<code>**model_max_length**</code>\u4e0d\u4f1a\u6269\u5c55\u6a21\u578b\u7684\u771f\u5b9e\u5904\u7406\u80fd\u529b\u3002\u82e5\u9700\u5904\u7406\u66f4\u957f\u6587\u672c\uff0c\u9700\u4f7f\u7528\u652f\u6301\u957f\u4e0a\u4e0b\u6587\u7684\u6a21\u578b\uff08\u5982Longformer\uff09\u6216\u8c03\u6574\u4f4d\u7f6e\u7f16\u7801\u3002</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E7%90%86%E8%AE%BA%E7%AF%87/#_11","title":"\u4e0e\u6a21\u578b\u914d\u7f6e\u7684\u5173\u7cfb","text":"<ul> <li>\u5173\u8054\u53c2\u6570\uff1a\u6a21\u578b\u7684<code>**max_position_embeddings**</code>\uff08\u5982BERT\u7684<code>**config.json**</code>\u4e2d\u5b9a\u4e49\uff09\u51b3\u5b9a\u4e86\u6a21\u578b\u7684\u5b9e\u9645\u4f4d\u7f6e\u7f16\u7801\u80fd\u529b\u3002</li> <li>\u4e00\u81f4\u6027\u8981\u6c42\uff1a\u7406\u60f3\u60c5\u51b5\u4e0b\uff0c<code>**model_max_length**</code>\u5e94\u4e0e<code>**max_position_embeddings**</code>\u4e00\u81f4\u3002\u82e5\u4e8c\u8005\u4e0d\u4e00\u81f4\uff1a<ul> <li>\u5f53<code>**model_max_length**</code> &lt; <code>**max_position_embeddings**</code>\uff1a\u53ef\u80fd\u5bfc\u81f4\u8f93\u5165\u88ab\u4e0d\u5fc5\u8981\u5730\u622a\u65ad\u3002</li> <li>\u5f53<code>**model_max_length**</code> &gt; <code>**max_position_embeddings**</code>\uff1a\u6a21\u578b\u53ef\u80fd\u65e0\u6cd5\u6b63\u786e\u5904\u7406\u8d85\u957f\u8f93\u5165\uff08\u4f4d\u7f6e\u7f16\u7801\u672a\u8bad\u7ec3\u5230\u8be5\u957f\u5ea6\uff09\u3002</li> </ul> </li> </ul>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E7%90%86%E8%AE%BA%E7%AF%87/#_12","title":"\u603b\u7ed3","text":"<p><code>**model_max_length**</code>\u662fTokenizer\u4e0e\u6a21\u578b\u534f\u540c\u5de5\u4f5c\u7684\u201c\u6865\u6881\u201d\u53c2\u6570\uff0c\u4f5c\u7528\u5305\u62ec\uff1a</p> <ol> <li>\u8f93\u5165\u89c4\u8303\u5316\uff1a\u786e\u4fdd\u8f93\u5165\u9002\u914d\u6a21\u578b\u7684\u9ed8\u8ba4\u5904\u7406\u80fd\u529b\u3002</li> <li>\u5f00\u53d1\u8005\u63d0\u793a\uff1a\u660e\u786e\u6a21\u578b\u8bbe\u8ba1\u7684\u6700\u5927\u957f\u5ea6\u9650\u5236\u3002</li> <li>\u9884\u5904\u7406\u63a7\u5236\uff1a\u901a\u8fc7\u622a\u65ad\u6216\u5206\u5757\u7b56\u7565\u7ba1\u7406\u957f\u6587\u672c\u3002</li> </ol>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E7%90%86%E8%AE%BA%E7%AF%87/#_13","title":"\u5206\u5757\u9700\u8981\u8003\u8651\u7684\u56e0\u7d20","text":"<p>\u5728\u8bed\u4e49\u641c\u7d22\u4e2d\uff0c\u7528\u6237\u67e5\u8be2\u6839\u636e\u8bed\u4e49\u68c0\u7d22\u6587\u6863\u8bed\u6599\u5e93\u4e2d\u7684\u76f8\u5173\u6587\u6863\uff0c\u6bcf\u4e2a\u6587\u6863\u5305\u542b\u4e00\u4e2a\u7279\u5b9a\u4e3b\u9898\u7684\u6709\u4ef7\u503c\u7684\u4fe1\u606f\u3002\u901a\u8fc7\u4f7f\u7528\u6709\u6548\u7684\u5206\u5757\u7b56\u7565\uff0c\u6211\u4eec\u53ef\u4ee5\u786e\u4fdd\u641c\u7d22\u7ed3\u679c\u51c6\u786e\u5730\u5339\u914d\u7528\u6237\u67e5\u8be2\u7684\u672c\u8d28\u3002\u5982\u679c\u6211\u4eec\u7684\u5757\u592a\u5c0f\u6216\u592a\u5927\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u68c0\u7d22\u5230\u4e0d\u5b8c\u6574\u7684\u5185\u5bb9\u6216\u8005\u4e0d\u7cbe\u786e\u7684\u641c\u7d22\u7ed3\u679c\u3002\u6839\u636e\u7ecf\u9a8c\uff0c\u6587\u672c\u5757\u5e94\u8be5\u5c3d\u91cf\u662f\u8bed\u4e49\u72ec\u7acb\u7684\uff0c\u4e5f\u5c31\u662f\u6ca1\u6709\u5bf9\u4e0a\u4e0b\u6587\u5f88\u5f3a\u7684\u4f9d\u8d56\uff0c\u8fd9\u6837\u5bf9\u8bed\u8a00\u6a21\u578b\u6765\u8bf4\u662f\u6700\u6613\u4e8e\u7406\u89e3\u7684\u3002\u56e0\u6b64\u4e3a\u8bed\u6599\u5e93\u4e2d\u7684\u6587\u6863\u627e\u5230\u6700\u4f73\u5757\u5927\u5c0f\u6216\u8005\u4fdd\u8bc1\u6587\u672c\u5757\u7684\u8bed\u4e49\u5b8c\u6574\u6027\uff0c\u5bf9\u4e8e\u786e\u4fdd\u641c\u7d22\u7ed3\u679c\u7684\u51c6\u786e\u6027\u548c\u76f8\u5173\u6027\u81f3\u5173\u91cd\u8981\u3002\u7b80\u8a00\u4e4b\u5c31\u662f\u627e\u5230\u8ba9\u6587\u672c\u5757\u65e2\u4fdd\u6301\u53ef\u8bfb\u6027\u53c8\u4fdd\u6301\u8bed\u4e49\u7684\u6700\u4f73\u8fb9\u754c\u3002</p> <p>chunk\u5206\u5757\u8981\u8003\u8651\u7684\u95ee\u9898\u662f\uff1a</p> <ul> <li>\u5757\u5927\u5c0f\uff08Chunk Size\uff09<ul> <li>\u8fc7\u5c0f\uff1a\u4e22\u5931\u4e0a\u4e0b\u6587\uff0c\u68c0\u7d22\u7ed3\u679c\u788e\u7247\u5316\uff08\u5982\u65e0\u6cd5\u56de\u7b54\u9700\u8981\u8de8\u6bb5\u843d\u63a8\u7406\u7684\u95ee\u9898\uff09\u3002</li> <li>\u8fc7\u5927\uff1a\u5305\u542b\u5197\u4f59\u4fe1\u606f\uff0c\u589e\u52a0\u8ba1\u7b97\u6210\u672c\uff0c\u8d85\u51fa\u6a21\u578b\u9650\u5236\u3002</li> <li>\u7ecf\u9a8c\u503c\uff1a\u901a\u5e38 256-512 tokens\uff08\u6839\u636e\u6a21\u578b\u80fd\u529b\u8c03\u6574\uff09\u3002</li> </ul> </li> <li>\u91cd\u53e0\u7b56\u7565\uff08Overlap\uff09<ul> <li>\u76f8\u90bb\u5757\u95f4\u4fdd\u7559\u90e8\u5206\u91cd\u53e0\u5185\u5bb9\uff08\u5982 10-20%\uff09\uff0c\u51cf\u5c11\u8fb9\u754c\u4fe1\u606f\u5272\u88c2\uff08\u4f8b\u5982\u524d\u4e00\u5757\u672b\u5c3e\u4e0e\u540e\u4e00\u5757\u5f00\u5934\u91cd\u53e0\uff09\u3002</li> </ul> </li> <li>\u8bed\u4e49\u8fb9\u754c\u8bc6\u522b<ul> <li>\u6309\u6bb5\u843d\u3001\u6807\u9898\u3001\u6807\u70b9\u6216 NLP \u5de5\u5177\uff08\u5982 spaCy\uff09\u5212\u5206\uff0c\u786e\u4fdd\u5757\u5185\u8bed\u4e49\u5b8c\u6574\u3002</li> </ul> </li> <li>\u6587\u672c\u7c7b\u578b\u9002\u914d<ul> <li>\u6280\u672f\u6587\u6863\u3001\u5c0f\u8bf4\u3001\u5bf9\u8bdd\u7b49\u4e0d\u540c\u6587\u672c\u9700\u5dee\u5f02\u5316\u5206\u5757\uff08\u5982\u5bf9\u8bdd\u6309\u8f6e\u6b21\u5206\u5757\uff09\u3002</li> </ul> </li> <li>\u591a\u8bed\u8a00\u652f\u6301<ul> <li>\u4e2d\u6587\u3001\u82f1\u6587\u7b49\u8bed\u8a00\u7684\u5206\u8bcd\u65b9\u5f0f\u4e0d\u540c\uff0c\u9700\u9002\u914d\u5bf9\u5e94\u7684\u5206\u8bcd\u5668\uff08Tokenizer\uff09\u3002</li> </ul> </li> </ul>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E7%90%86%E8%AE%BA%E7%AF%87/#chunk_1","title":"chunk\u5206\u5757\u65b9\u6cd5","text":"<p>\u4ee5\u4e0b\u662f \u5206\u5757\u65b9\u6cd5 \u7684\u603b\u7ed3\u8868\u683c\uff0c\u6db5\u76d6\u65b9\u6cd5\u63cf\u8ff0\u3001\u4f18\u7f3a\u70b9\u53ca\u9002\u7528\u573a\u666f\uff1a</p> \u5206\u5757\u65b9\u6cd5 \u65b9\u6cd5\u63cf\u8ff0 \u4f18\u70b9 \u7f3a\u70b9 \u9002\u7528\u573a\u666f \u6309\u5b57\u7b26\u5206\u5757 \u57fa\u4e8e\u56fa\u5b9a\u5b57\u7b26\u6570\u5207\u5206\u6587\u672c\uff08\u5982\u6bcf 200 \u4e2a\u5b57\u7b26\u4e00\u4e2a\u5757\uff09\u3002 \u2705 \u5b9e\u73b0\u7b80\u5355   \u2705 \u65e0\u9700\u4f9d\u8d56\u5206\u8bcd\u5de5\u5177 \u274c \u7834\u574f\u5355\u8bcd/\u53e5\u5b50\u7ed3\u6784   \u274c \u591a\u8bed\u8a00\u9002\u914d\u6027\u5dee \u7b80\u5355\u6587\u672c\u9884\u5904\u7406\u6216\u65e5\u5fd7\u5206\u6790 \u6309 Token \u5206\u5757 \u57fa\u4e8e\u6a21\u578b\u5206\u8bcd\u5668\uff08Tokenizer\uff09\u7684 token \u6570\u5207\u5206\uff08\u5982\u6bcf 256 tokens \u4e00\u4e2a\u5757\uff09\u3002 \u2705 \u9002\u914d\u6a21\u578b\u8f93\u5165\u9650\u5236   \u2705 \u8ba1\u7b97\u6210\u672c\u4f4e \u274c \u53ef\u80fd\u5207\u65ad\u8bed\u4e49\u8fb9\u754c   \u274c \u4f9d\u8d56\u5206\u8bcd\u5668\u6027\u80fd \u9002\u914d\u9884\u8bad\u7ec3\u6a21\u578b\uff08\u5982 BERT\u3001GPT\uff09 \u6309\u8bed\u4e49\u5206\u5757 \u5229\u7528 NLP \u5de5\u5177\u6216\u89c4\u5219\u8bc6\u522b\u8bed\u4e49\u8fb9\u754c\uff08\u5982\u53e5\u5b50\u3001\u6bb5\u843d\u3001\u7ae0\u8282\uff09\u3002 \u2705 \u4fdd\u7559\u8bed\u4e49\u5b8c\u6574\u6027   \u2705 \u9002\u914d\u7ed3\u6784\u5316\u6587\u672c \u274c \u4f9d\u8d56\u6587\u672c\u7ed3\u6784\u6216\u6a21\u578b   \u274c \u8ba1\u7b97\u6210\u672c\u9ad8 \u6280\u672f\u6587\u6863\u3001\u8bba\u6587\u3001\u6cd5\u5f8b\u6761\u6b3e \u6309 Markdown \u5c42\u6b21\u5316\u5206\u5757 \u6839\u636e Markdown \u6807\u9898\u5c42\u7ea7\uff08\u5982 <code>#</code>\u3001<code>##</code>\uff09\u5212\u5206\u5757\uff0c\u4fdd\u7559\u6587\u6863\u7ed3\u6784\u3002 \u2705 \u4fdd\u6301\u6587\u6863\u903b\u8f91\u7ed3\u6784   \u2705 \u65e0\u9700\u590d\u6742 NLP \u5904\u7406 \u274c \u4ec5\u652f\u6301 Markdown \u683c\u5f0f   \u274c \u683c\u5f0f\u9519\u8bef\u5bfc\u81f4\u5206\u5757\u5931\u8d25 \u6280\u672f\u6587\u6863\u3001API \u6587\u6863\u3001README \u6587\u4ef6 \u52a8\u6001\u5206\u5757 \u6839\u636e\u6587\u6863\u7c7b\u578b\u548c\u5185\u5bb9\u52a8\u6001\u8c03\u6574\u5757\u5927\u5c0f\uff08\u5982html\u6587\u4ef6\uff0cjson\u6587\u4ef6\uff0c\u4ee3\u7801\u7b49\u4f7f\u7528\u4e0d\u540c\u7684\u5206\u5757\u7b56\u7565\uff09\u3002 \u2705 \u7075\u6d3b\u9002\u914d\u6587\u672c\u7279\u6027   \u2705 \u4f18\u5316\u4fe1\u606f\u8986\u76d6\u7387 \u274c \u5b9e\u73b0\u590d\u6742\u5ea6\u9ad8   \u274c \u9700\u5b9a\u5236\u89c4\u5219\u6216\u6a21\u578b \u5f02\u6784\u6587\u6863\u6df7\u5408\u5904\u7406\uff08\u5982\u591a\u683c\u5f0f\u77e5\u8bc6\u5e93\uff09"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E7%90%86%E8%AE%BA%E7%AF%87/#_14","title":"\u8865\u5145\u8bf4\u660e","text":"<ol> <li>\u6309\u5b57\u7b26\u5206\u5757 <ul> <li>\u5178\u578b\u5de5\u5177\uff1aPython \u5b57\u7b26\u4e32\u5207\u7247\uff08\u5982 <code>text[i:i+200]</code>\uff09\u3002  </li> <li>\u95ee\u9898\u793a\u4f8b\uff1a\u4e2d\u6587\u65e0\u7a7a\u683c\u5206\u9694\uff0c\u6309\u5b57\u7b26\u5207\u5206\u6613\u7834\u574f\u8bcd\u8bed\uff08\u5982\u5c06\u201c\u4eba\u5de5\u667a\u80fd\u201d\u5207\u4e3a\u201c\u4eba\u5de5\u667a|\u80fd\u201d\uff09\u3002</li> </ul> </li> <li>\u6309 Token \u5206\u5757 <ul> <li>\u5178\u578b\u5de5\u5177\uff1aHugging Face <code>AutoTokenizer</code>\u3001LangChain <code>TokenTextSplitter</code>\u3002  </li> <li>\u6ce8\u610f\u4e8b\u9879\uff1a\u9700\u4e0e\u6a21\u578b\u7684 <code>max_position_embeddings</code> \u53c2\u6570\u5339\u914d\u3002</li> </ul> </li> <li>\u6309\u8bed\u4e49\u5206\u5757 <ul> <li>\u5178\u578b\u5de5\u5177\uff1a<code>spaCy</code>\uff08\u6bb5\u843d\u5206\u5272\uff09\u3001<code>nltk.sent_tokenize</code>\uff08\u53e5\u5b50\u5206\u5272\uff09\u3001\u6b63\u5219\u8868\u8fbe\u5f0f\uff08\u6309\u6807\u70b9\u5207\u5206\uff09\u3002  </li> <li>\u793a\u4f8b\uff1a\u6280\u672f\u6587\u6863\u6309 <code>## \u4e8c\u7ea7\u6807\u9898</code> \u5206\u5757\u3002</li> </ul> </li> <li>\u6309 Markdown \u5c42\u6b21\u5316\u5206\u5757 <ul> <li>\u5178\u578b\u5de5\u5177\uff1a\u6b63\u5219\u8868\u8fbe\u5f0f\uff08\u5982 <code>r'^#+\\s+.+'</code> \u5339\u914d\u6807\u9898\uff09\u3001<code>markdown-it</code> \u89e3\u6790\u5e93\u3002  </li> <li>\u6269\u5c55\u5e94\u7528\uff1a\u7ed3\u5408\u76ee\u5f55\uff08TOC\uff09\u751f\u6210\u591a\u7ea7\u7d22\u5f15\u3002</li> </ul> </li> <li>\u52a8\u6001\u5206\u5757 <ul> <li>\u5b9e\u73b0\u601d\u8def\uff1a  <ul> <li>\u57fa\u4e8e\u89c4\u5219\uff1a\u6280\u672f\u6587\u6863\u4e2d\u4ee3\u7801\u5757\u5bc6\u96c6\u533a\u57df\u5207\u5c0f\u5757\uff0c\u5197\u4f59\u63cf\u8ff0\u5207\u5927\u5757\u3002  </li> <li>\u57fa\u4e8e\u6a21\u578b\uff1a\u7528\u5d4c\u5165\u76f8\u4f3c\u5ea6\u68c0\u6d4b\u5185\u5bb9\u5bc6\u5ea6\uff08\u5982\u76f8\u90bb\u53e5\u5b50\u76f8\u4f3c\u5ea6\u9ad8\u5219\u5408\u5e76\u4e3a\u5927\u5757\uff09\u3002</li> </ul> </li> </ul> </li> </ol>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E7%90%86%E8%AE%BA%E7%AF%87/#_15","title":"\u9009\u62e9\u5efa\u8bae","text":"\u573a\u666f\u9700\u6c42 \u63a8\u8350\u65b9\u6cd5 \u793a\u4f8b \u5904\u7406 API \u6587\u6863 Markdown \u5c42\u6b21\u5316\u5206\u5757 \u6309 <code>## \u63a5\u53e3\u5b9a\u4e49</code> \u5206\u5272\u7ae0\u8282 \u591a\u8bed\u8a00\u6df7\u5408\u6587\u672c \u6309 Token \u5206\u5757 \u9002\u914d\u591a\u8bed\u8a00\u5206\u8bcd\u5668\uff08\u5982 <code>XLM-R</code>\uff09 \u5b9e\u65f6\u65e5\u5fd7\u5206\u6790 \u6309\u5b57\u7b26\u5206\u5757 \u5feb\u901f\u5207\u5272\u65e5\u5fd7\u884c\uff08\u6bcf 500 \u5b57\u7b26\u4e00\u4e2a\u5757\uff09 \u6cd5\u5f8b\u5408\u540c\u89e3\u6790 \u6309\u8bed\u4e49\u5206\u5757 \u6309\u6761\u6b3e\uff08<code>Article 1.</code>\uff09\u5206\u5272 \u6df7\u5408\u683c\u5f0f\u4f01\u4e1a\u77e5\u8bc6\u5e93 \u52a8\u6001\u5206\u5757 \u6280\u672f\u6587\u6863\u5c0f\u5757 + \u4f1a\u8bae\u8bb0\u5f55\u5927\u5757 <p>\u901a\u8fc7\u5408\u7406\u9009\u62e9\u5206\u5757\u65b9\u6cd5\uff0c\u53ef\u663e\u8457\u63d0\u5347\u68c0\u7d22\u589e\u5f3a\u751f\u6210\uff08RAG\uff09\u7cfb\u7edf\u7684\u51c6\u786e\u6027\u548c\u6548\u7387\u3002</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E7%90%86%E8%AE%BA%E7%AF%87/#chunk_2","title":"chunk\u5206\u5757\u5b9e\u8df5","text":"<p>\u63a5\u4e0b\u6765\u4e3b\u8981\u4f7f\u7528 langchain \u63d0\u4f9b\u7684\u5de5\u5177\u5bf9\u524d\u9762\u7684chunk\u5206\u5757\u65b9\u6cd5\u8fdb\u884c\u5b9e\u8df5\uff0c\u4e0b\u9762\u5185\u5bb9\u90fd\u662f\u5728notebook\u4e2d\u8fdb\u884c\u5b9e\u8df5\u7684\uff0c\u7136\u540e\u5c06\u5185\u5bb9\u8f6c\u6362\u4e3amarkdown\u683c\u5f0f\u3002</p> <p>\u56e0\u4e3a\u8fd9\u8fb9\u6587\u7ae0\u8d8a\u6765\u8d8a\u957f\u4e86\uff0c\u6240\u4ee5chunk\u5206\u5757\u76f8\u5173\u7684\u5185\u5bb9\u5206\u4e3a\u7406\u8bba\u7bc7\u548c\u5b9e\u8df5\u7bc7\uff0c\u5173\u4e8e\u5b9e\u8df5\u7684\u5177\u4f53\u5185\u5bb9\u8bf7\u67e5\u770b\u4e0b\u4e00\u7bc7\u6587\u7ae0\u3002</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91chunk%E5%88%86%E5%9D%97%E7%90%86%E8%AE%BA%E7%AF%87/#_16","title":"\u603b\u7ed3","text":"<p>\u5206\u5757chunk\u662f\u5e73\u8861\u6a21\u578b\u9650\u5236\u3001\u68c0\u7d22\u6548\u7387\u4e0e\u4fe1\u606f\u5b8c\u6574\u6027\u7684\u5fc5\u8981\u624b\u6bb5\uff0c\u76f4\u63a5\u5f71\u54cdRAG\u7cfb\u7edf\u7684\u6027\u80fd\u3002\u5408\u7406\u7684\u5206\u5757\u7b56\u7565\u9700\u7ed3\u5408\u6a21\u578b\u80fd\u529b\u3001\u5e94\u7528\u9700\u6c42\u53ca\u6587\u672c\u7279\u6027\uff0c\u901a\u8fc7\u5b9e\u9a8c\u8c03\u4f18\u4ee5\u8fbe\u5230\u6700\u4f73\u6548\u679c\u3002</p> <p>\u53c2\u8003\u6587\u6863</p> <ol> <li>https://medium.com/towards-data-science/rag-101-chunking-strategies-fdc6f6c2aaec</li> <li>https://python.langchain.com/docs/how_to/markdown_header_metadata_splitter/</li> <li>https://zhuanlan.zhihu.com/p/673906072</li> <li>https://github.com/FullStackRetrieval-com/RetrievalTutorials/blob/main/tutorials/LevelsOfTextSplitting/5_Levels_Of_Text_Splitting.ipynb</li> <li>https://luxiangdong.com/2023/09/20/chunk/</li> <li>Retrieval Augmented Generation or Long-Context LLMs?A Comprehensive Study and Hybrid Approach</li> <li>https://python.langchain.com/docs/how_to/</li> </ol>"},{"location":"rag/%E3%80%90RAG%E3%80%91docling%E7%BB%93%E5%90%88OCR%E5%AE%9E%E7%8E%B0pdf%E8%BD%ACmarkdown/","title":"docling\u7ed3\u5408OCR\u5b9e\u73b0pdf\u8f6cmarkdown","text":""},{"location":"rag/%E3%80%90RAG%E3%80%91docling%E7%BB%93%E5%90%88OCR%E5%AE%9E%E7%8E%B0pdf%E8%BD%ACmarkdown/#_1","title":"\u6982\u8ff0","text":"<p>\u524d\u9762\u5199\u4e86\u4e00\u7bc7\u6587\u7ae0 \u5c06pdf\u548cdocx\u8f6c\u6362\u4e3amarkdown\u683c\u5f0f \u4ecb\u7ecd\u4e86\u4f7f\u7528\u4e00\u4e9b\u5f00\u6e90\u5de5\u5177\u8f6c\u6362pdf\u4e3amarkdown\u7684\u6548\u679c\u5bf9\u6bd4\uff0c\u5f97\u51fa\u7684\u7ed3\u8bba\u662f\uff1a \u4f7f\u7528 docling \u8f6c\u6362 pdf \u4e3a markdown \u683c\u5f0f\u7684\u6548\u679c\u6700\u597d\uff0c\u5e76\u4e14docling\u4f7f\u7528\u7684\u662f MIT licence\u3002</p> <p>\u5728\u76f4\u63a5\u4f7f\u7528docling\u6a21\u578b\u8f6c\u6362pdf\u6587\u4ef6\u4e3amarkdown\u683c\u5f0f\u65f6\uff0c\u5982\u679cpdf\u6587\u4ef6\u4e2d\u6709\u5f88\u591a\u56fe\u7247\uff0c\u6216\u8005pdf\u4e2d\u7684\u5185\u5bb9\u88ab\u6a21\u578b\u76f4\u63a5\u8bc6\u522b\u4e3a\u4e86\u56fe\u7247\uff0c\u8fd9\u79cd\u60c5\u51b5\u5982\u4f55\u4f7f\u7528 docling \u5c06 pdf \u4e2d\u56fe\u7247\u4e2d\u7684\u5185\u5bb9\u63d0\u53d6\u51fa\u6765\u5462\uff1f\u8fd9\u5c31\u9700\u8981\u4f7f\u7528docling\u7ed3\u5408OCR\u5b9e\u73b0pdf\u8f6cmarkdown\uff0c\u672c\u6587\u4e3b\u8981\u4ecb\u7ecd\u4e00\u4e0bdocling\u7ed3\u5408OCR\u7684\u8be6\u7ec6\u4f7f\u7528\u65b9\u6cd5\u3002</p> <p>\u672c\u6587\u662f\u5728\u9605\u8bfb\u4e86 docling \u7684\u5b98\u65b9\u6587\u6863\u548c\u6e90\u7801\uff0c\u4ee5\u53ca RapidOCR \u7684\u5b98\u65b9\u6587\u6863\uff0c\u5e76\u4e14\u7ecf\u8fc7\u5927\u91cf\u6d4b\u8bd5\u548c\u5b9e\u8df5\u8fdb\u884c\u603b\u7ed3\uff0c\u5728\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\u8e29\u4e86\u4e00\u4e9b\u5751\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>\u5982\u4f55\u4e0b\u8f7docr\u6a21\u578b</li> <li>\u5982\u4f55\u4e0elangchain\u7ed3\u5408</li> <li>\u5982\u4f55\u5b9e\u73b0 docling + ocr \u5728gpu\u4e0a\u9762\u8fd0\u884c</li> <li>\u5982\u4f55\u4fdd\u5b58\u56fe\u7247\u5e76\u5b58\u50a8\u5230oss</li> </ul> <p>\u5982\u679c\u6709\u5174\u8da3\u53ef\u4ee5\u5148\u67e5\u770b\u4e0b\u9762\u7684\u6587\u6863</p> <p>docling \u5b98\u65b9\u6587\u6863\uff1ahttps://docling-project.github.io/docling/examples/rapidocr_with_custom_models/</p> <p>RapidOCR \u5b98\u65b9\u6587\u6863\uff1ahttps://rapidai.github.io/RapidOCRDocs/install_usage/rapidocr_paddle/usage/ </p> <p>\u8bb0\u5f55\u672c\u6587\u7684\u76ee\u7684\u662f\u5e2e\u52a9\u6709\u540c\u6837\u9700\u6c42\u7684\u5c0f\u4f19\u4f34\u5c11\u8d70\u5f2f\u8def\uff0c\u907f\u514d\u8e29\u5751\uff0c\u5982\u679c\u4f60\u89c9\u5f97\u672c\u6587\u5185\u5bb9\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u70b9\u8d5e\u6536\u85cf\ud83d\ude00\uff0c\u5982\u679c\u53d1\u73b0\u6709\u758f\u6f0f\u6216\u8005\u9519\u8bef\u7684\u5730\u65b9\uff0c\u4e5f\u6b22\u8fce\u8bc4\u8bba\ud83e\udd1d\u3002</p> <p>\u901a\u8fc7\u672c\u6587\u7684\u5b66\u4e60\u4f60\u5c06\u90e8\u7f72\u4e00\u4e2a\u751f\u4ea7\u53ef\u7528\u7684\u9ad8\u6548\u7684pdf\u8f6cmarkdown\u7684\u670d\u52a1\uff0c\u7279\u522b\u662f\u5728RAG\u5e94\u7528\u4e2d\u975e\u5e38\u6709\u7528\uff0c\u540e\u7eed\u6211\u5c06\u5199\u4e00\u7bc7\u6587\u7ae0\u4ecb\u7ecd\u5982\u4f55\u5c06markdown\u6587\u4ef6\u5207\u5206\u4e3a\u6709\u5c42\u7ea7\u7ed3\u6784\u7684chunk\uff08\u6309\u7167\u6807\u9898\u548c\u6bb5\u843d\u5207\u5206\uff09\uff0c\u5e2e\u52a9\u5728RAG\u5e94\u7528\u63d0\u9ad8\u95ee\u7b54\u7684\u51c6\u786e\u7387\uff0c\u8bf7\u6301\u7eed\u5173\u6ce8\u3002</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91docling%E7%BB%93%E5%90%88OCR%E5%AE%9E%E7%8E%B0pdf%E8%BD%ACmarkdown/#pdf-markdown","title":"pdf \u8f6c markdown \u6587\u4ef6\u6548\u679c\u6f14\u793a","text":"<p>\u5728 arxv \u4e0a\u9762\u627e\u4e00\u4e2apdf\u6587\u4ef6\uff0c\u7136\u540e\u4f7f\u7528docling \u96c6\u6210 ocr \u8f6c\u6362\u4e3a markdown \u6587\u4ef6\u683c\u5f0f\u793a\u4f8b\u5982\u4e0b\uff1a</p> \u539fpdf \u8f6c\u6362\u540e\u7684markdown\uff0c\u5e76\u4fdd\u5b58\u56fe\u7247\u5230oss\uff0c\u53ef\u4ee5\u76f4\u63a5\u9884\u89c8\u56fe\u7247"},{"location":"rag/%E3%80%90RAG%E3%80%91docling%E7%BB%93%E5%90%88OCR%E5%AE%9E%E7%8E%B0pdf%E8%BD%ACmarkdown/#doclingocr","title":"docling\u652f\u6301\u7684OCR\u6a21\u578b","text":"<p>\u9996\u5148\u67e5\u770bdocling\u6e90\u7801\u652f\u6301\u54ea\u4e9bocr\u6a21\u578b\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>from docling.models.easyocr_model import EasyOcrModel\nfrom docling.models.ocr_mac_model import OcrMacModel\nfrom docling.models.picture_description_api_model import PictureDescriptionApiModel\nfrom docling.models.picture_description_vlm_model import PictureDescriptionVlmModel\nfrom docling.models.rapid_ocr_model import RapidOcrModel\nfrom docling.models.tesseract_ocr_cli_model import TesseractOcrCliModel\nfrom docling.models.tesseract_ocr_model import TesseractOcrModel\n\n\ndef ocr_engines():\n    return {\n        \"ocr_engines\": [\n            EasyOcrModel,\n            OcrMacModel,\n            RapidOcrModel,\n            TesseractOcrModel,\n            TesseractOcrCliModel,\n        ]\n    }\n\n\ndef picture_description():\n    return {\n        \"picture_description\": [\n            PictureDescriptionVlmModel,\n            PictureDescriptionApiModel,\n        ]\n    }\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230 docling \u9ed8\u8ba4\u652f\u6301 5 \u79cd ocr \u6a21\u578b\uff0c\u4f7f\u7528\u6a21\u578b\u603b\u7ed3\u4e00\u4e0b\u5b83\u4eec\u7684\u533a\u522b\uff0c\u8be6\u7ec6\u7684\u533a\u522b\u8bf7\u67e5\u9605\u76f8\u5173\u6587\u6863\u3002</p> <p>\u4ee5\u4e0b\u662f\u5217\u51fa\u7684\u4e94\u79cd OCR \u5f15\u64ce\u6a21\u578b\u7684\u533a\u522b\u3001\u4f18\u7f3a\u70b9\u53ca\u5bf9\u5e94\u7684\u6280\u672f\u80cc\u666f\u5206\u6790\uff1a</p> \u5f15\u64ce \u901f\u5ea6 \u7cbe\u5ea6 \u8d44\u6e90\u5360\u7528 \u591a\u8bed\u8a00 \u9002\u7528\u573a\u666f EasyOCR \u4e2d \u9ad8 \u9ad8 80+ \u81ea\u7136\u573a\u666f\u3001\u591a\u8bed\u8a00\u6df7\u5408 macOS OCR \u5feb \u4e2d \u4f4e 10+ macOS \u751f\u6001\u3001\u5b9e\u65f6\u6027\u8981\u6c42\u9ad8 RapidOCR \u6781\u5feb \u4e2d\u9ad8 \u4f4e 20+ \u5b9e\u65f6\u5904\u7406\u3001\u4f4e\u914d\u786c\u4ef6 Tesseract \u6162 \u4e2d \u4e2d 100+ \u626b\u63cf\u6587\u6863\u3001\u7ed3\u6784\u5316\u6587\u672c Tesseract CLI \u6162 \u4e2d \u4e2d 100+ \u6279\u91cf\u5904\u7406\u3001\u81ea\u52a8\u5316\u811a\u672c <p>\u8fd9\u91cc\u9009\u62e9 RapidOCR \u6a21\u578b\u548c docling \u8fdb\u884c\u96c6\u6210\uff0c\u5173\u4e8e RapidOCR \u7684\u4ecb\u7ecd\u5982\u4e0b\uff1a</p> <p></p>"},{"location":"rag/%E3%80%90RAG%E3%80%91docling%E7%BB%93%E5%90%88OCR%E5%AE%9E%E7%8E%B0pdf%E8%BD%ACmarkdown/#doclingrapidocr","title":"\u4e0b\u8f7ddocling\u6a21\u578b\u548cRapidOCR\u6a21\u578b","text":"<p>\u5728\u56fd\u5185\u76f4\u63a5\u4ece modelscope \u4e0b\u8f7ddocling\u6a21\u578b\u548cRapidOCR\u6a21\u578b\u5373\u53ef\u3002</p> <ol> <li>\u5728\u4e0b\u8f7d\u524d\uff0c\u8bf7\u5148\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u5b89\u88c5ModelScope</li> </ol> <pre><code>pip install modelscope\n</code></pre> <ol> <li>\u4e0b\u8f7d\u6a21\u578b\u5230\u6307\u5b9a\u76ee\u5f55</li> </ol> <pre><code>from modelscope import snapshot_download\n# docling \u6a21\u578b\u4e0b\u8f7d\uff0clocal_dir\u6307\u5b9a\u6a21\u578b\u8def\u5f84\ndocling_model_dir = snapshot_download(\n    model_id='ds4sd/docling-models',\n    local_dir='./docling_model'\n)\nprint(f'\u4e0b\u8f7ddocling\u6a21\u578b\u8def\u5f84: {docling_model_dir}')\n\n# rapidocr \u6a21\u578b\u4e0b\u8f7d\uff0clocal_dir\u6307\u5b9a\u6a21\u578b\u8def\u5f84\nrapidocr_model_dir = snapshot_download(\n    model_id='RapidAI/RapidOCR', \n    local_dir='./rapidocr_model'\n)\nprint(f'\u4e0b\u8f7docr\u6a21\u578b\u8def\u5f84: {rapidocr_model_dir}')\n</code></pre>"},{"location":"rag/%E3%80%90RAG%E3%80%91docling%E7%BB%93%E5%90%88OCR%E5%AE%9E%E7%8E%B0pdf%E8%BD%ACmarkdown/#doclinglangchain","title":"docling\u96c6\u6210langchain","text":"<p>\u5728 github \u4e0a\u9762\u6709\u4e00\u4e2a\u5f00\u6e90\u5e93docling-langchain \u5df2\u7ecf\u5c06 docling \u548c langchain \u8fdb\u884c\u4e86\u96c6\u6210\uff0c\u6709\u5174\u8da3\u53ef\u4ee5\u67e5\u770blangchain\u4e2d\u7684\u6587\u6863\u3002\u56e0\u4e3a\u540e\u9762\u4f1a\u5c06 pdf \u4e2d\u7684\u56fe\u7247\u4fdd\u5b58\u5230 oss \u4e2d\uff0c\u8fd9\u4e9b\u81ea\u5b9a\u4e49\u7684\u529f\u80fd\u5728\u8fd9\u4e2a\u5f00\u6e90\u5e93\u4e2d\u4e0d\u65b9\u4fbf\u5b9e\u73b0\uff0c\u6240\u4ee5\u8fd9\u91cc\u6211\u5c06\u901a\u8fc7\u81ea\u5b9a\u4e49\u4e00\u4e2a\u7c7b <code>Pdf2MarkdownLoader</code> \u7ee7\u627f <code>langchain</code> \u7684 <code>BasePDFLoader</code>\uff0c\u5e76\u91cd\u65b0\u5b9e\u73b0<code>load()</code>\u65b9\u6cd5\u6765\u5b9e\u73b0\u76f8\u5173\u7684\u529f\u80fd\uff0c\u5b9e\u73b0\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>class Pdf2MarkdownLoader(BasePDFLoader):\n\n    def __init__(\n            self,\n            file_path: str,\n            model_path: str = '/Users/xiniao/\u5927\u6a21\u578b/RAG_Techniques/docling-models',\n            do_ocr: bool = True,\n            generate_picture_images: bool = True,\n            images_scale: float = 2.0,\n            do_image_upload: bool = False,\n            bucket: oss2.Bucket = None,\n            device: str = 'cpu',\n            output_dir: str = 'markdown_files'\n    ) -&gt; None:\n        \"\"\"Initialize with a file path.\"\"\"\n        try:\n            from docling.document_converter import DocumentConverter  # noqa:F401\n        except ImportError:\n            raise ImportError(\n                \"`docling` package not found, please install it with \"\n                \"`pip install docling`\"\n            )\n\n        super().__init__(file_path)\n        self.model_path = model_path\n        self.do_ocr = do_ocr\n        self.generate_picture_images = generate_picture_images\n        self.images_scale = images_scale\n        self.do_image_upload = do_image_upload\n        self.bucket = bucket\n        self.device = device\n\n        self.output_dir = Path(output_dir)\n    def load(self) -&gt; list[Document]:\n        # todo \u5728\u540e\u7eed\u7684\u4ecb\u7ecd\u4e2d\u5b9e\u73b0\n        pass\n</code></pre>"},{"location":"rag/%E3%80%90RAG%E3%80%91docling%E7%BB%93%E5%90%88OCR%E5%AE%9E%E7%8E%B0pdf%E8%BD%ACmarkdown/#rapidocrcpu","title":"\u90e8\u7f72RapidOCR\u5230CPU","text":"<p>\u53c2\u8003docling\u7684\u6587\u6863\uff0cdocling \u96c6\u6210 rapidocr \u5728 cpu \u8fd0\u884c\u7684\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>import os\nfrom docling.datamodel.pipeline_options import PdfPipelineOptions, RapidOcrOptions\nfrom docling.document_converter import (\n    ConversionResult,\n    DocumentConverter,\n    InputFormat,\n    PdfFormatOption,\n)\n\ndef main():\n    # Source document to convert\n    source = \"https://arxiv.org/pdf/2408.09869v4\"\n\n    # Setup RapidOcrOptions for english detection\n    det_model_path = os.path.join(\n        rapidocr_model_dir, \"PP-OCRv4\", \"en_PP-OCRv3_det_infer.onnx\"\n    )\n    rec_model_path = os.path.join(\n        rapidocr_model_dir, \"PP-OCRv4\", \"ch_PP-OCRv4_rec_server_infer.onnx\"\n    )\n    cls_model_path = os.path.join(\n        rapidocr_model_dir, \"PP-OCRv3\", \"ch_ppocr_mobile_v2.0_cls_train.onnx\"\n    )\n    ocr_options = RapidOcrOptions(\n        det_model_path=det_model_path,\n        rec_model_path=rec_model_path,\n        cls_model_path=cls_model_path,\n    )\n\n    pipeline_options = PdfPipelineOptions(\n        ocr_options=ocr_options,\n    )\n\n    # Convert the document\n    converter = DocumentConverter(\n        format_options={\n            InputFormat.PDF: PdfFormatOption(\n                pipeline_options=pipeline_options,\n            ),\n        },\n    )\n\n    conversion_result: ConversionResult = converter.convert(source=source)\n    doc = conversion_result.document\n    md = doc.export_to_markdown()\n    print(md)\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"rag/%E3%80%90RAG%E3%80%91docling%E7%BB%93%E5%90%88OCR%E5%AE%9E%E7%8E%B0pdf%E8%BD%ACmarkdown/#rapidocrgpu","title":"\u90e8\u7f72RapidOCR\u5230GPU","text":""},{"location":"rag/%E3%80%90RAG%E3%80%91docling%E7%BB%93%E5%90%88OCR%E5%AE%9E%E7%8E%B0pdf%E8%BD%ACmarkdown/#_2","title":"\u5982\u4f55\u9009\u62e9\u63a8\u7406\u5f15\u64ce","text":"<p>\u53c2\u8003 RapidOCR\u63a8\u7406\u5f15\u64ce\u9009\u62e9\u6307\u5357\uff0c\u5c06RapidOCR\u90e8\u7f72\u5230GPU\u63a8\u8350\u4f7f\u7528\uff1a<code>rapidocr_paddle</code>\u3002</p> <p>\u63a8\u8350\u7406\u7531\uff1a</p> <p>PaddleOCR\u6a21\u578b\u672c\u8eab\u5c31\u662f\u7531PaddlePaddle\u6846\u67b6\u8bad\u7ec3\u800c\u6765\u7684\uff0cPaddlePaddle\u6846\u67b6\u539f\u751f\u652f\u6301\u5728CPU\u548cGPU\u4e0a\u63a8\u7406PaddleOCR\u76f8\u5173\u6a21\u578b\u3002</p> <p>rapidocr_paddle\u5305\u662f\u57fa\u4e8ePaddlePaddle\u6846\u67b6\u4f5c\u4e3a\u63a8\u7406\u5f15\u64ce\u7684\uff0c\u652f\u6301CPU\u548cGPU\u4e0a\u63a8\u7406\uff0c\u63a8\u8350GPU\u7aef\u4f7f\u7528\u3002</p> <p>\u539f\u56e0\u662fONNXRuntime\u548cOpenVINO\u5728GPU\u4e0a\u652f\u6301\u8f83\u5dee\uff1a</p> <ul> <li>onnxruntime-gpu\uff1a\u5728\u52a8\u6001\u8f93\u5165\u60c5\u51b5\u4e0b\uff0c\u63a8\u7406\u901f\u5ea6\u8981\u6bd4CPU\u6162\u5f88\u591a\uff0c\u800cOCR\u4efb\u52a1\u5c31\u662f\u52a8\u6001\u8f93\u5165\uff0c\u56e0\u6b64\u4e0d\u63a8\u8350\u4f7f\u7528onnxruntime-gpu\u7248\u63a8\u7406\u3002</li> <li>rapidocr_openvino: \u51fa\u81ea\u82f1\u7279\u5c14\uff0c\u53ea\u9002\u914d\u81ea\u5bb6GPU\u3002</li> </ul> <p>CPU\u7aef\u8fd8\u662f\u4ee5rapidocr_onnxruntime\u548crapidocr_openvino\u4e3a\u4e3b\u3002\u6bd5\u7adfPaddlePaddle\u7684CPU\u7aef\u8fd8\u662f\u6bd4\u8f83\u91cd\u7684\u3002</p> <p>\u503c\u5f97\u8bf4\u660e\u7684\u662f\uff0c\u8fd9\u4e2a\u5305\u548cPaddleOCR\u76f8\u6bd4\uff0c\u4ee3\u7801\u57fa\u672c\u90fd\u662f\u4e00\u6837\u7684\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u4e2a\u5e93\u5c06\u91cc\u9762\u6838\u5fc3\u63a8\u7406\u4ee3\u7801\u62bd\u4e86\u51fa\u6765\uff0c\u66f4\u52a0\u7cbe\u7b80\u800c\u5df2\u3002</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91docling%E7%BB%93%E5%90%88OCR%E5%AE%9E%E7%8E%B0pdf%E8%BD%ACmarkdown/#gpu-rapidocr","title":"\u5728 gpu \u4e0a\u9762\u8fd0\u884c RapidOCR \u6b65\u9aa4","text":""},{"location":"rag/%E3%80%90RAG%E3%80%91docling%E7%BB%93%E5%90%88OCR%E5%AE%9E%E7%8E%B0pdf%E8%BD%ACmarkdown/#paddlepaddlegpu","title":"\u5b89\u88c5PaddlePaddle\u6846\u67b6GPU\u7248","text":"<p>\u5b89\u88c5PaddlePaddle\u6846\u67b6GPU\u7248\uff0c\u5e76\u9a8c\u8bc1\u53ef\u884c\u6027\uff0c\u8be6\u7ec6\u53c2\u89c1: \u5b98\u65b9\u6559\u7a0b\u3002\u8fd9\u91cc\u6253\u7b97\u5c06rapidocr\u90e8\u7f72\u5230 linux \u7cfb\u7edf\u4e2d\uff0c\u4f7f\u7528\u82f1\u4f1f\u8fbe\u7684 GPU \u7248\u672c\u4e3a 12.1\u3002</p> <p>\u76f4\u63a5\u67e5\u770b CUDA \u5de5\u5177\u5305\u7248\u672c\u7684\u547d\u4ee4\u4e3a\uff1a<code>**nvcc --version**</code></p> <p>\u5feb\u901f\u67e5\u770b CUDA \u7248\u672c\uff08\u4f9d\u8d56\u9a71\u52a8\uff09\u7684\u547d\u4ee4\u4e3a\uff1a<code>**nvidia-smi**</code> </p> <p>\u9009\u62e9\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u4f7f\u7528 pip \u5b89\u88c5 <code>paddlepaddle-gpu</code>\u7684\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code> python -m pip install paddlepaddle-gpu==3.0.0 -i https://www.paddlepaddle.org.cn/packages/stable/cu126/\n</code></pre> <p>\u76f4\u63a5\u8fd0\u884c\u524d\u9762\u7684\u547d\u4ee4\u4f1a\u62a5\u9519\uff0c\u62a5\u9519\u4fe1\u606f\u5982\u4e0b\uff1a</p> <pre><code> ~ %  python3 -m pip install paddlepaddle-gpu==3.0.0 -i https://www.paddlepaddle.org.cn/packages/stable/cu126/\nLooking in indexes: https://www.paddlepaddle.org.cn/packages/stable/cu126/\nERROR: Could not find a version that satisfies the requirement paddlepaddle-gpu==3.0.0 (from versions: none)\n\n[notice] A new release of pip is available: 24.3.1 -&gt; 25.1.1\n[notice] To update, run: pip3 install --upgrade pip\nERROR: No matching distribution found for paddlepaddle-gpu==3.0.0\n</code></pre> <p>\u4ece\u62a5\u9519\u4fe1\u606f\u53ef\u4ee5\u53d1\u73b0\uff0c\u5728\u4ed3\u5e93 <code>[https://www.paddlepaddle.org.cn/packages/stable/cu126/](https://www.paddlepaddle.org.cn/packages/stable/cu126/)</code>\u4e2d\u627e\u4e0d\u5230 <code>paddlepaddle-gpu==3.0.0</code>\uff0c\u63a5\u4e0b\u6765\u5c06\u4ecb\u7ecd\u4e00\u4e0b\u6211\u662f\u5982\u4f55\u4e00\u6b65\u6b65\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u7684\u3002</p> <ol> <li>\u9996\u5148 pypi \u4ed3\u5e93\u4e2d\u641c\u7d22 <code>paddlepaddle-gpu</code>\u5bf9\u5e94\u7684\u5305\u4fe1\u606f\uff0c\u53d1\u73b0\u6700\u65b0\u7684\u53ea\u6709<code>paddlepaddle-gpu 2.6.2</code>\uff0c\u5b83\u4e0d\u652f\u6301 cuda 12.1\u3002</li> <li>\u7136\u540e\u8fdb\u5165\u4ed3\u5e93 <code>[https://www.paddlepaddle.org.cn/packages/stable/cu126/](https://www.paddlepaddle.org.cn/packages/stable/cu126/)</code>\uff0c\u627e\u5230<code>paddlepaddle-gpu</code>\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</li> </ol> <p></p> <ol> <li>\u6700\u540e\u8fdb\u5165 <code>paddlepaddle-gpu</code>\u76ee\u5f55\uff0c\u56e0\u4e3a\u8fd9\u91cc\u4f7f\u7528\u7684\u4f7f\u7528 python3.10\uff0c\u4f7f\u7528\u7684\u662f linux\u7cfb\u7edf\uff0c\u6240\u4ee5\u4e0b\u8f7d\u7684python\u5305\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u4f60\u53ef\u4ee5\u6839\u636e\u4f60\u7684\u7cfb\u7edf\u548cpython\u7248\u672c\u4e0b\u8f7d\u5bf9\u5e94\u7684 python \u5305\uff1a</li> </ol> <p></p> <ol> <li>\u4e0b\u8f7d\u5b8c\u6210\u540e\uff0c\u5c06\u5bf9\u5e94\u7684\u5305\u4f20\u5165\u5230\u670d\u52a1\u5668\u4e2d\uff0c\u7136\u540e\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u5b89\u88c5 <code>paddlepaddle-gpu</code>\u5305\uff1a</li> </ol> <pre><code>pip install paddlepaddle_gpu-3.0.0-cp310-cp310-linux_x86_64.whl\n</code></pre> <ol> <li>\u5b89\u88c5 <code>paddlepaddle-gpu</code>\u5305\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u4ee3\u7801\u6765\u9a8c\u8bc1\u662f\u5426\u5b89\u88c5\u6210\u529f\uff1a</li> </ol> <pre><code>import paddle\n\nprint(paddle.utils.run_check())\n# \u5982\u679c\u51fa\u73b0PaddlePaddle is installed successfully!\uff0c\u8bf4\u660e\u60a8\u5df2\u6210\u529f\u5b89\u88c5\u3002\n</code></pre> <p>\u8fd9\u91cc\u5728notebook\u4e2d\u7684\u8fd0\u884c\u7ed3\u679c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u8bf4\u660e<code>paddlepaddle-gpu</code>\u5305\u5df2\u7ecf\u5b89\u88c5\u6210\u529f\uff1a</p> <p></p>"},{"location":"rag/%E3%80%90RAG%E3%80%91docling%E7%BB%93%E5%90%88OCR%E5%AE%9E%E7%8E%B0pdf%E8%BD%ACmarkdown/#rapidocr_paddle","title":"\u5b89\u88c5rapidocr_paddle","text":"<p>\u5b89\u88c5<code>paddlepaddle-gpu</code>\u5305\u6210\u529f\u540e\uff0c\u9700\u8981\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u5b89\u88c5 <code>rapidocr_paddle</code>\u5305\uff1a</p> <pre><code>pip install rapidocr_paddle\n</code></pre>"},{"location":"rag/%E3%80%90RAG%E3%80%91docling%E7%BB%93%E5%90%88OCR%E5%AE%9E%E7%8E%B0pdf%E8%BD%ACmarkdown/#_3","title":"\u57fa\u672c\u4f7f\u7528","text":"<p>\u5b89\u88c5<code>paddlepaddle-gpu</code>\u5305\u548c <code>rapidocr_paddle</code>\u5305\u90fd\u6210\u529f\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u4ee3\u7801\u6765\u9a8c\u8bc1 rapidocr \u6a21\u578b\u662f\u5426\u80fd\u6b63\u5e38\u8fd0\u884c\uff1a</p> <pre><code>import cv2\n\nfrom rapidocr_paddle import RapidOCR\n\n# \u6ce8\u610f\u8fd9\u91cc\u7684\u53c2\u6570\nengine = RapidOCR(det_use_cuda=True, cls_use_cuda=True, rec_use_cuda=True)\n\nimage_path = \"tests/test_files/ch_en_num.jpg\"\nresult, elapse_list = engine(image_path)\n</code></pre> <p>\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u67e5\u770b gpu \u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u5b9e\u65f6\u76d1\u63a7 GPU \u4f7f\u7528\u7387\u547d\u4ee4\uff08\u6bcf 2 \u79d2\u5237\u65b0\u4e00\u6b21\uff09\uff1a</p> <pre><code>nvidia-smi -l 2\n</code></pre> <p>\u8fd0\u884c\u7684\u7ed3\u679c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u8fd9\u91cc\u7684gpu\u4f7f\u7528\u7387\u8fbe\u5230\u4e86 72%\uff1a</p> <p></p>"},{"location":"rag/%E3%80%90RAG%E3%80%91docling%E7%BB%93%E5%90%88OCR%E5%AE%9E%E7%8E%B0pdf%E8%BD%ACmarkdown/#oss","title":"\u4fdd\u5b58\u56fe\u7247\u5e76\u5b58\u50a8\u5230oss","text":"<p>\u63a5\u4e0b\u6765\u4ecb\u7ecd\u4e00\u4e0b\u5982\u4f55\u5c06pdf\u8f6cmarkdown\u8fc7\u7a0b\u4e2d\uff0c\u6a21\u578b\u8bc6\u522b\u51fa\u7684\u56fe\u7247\u4fdd\u5b58\u4e0b\u6765\uff0c\u5e76\u81ea\u52a8\u4e0a\u4f20\u5230oss\u4e2d\uff0c\u4ee5\u4fbf\u5728markdown\u6587\u4ef6\u4e2d\u9884\u89c8\u56fe\u7247\u3002</p> <p>\u5c06pdf\u8f6cmarkdown\u8fc7\u7a0b\u4e2d\uff0c\u4fdd\u5b58\u6a21\u578b\u8bc6\u522b\u51fa\u7684\u56fe\u7247\u6709\u4e24\u4e2a\u6b65\u9aa4\uff1a</p> <ol> <li>\u67e5\u9605 docling \u7684\u5b98\u65b9\u6587\u6863\uff0c\u53d1\u73b0\u53ef\u4ee5\u5728\u521b\u5efa <code>PdfPipelineOptions</code>\u65f6\uff0c\u901a\u8fc7\u8bbe\u7f6e\u53c2\u6570 <code>generate_picture_images = True</code>\u6765\u63a7\u5236\u662f\u5426\u751f\u6210\u56fe\u7247\u3002</li> </ol> <p>\u4ee3\u7801\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>pipeline_options = PdfPipelineOptions(\n            artifacts_path=self.model_path, # docling\u6a21\u578b\u7684\u8def\u5f84\n            do_ocr=self.do_ocr,  # \u63a7\u5236\u662f\u5426\u8fdb\u884c ocr \u8bc6\u522b\n            ocr_options=ocr_options,  # ocr \u6a21\u578b\u76f8\u5173\u7684\u914d\u7f6e\n            # do_picture_description=True,\n            generate_picture_images=self.generate_picture_images, # \u63a7\u5236\u662f\u5426\u751f\u6210\u56fe\u7247\n            images_scale=self.images_scale\u3002# \u4fdd\u5b58\u56fe\u7247\u7684\u50cf\u7d20\u6bd4\u4f8b scale * 72\n        )\n</code></pre> <ol> <li>\u5728\u4f7f\u7528<code>document.save_as_markdown()</code>\u65b9\u6cd5\u4fdd\u5b58markdown\u6587\u4ef6\u5185\u5bb9\u7684\u65f6\u5019\u9700\u8981\u6307\u5b9a\u53c2\u6570 <code>image_mode=ImageRefMode.REFERENCED</code>\uff0c\u5728 <code>ImageRefMode</code>\u4e2d\u6709\u4e09\u79cd\u4fdd\u5b58\u56fe\u7247\u7684\u6a21\u5f0f\uff1a</li> </ol> <pre><code>class ImageRefMode(str, Enum):\n    \"\"\"ImageRefMode.\"\"\"\n\n    PLACEHOLDER = \"placeholder\"  # just a place-holder\n    EMBEDDED = \"embedded\"  # embed the image as a base64\n    REFERENCED = \"referenced\"  # reference the image via uri\n</code></pre> \u6a21\u5f0f \u63cf\u8ff0 \u5178\u578b\u573a\u666f <code>PLACEHOLDER</code> \u4ec5\u4fdd\u7559\u56fe\u50cf\u7684\u5360\u4f4d\u7b26\uff0c\u4e0d\u5b9e\u9645\u5b58\u50a8\u6216\u5f15\u7528\u56fe\u50cf\u6570\u636e\u3002 \u56fe\u50cf\u5c1a\u672a\u52a0\u8f7d\u3001\u4e34\u65f6\u6807\u8bb0\u3001\u6216\u4ec5\u9700\u8981\u4f4d\u7f6e\u6807\u8bb0\u7684\u573a\u666f\u3002 <code>EMBEDDED</code> \u5c06\u56fe\u50cf\u6570\u636e\u76f4\u63a5\u5d4c\u5165\u5230\u5f53\u524d\u8f7d\u4f53\u4e2d\uff08\u5982\u901a\u8fc7 Base64 \u7f16\u7801\uff09\u3002 \u9700\u8981\u5c06\u56fe\u50cf\u4e0e\u6587\u6863/\u6570\u636e\u5305\u7ed1\u5b9a\uff08\u5982 PDF\u3001JSON \u914d\u7f6e\uff09\u3002 <code>REFERENCED</code> \u901a\u8fc7 URI\uff08\u5982 URL\u3001\u6587\u4ef6\u8def\u5f84\uff09\u5f15\u7528\u5916\u90e8\u56fe\u50cf\u8d44\u6e90\u3002 \u56fe\u50cf\u5b58\u50a8\u5728\u72ec\u7acb\u4f4d\u7f6e\uff08\u5982\u7f51\u7edc\u56fe\u7247\u3001\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\uff09\u3002 <p>\u4ee3\u7801\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code># \u6ca1\u6709\u63d0\u4f9bartifacts_dir\u7684\u65f6\u5019\uff0c\u51fd\u6570\u4f1a\u6839\u636efilename\u81ea\u52a8\u751f\u6210\u4e00\u4e2a\u76ee\u5f55\u8def\u5f84\u3002\n# \u6bd4\u5982\uff0c\u5047\u8bbefilename\u662f/path/to/file.txt\uff0c\u90a3\u4e48artifacts_dir\u4f1a\u88ab\u8bbe\u7f6e\u4e3a/path/to/file_artifacts\u3002\n# \u8fd9\u91cc\u7684\u903b\u8f91\u662f\u53bb\u6389\u539f\u6587\u4ef6\u7684\u6269\u5c55\u540d\uff0c\u7136\u540e\u5728\u540e\u9762\u52a0\u4e0a_artifacts\u4f5c\u4e3a\u76ee\u5f55\u540d\nconv_res.document.save_as_markdown(\n    filename=md_filename,\n    image_mode=ImageRefMode.REFERENCED\n)\n</code></pre> <p>\u4f7f\u7528\u4e0a\u9762\u4e24\u4e2a\u6b65\u9aa4\uff0c\u53ef\u4ee5\u5c06pdf\u4e2d\u7684\u56fe\u7247\u4fdd\u5b58\u5230\u672c\u5730\uff0c\u4e0b\u9762\u5b9a\u4e49\u4e00\u4e2a\u65b9\u6cd5\uff0c\u7528\u4e8e\u5c06 markdown \u6587\u4ef6\u4e2d\u7684\u56fe\u7247\u4e0a\u4f20\u5230 oss \u4e2d\uff0c\u5e76\u7528 oss \u7684\u5730\u5740\u66ff\u6362\u539f\u6765\u7684\u56fe\u7247\uff1a</p> <pre><code>def replace_local_images_with_oss_url(\n        content: str,\n        bucket: oss2.Bucket = None,\n        expires: int = 60 * 60 * 24 * 365 * 5,\n        location: str = 'kg/document/image/',\n        image_folder: Path = None\n):\n    \"\"\"\n    \u66ff\u6362Markdown\u6587\u4ef6\u4e2d\u7684\u672c\u5730\u56fe\u7247\u8def\u5f84\u4e3aOSS URL\n    @param content: Markdown\u6587\u4ef6\u5185\u5bb9\n    @param bucket: oss2.Bucket\u5bf9\u8c61\n    @param expires: \u9884\u89c8\u94fe\u63a5\u8fc7\u671f\u65f6\u95f4\uff0c\u5355\u4f4d\u79d2\uff0c\u9ed8\u8ba4\u4e3a\u4e00\u5e74\n    @param location: OSS\u6587\u4ef6\u5939\u8def\u5f84\n    \"\"\"\n    import re\n    if not bucket:\n        logger.error('bucket is None, \u8bf7\u68c0\u67e5oss2.Bucket\u5bf9\u8c61\u662f\u5426\u6b63\u786e\u521d\u59cb\u5316, \u8fd4\u56de\u539f\u59cb\u5185\u5bb9')\n        return content\n\n    # \u5339\u914dMarkdown\u6587\u4ef6\u4e2d\u7684\u56fe\u7247\u8def\u5f84\n    pattern = r'!\\[(.*?)\\]\\((.*?)\\)'\n    matches = re.findall(pattern, content)\n    logger.info(f'\u5339\u914d\u5230 {len(matches)} \u5f20\u56fe\u7247')\n    replace_num = 0\n\n    new_content = content\n    # \u4e0a\u4f20\u5e76\u66ff\u6362\u56fe\u7247\n    for alt_text, image_path in matches:\n        old_image_path = f\"![{alt_text}]({image_path})\"\n        # \u5224\u65ad\u56fe\u7247\u6587\u4ef6\u662f\u5426\u5b58\u5728\n        img_path = Path(image_path)\n        if image_folder:\n            img_path = image_folder / img_path\n        if not img_path.exists():\n            logger.warning(f\"\u56fe\u7247\u6587\u4ef6\u4e0d\u5b58\u5728: {image_path}\")\n            continue\n        filename = img_path.stem\n        suffix = img_path.suffix\n        # \u6784\u9020OSS\u6587\u4ef6\u540d\uff0c\u786e\u4fdd\u4e0d\u91cd\u590d\n        unique_name = generate_uuid(filename)\n        file_key = f\"{unique_name}_image_{replace_num:03}{suffix}\"\n        if location.endswith('/'):\n            file_key = f\"{location}{file_key}\"\n        else:\n            file_key = f\"{location}/{file_key}\"\n        filename = str(img_path.absolute())\n        # \u4e0a\u4f20\u56fe\u7247\u5230OSS\n        result = bucket.put_object_from_file(key=file_key, filename=filename)\n        if result.status == 200:\n            preview_url = bucket.sign_url(method='GET', key=file_key, expires=expires)\n        else:\n            logger.error(f\"\u56fe\u7247\u4e0a\u4f20\u5931\u8d25: {result.status} {result.reason}\")\n            preview_url = None\n\n        # \u66ff\u6362\u56fe\u7247\u8def\u5f84\n        if preview_url:\n            preview_url = str(preview_url).replace('internal', 'office', 1)\n            # \u5982\u679c\u9884\u89c8\u5730\u5740\u8fc7\u671f\uff0c\u53ef\u4ee5\u901a\u8fc7new_alt_text\uff0c\u5c06\"_\"\u66ff\u6362\u4e3a\"/\"\u4f5c\u4e3aoss\u7684key\uff0c\u91cd\u65b0\u751f\u6210\u9884\u89c8\u5730\u5740\n            new_alt_text = file_key.replace('/', '_')\n            new_image_path = f\"![{new_alt_text}]({preview_url})\"\n\n            new_content = new_content.replace(old_image_path, new_image_path)\n            replace_num += 1\n            logger.info(f\"Replacing {old_image_path} with {new_image_path}\")\n\n    logger.info(f\"\u66ff\u6362\u5b8c\u6210\uff0c\u5171\u66ff\u6362 {replace_num} \u5f20\u56fe\u7247\")\n    return new_content\n</code></pre>"},{"location":"rag/%E3%80%90RAG%E3%80%91docling%E7%BB%93%E5%90%88OCR%E5%AE%9E%E7%8E%B0pdf%E8%BD%ACmarkdown/#docling","title":"\u4fee\u6539docling\u6e90\u7801","text":"<p>\u4f7f\u7528 docling \u96c6\u6210 RapidOCR \u6a21\u578b\u5728 GPU \u4e0a\u9762\u8fd0\u884c\u65f6\uff0c\u67e5\u770bdocling\u6e90\u7801 https://github.com/docling-project/docling/blob/main/docling/models/rapid_ocr_model.py\uff0crapid_ocr_model.py \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f7f\u7528\u7684\u662f</p> <p><code>from rapidocr_onnxruntime import RapidOCR</code>\u3002</p> <p>\u5982\u679c\u76f4\u63a5\u8fd0\u884c\u7684\u8bdd\uff0c\u4f1a\u6709\u5982\u4e0b\u7684\u544a\u8b66\u4fe1\u606f\uff1a</p> <p>github\u76f8\u540cissue: https://github.com/docling-project/docling/issues/1143 </p> <pre><code>XGPU-lite: L-222:vGPU version: 2010, CUDA driver version: 12010\nXGPU-lite: L-142:vGPUs:VGPU-34d49a72-ff09-9917-96e1-77378cb1f695.2 count:1 pGPUs:GPU-34d49a72-ff09-9917-96e1-77378cb1f695\nXGPU-lite: L-73:vgpu client init done, hostID:90c56bdef158 PID:423712 gpuCnt:1 vir-ratio:1 vdev-ratio:1\nXGPU-lite: L-86:pGPU used:GPU-34d49a72-ff09-9917-96e1-77378cb1f695\nXGPU-lite: L-98:Job hostID:90c56bdef158 pid:423712 desc:python3.10 connecting to XGPU service ...\nXGPU-lite: L-127:HostID:90c56bdef158 pid:423712 XGPU connected jobIdx:0 token:0\nXGPU-lite: L-150:Client configuration: use_uma = 1, compute_schedule_mode: 4, need_launch_kernel_admission: 0, time_slice_spin_or_cv: 1, enable_heart_beat: 0, enable_monitor: 0.\nXGPU-lite: L-235:func: cuInit, pid: 423712, tid: 423712, flags: 0\nXGPU-lite: L-115:The device count is 1.\nXGPU-lite: L-135:The device uuid string is 34d49a72-ff09-9917-96e1-77378cb1f695.\nXGPU-lite: L-142:Find vGPU VGPU-34d49a72-ff09-9917-96e1-77378cb1f695.2 for the pGPU 34d49a72-ff09-9917-96e1-77378cb1f695\n2025-05-07 19:59:54,030 - OrtInferSession - WARNING: CUDAExecutionProvider is not in available providers (['AzureExecutionProvider', 'CPUExecutionProvider']). Use AzureExecutionProvider inference by default.\n2025-05-07 19:59:54,031 - OrtInferSession - INFO: !!!Recommend to use rapidocr_paddle for inference on GPU.\n2025-05-07 19:59:54,031 - OrtInferSession - INFO: (For reference only) If you want to use GPU acceleration, you must do:\n2025-05-07 19:59:54,031 - OrtInferSession - INFO: First, uninstall all onnxruntime pakcages in current environment.\n2025-05-07 19:59:54,031 - OrtInferSession - INFO: Second, install onnxruntime-gpu by `pip install onnxruntime-gpu`.\n2025-05-07 19:59:54,031 - OrtInferSession - INFO:       Note the onnxruntime-gpu version must match your cuda and cudnn version.\n2025-05-07 19:59:54,031 - OrtInferSession - INFO:       You can refer this link: https://onnxruntime.ai/docs/execution-providers/CUDA-EP.html\n2025-05-07 19:59:54,031 - OrtInferSession - INFO: Third, ensure CUDAExecutionProvider is in available providers list. e.g. ['CUDAExecutionProvider', 'CPUExecutionProvider']\n2025-05-07 19:59:54,031 - OrtInferSession - WARNING: DirectML is only supported in Windows OS. The current OS is Linux. Use AzureExecutionProvider inference by default.\n2025-05-07 19:59:54,080 - OrtInferSession - WARNING: CUDAExecutionProvider is not in available providers (['AzureExecutionProvider', 'CPUExecutionProvider']). Use AzureExecutionProvider inference by default.\n</code></pre> <p>\u4ece\u544a\u8b66\u4fe1\u606f\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u5982\u679c\u5728 GPU \u4e0a\u9762\u8fd0\u884c\u63a8\u8350\u4f7f\u7528 <code>rapidocr_paddle</code>\uff0c\u4e3a\u4e86\u80fd\u591f\u8ba9 docling \u4f7f\u7528 <code>rapidocr_paddle</code>\u8fd0\u884c ocr \u6a21\u578b\uff0c\u90a3\u4e48\u9700\u8981\u5c06 rapid_ocr_model.py\u6587\u4ef6\u8fdb\u884c\u5982\u4e0b\u4fee\u6539\u5373\u53ef\uff1a</p> <pre><code>\u539f\u6765\u7684: from rapidocr_onnxruntime import RapidOCR\n\u66ff\u6362\u4e3a: from rapidocr_paddle import RapidOCR\n</code></pre> <p>\u5982\u679c\u4e0d\u60f3\u4fee\u6539\u6e90\u7801\uff0c\u5728 docling \u4e2d\u4e5f\u652f\u6301\u901a\u8fc7\u63d2\u4ef6\u7684\u65b9\u5f0f\u6ce8\u518c\u81ea\u5b9a\u4e49\u7684 OCR \u6a21\u578b\uff0c\u8be6\u7ec6\u53ef\u4ee5\u67e5\u770b\u6587\u6863\uff1a</p> <p>https://docling-project.github.io/docling/concepts/plugins/ </p>"},{"location":"rag/%E3%80%90RAG%E3%80%91docling%E7%BB%93%E5%90%88OCR%E5%AE%9E%E7%8E%B0pdf%E8%BD%ACmarkdown/#_4","title":"\u5b8c\u6574\u4ee3\u7801\u5b9e\u73b0","text":"<p>\u63a5\u4e0b\u6765\u5c06\u524d\u9762\u6240\u6709\u7684\u4ee3\u7801\u8fdb\u884c\u6574\u5408\uff0c\u6574\u5408\u540e\u7684\u4ee3\u7801\u652f\u6301\u5982\u4e0b\u529f\u80fd\uff1a</p> <ul> <li>\u76ee\u524d\u53ea\u652f\u6301 RapidOCR </li> <li>\u652f\u6301\u548clangchain\u96c6\u6210</li> <li>\u652f\u6301\u5728cpu\u548cgpu\u8fd0\u884c</li> <li>\u652f\u6301\u4e0a\u4f20\u56fe\u7247\u5230 oss</li> </ul> <p>\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>import os\nimport oss2\nfrom typing import Iterator\nfrom langchain_community.document_loaders.pdf import BasePDFLoader\nfrom langchain_core.documents import Document\nfrom pathlib import Path\n# SDK\u6a21\u578b\u4e0b\u8f7d\nfrom modelscope import snapshot_download\nimport logging\n\nlogger = logging.getLogger(__name__)\n\n# docling \u6a21\u578b\u4e0b\u8f7d\uff0clocal_dir\u6307\u5b9a\u6a21\u578b\u8def\u5f84\ndocling_model_dir = snapshot_download(\n    model_id='ds4sd/docling-models',\n    local_dir='./docling_model'\n)\nprint(f'\u4e0b\u8f7ddocling\u6a21\u578b\u8def\u5f84: {docling_model_dir}')\n\n# rapidocr \u6a21\u578b\u4e0b\u8f7d\uff0clocal_dir\u6307\u5b9a\u6a21\u578b\u8def\u5f84\nrapidocr_model_dir = snapshot_download(\n    model_id='RapidAI/RapidOCR',\n    local_dir='./rapidocr_model'\n)\nprint(f'\u4e0b\u8f7docr\u6a21\u578b\u8def\u5f84: {rapidocr_model_dir}')\n\n\ndef generate_uuid(content: str) -&gt; str:\n    \"\"\"Generate a UUID for a document based on content.\"\"\"\n    import hashlib\n    import uuid\n    md5_hash = hashlib.md5(str(content).encode()).hexdigest()\n    return str(uuid.UUID(md5_hash).hex)\n\n\ndef replace_local_images_with_oss_url(\n        content: str,\n        bucket: oss2.Bucket = None,\n        expires: int = 60 * 60 * 24 * 365 * 5,\n        location: str = 'kg/document/image/',\n        image_folder: Path = None\n):\n    \"\"\"\n    \u66ff\u6362Markdown\u6587\u4ef6\u4e2d\u7684\u672c\u5730\u56fe\u7247\u8def\u5f84\u4e3aOSS URL\n    @param content: Markdown\u6587\u4ef6\u5185\u5bb9\n    @param bucket: oss2.Bucket\u5bf9\u8c61\n    @param expires: \u9884\u89c8\u94fe\u63a5\u8fc7\u671f\u65f6\u95f4\uff0c\u5355\u4f4d\u79d2\uff0c\u9ed8\u8ba4\u4e3a\u4e00\u5e74\n    @param location: OSS\u6587\u4ef6\u5939\u8def\u5f84\n    \"\"\"\n    import re\n    if not bucket:\n        logger.error('bucket is None, \u8bf7\u68c0\u67e5oss2.Bucket\u5bf9\u8c61\u662f\u5426\u6b63\u786e\u521d\u59cb\u5316, \u8fd4\u56de\u539f\u59cb\u5185\u5bb9')\n        return content\n\n    # \u5339\u914dMarkdown\u6587\u4ef6\u4e2d\u7684\u56fe\u7247\u8def\u5f84\n    pattern = r'!\\[(.*?)\\]\\((.*?)\\)'\n    matches = re.findall(pattern, content)\n    logger.info(f'\u5339\u914d\u5230 {len(matches)} \u5f20\u56fe\u7247')\n    replace_num = 0\n\n    new_content = content\n    # \u4e0a\u4f20\u5e76\u66ff\u6362\u56fe\u7247\n    for alt_text, image_path in matches:\n        old_image_path = f\"![{alt_text}]({image_path})\"\n        # \u5224\u65ad\u56fe\u7247\u6587\u4ef6\u662f\u5426\u5b58\u5728\n        img_path = Path(image_path)\n        if image_folder:\n            img_path = image_folder / img_path\n        if not img_path.exists():\n            logger.warning(f\"\u56fe\u7247\u6587\u4ef6\u4e0d\u5b58\u5728: {image_path}\")\n            continue\n        filename = img_path.stem\n        suffix = img_path.suffix\n        # \u6784\u9020OSS\u6587\u4ef6\u540d\uff0c\u786e\u4fdd\u4e0d\u91cd\u590d\n        unique_name = generate_uuid(filename)\n        file_key = f\"{unique_name}_image_{replace_num:03}{suffix}\"\n        if location.endswith('/'):\n            file_key = f\"{location}{file_key}\"\n        else:\n            file_key = f\"{location}/{file_key}\"\n        filename = str(img_path.absolute())\n        # \u4e0a\u4f20\u56fe\u7247\u5230OSS\n        result = bucket.put_object_from_file(key=file_key, filename=filename)\n        if result.status == 200:\n            preview_url = bucket.sign_url(method='GET', key=file_key, expires=expires)\n        else:\n            logger.error(f\"\u56fe\u7247\u4e0a\u4f20\u5931\u8d25: {result.status} {result.reason}\")\n            preview_url = None\n\n        # \u66ff\u6362\u56fe\u7247\u8def\u5f84\n        if preview_url:\n            preview_url = str(preview_url).replace('internal', 'office', 1)\n            # \u5982\u679c\u9884\u89c8\u5730\u5740\u8fc7\u671f\uff0c\u53ef\u4ee5\u901a\u8fc7new_alt_text\uff0c\u5c06\"_\"\u66ff\u6362\u4e3a\"/\"\u4f5c\u4e3aoss\u7684key\uff0c\u91cd\u65b0\u751f\u6210\u9884\u89c8\u5730\u5740\n            new_alt_text = file_key.replace('/', '_')\n            new_image_path = f\"![{new_alt_text}]({preview_url})\"\n\n            new_content = new_content.replace(old_image_path, new_image_path)\n            replace_num += 1\n            logger.info(f\"Replacing {old_image_path} with {new_image_path}\")\n\n    logger.info(f\"\u66ff\u6362\u5b8c\u6210\uff0c\u5171\u66ff\u6362 {replace_num} \u5f20\u56fe\u7247\")\n    return new_content\n\n\nclass Pdf2MarkdownLoader(BasePDFLoader):\n\n    def __init__(\n            self,\n            file_path: str,\n            model_path: str = docling_model_dir,\n            rapidocr_model_dir: str = rapidocr_model_dir,\n            do_ocr: bool = True,\n            generate_picture_images: bool = True,\n            images_scale: float = 2.0,\n            do_image_upload: bool = False,\n            bucket: oss2.Bucket = None,\n            device: str = 'cpu',\n            output_dir: str = 'markdown_files'\n    ) -&gt; None:\n        \"\"\"Initialize with a file path.\"\"\"\n        try:\n            from docling.document_converter import DocumentConverter  # noqa:F401\n        except ImportError:\n            raise ImportError(\n                \"`docling` package not found, please install it with \"\n                \"`pip install docling`\"\n            )\n\n        super().__init__(file_path)\n        self.model_path = model_path\n        self.rapidocr_model_dir = rapidocr_model_dir\n        self.do_ocr = do_ocr\n        self.generate_picture_images = generate_picture_images\n        self.images_scale = images_scale\n        self.do_image_upload = do_image_upload\n        self.bucket = bucket\n        self.device = device\n\n        self.output_dir = Path(output_dir)\n\n    def _get_rapidocr_pipeline_options(self):\n\n        from docling.datamodel.pipeline_options import PdfPipelineOptions, RapidOcrOptions\n        download_path = self.rapidocr_model_dir\n        if self.device == 'cpu':\n            # pip install rapidocr_onnxruntime\n            try:\n                from rapidocr_onnxruntime import RapidOCR  # type: ignore\n            except ImportError:\n                raise ImportError(\n                    \"RapidOCR is not installed. Please install it via `pip install rapidocr_onnxruntime` to use this OCR engine. \"\n                    \"Alternatively, Docling has support for other OCR engines. See the documentation.\"\n                )\n            det_model_path = os.path.join(\n                download_path, \"onnx/PP-OCRv4/det\", \"Multilingual_PP-OCRv3_det_infer.onnx\"\n            )\n            rec_model_path = os.path.join(\n                download_path, \"onnx/PP-OCRv4/rec\", \"ch_PP-OCRv4_rec_server_infer.onnx\"\n            )\n            cls_model_path = os.path.join(\n                download_path, \"onnx/PP-OCRv4/cls\", \"ch_ppocr_mobile_v2.0_cls_infer.onnx\",\n            )\n        else:\n            # pip install rapidocr_paddle\n            try:\n                from rapidocr_paddle import RapidOCR  # type: ignore\n            except ImportError:\n                raise ImportError(\n                    \"RapidOCR is not installed. Please install it via `pip install rapidocr_paddle` to use this OCR engine. \"\n                    \"Alternatively, Docling has support for other OCR engines. See the documentation.\"\n                )\n            det_model_path = os.path.join(\n                download_path, \"paddle/PP-OCRv4/det\", \"ch_PP-OCRv4_det_server_infer\"\n            )\n            rec_model_path = os.path.join(\n                download_path, \"paddle/PP-OCRv4/rec\", \"ch_PP-OCRv4_rec_server_infer\"\n            )\n            cls_model_path = os.path.join(\n                download_path, \"paddle/PP-OCRv4/cls\", \"ch_ppocr_mobile_v2_cls_infer\"\n            )\n\n        ocr_options = RapidOcrOptions(\n            det_model_path=det_model_path,\n            rec_model_path=rec_model_path,\n            cls_model_path=cls_model_path,\n            force_full_page_ocr=True,\n        )\n\n        pipeline_options = PdfPipelineOptions(\n            artifacts_path=self.model_path,\n            do_ocr=self.do_ocr,\n            ocr_options=ocr_options,\n            # do_picture_description=True,\n            generate_picture_images=self.generate_picture_images,\n            images_scale=self.images_scale\n        )\n\n        logger.info(f'\u4f7f\u7528ocr\u6a21\u578b\u89e3\u6790\uff1a{ocr_options}')\n        return pipeline_options\n\n    def _lazy_load(self) -&gt; Iterator[Document]:\n        from docling.datamodel.base_models import InputFormat\n        from docling.datamodel.pipeline_options import PdfPipelineOptions\n        from docling.document_converter import DocumentConverter, PdfFormatOption\n        from docling_core.types.doc import ImageRefMode\n        if self.do_ocr:\n            pipeline_options = self._get_rapidocr_pipeline_options()\n        else:\n            # \u8fd9\u91cc\u4e0d\u63d0\u53d6\u56fe\u7247\u5185\u5bb9\uff0c\u6240\u4ee5do_ocr=False\uff0c\u9ed8\u8ba4\u4e3aTrue\uff0c\u5219\u9700\u8981\u4e0b\u8f7dOCR\u6a21\u578b\n            pipeline_options = PdfPipelineOptions(artifacts_path=self.model_path, do_ocr=False)\n\n        doc_converter = DocumentConverter(\n            format_options={\n                InputFormat.PDF: PdfFormatOption(pipeline_options=pipeline_options)\n            }\n        )\n\n        # source\u652f\u6301\u672c\u5730\u6587\u4ef6\u548c\u8fdc\u7a0bURL\n        conv_res = doc_converter.convert(source=self.file_path)\n\n        markdown_content = ''\n        if self.generate_picture_images:\n\n            self.output_dir.mkdir(parents=True, exist_ok=True)\n            doc_filename = conv_res.input.file.stem\n\n            # Save markdown with externally referenced pictures\n            md_filename = self.output_dir / f\"{doc_filename}.md\"\n            # \u6ca1\u6709\u63d0\u4f9bartifacts_dir\u7684\u65f6\u5019\uff0c\u51fd\u6570\u4f1a\u6839\u636efilename\u81ea\u52a8\u751f\u6210\u4e00\u4e2a\u76ee\u5f55\u8def\u5f84\u3002\n            # \u6bd4\u5982\uff0c\u5047\u8bbefilename\u662f/path/to/file.txt\uff0c\u90a3\u4e48artifacts_dir\u4f1a\u88ab\u8bbe\u7f6e\u4e3a/path/to/file_artifacts\u3002\n            # \u8fd9\u91cc\u7684\u903b\u8f91\u662f\u53bb\u6389\u539f\u6587\u4ef6\u7684\u6269\u5c55\u540d\uff0c\u7136\u540e\u5728\u540e\u9762\u52a0\u4e0a_artifacts\u4f5c\u4e3a\u76ee\u5f55\u540d\n            conv_res.document.save_as_markdown(\n                filename=md_filename,\n                image_mode=ImageRefMode.REFERENCED\n            )\n            if md_filename.exists():\n                # \u8bfb\u53d6markdown\u6587\u4ef6\u5185\u5bb9\n                with open(md_filename, 'r') as f:\n                    markdown_content = f.read()\n            else:\n                logger.error(f\"Markdown file not found: {md_filename}\")\n        else:\n            markdown_content = conv_res.document.export_to_markdown()\n\n        if self.do_image_upload:\n            # \u4e0a\u4f20\u56fe\u7247\u5230OSS\n            markdown_content = replace_local_images_with_oss_url(\n                content=markdown_content,\n                bucket=self.bucket,\n                expires=5 * 365 * 24 * 60 * 60,\n                image_folder=self.output_dir\n            )\n\n        yield Document(\n            page_content=markdown_content,\n            metadata={},\n        )\n\n    def load(self) -&gt; list[Document]:\n        return list(self._lazy_load())\n\n\nif __name__ == '__main__':\n    import time\n    from oss_test import oss_client\n\n    start_time = time.time()\n    source = \"/Users/xiniao/Downloads/\u6cd5\u4eba\u91d1\u878d\u673a\u6784\u6d17\u94b1\u548c\u6050\u6016\u878d\u8d44\u98ce\u9669\u81ea\u8bc4\u4f30\u6307\u5f15.pdf\"\n    doc = Pdf2MarkdownLoader(\n        file_path=source,\n        do_ocr=True,\n        do_image_upload=True,\n        bucket=oss_client.bucket\n    )\n    docs = doc.load()\n    if not docs:\n        markdown_content = ''\n    else:\n        markdown_content = '\\n\\n'.join(doc.page_content for doc in docs)\n\n    print(markdown_content)\n    execution_time = time.time() - start_time\n    print(f\"Function took {execution_time} seconds to run.\")\n    # \u5728mac\u4e2d\u89e3\u6790132\u9875pdf\u8017\u65f6\uff1a27\u5206\u949f\n    # \u4f7f\u7528 onnx \u7684 rapidocr\u6a21\u578b\uff0c\u5728gpu\u4e0a\u9762\uff0c\u89e3\u679021\u9875pdf\uff0c\u8017\u65f6\uff1a2915\u79d2\n    # \u4f7f\u7528 onnx \u7684 rapidocr\u6a21\u578b\uff0c\u5728gpu\u4e0a\u9762\uff0c\u89e3\u67905\u9875pdf\uff0c\u8017\u65f6\uff1a744\u79d2\n    # \u4f7f\u7528 paddle \u7684 rapidocr\u6a21\u578b\uff0c\u5728paddlepaddle-gpu==3.0.0\u4e0a\u9762\uff0c\u89e3\u67905\u9875pdf\uff0c\u8017\u65f6\uff1a29\u79d2\n</code></pre> <p>\u6ce8\u610f\uff1a\u6709\u65f6\u5019\u5728\u89e3\u6790pdf\u65f6\uff0cdocling \u6a21\u578b\u4f1a\u5c06\u6574\u4e2a\u6216\u8005\u90e8\u5206pdf\u8bc6\u522b\u4e3a\u56fe\u7247\uff0c\u5bfc\u81f4\u90e8\u5206\u5185\u5bb9\u65e0\u6cd5\u6b63\u786e\u8f6c\u6362\u4e3amarkdown\u7684\u5185\u5bb9\uff0c\u6240\u4ee5\u4e3a\u4e86\u63d0\u9ad8\u89e3\u6790\u7684\u51c6\u786e\u7387\uff0c\u53ef\u4ee5\u8003\u8651\u5728\u521b\u5efa <code>RapidOcrOptions</code>\u65f6\uff0c\u6307\u5b9a\u53c2\u6570\uff1a</p> <p><code>force_full_page_ocr=True</code>\u8be5\u53c2\u6570\u7684\u4f5c\u7528\u662f\u5c06\u6240\u6709\u7684\u9875\u9762\u90fd\u4f5c\u4e3a\u56fe\u7247\uff0c\u901a\u8fc7ocr\u8fdb\u884c\u8bc6\u522b\u8f6c\u6362\u3002 </p>"},{"location":"rag/%E3%80%90RAG%E3%80%91docling%E7%BB%93%E5%90%88OCR%E5%AE%9E%E7%8E%B0pdf%E8%BD%ACmarkdown/#doclingcpugpu","title":"docling\u5728cpu\u548cgpu\u7684\u6548\u7387\u5bf9\u6bd4","text":"\u8bd5\u573a\u666f \u73af\u5883 \u662f\u5426\u4f7f\u7528OCR\u6a21\u578b \u6a21\u578b\u53ca\u914d\u7f6e PDF\u9875\u6570 \u8017\u65f6\uff08\u79d2\uff09 \u4e0d\u4f7f\u7528 RapidOCR \u6a21\u578b CPU \u5426 \u65e0\u6a21\u578b\uff08\u4ec5\u57fa\u7840\u89e3\u6790\uff09 6 14 \u4f7f\u7528 RapidOCR\uff08ONNX Runtime-GPU\uff09 GPU \u662f RapidOCR + ONNX Runtime-GPU 6 72 \u5728 Mac \u4e0a\u8fd0\u884c\uff0c\u4f7f\u7528OCR\u6a21\u578b Mac \u662f RapidOCR + ONNX Runtime-GPU 6 110 \u5728 Mac \u4e0a\u4e0d\u4f7f\u7528OCR\u6a21\u578b Mac \u5426 \u65e0\u6a21\u578b\uff08\u4ec5\u57fa\u7840\u89e3\u6790\uff09 6 6 ONNX Runtime-GPU + RapidOCR\uff08\u5168\u9875OCR\uff09 GPU \u662f RapidOCR + ONNX Runtime-GPU +  <code>force_full_page_ocr=True</code> 5 744 PaddlePaddle-GPU 3.0.0 + RapidOCR\uff08\u5168\u9875OCR\uff09 GPU \u662f RapidOCR + PaddlePaddle-GPU 3.0.0 +  <code>force_full_page_ocr=True</code> 5 29"},{"location":"rag/%E3%80%90RAG%E3%80%91docling%E7%BB%93%E5%90%88OCR%E5%AE%9E%E7%8E%B0pdf%E8%BD%ACmarkdown/#_5","title":"\u95ee\u9898\u8bb0\u5f55","text":"<p>\u4f7f\u7528\u5728 gpu \u4e0a\u9762\u4f7f\u7528cuda\u7248\u672c <code>cuda_12.1.r12.1</code> \u5b89\u88c5 <code>paddlepaddle-gpu==2.6.2</code>\u62a5\u9519\u4fe1\u606f\u5982\u4e0b</p> <pre><code>File \"/usr/local/lib/python3.7/dist-packages/paddle/fluid/framework.py\", line 3621, in append_op\n      attrs=kwargs.get(\"attrs\", None))\nFile \"/usr/local/lib/python3.7/dist-packages/paddle/fluid/framework.py\", line 2635, in __init__\n  for frame in traceback.extract_stack():\n\nExternalError: CUDNN error(9), CUDNN_STATUS_NOT_SUPPORTED. \n  [Hint: 'CUDNN_STATUS_NOT_SUPPORTED'.  The functionality requested is not presently supported by cuDNN.  ] (at /paddle/paddle/phi/kernels/fusion/gpu/fused_conv2d_add_act_kernel.cu:610)\n</code></pre> <p>\u62a5\u9519\u539f\u56e0\uff1a\u56e0\u4e3a<code>paddlepaddle-gpu==2.6.2</code>\u4e0d\u652f\u6301\u5f53\u524d\u7684 cuda_12.1</p> <p>\u89e3\u51b3\u65b9\u6cd5\uff1a\u5347\u7ea7paddlepaddle-gpu\u7684\u7248\u672c\u4e3a <code>paddlepaddle-gpu==3.0.0</code></p> <p>\u53c2\u8003\u6587\u6863</p> <ol> <li>https://docling-project.github.io/docling/examples/full_page_ocr/</li> <li>https://python.langchain.com/docs/integrations/document_loaders/docling/</li> <li>https://rapidai.github.io/RapidOCRDocs/install_usage/rapidocr_paddle/usage/</li> <li>https://python.langchain.com/docs/integrations/document_loaders/docling/</li> </ol>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E4%BD%BF%E7%94%A8PyMuPDF4LLM%E8%A7%A3%E6%9E%90PDF%E7%9A%84%E5%9B%BE%E7%89%87%E5%92%8C%E8%A1%A8%E6%A0%BC/","title":"\u3010RAG\u3011\u4f7f\u7528PyMuPDF4LLM\u89e3\u6790PDF\u7684\u56fe\u7247\u548c\u8868\u683c","text":""},{"location":"rag/%E3%80%90RAG%E3%80%91%E4%BD%BF%E7%94%A8PyMuPDF4LLM%E8%A7%A3%E6%9E%90PDF%E7%9A%84%E5%9B%BE%E7%89%87%E5%92%8C%E8%A1%A8%E6%A0%BC/#_1","title":"\u6982\u8ff0","text":"<p>\u6700\u8fd1\u5728\u505aRAG\u76f8\u5173\u7684\u5e94\u7528\uff0c\u9700\u8981\u5bf9PDF\u6587\u4ef6\u8fdb\u884c\u89e3\u6790\u5904\u7406\uff0c\u6700\u5f00\u59cb\u4f7f\u7528<code>PyPDF2</code>\uff0c\u8be5\u5de5\u5177\u53ea\u80fd\u4ecePDF\u6587\u4ef6\u4e2d\u63d0\u53d6\u7eaf\u6587\u672c\u4e14\u6ca1\u6709\u683c\u5f0f\u3002\u5f88\u591a\u7684PDF\u6587\u4ef6\u4e2d\u5305\u542b\u56fe\u7247\u548c\u8868\u683c\uff0c\u9700\u8981\u5c06\u56fe\u7247\u548c\u8868\u683c\u90fd\u63d0\u53d6\u51fa\u6765\uff0c\u5e76\u4e14\u9700\u8981\u4fdd\u7559PDF\u6587\u4ef6\u7684\u6587\u672c\u683c\u5f0f\u3002\u901a\u8fc7\u67e5\u9605\u76f8\u5173\u6587\u6863\uff0c\u627e\u5230\u4e00\u4e2a\u5f00\u6e90\u5de5\u5177 pymupdf4llm\uff0c\u8fd9\u4e2a\u5305\u4f7f\u7528 <code>PyMuPDF</code> \u5c06PDF\u7684\u9875\u9762\u8f6c\u6362\u4e3aMarkdown\u683c\u5f0f\u7684\u6587\u672c\uff0c\u5e76\u4e14\u652f\u6301\u8868\u683c\u548c\u56fe\u7247\u62bd\u53d6\u3002</p> <p>\u672c\u6587\u4ece\u4e0b\u9762\u51e0\u4e2a\u65b9\u9762\u8fdb\u884c\u4ecb\u7ecd\uff1a</p> <ul> <li>\u4ecb\u7ecd <code>pymupdf4llm</code> \u7684\u4f7f\u7528\uff0c\u5e76\u4e14\u7ed9\u51fa\u76f8\u5173\u7684\u4f7f\u7528\u793a\u4f8b\u3002</li> <li>\u4ecb\u7ecd\u81ea\u5df1\u5c01\u88c5\u7684\u5de5\u5177\uff0c\u80fd\u591f\u5c06PDF\uff08\u5728\u7ebf/\u672c\u5730\uff09\u6587\u4ef6\u8f6c\u6362\u4e3amarkdown\u6587\u4ef6\uff0c\u5e76\u4e14\u5c06PDF\u4e2d\u89e3\u6790\u51fa\u7684\u56fe\u7247\u4e0a\u4f20\u5230OSS\u4e2d\u3002\u8be5\u5de5\u5177\u4e5f\u53ef\u4ee5\u4f5c\u4e3amarkdown\u6587\u4ef6\u7684\u672c\u5730\u56fe\u7247\u8f6c\u5728\u7ebf\u56fe\u7247\u7684\u5de5\u5177\u3002</li> </ul> <p>\u901a\u8fc7\u672c\u6587\u7684\u5b66\u4e60\uff0c\u4f60\u5c06\u6709\u5982\u4e0b\u6536\u83b7\uff1a</p> <ul> <li>\u4e86\u89e3 <code>pymupdf4llm</code>\u7684\u57fa\u672c\u4f7f\u7528\u3002</li> <li>\u4e86\u89e3\u5982\u4f55\u5c06PDF\uff08\u5728\u7ebf/\u672c\u5730\uff09\u6587\u4ef6\u8f6c\u6362\u4e3amarkdown\u6587\u4ef6\uff0c\u5e76\u4e14\u5c06PDF\u4e2d\u89e3\u6790\u51fa\u7684\u56fe\u7247\u4e0a\u4f20\u5230OSS\u4e2d\u3002</li> </ul>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E4%BD%BF%E7%94%A8PyMuPDF4LLM%E8%A7%A3%E6%9E%90PDF%E7%9A%84%E5%9B%BE%E7%89%87%E5%92%8C%E8%A1%A8%E6%A0%BC/#pymupdf4llm","title":"PyMuPDF4LLM\u4ecb\u7ecd","text":"<p>PyMuPDF4LLM \u662f\u4e00\u4e2a\u5f3a\u5927\u7684\u5de5\u5177\uff0c\u7528\u4e8e\u4ece PDF \u6587\u4ef6\u4e2d\u63d0\u53d6\u6570\u636e\uff0c\u652f\u6301\u5c06\u6587\u672c\u3001\u8868\u683c\u3001\u56fe\u50cf\u548c\u77e2\u91cf\u56fe\u5f62\u8f6c\u6362\u4e3a Markdown \u683c\u5f0f\uff0c\u5e76\u4e14\u53ef\u4ee5\u4e0e LlamaIndex\u3001langchain \u96c6\u6210\uff0c\u9002\u7528\u4e8e LLM \u76f8\u5173\u5de5\u4f5c\u3002</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E4%BD%BF%E7%94%A8PyMuPDF4LLM%E8%A7%A3%E6%9E%90PDF%E7%9A%84%E5%9B%BE%E7%89%87%E5%92%8C%E8%A1%A8%E6%A0%BC/#pymupdf4llm_1","title":"PyMuPDF4LLM\u7279\u70b9","text":"<ul> <li>PyMuPDF4LLM \u662f\u4e00\u4e2a\u7075\u6d3b\u3001\u5feb\u901f\u7684\u5de5\u5177\uff0c\u80fd\u591f\u80dc\u4efb\u5404\u79cd PDF \u6570\u636e\u63d0\u53d6\u4efb\u52a1\uff0c\u7279\u522b\u9002\u5408\u5927\u578b\u8bed\u8a00\u6a21\u578b\uff08LLM\uff09\u548c\u77e5\u8bc6\u68c0\u7d22\u7cfb\u7edf\u7684\u6570\u636e\u51c6\u5907\u5de5\u4f5c\u3002</li> <li>\u63d0\u53d6\u7684\u6570\u636e\u683c\u5f0f\u591a\u6837\uff0c\u5305\u62ec Markdown\u3001\u56fe\u50cf\u3001\u8868\u683c\u548c\u5143\u6570\u636e\uff0c\u8fd9\u4e9b\u683c\u5f0f\u5bf9\u4e8e LLM \u7684\u5fae\u8c03\u548c\u77e5\u8bc6\u68c0\u7d22\u7cfb\u7edf\u7684\u6784\u5efa\u81f3\u5173\u91cd\u8981\u3002</li> <li>PyMuPDF4LLM \u80fd\u591f\u9ad8\u8d28\u91cf\u63d0\u53d6\uff0c\u65e0\u8bba\u662f\u6587\u672c\u7684\u7ed3\u6784\u5316\u63d0\u53d6\u3001\u7279\u5b9a\u9875\u9762\u7684\u6570\u636e\u63d0\u53d6\uff0c\u8fd8\u662f\u590d\u6742\u7684\u8868\u683c\u548c\u56fe\u50cf\u7684\u9ad8\u8d28\u91cf\u63d0\u53d6\u3002</li> <li>PyMuPDF4LLM \u5bf9\u4e8e NLP \u4efb\u52a1\u5c24\u5176\u6709\u7528\uff0c\u56e0\u4e3a\u5b83\u80fd\u591f\u4fdd\u7559\u6587\u672c\u7684\u4e0a\u4e0b\u6587\u548c\u5355\u8bcd\u7ea7\u522b\u7684\u4fe1\u606f\uff0c\u8fd9\u5bf9\u4e8e\u6a21\u578b\u7684\u6027\u80fd\u81f3\u5173\u91cd\u8981\u3002</li> </ul>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E4%BD%BF%E7%94%A8PyMuPDF4LLM%E8%A7%A3%E6%9E%90PDF%E7%9A%84%E5%9B%BE%E7%89%87%E5%92%8C%E8%A1%A8%E6%A0%BC/#pymupdf4llmapi","title":"PyMuPDF4LLM\u7684API","text":"<p>\u63a5\u53e3\u6587\u6863\uff1a PyMuPDF4LLM API</p> <p>\u5728 PyMuPDF4LLM\u4e2d\u6700\u91cd\u8981\u7684\u4e00\u4e2a\u65b9\u6cd5\u662f <code>to_markdown</code>\uff0c\u8be5\u65b9\u6cd5\u5404\u53c2\u6570\u7684\u89e3\u91ca\u5982\u4e0b\uff1a</p> <pre><code>def to_markdown(\n    doc: pymupdf.Document | str, \n    *, \n    pages: list | range | None = None, \n    hdr_info: Any = None, \n    write_images: bool = False, \n    embed_images: bool = False, \n    dpi: int = 150, \n    image_path='', \n    image_format='png', \n    image_size_limit=0.05, \n    force_text=True, \n    margins=(0, 50, 0, 50), \n    page_chunks: bool = False, \n    page_width: float = 612, \n    page_height: float = None, \n    table_strategy='lines_strict', \n    graphics_limit: int = None, \n    ignore_code: bool = False, \n    extract_words: bool = False, \n    show_progress: bool = True\n) -&gt; str | list[dict]:\n</code></pre> <p>\u53c2\u6570\u8bf4\u660e\uff1a</p> <ul> <li>doc (Document, str): \u6587\u4ef6\uff0c\u53ef\u4ee5\u6307\u5b9a\u4e3a\u6587\u4ef6\u8def\u5f84\u5b57\u7b26\u4e32\u6216 PyMuPDF Document\uff08\u901a\u8fc7 <code>pymupdf.open</code> \u521b\u5efa\uff09\u3002\u4e3a\u4e86\u4f7f\u7528 <code>pathlib.Path</code> \u89c4\u8303\u3001Python \u6587\u4ef6\u5bf9\u8c61\u3001\u5185\u5b58\u4e2d\u7684\u6587\u6863\u7b49\uff0c\u5fc5\u987b\u4f7f\u7528 PyMuPDF Document\u3002</li> <li>pages (list): \u53ef\u9009\uff0c\u8981\u5904\u7406\u7684\u9875\u9762\uff08\u6ce8\u610f\uff1a\u6307\u5b9a\u7684\u662f\u4ece0\u5f00\u59cb\u7684\u9875\u7801\uff09\u3002\u5982\u679c\u7701\u7565\uff0c\u5219\u5904\u7406\u6240\u6709\u9875\u9762\u3002</li> <li>hdr_info: \u53ef\u9009\u3002\u5982\u679c\u4f60\u5e0c\u671b\u63d0\u4f9b\u81ea\u5df1\u7684\u6807\u9898\u68c0\u6d4b\u903b\u8f91\uff0c\u53ef\u4ee5\u4f7f\u7528\u6b64\u53c2\u6570\u3002\u8fd9\u53ef\u4ee5\u662f\u4e00\u4e2a\u53ef\u8c03\u7528\u5bf9\u8c61\u6216\u5177\u6709 <code>get_header_id</code> \u65b9\u6cd5\u7684\u5bf9\u8c61\u3002\u5b83\u5fc5\u987b\u63a5\u53d7\u4e00\u4e2a\u6587\u672c\u7247\u6bb5\uff08\u5305\u542b\u5728 <code>extractDICT()</code> \u4e2d\u7684\u5b57\u5178\uff09\u548c\u4e00\u4e2a\u5173\u952e\u5b57\u53c2\u6570 <code>page</code>\uff08\u9875\u9762\u5bf9\u8c61\uff09\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u8be5\u5b57\u7b26\u4e32\u53ef\u4ee5\u4e3a\u7a7a\u6216\u6700\u591a\u5305\u542b6\u4e2a <code>#</code> \u5b57\u7b26\u540e\u8ddf\u4e00\u4e2a\u7a7a\u683c\u3002\u5982\u679c\u7701\u7565\uff0c\u5c06\u5bf9\u6574\u4e2a\u6587\u6863\u8fdb\u884c\u626b\u63cf\u4ee5\u627e\u5230\u6700\u5e38\u89c1\u7684\u5b57\u4f53\u5927\u5c0f\uff0c\u5e76\u6839\u636e\u5b83\u4eec\u63a8\u5bfc\u51fa\u6807\u9898\u7ea7\u522b\u3002\u8981\u5b8c\u5168\u907f\u514d\u8fd9\u79cd\u884c\u4e3a\uff0c\u53ef\u4ee5\u6307\u5b9a <code>hdr_info=lambda s, page=None: \"\"</code> \u6216 <code>hdr_info=False</code>\u3002</li> <li>write_images (bool): \u5f53\u9047\u5230\u56fe\u50cf\u6216\u77e2\u91cf\u56fe\u5f62\u65f6\uff0c\u4f1a\u4ece\u76f8\u5e94\u7684\u9875\u9762\u533a\u57df\u521b\u5efa\u56fe\u50cf\u5e76\u5b58\u50a8\u5728\u6307\u5b9a\u7684\u6587\u4ef6\u5939\u4e2d\u3002Markdown \u5c06\u5f15\u7528\u6307\u5411\u8fd9\u4e9b\u56fe\u50cf\u7684\u94fe\u63a5\u3002\u4efb\u4f55\u5305\u542b\u5728\u8fd9\u4e9b\u533a\u57df\u4e2d\u7684\u6587\u672c\u5c06\u4e0d\u4f1a\u5305\u542b\u5728\u6587\u672c\u8f93\u51fa\u4e2d\uff08\u4f46\u4f1a\u4f5c\u4e3a\u56fe\u50cf\u7684\u4e00\u90e8\u5206\u51fa\u73b0\uff09\uff0c\u56e0\u6b64\u5982\u679c\u6587\u6863\u4e2d\u6709\u6587\u672c\u5199\u5728\u5168\u9875\u56fe\u50cf\u4e0a\uff0c\u8bf7\u786e\u4fdd\u5c06\u6b64\u53c2\u6570\u8bbe\u7f6e\u4e3a <code>False</code>\u3002</li> <li>embed_images (bool): \u7c7b\u4f3c\u4e8e <code>write_images</code>\uff0c\u4f46\u56fe\u50cf\u5c06\u4ee5 base64 \u7f16\u7801\u7684\u5f62\u5f0f\u5d4c\u5165\u5230 Markdown \u6587\u672c\u4e2d\u3002\u8be5\u53c2\u6570\u4f1a\u5ffd\u7565 <code>write_images</code> \u548c <code>image_path</code>\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5927\u5e45\u589e\u52a0 Markdown \u6587\u672c\u7684\u5927\u5c0f\u3002</li> <li>image_size_limit (float): \u5fc5\u987b\u662f\u4e00\u4e2a\u5c0f\u4e8e1\u7684\u6b63\u6570\u3002\u5982\u679c\u56fe\u50cf\u7684\u5bbd\u5ea6\u6216\u9ad8\u5ea6\u5c0f\u4e8e\u9875\u9762\u5bbd\u5ea6\u6216\u9ad8\u5ea6\u7684 <code>image_size_limit</code> \u500d\uff0c\u5219\u5ffd\u7565\u8be5\u56fe\u50cf\u3002\u4f8b\u5982\u9ed8\u8ba4\u503c 0.05 \u610f\u5473\u7740\u8981\u63d0\u53d6\u56fe\u50cf\u7684\u5bbd\u5ea6\u548c\u9ad8\u5ea6\u5fc5\u987b\u5927\u4e8e\u9875\u9762\u5bbd\u5ea6\u548c\u9ad8\u5ea6\u7684 5%\u3002</li> <li>dpi (int): \u6307\u5b9a\u6240\u9700\u7684\u56fe\u50cf\u5206\u8fa8\u7387\uff08\u6bcf\u82f1\u5bf8\u70b9\u6570\uff09\u3002\u4ec5\u5728 <code>write_images=True</code> \u65f6\u76f8\u5173\uff0c\u9ed8\u8ba4\u503c\u4e3a 150\u3002</li> <li>image_path (str): \u5b58\u50a8\u56fe\u50cf\u7684\u6587\u4ef6\u5939\u3002\u4ec5\u5728 <code>write_images=True</code> \u65f6\u751f\u6548\uff0c\u9ed8\u8ba4\u662f\u811a\u672c\u76ee\u5f55\u7684\u8def\u5f84\u3002</li> <li>image_format (str): \u901a\u8fc7\u5176\u6269\u5c55\u540d\u6307\u5b9a\u6240\u9700\u7684\u56fe\u50cf\u683c\u5f0f\u3002\u9ed8\u8ba4\u662f \"png\"\uff08\u4fbf\u643a\u5f0f\u7f51\u7edc\u56fe\u5f62\uff09\uff0c\u53e6\u4e00\u4e2a\u6d41\u884c\u7684\u683c\u5f0f\u53ef\u80fd\u662f \"jpg\"\uff0c\u53ef\u80fd\u7684\u503c\u5305\u62ec\u6240\u6709\u652f\u6301\u7684\u8f93\u51fa\u683c\u5f0f\u3002</li> <li>force_text (bool): \u5373\u4f7f\u6709\u91cd\u53e0\u7684\u56fe\u50cf/\u56fe\u5f62\uff0c\u4e5f\u751f\u6210\u6587\u672c\u8f93\u51fa\u3002\u6b64\u6587\u672c\u5c06\u5728\u76f8\u5e94\u56fe\u50cf\u4e4b\u540e\u51fa\u73b0\uff0c\u5982\u679c <code>write_images=True</code>\uff0c\u6b64\u53c2\u6570\u53ef\u4ee5\u8bbe\u7f6e\u4e3a <code>False</code> \u4ee5\u6291\u5236\u56fe\u50cf\u4e0a\u7684\u91cd\u590d\u6587\u672c\u3002</li> <li>margins (float, list): <ul> <li>\u4e00\u4e2a\u6d6e\u70b9\u6570\u6216\u5305\u542b 2 \u6216 4 \u4e2a\u6d6e\u70b9\u6570\u7684\u5e8f\u5217\uff0c\u6307\u5b9a\u9875\u9762\u8fb9\u754c\u3002\u53ea\u6709\u5728\u8fb9\u754c\u5185\u7684\u5bf9\u8c61\u624d\u4f1a\u88ab\u8003\u8651\u7528\u4e8e\u8f93\u51fa\u3002</li> <li><code>margin=f</code> \u751f\u6210 <code>(f, f, f, f)</code>\uff0c\u8868\u793a (\u5de6, \u4e0a, \u53f3, \u4e0b) \u8fb9\u754c\u3002</li> <li><code>(top, bottom)</code> \u751f\u6210 <code>(0, top, 0, bottom)</code>\u3002</li> <li>\u8981\u59cb\u7ec8\u8bfb\u53d6\u5b8c\u6574\u9875\u9762\uff0c\u4f7f\u7528 <code>margins=0</code>\u3002</li> </ul> </li> <li>page_chunks (bool): \u5982\u679c\u4e3a <code>True</code>\uff0c\u8f93\u51fa\u5c06\u662f\u4e00\u4e2a\u5305\u542b <code>Document.page_count</code> \u4e2a\u5b57\u5178\u7684\u5217\u8868\uff08\u6bcf\u4e2a\u9875\u9762\u4e00\u4e2a\u5b57\u5178\uff09\u3002\u6bcf\u4e2a\u5b57\u5178\u7684\u7ed3\u6784\u5982\u4e0b\uff1a<ul> <li><code>\"metadata\"</code> - \u5305\u542b\u6587\u6863\u5143\u6570\u636e <code>Document.metadata</code> \u7684\u5b57\u5178\uff0c\u9644\u52a0\u4e86\u989d\u5916\u7684\u952e <code>\"file_path\"</code>\uff08\u6587\u4ef6\u540d\uff09\u3001<code>\"page_count\"</code>\uff08\u6587\u6863\u4e2d\u7684\u9875\u6570\uff09\u548c <code>\"page_number\"</code>\uff081-based \u9875\u7801\uff09\u3002</li> <li><code>\"toc_items\"</code> - \u6307\u5411\u6b64\u9875\u9762\u7684\u76ee\u5f55\u9879\u5217\u8868\u3002\u6bcf\u4e2a\u9879\u7684\u683c\u5f0f\u4e3a <code>[lvl, title, pagenumber]</code>\uff0c\u5176\u4e2d <code>lvl</code> \u662f\u5c42\u6b21\u7ea7\u522b\uff0c<code>title</code> \u662f\u5b57\u7b26\u4e32\uff0c<code>pagenumber</code> \u662f 1-based \u9875\u7801\u3002</li> <li><code>\"tables\"</code> - \u9875\u9762\u4e0a\u7684\u8868\u683c\u5217\u8868\u3002\u6bcf\u4e2a\u9879\u662f\u4e00\u4e2a\u5b57\u5178\uff0c\u5305\u542b\u952e <code>\"bbox\"</code>\uff08\u8868\u683c\u5728\u9875\u9762\u4e0a\u7684\u4f4d\u7f6e\uff0c\u683c\u5f0f\u4e3a <code>pymupdf.Rect</code> \u7684\u5143\u7ec4\uff09\u3001<code>\"row_count\"</code> \u548c <code>\"col_count\"</code>\u3002</li> <li><code>\"images\"</code> - \u9875\u9762\u4e0a\u7684\u56fe\u50cf\u5217\u8868\u3002\u8fd9\u662f\u9875\u9762\u65b9\u6cd5 <code>Page.get_image_info()</code> \u8fd4\u56de\u7684\u526f\u672c\u3002</li> <li><code>\"graphics\"</code> - \u9875\u9762\u4e0a\u7684\u77e2\u91cf\u56fe\u5f62\u77e9\u5f62\u5217\u8868\u3002\u8fd9\u662f\u9875\u9762\u65b9\u6cd5 <code>Page.cluster_drawings()</code> \u8fd4\u56de\u7684\u8fb9\u754c\u6846\u5217\u8868\u3002</li> <li><code>\"text\"</code> - \u9875\u9762\u5185\u5bb9\u7684 Markdown \u6587\u672c\u3002</li> <li><code>\"words\"</code> - \u5982\u679c\u4f7f\u7528\u4e86 <code>extract_words=True</code>\uff0c\u5219\u5305\u542b\u6b64\u952e\u3002\u5176\u503c\u662f\u4e00\u4e2a\u5217\u8868\uff0c\u5305\u542b\u7531 PyMuPDF \u7684 <code>Page</code> \u65b9\u6cd5 <code>get_text(\"words\")</code> \u8fd4\u56de\u7684\u5143\u7ec4 <code>(x0, y0, x1, y1, \"wordstring\", bno, lno, wno)</code>\u3002\u8fd9\u4e9b\u5143\u7ec4\u7684\u987a\u5e8f\u4e0e Markdown \u6587\u672c\u5b57\u7b26\u4e32\u4e2d\u63d0\u53d6\u7684\u6587\u672c\u987a\u5e8f\u76f8\u540c\uff0c\u5bf9\u4e8e\u8868\u683c\u4e2d\u7684\u6587\u672c\u4e5f\u662f\u5982\u6b64\uff0c\u5355\u8bcd\u6309\u8868\u683c\u884c\u5355\u5143\u683c\u7684\u987a\u5e8f\u63d0\u53d6\u3002</li> </ul> </li> <li>page_width (float): \u6307\u5b9a\u6240\u9700\u7684\u9875\u9762\u5bbd\u5ea6\u3002\u5bf9\u4e8e\u56fa\u5b9a\u9875\u9762\u5bbd\u5ea6\u7684\u6587\u6863\uff08\u5982 PDF\u3001XPS \u7b49\uff09\uff0c\u6b64\u53c2\u6570\u5c06\u88ab\u5ffd\u7565\u3002\u5bf9\u4e8e\u53ef\u6d41\u52a8\u7684\u6587\u6863\uff08\u5982\u7535\u5b50\u4e66\u3001\u529e\u516c\u6587\u6863\u6216\u6587\u672c\u6587\u4ef6\uff09\uff0c\u8fd9\u4e9b\u6587\u6863\u6ca1\u6709\u56fa\u5b9a\u7684\u9875\u9762\u5c3a\u5bf8\uff0c\u9ed8\u8ba4\u5047\u8bbe\u4e3a Letter \u683c\u5f0f\u7684\u5bbd\u5ea6\uff08612\uff09\u548c\u201c\u65e0\u9650\u201d\u7684\u9875\u9762\u9ad8\u5ea6\u3002\u8fd9\u610f\u5473\u7740\u6574\u4e2a\u6587\u6863\u88ab\u89c6\u4e3a\u4e00\u4e2a\u5927\u9875\u9762\u3002</li> <li>page_height (float): \u6307\u5b9a\u6240\u9700\u7684\u9875\u9762\u9ad8\u5ea6\u3002\u76f8\u5173\u6027\u89c1 <code>page_width</code> \u53c2\u6570\uff0c\u5982\u679c\u4f7f\u7528\u9ed8\u8ba4\u503c <code>None</code>\uff0c\u6587\u6863\u5c06\u88ab\u89c6\u4e3a\u4e00\u4e2a\u5927\u9875\u9762\uff0c\u5bbd\u5ea6\u4e3a <code>page_width</code>\u3002\u56e0\u6b64\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4e0d\u4f1a\u51fa\u73b0 Markdown \u9875\u9762\u5206\u9694\u7b26\uff08\u9664\u4e86\u6700\u540e\u4e00\u4e2a\uff09\uff0c\u6216\u8005\u53ea\u8fd4\u56de\u4e00\u4e2a\u9875\u9762\u5757\u3002</li> <li>table_strategy (str): \u8868\u683c\u68c0\u6d4b\u7b56\u7565\u3002\u9ed8\u8ba4\u503c\u4e3a <code>\"lines_strict\"</code>\uff0c\u5ffd\u7565\u80cc\u666f\u989c\u8272\u3002\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u5176\u4ed6\u7b56\u7565\u53ef\u80fd\u66f4\u6210\u529f\uff0c\u4f8b\u5982 <code>\"lines\"</code> \u4f7f\u7528\u6240\u6709\u77e2\u91cf\u56fe\u5f62\u5bf9\u8c61\u8fdb\u884c\u68c0\u6d4b\u3002</li> <li>graphics_limit (int): \u7528\u4e8e\u9650\u5236\u5904\u7406\u8fc7\u591a\u7684\u77e2\u91cf\u56fe\u5f62\u5143\u7d20\u3002\u901a\u5e38\uff0c\u79d1\u5b66\u6587\u6863\u6216\u4f7f\u7528\u56fe\u5f62\u547d\u4ee4\u6a21\u62df\u6587\u672c\u7684\u9875\u9762\u53ef\u80fd\u5305\u542b\u6210\u5343\u4e0a\u4e07\u7684\u8fd9\u4e9b\u5bf9\u8c61\u3002\u7531\u4e8e\u77e2\u91cf\u56fe\u5f62\u4e3b\u8981\u7528\u4e8e\u8868\u683c\u68c0\u6d4b\uff0c\u5206\u6790\u6b64\u7c7b\u9875\u9762\u53ef\u80fd\u5bfc\u81f4\u8fc7\u957f\u7684\u8fd0\u884c\u65f6\u95f4\u3002\u4f60\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e <code>graphics_limit=5000</code> \u6216\u66f4\u5c0f\u7684\u503c\u6765\u6392\u9664\u95ee\u9898\u9875\u9762\u3002\u76f8\u5e94\u7684\u9875\u9762\u5c06\u88ab\u5ffd\u7565\uff0c\u5e76\u5728\u8f93\u51fa\u6587\u672c\u4e2d\u7528\u4e00\u6761\u6d88\u606f\u884c\u8868\u793a\u3002</li> <li>ignore_code (bool): \u5982\u679c\u4e3a <code>True</code>\uff0c\u5219\u7b49\u5bbd\u6587\u672c\u4e0d\u4f1a\u6536\u5230\u7279\u6b8a\u7684\u683c\u5f0f\u5904\u7406\uff0c\u4ee3\u7801\u5757\u5c06\u4e0d\u518d\u751f\u6210\u3002\u5982\u679c\u4f7f\u7528\u4e86 <code>extract_words=True</code>\uff0c\u6b64\u503c\u5c06\u88ab\u8bbe\u7f6e\u4e3a <code>True</code>\u3002</li> <li>extract_words (bool): \u5982\u679c\u4e3a <code>True</code>\uff0c\u5219\u5f3a\u5236 <code>page_chunks=True</code> \u5e76\u5728\u6bcf\u4e2a\u9875\u9762\u5b57\u5178\u4e2d\u6dfb\u52a0 <code>\"words\"</code> \u952e\u3002\u5176\u503c\u662f\u7531 PyMuPDF \u7684 <code>Page</code> \u65b9\u6cd5 <code>get_text(\"words\")</code> \u8fd4\u56de\u7684\u5355\u8bcd\u5217\u8868\u3002\u8fd9\u4e9b\u5355\u8bcd\u7684\u987a\u5e8f\u4e0e\u63d0\u53d6\u7684\u6587\u672c\u76f8\u540c\u3002</li> <li>show_progress (bool): \u5982\u679c\u4e3a <code>True</code>\uff08\u9ed8\u8ba4\u503c\uff09\uff0c\u5219\u5728\u9875\u9762\u8f6c\u6362\u4e3a Markdown \u65f6\u663e\u793a\u57fa\u4e8e\u6587\u672c\u7684\u8fdb\u5ea6\u6761\u3002\u8fdb\u5ea6\u6761\u770b\u8d77\u6765\u7c7b\u4f3c\u4e8e\u4ee5\u4e0b\u5f62\u5f0f\uff1a</li> </ul> <p>\u8fd4\u56de\u503c\uff1a</p> <ul> <li>\u8981\u4e48\u662f\u6240\u9009\u6587\u6863\u9875\u9762\u7684\u7ec4\u5408\u6587\u672c\u5b57\u7b26\u4e32\uff0c\u8981\u4e48\u662f\u4e00\u4e2a\u5b57\u5178\u5217\u8868\u3002</li> </ul>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E4%BD%BF%E7%94%A8PyMuPDF4LLM%E8%A7%A3%E6%9E%90PDF%E7%9A%84%E5%9B%BE%E7%89%87%E5%92%8C%E8%A1%A8%E6%A0%BC/#pymupdf4llm_2","title":"PyMuPDF4LLM\u5b9e\u6218","text":"<p>\u9996\u5148\u4f7f\u7528 pip \u5b89\u88c5 PyMuPDF4LLM\uff1a</p> <pre><code>pip install pymupdf4llm\n</code></pre>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E4%BD%BF%E7%94%A8PyMuPDF4LLM%E8%A7%A3%E6%9E%90PDF%E7%9A%84%E5%9B%BE%E7%89%87%E5%92%8C%E8%A1%A8%E6%A0%BC/#1-markdown","title":"\u7528\u4f8b 1\uff1a\u57fa\u672c Markdown \u63d0\u53d6","text":"<p>\u4f60\u6709\u4e00\u4efd PDF \u6587\u4ef6\uff0c\u4f46\u53ea\u60f3\u5f97\u5230\u7b80\u6d01\u3001Markdown \u53cb\u597d\u683c\u5f0f\u7684\u5185\u5bb9\u3002PyMuPDF4LLM \u53ef\u4ee5\u63d0\u53d6\u5e26\u6709\u6807\u9898\u3001\u5217\u8868\u548c\u5176\u4ed6\u683c\u5f0f\u7684\u6587\u672c\uff0c\u4f7f\u5176\u6613\u4e8e\u4f7f\u7528\u3002</p> <pre><code>import pymupdf4llm\n\n# Extract PDF content as Markdown\nmd_text = pymupdf4llm.to_markdown(\"INVAR-RAG.pdf\")\nprint(md_text[:500])  # Print first 500 characters\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u6211\u4f7f\u7528 PyMuPDF4LLM \u5c06\u4e00\u7bc7\u7814\u7a76\u8bba\u6587\u7684\u5185\u5bb9\u63d0\u53d6\u4e3a Markdown \u683c\u5f0f\u3002</p> <p>\u4e3a\u4ec0\u4e48\u662f Markdown\u683c\u5f0f\uff1f\u56e0\u4e3a\u5b83\u662f\u5fae\u8c03\u6a21\u578b\u7684\u7406\u60f3\u9009\u62e9\uff0c\u56e0\u4e3a\u5b83\u4fdd\u7559\u4e86\u7ed3\u6784\u548c\u683c\u5f0f\uff0c\u8fd9\u5bf9\u4e8e\u4ece LLM \u751f\u6210\u8fde\u8d2f\u7684\u54cd\u5e94\u81f3\u5173\u91cd\u8981\u3002 </p>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E4%BD%BF%E7%94%A8PyMuPDF4LLM%E8%A7%A3%E6%9E%90PDF%E7%9A%84%E5%9B%BE%E7%89%87%E5%92%8C%E8%A1%A8%E6%A0%BC/#2","title":"\u7528\u4f8b 2\uff1a\u63d0\u53d6\u7279\u5b9a\u9875\u9762","text":"<p>\u6709\u65f6\u53ea\u9700\u8981\u6587\u6863\u7684\u4e00\u90e8\u5206\uff0c\u4e5f\u8bb8\u53ea\u662f\u7528\u4e8e\u8bad\u7ec3\u7684\u7279\u5b9a\u5185\u5bb9\uff0c\u4f7f\u7528 PyMuPDF4LLM \u53ef\u4ee5\u7cbe\u786e\u5730\u786e\u5b9a\u8981\u63d0\u53d6\u54ea\u4e9b\u9875\u9762\uff0c\u4ece\u800c\u8282\u7701\u65f6\u95f4\u548c\u8d44\u6e90\u3002</p> <pre><code>import pymupdf4llm\n\n# Extract PDF content as Markdown\nmd_text = pymupdf4llm.to_markdown(\"INVAR-RAG.pdf\", pages=[3, 9])\nprint(md_text[:500])  # Print first 500 characters\n</code></pre> <p>\u8fd9\u4e00\u529f\u80fd\u5728\u5904\u7406\u6d77\u91cf\u6587\u4ef6\u65f6\u5c24\u5176\u6709\u7528\uff0c\u4f8b\u5982\u63d0\u53d6\u7279\u5b9a\u7684\u7ae0\u8282\u6216\u90e8\u5206\u53ef\u4ee5\u65b9\u4fbf\u5730\u53ea\u5bf9\u6700\u76f8\u5173\u7684\u4fe1\u606f\u8fdb\u884c LLM \u8bad\u7ec3\u3002</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E4%BD%BF%E7%94%A8PyMuPDF4LLM%E8%A7%A3%E6%9E%90PDF%E7%9A%84%E5%9B%BE%E7%89%87%E5%92%8C%E8%A1%A8%E6%A0%BC/#3","title":"\u7528\u4f8b 3\uff1a\u56fe\u7247\u63d0\u53d6","text":"<p>\u4e0e\u6587\u672c\u4e00\u8d77\u63d0\u53d6\u56fe\u50cf\u7ecf\u5e38\u88ab\u5ffd\u89c6\uff0c\u4f46\u5374\u975e\u5e38\u91cd\u8981\uff0c\u5c24\u5176\u662f\u5bf9\u4e8e\u5305\u542b\u6570\u5b57\u3001\u56fe\u8868\u7684\u6587\u6863\uff0cPyMuPDF4LLM \u53ef\u4ee5\u65b9\u4fbf\u5730\u5904\u7406\u5b83\u3002</p> <pre><code>md_text_images = pymupdf4llm.to_markdown(doc=\"INVAR-RAG.pdf\",\n                                         pages=[3, 9]\n                                         page_chunks=True,\n                                         write_images=True,\n                                         image_path=\"images\",\n                                         image_format=\"jpg\",\n                                         dpi=200)\nprint(md_text_images[0]['images'])  # Print image information from the first chunk\n</code></pre>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E4%BD%BF%E7%94%A8PyMuPDF4LLM%E8%A7%A3%E6%9E%90PDF%E7%9A%84%E5%9B%BE%E7%89%87%E5%92%8C%E8%A1%A8%E6%A0%BC/#4","title":"\u7528\u4f8b 4\uff1a\u8868\u683c\u63d0\u53d6","text":"<p>\u8868\u683c\u5f88\u96be\u5728\u4e0d\u4e22\u5931\u683c\u5f0f\u7684\u60c5\u51b5\u4e0b\u4ece PDF \u4e2d\u63d0\u53d6\u51fa\u6765\uff0c\u867d\u7136PyMuPDF4LLM \u80fd\u4f18\u96c5\u5730\u5904\u7406\u8fd9\u4e00\u95ee\u9898\uff0c\u786e\u4fdd\u8868\u683c\u5e72\u51c0\u6574\u6d01\uff0c\u4f46\u662f\u4e0d\u80fd\u591f\u4fdd\u8bc1\u51c6\u786e\u63d0\u53d6\u8868\u683c\u683c\u5f0f\u548c\u6570\u636e\u3002</p> <pre><code>import pymupdf4llm\n\n\nmd_text_tables = pymupdf4llm.to_markdown(doc=\"INVAR-RAG.pdf\",\n                                         pages=[6],  # Specify pages containing tables\n                                         )\nprint(md_text_tables)\n</code></pre>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E4%BD%BF%E7%94%A8PyMuPDF4LLM%E8%A7%A3%E6%9E%90PDF%E7%9A%84%E5%9B%BE%E7%89%87%E5%92%8C%E8%A1%A8%E6%A0%BC/#5-markdown","title":"\u7528\u4f8b 5\uff1a\u5c06 Markdown \u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d","text":"<p>\u63d0\u53d6\u6570\u636e\u540e\u5c06\u5176\u4fdd\u5b58\u4e3a\u4fbf\u4e8e\u518d\u6b21\u8bbf\u95ee\u6216\u5171\u4eab\u7684markdown\u683c\u5f0f\u3002</p> <pre><code>import pymupdf4llm\nfrom pathlib import Path\n\n# Extract PDF content as Markdown\nmd_text = pymupdf4llm.to_markdown(\"INVAR-RAG.pdf\")\n\nPath(\"output.md\").write_bytes(md_text.encode())\nprint(\"Markdown saved to output.md\")\n</code></pre> <p>\u5c06\u63d0\u53d6\u7684\u6570\u636e\u5b58\u50a8\u5728 Markdown \u4e2d\u53ef\u4ee5\u65b9\u4fbf\u5730\u8fdb\u884c\u7ba1\u7406\u548c\u67e5\u770b\uff0c\u5c24\u5176\u662f\u5728 LLM \u5fae\u8c03\u4ee5\u53ca\u77e5\u8bc6\u5e93\u51c6\u5907\u6570\u636e\u4f7f\u7528\u3002  </p>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E4%BD%BF%E7%94%A8PyMuPDF4LLM%E8%A7%A3%E6%9E%90PDF%E7%9A%84%E5%9B%BE%E7%89%87%E5%92%8C%E8%A1%A8%E6%A0%BC/#pdf","title":"PDF\u56fe\u7247\u548c\u8868\u683c\u89e3\u6790\u5de5\u5177","text":"<p>\u63a5\u4e0b\u6765\u4ecb\u7ecd\u4e00\u4e0b\u4f7f\u7528 pymupdf4llm \u5c01\u88c5\u7684\u5de5\u5177</p> <p>\u529f\u80fd\u63cf\u8ff0\uff1a\u5c06\u672c\u5730\u6216\u8005\u5728\u7ebf\u7684pdf\u6587\u4ef6\u8f6c\u6362\u4e3amarkdown\u683c\u5f0f\uff0c\u5e76\u4e14\u5c06pdf\u6587\u4ef6\u4e2d\u63d0\u53d6\u7684\u56fe\u7247\u4e0a\u4f20\u5230oss\u4e2d\u3002</p> <p>\u8981\u5b9e\u73b0\u4e0a\u8ff0\u529f\u80fd\uff0c\u53ef\u4ee5\u6309\u7167\u4ee5\u4e0b\u6b65\u9aa4\u8fdb\u884c\uff1a</p> <ol> <li>\u8bfb\u53d6pdf\u6587\u4ef6\uff1a\u5982\u679c\u4e3a\u672c\u5730\u6587\u4ef6\u5219\u76f4\u63a5\u8bfb\u53d6\uff0c\u5982\u679c\u662f\u8fdc\u7a0b\u6587\u4ef6\u5219\u4e0b\u8f7d\u5230\u672c\u5730\u518d\u8bfb\u53d6\u3002</li> <li>\u8f6c\u6362\u4e3aMarkdown\u6587\u4ef6\uff1a\u4f7f\u7528 pymupdf4llm \u5c06 pdf \u6587\u4ef6\u8f6c\u6362\u4e3a Markdown \u6587\u4ef6\u3002</li> <li>\u89e3\u6790Markdown\u6587\u4ef6\u56fe\u7247\u8def\u5f84\uff1a\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u89e3\u6790\u51fa\u56fe\u7247\u8def\u5f84\u3002</li> <li>\u4e0a\u4f20\u56fe\u7247\u5230OSS\uff1a\u5224\u65ad\u56fe\u7247\u8def\u5f84\u662f\u5426\u4e3a\u672c\u5730\u8def\u5f84\uff0c\u5982\u679c\u662f\u672c\u5730\u8def\u5f84\uff0c\u5219\u5c06\u56fe\u7247\u4e0a\u4f20\u5230\u963f\u91cc\u4e91OSS\u3002</li> <li>\u66f4\u65b0Markdown\u5185\u5bb9\uff1a\u5c06Markdown\u6587\u4ef6\u4e2d\u7684\u672c\u5730\u56fe\u7247\u8def\u5f84\u66ff\u6362\u4e3aOSS\u4e0a\u7684URL\u3002</li> <li>\u4fdd\u5b58\u66f4\u65b0\u540e\u7684Markdown\u6587\u4ef6\u3002</li> </ol> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u793a\u4f8b\u4ee3\u7801\uff0c\u5c55\u793a\u4e86\u5982\u4f55\u5b9e\u73b0\u4e0a\u8ff0\u6b65\u9aa4\uff1a</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E4%BD%BF%E7%94%A8PyMuPDF4LLM%E8%A7%A3%E6%9E%90PDF%E7%9A%84%E5%9B%BE%E7%89%87%E5%92%8C%E8%A1%A8%E6%A0%BC/#_2","title":"\u4ee3\u7801\u5b9e\u73b0","text":"<pre><code>import oss2\nimport os\nimport re\nimport requests\nimport hashlib\n\nimport pymupdf4llm\nfrom enum import Enum\nfrom tempfile import TemporaryDirectory\nfrom typing import Optional, Dict\nfrom pathlib import Path\nfrom urllib.parse import urlparse\n\n# \u963f\u91cc\u4e91OSS\u914d\u7f6e\nACCESS_KEY_ID = 'xxxx'\nACCESS_KEY_SECRET = 'xxxx'\nBUCKET_NAME = 'xxxx'\n# \u586b\u5199Bucket\u6240\u5728\u5730\u57df\u5bf9\u5e94\u7684Endpoint\u3002\nENDPOINT = \"cn-hangzhou.alipay.aliyun-inc.com\"\n# \u586b\u5199Endpoint\u5bf9\u5e94\u7684Region\u4fe1\u606f\uff0c\u4f8b\u5982cn-hangzhou\u3002\u6ce8\u610f\uff0cv4\u7b7e\u540d\u4e0b\uff0c\u5fc5\u987b\u586b\u5199\u8be5\u53c2\u6570\nREGION = \"cn-hangzhou\"\n\n# \u8bbe\u7f6e\u5230\u73af\u5883\u53d8\u91cf\u4e2d\nos.environ['OSS_ACCESS_KEY_ID'] = ACCESS_KEY_ID\nos.environ['OSS_ACCESS_KEY_SECRET'] = ACCESS_KEY_SECRET\nos.environ['OSS_ENDPOINT'] = ENDPOINT\nos.environ['OSS_BUCKET_NAME'] = BUCKET_NAME\nos.environ['OSS_REGION'] = REGION\n\n# oss url expires: \u8fc7\u671f\u65f6\u95f4\uff08\u5355\u4f4d\uff1a\u79d2\uff09\uff0c\u94fe\u63a5\u5728\u5f53\u524d\u65f6\u95f4\u518d\u8fc7expires\u79d2\u540e\u8fc7\u671f\noss_url_expires = 60 * 60 * 24 * 365\n\n\nclass UploadMode(Enum):\n    \"\"\"Upload mode.\"\"\"\n    # \u4e0a\u4f20\u6240\u6709\u56fe\u7247\n    ALL = \"all\"\n    # \u672c\u5730\u56fe\u7247\u4e0a\u4f20\n    LOCAL = \"local\"\n\n\ndef is_valid_url(url: str) -&gt; bool:\n    \"\"\"\n    \u68c0\u67e5URL\u662f\u5426\u6709\u6548\n    :param url: URL\n    :return: \u662f\u5426\u6709\u6548\n    \"\"\"\n    \"\"\"Check if the url is valid.\"\"\"\n    parsed = urlparse(url)\n    return bool(parsed.netloc) and bool(parsed.scheme)\n\n\ndef handle_remote_file(file_path: str, temp_dir: TemporaryDirectory, headers: Optional[Dict] = None):\n    \"\"\"\n    \u5904\u7406\u8fdc\u7a0b\u6587\u4ef6\n    :param file_path: \u6587\u4ef6\u8def\u5f84\n    :param temp_dir: \u4e34\u65f6\u76ee\u5f55\n    :param headers: \u8bf7\u6c42\u5934\n    :return: \u6587\u4ef6\u8def\u5f84\n    \"\"\"\n    # If the file is a web path, download it to a temporary file, and use that\n    if not os.path.isfile(file_path) and is_valid_url(file_path):\n        web_path = file_path\n        r = requests.get(web_path, headers=headers)\n        if r.status_code != 200:\n            raise ValueError(\n                \"Check the url of your file; returned status code %s\"\n                % r.status_code\n            )\n        _, suffix = os.path.splitext(file_path)\n        suffix = suffix.split(\"?\")[0]\n        # \u4f7f\u7528MD5\u7b97\u6cd5\n        md5_hash = hashlib.md5(file_path.encode('utf-8')).hexdigest()\n        temp_pdf = os.path.join(temp_dir.name, f\"tmp_{md5_hash}{suffix}\")\n        with open(temp_pdf, mode=\"wb\") as f:\n            f.write(r.content)\n        file_path = str(temp_pdf)\n    elif not os.path.isfile(file_path):\n        raise ValueError(\"File path %s is not a valid file or url\" % file_path)\n\n    return file_path\n\n\ndef get_bucket():\n    \"\"\"\n    \u83b7\u53d6OSS Bucket\u5bf9\u8c61\n    :return: OSS Bucket\u5bf9\u8c61\n    \"\"\"\n    # \u4ece\u73af\u5883\u53d8\u91cf\u4e2d\u83b7\u53d6ACCESS_KEY_ID\n    access_key_id = os.getenv('OSS_ACCESS_KEY_ID')\n    # \u4ece\u73af\u5883\u53d8\u91cf\u4e2d\u83b7\u53d6ACCESS_KEY_SECRET\n    access_key_secret = os.getenv('OSS_ACCESS_KEY_SECRET')\n    # \u4ece\u73af\u5883\u53d8\u91cf\u4e2d\u83b7\u53d6ENDPOINT\n    endpoint = os.getenv('OSS_ENDPOINT')\n    # \u4ece\u73af\u5883\u53d8\u91cf\u4e2d\u83b7\u53d6BUCKET_NAME\n    bucket_name = os.getenv('OSS_BUCKET_NAME')\n    # \u4ece\u73af\u5883\u53d8\u91cf\u4e2d\u83b7\u53d6REGION\n    region = os.getenv('OSS_REGION')\n\n    if not access_key_id:\n        raise ValueError(\"OSS_ACCESS_KEY_ID must be set as an environment variable.\")\n    if not access_key_secret:\n        raise ValueError(\"OSS_ACCESS_KEY_SECRET must be set as an environment variable.\")\n    if not endpoint:\n        raise ValueError(\"OSS_ENDPOINT must be set as an environment variable.\")\n    if not bucket_name:\n        raise ValueError(\"OSS_BUCKET_NAME must be set as an environment variable.\")\n\n    auth = oss2.Auth(ACCESS_KEY_ID, ACCESS_KEY_SECRET)\n    return oss2.Bucket(auth=auth, endpoint=ENDPOINT, bucket_name=BUCKET_NAME, region=region)\n\n\ndef upload_to_oss(file_path: str, bucket: oss2.Bucket):\n    \"\"\"\n    \u4e0a\u4f20\u6587\u4ef6\u5230OSS\u5e76\u8fd4\u56deURL\n    :param file_path: \u6587\u4ef6\u8def\u5f84\n    :param bucket: OSS Bucket\u5bf9\u8c61\n    :return: \u9884\u89c8URL\n    \"\"\"\n    # \u5224\u65ad\u6587\u4ef6\u662f\u5426\u5b58\u5728\n    if not os.path.exists(file_path):\n        print(f\"File {file_path} does not exist.\")\n        return None\n\n    # \u89e3\u6790\u6587\u4ef6\u540d\u548c\u6269\u5c55\u540d\n    filename, ext = os.path.splitext(os.path.basename(file_path))\n    # \u6784\u9020OSS\u6587\u4ef6\u540d\uff0c\u786e\u4fdd\u4e0d\u91cd\u590d\n    oss_filename = f\"{filename}{ext}\"\n    # \u4e0a\u4f20\u6587\u4ef6\u5230OSS\n    with open(file_path, 'rb') as data:\n        result = bucket.put_object(oss_filename, data)\n        if result.status == 200:\n            print(f\"File {file_path} uploaded successfully to OSS as {oss_filename}\")\n            preview_url = bucket.sign_url('GET', oss_filename, oss_url_expires)\n            return preview_url\n    return file_path\n\n\ndef get_image_path(image_path: str,\n                   mode: UploadMode,\n                   md_file_path: str,\n                   temp_dir: TemporaryDirectory):\n    \"\"\"\n    \u83b7\u53d6\u56fe\u7247\u7684\u7edd\u5bf9\u8def\u5f84\n    :param image_path: \u56fe\u7247\u8def\u5f84\n    :param mode: \u56fe\u7247\u4e0a\u4f20\u6a21\u5f0f\uff0c\u9ed8\u8ba4\u4e3aUploadMode.LOCAL\uff08\u4ec5\u672c\u5730\u56fe\u7247\uff09\n    :param md_file_path: Markdown\u6587\u4ef6\u8def\u5f84\n    :param temp_dir: \u4e34\u65f6\u76ee\u5f55\u5bf9\u8c61\uff0c\u7528\u4e8e\u4fdd\u5b58\u8fdc\u7a0b\u56fe\u7247\n    \"\"\"\n    # \u68c0\u67e5\u662f\u5426\u4e3a\u8fdc\u7a0b\u56fe\u7247\n    if mode == UploadMode.ALL:\n        # \u5c06\u8fdc\u7a0b\u56fe\u7247\u4fdd\u5b58\u5230\u672c\u5730\u5e76\u8fd4\u56de\u672c\u5730\u8def\u5f84\n        image_path = handle_remote_file(image_path, temp_dir)\n        return image_path\n\n    # \u68c0\u67e5\u662f\u5426\u4e3a\u76f8\u5bf9\u8def\u5f84\n    if not os.path.isabs(image_path):\n        # \u83b7\u53d6Markdown\u6587\u4ef6\u6240\u5728\u7684\u76ee\u5f55\n        base_dir = os.path.dirname(md_file_path)\n        image_path = os.path.join(base_dir, image_path)\n\n    return image_path\n\n\ndef get_new_image_path(match: tuple,\n                       bucket: oss2.Bucket,\n                       mode: UploadMode,\n                       md_file_path: str,\n                       temp_dir: TemporaryDirectory):\n    \"\"\"\n    \u6839\u636e\u5339\u914d\u7684\u56fe\u7247\u8def\u5f84\u548c\u6a21\u5f0f\uff0c\u83b7\u53d6\u65b0\u7684\u56fe\u7247\u8def\u5f84\n    :param match: \u5339\u914d\u7684\u56fe\u7247\u8def\u5f84\u5143\u7ec4\uff08alt_text, image_path\uff09\n    :param bucket: OSS Bucket\u5bf9\u8c61\n    :param mode: \u56fe\u7247\u4e0a\u4f20\u6a21\u5f0f\uff0c\u9ed8\u8ba4\u4e3aUploadMode.LOCAL\uff08\u4ec5\u672c\u5730\u56fe\u7247\uff09\n    :param md_file_path: Markdown\u6587\u4ef6\u8def\u5f84\n    :param temp_dir: \u4e34\u65f6\u76ee\u5f55\u5bf9\u8c61\uff0c\u7528\u4e8e\u4fdd\u5b58\u8fdc\u7a0b\u56fe\u7247\n    \"\"\"\n    alt_text, image_path = match\n    # \u83b7\u53d6\u56fe\u7247\u7684\u7edd\u5bf9\u8def\u5f84\n    image_path = get_image_path(image_path=image_path, mode=mode, md_file_path=md_file_path, temp_dir=temp_dir)\n\n    # \u4e0a\u4f20\u56fe\u7247\u5230OSS\u5e76\u83b7\u53d6URL\n    oss_url = upload_to_oss(image_path, bucket)\n\n    if alt_text:\n        new_image_path = f\"![{alt_text}]({oss_url})\"\n    else:\n        # \u89e3\u6790\u56fe\u7247\u6587\u4ef6\u540d\u548c\u6269\u5c55\u540d\n        filename = os.path.basename(image_path)\n        new_image_path = f\"![{filename}]({oss_url})\"\n\n    return new_image_path\n\n\ndef replace_local_images_with_oss_url(md_file_path: str,\n                                      temp_dir: TemporaryDirectory,\n                                      mode: UploadMode = UploadMode.LOCAL,\n                                      bucket: oss2.Bucket = None, ):\n    \"\"\"\n    \u66ff\u6362Markdown\u6587\u4ef6\u4e2d\u7684\u672c\u5730\u56fe\u7247\u8def\u5f84\u4e3aOSS URL\n    :param md_file_path: Markdown\u6587\u4ef6\u8def\u5f84\n    :param temp_dir: \u4e34\u65f6\u76ee\u5f55\u5bf9\u8c61\uff0c\u7528\u4e8e\u4fdd\u5b58\u8fdc\u7a0b\u56fe\u7247\n    :param mode: \u56fe\u7247\u4e0a\u4f20\u6a21\u5f0f\uff0c\u9ed8\u8ba4\u4e3aUploadMode.LOCAL\uff08\u4ec5\u672c\u5730\u56fe\u7247\uff09\n    :param bucket: OSS Bucket\u5bf9\u8c61\uff0c\u5982\u679c\u5df2\u63d0\u4f9b\u5219\u76f4\u63a5\u4f7f\u7528\uff0c\u5426\u5219\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684Bucket\u5bf9\u8c61\n    \"\"\"\n    if not md_file_path.endswith('.md'):\n        print(f\"Skipping non-Markdown file: {md_file_path}\")\n        return\n\n    with open(md_file_path, 'r', encoding='utf-8') as md_file:\n        content = md_file.read()\n\n    if not bucket:\n        bucket = get_bucket()\n\n    print(f'\u5f00\u59cb\u66ff\u6362\u56fe\u7247: {md_file_path}')\n    # \u5339\u914dMarkdown\u6587\u4ef6\u4e2d\u7684\u56fe\u7247\u8def\u5f84\n    pattern = r'!\\[(.*?)\\]\\((.*?)\\)'\n    matches = re.findall(pattern, content)\n    print(f'\u5339\u914d\u5230 {len(matches)} \u5f20\u56fe\u7247')\n\n    replace_num = 0\n    new_content = content\n    # \u4e0a\u4f20\u5e76\u66ff\u6362\u56fe\u7247\n    for match in matches:\n        alt_text, image_path = match\n        old_image_path = f\"![{alt_text}]({image_path})\"\n\n        new_image_path = get_new_image_path(match=match,\n                                            bucket=bucket,\n                                            mode=mode,\n                                            md_file_path=md_file_path,\n                                            temp_dir=temp_dir)\n\n        if new_image_path:\n            print(f\"Replacing {old_image_path} with {new_image_path}\")\n            new_content = new_content.replace(old_image_path, new_image_path)\n            replace_num += 1\n    # \u5199\u56deMarkdown\u6587\u4ef6\n    with open(md_file_path, 'w') as file:\n        file.write(new_content)\n    print(f\"\u66ff\u6362\u5b8c\u6210\uff0c\u5171\u66ff\u6362 {replace_num} \u5f20\u56fe\u7247\")\n    return replace_num\n\n\ndef replace_local_images_with_oss_url_from_folder(folder_path: str,\n                                                  mode: UploadMode = UploadMode.LOCAL,\n                                                  bucket: oss2.Bucket = None):\n    \"\"\"\u66ff\u6362Markdown\u6587\u4ef6\u5939\u4e2d\u7684\u672c\u5730\u56fe\u7247\u8def\u5f84\u4e3aOSS URL\"\"\"\n    if not bucket:\n        bucket = get_bucket()\n    # \u521b\u5efa\u4e34\u65f6\u6587\u4ef6\u5939\n    temp_dir = TemporaryDirectory()\n    # \u904d\u5386Markdown\u6587\u4ef6\u5939\n    for root, dirs, files in os.walk(folder_path):\n        for file in files:\n            if file.endswith('.md'):\n                md_file_path = os.path.join(root, file)\n                replace_local_images_with_oss_url(md_file_path=md_file_path, mode=mode, bucket=bucket,\n                                                  temp_dir=temp_dir)\n\n\ndef pdf_to_markdown(file_path: str,\n                    temp_dir: TemporaryDirectory,\n                    md_file_path: str = None,\n                    image_path: str = None,\n                    is_upload_images: bool = True,\n                    write_images: bool = True,\n                    image_format: str = \"png\",\n                    dpi: int = 200):\n    file_path = handle_remote_file(file_path, temp_dir=temp_dir)\n\n    # if not file_path.endswith(\".pdf\"):\n    #     raise ValueError(f\"\u6587\u4ef6\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u4ec5\u652f\u6301pdf\u683c\u5f0f, \u5f53\u524d\u6587\u4ef6\u683c\u5f0f\u4e3a{file_path}\")\n\n    if md_file_path is None:\n        # \u89e3\u6790\u6587\u4ef6\u540d\u548c\u6269\u5c55\u540d\n        filename, ext = os.path.splitext(os.path.basename(file_path))\n        md_file_path = os.path.join(temp_dir.name, f\"{filename}.md\")\n\n    if image_path is None:\n        image_path = os.path.join(os.path.dirname(md_file_path), f\"images\")\n\n    # \u8bfb\u53d6PDF\u6587\u4ef6\n    md_text = pymupdf4llm.to_markdown(doc=file_path,\n                                      write_images=write_images,\n                                      image_path=image_path,\n                                      image_format=image_format,\n                                      dpi=dpi,\n                                      )\n\n    # \u5199\u5165Markdown\u6587\u4ef6\n    Path(md_file_path).write_bytes(md_text.encode())\n    print(f\"Markdown\u6587\u4ef6\u5df2\u751f\u6210: {md_file_path}\")\n    # \u4e0a\u4f20\u56fe\u7247\u5230OSS\u5e76\u83b7\u53d6URL\n    if is_upload_images:\n        print(f\"\u5f00\u59cb\u4e0a\u4f20\u56fe\u7247\u5230OSS: {md_file_path}\")\n        replace_local_images_with_oss_url(md_file_path, temp_dir)\n        print(f\"\u4e0a\u4f20\u56fe\u7247\u540e\u7684Markdown\u6587\u4ef6\u5df2\u751f\u6210: {md_file_path}\")\n    return md_file_path\n\n\n# \u4f7f\u7528\u793a\u4f8b\nif __name__ == \"__main__\":\n    # \u521b\u5efa\u4e34\u65f6\u6587\u4ef6\u5939\n    temp_dir2 = TemporaryDirectory()\n    file_path2 = \"https://arxiv.org/pdf/2411.07396\"\n    md_file_path2 = pdf_to_markdown(file_path2, temp_dir2)\n    with open(md_file_path2, 'r', encoding='utf-8') as file:\n        content2 = file.read()\n\n    with open('test.md', 'w', encoding='utf-8') as file:\n        file.write(content2)\n</code></pre>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E4%BD%BF%E7%94%A8PyMuPDF4LLM%E8%A7%A3%E6%9E%90PDF%E7%9A%84%E5%9B%BE%E7%89%87%E5%92%8C%E8%A1%A8%E6%A0%BC/#_3","title":"\u6548\u679c\u6f14\u793a","text":""},{"location":"rag/%E3%80%90RAG%E3%80%91%E4%BD%BF%E7%94%A8PyMuPDF4LLM%E8%A7%A3%E6%9E%90PDF%E7%9A%84%E5%9B%BE%E7%89%87%E5%92%8C%E8%A1%A8%E6%A0%BC/#pdf_1","title":"\u5728\u7ebfPDF\u6587\u4ef6\u8f6c\u6362","text":"<p>\u63a5\u4e0b\u6765\u4f7f\u7528\u4e0a\u9762\u7684\u4ee3\u7801\u6f14\u793a\u5982\u4f55\u5c06 arxiv \u4e2d\u7684\u8bba\u6587\u76f4\u63a5\u8f6c\u6362\u4e3a markdown \u683c\u5f0f\uff0c\u5e76\u4e14\u8f6c\u6362\u540e\u7684\u56fe\u7247\u4e0a\u4f20\u5230oss\u4e2d\u3002</p> <p>\u968f\u4fbf\u627e\u4e00\u7bc7\u8bba\u6587\u5373\u53ef\uff0c\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a</p> <p><pre><code># \u4f7f\u7528\u793a\u4f8b\nif __name__ == \"__main__\":\n    # \u521b\u5efa\u4e34\u65f6\u6587\u4ef6\u5939\uff0c\u4ee3\u7801\u8fd0\u884c\u7ed3\u675f\u4f1a\u81ea\u52a8\u5220\u9664\u4e34\u65f6\u6587\u4ef6\u548c\u5176\u4e2d\u7684\u6240\u6709\u5185\u5bb9\n    temp_dir2 = TemporaryDirectory()\n    file_path2 = \"https://arxiv.org/pdf/2411.07396\"\n    md_file_path2 = pdf_to_markdown(file_path2, temp_dir2)\n    with open(md_file_path2, 'r', encoding='utf-8') as file:\n        content2 = file.read()\n\n    with open('test.md', 'w', encoding='utf-8') as file:\n        file.write(content2)\n</code></pre> | \u67e5\u770b\u539f\u6587                                                                                  | \u8f6c\u6362\u540e\u7684 markdown                                                                                                             | | ----------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------- | |  |  |</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E4%BD%BF%E7%94%A8PyMuPDF4LLM%E8%A7%A3%E6%9E%90PDF%E7%9A%84%E5%9B%BE%E7%89%87%E5%92%8C%E8%A1%A8%E6%A0%BC/#pdf_2","title":"\u672c\u5730PDF\u6587\u4ef6\u8f6c\u6362","text":"<p>\u63a5\u4e0b\u6765\u4ecb\u7ecd\u4e00\u4e0b\u672c\u5730PDF\u6587\u4ef6\u7684\u8f6c\u6362\u6548\u679c\uff0c\u5728\u627e\u4e00\u7bc7\u8bba\u6587\u4e0b\u8f7d\u5230\u672c\u5730\uff0c\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code># \u4f7f\u7528\u793a\u4f8b\nif __name__ == \"__main__\":\n    # \u521b\u5efa\u4e34\u65f6\u6587\u4ef6\u5939\uff0c\u4ee3\u7801\u8fd0\u884c\u7ed3\u675f\u4f1a\u81ea\u52a8\u5220\u9664\u4e34\u65f6\u6587\u4ef6\u548c\u5176\u4e2d\u7684\u6240\u6709\u5185\u5bb9\n    temp_dir2 = TemporaryDirectory()\n    file_path2 = \"/Users/xiniao/Downloads/2411.07264v1.pdf\"\n    md_file_path2 = pdf_to_markdown(file_path2, temp_dir2)\n    with open(md_file_path2, 'r', encoding='utf-8') as file:\n        content2 = file.read()\n\n    with open('test.md', 'w', encoding='utf-8') as file:\n        file.write(content2)\n</code></pre> \u67e5\u770b\u539f\u6587 \u67e5\u770b\u8f6c\u6362\u540e\u7684 markdown\u6587\u4ef6"},{"location":"rag/%E3%80%90RAG%E3%80%91%E4%BD%BF%E7%94%A8PyMuPDF4LLM%E8%A7%A3%E6%9E%90PDF%E7%9A%84%E5%9B%BE%E7%89%87%E5%92%8C%E8%A1%A8%E6%A0%BC/#langchain","title":"\u96c6\u6210langchain","text":"<p>\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u4ee3\u7801\u96c6\u6210pymupdf4llm\u5230langchain\u4e2d\uff1a</p> <pre><code>import os\nimport re\nfrom typing import Optional, Dict, Any, List\n\nimport oss2\nimport pymupdf4llm\nfrom langchain_community.document_loaders.pdf import BasePDFLoader\nfrom langchain_core.documents import Document\nfrom langchain_core.documents.base import Blob\nfrom langchain_text_splitters import MarkdownTextSplitter\n\n\nclass PyMuPDF4llmLoader(BasePDFLoader):\n    \"\"\"Load `PDF` files using `PyMuPDF`.\"\"\"\n\n    def __init__(\n            self,\n            file_path: str,\n            *,\n            headers: Optional[Dict] = None,\n            extract_images: bool = False,\n            upload_images: bool = False,\n            bucket: oss2.Bucket = None,\n            oss_url_expires: int = 60 * 60 * 24,\n            **kwargs: Any,\n    ) -&gt; None:\n\n        try:\n            import pymupdf4llm  # noqa:F401\n        except ImportError:\n            raise ImportError(\n                \"pymupdf4llm package not found, please install it with \"\n                \"`pip install pymupdf4llm`\"\n            )\n\n        \"\"\"Initialize with a file path.\"\"\"\n        super().__init__(file_path, headers=headers)\n        self.extract_images = extract_images\n        if upload_images and bucket is None:\n            raise ValueError(\"upload_images is True but bucket is None\")\n        if upload_images and oss_url_expires &lt;= 0:\n            raise ValueError(\"oss_url_expires must be greater than 0\")\n        self.upload_images = upload_images\n        self.bucket = bucket\n        self.oss_url_expires = oss_url_expires\n        self.kwargs = kwargs\n\n    def load(self) -&gt; List[Document]:\n\n        if self.web_path:\n            blob = Blob.from_data(open(self.file_path, \"rb\").read(), path=self.web_path)  # type: ignore[attr-defined]\n        else:\n            blob = Blob.from_path(self.file_path)  # type: ignore[attr-defined]\n        return self.parse(blob)\n\n    def parse(self, blob: Blob) -&gt; List[Document]:\n        \"\"\"Parse a PDF file into a list of documents.\n\n        If `blob` is a directory, this will load all PDF files within it.\n        \"\"\"\n        image_path = os.path.join(os.path.dirname(self.file_path), f\"images\")\n\n        # \u8bfb\u53d6PDF\u6587\u4ef6\n        pages = pymupdf4llm.to_markdown(doc=self.file_path,\n                                        write_images=self.extract_images,\n                                        image_path=image_path,\n                                        page_chunks=True,\n                                        **self.kwargs\n                                        )\n        if isinstance(pages, list):\n            # \u521b\u5efaDocument\u5bf9\u8c61\n            docs = []\n            for i, page in enumerate(pages):\n                metadata = {\n                    \"file_path\": blob.path,\n                    \"page\": page.get('metadata').get('page'),\n                    \"total_pages\": page.get('metadata').get('page_count'),\n                }\n                page_content = page.get(\"text\")\n                if self.upload_images:\n                    page_content = self._replace_local_images_with_oss_url(page_content)\n\n                doc = Document(page_content=page_content, metadata=metadata)\n                docs.append(doc)\n\n            return docs\n\n    def _replace_local_images_with_oss_url(self, content: str):\n        \"\"\"\n        \u66ff\u6362Markdown\u6587\u4ef6\u4e2d\u7684\u672c\u5730\u56fe\u7247\u8def\u5f84\u4e3aOSS URL\n        \"\"\"\n        # \u5339\u914dMarkdown\u6587\u4ef6\u4e2d\u7684\u56fe\u7247\u8def\u5f84\n        pattern = r'!\\[(.*?)\\]\\((.*?)\\)'\n        matches = re.findall(pattern, content)\n        print(f'\u5339\u914d\u5230 {len(matches)} \u5f20\u56fe\u7247')\n\n        replace_num = 0\n        new_content = content\n        # \u4e0a\u4f20\u5e76\u66ff\u6362\u56fe\u7247\n        for alt_text, image_path in matches:\n            old_image_path = f\"![{alt_text}]({image_path})\"\n\n            image_oss_url = self._upload_to_oss(image_path, self.bucket)\n\n            # \u66ff\u6362\u56fe\u7247\u8def\u5f84\n            if image_oss_url:\n                new_image_path = f\"![{alt_text}]({image_oss_url})\"\n\n                new_content = new_content.replace(old_image_path, new_image_path)\n                replace_num += 1\n                print(f\"Replacing {old_image_path} with {new_image_path}\")\n\n        print(f\"\u66ff\u6362\u5b8c\u6210\uff0c\u5171\u66ff\u6362 {replace_num} \u5f20\u56fe\u7247\")\n        return new_content\n\n    def _upload_to_oss(self, file_path: str, bucket: oss2.Bucket):\n        \"\"\"\n        \u4e0a\u4f20\u6587\u4ef6\u5230OSS\u5e76\u8fd4\u56deURL\n        :param file_path: \u6587\u4ef6\u8def\u5f84\n        :param bucket: OSS Bucket\u5bf9\u8c61\n        :return: \u9884\u89c8URL\n        \"\"\"\n        # \u5224\u65ad\u6587\u4ef6\u662f\u5426\u5b58\u5728\n        if not os.path.exists(file_path):\n            print(f\"File {file_path} does not exist.\")\n            return None\n\n        # \u89e3\u6790\u6587\u4ef6\u540d\u548c\u6269\u5c55\u540d\n        filename, ext = os.path.splitext(os.path.basename(file_path))\n        # \u6784\u9020OSS\u6587\u4ef6\u540d\uff0c\u786e\u4fdd\u4e0d\u91cd\u590d\n        oss_filename = f\"{filename}{ext}\"\n        # \u4e0a\u4f20\u6587\u4ef6\u5230OSS\n        with open(file_path, 'rb') as data:\n            result = bucket.put_object(oss_filename, data)\n            if result.status == 200:\n                print(f\"File {file_path} uploaded successfully to OSS as {oss_filename}\")\n                preview_url = bucket.sign_url('GET', oss_filename, self.oss_url_expires)\n                return preview_url\n        return file_path\n\n\nif __name__ == '__main__':\n    file_path = \"https://arxiv.org/pdf/2411.07264\"\n    from pdf_test import get_bucket\n    loader = PyMuPDF4llmLoader(file_path=file_path, extract_images=True, upload_images=True, bucket=get_bucket())\n    splitter = MarkdownTextSplitter(chunk_size=400, chunk_overlap=0, add_start_index=True)\n\n    docs = loader.load_and_split(text_splitter=splitter)\n    print(len(docs))\n    for doc in docs:\n        print(doc)\n</code></pre>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E4%BD%BF%E7%94%A8PyMuPDF4LLM%E8%A7%A3%E6%9E%90PDF%E7%9A%84%E5%9B%BE%E7%89%87%E5%92%8C%E8%A1%A8%E6%A0%BC/#_4","title":"\u7ed3\u8bba","text":"<p>\u4ece\u524d\u9762\u7684\u6f14\u793a\u4e2d\u53ef\u4ee5\u770b\u5230 pymupdf4llm \u80fd\u591f\u63d0\u53d6\u56fe\u7247\u7684\u4fe1\u606f\uff0c\u4f46\u662f\u63d0\u53d6\u7684\u56fe\u7247\u7684\u4f4d\u7f6e\u4e0e\u539f\u6587\u4e0d\u4e00\u81f4\uff0c\u5bf9\u4e8e\u5927\u90e8\u5206\u573a\u666f\u4efb\u7136\u662f\u6709\u6548\u7684\uff0c\u56e0\u4e3a\u5b83\u7684\u8f6c\u6362\u6548\u7387\u8f83\u9ad8\uff08\u4e0d\u9700\u8981GPU\uff09\u3002\u5982\u679c\u4f7f\u7528OCR\u6216\u8005\u591a\u6a21\u6001\u5927\u6a21\u578b\u63d0\u53d6PDF\u6587\u4ef6\u4e2d\u7684\u56fe\u7247\u548c\u6587\u5b57\u51c6\u786e\u7387\u4f1a\u9ad8\u5f88\u591a\uff0c\u4f46\u662f\u5b58\u5728\u6210\u672c\u8f83\u9ad8\u548c\u6548\u7387\u4f4e\u7684\u95ee\u9898\u3002</p> <p>\u53c2\u8003\u6587\u6863</p> <ol> <li>https://readmedium.com/why-pymupdf4llm-is-the-best-tool-for-extracting-data-from-pdfs-even-if-you-didnt-know-you-needed-7bff75313691</li> <li>https://pymupdf.readthedocs.io/en/latest/pymupdf4llm</li> <li>https://github.com/pymupdf/RAG/tree/main/pymupdf4llm</li> </ol>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/","title":"\u3010RAG\u3011\u6784\u5efa\u5411\u91cf\u6570\u636e\u5e93\u7d22\u5f15","text":"<p>\u672c\u6587\u4e3b\u8981\u662f\u4ecb\u7ecd\u5982\u4f55\u6784\u5efa\u5411\u91cf\u6570\u636e\u5e93\u7d22\u5f15\uff0c\u63a5\u4e0b\u6765\u4ece\u5982\u4e0b\u51e0\u4e2a\u65b9\u9762\u8fdb\u884c\u4ecb\u7ecd\uff1a 1. \u56de\u987eRAG\u6784\u5efa\u6d41\u7a0b 2. \u5982\u4f55\u9009\u62e9\u5411\u91cf\u6570\u636e\u5e93 3. \u5982\u4f55\u9009\u62e9\u5d4c\u5165\u6a21\u578b 4. \u4ee3\u7801\u5b9e\u8df5 5. \u603b\u7ed3</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#rag_1","title":"\u56de\u987eRAG\u6784\u5efa\u6d41\u7a0b","text":""},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#rag_2","title":"RAG\u6784\u5efa\u6d41\u7a0b","text":"<p>RAG\u7684\u6784\u5efa\u5206\u4e3a\u4e24\u4e2a\u4e3b\u8981\u9636\u6bb5\uff1a\u7d22\u5f15\u6784\u5efa\uff08Offline\uff09\u548c\u67e5\u8be2/\u68c0\u7d22\uff08Online\uff09</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#1","title":"\u9636\u6bb51: \u7d22\u5f15\u6784\u5efa\uff08\u79bb\u7ebf\u5904\u7406\uff09","text":"<ol> <li>\u6587\u6863\u52a0\u8f7d\uff1a\u4ece\u5404\u79cd\u6765\u6e90\uff08PDF\u3001TXT\u7b49\uff09\u52a0\u8f7d\u6587\u6863\u3002</li> <li>\u6587\u672c\u5206\u5757\uff1a\u5c06\u6587\u6863\u5206\u5272\u6210\u8f83\u5c0f\u7684\u6587\u672c\u5757\uff08chunks\uff09\u3002</li> <li>\u5d4c\u5165\u751f\u6210\uff1a\u4f7f\u7528\u5d4c\u5165\u6a21\u578b\u5c06\u6bcf\u4e2a\u6587\u672c\u5757\u8f6c\u6362\u4e3a\u5411\u91cf\uff08embedding\uff09\u3002</li> <li>\u5411\u91cf\u5b58\u50a8\uff1a\u5c06\u5411\u91cf\u548c\u5bf9\u5e94\u7684\u6587\u672c\u5757\uff08\u4ee5\u53ca\u5143\u6570\u636e\uff09\u5b58\u50a8\u5230\u5411\u91cf\u6570\u636e\u5e93\u4e2d\u3002</li> </ol>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#2","title":"\u9636\u6bb52: \u67e5\u8be2/\u68c0\u7d22\uff08\u5728\u7ebf\u5904\u7406\uff09","text":"<ol> <li>\u7528\u6237\u8f93\u5165\u67e5\u8be2\uff1a\u63a5\u6536\u7528\u6237\u7684\u95ee\u9898\u3002</li> <li>\u67e5\u8be2\u5d4c\u5165\uff1a\u4f7f\u7528\u76f8\u540c\u7684\u5d4c\u5165\u6a21\u578b\u5c06\u67e5\u8be2\u8f6c\u6362\u4e3a\u5411\u91cf\u3002</li> <li>\u76f8\u4f3c\u6027\u641c\u7d22\uff1a\u5728\u5411\u91cf\u6570\u636e\u5e93\u4e2d\u641c\u7d22\u4e0e\u67e5\u8be2\u5411\u91cf\u6700\u76f8\u4f3c\u7684\u6587\u672c\u5757\uff08top k\uff09\u3002</li> <li>\u4e0a\u4e0b\u6587\u7ec4\u88c5\uff1a\u5c06\u68c0\u7d22\u5230\u7684\u6587\u672c\u5757\u4f5c\u4e3a\u4e0a\u4e0b\u6587\u3002</li> <li>\u751f\u6210\u7b54\u6848\uff1a\u5c06\u67e5\u8be2\u548c\u68c0\u7d22\u5230\u7684\u4e0a\u4e0b\u6587\u4e00\u8d77\u8f93\u5165\u7ed9\u5927\u8bed\u8a00\u6a21\u578b\uff08LLM\uff09\u751f\u6210\u7b54\u6848\u3002</li> </ol>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#_1","title":"\u6d41\u7a0b\u56fe","text":"<pre><code>graph TD\n\n    subgraph \u79bb\u7ebf\u7d22\u5f15\u6784\u5efa\n        A[\u539f\u59cb\u6587\u6863] --&gt; B[\u6587\u6863\u52a0\u8f7d\u5668]\n        B --&gt; C[\u6587\u6863\u5206\u5272\u5668]\n        C --&gt;|\u6587\u672c\u5757| D[\u5d4c\u5165\u6a21\u578b]\n        D --&gt;|\u5411\u91cf| E[\u5411\u91cf\u6570\u636e\u5e93]\n    end\n    subgraph \u5728\u7ebf\u68c0\u7d22\u4e0e\u751f\u6210\n        F[\u7528\u6237\u95ee\u9898] --&gt; G[\u5d4c\u5165\u6a21\u578b]\n        G --&gt;|\u67e5\u8be2\u5411\u91cf| H[\u5411\u91cf\u6570\u636e\u5e93]\n        H --&gt;|\u76f8\u4f3c\u6587\u672c\u5757| I[\u68c0\u7d22\u5668]\n        I --&gt; J[\u4e0a\u4e0b\u6587\u6587\u672c\u5757]\n        J --&gt; K[\u63d0\u793a\u5de5\u7a0b\uff1a\u7ec4\u88c5\u67e5\u8be2\u548c\u4e0a\u4e0b\u6587]\n        K --&gt; L[\u5927\u8bed\u8a00\u6a21\u578b]\n        L --&gt; M[\u751f\u6210\u7b54\u6848]\n    end\n\n    style A fill:#f9f,stroke:#333\n    style F fill:#f9f,stroke:#333\n    style M fill:#8f8,stroke:#333</code></pre>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#_2","title":"\u8be6\u7ec6\u6b65\u9aa4\u8bf4\u660e\u56fe","text":"<p>\u6211\u4eec\u53ef\u4ee5\u5c06\u4e0a\u8ff0\u6d41\u7a0b\u56fe\u5408\u5e76\uff1a <pre><code>graph TD\n    A[\u5f00\u59cb] --&gt; B[\u6587\u6863\u52a0\u8f7d]\n    B --&gt; C[\u6587\u672c\u5206\u5757]\n    C --&gt; D[\u5d4c\u5165\u751f\u6210]\n    D --&gt; E[\u5411\u91cf\u5b58\u50a8]\n    E --&gt; F[\u5411\u91cf\u6570\u636e\u5e93]\n    G[\u7528\u6237\u67e5\u8be2] --&gt; H[\u67e5\u8be2\u5d4c\u5165]\n    H --&gt; I[\u76f8\u4f3c\u6027\u641c\u7d22]\n    I --&gt; F\n    F --&gt; J[\u68c0\u7d22\u76f8\u5173\u6587\u672c\u5757]\n    J --&gt; K[\u7ec4\u88c5\u4e0a\u4e0b\u6587]\n    K --&gt; L[LLM\u751f\u6210\u7b54\u6848]\n    L --&gt; M[\u8fd4\u56de\u7b54\u6848]\n\n    style A fill:#f9f,stroke:#333\n    style G fill:#f9f,stroke:#333\n    style M fill:#8f8,stroke:#333\n</code></pre> \u5173\u952e\u6570\u636e\u6d41\uff1a <pre><code>graph TD\n    Documents --&gt; Chunks\n    Chunks --&gt; Embeddings\n    Embeddings --&gt; VectorDB\n    Query --&gt; QueryEmbedding\n    QueryEmbedding --&gt; VectorDB\n    VectorDB --&gt; Context\n    Context[Context+Query] --&gt; LLM\n    LLM --&gt; Answer</code></pre></p>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#_3","title":"\u56de\u987e\u5386\u53f2\u6587\u7ae0","text":"<p>\u524d\u9762\u51e0\u7bc7\u6587\u7ae0\u5bf9\u5e94RAG\u7d22\u5f15\u6784\u5efa\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ul> <li>\u6587\u6863\u52a0\u8f7d\u5668\uff1a\u652f\u6301\u591a\u79cd\u683c\u5f0f\uff08PDF\u3001TXT\u3001HTML\u7b49\uff09</li> <li> <p>docling\u7ed3\u5408OCR\u5b9e\u73b0pdf\u8f6cmarkdown</p> </li> <li> <p>\u6587\u6863\u5206\u5272\u5668\uff1a\u6309\u56fa\u5b9a\u957f\u5ea6\u5206\u5757\uff0c\u53ef\u91cd\u53e0</p> </li> <li> <p>chunk\u5206\u5757\u5b9e\u8df5</p> </li> <li> <p>\u5d4c\u5165\u6a21\u578b\uff1a\u5982text-embedding-ada-002, all-MiniLM-L6-v2</p> </li> <li> <p>todo</p> </li> <li> <p>\u5411\u91cf\u6570\u636e\u5e93\uff1a\u5982FAISS, Chroma, Pinecone</p> </li> <li> <p>todo</p> </li> <li> <p>\u68c0\u7d22\u5668\uff1a\u6267\u884c\u76f8\u4f3c\u6027\u641c\u7d22\uff08\u5982\u4f59\u5f26\u76f8\u4f3c\u5ea6\uff09</p> </li> <li> <p>todo</p> </li> <li> <p>\u5927\u8bed\u8a00\u6a21\u578b\uff1a\u5982GPT-4, LLaMA\u7b49</p> </li> <li> <p>todo</p> </li> <li> <p>\u63d0\u793a\u5de5\u7a0b\uff1a\u7ec4\u88c5\u67e5\u8be2\u548c\u4e0a\u4e0b\u6587</p> </li> <li>todo</li> </ul>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#_4","title":"\u5982\u4f55\u9009\u62e9\u5411\u91cf\u6570\u636e\u5e93","text":""},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#_5","title":"\u5e38\u89c1\u7684\u5411\u91cf\u6570\u636e\u5e93","text":"<ol> <li>FAISS\uff08Facebook AI Similarity Search\uff09</li> <li>\u7279\u70b9\uff1a\u5feb\u901f\u3001\u9ad8\u6548\u7684\u76f8\u4f3c\u6027\u641c\u7d22\uff0c\u652f\u6301\u591a\u79cd\u8ddd\u79bb\u5ea6\u91cf\uff08\u5982L2\u3001\u5185\u79ef\u7b49\uff09\u3002</li> <li>\u4f7f\u7528\u573a\u666f\uff1a\u5927\u89c4\u6a21\u6570\u636e\u96c6\uff0c\u9700\u8981\u9ad8\u6027\u80fd\u68c0\u7d22\u3002</li> <li>ChromaDB</li> <li>\u7279\u70b9\uff1a\u5f00\u6e90\u3001\u6613\u4e8e\u4f7f\u7528\u7684\u5411\u91cf\u6570\u636e\u5e93\uff0c\u652f\u6301\u6301\u4e45\u5316\u5b58\u50a8\u3002</li> <li>\u4f7f\u7528\u573a\u666f\uff1a\u5c0f\u578b\u5230\u4e2d\u578b\u9879\u76ee\uff0c\u9700\u8981\u7b80\u5355\u7684\u5411\u91cf\u5b58\u50a8\u89e3\u51b3\u65b9\u6848\u3002</li> <li>Pinecone</li> <li>\u7279\u70b9\uff1a\u4e91\u670d\u52a1\uff0c\u63d0\u4f9b\u9ad8\u53ef\u7528\u7684\u5411\u91cf\u6570\u636e\u5e93\uff0c\u652f\u6301\u81ea\u52a8\u6269\u5c55\u3002</li> <li>\u4f7f\u7528\u573a\u666f\uff1a\u9700\u8981\u9ad8\u53ef\u9760\u6027\u548c\u53ef\u6269\u5c55\u6027\u7684\u751f\u4ea7\u73af\u5883\u3002</li> <li>Milvus</li> <li>\u7279\u70b9\uff1a\u5f00\u6e90\u3001\u5206\u5e03\u5f0f\u7684\u5411\u91cf\u641c\u7d22\u5f15\u64ce\uff0c\u652f\u6301\u5927\u89c4\u6a21\u6570\u636e\u5904\u7406\u3002</li> <li>\u4f7f\u7528\u573a\u666f\uff1a\u5927\u578b\u4f01\u4e1a\u7ea7\u5e94\u7528\uff0c\u9700\u8981\u9ad8\u5ea6\u5b9a\u5236\u5316\u7684\u5411\u91cf\u68c0\u7d22\u80fd\u529b\u3002</li> <li>Redis</li> <li>\u7279\u70b9\uff1a\u5185\u5b58\u6570\u636e\u5e93\uff0c\u652f\u6301\u5411\u91cf\u64cd\u4f5c\uff0c\u9002\u7528\u4e8e\u5b9e\u65f6\u5e94\u7528\u3002</li> <li>\u4f7f\u7528\u573a\u666f\uff1a\u9700\u8981\u4f4e\u5ef6\u8fdf\u54cd\u5e94\u7684\u5b9e\u65f6\u7cfb\u7edf\u3002</li> </ol>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#_6","title":"\u5411\u91cf\u6570\u636e\u5e93\u9009\u578b","text":"<pre><code>flowchart TD\n    A[\u5411\u91cf\u6570\u636e\u5e93\u9009\u578b] --&gt; B[\u6570\u636e\u89c4\u6a21]\n    A --&gt; C[\u5b9e\u65f6\u6027\u8981\u6c42]\n    A --&gt; D[\u8fd0\u7ef4\u590d\u6742\u5ea6]\n    A --&gt; E[\u529f\u80fd\u6269\u5c55]\n    B --&gt;|\u5c0f\u578b\u6570\u636e\u96c6 &lt;1M| B1[\u8f7b\u91cf\u7ea7: FAISS/Chroma]\n    B --&gt;|\u4e2d\u578b 1M-100M| B2[\u751f\u4ea7\u7ea7: Weaviate/Qdrant]\n    B --&gt;|\u8d85\u5927\u89c4\u6a21 &gt;100M| B3[\u5206\u5e03\u5f0f: Milvus/Pinecone]\n    C --&gt;|\u4f4e\u5ef6\u8fdf&lt;50ms| C1[\u5185\u5b58\u7d22\u5f15: Redis]\n    C --&gt;|\u53ef\u5bb9\u5fcd&gt;100ms| C2[\u78c1\u76d8\u4f18\u5316: Elasticsearch]\n    D --&gt;|\u65e0\u4e13\u4e1a\u8fd0\u7ef4| D1[\u5168\u6258\u7ba1: Pinecone]\n    D --&gt;|\u6709K8s\u56e2\u961f| D2[\u81ea\u6258\u7ba1: Milvus]\n    E --&gt;|\u9700\u8981\u8fc7\u6ee4| E1[\u5143\u6570\u636e\u5f15\u64ce: Weaviate]\n    E --&gt;|\u9700\u8981\u805a\u5408| E2[\u6df7\u5408\u641c\u7d22: Elasticsearch]</code></pre> <p>\u6ce8\u610f\u26a0\ufe0f\uff1a\u5982\u679c\u5df2\u7ecf\u6709\u90e8\u7f72\u597d\u7684\u5411\u91cf\u6570\u636e\u5e93\uff0c\u90a3\u4e48\u76f4\u63a5\u4f7f\u7528\u90e8\u7f72\u597d\u7684\u5411\u91cf\u6570\u636e\u5e93\u5373\u53ef\u3002</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#_7","title":"\u5982\u4f55\u9009\u62e9\u5d4c\u5165\u6a21\u578b","text":"<p>\u60f3\u8981\u505a\u8bed\u4e49\u68c0\u7d22\uff0c\u8feb\u5207\u9700\u8981embedding\u6a21\u578b\u6765\u505a\u6587\u672c\u7684\u5d4c\u5165\uff0c\u4e5f\u5c31\u662f\u8f6c\u5411\u91cf\u3002 huggingface\u4e0a\u90a3\u4e48\u591atext embedding\u6a21\u578b\uff0c\u5230\u5e95\u5e94\u8be5\u9009\u62e9\u4ec0\u4e48\u6a21\u578b\u6548\u679c\u66f4\u597d\u5462\uff1f\u6709\u6761\u4ef6\u7684\u53ef\u4ee5\u81ea\u5df1\u6d4b\u8bd5\uff0c\u5982\u679c\u4e0d\u5177\u5907\u8fd9\u4e2a\u80fd\u529b\uff0c\u53ef\u4ee5\u770b\u770bMTEB\uff08Massive Text Embeddings Benchmark\uff09\u8fd9\u4e2a\u6392\u884c\u699c\uff01\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u573a\u666f\uff0c\u81ea\u5df1\u7684\u8d44\u6e90\uff0c\u81ea\u5df1\u7684\u8bed\u8a00\u9700\u6c42\u6765\u9009\u62e9\u5408\u9002\u7684\u6a21\u578b\uff0c\u518d\u53bb\u505a\u6d4b\u8bd5\uff0c\u770b\u770b\u662f\u5426\u80fd\u591f\u6ee1\u8db3\u3002</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#mteb","title":"\u4e00\u3001MTEB \u662f\u4ec0\u4e48\uff1f","text":"<ul> <li>github : https://github.com/embeddings-benchmark/mteb</li> <li>huggingface : https://huggingface.co/spaces/mteb/leaderboard</li> <li>paper : https://paperswithcode.com/paper/mteb-massive-text-embedding-benchmark</li> </ul> <p>MTEB\uff08Massive Text Embeddings Benchmark\uff09 \u662f\u7531 Hugging Face \u56e2\u961f\u63a8\u51fa\u7684 \u5d4c\u5165\u6a21\u578b\u8bc4\u4f30\u6807\u51c6\uff0c\u65e8\u5728\u89e3\u51b3\u4f20\u7edf\u8bc4\u4f30\u4e2d\u5b58\u5728\u7684\u4e09\u5927\u95ee\u9898\uff1a 1. \u788e\u7247\u5316\uff1a\u6b64\u524d\u6a21\u578b\u5728\u4e0d\u540c\u8bba\u6587\u4e2d\u4f7f\u7528\u79c1\u6709\u6570\u636e\u96c6\u8bc4\u4f30\uff0c\u7ed3\u679c\u4e0d\u53ef\u6bd4 2. \u7247\u9762\u6027\uff1a\u4ec5\u6d4b\u8bd5\u68c0\u7d22\uff08Retrieval\uff09\u6216\u805a\u7c7b\uff08Clustering\uff09\u7b49\u5355\u4e00\u4efb\u52a1 3. \u89c4\u6a21\u4e0d\u8db3\uff1a\u5c0f\u6570\u636e\u96c6\u65e0\u6cd5\u53cd\u6620\u6a21\u578b\u5728\u771f\u5b9e\u6d77\u91cf\u6570\u636e\u4e0b\u7684\u8868\u73b0</p> <p>MTEB \u6574\u5408 8 \u7c7b\u4efb\u52a1\u300156 \u4e2a\u6570\u636e\u96c6\u3001\u6db5\u76d6 200+ \u8bed\u8a00\uff0c\u6210\u4e3a\u4e1a\u754c\u516c\u8ba4\u7684\u5d4c\u5165\u6a21\u578b\"\u9ec4\u91d1\u6807\u51c6\"\u3002</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#_8","title":"\u4e8c\u3001\u6838\u5fc3\u8bc4\u4f30\u6846\u67b6","text":""},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#_9","title":"\u516b\u5927\u4efb\u52a1\u7c7b\u578b","text":"\u4efb\u52a1\u7c7b\u522b \u4ee3\u8868\u6570\u636e\u96c6 \u8bc4\u4f30\u76ee\u6807 RAG\u76f8\u5173\u6027 \u68c0\u7d22 (Retrieval) MS MARCO, NQ \u67e5\u8be2-\u6587\u6863\u5339\u914d\u7cbe\u5ea6 \u2605\u2605\u2605\u2605\u2605 \u805a\u7c7b (Clustering) TwentyNewsgroups \u65e0\u76d1\u7763\u5206\u7ec4\u80fd\u529b \u2605\u2606\u2606\u2606\u2606 \u5206\u7c7b (Classification) AmazonCounterfactual \u60c5\u611f/\u4e3b\u9898\u5206\u7c7b \u2605\u2605\u2606\u2606\u2606 \u914d\u5bf9\u5206\u7c7b (Pair Classification) QQP \u53e5\u5b50\u5bf9\u76f8\u4f3c\u5ea6\u5224\u65ad \u2605\u2605\u2605\u2606\u2606 \u91cd\u6392\u5e8f (Reranking) StackExchange \u641c\u7d22\u7ed3\u679c\u4f18\u5316\u80fd\u529b \u2605\u2605\u2605\u2605\u2606 \u8bed\u4e49\u76f8\u4f3c\u5ea6 (Semantic Textual Similarity(STS)) STSBenchmark \u53e5\u5b50\u8bed\u4e49\u76f8\u4f3c\u5ea6\u8bc4\u5206 \u2605\u2605\u2605\u2605\u2606 \u6458\u8981\u76f8\u4f3c\u5ea6 (Summarization) SummEval \u6458\u8981\u4e0e\u539f\u6587\u76f8\u5173\u6027 \u2605\u2605\u2606\u2606\u2606 \u6bd4\u7279\u6587\u672c\u5339\u914d (Bitext Mining) Tatoeba \u8de8\u8bed\u8a00\u5bf9\u9f50\u80fd\u529b \u2605\u2605\u2606\u2606\u2606 <p>RAG \u91cd\u70b9\u5173\u6ce8\uff1a <code>\u68c0\u7d22\u4efb\u52a1</code>\uff08\u5360\u6bd435%\u6743\u91cd\uff09 + <code>\u91cd\u6392\u5e8f\u4efb\u52a1</code>\uff08\u5360\u6bd420%\u6743\u91cd\uff09</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#_10","title":"\u5173\u952e\u6307\u6807","text":"<ul> <li>\u68c0\u7d22\u4efb\u52a1\uff1a<code>Recall@k</code>\uff08\u524dk\u4e2a\u7ed3\u679c\u7684\u53ec\u56de\u7387\uff09\u3001<code>MAP</code>\uff08\u5e73\u5747\u7cbe\u5ea6\u5747\u503c\uff09</li> <li>\u8bed\u4e49\u76f8\u4f3c\u5ea6\uff1a<code>Spearman \u76f8\u5173\u7cfb\u6570</code>\uff08\u9884\u6d4b\u5206\u4e0e\u4eba\u5de5\u6807\u6ce8\u7684\u76f8\u5173\u6027\uff09</li> <li>\u6574\u4f53\u8bc4\u5206\uff1a\u5e73\u5747\u6807\u51c6\u5316\u5f97\u5206\uff08\u6240\u6709\u4efb\u52a1\u5f97\u5206\u7684\u5f52\u4e00\u5316\u5e73\u5747\u503c\uff09</li> </ul>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#mteb_1","title":"\u4e09\u3001MTEB \u6392\u884c\u699c\u89e3\u8bfb","text":""},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#2025-top-5","title":"\u6700\u65b0\u699c\u5355 (2025) Top 5 \u6a21\u578b","text":"<p>\u8bbf\u95ee\u5b9e\u65f6\u699c\u5355\uff1a MTEB Leaderboard</p> Rank (Borda) Model Zero-shot Memory Usage (MB) Number of Parameters Embedding Dimensions Max Tokens Mean (Task) Mean (TaskType) Bitext Mining Classification Clustering Instruction Retrieval Multilabel Classification Pair Classification Reranking Retrieval STS 1 gemini-embedding-001 99% Unknown Unknown 3072 2048 68.37 59.59 79.28 71.82 54.59 5.18 29.16 83.63 65.58 67.71 79.4 2 Qwen3-Embedding-8B 99% 28866 7B 4096 32768 70.58 61.69 80.89 74 57.65 10.06 28.66 86.4 65.63 70.88 81.08 3 Qwen3-Embedding-4B 99% 15341 4B 2560 32768 69.45 60.86 79.36 72.33 57.15 11.56 26.77 85.05 65.08 69.6 80.86 4 Qwen3-Embedding-0.6B 99% 2272 595M 1024 32768 64.34 56.01 72.23 66.83 52.33 5.09 24.59 80.83 61.41 64.65 76.17 5 Linq-Embed-Mistral 99% 13563 7B 4096 32768 61.47 54.14 70.34 62.24 50.6 0.94 24.77 80.43 64.37 58.69 74.86"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#_11","title":"\u6839\u636e\u699c\u5355\u9009\u62e9\u6a21\u578b","text":"<p>\u4eceMTEB\u6392\u884c\u699c\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u89c2\u5bdf\u5230\u4e0d\u540c\u6a21\u578b\u5728\u591a\u4e2a\u4efb\u52a1\u4e0a\u7684\u8868\u73b0\uff0c\u4f46RAG\u6700\u5173\u5fc3\u7684\u662f\u68c0\u7d22\uff08Retrieval\uff09\u548c\u91cd\u6392\u5e8f\uff08Reranking\uff09\u4efb\u52a1\u7684\u6027\u80fd\uff08\u53ef\u80fd\u8fd8\u6709STS\uff08\u8bed\u4e49\u6587\u672c\u76f8\u4f3c\u5ea6\uff09\uff0c\u56e0\u4e3a\u5b83\u53cd\u6620\u4e86\u6a21\u578b\u5bf9\u8bed\u4e49\u76f8\u4f3c\u6027\u7684\u7406\u89e3\u80fd\u529b\uff09\u3002</p> <p>\u6839\u636e\u63d0\u4f9b\u76842025\u5e74MTEB\u6392\u884c\u699c\uff08\u6ce8\u610f\uff1a\u5f53\u524d\u662f2025\u5e746\u6708\uff09\uff0c\u6211\u4eec\u5206\u6790Top5\u6a21\u578b\u5728RAG\u76f8\u5173\u4efb\u52a1\u7684\u8868\u73b0\uff1a 1. gemini-embedding-001\uff1a    - Retrieval: 67.71    - Reranking: 65.58    - STS: 79.4 2. Qwen3-Embedding-8B\uff1a    - Retrieval: 70.88 (Top1)    - Reranking: 65.63    - STS: 81.08 (Top1) 3. Qwen3-Embedding-4B\uff1a    - Retrieval: 69.6    - Reranking: 65.08    - STS: 80.86 4. Qwen3-Embedding-0.6B\uff1a    - Retrieval: 64.65    - Reranking: 61.41    - STS: 76.17 5. Linq-Embed-Mistral\uff1a    - Retrieval: 58.69    - Reranking: 64.37    - STS: 74.86</p> <p>\u4ece\u68c0\u7d22\u4efb\u52a1\uff08Retrieval\uff09\u6765\u770b\uff0cQwen3-Embedding-8B\u4ee570.88\u5206\u6392\u540d\u7b2c\u4e00\uff0c\u5176\u6b21\u662fQwen3-Embedding-4B\uff0869.6\uff09\u548cgemini-embedding-001\uff0867.71\uff09\u3002\u5728STS\u4efb\u52a1\u4e0a\uff0cQwen3\u7cfb\u5217\u540c\u6837\u9886\u5148\u3002</p> <p>\u7136\u800c\uff0c\u9009\u62e9\u6a21\u578b\u4e0d\u80fd\u4ec5\u770b\u5206\u6570\uff0c\u8fd8\u9700\u8981\u8003\u8651\uff1a  - \u6a21\u578b\u5927\u5c0f\u548c\u63a8\u7406\u6210\u672c\uff1aQwen3-Embedding-8B\u662f\u4e00\u4e2a8B\u53c2\u6570\u7684\u5927\u6a21\u578b\uff0c\u9700\u8981\u8f83\u9ad8\u7684\u8ba1\u7b97\u8d44\u6e90\uff08\u5185\u5b5828.8GB\uff09\uff0c\u800cgemini-embedding-001\u867d\u7136\u53c2\u6570\u672a\u77e5\uff0c\u4f46\u4f5c\u4e3aGoogle\u7684API\u670d\u52a1\uff0c\u53ef\u80fd\u6309\u8c03\u7528\u6536\u8d39\u3002  - \u4e0a\u4e0b\u6587\u957f\u5ea6\uff1aQwen3\u7cfb\u5217\u652f\u6301\u957f\u8fbe32768 tokens\u7684\u4e0a\u4e0b\u6587\uff0c\u8fd9\u5bf9\u4e8e\u9700\u8981\u5904\u7406\u957f\u6587\u6863\u7684RAG\u5e94\u7528\u975e\u5e38\u6709\u5229\u3002  - \u90e8\u7f72\u65b9\u5f0f\uff1agemini-embedding-001\u662f\u95ed\u6e90API\uff0c\u800cQwen3\u662f\u5f00\u6e90\u6a21\u578b\uff0c\u53ef\u4ee5\u81ea\u884c\u90e8\u7f72\u3002</p> <p>\u6839\u636eRAG\u5e94\u7528\u573a\u666f\uff0c\u5efa\u8bae\u5982\u4e0b\uff1a</p> <ol> <li>\u5982\u679c\u8ffd\u6c42\u6700\u9ad8\u68c0\u7d22\u6027\u80fd\u4e14\u5177\u5907\u8db3\u591f\u8ba1\u7b97\u8d44\u6e90\uff1a<ul> <li>\u9009\u62e9 Qwen3-Embedding-8B\uff08\u68c0\u7d2270.88\u5206\uff0cSTS81.08\u5206\uff0c\u652f\u630132K\u4e0a\u4e0b\u6587\uff09\u3002</li> <li>\u6ce8\u610f\uff1a\u9700\u8981\u7ea628.8GB\u5185\u5b58\uff0c\u9002\u5408\u6709GPU\u670d\u52a1\u5668\u7684\u573a\u666f\u3002</li> </ul> </li> <li>\u5982\u679c\u9700\u8981\u5728\u6027\u80fd\u548c\u8d44\u6e90\u4e4b\u95f4\u5e73\u8861\uff1a<ul> <li>\u9009\u62e9 Qwen3-Embedding-4B\uff08\u68c0\u7d2269.6\u5206\uff0cSTS80.86\u5206\uff0c\u540c\u6837\u652f\u630132K\u4e0a\u4e0b\u6587\uff09\uff0c\u5185\u5b58\u9700\u6c42\u51cf\u534a\uff08\u7ea615.3GB\uff09\u3002</li> </ul> </li> <li>\u5982\u679c\u8d44\u6e90\u53d7\u9650\u6216\u9700\u8981\u8f7b\u91cf\u7ea7\u6a21\u578b\uff1a<ul> <li>\u8003\u8651 Qwen3-Embedding-0.6B\uff08600M\u53c2\u6570\uff0c\u5185\u5b582.2GB\uff09\uff0c\u68c0\u7d22\u5206\u657064.65\uff0c\u867d\u7136\u6bd4\u524d\u4e24\u4e2a\u4f4e\uff0c\u4f46\u8fdc\u9ad8\u4e8e\u5176\u4ed6\u8f7b\u91cf\u7ea7\u6a21\u578b\u3002</li> </ul> </li> <li>\u5982\u679c\u4e0d\u60f3\u7ba1\u7406\u57fa\u7840\u8bbe\u65bd\u4e14\u53ef\u63a5\u53d7API\u8c03\u7528\uff1a<ul> <li>\u9009\u62e9 gemini-embedding-001\uff08\u68c0\u7d2267.71\uff0cSTS79.4\uff09\uff0c\u4f46\u6ce8\u610f\u5176\u6700\u5927\u4e0a\u4e0b\u6587\u957f\u5ea6\u4e3a2048 tokens\uff0c\u53ef\u80fd\u4e0d\u9002\u5408\u957f\u6587\u6863\u3002</li> </ul> </li> <li>Linq-Embed-Mistral\u5728\u68c0\u7d22\u4efb\u52a1\u4e0a\u8868\u73b0\u8f83\u5dee\uff0858.69\uff09\uff0c\u4e0d\u5efa\u8bae\u7528\u4e8eRAG\u3002</li> </ol> <p>\u6b64\u5916\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u6ce8\u610f\uff1a</p> <ul> <li>\u591a\u8bed\u8a00\u652f\u6301\uff1a\u5982\u679c\u5e94\u7528\u6d89\u53ca\u591a\u8bed\u8a00\uff0c\u9700\u8981\u989d\u5916\u68c0\u67e5\u6a21\u578b\u7684\u591a\u8bed\u8a00\u80fd\u529b\uff08\u8868\u4e2d\u672a\u76f4\u63a5\u7ed9\u51fa\uff0c\u4f46Qwen\u7cfb\u5217\u901a\u5e38\u652f\u6301\u4e2d\u82f1\u53cc\u8bed\uff0cgemini\u4e5f\u652f\u6301\u591a\u8bed\u8a00\uff09\u3002</li> <li>\u6307\u4ee4\u4f18\u5316\uff1aQwen3-Embedding\u7cfb\u5217\u652f\u6301\u6307\u4ee4\u4f18\u5316\uff08\u5982\u4e3a\u67e5\u8be2\u548c\u6587\u6863\u5206\u522b\u6dfb\u52a0\u6307\u4ee4\u524d\u7f00\uff09\uff0c\u8fd9\u53ef\u4ee5\u8fdb\u4e00\u6b65\u63d0\u5347\u68c0\u7d22\u6548\u679c\u3002</li> </ul> <p>\u603b\u7ed3\u9009\u62e9\u7b56\u7565\uff1a  | \u573a\u666f                     | \u63a8\u8350\u6a21\u578b               | \u7406\u7531                                                                 |  |--------------------------|------------------------|----------------------------------------------------------------------|  | \u6700\u9ad8\u6027\u80fd\uff0c\u8d44\u6e90\u5145\u8db3        | Qwen3-Embedding-8B    | \u68c0\u7d22\u548cSTS\u53cc\u7b2c\u4e00\uff0c\u957f\u4e0a\u4e0b\u6587\u652f\u6301                                        |  | \u5e73\u8861\u6027\u80fd\u4e0e\u8d44\u6e90            | Qwen3-Embedding-4B    | \u6027\u80fd\u63a5\u8fd18B\uff0c\u5185\u5b58\u9700\u6c42\u51cf\u534a                                             |  | \u8f7b\u91cf\u7ea7/\u8fb9\u7f18\u90e8\u7f72           | Qwen3-Embedding-0.6B  | \u6700\u4f4e\u8d44\u6e90\u9700\u6c42\uff0c\u6027\u80fd\u4ecd\u8d85\u8fc7\u5176\u4ed6\u5c0f\u6a21\u578b                                   |  | \u65e0\u8fd0\u7ef4\u504f\u597dAPI\u670d\u52a1         | gemini-embedding-001  | \u514d\u8fd0\u7ef4\uff0c\u4f46\u6ce8\u610f\u4e0a\u4e0b\u6587\u9650\u5236\u548cAPI\u6210\u672c                                    |  | \u591a\u8bed\u8a00\u9700\u6c42\uff08\u4e2d\u82f1\u5916\uff09       | \u9700\u989d\u5916\u67e5\u8bc1\uff0cgemini\u53ef\u80fd\u8986\u76d6\u66f4\u5e7f | </p> <p>\u6700\u540e\uff0c\u5728\u5b9e\u9645\u90e8\u7f72\u524d\uff0c\u52a1\u5fc5\u4f7f\u7528\u81ea\u5df1\u7684\u4e1a\u52a1\u6570\u636e\u6d4b\u8bd5\u53ec\u56de\u7387\uff08Recall@k\uff09\u548c\u54cd\u5e94\u5ef6\u8fdf\uff0c\u56e0\u4e3aMTEB\u5206\u6570\u867d\u5177\u53c2\u8003\u6027\uff0c\u4f46\u5b9e\u9645\u6548\u679c\u53ef\u80fd\u56e0\u6570\u636e\u5206\u5e03\u800c\u5f02\u3002</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#_12","title":"\u6784\u5efa\u5411\u91cf\u6570\u636e\u5e93\u7d22\u5f15\u5206\u6790","text":"<p>\u6839\u636e\u524d\u9762\u7684\u5206\u6790\uff0c\u6211\u4eec\u77e5\u9053\u4e86\u5982\u4f55\u9009\u62e9\u5411\u91cf\u6570\u636e\u5e93\u548c\u5982\u4f55\u9009\u62e9\u5d4c\u5165\u6a21\u578b\uff0c\u4e0b\u9762\u6211\u4eec\u9009\u62e9\u4e00\u4e2a\u5411\u91cf\u6570\u636e\u5e93\u548c\u4e00\u4e2a\u5d4c\u5165\u6a21\u578b\u6765\u8fdb\u884c\u4ee3\u7801\u5b9e\u8df5\u3002</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#_13","title":"\u9009\u62e9\u5411\u91cf\u6570\u636e\u5e93","text":"<p>\u6211\u4eec\u9009\u62e9\u4f7f\u7528Redis\u4f5c\u4e3a\u5411\u91cf\u6570\u636e\u5e93\uff0c\u56e0\u4e3a\u516c\u53f8\u5df2\u7ecf\u6709\u4e86Redis\u7684\u57fa\u7840\u8bbe\u65bd\uff0c\u800c\u4e14Redis\u652f\u6301\u5411\u91cf\u68c0\u7d22\uff0c\u4e14\u6027\u80fd\u826f\u597d\u3002</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#_14","title":"\u9009\u62e9\u5d4c\u5165\u6a21\u578b","text":"<p>\u6211\u4eec\u9009\u62e9\u4f7f\u7528Qwen3-Embedding-8B\u4f5c\u4e3a\u5d4c\u5165\u6a21\u578b\uff0c\u56e0\u4e3a\u5b83\u5728RAG\u5e94\u7528\u4e2d\u8868\u73b0\u4f18\u5f02\uff0c\u4e14\u53c2\u6570\u8f83\u591a\uff0c\u9002\u5408\u5904\u7406\u957f\u6587\u6863\uff0c\u5e76\u4e14\u5df2\u7ecf\u90e8\u7f72\u5728\u751f\u4ea7\u73af\u5883\u4e0a\uff0c\u63d0\u4f9b\u4e86openai\u517c\u5bb9\u7684\u63a5\u53e3\uff0c\u65b9\u4fbf\u6211\u4eec\u8c03\u7528\u3002\u5982\u679c\u5185\u90e8\u6ca1\u6709\u90e8\u7f72\uff0c\u53ef\u4ee5\u8003\u8651\u672c\u5730\u90e8\u7f72\u6216\u8005\u4f7f\u7528API\u670d\u52a1\u3002</p> <p>\u56e0\u4e3a\u6211\u4eec\u7684\u9879\u76ee\u6253\u7b97\u4f7f\u7528langchain \u5e76\u4e14\u9009\u62e9\u4f7f\u7528Redis\u4f5c\u4e3a\u5411\u91cf\u6570\u636e\u5e93\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528<code>langchain_redis.RedisVectorStore</code></p> <p>langchain_redis\u4f7f\u7528\u6587\u6863\uff1ahttps://github.com/langchain-ai/langchain-redis</p> <p>\u5728\u5c06chunk\u5199\u5165redis\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5c06chunk\u8f6c\u6362\u4e3a\u5411\u91cf\uff0c\u56e0\u4e3a\u6211\u4eec\u4f7f\u7528\u7684\u5d4c\u5165\u6a21\u578b\u670d\u52a1\u662f\u652f\u6301openai\u517c\u5bb9\u7684\u63a5\u53e3\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528<code>litellm</code>\u6765\u5c01\u88c5\u670d\u52a1\u63a5\u53e3\u3002</p> <p>litellm\u4f7f\u7528\u6587\u6863\uff1ahttps://docs.litellm.ai/docs/</p> <p>\u6211\u4eec\u4f7f\u7528LangChain\u548cRedisVectorStore\uff0c\u7ed3\u5408\u901a\u8fc7LiteLLM\u5c01\u88c5\u7684OpenAI\u517c\u5bb9\u7684\u5d4c\u5165\u670d\u52a1\u3002\u4ee5\u4e0b\u662f\u5b9e\u73b0\u6b65\u9aa4\uff1a 1. \u5b89\u88c5\u5fc5\u8981\u7684\u5e93\uff1a    <pre><code>pip install langchain langchain-redis redis litellm\n</code></pre> 2. \u4f7f\u7528LiteLLM\u5c01\u88c5\u5d4c\u5165\u670d\u52a1\uff1a    LiteLLM\u5141\u8bb8\u6211\u4eec\u5c06\u5404\u79cd\u5d4c\u5165\u6a21\u578b\u670d\u52a1\u7edf\u4e00\u5230OpenAI\u7684API\u683c\u5f0f\u3002\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a\u5d4c\u5165\u6a21\u578b\u670d\u52a1\uff08\u6bd4\u5982Hugging Face\u4e0a\u7684\u4e00\u4e2a\u6a21\u578b\uff0c\u6216\u8005\u81ea\u5df1\u90e8\u7f72\u7684\u6a21\u578b\uff09\uff0c\u5176API\u4e0eOpenAI\u4e0d\u517c\u5bb9\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7LiteLLM\u8fdb\u884c\u5c01\u88c5\u3002    \u5728\u4ee3\u7801\u4e2d\uff0c\u6211\u4eec\u5c06\u521b\u5efa\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684\u5d4c\u5165\u7c7b\uff0c\u8be5\u7c7b\u4f7f\u7528LiteLLM\u6765\u751f\u6210\u5d4c\u5165\u5411\u91cf\u3002 3. \u4f7f\u7528LangChain\u7684RedisVectorStore\u5c06\u6587\u6863\u5757\uff08chunks\uff09\u5199\u5165Redis\u3002</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#1_1","title":"\u6b65\u9aa41\uff1a\u521b\u5efa\u81ea\u5b9a\u4e49\u5d4c\u5165\u7c7b","text":"<p>\u6211\u4eec\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u7c7b\uff0c\u7ee7\u627f\u81eaLangChain\u7684<code>Embeddings</code>\u57fa\u7c7b\uff0c\u5e76\u5b9e\u73b0<code>embed_documents</code>\u548c<code>embed_query</code>\u65b9\u6cd5\u3002\u5728\u8fd9\u4e9b\u65b9\u6cd5\u4e2d\uff0c\u6211\u4eec\u5c06\u8c03\u7528LiteLLM\u7684\u5d4c\u5165\u751f\u6210\u51fd\u6570\u3002</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#2redisvectorstore","title":"\u6b65\u9aa42\uff1a\u4f7f\u7528RedisVectorStore\u5b58\u50a8\u6587\u6863","text":"<p>\u6211\u4eec\u5c06\u4f7f\u7528<code>RedisVectorStore.from_documents</code>\u65b9\u6cd5\uff0c\u5c06\u6587\u6863\u5757\u548c\u5bf9\u5e94\u7684\u5d4c\u5165\u5411\u91cf\u5b58\u50a8\u5230Redis\u4e2d\u3002</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#_15","title":"\u4ee3\u7801\u5b9e\u73b0","text":""},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#litellm","title":"\u81ea\u5b9a\u4e49\u5d4c\u5165\u7c7b\uff08\u4f7f\u7528LiteLLM\uff09","text":"<pre><code>from langchain_core.embeddings import Embeddings\nfrom typing import List\nimport litellm\nclass LiteLLMEmbeddings(Embeddings):\n    def __init__(self, model: str, api_base: str = None, api_key: str = None):\n        self.model = model\n        self.api_base = api_base\n        self.api_key = api_key\n    def embed_documents(self, texts: List[str]) -&gt; List[List[float]]:\n        # \u4f7f\u7528litellm\u751f\u6210\u5d4c\u5165\u5411\u91cf\n        embeddings = litellm.embedding(\n            model=self.model,\n            input=texts,\n            api_base=self.api_base,\n            api_key=self.api_key\n        )\n        # \u8fd4\u56de\u5d4c\u5165\u5411\u91cf\u5217\u8868\n        return [item['embedding'] for item in embeddings.data]\n    def embed_query(self, text: str) -&gt; List[float]:\n        # \u5bf9\u5355\u4e2a\u67e5\u8be2\u8fdb\u884c\u5d4c\u5165\n        return self.embed_documents([text])[0]\n</code></pre>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#redis","title":"\u5c06\u6587\u6863\u5757\u5199\u5165Redis","text":"<p>\u5047\u8bbe\u6211\u4eec\u5df2\u7ecf\u6709\u4e86\u6587\u6863\u5757\uff08<code>documents</code>\uff0c\u662f<code>Document</code>\u5bf9\u8c61\u7684\u5217\u8868\uff09\u548cRedis\u8fde\u63a5URL\u3002 <pre><code>from langchain_redis.vectorstores import RedisVectorStore\nfrom langchain_redis.embeddings import LiteLLMEmbeddings\nfrom langchain.schema import Document\n# \u521d\u59cb\u5316\u5d4c\u5165\u6a21\u578b\nembedding = LiteLLMEmbeddings(\n    model=\"your_model_name\",  # \u4f8b\u5982 \"huggingface/microsoft/codebert-base\"\n    api_base=\"https://your-embedding-service.com/v1\",  # \u5d4c\u5165\u670d\u52a1\u7684URL\n    api_key=\"your_api_key\"  # \u5982\u679c\u9700\u8981\n)\n# Redis\u8fde\u63a5\u914d\u7f6e\nredis_url = \"redis://localhost:6379\"\nindex_name = \"knowledge_base\"\n# \u5c06\u6587\u6863\u5757\u5199\u5165Redis\nvectorstore = RedisVectorStore.from_documents(\n    documents=documents,  # \u6587\u6863\u5757\u5217\u8868\n    embedding=embedding,\n    index_name=index_name,\n    redis_url=redis_url,\n    # \u53ef\u9009\uff1a\u914d\u7f6e\u7d22\u5f15\u7ed3\u6784\n    # \u4f8b\u5982\uff1a\u8bbe\u7f6e\u5411\u91cf\u7ef4\u5ea6\uff0c\u5982\u679c\u5d4c\u5165\u6a21\u578b\u8f93\u51fa\u7684\u7ef4\u5ea6\u662f768\n    vector_size=768\n)\n</code></pre> \u6ce8\u610f\uff1a<code>vector_size</code>\u9700\u8981\u6839\u636e\u5d4c\u5165\u6a21\u578b\u8f93\u51fa\u7684\u7ef4\u5ea6\u8bbe\u7f6e\u3002\u5982\u679c\u4e0d\u786e\u5b9a\uff0c\u53ef\u4ee5\u5148\u8c03\u7528\u5d4c\u5165\u6a21\u578b\u83b7\u53d6\u4e00\u4e2a\u5411\u91cf\u7684\u7ef4\u5ea6\u3002</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#_16","title":"\u83b7\u53d6\u5411\u91cf\u7ef4\u5ea6\u7684\u65b9\u6cd5","text":"<p>\u5982\u679c\u4e0d\u77e5\u9053\u5d4c\u5165\u6a21\u578b\u7684\u8f93\u51fa\u7ef4\u5ea6\uff0c\u53ef\u4ee5\u8fd9\u6837\u83b7\u53d6\uff1a <pre><code># \u4f7f\u7528\u5d4c\u5165\u6a21\u578b\u5d4c\u5165\u4e00\u4e2a\u6587\u672c\nsample_embedding = embedding.embed_query(\"sample text\")\nvector_size = len(sample_embedding)\n</code></pre> \u7136\u540e\u5728<code>RedisVectorStore.from_documents</code>\u4e2d\u8bbe\u7f6e<code>vector_size=vector_size</code>\u3002</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#_17","title":"\u5b8c\u6574\u793a\u4f8b","text":"<p>\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e9b\u6587\u6863\u5757\uff1a <pre><code>documents = [\n    Document(page_content=\"LangChain is a framework for developing applications powered by language models.\", metadata={\"source\": \"intro\"}),\n    Document(page_content=\"Redis is an in-memory data store that can be used as a vector database.\", metadata={\"source\": \"redis\"}),\n    # ... \u66f4\u591a\u6587\u6863\n]\n</code></pre> \u7136\u540e\u4f7f\u7528\u4e0a\u8ff0\u4ee3\u7801\u5199\u5165Redis\u3002</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#_18","title":"\u6ce8\u610f\u4e8b\u9879","text":"<ol> <li>\u786e\u4fddRedis\u670d\u52a1\u6b63\u5728\u8fd0\u884c\uff0c\u5e76\u4e14\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9a\u7684URL\u8bbf\u95ee\u3002</li> <li>\u6839\u636e\u5d4c\u5165\u6a21\u578b\u7684\u8981\u6c42\uff0c\u53ef\u80fd\u9700\u8981\u8bbe\u7f6e<code>api_base</code>\u548c<code>api_key</code>\u3002\u5982\u679c\u5d4c\u5165\u6a21\u578b\u662f\u672c\u5730\u90e8\u7f72\u7684\uff0c<code>api_base</code>\u53ef\u80fd\u662f<code>http://localhost:8000</code>\u3002</li> <li>\u7d22\u5f15\u4e00\u65e6\u521b\u5efa\uff0c\u540e\u7eed\u53ef\u4ee5\u7ee7\u7eed\u6dfb\u52a0\u6587\u6863\u3002\u5982\u679c\u7d22\u5f15\u5df2\u5b58\u5728\uff0c<code>from_documents</code>\u4f1a\u5411\u73b0\u6709\u7d22\u5f15\u6dfb\u52a0\u6587\u6863\uff08\u786e\u4fdd\u7d22\u5f15\u7ed3\u6784\u4e00\u81f4\uff0c\u7279\u522b\u662f\u5411\u91cf\u7ef4\u5ea6\uff09\u3002</li> </ol>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#_19","title":"\u67e5\u8be2\u4f7f\u7528\u793a\u4f8b","text":"<p>\u5199\u5165\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u540c\u6837\u7684\u5d4c\u5165\u6a21\u578b\u8fdb\u884c\u67e5\u8be2\uff1a <pre><code># \u521d\u59cb\u5316\u5411\u91cf\u5e93\nvectorstore = RedisVectorStore(\n    redis_url=redis_url,\n    index_name=index_name,\n    embedding_function=embedding\n)\n# \u8fdb\u884c\u76f8\u4f3c\u5ea6\u641c\u7d22\nquery = \"What is LangChain?\"\nresults = vectorstore.similarity_search(query, k=3)\nprint(results)\n</code></pre> \u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u5b8c\u6210\u4e86\u4f7f\u7528LiteLLM\u5c01\u88c5\u7684\u5d4c\u5165\u670d\u52a1\u548cLangChain\u7684RedisVectorStore\u6765\u6784\u5efa\u5411\u91cf\u6570\u636e\u5e93\u7684\u6d41\u7a0b\u3002</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#_20","title":"\u5b8c\u6574\u4ee3\u7801\u5b9e\u73b0","text":"<pre><code>import os\nfrom langchain_community.document_loaders import TextLoader, PyPDFLoader\nfrom langchain_text_splitters import RecursiveCharacterTextSplitter\nfrom langchain_redis import RedisVectorStore\nfrom langchain_core.embeddings import Embeddings\nfrom typing import List\nimport litellm\n\n# \u914d\u7f6e\u73af\u5883\u53d8\u91cf (\u5b9e\u9645\u4f7f\u7528\u65f6\u5efa\u8bae\u4f7f\u7528.env\u6587\u4ef6)\nos.environ[\"LITELLM_MODEL\"] = \"your_embedding_model\"  # \u5982 \"azure/your-deployment-name\"\nos.environ[\"OPENAI_API_KEY\"] = \"your_api_key\"\nos.environ[\"OPENAI_API_BASE\"] = \"https://your-api-endpoint.com\"\n\n# 1. \u4f7f\u7528 LiteLLM \u5c01\u88c5\u5d4c\u5165\u670d\u52a1\nclass LiteLLMEmbeddings(Embeddings):\n    \"\"\"\u4f7f\u7528 LiteLLM \u5c01\u88c5\u7684 OpenAI \u517c\u5bb9\u5d4c\u5165\u670d\u52a1\"\"\"\n\n    def __init__(self, model: str = None):\n        self.model = model or os.getenv(\"LITELLM_MODEL\")\n\n    def embed_documents(self, texts: List[str]) -&gt; List[List[float]]:\n        \"\"\"\u5d4c\u5165\u6587\u6863\u5217\u8868\"\"\"\n        embeddings = litellm.embedding(\n            model=self.model,\n            input=texts\n        )\n        return [item['embedding'] for item in embeddings.data]\n\n    def embed_query(self, text: str) -&gt; List[float]:\n        \"\"\"\u5d4c\u5165\u67e5\u8be2\u6587\u672c\"\"\"\n        return self.embed_documents([text])[0]\n\n# 2. \u6587\u6863\u52a0\u8f7d\u4e0e\u5904\u7406\ndef load_and_split_documents(file_path: str, chunk_size=512, chunk_overlap=64):\n    \"\"\"\u52a0\u8f7d\u5e76\u5206\u5272\u6587\u6863\"\"\"\n    # \u6839\u636e\u6587\u4ef6\u7c7b\u578b\u9009\u62e9\u52a0\u8f7d\u5668\n    if file_path.endswith('.pdf'):\n        loader = PyPDFLoader(file_path)\n    else:  # \u652f\u6301 txt, html \u7b49\n        loader = TextLoader(file_path)\n\n    documents = loader.load()\n\n    # \u6587\u672c\u5206\u5272\n    text_splitter = RecursiveCharacterTextSplitter(\n        chunk_size=chunk_size,\n        chunk_overlap=chunk_overlap,\n        length_function=len,\n        is_separator_regex=False,\n    )\n    return text_splitter.split_documents(documents)\n\n# 3. \u5411\u91cf\u5b58\u50a8\u5230 Redis\ndef vectorize_to_redis(documents, index_name=\"knowledge_base\", redis_url=\"redis://localhost:6379\"):\n    \"\"\"\u5c06\u6587\u6863\u5411\u91cf\u5316\u5e76\u5b58\u50a8\u5230Redis\"\"\"\n    # \u521d\u59cb\u5316\u5d4c\u5165\u6a21\u578b\n    embeddings = LiteLLMEmbeddings()\n\n    # \u521b\u5efaRedis\u5411\u91cf\u5b58\u50a8\n    vectorstore = RedisVectorStore.from_documents(\n        documents=documents,\n        embedding=embeddings,\n        index_name=index_name,\n        redis_url=redis_url,\n        # Redis\u7d22\u5f15\u914d\u7f6e\n        index_schema={\n            \"text\": [{\"name\": \"content\"}],\n            \"vector\": [{\n                \"dims\": len(embeddings.embed_query(\"test\")),  # \u81ea\u52a8\u83b7\u53d6\u5411\u91cf\u7ef4\u5ea6\n                \"distance_metric\": \"COSINE\",\n                \"algorithm\": \"HNSW\",\n                \"datatype\": \"FLOAT32\"\n            }],\n            \"metadata\": [\"source\", \"page\"]\n        }\n    )\n    return vectorstore\n\n# 4. \u4e3b\u6267\u884c\u6d41\u7a0b\nif __name__ == \"__main__\":\n    # \u914d\u7f6e\u53c2\u6570\n    DOCUMENT_PATH = \"path/to/your/document.pdf\"\n    REDIS_URL = \"redis://:password@host:port\"  # \u751f\u4ea7\u73af\u5883\u4f7f\u7528\u8ba4\u8bc1\n    INDEX_NAME = \"company_knowledge_base\"\n\n    try:\n        # \u52a0\u8f7d\u548c\u5206\u5272\u6587\u6863\n        print(f\"\u6b63\u5728\u5904\u7406\u6587\u6863: {DOCUMENT_PATH}\")\n        chunks = load_and_split_documents(DOCUMENT_PATH)\n        print(f\"\u751f\u6210 {len(chunks)} \u4e2a\u6587\u672c\u5757\")\n\n        # \u5411\u91cf\u5316\u5e76\u5b58\u50a8\u5230Redis\n        vector_db = vectorize_to_redis(\n            chunks, \n            index_name=INDEX_NAME,\n            redis_url=REDIS_URL\n        )\n\n        # \u9a8c\u8bc1\u7d22\u5f15\n        info = vector_db.client.ft(INDEX_NAME).info()\n        print(f\"\u7d22\u5f15\u521b\u5efa\u6210\u529f! \u6587\u6863\u6570: {info['num_docs']}\")\n        print(f\"\u5411\u91cf\u7ef4\u5ea6: {info['attributes'][1]['dims']}\")\n\n    except Exception as e:\n        print(f\"\u5904\u7406\u5931\u8d25: {str(e)}\")\n        # \u8fd9\u91cc\u53ef\u4ee5\u6dfb\u52a0\u91cd\u8bd5\u6216\u56de\u6eda\u903b\u8f91\n</code></pre>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#_21","title":"\u4ee3\u7801\u5b9e\u73b0","text":""},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#litellmembedding","title":"\u4f7f\u7528litellm\u5c01\u88c5embedding\u670d\u52a1","text":"<p>todo</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#langchain_redis","title":"\u4f7f\u7528langchain_redis\u5199\u5165\u5411\u91cf\u6570\u636e\u5e93","text":"<p>todo</p>"},{"location":"rag/%E3%80%90RAG%E3%80%91%E6%9E%84%E5%BB%BA%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/#_22","title":"\u4f18\u5316\u7b56\u7565","text":"<ol> <li>\u5206\u5757\u4f18\u5316\uff1a</li> <li>\u5b9e\u9a8c\u4e0d\u540c\u5757\u5927\u5c0f\uff08256/512/1024 tokens\uff09</li> <li>\u8c03\u6574\u91cd\u53e0\u6bd4\u4f8b\uff0810-20%\uff09</li> <li>\u591a\u5411\u91cf\u7d22\u5f15\uff1a</li> <li>\u4e3a\u6458\u8981\u548c\u7ec6\u8282\u5206\u522b\u5efa\u7acb\u7d22\u5f15</li> <li>\u6df7\u5408\u68c0\u7d22\uff1a</li> <li>\u7ed3\u5408\u5173\u952e\u8bcd\u641c\u7d22\uff08BM25\uff09\u4e0e\u8bed\u4e49\u641c\u7d22</li> <li>\u5143\u6570\u636e\u8fc7\u6ee4\uff1a</li> <li>\u6309\u6587\u6863\u7c7b\u578b/\u65e5\u671f\u8fc7\u6ee4\u68c0\u7d22\u8303\u56f4</li> </ol> <p>\u6700\u7ec8\u8f93\u51fa\uff1a\u4e3a\u751f\u6210\u5668\uff08\u5982 GPT-4\uff09\u63d0\u4f9b\u7cbe\u51c6\u7684\u4e0a\u4e0b\u6587\u6587\u6863\u5757\uff0c\u5b9e\u73b0\u57fa\u4e8e\u77e5\u8bc6\u7684\u589e\u5f3a\u751f\u6210\u3002</p> <p>\u53c2\u8003\u6587\u6863 https://github.com/langchain-ai/langchain-redis https://docs.redisvl.com/en/stable/api/searchindex.html https://docs.redisvl.com/_/downloads/en/latest/pdf/</p>"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/","title":"\u5c06pdf\u548cdocx\u8f6c\u6362\u4e3amarkdown\u683c\u5f0f","text":""},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#_1","title":"\u6982\u8ff0","text":"<p>\u6700\u8fd1\u5728\u8c03\u7814RAG\u7684\u4f18\u5316\uff0c\u67e5\u9605\u4e86\u76f8\u5173\u7684\u8d44\u6599\uff08\u67e5\u770b\u672b\u5c3e\u7684\u53c2\u8003\u6587\u6863\uff09\uff0c\u672c\u6587\u5c06\u81ea\u5df1\u5728\u9605\u8bfb\u8fd9\u4e9b\u8d44\u6599\u8fc7\u7a0b\u4e2d\u7684\u601d\u8003\u548c\u5b9e\u8df5\u8fc7\u7a0b\u8bb0\u5f55\u4e0b\u6765\uff0c\u4ee5\u4fbf\u5bf9\u6709\u540c\u6837\u9700\u6c42\u7684\u5c0f\u4f19\u4f34\u63d0\u4f9b\u4e00\u4e9b\u5e2e\u52a9\u3002</p> <p>\u672c\u6587\u5c06\u4ece\u5982\u4e0b\u51e0\u4e2a\u65b9\u9762\u8fdb\u884c\u4ecb\u7ecd\uff1a</p> <ul> <li>\u4e3a\u4ec0\u4e48\u5728RAG\u4e2d\u9009\u62e9Markdown\u683c\u5f0f\uff08\u8fd9\u90e8\u5206\u5185\u5bb9\u7531deepseek\u6839\u636e\u63d0\u4f9b\u7684\u8d44\u6599\u603b\u7ed3\u751f\u6210\u7684\uff09</li> <li>\u5982\u4f55\u5c06pdf\u6587\u4ef6\u8f6c\u6362\u4e3amarkdown\u683c\u5f0f\uff08\u8c03\u7814\u4e86\u51e0\u4e2a\u6d41\u884c\u7684\u5f00\u6e90\u5e93\u5e76\u5b9e\u8df5\u5bf9\u6bd4\u6548\u679c\uff09</li> <li>\u5982\u4f55\u5c06docx\u6587\u4ef6\u8f6c\u6362\u4e3amarkdown\u683c\u5f0f\uff08\u8c03\u7814\u4e86\u51e0\u4e2a\u6d41\u884c\u7684\u5f00\u6e90\u5e93\u5e76\u5b9e\u8df5\u5bf9\u6bd4\u6548\u679c\uff09</li> <li>\u5bf9\u4e8e\u590d\u6742\u7684\u6587\u6863\u5c06pdf\u548cdocx\u4e92\u76f8\u8f6c\u6362\u518d\u8f6c\u6362\u6210markdown\u683c\u5f0f\u9a8c\u8bc1\u6548\u679c</li> <li>\u603b\u7ed3\u5e94\u8be5\u9009\u62e9\u54ea\u4e2a\u5de5\u5177\uff08\u8fd9\u91cc\u4e3b\u8981\u662f\u6839\u636e\u7b14\u8005\u7684\u5b9e\u9a8c\u6548\u679c\u9009\u62e9\uff0c\u5efa\u8bae\u4e0d\u540c\u7684\u6587\u4ef6\u53ef\u4ee5\u6309\u7167\u672c\u6587\u7684\u793a\u4f8b\u8fdb\u884c\u9a8c\u8bc1\uff0c\u9009\u62e9\u7b26\u5408\u81ea\u5df1\u6587\u4ef6\u8981\u6c42\u7684\u5de5\u5177\uff09</li> </ul> <p>pdf \u548c docx \u6587\u4ef6\u8f6c\u6362\u6210 markdown \u683c\u5f0f\u6587\u4ef6\u5176\u5b9e\u662f\u975e\u5e38\u590d\u6742\u7684\uff0c\u7279\u522b\u662f pdf \u7684\u8f6c\u6362\uff0c\u56e0\u4e3apdf\u6587\u4ef6\u7684\u5e03\u5c40\u975e\u5e38\u590d\u6742\uff08\u5305\u62ec\u8868\u683c\uff0c\u56fe\u7247\uff0c\u7279\u6b8a\u5e03\u5c40\uff09\uff0c\u4e3a\u4e86\u53d6\u5f97\u8f83\u597d\u7684\u6548\u679c\uff0c\u901a\u5e38\u4f1a\u4f7f\u7528\u4e13\u95e8\u7684\u6a21\u578b\u63d0\u53d6pdf\u6587\u4ef6\u7684\u5e03\u5c40\u548c\u8868\u683c\u5185\u5bb9\uff0c\u5373\u4f7f\u5982\u6b64\u5f88\u591a\u6bd4\u8f83\u590d\u6742\u7684pdf\u6587\u4ef6\u7684\u8f6c\u6362\u6548\u679c\u4efb\u7136\u53ef\u80fd\u4e0d\u597d\u3002docx\u6587\u4ef6\u4e5f\u662f\uff0c\u5bf9\u4e8e\u590d\u6742\u7684\u8868\u683c\uff0c\u53ef\u80fd\u8f6c\u6362\u7684\u6548\u679c\u4e5f\u4e0d\u662f\u5f88\u597d\u3002</p> <p>\u901a\u8fc7\u672c\u6587\u7684\u5b66\u4e60\uff0c\u5c06\u5bf9RAG\u5e94\u7528\u7684\u4f18\u5316\u6709\u4e00\u4e2a\u7b80\u5355\u7684\u4e86\u89e3\uff0c\u5728\u4e0b\u4e00\u7bc7\u6587\u7ae0\u4e2d\uff0c\u5c06\u57fa\u4e8e\u672c\u6587\u7684markdown\u683c\u5f0f\u5185\u5bb9\u4ecb\u7ecdchunk\u7684\u5207\u5206\u6280\u5de7\uff08\u5305\u62ec\u6309\u7167\u6807\u9898\u5207\u5206\u548c\u5408\u5e76\uff09\uff0c\u8fd9\u4e5f\u662f\u5bf9RAG\u4f18\u5316\u975e\u5e38\u91cd\u8981\u7684\u90e8\u5206\uff0c\u8bf7\u7ee7\u7eed\u5173\u6ce8\u3002</p> <p>\u6548\u679c\u5bf9\u6bd4\u8bf4\u660e\uff1a</p> <p>\u56e0\u4e3a\u5f53\u524d\u77e5\u8bc6\u5e93\u4e2d\u4e3b\u8981\u662fpdf\u548cdocx\u6587\u4ef6\u5c45\u591a\uff0c\u6240\u4ee5\u4e0b\u9762\u4ee3\u7801\u5b9e\u8df5\u7684\u6548\u679c\u5bf9\u6bd4\uff0c\u4e3b\u8981\u662f\u6bd4\u8f83pdf\u548cdocx\u8868\u683c\u548c\u6807\u9898\u80fd\u5426\u6b63\u786e\u8f6c\u6362\u4e3amarkdown\u683c\u5f0f\uff0c\u867d\u7136\u672c\u6587\u7684\u8fd9\u4e9b\u5e93\u90fd\u6709\u63d0\u53d6\u56fe\u7247\u7684\u80fd\u529b\uff0c\u4f46\u662f\u793a\u4f8b\u4e2d\u4e0d\u4f1a\u63d0\u53d6\u6587\u6863\u4e2d\u7684\u56fe\u7247\u3002 </p> <p>\u63a5\u4e0b\u6765\u5f00\u59cb\u672c\u6587\u7684\u5185\u5bb9\u3002</p>"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#markdown","title":"\u4e3a\u4ec0\u4e48\u4f7f\u7528markdown\u683c\u5f0f","text":"<p>\u4e3a\u4ec0\u4e48\u5728RAG\u4e2d\u9009\u62e9Markdown\u683c\u5f0f\uff0c\u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\u7684\u539f\u56e0\uff1a</p> <ul> <li>\u5927\u6a21\u578b\u5bf9Markdown\u7684\u652f\u6301</li> <li>Markdown\u683c\u5f0f\u672c\u8eab\u7684\u4f18\u70b9</li> </ul> <p>\u4ee5\u4e0b\u662f \u5927\u6a21\u578b\u5bf9Markdown\u7684\u652f\u6301 \u548c Markdown\u683c\u5f0f\u672c\u8eab\u7684\u4f18\u70b9 \u4e24\u65b9\u9762\u603b\u7ed3\uff0c\u89e3\u91ca\u4e3a\u4f55\u5728RAG\u4e2d\u9009\u62e9Markdown\u683c\u5f0f\uff1a</p>"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#markdown_1","title":"\u5927\u6a21\u578b\u5bf9Markdown\u7684\u652f\u6301","text":"<ol> <li>\u5927\u6a21\u578b\u672c\u8eab\u652f\u6301<ul> <li>Markdown\u975e\u5e38\u63a5\u8fd1\u7eaf\u6587\u672c\uff0c\u6807\u8bb0\u6216\u683c\u5f0f\u8f83\u5c11\uff0c\u4f46\u4ecd\u7136\u63d0\u4f9b\u4e86\u4e00\u79cd\u8868\u793a\u91cd\u8981\u6587\u6863\u7ed3\u6784\u7684\u65b9\u6cd5\u3002\u4e3b\u6d41LLM\uff0c\u5982chatgpt\u3001qwen\u3001deepseek\u7b49\u5929\u751f\u5c31\u8fd4\u56deMarkdown\u683c\u5f0f\u5185\u5bb9\uff0c\u8fd9\u8868\u660e\u4ed6\u4eec\u5df2\u7ecf\u63a5\u53d7\u4e86\u5927\u91cfMarkdown\u683c\u5f0f\u6587\u672c\u7684\u8bad\u7ec3\uff0c\u5e76\u4e14\u7406\u89e3\u5f97\u5f88\u597d\u3002</li> </ul> </li> <li>\u7ed3\u6784\u5316\u8bed\u4e49\u7406\u89e3 <ul> <li>\u5927\u6a21\u578b\uff08\u5982GPT-4\u3001LLAMA\uff09\u80fd\u76f4\u63a5\u89e3\u6790Markdown\u7684\u6807\u9898\uff08<code>#</code>\uff09\u3001\u5217\u8868\uff08<code>-</code>\uff09\u3001\u4ee3\u7801\u5757\uff08<code>``\uff09\u7b49\u6807\u8bb0\uff0c\u5c06\u5176\u4f5c\u4e3a**\u663e\u5f0f\u8bed\u4e49\u6807\u8bc6\u7b26**\uff0c\u589e\u5f3a\u5bf9\u6587\u6863\u903b\u8f91\u7ed3\u6784\u7684\u7406\u89e3\uff08\u5982\u533a\u5206\u7ae0\u8282\u3001\u91cd\u70b9\u5185\u5bb9\uff09\u3002  \u4f8b\u5982\uff0c\u6807\u9898\u5c42\u7ea7\uff08</code>## \u5b9e\u9a8c\u7ed3\u679c`\uff09\u80fd\u5e2e\u52a9\u6a21\u578b\u5feb\u901f\u5b9a\u4f4d\u5173\u952e\u6bb5\u843d\uff0c\u63d0\u5347\u68c0\u7d22\u548c\u751f\u6210\u7684\u76f8\u5173\u6027\u3002</li> </ul> </li> <li>\u4ee3\u7801\u4e0e\u516c\u5f0f\u7684\u9ad8\u4fdd\u771f\u5904\u7406 <ul> <li>Markdown\u7684\u4ee3\u7801\u5757\uff08<code>``python\uff09\u548c\u6570\u5b66\u516c\u5f0f\uff08</code>$$E=mc^2$$`\uff09\u80fd\u539f\u6837\u4fdd\u7559\u683c\u5f0f\uff0c\u907f\u514d\u6a21\u578b\u5c06\u4ee3\u7801\u6216\u516c\u5f0f\u8bef\u5224\u4e3a\u666e\u901a\u6587\u672c\uff0c\u786e\u4fdd\u6280\u672f\u6587\u6863\u3001\u5b66\u672f\u8bba\u6587\u7b49\u5185\u5bb9\u751f\u6210\u7684\u51c6\u786e\u6027\u3002</li> </ul> </li> <li>\u683c\u5f0f\u5f15\u5bfc\u751f\u6210\uff08Format-Guided Generation\uff09 <ul> <li>\u8f93\u5165Markdown\u65f6\uff0c\u6a21\u578b\u80fd\u66f4\u81ea\u7136\u5730\u6a21\u4eff\u5176\u7ed3\u6784\u8f93\u51fa\u7ed3\u679c\uff08\u5982\u751f\u6210\u5e26\u5c42\u7ea7\u7684\u62a5\u544a\u3001\u5217\u8868\u6216\u8868\u683c\uff09\uff0c\u51cf\u5c11\u751f\u6210\u5185\u5bb9\u7684\u683c\u5f0f\u6df7\u4e71\uff0c\u964d\u4f4e\u540e\u5904\u7406\u6210\u672c\u3002</li> </ul> </li> </ol>"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#markdown_2","title":"Markdown\u683c\u5f0f\u672c\u8eab\u7684\u4f18\u70b9","text":"<ol> <li>\u8f7b\u91cf\u5316\u4e0e\u6807\u51c6\u5316 <ul> <li>\u76f8\u6bd4HTML/XML/DOCX\uff0cMarkdown\u53bb\u9664\u4e86\u5197\u4f59\u6807\u7b7e\u548c\u6837\u5f0f\uff08\u5982\u5b57\u4f53\u989c\u8272\u3001\u590d\u6742\u6392\u7248\uff09\uff0c\u6587\u4ef6\u4f53\u79ef\u66f4\u5c0f\uff0c\u89e3\u6790\u6548\u7387\u66f4\u9ad8\uff0c\u9002\u5408\u5927\u6a21\u578b\u5904\u7406\u957f\u6587\u672c\u3002\u4f5c\u4e3a\u5f00\u6e90\u793e\u533a\u901a\u7528\u683c\u5f0f\uff0c\u5de5\u5177\u94fe\u652f\u6301\u5b8c\u5584\uff08\u5982Pandoc\u3001GitHub\uff09\uff0c\u907f\u514d\u683c\u5f0f\u517c\u5bb9\u6027\u95ee\u9898\u3002</li> </ul> </li> <li>\u663e\u5f0f\u7ed3\u6784\u5316\u5206\u5757 <ul> <li>Markdown\u7684\u6807\u9898\u5c42\u7ea7\uff08<code>#</code>\u3001<code>##</code>\uff09\u5929\u7136\u9002\u5408\u5c06\u6587\u6863\u6309\u8bed\u4e49\u5206\u5757\uff08\u5982\u7ae0\u8282\u3001\u6bb5\u843d\uff09\uff0c\u9002\u914dRAG\u7684\u6587\u6863\u5207\u5206\u9700\u6c42\uff0c\u786e\u4fdd\u68c0\u7d22\u7ed3\u679c\u4e0e\u95ee\u9898\u4e0a\u4e0b\u6587\u4e00\u81f4\u3002  \u4f8b\u5982\uff0cRAG\u7cfb\u7edf\u53ef\u76f4\u63a5\u6309\u6807\u9898\u5206\u5757\uff0c\u7cbe\u51c6\u5339\u914d\u7528\u6237\u7684\u67e5\u8be2\u3002</li> </ul> </li> <li>\u6700\u5927\u5316Token\u5229\u7528\u7387 <ul> <li>Markdown\u7684\u7b80\u6d01\u6027\uff08\u65e0\u590d\u6742\u6807\u7b7e\uff09\u80fd\u6700\u5927\u5316Token\u5229\u7528\u7387\uff0c\u5728\u76f8\u540c\u8f93\u5165\u957f\u5ea6\u9650\u5236\u4e0b\u5bb9\u7eb3\u66f4\u591a\u6838\u5fc3\u5185\u5bb9\u3002  \u5bf9\u8868\u683c\u3001\u56fe\u7247\u94fe\u63a5\uff08<code>![alt](url)</code>\uff09\u7b49\u5143\u7d20\u7684\u7b80\u6d01\u8868\u8fbe\uff0c\u51cf\u5c11\u65e0\u6548\u5b57\u7b26\u5360\u7528\u3002</li> </ul> </li> </ol>"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#_2","title":"\u603b\u7ed3","text":"\u7ef4\u5ea6 \u6838\u5fc3\u4f18\u52bf \u5927\u6a21\u578b\u652f\u6301 1. \u589e\u5f3a\u7ed3\u6784\u5316\u8bed\u4e49\u89e3\u6790\u80fd\u529b   2. \u652f\u6301\u4ee3\u7801/\u516c\u5f0f\u9ad8\u4fdd\u771f\u5904\u7406   3. \u5f15\u5bfc\u751f\u6210\u683c\u5f0f\u53ef\u63a7\u6027\u9ad8 Markdown\u683c\u5f0f\u7279\u6027 1. \u8f7b\u91cf\u5316\u4e0e\u6807\u51c6\u5316   2. \u663e\u5f0f\u5206\u5757\u63d0\u5347\u68c0\u7d22\u7cbe\u5ea6   3. \u6700\u5927\u5316Token\u5229\u7528\u7387 <p>\u672c\u8d28\u539f\u56e0\uff1a Markdown\u5728\u4fe1\u606f\u5bc6\u5ea6\uff08\u4fdd\u7559\u5173\u952e\u7ed3\u6784\uff0c\u53bb\u9664\u5197\u4f59\u6837\u5f0f\uff09\u548c\u53ef\u89e3\u6790\u6027\uff08\u673a\u5668\u4e0e\u6a21\u578b\u53cb\u597d\uff09\u4e4b\u95f4\u8fbe\u5230\u6700\u4f73\u5e73\u8861\uff0c\u4f7fRAG\u7cfb\u7edf\u80fd\u66f4\u9ad8\u6548\u5730\u5b8c\u6210\u201c\u68c0\u7d22-\u751f\u6210\u201d\u94fe\u8def\uff0c\u540c\u65f6\u4e3a\u5927\u6a21\u578b\u63d0\u4f9b\u6e05\u6670\u7684\u4e0a\u4e0b\u6587\u8fb9\u754c\u548c\u8bed\u4e49\u6807\u8bc6\u7b26\u3002</p> <p>\u63a5\u4e0b\u6765\u4ecb\u7ecd\u4e00\u4e2a\u5982\u4f55\u4f7f\u7528\u5f00\u6e90\u9879\u76ee\u5c06pdf\u548cdocx\u8f6c\u6362\u4e3amarkdown\u683c\u5f0f\uff0c\u8fd9\u90e8\u5206\u4e3b\u8981\u662f\u5b9e\u8df5\uff0c\u5305\u542b\u5927\u91cf\u7684\u4ee3\u7801\uff0c\u8be6\u7ec6\u7684\u4f7f\u7528\u53ef\u4ee5\u67e5\u770b\u5bf9\u5e94\u7684\u9879\u76ee\u7684\u5b98\u65b9\u6587\u6863\u3002</p>"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#pdfmarkdown","title":"\u5c06pdf\u8f6c\u6362\u4e3amarkdown\u683c\u5f0f","text":"<p>\u5c06 pdf \u6587\u4ef6\u8f6c\u6362\u4e3a markdown \u683c\u5f0f\uff0c\u4ecb\u7ecd\u5982\u4e0b\u51e0\u4e2a\u5f00\u6e90\u5e93\u7684\u4f7f\u7528\uff1a</p> <ul> <li>markitdown: \u5fae\u8f6f\u5f00\u6e90\u7684\u7528\u4e8e\u5c06\u6587\u4ef6\u548c\u529e\u516c\u6587\u6863\u8f6c\u6362\u4e3aMarkdown\u7684Python\u5de5\u5177\u3002</li> <li>langchain-pymupdf4llm: \u5c06PyMuPDF4LLM\u96c6\u6210\u5230LangChain\u4f5c\u4e3a\u6587\u6863\u52a0\u8f7d\u5668\u4e2d\uff0c\u4fbf\u4e8e\u548clangchain\u4f7f\u7528\u3002</li> <li>docling: Docling\u7b80\u5316\u4e86\u6587\u6863\u5904\u7406\uff0c\u80fd\u591f\u89e3\u6790\u591a\u79cd\u683c\u5f0f\uff0c\u5305\u62ec\u9ad8\u7ea7PDF\u7406\u89e3\uff0c\u5e76\u63d0\u4f9b\u4e0e\u901a\u7528AI\u751f\u6001\u7cfb\u7edf\u7684\u65e0\u7f1d\u96c6\u6210\u3002</li> <li>marker\uff1a\u5feb\u901f\u3001\u9ad8\u7cbe\u5ea6\u5730\u5c06PDF\u8f6c\u6362\u4e3amarkdown+JSON</li> </ul> <p>\u8fd9\u91cc\u4f7f\u7528\u4e00\u4e2a\u672c\u5730\u7684pdf\u6587\u4ef6\u548c\u4e00\u4e2a\u8fdc\u7a0barxiv\u4e2d\u7684pdf\u6587\u4ef6\u8fdb\u884c\u6548\u679c\u6bd4\u5bf9\uff0c\u770b\u770b\u54ea\u4e00\u4e2a\u5de5\u5177\u7684\u6027\u80fd\u6700\u597d\u3002</p>"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#markitdownpdfmarkdown","title":"markitdown\u8f6c\u6362pdf\u4e3amarkdown","text":""},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#_3","title":"\u4ee3\u7801\u5b9e\u8df5","text":"<p>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u5b89\u88c5 <code>markitdown</code></p> <pre><code>pip install markitdown\n</code></pre> <p>\u4f7f\u7528\u4e0b\u9762\u7684\u4ee3\u7801\u8f6c\u6362pdf\u6587\u4ef6\u4e3amarkdown\u683c\u5f0f\uff1a</p> <pre><code>from markitdown import MarkItDown\n\nlocal_docx_file = \"/Users/xiniao/Downloads/FATF-ME-FATF-HK-FUR-4-1-202302.pdf\"\nremote_docx_file = \"https://arxiv.org/pdf/2408.09869\"\n\nmd = MarkItDown()\n# source: \u53ef\u4ee5\u662f\u5b57\u7b26\u4e32\u3001pathlib\u8def\u5f84\u5bf9\u8c61\u6216URL\uff0c\u6216\u8005\u662f\u4e00\u4e2arequests.response\u5bf9\u8c61\nresult = md.convert(source=docx_file)\n\nwith open('test.md', mode='w') as f:\n    f.write(result.text_content)\nprint(result.text_content)\n</code></pre> <p><code>MarkItDown().convert()</code>\u65b9\u6cd5\u4e2d\u7684\u53c2\u6570<code>source</code>\u53ef\u4ee5\u662f\u5b57\u7b26\u4e32\u3001pathlib\u8def\u5f84\u5bf9\u8c61\u6216URL\uff0c\u6216\u8005\u662f\u4e00\u4e2arequests.response\u5bf9\u8c61\u3002</p>"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#_4","title":"\u7ed3\u679c\u5bf9\u6bd4","text":"<p>\u8fd9\u91cc\u4f7f\u7528\u4e00\u4e2a\u672c\u5730\u7684pdf\u6587\u4ef6\u548c\u4e00\u4e2a\u8fdc\u7a0barxiv\u4e2d\u7684pdf\u6587\u4ef6\uff0c\u5206\u522b\u63d0\u53d6\u7684\u7ed3\u679c\u5982\u4e0b\u3002</p> <p>\u672c\u5730pdf\u539f\u6587\u548c\u8f6c\u6362\u540e\u7684markdown\u5bf9\u6bd4\u7ed3\u679c\uff1a</p> \u672c\u5730pdf\u539f\u6587 \u8f6c\u6362\u540e\u7684markdown <p>arxiv\u4e2d\u7684pdf\u539f\u6587\u548c\u8f6c\u6362\u540e\u7684markdown\u5bf9\u6bd4\u7ed3\u679c\uff1a</p> arxiv\u4e2d\u7684pdf\u539f\u6587 \u8f6c\u6362\u540e\u7684markdown"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#_5","title":"\u7ed3\u8bba","text":"<p>\u4ece\u524d\u9762\u7684\u6548\u679c\u5bf9\u6bd4\u53ef\u4ee5\u770b\u5230\uff0c<code>**markitdown**</code>\u65e0\u6cd5\u6b63\u786e\u63d0\u53d6pdf\u4e2d\u7684\u8868\u683c\u548c\u6807\u9898\u3002</p> <p>\u67e5\u770b<code>**markitdown**</code>\u4e2d\u8f6c\u6362pdf\u7684\u6e90\u7801 <code>**PdfConverter**</code>\u4f7f\u7528\u7684\u662f <code>**pdfminer**</code>\u63d0\u53d6pdf\u6587\u4ef6\u7eaf\u6587\u672c\uff0c\u6ca1\u6709\u4fdd\u7559\u683c\u5f0f\uff1a</p> <p></p>"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#pymupdf4llmpdfmarkdown","title":"pymupdf4llm\u8f6c\u6362pdf\u4e3amarkdown","text":"<p>\u63a5\u4e0b\u6765\u4ecb\u7ecd\u4e00\u4e0b\u4f7f\u7528langchain-pymupdf4llm\u5c06pdf\u8f6c\u6362\u4e3amarkdown\uff0clangchain-pymupdf4llm\u5b9e\u9645\u4e0a\u662f\u5c01\u88c5\u4e86<code>pymupdf4llm</code>\uff08\u5173\u4e8epymupdf4llm\u7684\u4f7f\u7528\u53ef\u4ee5\u67e5\u770b\u6211\u5199\u7684\u8fd9\u7bc7\u6587\u7ae0\uff09\uff0c<code>pymupdf4llm</code>\u5b9e\u9645\u4f7f\u7528<code>PyMuPDF</code>\u5c06PDF\u9875\u9762\u8f6c\u6362\u4e3aMarkdown\u683c\u5f0f\u7684\u6587\u672c\u3002</p> <p>\u6ce8\u610f\uff1a\u5e93\u7684license\u8bf4\u660e</p> <p>langchain-pymupdf4llm\uff1aMIT license</p> <p>pymupdf4llm\uff1aAGPL-3.0 license</p> <p>PyMuPDF\uff1aAGPL-3.0 license </p>"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#_6","title":"\u4ee3\u7801\u5b9e\u8df5","text":"<p>\u56e0\u4e3a\u6211\u4eec\u4e3b\u8981\u4f7f\u7528langchain\u6846\u67b6\uff0c\u6240\u4ee5\u8fd9\u91cc\u76f4\u63a5\u6f14\u793a\u4f7f\u7528langchain-pymupdf4llm\u5c06pdf\u8f6c\u6362\u4e3amarkdown\uff0c\u4f7f\u7528\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ol> <li>\u9996\u5148\u4f7f\u7528\u4e0b\u9762\u547d\u4ee4\u5b89\u88c5<code>langchain-pymupdf4llm</code>\uff1a</li> </ol> <pre><code>pip install -U langchain-pymupdf4llm\n</code></pre> <ol> <li>\u4f7f\u7528\u4e0b\u9762\u4ee3\u7801\u8f6c\u6362pdf\u4e3amarkdown\uff1a</li> </ol> <pre><code>from langchain_pymupdf4llm import PyMuPDF4LLMLoader\n\n\ndef pdf_to_markdown(file_path: str) -&gt; str:\n    \"\"\"\n    \u5c06pdf\u8f6c\u6362\u4e3amarkdown\n    :param file_path:\n    :return:\n    \"\"\"\n    loader = PyMuPDF4LLMLoader(file_path=file_path, mode=\"page\", table_strategy=\"lines\")\n    docs = loader.load()\n    for doc in docs:\n        print(doc.page_content)\n        print(doc.metadata)\n        print('=' * 100)\n    if not docs:\n        return ''\n    return '\\n'.join(doc.page_content for doc in docs)\n\nlocal_docx_file = \"/Users/xiniao/Downloads/FATF-ME-FATF-HK-FUR-4-1-202302.pdf\"\n# remote_docx_file = \"https://arxiv.org/pdf/2408.09869\"\n\nmarkdown_content = pdf_to_markdown(file_path=local_docx_file)\n\nwith open('test.md', mode='w') as f:\n    f.write(markdown_content)\n</code></pre> <p>\u56e0\u4e3a<code>PyMuPDF4LLMLoader</code>\u96c6\u6210\u81ealangchain\u7684<code>BasePDFLoader</code>\uff0c\u6240\u4ee5\u652f\u6301\u672c\u5730\u548c\u8fdc\u7a0b\u6587\u4ef6\u7684\u8f6c\u6362\uff0c\u5982\u679c\u662f\u8fdc\u7a0b\u6587\u4ef6\u5219\u4f1a\u5148\u4e0b\u8f7d\u5230\u672c\u5730\u518d\u8f6c\u6362\u3002</p>"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#_7","title":"\u7ed3\u679c\u5bf9\u6bd4","text":"<p>\u8fd9\u91cc\u4f7f\u7528\u4e00\u4e2a\u672c\u5730\u7684pdf\u6587\u4ef6\u548c\u4e00\u4e2a\u8fdc\u7a0barxiv\u4e2d\u7684pdf\u6587\u4ef6\uff0c\u5206\u522b\u63d0\u53d6\u7684\u7ed3\u679c\u5982\u4e0b\u3002</p> <p>\u672c\u5730pdf\u539f\u6587\u548c\u8f6c\u6362\u540e\u7684markdown\u5bf9\u6bd4\u7ed3\u679c\uff1a</p> arxiv\u4e2d\u7684pdf\u539f\u6587 \u8f6c\u6362\u540e\u7684markdown <p>arxiv\u4e2d\u7684pdf\u539f\u6587\u548c\u8f6c\u6362\u540e\u7684markdown\u5bf9\u6bd4\u7ed3\u679c\uff1a</p> \u672c\u5730pdf\u539f\u6587 \u8f6c\u6362\u540e\u7684markdown"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#_8","title":"\u7ed3\u8bba","text":"<p>\u4f7f\u7528<code>langchain_pymupdf4llm</code>\u53ef\u4ee5\u6b63\u786e\u63d0\u53d6\u6807\u9898\uff0c\u5bf9\u4e8e\u7b80\u5355\u7684\u8868\u683c\u4e5f\u80fd\u63d0\u53d6\u5185\u5bb9\u548c\u683c\u5f0f\uff0c\u4f46\u662f\u5bf9\u4e8e\u590d\u6742\u7684\u8868\u683c\uff0c\u65e0\u6cd5\u6b63\u786e\u63d0\u53d6\u683c\u5f0f\u3002\u5982\u679cpdf\u4e2d\u5305\u542b\u5f88\u591a\u590d\u6742\u7684\u8868\u683c\uff0c\u5219\u63d0\u53d6\u6548\u679c\u4e0d\u662f\u5f88\u597d\uff0c\u5982\u679cpdf\u53ea\u662f\u6587\u672c\u548c\u6807\u9898\u5219\u6548\u679c\u8f83\u597d\u3002</p>"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#doclingpdfmarkdown","title":"docling\u8f6c\u6362pdf\u4e3amarkdown","text":"<p>\u4f7f\u7528docling\u8f6c\u6362pdf\u4e3amarkdown\u65f6\uff0c\u9700\u8981\u7528\u6a21\u578b\u8fdb\u884c\u8f6c\u6362\uff0cdocling\u8bad\u7ec3\u4e86\u4e00\u4e2adocling-models\u7528\u6765\u8bc6\u522bpdf\u6587\u4ef6\u7684\u5e03\u5c40\u548c\u8868\u683c\uff0c\u63a5\u4e0b\u6765\u4ecb\u7ecd\u4e00\u4e0b\u5982\u4f55\u4f7f\u7528docling\u8f6c\u6362pdf\u4e3amarkdown\u3002</p>"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#_9","title":"\u4ee3\u7801\u5b9e\u8df5","text":"<p>\u6309\u7167\u5982\u4e0b\u6b65\u9aa4\u8fdb\u884c\u5b9e\u8df5</p> <ol> <li>\u5b89\u88c5docling</li> <li>\u4e0b\u8f7d\u6a21\u578b</li> <li>\u7f16\u5199\u4ee3\u7801</li> </ol> <p>\u5b89\u88c5docling\u4f9d\u8d56</p> <pre><code>pip install docling\n</code></pre> <p>\u4e0b\u8f7d\u6a21\u578b</p> <p>\u7531\u4e8e\u5728\u56fd\u5185\u65e0\u6cd5\u76f4\u63a5\u8bbf\u95eehuggingface\uff0c\u6240\u4ee5\u8fd9\u91cc\u9009\u62e9\u4ecemodelscope\u4e0b\u8f7d\u6a21\u578b\u3002\u8fdb\u5165modelscope\uff0c\u9009\u62e9\u6a21\u578b\u5e93\uff0c\u641c\u7d22<code>ds4sd/docling-models</code>\u5373\u53ef\uff0c\u5982\u4e0b\u56fe\u6240\u793a</p> <p></p> <p>\u70b9\u51fb\u8fdb\u5165\u9009\u62e9\u7684\u6a21\u578b\uff0c\u7136\u540e\u4ece\u6a21\u578b\u6587\u4ef6\u4e2d\u70b9\u51fb\u4e0b\u8f7d\u6a21\u578b\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u4e0b\u8f7d\u6a21\u578b\u7684\u4ee3\u7801\u5982\u4e0b\uff1a</p> <p>\u5728\u4e0b\u8f7d\u524d\uff0c\u8bf7\u5148\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u5b89\u88c5ModelScope</p> <pre><code>pip install modelscope\n</code></pre> <pre><code>#\u6a21\u578b\u4e0b\u8f7d\nfrom modelscope import snapshot_download\n# \u4f7f\u7528local_dir\u4e0b\u8f7d\u6a21\u578b\u5230\u6307\u5b9a\u7684\u672c\u5730\u76ee\u5f55\u4e2d\nmodel_dir = snapshot_download(model_id='ds4sd/docling-models', \n                              local_dir='./docling-models')\nprint(model_dir)\n</code></pre> <p>\u7f16\u5199\u4ee3\u7801</p> <pre><code>from docling.datamodel.base_models import InputFormat\nfrom docling.datamodel.pipeline_options import EasyOcrOptions, PdfPipelineOptions\nfrom docling.document_converter import DocumentConverter, PdfFormatOption\n\n# \u6307\u5b9a\u4e0b\u8f7d\u7684\u6a21\u578b\u8def\u5f84\uff0c\u9ed8\u8ba4\u4e3ahuggingface\u7684\u4e0b\u8f7d\u6a21\u578b\u8def\u5f84\nartifacts_path = \"./docling-models\"\n\n# \u8fd9\u91cc\u4e0d\u63d0\u53d6\u56fe\u7247\u5185\u5bb9\uff0c\u6240\u4ee5\u8bbe\u7f6edo_ocr=False\uff0c\u9ed8\u8ba4\u4e3aTrue\uff0c\u5219\u9700\u8981\u4e0b\u8f7dOCR\u6a21\u578b\npipeline_options = PdfPipelineOptions(artifacts_path=artifacts_path, do_ocr=False)\n\ndoc_converter = DocumentConverter(\n    format_options={\n        InputFormat.PDF: PdfFormatOption(pipeline_options=pipeline_options)\n    }\n)\n\nlocal_docx_file = \"/Users/xiniao/Downloads/FATF-ME-FATF-HK-FUR-4-1-202302.pdf\"\n# remote_docx_file = \"https://arxiv.org/pdf/2408.09869\"\n\n# source\u652f\u6301\u672c\u5730\u6587\u4ef6\u548c\u8fdc\u7a0bURL\nresult = doc_converter.convert(source=local_docx_file)\nmarkdown_content = result.document.export_to_markdown()\n\ntemp_file = 'test.md'\nwith open(temp_file, mode=\"w\") as f:\n    f.write(markdown_content)\nprint(markdown_content)\n</code></pre>"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#_10","title":"\u7ed3\u679c\u5bf9\u6bd4","text":"<p>\u8fd9\u91cc\u4f7f\u7528\u4e00\u4e2a\u672c\u5730\u7684pdf\u6587\u4ef6\u548c\u4e00\u4e2a\u8fdc\u7a0barxiv\u4e2d\u7684pdf\u6587\u4ef6\uff0c\u5206\u522b\u63d0\u53d6\u7684\u7ed3\u679c\u5982\u4e0b\u3002</p> <p>\u672c\u5730pdf\u539f\u6587\u548c\u8f6c\u6362\u540e\u7684markdown\u5bf9\u6bd4\u7ed3\u679c\uff1a</p> \u672c\u5730pdf\u539f\u6587 \u8f6c\u6362\u540e\u7684markdown <p>arxiv\u4e2d\u7684pdf\u539f\u6587\u548c\u8f6c\u6362\u540e\u7684markdown\u5bf9\u6bd4\u7ed3\u679c\uff1a</p> arxiv\u4e2d\u7684pdf\u539f\u6587 \u8f6c\u6362\u540e\u7684markdown"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#_11","title":"\u7ed3\u8bba","text":"<p>\u4ece\u524d\u9762\u7684\u4e24\u4e2a\u793a\u4f8b\u53ef\u4ee5\u770b\u5230\uff0c\u4f7f\u7528docling\u7684\u6a21\u578b\u63d0\u53d6pdf\u7684\u6548\u679c\u76f8\u6bd4\u4e8e\u524d\u4e24\u4e2a\u5b9e\u8df5\u8fd8\u4e0d\u9519\uff0c\u5bf9\u4e8e\u7b80\u5355\u8868\u683c\u53ef\u4ee5\u6bd4\u8f83\u5b8c\u7f8e\u7684\u8f6c\u6362\uff0c\u5bf9\u4e8e\u590d\u6742\u8868\u683c\uff0c\u8f6c\u6362\u7684\u6548\u679c\u6709\u4e00\u70b9\u95ee\u9898\uff08\u6bd4\u5982\u524d\u9762\u7684\u793a\u4f8b\u4e2d\u8868\u683c\u7684\u6570\u636e\u5b58\u5728\u9519\u4e71\uff09\u4f46\u662f\u6574\u4f53\u8fd8\u53ef\u4ee5\u63a5\u53d7\u3002\u53e6\u5916\uff0c\u4ece\u5b9e\u8df5\u7ed3\u679c\u53ef\u4ee5\u770b\u5230\uff0c\u4f7f\u7528 docling\u7684\u6a21\u578b\u8f6c\u6362pdf\u65f6\uff0c\u4f1a\u81ea\u52a8\u5ffd\u7565\u6389\u9875\u7709\u548c\u9875\u811a\u3002</p> <p>\u8fd0\u884c\u6548\u7387\u8bf4\u660e\uff0c\u5728mac\u4e2d\u4f7f\u7528cpu\u8fd0\u884c\u6a21\u578b\uff0c\u8f6c\u6362\u4e00\u4e2a42\u9875\u7684\u5e26\u6709\u590d\u6742\u8868\u683c\u7684pdf\u6587\u4ef6\uff0c\u603b\u5171\u8017\u65f624\u79d2\u3002</p>"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#markerpdfmarkdown","title":"marker\u8f6c\u6362pdf\u4e3amarkdown","text":"<p>\u7531\u4e8emarker\u7684\u5546\u4e1a\u4f7f\u7528\u9650\u5236\uff0c\u8fd9\u91cc\u53ea\u662f\u5bf9\u5176\u505a\u4e00\u4e2a\u7b80\u5355\u4ecb\u7ecd\u4e0d\u8fdb\u884c\u4ee3\u7801\u5b9e\u9a8c\u7ed3\u679c\u5bf9\u6bd4\uff0c\u5982\u679c\u5bf9\u5176\u5bf9\u8be6\u7ec6\u4f7f\u7528\u611f\u5174\u8da3\uff0c\u53ef\u4ee5\u67e5\u770b\u5b98\u65b9\u6587\u6863\uff1ahttps://github.com/VikParuchuri/marker</p> <p></p>"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#_12","title":"\u4ee3\u7801\u5b9e\u8df5","text":"<ol> <li>\u5b89\u88c5\u4f9d\u8d56</li> </ol> <pre><code>pip install marker-pdf\n</code></pre> <ol> <li>\u4e0b\u8f7d\u6a21\u578b</li> </ol> <p>\u67e5\u770b\u6e90\u7801\uff0c\u4f1a\u4f7f\u7528\u4e0b\u5217\u7684\u6a21\u578b\uff1a</p> <p></p> <p>\u90e8\u5206\u6a21\u578b\u7684\u540d\u79f0\u5982\u4e0b\uff1a</p> <p></p> <p>\u8fdb\u5165\u67e5\u770bhuggingface\u4e0b\u8f7d\u6a21\u578b\uff1ahttps://huggingface.co/vikp</p> <p></p> <ol> <li>\u7f16\u5199\u4ee3\u7801</li> </ol> <pre><code>from marker.converters.pdf import PdfConverter\nfrom marker.models import create_model_dict\nfrom marker.output import text_from_rendered\n\nconverter = PdfConverter(\n    artifact_dict=create_model_dict(),\n)\nrendered = converter(\"FILEPATH\")\ntext, _, images = text_from_rendered(rendered)\n</code></pre>"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#_13","title":"\u7ed3\u679c\u5bf9\u6bd4","text":"<p>\u7531\u4e8e\u4f7f\u7528marker\u9700\u8981\u4e0b\u8f7d\u5f88\u591a\u6a21\u578b\uff0c\u5904\u7406\u8fc7\u7a0b\u4e2d\u4f1a\u5360\u7528\u8f83\u591a\u7684\u7cfb\u7edf\u8d44\u6e90\uff0c\u8fd9\u91cc\u5c31\u4e0d\u518d\u8fdb\u884c\u6d4b\u8bd5\uff0c\u5982\u679c\u611f\u5174\u8da3\u53ef\u4ee5\u5b89\u88c5\u4e0a\u9762\u7684\u6b65\u9aa4\u8fdb\u884c\u6d4b\u8bd5\u3002\u653e\u4e00\u5f20\u5b98\u65b9\u7684\u6548\u679c\u8bc4\u6d4b\u56fe\uff1a</p> <p></p> <p>\u4f7f\u7528\u9650\u5236PDF\u662f\u4e00\u79cd\u68d8\u624b\u7684\u683c\u5f0f\uff0c\u56e0\u6b64\u6807\u8bb0\u5e76\u4e0d\u603b\u662f\u5b8c\u7f8e\u5de5\u4f5c\uff0c\u4ee5\u4e0b\u662f\u8981\u89e3\u51b3\u7684\u4e00\u4e9b\u5df2\u77e5\u9650\u5236\uff1a</p> <ul> <li>\u5177\u6709\u5d4c\u5957\u8868\u683c\u548c\u8868\u5355\u7684\u975e\u5e38\u590d\u6742\u7684\u5e03\u5c40\u53ef\u80fd\u4e0d\u8d77\u4f5c\u7528</li> <li>\u8868\u683c\u53ef\u80fd\u6e32\u67d3\u5f97\u4e0d\u597d</li> </ul> <p>\u6ce8\u610f\uff1a\u4f20\u9012<code>--use_llm</code>\u6807\u5fd7\u5c06\u4e3b\u8981\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\u3002</p>"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#_14","title":"\u7ed3\u8bba","text":"<p>\u6839\u636e\u5b98\u65b9\u6587\u6863\u7684\u4ecb\u7ecd\uff0cmarker\u7684\u89e3\u6790\u6548\u679c\u8981\u597d\u4e8e docling\uff0c\u4f46\u662f\u7531\u4e8emarker\u7684\u4f7f\u7528\u9650\u5236\uff0c\u65e0\u6cd5\u5546\u4e1a\u4f7f\u7528\uff0c\u53ef\u4ee5\u6839\u636e\u4f7f\u7528\u573a\u666f\u8003\u8651\u662f\u5426\u4f7f\u7528\u8be5\u5de5\u5177\u3002</p>"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#docxmarkdown","title":"\u5c06docx\u8f6c\u6362\u4e3amarkdown\u683c\u5f0f","text":"<p>\u5c06docx\u8f6c\u6362\u4e3amarkdown\u683c\u5f0f\uff0c\u4ecb\u7ecd\u5982\u4e0b\u51e0\u4e2a\u5f00\u6e90\u5e93\u7684\u4f7f\u7528\uff1a</p> <ul> <li>markitdown: \u5fae\u8f6f\u5f00\u6e90\u7684\u7528\u4e8e\u5c06\u6587\u4ef6\u548c\u529e\u516c\u6587\u6863\u8f6c\u6362\u4e3aMarkdown\u7684Python\u5de5\u5177\u3002</li> <li>docling: Docling\u7b80\u5316\u4e86\u6587\u6863\u5904\u7406\uff0c\u80fd\u591f\u89e3\u6790\u591a\u79cd\u683c\u5f0f\uff0c\u5305\u62ec\u9ad8\u7ea7PDF\u7406\u89e3\uff0c\u5e76\u63d0\u4f9b\u4e0e\u901a\u7528AI\u751f\u6001\u7cfb\u7edf\u7684\u65e0\u7f1d\u96c6\u6210\u3002</li> <li>docx2markdown: \u5185\u90e8\u4f7f\u7528 python-docx \u8bfb\u53d6 docx \u6587\u4ef6\u5185\u5bb9\u8f6c\u6362\u4e3a markdown \u683c\u5f0f\u6587\u4ef6</li> </ul> <p>\u56e0\u4e3a\u6211\u4eec\u77e5\u8bc6\u5e93\u4e2d\u5b58\u5728\u6cd5\u89c4\u7c7b\u7684\u6587\u4ef6\uff0c\u6240\u4ee5\u4ece\u56fd\u5bb6\u6cd5\u5f8b\u6cd5\u89c4\u6570\u636e\u5e93\u4e2d\u4e0b\u8f7d\u4e00\u4e2a\u6cd5\u89c4\u6587\u4ef6\u6765\u9a8c\u8bc1 docx \u6587\u4ef6\u8f6c\u6362\u4e3a markdown \u7684\u6548\u679c\uff0c\u6211\u8fd9\u91cc\u4f7f\u7528\u6c11\u6cd5\u5178\u6587\u4ef6\u5982\u4e0b\uff0c\u70b9\u51fb\u4e0b\u8f7d\u662f\u4e00\u4e2adocx\u6587\u4ef6\uff1a</p> <p></p>"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#markitdowndocxmarkdown","title":"markitdown\u8f6c\u6362docx\u4e3amarkdown","text":"<p>\u63a5\u4e0b\u6765\u5c06\u4ecb\u7ecd\u4f7f\u7528markitdown\u8f6c\u6362docx\u4e3amarkdown\u3002</p>"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#_15","title":"\u4ee3\u7801\u5b9e\u8df5","text":"<ol> <li>\u5b89\u88c5\u4f9d\u8d56</li> </ol> <pre><code>pip install markitdown[pdf, docx, pptx]\n</code></pre> <ol> <li>\u7f16\u5199\u4ee3\u7801</li> </ol> <pre><code>from markitdown import MarkItDown\n\ndocx_file = \"/Users/xiniao/Downloads/\u6c11\u6cd5\u5178.docx\"\n\nmd = MarkItDown()\nresult = md.convert(docx_file)\nmarkdown_content = result.text_content\n\ntemp_file = 'test.md'\nwith open(temp_file, mode=\"w\") as f:\n    f.write(markdown_content)\n</code></pre>"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#_16","title":"\u7ed3\u679c\u5bf9\u6bd4","text":"\u672c\u5730docx\u539f\u6587 \u8f6c\u6362\u540e\u7684markdown <p>\u9a8c\u8bc1\u8868\u683c\u63d0\u53d6</p> \u672c\u5730docx\u539f\u6587 \u8f6c\u6362\u540e\u7684markdown <p>\u9a8c\u8bc1\u624b\u52a8\u7ed9docx\u6dfb\u52a0\u6807\u9898</p> \u672c\u5730docx\u539f\u6587 \u8f6c\u6362\u540e\u7684markdown"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#_17","title":"\u7ed3\u8bba","text":"<p>\u4ece\u7ed3\u679c\u5bf9\u6bd4\u53ef\u4ee5\u5f97\u51fa\u5982\u4e0b\u7ed3\u8bba\uff1a</p> <ul> <li>\u5982\u679cdocx\u6587\u4ef6\u6ca1\u6709\u6837\u5f0f\uff0c\u5219\u53ea\u4f1a\u4fdd\u7559\u7eaf\u6587\u672c\u3002</li> <li>\u5982\u679cdocx\u6587\u4ef6\u6709\u8868\u683c\uff0c\u53ef\u4ee5\u6b63\u5e38\u8f6c\u6362\u4e3amarkdown\u683c\u5f0f\u7684\u8868\u683c\uff08\u590d\u6742\u8868\u683c\u8fd8\u9700\u8981\u66f4\u591a\u7684\u9a8c\u8bc1\uff09</li> <li>\u5982\u679cdocx\u6587\u4ef6\u624b\u52a8\u6dfb\u52a0\u4e86\u6807\u9898\uff0c\u53ef\u4ee5\u6b63\u5e38\u8f6c\u6362\u4e3amarkdown\u683c\u5f0f\u7684\u6807\u9898</li> </ul> <p>\u67e5\u770bmarkitdown\u8f6c\u6362docx\u6587\u4ef6\u7684\u6e90\u7801\uff0c\u53ef\u4ee5\u770b\u5230\u662f\u4f7f\u7528<code>mammoth</code>\u5148\u8f6c\u6362\u6210 <code>html</code> \u683c\u5f0f\uff0c\u7136\u540e\u4f7f\u7528<code>BeautifulSoup</code>\u63d0\u53d6html\u7684\u5185\u5bb9\uff0c\u6700\u540e\u8f6c\u6362\u6210markdown\u683c\u5f0f\uff1a</p> <p></p>"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#doclingdocxmarkdown","title":"docling\u8f6c\u6362docx\u4e3amarkdown","text":""},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#_18","title":"\u4ee3\u7801\u5b9e\u8df5","text":"<ol> <li>\u5b89\u88c5\u4f9d\u8d56</li> </ol> <pre><code>pip install docling\n</code></pre> <ol> <li>\u7f16\u5199\u4ee3\u7801</li> </ol> <pre><code>from docling.document_converter import DocumentConverter\n\ndocx_file = \"/Users/xiniao/Downloads/\u6c11\u6cd5\u5178.docx\"  # document per local path or URL\nconverter = DocumentConverter()\nresult = converter.convert(source=docx_file)\nmarkdown_content = result.document.export_to_markdown()\n\ntemp_file = 'test.md'\nwith open(temp_file, mode=\"w\") as f:\n    f.write(markdown_content)\n\nprint(markdown_content[:500])\n</code></pre>"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#_19","title":"\u7ed3\u679c\u5bf9\u6bd4","text":"\u672c\u5730docx\u539f\u6587 \u8f6c\u6362\u540e\u7684markdown"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#_20","title":"\u7ed3\u8bba","text":"<p>\u4f7f\u7528docling\u8f6c\u6362docx\u4e3amarkdown\uff0c\u4ece\u524d\u9762\u7684\u7ed3\u679c\u4e2d\u53ef\u4ee5\u5f97\u51fa\u5982\u4e0b\u7ed3\u8bba\uff1a</p> <ul> <li>\u5982\u679cdocx\u6587\u4ef6\u6ca1\u6709\u6837\u5f0f\uff0c\u5219\u53ea\u4f1a\u4fdd\u7559\u7eaf\u6587\u672c\u3002</li> <li>\u5982\u679cdocx\u6587\u4ef6\u6709\u8868\u683c\uff0c\u53ef\u4ee5\u6b63\u5e38\u8f6c\u6362\u4e3amarkdown\u683c\u5f0f\u7684\u8868\u683c\uff08\u590d\u6742\u8868\u683c\u8fd8\u9700\u8981\u66f4\u591a\u7684\u9a8c\u8bc1\uff09</li> <li>\u5982\u679cdocx\u6587\u4ef6\u624b\u52a8\u6dfb\u52a0\u4e86\u6807\u9898\uff0c\u65e0\u6cd5\u6b63\u5e38\u8f6c\u6362\u4e3amarkdown\u683c\u5f0f\u7684\u6807\u9898</li> </ul> <p>\u67e5\u770bdocling\u8f6c\u6362docx\u6587\u4ef6\u7684\u6e90\u7801<code>MsWordDocumentBackend</code>\uff0c\u5b9e\u9645\u4e0a\u4f7f\u7528\u7684\u662f <code>[python-docx](https://github.com/python-openxml/python-docx)</code>\u8fdb\u884c\u8f6c\u6362\u3002</p>"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#python-docxdocxmarkdown","title":"python-docx\u8f6c\u6362docx\u4e3amarkdown","text":"<p>\u4e0b\u9762\u53c2\u8003docx2markdown\u7684\u5b9e\u73b0\uff0c\u5b9e\u9645\u4e0a\u4f7f\u7528<code>[python-docx](https://github.com/python-openxml/python-docx)</code>\u5c06docx\u8f6c\u6362markdown\u7684\u903b\u8f91\u5c01\u88c5\u5230 <code>langchain</code> \u7684 <code>BaseLoader</code> \u4e2d\uff0c\u65b9\u4fbf\u5728langchain\u4e2d\u4f7f\u7528\u3002\u56e0\u4e3a\u5728<code>Docx2txtLoader</code>\u7684 <code>__init__()</code>\u65b9\u6cd5\u4e2d\u5b9e\u73b0\u4e86\u652f\u6301\u672c\u5730\u6587\u4ef6\u548c\u8fdc\u7a0b\u6587\u4ef6\uff0c\u6240\u4ee5\u8fd9\u91cc\u5b9a\u4e49\u4e00\u4e2a<code>Docx2MarkdownLoader</code>\u7c7b\uff0c\u8be5\u7c7b\u7ee7\u627f <code>Docx2txtLoader</code>\u7c7b\uff0c\u91cd\u5199<code>load()</code>\u65b9\u6cd5\u3002</p> <p>\u4e0b\u9762\u662f\u8be6\u7ec6\u7684\u4ee3\u7801\u5b9e\u73b0\u3002</p>"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#_21","title":"\u4ee3\u7801\u5b9e\u8df5","text":"<pre><code>from tempfile import TemporaryDirectory\nfrom typing import Iterator\n\nimport docx\nimport os\n\nfrom langchain_community.document_loaders import Docx2txtLoader\nfrom langchain_core.documents import Document\nfrom lxml import etree\nfrom pathlib import Path\n\n\nclass Docx2MarkdownLoader(Docx2txtLoader):\n    def _lazy_load(self) -&gt; Iterator[Document]:\n        markdown_content = docx_to_markdown(self.file_path)\n        yield Document(\n            page_content=markdown_content,\n            metadata={},\n        )\n\n    def load(self) -&gt; list[Document]:\n        return list(self._lazy_load())\n\n\ndef docx_to_markdown(docx_file: str, extract_images: bool = False):\n    \"\"\"Convert a .docx file to a Markdown file and a subfolder of images.\"\"\"\n\n    doc = docx.Document(docx_file)\n\n    paragraphs = list(doc.paragraphs)\n    tables = list(doc.tables)\n    markdown = []\n\n    # save all images\n    images = {}\n    if extract_images:\n        temp_dir = TemporaryDirectory()\n        output_md = temp_dir.name\n        folder = str(Path(output_md).parent)\n        image_folder = str(Path(output_md).parent / \"images\")\n        for rel in doc.part.rels.values():\n            if \"image\" in rel.reltype:\n                image_filename = save_image(rel.target_part, image_folder)\n                images[rel.rId] = image_filename[len(folder) - 1:]\n\n    # print(\"images\", images)\n\n    for block in doc.element.body:\n        if block.tag.endswith('p'):  # Handle paragraphs\n            paragraph = paragraphs.pop(0)  # Match current paragraph\n            md_paragraph = \"\"\n\n            style_name = paragraph.style.name\n            if style_name.startswith('Heading'):\n                level = int(style_name[-1])\n                md_paragraph = '#' * level + ' '\n            # print(\"Style:\", style_name)\n            elif \"List\" in style_name:\n                prefix = get_bullet_point_prefix(paragraph)\n                md_paragraph = prefix  # Markdown syntax for bullet points\n            elif \"Normal\" in style_name:\n                md_paragraph = \"\"\n            elif \"Body Text\" in style_name:\n                continue\n            else:\n                print(\"Unsupported style:\", style_name, type(style_name), style_name.split(\" \"))\n\n            md_paragraph += parse_run(paragraph, images)\n\n            markdown.append(md_paragraph)\n\n        elif block.tag.endswith('tbl'):  # Handle tables (if present)\n            table = tables.pop(0)  # Match current table\n            table_text = \"\"\n            for i, row in enumerate(table.rows):\n                table_text += \"| \" + \" | \".join(cell.text.strip() for cell in row.cells) + \" |\\n\"\n                if i == 0:\n                    table_text += \"| \" + \" | \".join(\"---\" for _ in row.cells) + \" |\\n\"\n\n            markdown.append(table_text)\n\n        # else:\n        #    print(\"Unsupported block:\", block)\n\n    return \"\\n\\n\".join(markdown)\n\n\ndef extract_r_embed(xml_string):\n    \"\"\"\n    Extract the value of r:embed from the given XML string.\n\n    :param xml_string: The XML content as a string.\n    :return: The value of r:embed or None if not found.\n    \"\"\"\n    # Parse the XML\n    root = etree.fromstring(xml_string)\n\n    # Define the namespaces\n    namespaces = {\n        'a': \"http://schemas.openxmlformats.org/drawingml/2006/main\",\n        'r': \"http://schemas.openxmlformats.org/officeDocument/2006/relationships\",\n        'pic': \"http://schemas.openxmlformats.org/drawingml/2006/picture\",\n    }\n\n    # Use XPath to find the &lt;a:blip&gt; element with r:embed\n    blip = root.find(\".//a:blip\", namespaces=namespaces)\n\n    # Extract the r:embed attribute value\n    if blip is not None:\n        return blip.attrib.get(\"{http://schemas.openxmlformats.org/officeDocument/2006/relationships}embed\")\n    return None\n\n\ndef save_image(image_part, output_folder):\n    \"\"\"Save an image to the output folder and return the filename.\"\"\"\n    os.makedirs(output_folder, exist_ok=True)\n    image_filename = os.path.join(output_folder, os.path.basename(image_part.partname))\n    with open(image_filename, \"wb\") as img_file:\n        img_file.write(image_part.blob)\n    return str(image_filename).replace(\"\\\\\", \"/\")\n\n\ndef get_list_level(paragraph):\n    \"\"\"Determine the level of a bullet point or numbered list item.\"\"\"\n    # Access the raw XML of the paragraph\n    p = paragraph._element\n    numPr = p.find(\".//w:numPr\", namespaces=p.nsmap)\n    if numPr is not None:\n        ilvl = numPr.find(\".//w:ilvl\", namespaces=p.nsmap)\n        if ilvl is not None:\n            return int(ilvl.get(\"{http://schemas.openxmlformats.org/wordprocessingml/2006/main}val\"))\n    return 0\n\n\ndef get_bullet_point_prefix(paragraph):\n    \"\"\"Determine the Markdown prefix for a bullet point based on its indentation level.\"\"\"\n    level = get_list_level(paragraph)\n    return \"  \" * level + \"- \"  # Use Markdown syntax for nested lists\n\n\ndef parse_run(run, images):\n    \"\"\"Go through document objects recursively and return markdown.\"\"\"\n    sub_parts = list(run.iter_inner_content())\n    text = \"\"\n    for s in sub_parts:\n        if isinstance(s, str):\n            text += s\n        elif isinstance(s, docx.text.pagebreak.RenderedPageBreak):\n            text += ''\n        elif isinstance(s, docx.text.run.Run):\n            text += parse_run(s, images)\n        elif isinstance(s, docx.text.hyperlink.Hyperlink):\n            text += f\"[{s.text}]({s.address})\"\n        elif isinstance(s, docx.drawing.Drawing):\n            # \u5982\u679c\u6ca1\u6709\u56fe\u7247\uff0c\u5219\u8df3\u8fc7\n            if not images:\n                continue\n            rId = extract_r_embed(s._element.xml)\n            image_url = images[rId]\n            text += f\"![]({image_url})\"\n        else:\n            print(\"unknown run type\", s, s.text, type(s))\n            print(f'{s} {type(s)}')\n\n    if isinstance(run, docx.text.run.Run):\n        if run.bold:\n            text = f\"**{text}**\"\n        if run.italic:\n            text = f\"*{text}*\"\n        if run.underline:\n            text = f\"__{text}__\"\n    return text\n\n\nif __name__ == '__main__':\n    docx_file = \"/Users/xiniao/Downloads/\u6c11\u6cd5\u5178.docx\"\n    docs = Docx2MarkdownLoader(docx_file).load()\n\n    markdown_content = '\\n\\n'.join([doc.page_content for doc in docs])\n    temp_file = 'test.md'\n    with open(temp_file, mode=\"w\") as f:\n        f.write(markdown_content)\n\n    print(markdown_content[:500])\n</code></pre>"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#_22","title":"\u7ed3\u679c\u5bf9\u6bd4","text":"docx\u539f\u6587 \u8f6c\u6362\u540e\u7684markdown"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#_23","title":"\u7ed3\u8bba","text":"<p>\u4f7f\u7528<code>python-docx</code>\u8f6c\u6362docx\u6587\u4ef6\u4e3amarkdown\uff0c\u4ece\u524d\u9762\u7684\u7ed3\u679c\u4e2d\u53ef\u4ee5\u5f97\u51fa\u5982\u4e0b\u7ed3\u8bba\uff1a</p> <ul> <li>\u5982\u679cdocx\u6587\u4ef6\u6ca1\u6709\u6837\u5f0f\uff0c\u5219\u53ea\u4f1a\u4fdd\u7559\u7eaf\u6587\u672c\u3002</li> <li>\u5982\u679cdocx\u6587\u4ef6\u6709\u8868\u683c\uff0c\u53ef\u4ee5\u6b63\u5e38\u8f6c\u6362\u4e3amarkdown\u683c\u5f0f\u7684\u8868\u683c\uff08\u590d\u6742\u8868\u683c\u8fd8\u9700\u8981\u66f4\u591a\u7684\u9a8c\u8bc1\uff09</li> <li>\u5982\u679cdocx\u6587\u4ef6\u624b\u52a8\u6dfb\u52a0\u4e86\u6807\u9898\uff0c\u53ef\u4ee5\u6b63\u5e38\u8f6c\u6362\u4e3amarkdown\u683c\u5f0f\u7684\u6807\u9898</li> </ul>"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#docpdfmarkdown","title":"doc\u8f6cpdf\u540e\u63d0\u53d6markdown","text":"<p>\u524d\u9762\u4ecb\u7ecd\u4e86\u4f7f\u7528\u5de5\u5177\u5c06docx\u8f6c\u6362\u4e3amarkdown\u683c\u5f0f\uff0c\u5982\u679cdocx\u6587\u4ef6\u6ca1\u6709\u8bbe\u7f6e\u6807\u9898\u7684\u5c42\u7ea7\u7ed3\u6784\uff0c\u90a3\u4e48\u8fd9\u4e9b\u5de5\u5177\u90fd\u4e0d\u80fd\u8f6c\u6362\u4e3amarkdown\u7684\u6807\u9898\u3002\u4e00\u4e2a\u89e3\u51b3\u65b9\u6cd5\u662f\uff0c\u4eba\u5de5\u5728\u4e0a\u4f20docx\u6587\u4ef6\u5230\u77e5\u8bc6\u5e93\u4e4b\u524d\uff0c\u5148\u6807\u6ce8\u51fadocx\u6587\u4ef6\u7684\u6807\u9898\u5c42\u7ea7\u673a\u6784\u518d\u4e0a\u4f20\uff0c\u5982\u679c\u6709\u5927\u91cf\u7684docx\u6587\u4ef6\uff0c\u4eba\u5de5\u5904\u7406\u7684\u6548\u7387\u5c31\u5f88\u4f4e\u4e86\u3002\u60f3\u5230\u7684\u53e6\u4e00\u4e2a\u65b9\u6cd5\u5c31\u662f\u5148\u5c06docx\u6587\u4ef6\u8f6c\u6362\u4e3apdf\u6587\u4ef6\uff0c\u7136\u540e\u5229\u7528\u524d\u9762\u4ecb\u7ecd\u7684\u5de5\u5177\u5c06pdf\u8f6c\u6362\u4e3amarkdown\uff0c\u63a5\u4e0b\u6765\u4f7f\u7528docling\u8f6c\u6362pdf\u6765\u9a8c\u8bc1\u8fd9\u4e2a\u60f3\u6cd5\u3002</p> <p>\u9996\u5148\u5c06\u6ca1\u6709\u6807\u9898\u5c42\u7ea7\u7ed3\u6784docx\u6587\u4ef6\u4f7f\u7528word\u8f6c\u6362\u4e3apdf\uff1a</p> \u6ca1\u6709\u6807\u9898\u5c42\u7ea7\u7ed3\u6784docx\u6587\u4ef6\u4f7f\u7528word\u8f6c\u6362\u4e3apdf \u4f7f\u7528docling\u8f6c\u6362pdf\u8f6c\u6362\u540e\u7684markdown <p>\u4ece\u8f6c\u6362\u540e\u7684\u7ed3\u679c\u53ef\u4ee5\u770b\u5230\uff0c\u6807\u9898\u53ef\u4ee5\u8bc6\u522b\u51fa\u6765\uff0c\u4f46\u662f\u6807\u9898\u7684\u5c42\u7ea7\u7ed3\u6784\u8fd8\u662f\u4e0d\u591f\u51c6\u786e\u3002</p> <p>\u7ed3\u8bba\uff1a\u5bf9\u4e8e\u6ca1\u6709\u5c42\u7ea7\u7ed3\u6784\u7684docx\u6587\u4ef6\uff0c\u5c06docx\u6587\u4ef6\u8f6c\u6362\u4e3apdf\uff0c\u7136\u540e\u518d\u5c06pdf\u8f6c\u6362\u4e3amardown\u683c\u5f0f\u53ef\u4ee5\u63d0\u53d6\u90e8\u5206\u6807\u9898\u3002</p>"},{"location":"rag/%E3%80%90RAG%E4%BC%98%E5%8C%96%E3%80%91%E5%B0%86pdf%E5%92%8Cdocx%E8%BD%AC%E6%8D%A2%E4%B8%BAmarkdown%E6%A0%BC%E5%BC%8F/#_24","title":"\u603b\u7ed3","text":"<p>\u672c\u6587\u4f7f\u7528\u5f00\u6e90\u5de5\u5177\u548c\u81ea\u5df1\u7684\u5b9e\u73b0\u5bf9pdf\u6587\u4ef6\u548cdocx\u6587\u4ef6\u8f6c\u6362\u4e3amarkdown\u683c\u5f0f\u8fdb\u884c\u4e86\u5b9e\u9a8c\uff0c\u5bf9\u6bd4\u4e86\u5404\u4e2a\u5f00\u6e90\u5de5\u5177\u7684\u6548\u679c\uff0c\u4e0b\u9762\u6839\u636e\u524d\u9762\u7684\u5b9e\u9a8c\u7ed3\u679c\u505a\u4e00\u4e2a\u603b\u7ed3\u3002</p> <p>pdf\u6587\u4ef6\u8f6cmarkdown\u5de5\u5177\u4f7f\u7528\u603b\u7ed3\u5982\u4e0b\uff1a</p> <ul> <li>markitdown\uff1a\u4f7f\u7528\u7684\u662f pdfminer \u63d0\u53d6pdf\u6587\u672c\uff0c\u65e0\u6cd5\u6b63\u786e\u63d0\u53d6pdf\u4e2d\u7684\u8868\u683c\u548c\u6807\u9898\u3002</li> <li>langchain_pymupdf4llm\uff1a\u4f7f\u7528pymupdf\u53ef\u4ee5\u6b63\u786e\u63d0\u53d6\u6807\u9898\uff0c\u5bf9\u4e8e\u7b80\u5355\u7684\u8868\u683c\u4e5f\u80fd\u63d0\u53d6\u5185\u5bb9\u548c\u683c\u5f0f\uff0c\u4f46\u662f\u5bf9\u4e8e\u590d\u6742\u7684\u8868\u683c\uff0c\u65e0\u6cd5\u6b63\u786e\u63d0\u53d6\u683c\u5f0f\u3002\u5982\u679cpdf\u4e2d\u5305\u542b\u5f88\u591a\u590d\u6742\u7684\u8868\u683c\uff0c\u5219\u63d0\u53d6\u6548\u679c\u4e0d\u662f\u5f88\u597d\u3002\u6ca1\u6709\u4f7f\u7528\u6a21\u578b\uff0c\u63d0\u53d6\u6548\u7387\u8f83\u9ad8\uff0c\u4f46\u662fPyMuPDF\u4f7f\u7528\u7684\u662fAGPL-3.0 license\uff0c\u5bf9\u4e8e\u5546\u4e1a\u4f7f\u7528\u4e0d\u53cb\u597d\u3002</li> <li>docling: \u4f7f\u7528docling\u7684\u6a21\u578b\u63d0\u53d6pdf\u7684\u6548\u679c\u8fd8\u4e0d\u9519\uff0c\u4f7f\u7528cpu\u8fd0\u884c\u6a21\u578b\u7684\u6548\u7387\u4e5f\u8fd8\u53ef\u4ee5\uff0c\u5e76\u4e14\u4f7f\u7528\u7684MIT license\u5bf9\u5546\u7528\u6bd4\u8f83\u53cb\u597d\uff0c\u63a8\u8350\u4f7f\u7528\u3002</li> <li>marker: \u6839\u636e\u5b98\u65b9\u6587\u6863\u7684\u4ecb\u7ecd\uff0cmarker\u7684\u89e3\u6790\u6548\u679c\u8981\u597d\u4e8e docling\uff0c\u4f46\u662f\u7531\u4e8emarker\u7684\u4f7f\u7528\u9650\u5236\uff0c\u65e0\u6cd5\u5546\u4e1a\u4f7f\u7528\uff0c\u53ef\u4ee5\u6839\u636e\u4f7f\u7528\u573a\u666f\u8003\u8651\u662f\u5426\u4f7f\u7528\u8be5\u5de5\u5177\u3002</li> </ul> <p>docx\u6587\u4ef6\u8f6cmarkdown\u5de5\u5177\u4f7f\u7528\u603b\u7ed3\u5982\u4e0b:</p> <ul> <li>markitdown\uff1a\u53ef\u4ee5\u6b63\u786e\u8f6c\u6362docx\u6587\u4ef6\u7684\u6807\u9898\u548c\u8868\u683c\uff0c\u67e5\u770bmarkitdown\u8f6c\u6362docx\u6587\u4ef6\u7684\u6e90\u7801\uff0c\u4f7f\u7528<code>mammoth</code>\u5148\u8f6c\u6362\u6210 <code>html</code> \u683c\u5f0f\uff0c\u7136\u540e\u4f7f\u7528<code>BeautifulSoup</code>\u63d0\u53d6html\u7684\u5185\u5bb9\uff0c\u6700\u540e\u8f6c\u6362\u6210markdown\u683c\u5f0f\u3002\u5fae\u8f6f\u5f00\u6e90\u9879\u76ee\uff0c\u4ee3\u7801\u8d28\u91cf\u6709\u4e00\u5b9a\u4fdd\u969c\uff0c\u63a8\u8350\u4f7f\u7528\u3002</li> <li>docling: \u65e0\u6cd5\u6b63\u786e\u8f6c\u6362docx\u6587\u4ef6\u7684\u6807\u9898\u548c\u8868\u683c\u3002</li> <li>python-docx: \u53ef\u4ee5\u6b63\u5e38\u8f6c\u6362\u4e3amarkdown\u683c\u5f0f\u7684\u6807\u9898\uff0c\u9700\u8981\u81ea\u5df1\u7f16\u5199\u8f6c\u6362markdown\u683c\u5f0f\u7684\u4ee3\u7801\uff0c\u5f00\u53d1\u6210\u672c\u8f83\u9ad8\u3002</li> </ul> <p>\u6240\u6709\u8fd9\u4e9b\u5de5\u5177\u90fd\u65e0\u6cd5\u4fdd\u8bc1\u5c06pdf\u6587\u4ef6\u548cdocx\u6587\u4ef6\u51c6\u786e\u5730\u8f6c\u6362\u6210markdown\u683c\u5f0f\uff0c\u6240\u4ee5\u5728\u5b9e\u9645\u5e94\u7528\u65f6\uff0c\u5e94\u8be5\u6dfb\u52a0\u4e00\u4e2a\u4eba\u5de5\u9a8c\u8bc1\u548c\u4fee\u6539\u7684\u5165\u53e3\uff0c\u6bd4\u5982\u5728\u6784\u5efaRAG\u7d22\u5f15\u65f6\uff0c\u5148\u901a\u8fc7\u5de5\u5177\u8f6c\u6362\u6210markdown\u683c\u5f0f\uff0c\u7528\u6237\u53ef\u4ee5\u9884\u89c8\u548c\u4fee\u6539\u8f6c\u6362\u540e\u7684markdown\u5185\u5bb9\uff08\u4fee\u6b63\u6807\u9898\u548c\u8868\u683c\u7b49\u8f6c\u6362\u9519\u8bef\u7684\u5185\u5bb9\uff09\uff0c\u786e\u8ba4\u65e0\u8bef\u540e\u518d\u8fdb\u884c\u540e\u7eed\u7684chunk\u5207\u5206\u903b\u8f91\u3002</p> <p>\u5728RAG\u5e94\u7528\u4e2d\u540c\u6837\u9075\u5faa\u5783\u573e\u8f93\u5165\uff0c\u5783\u573e\u8f93\u51fa\uff0c\u5982\u679c\u5728\u6700\u5f00\u59cb\u6784\u5efa\u7d22\u5f15\u65f6\uff0c\u5b58\u5728\u9519\u8bef\u7684\u6570\u636e\uff0c\u6bd4\u5982\u67d0\u4e2a\u8868\u683c\u7684\u6570\u636e\u63d0\u53d6\u9519\u8bef\uff0c\u90a3\u4e48\u4f1a\u5bfc\u81f4\u6574\u4e2a\u5e94\u7528\u7684\u56de\u7b54\u51c6\u786e\u6027\u4e0b\u964d\u3002</p> <p>\u672c\u6587\u65f6RAG\u4f18\u5316\u7cfb\u5217\u7684\u7b2c\u4e00\u7bc7\u6587\u7ae0\uff0c\u540e\u7eed\u4f1a\u7ee7\u7eed\u66f4\u65b0\uff0c\u7531\u4e8e\u77e5\u8bc6\u7684\u5c40\u9650\u6027\u6587\u4e2d\u53ef\u80fd\u5b58\u5728\u9519\u8bef\u7684\u7ed3\u8bba\uff0c\u6b22\u8fce\u8bc4\u8bba\u6307\u51fa\uff0c\u5982\u679c\u89c9\u5f97\u672c\u6587\u6709\u5e2e\u5fd9\uff0c\u4e5f\u6b22\u8fce\u70b9\u8d5e\u8bc4\u8bba\u3002</p> <p>\u53c2\u8003\u6587\u6863</p> <ol> <li>https://github.com/microsoft/markitdown</li> <li>https://github.com/docling-project/docling</li> <li>https://github.com/lakinduboteju/langchain-pymupdf4llm</li> <li>https://github.com/VikParuchuri/marker</li> <li>https://github.com/pymupdf/RAG</li> </ol>"},{"location":"rag/%E4%BD%BF%E7%94%A8Nanonets-OCR-s%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0PDF%E6%96%87%E4%BB%B6%E8%BD%ACmarkdown/","title":"\u4f7f\u7528Nanonets-OCR-s\u6a21\u578b\u5b9e\u73b0PDF\u6587\u4ef6\u8f6cmarkdown","text":"<p>\u6700\u8fd1\u770b\u5230\u5728 huggingface \u770b\u5230\u4e00\u4e2a\u6a21\u578b Nanonets-OCR-s\uff0c\u4ece\u5b83\u7684\u4ecb\u7ecd\u4e2d\u4e86\u89e3\u5230\uff0c\u8fd9\u4e2a\u6a21\u578b\u662f\u4e00\u4e2a\u5148\u8fdb\u7684\u56fe\u50cf\u8f6c Markdown OCR \u6a21\u578b\uff0c\u5176\u529f\u80fd\u8fdc\u8d85\u4f20\u7edf\u7684\u6587\u672c\u63d0\u53d6\u3002\u4e3a\u4e86\u9a8c\u8bc1\u8be5\u6a21\u578b\u7684\u6548\u679c\uff0c\u6253\u7b97\u4f7f\u7528\u8be5\u6a21\u578b\u5b9e\u73b0\u4e86\u4e00\u4e2a PDF \u6587\u4ef6\u8f6c Markdown \u7684\u529f\u80fd\uff0c\u672c\u6587\u4e3b\u8981\u5c06\u9a8c\u8bc1\u7684\u8fc7\u7a0b\u8bb0\u5f55\u4e0b\u6765\u3002\u901a\u8fc7\u672c\u6587\u7684\u5185\u5bb9\u4f60\u5c06\u4e86\u89e3\u5982\u4e0b\u5185\u5bb9</p> <ul> <li>Nanonets-OCR-s\u6a21\u578b\u57fa\u672c\u4ecb\u7ecd</li> <li>\u5982\u4f55\u4e0b\u8f7dNanonets-OCR-s\u6a21\u578b</li> <li>\u5982\u4f55\u4f7f\u7528vllm\u542f\u52a8Nanonets-OCR-s\u6a21\u578b</li> <li>\u5982\u4f55\u5b9e\u73b0PDF\u6587\u4ef6\u8f6cMarkdown\u7684\u529f\u80fd</li> </ul> <p>\u5728\u7ee7\u7eed\u672c\u6587\u7684\u5185\u5bb9\u4e4b\u524d\uff0c\u9996\u5148\u770b\u4e00\u4e0b\u4f7f\u7528\u8be5\u6a21\u578b\u5c06 PDF \u6587\u4ef6\u8f6c\u6362\u4e3a Markdown \u6587\u4ef6\u7684\u6548\u679c\u3002 \u8fd9\u91cc\u4f7f\u7528 Attention Is All You Need \u8bba\u6587\u7684PDF\u6587\u4ef6\u8fdb\u884c\u6d4b\u8bd5\uff0c\u8f6c\u6362\u4e3amarkdown\u6587\u4ef6\uff0c\u6548\u679c\u5982\u4e0b\uff1a</p> \u7279\u6027 \u8f6c\u6362\u6548\u679c \u8bc6\u522b\u6c34\u5370 \u8bc6\u522b\u9875\u7801 \u8bc6\u522b\u516c\u5f0f \u8bc6\u522b\u8868\u683c \u8bc6\u522b\u8868\u683c \u8bc6\u522b\u56fe\u7247\u5185\u5bb9 <p>\u4ece\u524d\u9762\u7684\u6548\u679c\u53ef\u4ee5\u770b\u5230\uff0c Nanonets-OCR-s \u6a21\u578b\u80fd\u591f\u8bc6\u522b\u51fa PDF \u6587\u4ef6\u4e2d\u7684\u6c34\u5370\u3001\u516c\u5f0f\u3001\u8868\u683c\u3001\u56fe\u7247\u5185\u5bb9\u7b49\u4fe1\u606f\uff0c\u5e76\u4e14\u5c06\u8fd9\u4e9b\u4fe1\u606f\u8f6c\u6362\u4e3a Markdown \u683c\u5f0f\u3002\u4f46\u662f\u5728\u8bc6\u522b\u590d\u6742\u8868\u683c\u65f6\uff0c\u6709\u90e8\u5206\u8868\u683c\u7684\u5185\u5bb9\u4f4d\u7f6e\u8bc6\u522b\u9519\u8bef\u3002</p>"},{"location":"rag/%E4%BD%BF%E7%94%A8Nanonets-OCR-s%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0PDF%E6%96%87%E4%BB%B6%E8%BD%ACmarkdown/#nanonets-ocr-s","title":"Nanonets-OCR-s\u6a21\u578b\u4ecb\u7ecd","text":""},{"location":"rag/%E4%BD%BF%E7%94%A8Nanonets-OCR-s%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0PDF%E6%96%87%E4%BB%B6%E8%BD%ACmarkdown/#_1","title":"\u4ea7\u54c1\u6838\u5fc3","text":"<p>Nanonets-OCR-s\u2014\u2014\u56fe\u50cf\u8f6cMarkdown OCR\u6a21\u578b\uff0c\u7a81\u7834\u4f20\u7edf\u6587\u672c\u63d0\u53d6\u5c40\u9650\uff0c\u5177\u5907\u8bed\u4e49\u7406\u89e3\u548c\u7ed3\u6784\u5316\u8f93\u51fa\u80fd\u529b\u3002</p>"},{"location":"rag/%E4%BD%BF%E7%94%A8Nanonets-OCR-s%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0PDF%E6%96%87%E4%BB%B6%E8%BD%ACmarkdown/#ocr","title":"\u4f20\u7edfOCR\u75db\u70b9","text":"<ul> <li>\u4ec5\u63d0\u53d6\u7eaf\u6587\u672c\uff0c\u5ffd\u7565\u6c34\u5370/\u7b7e\u540d/\u9875\u7801\u7b49\u5143\u7d20</li> <li>\u65e0\u6cd5\u5904\u7406\u56fe\u50cf\u3001\u8868\u683c\u3001\u516c\u5f0f\u7b49\u590d\u6742\u7ed3\u6784</li> <li>\u8f93\u51fa\u7f3a\u4e4f\u4e0a\u4e0b\u6587\uff0c\u96be\u4ee5\u76f4\u63a5\u7528\u4e8e\u4e0b\u6e38\u4efb\u52a1</li> </ul>"},{"location":"rag/%E4%BD%BF%E7%94%A8Nanonets-OCR-s%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0PDF%E6%96%87%E4%BB%B6%E8%BD%ACmarkdown/#_2","title":"\u6838\u5fc3\u7a81\u7834","text":"<p>\u8bed\u4e49\u5316\u6807\u8bb0\u8f93\u51fa\uff1a\u7406\u89e3\u6587\u6863\u7ed3\u6784\u4e0e\u4e0a\u4e0b\u6587\uff08\u8868\u683c/\u516c\u5f0f/\u56fe\u50cf/\u6c34\u5370/\u590d\u9009\u6846\u7b49\uff09\uff0c\u751f\u6210\u53ef\u76f4\u63a5\u88ab\u5927\u6a21\u578b\u5904\u7406\u7684Markdown\u3002</p>"},{"location":"rag/%E4%BD%BF%E7%94%A8Nanonets-OCR-s%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0PDF%E6%96%87%E4%BB%B6%E8%BD%ACmarkdown/#_3","title":"\u516d\u5927\u6838\u5fc3\u80fd\u529b","text":"<ol> <li>LaTeX\u516c\u5f0f\u8bc6\u522b </li> <li>\u6570\u5b66\u516c\u5f0f\u81ea\u52a8\u8f6cLaTeX\u8bed\u6cd5\uff08\u884c\u5185/\u72ec\u7acb\u516c\u5f0f\uff09</li> <li>\u667a\u80fd\u56fe\u50cf\u63cf\u8ff0 </li> <li>\u7528<code>&lt;img&gt;</code>\u6807\u7b7e\u63cf\u8ff0\u56fe\u50cf\u5185\u5bb9/\u98ce\u683c/\u4e0a\u4e0b\u6587\uff08\u652f\u6301\u56fe\u8868/\u4e8c\u7ef4\u7801\u7b49\uff09</li> <li>\u7b7e\u540d\u68c0\u6d4b\u9694\u79bb </li> <li>\u901a\u8fc7<code>&lt;signature&gt;</code>\u6807\u7b7e\u5206\u79bb\u7b7e\u540d\uff08\u5173\u952e\u6cd5\u5f8b/\u5546\u4e1a\u7528\u9014\uff09</li> <li>\u6c34\u5370\u63d0\u53d6 </li> <li>\u7528<code>&lt;watermark&gt;</code>\u6807\u7b7e\u63d0\u53d6\u6c34\u5370\u6587\u672c</li> <li>\u590d\u9009\u6846\u5904\u7406 </li> <li>\u5c06\u590d\u9009\u6846\u8f6c\u4e3aUnicode\u7b26\u53f7\uff08<code>&lt;checkbox&gt;</code>\u6807\u7b7e\u6807\u8bb0\u72b6\u6001\uff09</li> <li>\u590d\u6742\u8868\u683c\u63d0\u53d6 </li> <li>\u8868\u683c\u8f6cMarkdown/HTML\u683c\u5f0f\uff08\u4fdd\u7559\u7ed3\u6784\uff09</li> </ol> <p>\u5728\u4f7f\u7528\u8be5\u6a21\u578b\u65f6\uff0c\u662f\u901a\u8fc7\u5982\u4e0bprompt\u63a7\u5236\u4e0a\u8ff0\u529f\u80fd\u7684\uff1a <pre><code>messages=[\n            {\n                \"role\": \"user\",\n                \"content\": [\n                    {\n                        \"type\": \"image_url\",\n                        \"image_url\": {\"url\": f\"data:image/png;base64,{img_base64}\"},\n                    },\n                    {\n                        \"type\": \"text\",\n                        \"text\": \"Extract the text from the above document as if you were reading it naturally. Return the tables in html format. Return the equations in LaTeX representation. If there is an image in the document and image caption is not present, add a small description of the image inside the &lt;img&gt;&lt;/img&gt; tag; otherwise, add the image caption inside &lt;img&gt;&lt;/img&gt;. Watermarks should be wrapped in brackets. Ex: &lt;watermark&gt;OFFICIAL COPY&lt;/watermark&gt;. Page numbers should be wrapped in brackets. Ex: &lt;page_number&gt;14&lt;/page_number&gt; or &lt;page_number&gt;9/22&lt;/page_number&gt;. Prefer using \u2610 and \u2611 for check boxes.\",\n                    },\n                ],\n            }\n        ]\n</code></pre></p>"},{"location":"rag/%E4%BD%BF%E7%94%A8Nanonets-OCR-s%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0PDF%E6%96%87%E4%BB%B6%E8%BD%ACmarkdown/#_4","title":"\u6280\u672f\u7ec6\u8282","text":"<ul> <li>\u8bad\u7ec3\u6570\u636e\uff1a25\u4e07+\u9875\u6587\u6863\uff08\u7814\u7a76\u8bba\u6587/\u8d22\u52a1/\u6cd5\u5f8b/\u533b\u7597/\u7a0e\u52a1\u8868\u5355\u7b49\uff09</li> <li>\u6570\u636e\u7ec4\u6210\uff1a\u5408\u6210\u6570\u636e\u9884\u8bad\u7ec3 + \u4eba\u5de5\u6807\u6ce8\u6570\u636e\u5fae\u8c03</li> <li>\u57fa\u7840\u6a21\u578b\uff1a\u57fa\u4e8eQwen2.5-VL-3B\u89c6\u89c9\u8bed\u8a00\u6a21\u578b\u4f18\u5316</li> </ul>"},{"location":"rag/%E4%BD%BF%E7%94%A8Nanonets-OCR-s%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0PDF%E6%96%87%E4%BB%B6%E8%BD%ACmarkdown/#_5","title":"\u5c40\u9650\u6027","text":"<ul> <li>\u274c \u4e0d\u652f\u6301\u624b\u5199\u6587\u672c\u8bc6\u522b</li> <li>\u26a0\ufe0f \u53ef\u80fd\u4ea7\u751f\u5185\u5bb9\u5e7b\u89c9\uff08hallucination\uff09</li> </ul>"},{"location":"rag/%E4%BD%BF%E7%94%A8Nanonets-OCR-s%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0PDF%E6%96%87%E4%BB%B6%E8%BD%ACmarkdown/#_6","title":"\u5e94\u7528\u573a\u666f","text":"\u9886\u57df \u4ef7\u503c \u5b66\u672f\u7814\u7a76 \u8bba\u6587\u516c\u5f0f/\u8868\u683c\u6570\u5b57\u5316 \u6cd5\u5f8b\u91d1\u878d \u5408\u540c\u7b7e\u540d/\u8d22\u52a1\u8868\u683c\u63d0\u53d6 \u533b\u7597\u5236\u836f \u533b\u7597\u8868\u5355\u590d\u9009\u6846/\u6587\u672c\u8bc6\u522b \u4f01\u4e1a\u7ea7\u5e94\u7528 \u62a5\u544a\u8f6c\u53ef\u641c\u7d22\u7684\u77e5\u8bc6\u5e93"},{"location":"rag/%E4%BD%BF%E7%94%A8Nanonets-OCR-s%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0PDF%E6%96%87%E4%BB%B6%E8%BD%ACmarkdown/#_7","title":"\u4ea7\u54c1\u5b9a\u4f4d","text":"<p>\u89e3\u51b3LLM\u65f6\u4ee3\u7684\u6838\u5fc3\u74f6\u9888\uff1a\u5c06\u975e\u7ed3\u6784\u5316\u6587\u6863\u8f6c\u5316\u4e3a\u5bcc\u542b\u4e0a\u4e0b\u6587\u7684\u6e05\u6d01Markdown\u6570\u636e\uff0c\u6253\u901aAI\u81ea\u52a8\u5316\u5173\u952e\u94fe\u8def\u3002</p> <p>\u53c2\u8003\u6587\u6863 Nanonets OCR Small</p>"},{"location":"rag/%E4%BD%BF%E7%94%A8Nanonets-OCR-s%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0PDF%E6%96%87%E4%BB%B6%E8%BD%ACmarkdown/#nanonets-ocr-s_1","title":"\u4e0b\u8f7dNanonets-OCR-s\u6a21\u578b","text":"<p>\u4f7f\u7528\u4e0b\u9762\u7684\u4ee3\u7801\u4ece modelscope \u4e0b\u8f7dNanonets-OCR-s\u6a21\u578b\uff1a</p> <p>\u5728\u4e0b\u8f7d\u524d\uff0c\u8bf7\u5148\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u5b89\u88c5ModelScope <pre><code>pip install modelscope\n</code></pre> \u4f7f\u7528\u4e0b\u9762\u7684python\u4ee3\u7801\u4e0b\u8f7d\u6a21\u578b\u5230\u6307\u5b9a\u7684\u76ee\u5f55\u4e2d\uff1a <pre><code>    #\u6a21\u578b\u4e0b\u8f7d\n    from modelscope import snapshot_download\n    model_dir = snapshot_download('nanonets/Nanonets-OCR-s', local_dir='./model')\n    print(model_dir)\n</code></pre></p>"},{"location":"rag/%E4%BD%BF%E7%94%A8Nanonets-OCR-s%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0PDF%E6%96%87%E4%BB%B6%E8%BD%ACmarkdown/#_8","title":"\u5b89\u88c5\u76f8\u5173\u4f9d\u8d56","text":"<p>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u5b89\u88c5\u76f8\u5173\u4f9d\u8d56\uff1a <pre><code>pip install PyMuPDF vllm litellm\n</code></pre> \u4f9d\u8d56\u8bf4\u660e\uff1a - <code>PyMuPDF</code>\uff1a\u7528\u4e8e\u5c06 PDF \u6587\u4ef6\u8f6c\u6362\u4e3a\u56fe\u7247 - <code>vllm</code>\uff1a\u7528\u4e8e\u542f\u52a8\u6a21\u578b\uff0c\u63d0\u4f9b OpenAI \u7684 Completions API\u517c\u5bb9\u7684 HTTP \u670d\u52a1\u63a5\u53e3 - <code>litellm</code>\uff1a\u7528\u4e8e\u8c03\u7528\u6a21\u578b</p>"},{"location":"rag/%E4%BD%BF%E7%94%A8Nanonets-OCR-s%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0PDF%E6%96%87%E4%BB%B6%E8%BD%ACmarkdown/#vllm","title":"\u4f7f\u7528vllm\u542f\u52a8\u6a21\u578b","text":"<p>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u542f\u52a8\u6a21\u578b <pre><code>vllm serve ./Nanonets-OCR-s/ --served-model-name openai/Nanonets-OCR-s --chat-template ./template_dse_qwen2_vl.jinja\n</code></pre> \u53c2\u6570\u8bf4\u660e\uff1a - <code>--served-model-name</code>\uff1a\u6307\u5b9a\u6a21\u578b\u540d\u79f0\uff0c\u7528\u4e8e\u540e\u7eed\u8c03\u7528 - <code>--chat-template</code>\uff1a\u6307\u5b9achat\u6a21\u677f\u6587\u4ef6\u8def\u5f84\uff0cvLLM \u793e\u533a\u4e3a\u70ed\u95e8\u6a21\u578b\u63d0\u4f9b\u4e86\u4e00\u5957\u804a\u5929\u6a21\u677f\uff0c\u53ef\u4ee5\u5728example\u76ee\u5f55\u4e0b\u627e\u5230\u5b83\u4eec\u3002</p> <p>vLLM \u63d0\u4f9b\u4e86\u4e00\u4e2a HTTP \u670d\u52a1\u5668\uff0c\u5b9e\u73b0\u4e86 OpenAI \u7684 Completions API\u3001Chat API \u7b49\uff0c\u6b64\u529f\u80fd\u5141\u8bb8\u4f7f\u7528 HTTP \u5ba2\u6237\u7aef\u63d0\u4f9b\u6a21\u578b\u5e76\u4e0e\u6a21\u578b\u4ea4\u4e92\u3002</p>"},{"location":"rag/%E4%BD%BF%E7%94%A8Nanonets-OCR-s%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0PDF%E6%96%87%E4%BB%B6%E8%BD%ACmarkdown/#_9","title":"\u4ee3\u7801\u5b9e\u73b0","text":"<p>\u4e0b\u9762\u7684\u4ee3\u7801\u5b9e\u73b0\u4e86\u5c06 PDF \u6587\u4ef6\u8f6c\u6362\u4e3a Markdown \u6587\u4ef6\u7684\u529f\u80fd\u3002</p> <pre><code># -*- encoding: utf-8 -*-\nimport pymupdf  # PyMuPDF\nimport os\nfrom PIL import Image\n\nimport litellm\nimport base64\n\n\ndef encode_image(image_path):\n    with open(image_path, \"rb\") as image_file:\n        return base64.b64encode(image_file.read()).decode(\"utf-8\")\n\ndef get_image_encoding_type(image_path: str) -&gt; str:\n    if image_path.endswith(\".png\"):\n        return \"data:image/png;base64\"\n    elif image_path.endswith(\".jpg\") or image_path.endswith(\".jpeg\"):\n        return \"data:image/jpeg;base64\"\n    else:\n        raise ValueError(f\"Unsupported image format: {image_path}\")\n\n\ndef covert_image_to_markdown(image_path):\n    print(f'\u5f00\u59cb\u5904\u7406\u56fe\u7247: {image_path}')\n    img_base64 = encode_image(image_path)\n    image_encoding_type = get_image_encoding_type(image_path)\n    messages=[\n        {\n            \"role\": \"user\",\n            \"content\": [\n                {\n                    \"type\": \"image_url\",\n                    \"image_url\": {\"url\": f\"{image_encoding_type},{img_base64}\"},\n                },\n                {\n                    \"type\": \"text\",\n                    \"text\": \"Extract the text from the above document as if you were reading it naturally. Return the tables in html format. Return the equations in LaTeX representation. If there is an image in the document and image caption is not present, add a small description of the image inside the &lt;img&gt;&lt;/img&gt; tag; otherwise, add the image caption inside &lt;img&gt;&lt;/img&gt;. Watermarks should be wrapped in brackets. Ex: &lt;watermark&gt;OFFICIAL COPY&lt;/watermark&gt;. Page numbers should be wrapped in brackets. Ex: &lt;page_number&gt;14&lt;/page_number&gt; or &lt;page_number&gt;9/22&lt;/page_number&gt;. Prefer using \u2610 and \u2611 for check boxes.\",\n                },\n            ],\n        }\n    ]\n    # hosted_vllm is prefix key word and necessary\n    response = litellm.completion(\n        model=\"hosted_vllm/openai/Nanonets-OCR-s\", # pass the vllm model name\n        messages=messages,\n        api_base=\"http://localhost:8000/v1\",\n        temperature=0.0,\n        max_tokens=15000)\n\n    return response[\"choices\"][0][\"message\"][\"content\"]\n\ndef pdf_to_images(pdf_path, output_folder, image_format='png', zoom=2):\n    \"\"\"\n    \u5c06PDF\u6bcf\u9875\u8f6c\u6362\u4e3a\u5355\u72ec\u7684\u56fe\u7247\n\n    \u53c2\u6570:\n        pdf_path: PDF\u6587\u4ef6\u8def\u5f84\n        output_folder: \u8f93\u51fa\u56fe\u7247\u7684\u6587\u4ef6\u5939\n        image_format: \u56fe\u7247\u683c\u5f0f ('PNG' \u6216 'JPEG')\n        zoom: \u7f29\u653e\u56e0\u5b50(\u63d0\u9ad8\u5206\u8fa8\u7387)\uff0c\u9ed8\u8ba42=2\u500d\n    \"\"\"\n    # \u786e\u4fdd\u8f93\u51fa\u76ee\u5f55\u5b58\u5728\n    os.makedirs(output_folder, exist_ok=True)\n\n    # \u6253\u5f00PDF\u6587\u4ef6\n    pdf_document = pymupdf.open(pdf_path)\n    page_image_paths = []\n    # \u904d\u5386\u6bcf\u4e00\u9875\n    for page_num in range(len(pdf_document)):\n        page = pdf_document.load_page(page_num)\n\n        # \u521b\u5efa\u7f29\u653e\u77e9\u9635\u63d0\u9ad8\u5206\u8fa8\u7387\n        matrix = pymupdf.Matrix(zoom, zoom)\n\n        # \u6e32\u67d3\u9875\u9762\u4e3a\u56fe\u50cf (pix\u5bf9\u8c61)\n        pix = page.get_pixmap(matrix=matrix)\n\n        # \u8f6c\u6362\u4e3aPIL Image\u5bf9\u8c61\u4ee5\u4fbf\u5904\u7406\n        img = Image.frombytes(\"RGB\", (pix.width, pix.height), pix.samples)\n\n        # \u6784\u5efa\u8f93\u51fa\u8def\u5f84\n        output_path = os.path.join(output_folder, f\"page_{page_num+1}.{image_format.lower()}\")\n\n        # \u4fdd\u5b58\u56fe\u50cf\n        img.save(output_path, format=image_format)\n        page_image_paths.append(output_path)\n        print(f\"\u5df2\u4fdd\u5b58: {output_path}\")\n\n\n    print(f\"\\n\u8f6c\u6362\u5b8c\u6210! \u5171\u8f6c\u6362 {len(pdf_document)} \u9875\u3002\")\n    pdf_document.close()\n    return page_image_paths\n\n\n\n# \u4f7f\u7528\u793a\u4f8b\nif __name__ == \"__main__\":\n    import time\n    from pathlib import Path\n    # \u914d\u7f6e\u53c2\u6570\n    pdf_file = \"Attention-Is-All-You-Need.pdf\"  # \u66ff\u6362\u4e3a\u4f60\u7684PDF\u6587\u4ef6\u8def\u5f84\n    output_dir = \"output_images\"  # \u8f93\u51fa\u6587\u4ef6\u5939\n\n    file_name = Path(pdf_file).stem\n    # \u8c03\u7528\u8f6c\u6362\u51fd\u6570\n    page_image_paths = pdf_to_images(pdf_path=pdf_file, output_folder=output_dir)\n    # page_image_paths = ['output_images2/page_9.png']\n    print(page_image_paths)\n    markdown_contents = []\n    for page_image_path in page_image_paths:\n        md_content = covert_image_to_markdown(page_image_path)\n        print(md_content)\n        time.sleep(5)\n        markdown_contents.append(md_content)\n    # \u5c06markdown\u5185\u5bb9\u5199\u5165\u6587\u4ef6\n    output_path = f'{file_name}.md'\n    with open(output_path, \"w\") as f:\n        f.write(\"\\n\\n\".join(markdown_contents))\n\n    print(f\"Markdown\u5185\u5bb9\u5df2\u4fdd\u5b58\u5230{output_path}\")\n</code></pre>"},{"location":"rag/%E4%BD%BF%E7%94%A8Nanonets-OCR-s%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0PDF%E6%96%87%E4%BB%B6%E8%BD%ACmarkdown/#_10","title":"\u95ee\u9898\u8bb0\u5f55","text":""},{"location":"rag/%E4%BD%BF%E7%94%A8Nanonets-OCR-s%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0PDF%E6%96%87%E4%BB%B6%E8%BD%ACmarkdown/#vllm_1","title":"\u4f7f\u7528 vllm \u542f\u52a8\u6a21\u578b\u5931\u8d25","text":""},{"location":"rag/%E4%BD%BF%E7%94%A8Nanonets-OCR-s%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0PDF%E6%96%87%E4%BB%B6%E8%BD%ACmarkdown/#1-cuda","title":"1. CUDA \u7248\u672c\u4e0d\u5339\u914d","text":"<p>\u542f\u52a8\u547d\u4ee4</p> <p><pre><code>vllm serve ./Nanonets-OCR-s\n</code></pre> \u62a5\u9519\u4fe1\u606f</p> <pre><code>RuntimeError: CUDA error: no kernel image is available for execution on the device\n</code></pre> <p>\u539f\u56e0\u5206\u6790</p> <p>\u6211\u4eec\u9047\u5230\u4e86\u4e00\u4e2aCUDA\u9519\u8bef\uff1a<code>no kernel image is available for execution on the device</code>\u3002\u8fd9\u4e2a\u9519\u8bef\u901a\u5e38\u8868\u793a\u5f53\u524d\u8bbe\u5907\uff08GPU\uff09\u6ca1\u6709\u53ef\u7528\u7684\u5185\u6838\u955c\u50cf\u3002\u8fd9\u53ef\u80fd\u662f\u7531\u4e8e\u4ee5\u4e0b\u51e0\u79cd\u539f\u56e0\uff1a 1. CUDA\u67b6\u6784\u4e0d\u5339\u914d\uff1a\u4f60\u7f16\u8bd1\u7684PyTorch\uff08\u6216\u5176\u4ed6\u6846\u67b6\uff09\u7248\u672c\u4e0d\u652f\u6301\u4f60\u7684GPU\u67b6\u6784\u3002\u4f8b\u5982\uff0c\u4f60\u7684GPU\u662f\u8f83\u65b0\u7684\u67b6\u6784\uff08\u5982Ampere\uff0c\u8ba1\u7b97\u80fd\u529b8.0\u4ee5\u4e0a\uff09\uff0c\u4f46\u5b89\u88c5\u7684PyTorch\u7248\u672c\u662f\u5728\u8be5\u67b6\u6784\u53d1\u5e03\u4e4b\u524d\u7f16\u8bd1\u7684\uff0c\u56e0\u6b64\u4e0d\u5305\u542b\u9488\u5bf9\u8be5\u67b6\u6784\u7684\u5185\u6838\u3002 2. \u5b89\u88c5\u7684PyTorch\u7248\u672c\u4e0d\u652f\u6301GPU\uff1a\u4f60\u53ef\u80fd\u5b89\u88c5\u4e86CPU\u7248\u672c\u7684PyTorch\u3002 3. CUDA\u5de5\u5177\u5305\u7248\u672c\u4e0d\u5339\u914d\uff1a\u4f60\u7684CUDA\u5de5\u5177\u5305\u7248\u672c\u4e0ePyTorch\u7f16\u8bd1\u65f6\u4f7f\u7528\u7684\u7248\u672c\u4e0d\u5339\u914d\u3002 4. \u9a71\u52a8\u7a0b\u5e8f\u8fc7\u65e7\uff1aGPU\u9a71\u52a8\u7a0b\u5e8f\u7248\u672c\u592a\u65e7\uff0c\u4e0d\u652f\u6301\u5f53\u524dCUDA\u7248\u672c\u3002</p> <p>\u89e3\u51b3\u6b65\u9aa4 1. \u786e\u8ba4GPU\u578b\u53f7\u548c\u8ba1\u7b97\u80fd\u529b \u9996\u5148\uff0c\u786e\u5b9a\u4f60\u7684GPU\u578b\u53f7\u548c\u8ba1\u7b97\u80fd\u529b\uff08Compute Capability\uff09\u3002\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u67e5\u770b\uff08\u9700\u8981\u5b89\u88c5NVIDIA\u9a71\u52a8\uff09\uff1a <pre><code>nvidia-smi\n</code></pre> \u7136\u540e\uff0c\u6839\u636e\u578b\u53f7\u67e5\u627e\u8ba1\u7b97\u80fd\u529b\uff08\u4f8b\u5982\uff0cRTX 30\u7cfb\u5217\u901a\u5e38\u662fAmpere\u67b6\u6784\uff0c\u8ba1\u7b97\u80fd\u529b8.0+\uff09\u3002</p> <ol> <li> <p>\u786e\u8ba4PyTorch\u5b89\u88c5\u7248\u672c \u5728Python\u4e2d\u8fd0\u884c\uff1a <pre><code>import torch\nprint(torch.__version__)\nprint(torch.version.cuda)  # \u67e5\u770bPyTorch\u7f16\u8bd1\u65f6\u4f7f\u7528\u7684CUDA\u7248\u672c\nprint(torch.cuda.is_available())  # \u68c0\u67e5CUDA\u662f\u5426\u53ef\u7528\nprint(torch.cuda.get_device_name(0))  # \u83b7\u53d6GPU\u8bbe\u5907\u540d\u79f0\nprint(torch.cuda.get_device_capability(0))  # \u83b7\u53d6\u8ba1\u7b97\u80fd\u529b\uff0c\u5982(8,0)\n</code></pre></p> </li> <li> <p>\u68c0\u67e5PyTorch\u662f\u5426\u652f\u6301\u4f60\u7684GPU\u67b6\u6784 \u8bbf\u95eePyTorch\u5b98\u65b9\u7f51\u7ad9\uff0c\u67e5\u770b\u4f60\u5b89\u88c5\u7684PyTorch\u7248\u672c\u6240\u652f\u6301\u7684CUDA\u7248\u672c\u4ee5\u53ca\u5bf9\u5e94\u7684\u67b6\u6784\u3002</p> </li> </ol> <p>\u6839\u636e\u4e0a\u8ff0\u4fe1\u606f\uff0c\u91c7\u53d6\u4ee5\u4e0b\u63aa\u65bd\uff1a - \u60c5\u51b51\uff1aPyTorch\u4e0d\u652f\u6301\u4f60\u7684GPU\u67b6\u6784   \u4f8b\u5982\uff0c\u4f60\u7684GPU\u8ba1\u7b97\u80fd\u529b\u662f8.0\uff08Ampere\u67b6\u6784\uff09\uff0c\u800c\u5b89\u88c5\u7684PyTorch\u7248\u672c\uff08\u59821.7.0\uff09\u662f\u5728Ampere\u53d1\u5e03\u4e4b\u524d\u7f16\u8bd1\u7684\uff0c\u56e0\u6b64\u6ca1\u6709\u5305\u542b\u9488\u5bf9sm_80\u7684\u5185\u6838\u3002   \u89e3\u51b3\u65b9\u6cd5\uff1a\u5b89\u88c5\u652f\u6301\u4f60GPU\u67b6\u6784\u7684PyTorch\u7248\u672c\u3002\u901a\u5e38\uff0cPyTorch 1.8.0\u53ca\u4ee5\u4e0a\u7248\u672c\u652f\u6301Ampere\u67b6\u6784\uff08sm_80\u53ca\u4ee5\u4e0a\uff09\u3002\u5efa\u8bae\u5b89\u88c5\u6700\u65b0\u7248\u672c\u7684PyTorch\u3002</p> <p>\u5148\u5b89\u88c5 vllm \u8f83\u65b0\u7248\u672c   <pre><code>pip install vllm -U\n</code></pre>   \u56e0\u4e3a vllm \u4f9d\u8d56\u7684 torch \u7248\u672c\u9700\u8981\u8f83\u9ad8\uff0c\u4f7f\u7528pip\u5b89\u88c5\u4f60\u7684GPU\u67b6\u6784\u5bf9\u5e94\u7684PyTorch\uff08\u6839\u636e\u5b98\u7f51\u547d\u4ee4\uff0c\u4f8b\u5982\uff09\uff1a   <pre><code>pip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118\n</code></pre></p> <p>\u6ce8\u610f\uff1a\u8fd9\u91cc\u4f7f\u7528CUDA 11.8\uff0c\u8bf7\u6839\u636e\u4f60\u7684\u73af\u5883\u9009\u62e9\u5408\u9002\u7684CUDA\u7248\u672c\u3002 - \u60c5\u51b52\uff1a\u5b89\u88c5\u4e86CPU\u7248\u672c\u7684PyTorch   \u5982\u679c<code>torch.cuda.is_available()</code>\u8fd4\u56deFalse\uff0c\u5e76\u4e14\u4f60\u786e\u5b9a\u6709GPU\uff0c\u90a3\u4e48\u53ef\u80fd\u662f\u5b89\u88c5\u4e86CPU\u7248\u672c\u3002   \u89e3\u51b3\u65b9\u6cd5\uff1a\u5378\u8f7d\u5f53\u524dPyTorch\uff0c\u5e76\u5b89\u88c5\u652f\u6301GPU\u7684\u7248\u672c\u3002 - \u60c5\u51b53\uff1aCUDA\u5de5\u5177\u5305\u7248\u672c\u4e0e\u9a71\u52a8\u4e0d\u5339\u914d   \u8fd0\u884c<code>nvidia-smi</code>\u67e5\u770b\u9a71\u52a8\u652f\u6301\u7684CUDA\u7248\u672c\uff08\u53f3\u4e0a\u89d2\u663e\u793a\u7684\u662f\u9a71\u52a8\u652f\u6301\u7684\u6700\u9ad8CUDA\u7248\u672c\uff09\u3002\u7136\u540e\u786e\u4fdd\u5b89\u88c5\u7684PyTorch\u6240\u4f9d\u8d56\u7684CUDA\u5de5\u5177\u5305\u7248\u672c\u4e0d\u8d85\u8fc7\u8fd9\u4e2a\u7248\u672c\u3002\u4f8b\u5982\uff0c\u5982\u679c\u4f60\u7684\u9a71\u52a8\u652f\u6301\u6700\u9ad8CUDA 11.7\uff0c\u90a3\u4e48\u4f60\u5e94\u8be5\u5b89\u88c5CUDA 11.7\u53ca\u4ee5\u4e0b\u7248\u672c\u7684PyTorch\u3002 - \u60c5\u51b54\uff1a\u66f4\u65b0NVIDIA\u9a71\u52a8   \u5982\u679c\u9a71\u52a8\u592a\u65e7\uff0c\u53ef\u80fd\u9700\u8981\u66f4\u65b0\u9a71\u52a8\u3002\u8bbf\u95eeNVIDIA\u5b98\u7f51\u4e0b\u8f7d\u5e76\u5b89\u88c5\u6700\u65b0\u9a71\u52a8\u3002</p> <p>\u603b\u7ed3 \u6700\u5e38\u89c1\u7684\u89e3\u51b3\u65b9\u6cd5\u662f\u5b89\u88c5\u4e0e\u4f60\u7684GPU\u67b6\u6784\u517c\u5bb9\u7684PyTorch\u7248\u672c\u3002\u786e\u4fdd\u5b89\u88c5\u7684PyTorch\u7248\u672c\u652f\u6301\u4f60\u7684GPU\u8ba1\u7b97\u80fd\u529b\uff0c\u5e76\u4e14CUDA\u5de5\u5177\u5305\u7248\u672c\u4e0e\u9a71\u52a8\u517c\u5bb9\u3002 \u5982\u679c\u4f60\u5df2\u7ecf\u5b89\u88c5\u4e86\u6700\u65b0\u7248\u672c\u7684PyTorch\u4f46\u4ecd\u7136\u9047\u5230\u6b64\u95ee\u9898\uff0c\u8bf7\u68c0\u67e5PyTorch\u662f\u5426\u662f\u4ece\u5b98\u65b9\u6e20\u9053\u4e0b\u8f7d\u7684\u9884\u7f16\u8bd1\u7248\u672c\uff08\u901a\u5e38\u652f\u6301\u8f83\u5e7f\u6cdb\u7684\u67b6\u6784\uff09\uff0c\u6216\u8005\u5c1d\u8bd5\u4f7f\u7528\u4e0d\u540cCUDA\u7248\u672c\u7684PyTorch\uff08\u5982\u4eceCUDA11.1\u5207\u6362\u5230CUDA11.3\u7b49\uff09\u3002 \u5e0c\u671b\u8fd9\u4e9b\u6b65\u9aa4\u80fd\u5e2e\u52a9\u4f60\u89e3\u51b3\u95ee\u9898\uff01</p>"},{"location":"rag/%E4%BD%BF%E7%94%A8Nanonets-OCR-s%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0PDF%E6%96%87%E4%BB%B6%E8%BD%ACmarkdown/#2-transformers","title":"2. transformers\u7248\u672c\u4e0d\u652f\u6301","text":"<p>\u62a5\u9519\u4fe1\u606f\u5982\u4e0b <pre><code>ValueError: Model architectures ['Qwen2_5_VLForConditionalGeneration'] are not supported for now\n</code></pre> \u89e3\u51b3\u65b9\u6cd5 \u5347\u7ea7transformers\u7248\u672c <pre><code>pip install transformers==4.50.2\n</code></pre> \u53c2\u8003\u89e3\u51b3\u6587\u6863\uff1ahttps://github.com/vllm-project/vllm/issues/12502</p>"},{"location":"rag/%E4%BD%BF%E7%94%A8Nanonets-OCR-s%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0PDF%E6%96%87%E4%BB%B6%E8%BD%ACmarkdown/#3-chat-template","title":"3. \u6ca1\u6709chat template","text":"<p>\u62a5\u9519\u4fe1\u606f\u5982\u4e0b <pre><code>BadRequestError: Error code: 400 - {'object': 'error', 'message': 'As of transformers v4.44, default chat template is no longer allowed, so you must provide a chat template if the tokenizer does not define one. None', 'type': 'BadRequestError', 'param': None, 'code': 400}\n</code></pre></p> <p>\u89e3\u51b3\u65b9\u6cd5 \u4f7f\u7528 vllm \u542f\u52a8\u6a21\u578b\u65f6\u901a\u8fc7 <code>--chat-template</code> \u53c2\u6570\u6307\u5b9a\u804a\u5929\u6a21\u7248 <pre><code>vllm serve &lt;model&gt; --chat-template ./path-to-chat-template.jinja\n</code></pre> vLLM \u793e\u533a\u4e3a\u70ed\u95e8\u6a21\u578b\u63d0\u4f9b\u4e86\u4e00\u5957\u804a\u5929\u6a21\u677f\uff0c\u53ef\u4ee5\u5728example\u76ee\u5f55\u4e0b\u627e\u5230\u5b83\u4eec\u3002</p> <p>\u53c2\u8003\u89e3\u51b3\u6587\u6863\uff1a 1. https://github.com/vllm-project/vllm/issues/17977 2. https://docs.vllm.ai/en/latest/serving/openai_compatible_server.html#chat-template_1</p>"},{"location":"rag/%E4%BD%BF%E7%94%A8Nanonets-OCR-s%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0PDF%E6%96%87%E4%BB%B6%E8%BD%ACmarkdown/#4-pandas","title":"4. pandas \u7248\u672c\u4e0d\u517c\u5bb9","text":"<p>\u62a5\u9519\u4fe1\u606f\u5982\u4e0b <pre><code>  File \"/opt/conda/lib/python3.10/site-packages/pandas/util/_decorators.py\", line 14, in &lt;module&gt;\n    from pandas._libs.properties import cache_readonly\n  File \"/opt/conda/lib/python3.10/site-packages/pandas/_libs/__init__.py\", line 13, in &lt;module&gt;\n    from pandas._libs.interval import Interval\n  File \"pandas/_libs/interval.pyx\", line 1, in init pandas._libs.interval\nValueError: numpy.dtype size changed, may indicate binary incompatibility. Expected 96 from C header, got 88 from PyObject\n</code></pre> \u89e3\u51b3\u65b9\u6cd5 \u5347\u7ea7 pandas \u7248\u672c <pre><code>pip install pandas -U \n</code></pre></p>"},{"location":"rag/%E4%BD%BF%E7%94%A8Nanonets-OCR-s%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0PDF%E6%96%87%E4%BB%B6%E8%BD%ACmarkdown/#_11","title":"\u53c2\u8003\u6587\u6863","text":"<ol> <li>Nanonets OCR \u6a21\u578b\u4ecb\u7ecd</li> <li>\u4ecemodelscope\u4e0b\u8f7d\u6a21\u578b</li> <li>\u4f7f\u7528 vllm \u63d0\u4f9bopenai\u517c\u5bb9\u7684\u63a5\u53e3</li> <li>\u4f7f\u7528docext\u5b9e\u73b0pdf\u8f6cmarkdown</li> <li>\u5b89\u88c5pytorch\u7248\u672c\u53c2\u8003</li> </ol>"},{"location":"springboot/Spring%20Boot%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20Validation/","title":"Spring Boot \u4e2d\u4f7f\u7528 Validation","text":"<p>\u5728 Spring Boot \u4e2d\u4f7f\u7528 Validation \u53ef\u4ee5\u8f7b\u677e\u5b9e\u73b0\u6570\u636e\u6821\u9a8c\u529f\u80fd\uff0c\u786e\u4fdd\u5e94\u7528\u7a0b\u5e8f\u63a5\u6536\u7684\u6570\u636e\u7b26\u5408\u9884\u671f\u683c\u5f0f\u548c\u4e1a\u52a1\u89c4\u5219\u3002</p>"},{"location":"springboot/Spring%20Boot%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20Validation/#_1","title":"\u5b8c\u6574\u5b9e\u73b0\u65b9\u6848","text":""},{"location":"springboot/Spring%20Boot%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20Validation/#1","title":"1. \u6dfb\u52a0\u4f9d\u8d56","text":"<p>\u5728 <code>pom.xml</code> \u4e2d\u6dfb\u52a0\u5fc5\u8981\u7684\u4f9d\u8d56\uff1a</p> <pre><code>&lt;dependencies&gt;\n    &lt;!-- Spring Boot Starter Web --&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n\n    &lt;!-- Validation Starter --&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-validation&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n&lt;/dependencies&gt;\n</code></pre>"},{"location":"springboot/Spring%20Boot%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20Validation/#2","title":"2. \u521b\u5efa\u6570\u636e\u6a21\u578b\u5e76\u6dfb\u52a0\u6821\u9a8c\u6ce8\u89e3","text":"<pre><code>import javax.validation.constraints.*;\n\npublic class UserRegistrationRequest {\n\n    @NotBlank(message = \"\u7528\u6237\u540d\u4e0d\u80fd\u4e3a\u7a7a\")\n    @Size(min = 3, max = 20, message = \"\u7528\u6237\u540d\u957f\u5ea6\u5fc5\u987b\u57283-20\u4e2a\u5b57\u7b26\u4e4b\u95f4\")\n    private String username;\n\n    @Email(message = \"\u90ae\u7bb1\u683c\u5f0f\u4e0d\u6b63\u786e\")\n    @NotBlank(message = \"\u90ae\u7bb1\u4e0d\u80fd\u4e3a\u7a7a\")\n    private String email;\n\n    @Pattern(regexp = \"^(?=.*[a-z])(?=.*[A-Z])(?=.*\\\\d).{8,}$\", \n             message = \"\u5bc6\u7801\u5fc5\u987b\u5305\u542b\u5927\u5c0f\u5199\u5b57\u6bcd\u548c\u6570\u5b57\uff0c\u4e14\u957f\u5ea6\u81f3\u5c118\u4f4d\")\n    private String password;\n\n    @Min(value = 18, message = \"\u5e74\u9f84\u5fc5\u987b\u5927\u4e8e\u6216\u7b49\u4e8e18\u5c81\")\n    @Max(value = 100, message = \"\u5e74\u9f84\u5fc5\u987b\u5c0f\u4e8e\u6216\u7b49\u4e8e100\u5c81\")\n    private Integer age;\n\n    @NotNull(message = \"\u51fa\u751f\u65e5\u671f\u4e0d\u80fd\u4e3a\u7a7a\")\n    @Past(message = \"\u51fa\u751f\u65e5\u671f\u5fc5\u987b\u662f\u8fc7\u53bb\u7684\u65f6\u95f4\")\n    private LocalDate birthDate;\n\n    @AssertTrue(message = \"\u5fc5\u987b\u63a5\u53d7\u6761\u6b3e\u548c\u6761\u4ef6\")\n    private Boolean termsAccepted;\n\n    // Getters and Setters\n}\n</code></pre>"},{"location":"springboot/Spring%20Boot%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20Validation/#3","title":"3. \u521b\u5efa\u63a7\u5236\u5668\u5e76\u6dfb\u52a0\u6821\u9a8c\u652f\u6301","text":"<p>\u5728Controller\u7684\u65b9\u6cd5\u53c2\u6570\u4e0a\u4f7f\u7528<code>@Valid</code>\u6216<code>@Validated</code>\u6ce8\u89e3\u6765\u89e6\u53d1\u6821\u9a8c\uff1a \u5bf9\u4e8e\u8def\u5f84\u53d8\u91cf\u548c\u8bf7\u6c42\u53c2\u6570\u7684\u6821\u9a8c\uff0c\u9700\u8981\u4f7f\u7528@Validated\u6ce8\u89e3\u5728\u7c7b\u7ea7\u522b</p> <pre><code>import org.springframework.http.ResponseEntity;\nimport org.springframework.validation.annotation.Validated;\nimport org.springframework.web.bind.annotation.*;\n\nimport javax.validation.Valid;\n\n@RestController\n@RequestMapping(\"/api/users\")\n@Validated\npublic class UserController {\n\n    @PostMapping(\"/register\")\n    public ResponseEntity&lt;String&gt; registerUser(@Valid @RequestBody UserRegistrationRequest request) {\n        // \u4e1a\u52a1\u903b\u8f91\u5904\u7406\n        return ResponseEntity.ok(\"\u7528\u6237\u6ce8\u518c\u6210\u529f\");\n    }\n    // \u5bf9\u4e8e\u8def\u5f84\u53d8\u91cf\u548c\u8bf7\u6c42\u53c2\u6570\u7684\u6821\u9a8c\uff0c\u9700\u8981\u4f7f\u7528@Validated\u6ce8\u89e3\u5728\u7c7b\u7ea7\u522b\n    @GetMapping(\"/{id}\")\n    public ResponseEntity&lt;User&gt; getUserById(@PathVariable @Min(1) Long id) {\n        // \u83b7\u53d6\u7528\u6237\u903b\u8f91\n        return ResponseEntity.ok(new User(id, \"\u793a\u4f8b\u7528\u6237\"));\n    }\n}\n</code></pre>"},{"location":"springboot/Spring%20Boot%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20Validation/#4","title":"4. \u5904\u7406\u6821\u9a8c\u5f02\u5e38","text":"<p>\u5f53\u6821\u9a8c\u5931\u8d25\u65f6\uff0cSpring\u4f1a\u629b\u51fa - <code>MethodArgumentNotValidException</code>\uff08\u5bf9\u4e8e\u8bf7\u6c42\u4f53\uff09 - <code>ConstraintViolationException</code>\uff08\u5bf9\u4e8e\u8def\u5f84\u53d8\u91cf/\u8bf7\u6c42\u53c2\u6570\uff09\u3002</p> <p>\u53ef\u4ee5\u901a\u8fc7<code>@RestControllerAdvice</code>\uff08 <code>@ControllerAdvice</code> + <code>@ResponseBody</code>\uff09\u521b\u5efa\u5168\u5c40\u5f02\u5e38\u5904\u7406\u5668\u6355\u83b7\uff1a</p> <pre><code>import jakarta.servlet.http.HttpServletRequest;\nimport jakarta.validation.ConstraintViolationException;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.validation.FieldError;\nimport org.springframework.web.bind.MethodArgumentNotValidException;\nimport org.springframework.web.bind.annotation.ExceptionHandler;\nimport org.springframework.web.bind.annotation.RestControllerAdvice;\n\nimport java.util.HashMap;\nimport java.util.Map;\n\n\n@RestControllerAdvice(\"com.example.demo.controller\")\npublic class GlobalExceptionHandler {\n\n\n    /**\n     * \u5904\u7406\u8bf7\u6c42\u4f53\u6821\u9a8c\u5931\u8d25\n     *\n     * @param ex \u5f02\u5e38\n     * @return Result\n     */\n    @ExceptionHandler(MethodArgumentNotValidException.class)\n    public ResponseEntity&lt;?&gt; handleValidationExceptions(MethodArgumentNotValidException ex) {\n\n        Map&lt;String, String&gt; errors = new HashMap&lt;&gt;();\n        ex.getBindingResult().getAllErrors().forEach(error -&gt; {\n            String fieldName = ((FieldError) error).getField();\n            String errorMessage = error.getDefaultMessage();\n            errors.put(fieldName, errorMessage);\n\n        });\n        return ResponseEntity.badRequest().body(errors);\n\n    }\n\n    /**\n     * \u5904\u7406\u8def\u5f84\u53d8\u91cf\u6216\u8bf7\u6c42\u53c2\u6570\u6821\u9a8c\u5931\u8d25\n     *\n     * @param ex \u5f02\u5e38\n     * @return Result\n     */\n    @ExceptionHandler(ConstraintViolationException.class)\n    public ResponseEntity&lt;?&gt; handleConstraintViolationExceptions(ConstraintViolationException ex) {\n\n        Map&lt;String, String&gt; errors = new HashMap&lt;&gt;();\n        ex.getConstraintViolations().forEach(violation -&gt; {\n            String fieldName = violation.getPropertyPath().toString();\n            String errorMessage = violation.getMessage();\n            errors.put(fieldName, errorMessage);\n\n        });\n\n        return ResponseEntity.badRequest().body(errors);\n\n    }\n\n\n    /**\n     * \u5904\u7406\u672a\u77e5\u5f02\u5e38\n     *\n     * @param request \u8bf7\u6c42\u53c2\u6570\n     * @param e       \u5f02\u5e38\n     * @return Result\n     */\n    @ExceptionHandler(value = Throwable.class)\n    public ResponseEntity&lt;?&gt; unknownExceptionHandler(HttpServletRequest request, Throwable e) {\n        return ResponseEntity.badRequest().body(e.getMessage());\n    }\n\n}\n</code></pre>"},{"location":"springboot/Spring%20Boot%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20Validation/#5","title":"5. \u5e38\u7528\u6821\u9a8c\u6ce8\u89e3\u8bf4\u660e","text":"\u6ce8\u89e3 \u529f\u80fd \u793a\u4f8b <code>@NotNull</code> \u503c\u4e0d\u80fd\u4e3a null <code>@NotNull(message = \"\u5b57\u6bb5\u4e0d\u80fd\u4e3a\u7a7a\")</code> <code>@NotBlank</code> \u5b57\u7b26\u4e32\u4e0d\u80fd\u4e3a\u7a7a\u4e14\u5fc5\u987b\u5305\u542b\u975e\u7a7a\u767d\u5b57\u7b26 <code>@NotBlank(message = \"\u7528\u6237\u540d\u4e0d\u80fd\u4e3a\u7a7a\")</code> <code>@NotEmpty</code> \u96c6\u5408/\u6570\u7ec4\u4e0d\u80fd\u4e3a\u7a7a <code>@NotEmpty(message = \"\u5217\u8868\u4e0d\u80fd\u4e3a\u7a7a\")</code> <code>@Size</code> \u68c0\u67e5\u5b57\u7b26\u4e32/\u96c6\u5408\u5927\u5c0f <code>@Size(min=2, max=10, message=\"\u957f\u5ea62-10\")</code> <code>@Min</code> \u6570\u5b57\u6700\u5c0f\u503c <code>@Min(value=18, message=\"\u5fc5\u987b\u226518\")</code> <code>@Max</code> \u6570\u5b57\u6700\u5927\u503c <code>@Max(value=100, message=\"\u5fc5\u987b\u2264100\")</code> <code>@Email</code> \u90ae\u7bb1\u683c\u5f0f\u9a8c\u8bc1 <code>@Email(message=\"\u90ae\u7bb1\u683c\u5f0f\u65e0\u6548\")</code> <code>@Pattern</code> \u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d <code>@Pattern(regexp=\"[A-Za-z]+\", message=\"\u4ec5\u5b57\u6bcd\")</code> <code>@Past</code> \u65e5\u671f\u5fc5\u987b\u5728\u8fc7\u53bb <code>@Past(message=\"\u5fc5\u987b\u662f\u8fc7\u53bb\u65e5\u671f\")</code> <code>@Future</code> \u65e5\u671f\u5fc5\u987b\u5728\u672a\u6765 <code>@Future(message=\"\u5fc5\u987b\u662f\u672a\u6765\u65e5\u671f\")</code> <code>@AssertTrue</code> \u503c\u5fc5\u987b\u4e3a true <code>@AssertTrue(message=\"\u5fc5\u987b\u63a5\u53d7\u6761\u6b3e\")</code> <code>@AssertFalse</code> \u503c\u5fc5\u987b\u4e3a false <code>@AssertFalse(message=\"\u4e0d\u80fd\u662f\u5df2\u6ce8\u518c\u7528\u6237\")</code>"},{"location":"springboot/Spring%20Boot%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20Validation/#6","title":"6. \u9ad8\u7ea7\u7528\u6cd5\uff1a\u5206\u7ec4\u6821\u9a8c","text":"<p>\u5f53\u540c\u4e00\u4e2aBean\u5728\u4e0d\u540c\u573a\u666f\u4e0b\u9700\u8981\u4e0d\u540c\u7684\u6821\u9a8c\u89c4\u5219\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u5206\u7ec4\u6821\u9a8c\u3002</p>"},{"location":"springboot/Spring%20Boot%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20Validation/#1_1","title":"1. \u5b9a\u4e49\u5206\u7ec4\u63a5\u53e3\uff1a","text":"<pre><code>public interface CreateGroup {}\n\npublic interface UpdateGroup {}\n</code></pre>"},{"location":"springboot/Spring%20Boot%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20Validation/#2-bean","title":"2. \u5728Bean\u4e0a\u6307\u5b9a\u5206\u7ec4\uff1a","text":"<pre><code>public class UserDTO {\n\n    @Null(groups = CreateGroup.class) // \u521b\u5efa\u65f6id\u5fc5\u987b\u4e3anull\n\n    @NotNull(groups = UpdateGroup.class) // \u66f4\u65b0\u65f6id\u4e0d\u80fd\u4e3anull\n\n    private Long id;\n\n    @NotBlank(groups = {CreateGroup.class, UpdateGroup.class})\n\n    private String name;\n\n}\n</code></pre>"},{"location":"springboot/Spring%20Boot%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20Validation/#3-controllervalidated","title":"3. \u5728Controller\u65b9\u6cd5\u4e2d\u4f7f\u7528<code>@Validated</code>\u6307\u5b9a\u5206\u7ec4\uff1a","text":"<pre><code>@PostMapping\npublic String createUser(@Validated(CreateGroup.class) @RequestBody UserDTO userDTO) {\n\n// ...\n\n}\n\n@PutMapping\npublic String updateUser(@Validated(UpdateGroup.class) @RequestBody UserDTO userDTO) {\n\n// ...\n\n}\n</code></pre> <p>\u5206\u7ec4\u6821\u9a8c\u5b8c\u6574\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>// \u5b9a\u4e49\u6821\u9a8c\u5206\u7ec4\u63a5\u53e3\npublic interface CreateValidationGroup {}\npublic interface UpdateValidationGroup {}\n\npublic class Product {\n    @Null(groups = CreateValidationGroup.class, \n           message = \"ID\u5fc5\u987b\u4e3a\u7a7a\")\n    @NotNull(groups = UpdateValidationGroup.class, \n             message = \"ID\u4e0d\u80fd\u4e3a\u7a7a\")\n    private Long id;\n\n    @NotBlank(groups = {CreateValidationGroup.class, UpdateValidationGroup.class}, \n              message = \"\u4ea7\u54c1\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\")\n    private String name;\n\n    // getters and setters\n}\n\n// \u5728\u63a7\u5236\u5668\u4e2d\u4f7f\u7528\u5206\u7ec4\u6821\u9a8c\n@PostMapping\npublic ResponseEntity&lt;String&gt; createProduct(\n        @Validated(CreateValidationGroup.class) @RequestBody Product product) {\n    // \u521b\u5efa\u4ea7\u54c1\u903b\u8f91\n    return ResponseEntity.ok(\"\u4ea7\u54c1\u521b\u5efa\u6210\u529f\");\n}\n\n@PutMapping(\"/{id}\")\npublic ResponseEntity&lt;String&gt; updateProduct(\n        @PathVariable Long id,\n        @Validated(UpdateValidationGroup.class) @RequestBody Product product) {\n    // \u66f4\u65b0\u4ea7\u54c1\u903b\u8f91\n    return ResponseEntity.ok(\"\u4ea7\u54c1\u66f4\u65b0\u6210\u529f\");\n}\n</code></pre>"},{"location":"springboot/Spring%20Boot%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20Validation/#7","title":"7. \u9ad8\u7ea7\u7528\u6cd5\uff1a\u81ea\u5b9a\u4e49\u6821\u9a8c\u5668","text":"<p>\u5f53\u5185\u7f6e\u6ce8\u89e3\u4e0d\u6ee1\u8db3\u9700\u6c42\u65f6\uff0c\u53ef\u4ee5\u81ea\u5b9a\u4e49\u6821\u9a8c\u6ce8\u89e3\u3002</p> <p>\u793a\u4f8b\uff1a\u81ea\u5b9a\u4e49\u624b\u673a\u53f7\u6821\u9a8c</p>"},{"location":"springboot/Spring%20Boot%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20Validation/#1_2","title":"1. \u521b\u5efa\u81ea\u5b9a\u4e49\u6ce8\u89e3\uff1a","text":"<pre><code>import javax.validation.Constraint;\nimport javax.validation.Payload;\nimport java.lang.annotation.*;\n\n@Documented\n@Constraint(validatedBy = PhoneNumberValidator.class)\n@Target({ElementType.FIELD})\n@Retention(RetentionPolicy.RUNTIME)\npublic @interface ValidPhoneNumber {\n    String message() default \"\u65e0\u6548\u7684\u624b\u673a\u53f7\u7801\";\n    Class&lt;?&gt;[] groups() default {};\n    Class&lt;? extends Payload&gt;[] payload() default {};\n}\n</code></pre>"},{"location":"springboot/Spring%20Boot%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20Validation/#2_1","title":"2. \u5b9e\u73b0\u6821\u9a8c\u903b\u8f91","text":"<pre><code>import javax.validation.ConstraintValidator;\nimport javax.validation.ConstraintValidatorContext;\nimport java.util.regex.Pattern;\n\npublic class PhoneNumberValidator implements ConstraintValidator&lt;ValidPhoneNumber, String&gt; {\n    private static final Pattern PHONE_PATTERN = Pattern.compile(\"^1[3-9]\\\\d{9}$\");\n\n    @Override\n    public boolean isValid(String value, ConstraintValidatorContext context) {\n        if (value == null || value.trim().isEmpty()) {\n            return true; // \u5141\u8bb8\u4e3a\u7a7a\uff0c\u914d\u5408@NotBlank\u4f7f\u7528\n        }\n        return PHONE_PATTERN.matcher(value).matches();\n    }\n}\n</code></pre>"},{"location":"springboot/Spring%20Boot%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20Validation/#3_1","title":"3. \u5728\u6a21\u578b\u4e2d\u4f7f\u7528","text":"<pre><code>public class ContactInfo {\n    @ValidPhoneNumber(message = \"\u8bf7\u8f93\u5165\u6709\u6548\u7684\u624b\u673a\u53f7\u7801\")\n    private String phone;\n}\n</code></pre>"},{"location":"springboot/Spring%20Boot%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20Validation/#8","title":"8. \u9ad8\u7ea7\u7528\u6cd5\uff1a\u5d4c\u5957\u5bf9\u8c61\u6821\u9a8c","text":"<p>\u5728Spring Boot Validation\u4e2d\uff0c\u9700\u8981\u4f7f\u7528<code>@Valid</code>\u6ce8\u89e3\u6765\u89e6\u53d1\u5d4c\u5957\u5bf9\u8c61\u7684\u6821\u9a8c\u3002</p> <p>\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a\u7c7b<code>Order</code>\uff0c\u5176\u4e2d\u5305\u542b\u4e00\u4e2a<code>Customer</code>\u7c7b\u578b\u7684\u5b57\u6bb5\uff0c\u800c<code>Customer</code>\u5bf9\u8c61\u672c\u8eab\u4e5f\u6709\u9700\u8981\u6821\u9a8c\u7684\u5b57\u6bb5\u3002</p> <p>\u4ee5\u4e0b\u662f\u5177\u4f53\u6b65\u9aa4\uff1a</p> <ol> <li> <p>\u5b9a\u4e49\u5d4c\u5957\u5bf9\u8c61\uff08\u4f8b\u5982<code>Customer</code>\u7c7b\uff09\u5e76\u6dfb\u52a0\u6821\u9a8c\u6ce8\u89e3\u3002</p> </li> <li> <p>\u5728\u5305\u542b\u5d4c\u5957\u5bf9\u8c61\u7684\u7c7b\uff08\u4f8b\u5982<code>Order</code>\u7c7b\uff09\u4e2d\uff0c\u5728\u5d4c\u5957\u5bf9\u8c61\u5b57\u6bb5\u4e0a\u6dfb\u52a0<code>@Valid</code>\u6ce8\u89e3\u3002</p> </li> <li> <p>\u5728\u63a7\u5236\u5668\u65b9\u6cd5\u4e2d\uff0c\u4f7f\u7528<code>@Valid</code>\u89e6\u53d1\u6821\u9a8c\u3002</p> </li> </ol> <p>\u793a\u4f8b\u4ee3\u7801\uff1a</p>"},{"location":"springboot/Spring%20Boot%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20Validation/#1customer","title":"\u6b65\u9aa41\uff1a\u5b9a\u4e49\u5d4c\u5957\u5bf9\u8c61\uff08Customer\uff09","text":"<pre><code>import javax.validation.constraints.NotBlank;\n\nimport javax.validation.constraints.Size;\n\npublic class Customer {\n\n    @NotBlank(message = \"\u5ba2\u6237\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\")\n    @Size(min = 2, max = 30, message = \"\u5ba2\u6237\u540d\u79f0\u957f\u5ea6\u5fc5\u987b\u57282\u523030\u4e4b\u95f4\")\n    private String name;\n\n    @NotBlank(message = \"\u90ae\u7bb1\u4e0d\u80fd\u4e3a\u7a7a\")\n    @Email(message = \"\u90ae\u7bb1\u683c\u5f0f\u4e0d\u6b63\u786e\")\n    private String email;\n\n    // \u7701\u7565getter\u548csetter\n\n}\n</code></pre>"},{"location":"springboot/Spring%20Boot%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20Validation/#2order","title":"\u6b65\u9aa42\uff1a\u5b9a\u4e49\u5305\u542b\u5d4c\u5957\u5bf9\u8c61\u7684\u7c7b\uff08Order\uff09","text":"<pre><code>import javax.validation.Valid;\n\nimport javax.validation.constraints.NotNull;\n\nimport java.math.BigDecimal;\n\npublic class Order {\n\n    @NotNull(message = \"\u8ba2\u5355\u53f7\u4e0d\u80fd\u4e3a\u7a7a\")\n    private String orderId;\n\n    @NotNull(message = \"\u8ba2\u5355\u91d1\u989d\u4e0d\u80fd\u4e3a\u7a7a\")\n    @DecimalMin(value = \"0.01\", message = \"\u8ba2\u5355\u91d1\u989d\u5fc5\u987b\u5927\u4e8e0\")\n    private BigDecimal amount;\n\n    // \u5173\u952e\uff1a\u4f7f\u7528@Valid\u89e6\u53d1\u5d4c\u5957\u6821\u9a8c\n    @Valid\n    @NotNull(message = \"\u5ba2\u6237\u4fe1\u606f\u4e0d\u80fd\u4e3a\u7a7a\")\n    private Customer customer;\n\n    // \u7701\u7565getter\u548csetter\n\n}\n</code></pre>"},{"location":"springboot/Spring%20Boot%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20Validation/#3_2","title":"\u6b65\u9aa43\uff1a\u5728\u63a7\u5236\u5668\u4e2d\u4f7f\u7528","text":"<pre><code>import org.springframework.validation.annotation.Validated;\n\nimport org.springframework.web.bind.annotation.PostMapping;\n\nimport org.springframework.web.bind.annotation.RequestBody;\n\nimport org.springframework.web.bind.annotation.RestController;\n\nimport javax.validation.Valid;\n\n@RestController\n\npublic class OrderController {\n\n    @PostMapping(\"/orders\")\n    public String createOrder(@Valid @RequestBody Order order) {\n\n        // \u5904\u7406\u8ba2\u5355\n        return \"\u8ba2\u5355\u521b\u5efa\u6210\u529f\";\n\n    }\n\n}\n</code></pre>"},{"location":"springboot/Spring%20Boot%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20Validation/#4_1","title":"\u6b65\u9aa44\uff1a\u5168\u5c40\u5f02\u5e38\u5904\u7406\u5668\uff08\u5904\u7406\u6821\u9a8c\u5f02\u5e38\uff09","text":"<p>\u5982\u679c\u4e4b\u524d\u5df2\u7ecf\u521b\u5efa\u4e86\u5168\u5c40\u5f02\u5e38\u5904\u7406\u5668\uff0c\u5b83\u4f1a\u81ea\u52a8\u5904\u7406\u5d4c\u5957\u6821\u9a8c\u7684\u9519\u8bef\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u4e4b\u524d\u5b9a\u4e49\u7684<code>GlobalExceptionHandler</code>\u5df2\u7ecf\u53ef\u4ee5\u5904\u7406<code>MethodArgumentNotValidException</code>\uff0c\u5b83\u4f1a\u6536\u96c6\u6240\u6709\u5c42\u7ea7\u7684\u9519\u8bef\u3002</p> <p>\u5f53\u6821\u9a8c\u5931\u8d25\u65f6\uff0c\u8fd4\u56de\u7684\u54cd\u5e94\u53ef\u80fd\u5982\u4e0b\uff1a</p> <pre><code>{\n    \"customer.name\": \"\u5ba2\u6237\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\",\n    \"customer.email\": \"\u90ae\u7bb1\u683c\u5f0f\u4e0d\u6b63\u786e\",\n    \"amount\": \"\u8ba2\u5355\u91d1\u989d\u5fc5\u987b\u5927\u4e8e0\"\n}\n</code></pre> <p>\u6ce8\u610f\uff1a\u5d4c\u5957\u5bf9\u8c61\u53ef\u4ee5\u591a\u5c42\u5d4c\u5957\uff0c\u53ea\u9700\u8981\u5728\u6bcf\u4e00\u5c42\u9700\u8981\u6821\u9a8c\u7684\u5bf9\u8c61\u5b57\u6bb5\u4e0a\u52a0\u4e0a<code>@Valid</code>\u6ce8\u89e3\u5373\u53ef\u3002</p> <p>\u4f8b\u5982\uff0c\u5982\u679c<code>Customer</code>\u4e2d\u8fd8\u6709\u4e00\u4e2a<code>Address</code>\u5bf9\u8c61\u9700\u8981\u6821\u9a8c\uff1a</p> <pre><code>public class Customer {\n\n    // ... \u5176\u4ed6\u5b57\u6bb5\n    @Valid\n    private Address address;\n\n}\n</code></pre> <p>\u8fd9\u6837\uff0c\u6821\u9a8c\u5c31\u4f1a\u9012\u5f52\u5230<code>Address</code>\u5bf9\u8c61\u3002</p>"},{"location":"springboot/Spring%20Boot%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20Validation/#9","title":"9. \u590d\u6742\u5d4c\u5957\u573a\u666f\u5904\u7406","text":""},{"location":"springboot/Spring%20Boot%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20Validation/#1_3","title":"\u573a\u666f 1\uff1a\u96c6\u5408\u4e2d\u7684\u5d4c\u5957\u5bf9\u8c61","text":"<pre><code>public class OrderRequest {\n    // ...\n\n    @Valid\n    @NotEmpty(message = \"\u81f3\u5c11\u9700\u8981\u4e00\u4e2a\u8ba2\u5355\u9879\")\n    private List&lt;OrderItem&gt; items;\n}\n\npublic class OrderItem {\n    @NotBlank(message = \"\u5546\u54c1ID\u4e0d\u80fd\u4e3a\u7a7a\")\n    private String productId;\n\n    @Min(value = 1, message = \"\u6570\u91cf\u81f3\u5c11\u4e3a1\")\n    private Integer quantity;\n\n    @DecimalMin(value = \"0.01\", message = \"\u4ef7\u683c\u5fc5\u987b\u5927\u4e8e0\")\n    private BigDecimal price;\n}\n</code></pre>"},{"location":"springboot/Spring%20Boot%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20Validation/#2_2","title":"\u573a\u666f 2\uff1a\u591a\u5c42\u5d4c\u5957\u5bf9\u8c61","text":"<pre><code>public class CompanyOrder extends OrderRequest {\n    @Valid\n    @NotNull(message = \"\u53d1\u7968\u4fe1\u606f\u4e0d\u80fd\u4e3a\u7a7a\")\n    private Invoice invoice;\n}\n\npublic class Invoice {\n    @NotBlank(message = \"\u53d1\u7968\u62ac\u5934\u4e0d\u80fd\u4e3a\u7a7a\")\n    private String title;\n\n    @Pattern(regexp = \"\\\\d{15}|\\\\d{18}\", message = \"\u7a0e\u53f7\u683c\u5f0f\u4e0d\u6b63\u786e\")\n    private String taxNumber;\n\n    @Valid\n    private BankAccount bankAccount;\n}\n\npublic class BankAccount {\n    @NotBlank(message = \"\u5f00\u6237\u884c\u4e0d\u80fd\u4e3a\u7a7a\")\n    private String bankName;\n\n    @Pattern(regexp = \"\\\\d{16,19}\", message = \"\u8d26\u53f7\u683c\u5f0f\u4e0d\u6b63\u786e\")\n    private String accountNumber;\n}\n</code></pre>"},{"location":"springboot/Spring%20Boot%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20Validation/#3_3","title":"\u573a\u666f 3\uff1a\u6761\u4ef6\u6027\u5d4c\u5957\u6821\u9a8c","text":"<p>\u4f7f\u7528\u5206\u7ec4\u6821\u9a8c\u5b9e\u73b0\u6761\u4ef6\u6027\u5d4c\u5957\u6821\u9a8c\uff1a</p> <pre><code>// \u5b9a\u4e49\u6821\u9a8c\u5206\u7ec4\npublic interface PersonalOrderGroup {}\npublic interface CompanyOrderGroup {}\n\npublic class OrderRequest {\n    // ...\n\n    @NotNull(message = \"\u8ba2\u5355\u7c7b\u578b\u4e0d\u80fd\u4e3a\u7a7a\")\n    private OrderType orderType;\n\n    @Valid\n    @NotNull(groups = PersonalOrderGroup.class, \n             message = \"\u4e2a\u4eba\u5ba2\u6237\u4fe1\u606f\u4e0d\u80fd\u4e3a\u7a7a\")\n    private Customer personalCustomer;\n\n    @Valid\n    @NotNull(groups = CompanyOrderGroup.class, \n             message = \"\u4f01\u4e1a\u5ba2\u6237\u4fe1\u606f\u4e0d\u80fd\u4e3a\u7a7a\")\n    private Company company;\n}\n\n// \u5728\u63a7\u5236\u5668\u4e2d\u6307\u5b9a\u5206\u7ec4\n@PostMapping(\"/personal\")\npublic ResponseEntity&lt;String&gt; createPersonalOrder(\n        @Validated(PersonalOrderGroup.class) @RequestBody OrderRequest order) {\n    // \u5904\u7406\u4e2a\u4eba\u8ba2\u5355\n}\n\n@PostMapping(\"/company\")\npublic ResponseEntity&lt;String&gt; createCompanyOrder(\n        @Validated(CompanyOrderGroup.class) @RequestBody OrderRequest order) {\n    // \u5904\u7406\u4f01\u4e1a\u8ba2\u5355\n}\n</code></pre> <p>\u5d4c\u5957\u6821\u9a8c\u7684\u5173\u952e\u662f\u5728\u5bf9\u8c61\u5b57\u6bb5\u4e0a\u4f7f\u7528<code>@Valid</code>\u6ce8\u89e3\uff08\u6216<code>@Validated</code>\uff0c\u4f46\u901a\u5e38\u7528<code>@Valid</code>\uff09\uff0c\u8fd9\u6837\u6821\u9a8c\u6846\u67b6\u5c31\u4f1a\u9012\u5f52\u5730\u6821\u9a8c\u8be5\u5bf9\u8c61\u5185\u90e8\u7684\u7ea6\u675f\u3002</p>"},{"location":"springboot/Spring%20Boot%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20Validation/#spring-validation","title":"Spring Validation\u4f7f\u7528\u603b\u7ed3","text":"<ol> <li>\u907f\u514d\u8fc7\u5ea6\u5d4c\u5957\uff1a</li> <li>\u8d85\u8fc73\u5c42\u5d4c\u5957\u5efa\u8bae\u91cd\u6784</li> <li> <p>\u590d\u6742\u6821\u9a8c\u903b\u8f91\u79fb\u5230\u670d\u52a1\u5c42</p> </li> <li> <p>\u6027\u80fd\u4f18\u5316\uff1a</p> <ul> <li>\u907f\u514d\u5728 <code>@Pattern</code> \u4e2d\u4f7f\u7528\u590d\u6742\u6b63\u5219\u8868\u8fbe\u5f0f</li> <li>\u5bf9\u4e8e\u5927\u578b\u5bf9\u8c61\uff0c\u4f18\u5148\u5728\u670d\u52a1\u5c42\u8fdb\u884c\u6df1\u5ea6\u6821\u9a8c</li> <li>\u914d\u7f6eValidation\u53d1\u73b0\u7b2c\u4e00\u4e2a\u9519\u8bef\u5373\u8fd4\u56de    <pre><code>@Configuration\npublic class ValidationConfig {\n    @Bean\n    public Validator validator() {\n        return Validation.byProvider(HibernateValidator.class)\n                .configure()\n                .failFast(true) // \u53d1\u73b0\u7b2c\u4e00\u4e2a\u9519\u8bef\u5373\u8fd4\u56de\n                .buildValidatorFactory()\n                .getValidator();\n    }\n}\n</code></pre></li> </ul> </li> <li> <p>\u7ed3\u5408DTO\u6a21\u5f0f\uff1a</p> </li> <li>\u4e3a\u4e0d\u540cAPI\u521b\u5efa\u4e13\u7528\u7684\u8bf7\u6c42DTO</li> <li>\u907f\u514d\u5b9e\u4f53\u7c7b\u6c61\u67d3\u6821\u9a8c\u6ce8\u89e3</li> </ol> <p>\u5d4c\u5957\u6821\u9a8c\u662fSpring Validation\u7684\u5f3a\u5927\u529f\u80fd\uff0c\u5408\u7406\u4f7f\u7528\u53ef\u4ee5\uff1a 1. \u4fdd\u6301\u6570\u636e\u7ed3\u6784\u7684\u6e05\u6670\u6027 2. \u5b9e\u73b0\u590d\u6742\u7684\u6821\u9a8c\u903b\u8f91 3. \u63d0\u4f9b\u7cbe\u7ec6\u7684\u9519\u8bef\u53cd\u9988 4. \u51cf\u5c11\u63a7\u5236\u5668\u548c\u670d\u52a1\u5c42\u7684\u6821\u9a8c\u4ee3\u7801</p>"},{"location":"springboot/Spring%20Boot%E4%B8%AD%E4%BD%BF%E7%94%A8MyBatis%20Generator%E7%94%9F%E6%88%90%E5%8A%A8%E6%80%81SQL/","title":"Spring Boot\u4e2d\u4f7f\u7528MyBatis Generator\u751f\u6210\u52a8\u6001SQL","text":"<p>\u6211\u4eec\u5c06\u5728Spring Boot\u9879\u76ee\u4e2d\u96c6\u6210MyBatis Generator\uff0c\u5e76\u914d\u7f6e\u5176\u751f\u6210MyBatis Dynamic SQL\u98ce\u683c\u7684\u4ee3\u7801\u3002 MyBatis Dynamic SQL\u662fMyBatis 3\u7684\u4e00\u4e2a\u7279\u6027\uff0c\u5b83\u5141\u8bb8\u4f7f\u7528Java API\u6784\u5efa\u52a8\u6001SQL\u67e5\u8be2\uff0c\u907f\u514d\u7f16\u5199XML\u6216\u4f7f\u7528Example\u7c7b\u3002</p> <p>MyBatis Dynamic SQL \u6838\u5fc3\u4f18\u52bf</p> <ul> <li>\u7c7b\u578b\u5b89\u5168\uff1a\u6240\u6709\u5217\u5f15\u7528\u90fd\u662f\u7c7b\u578b\u5b89\u5168\u7684</li> <li>\u6d41\u7545\u7684API\uff1a\u94fe\u5f0f\u8c03\u7528\u6784\u5efa\u67e5\u8be2</li> <li>\u52a8\u6001SQL\uff1a\u81ea\u7136\u5904\u7406\u6761\u4ef6\u903b\u8f91</li> <li>\u65e0XML\uff1a\u907f\u514dXML\u914d\u7f6e\u7684\u7e41\u7410</li> <li>IDE\u652f\u6301\uff1a\u81ea\u52a8\u8865\u5168\u548c\u7c7b\u578b\u68c0\u67e5</li> </ul> <p>\u6b65\u9aa4\u6982\u8ff0\uff1a</p> <ol> <li> <p>\u521b\u5efaSpring Boot\u9879\u76ee\uff0c\u6dfb\u52a0\u5fc5\u8981\u7684\u4f9d\u8d56\uff08\u5305\u62ecMyBatis Spring Boot Starter\u3001\u6570\u636e\u5e93\u9a71\u52a8\u3001MyBatis Generator\u7b49\uff09\u3002</p> </li> <li> <p>\u914d\u7f6eMyBatis Generator\uff08\u901a\u8fc7Maven\u63d2\u4ef6\u65b9\u5f0f\uff09\u3002</p> </li> <li> <p>\u7f16\u5199generatorConfig.xml\u914d\u7f6e\u6587\u4ef6\uff0c\u6307\u5b9a\u751f\u6210Dynamic SQL\u98ce\u683c\u7684\u4ee3\u7801\u3002</p> </li> <li> <p>\u8fd0\u884cMyBatis Generator\u751f\u6210\u4ee3\u7801\u3002</p> </li> <li> <p>\u5728Spring Boot\u4e2d\u914d\u7f6eMyBatis\uff0c\u4f7f\u7528\u751f\u6210\u7684Mapper\u3002</p> </li> </ol>"},{"location":"springboot/Spring%20Boot%E4%B8%AD%E4%BD%BF%E7%94%A8MyBatis%20Generator%E7%94%9F%E6%88%90%E5%8A%A8%E6%80%81SQL/#spring-boot","title":"\u4e00\u3001\u521b\u5efaSpring Boot\u9879\u76ee\u5e76\u6dfb\u52a0\u4f9d\u8d56","text":"<p>\u4f7f\u7528Spring Initializr\u521b\u5efa\u4e00\u4e2a\u65b0\u9879\u76ee\uff0c\u9009\u62e9\u4ee5\u4e0b\u4f9d\u8d56\uff1a</p> <ul> <li> <p>Spring Web (\u5982\u679c\u6784\u5efaWeb\u5e94\u7528)</p> </li> <li> <p>MyBatis Framework</p> </li> <li> <p>MySQL Driver (\u4ee5MySQL\u4e3a\u4f8b\uff0c\u6216\u8005\u6839\u636e\u4f60\u7684\u6570\u636e\u5e93\u9009\u62e9)</p> </li> </ul> <p></p> <p>\u7136\u540e\u5728pom.xml\u4e2d\u6dfb\u52a0MyBatis Generator Maven\u63d2\u4ef6\u4ee5\u53caMyBatis Dynamic SQL\u4f9d\u8d56\uff1a</p> <pre><code>&lt;dependencies&gt;\n    &lt;!-- Spring Boot Starter --&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n    &lt;!-- MyBatis Spring Boot Starter --&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;\n        &lt;version&gt;3.0.3&lt;/version&gt;\n    &lt;/dependency&gt;\n    &lt;!-- MySQL \u9a71\u52a8 --&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;com.mysql&lt;/groupId&gt;\n        &lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt;\n        &lt;scope&gt;runtime&lt;/scope&gt;\n    &lt;/dependency&gt;\n    &lt;!-- Lombok --&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n        &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n        &lt;optional&gt;true&lt;/optional&gt;\n    &lt;/dependency&gt;\n    &lt;!-- MyBatis Dynamic SQL --&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.mybatis.dynamic-sql&lt;/groupId&gt;\n        &lt;artifactId&gt;mybatis-dynamic-sql&lt;/artifactId&gt;\n        &lt;version&gt;1.5.0&lt;/version&gt;\n    &lt;/dependency&gt;\n&lt;/dependencies&gt;\n\n&lt;build&gt;\n    &lt;plugins&gt;\n        &lt;!-- MyBatis Generator \u63d2\u4ef6 --&gt;\n        &lt;plugin&gt;\n            &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt;\n            &lt;artifactId&gt;mybatis-generator-maven-plugin&lt;/artifactId&gt;\n            &lt;version&gt;1.4.2&lt;/version&gt;\n            &lt;dependencies&gt;\n                &lt;dependency&gt;\n                    &lt;groupId&gt;com.mysql&lt;/groupId&gt;\n                    &lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt;\n                    &lt;version&gt;8.0.33&lt;/version&gt;\n                &lt;/dependency&gt;\n                &lt;!-- \u652f\u6301\u751f\u6210 Dynamic SQL --&gt;\n                &lt;dependency&gt;\n                    &lt;groupId&gt;org.mybatis.dynamic-sql&lt;/groupId&gt;\n                    &lt;artifactId&gt;mybatis-dynamic-sql&lt;/artifactId&gt;\n                    &lt;version&gt;1.5.0&lt;/version&gt;\n                &lt;/dependency&gt;\n            &lt;/dependencies&gt;\n            &lt;configuration&gt;\n                &lt;configurationFile&gt;src/main/resources/generatorConfig.xml&lt;/configurationFile&gt;\n                &lt;overwrite&gt;true&lt;/overwrite&gt;\n                &lt;verbose&gt;true&lt;/verbose&gt;\n            &lt;/configuration&gt;\n        &lt;/plugin&gt;\n    &lt;/plugins&gt;\n&lt;/build&gt;\n</code></pre>"},{"location":"springboot/Spring%20Boot%E4%B8%AD%E4%BD%BF%E7%94%A8MyBatis%20Generator%E7%94%9F%E6%88%90%E5%8A%A8%E6%80%81SQL/#generatorconfigxml","title":"\u4e8c\u3001\u7f16\u5199generatorConfig.xml\u914d\u7f6e\u6587\u4ef6","text":"<p>\u5728<code>src/main/resources</code>\u76ee\u5f55\u4e0b\u521b\u5efa<code>generatorConfig.xml</code>\u6587\u4ef6\u3002\u6211\u4eec\u9700\u8981\u914d\u7f6e\u751f\u6210Dynamic SQL\u98ce\u683c\u7684\u4ee3\u7801\uff0c\u8fd9\u901a\u8fc7\u8bbe\u7f6e<code>targetRuntime=\"MyBatis3DynamicSql\"</code>\u6765\u5b9e\u73b0\u3002</p> <p>\u793a\u4f8b\u914d\u7f6e\uff1a</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;!DOCTYPE generatorConfiguration\n        PUBLIC \"-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN\"\n        \"https://mybatis.org/dtd/mybatis-generator-config_1_0.dtd\"&gt;\n\n&lt;generatorConfiguration&gt;\n    &lt;!-- \u5f15\u5165 application.properties \u4e2d\u7684\u914d\u7f6e(\u53ef\u9009) --&gt;\n    &lt;properties resource=\"application.properties\"/&gt;\n\n    &lt;!-- \u6570\u636e\u5e93\u9a71\u52a8\u8def\u5f84\uff08\u5982\u679c\u672a\u901a\u8fc7Maven\u4f9d\u8d56\u7ba1\u7406\uff09 --&gt;\n    &lt;!-- &lt;classPathEntry location=\"/path/to/mysql-connector-java-8.0.33.jar\"/&gt; --&gt;\n\n    &lt;context id=\"mysql\" targetRuntime=\"MyBatis3DynamicSql\"&gt;\n        &lt;!-- \u751f\u6210\u7684Java\u6587\u4ef6\u7f16\u7801 --&gt;\n        &lt;property name=\"javaFileEncoding\" value=\"UTF-8\"/&gt;\n\n        &lt;!-- \u751f\u6210\u7684Java\u6587\u4ef6\u7684\u6ce8\u91ca --&gt;\n        &lt;commentGenerator&gt;\n            &lt;!-- \u6ce8\u91ca\u914d\u7f6e\uff1a\u4e0d\u751f\u6210\u6ce8\u91ca --&gt;\n            &lt;property name=\"suppressAllComments\" value=\"true\"/&gt;\n            &lt;!-- \u751f\u6210\u6ce8\u91ca --&gt;\n            &lt;!--            &lt;property name=\"addRemarkComments\" value=\"true\"/&gt;--&gt;\n        &lt;/commentGenerator&gt;\n        &lt;!-- \u6570\u636e\u5e93\u8fde\u63a5\u4fe1\u606f --&gt;\n        &lt;jdbcConnection driverClass=\"${spring.datasource.driver-class-name}\"\n                        connectionURL=\"${spring.datasource.url}\"\n                        userId=\"${spring.datasource.username}\"\n                        password=\"${spring.datasource.password}\"&gt;\n        &lt;/jdbcConnection&gt;\n        &lt;!-- Java\u6a21\u578b\u751f\u6210\u914d\u7f6e --&gt;\n        &lt;javaModelGenerator targetPackage=\"com.example.demo.model.entity\" targetProject=\"src/main/java\"&gt;\n            &lt;property name=\"enableSubPackages\" value=\"true\"/&gt;\n            &lt;property name=\"trimStrings\" value=\"true\"/&gt;\n        &lt;/javaModelGenerator&gt;\n        &lt;!-- \u6ce8\u610f\uff1a\u5982\u679c\u4f7f\u7528Dynamic SQL\u65b9\u5f0f\uff0c\u4e0d\u9700\u8981XML\u6620\u5c04\u6587\u4ef6 --&gt;\n        &lt;!-- \u751f\u6210 SQL Map XML \u6587\u4ef6\u7684\u914d\u7f6e --&gt;\n        &lt;!--        &lt;sqlMapGenerator targetPackage=\"mapper\" targetProject=\"src/main/resources\"&gt;--&gt;\n        &lt;!--            &lt;property name=\"enableSubPackages\" value=\"true\" /&gt;--&gt;\n        &lt;!--        &lt;/sqlMapGenerator&gt;--&gt;\n        &lt;!-- Mapper\u63a5\u53e3\u751f\u6210\u914d\u7f6e --&gt;\n        &lt;javaClientGenerator type=\"ANNOTATEDMAPPER\"\n                             targetPackage=\"com.example.demo.repository.generated\"\n                             targetProject=\"src/main/java\"&gt;\n            &lt;property name=\"enableSubPackages\" value=\"true\"/&gt;\n        &lt;/javaClientGenerator&gt;\n        &lt;!-- \u6307\u5b9a\u8981\u751f\u6210\u7684\u8868 --&gt;\n        &lt;table tableName=\"user\" domainObjectName=\"User\"&gt;\n            &lt;generatedKey column=\"id\" sqlStatement=\"MySql\" identity=\"true\"/&gt;\n        &lt;/table&gt;\n        &lt;table tableName=\"rule\" domainObjectName=\"RuleEntity\" mapperName=\"RuleMapper\"&gt;\n            &lt;generatedKey column=\"id\" sqlStatement=\"MySql\" identity=\"true\"/&gt;\n        &lt;/table&gt;\n\n        &lt;table tableName=\"rule_version\" domainObjectName=\"RuleVersionEntity\" mapperName=\"RuleVersionMapper\"&gt;\n            &lt;generatedKey column=\"id\" sqlStatement=\"MySql\" identity=\"true\"/&gt;\n        &lt;/table&gt;\n        &lt;!-- \u751f\u6210\u6240\u6709\u8868 --&gt;\n        &lt;!--         &lt;table tableName=\"%\" /&gt;--&gt;\n    &lt;/context&gt;\n&lt;/generatorConfiguration&gt;\n</code></pre> <p>\u6ce8\u610f\uff1a</p> <ol> <li> <p>\u6211\u4eec\u4f7f\u7528\u4e86<code>targetRuntime=\"MyBatis3DynamicSql\"</code>\uff0c\u8fd9\u4f1a\u751f\u6210Dynamic SQL\u98ce\u683c\u7684\u4ee3\u7801\u3002</p> </li> <li> <p>\u4e0d\u9700\u8981\u914d\u7f6e<code>sqlMapGenerator</code>\uff0c\u56e0\u4e3aDynamic SQL\u4e0d\u751f\u6210XML\u6620\u5c04\u6587\u4ef6\u3002</p> </li> <li> <p><code>javaClientGenerator</code>\u7684<code>type</code>\u8bbe\u7f6e\u4e3a<code>ANNOTATEDMAPPER</code>\uff0c\u8868\u793a\u4f7f\u7528\u6ce8\u89e3\u65b9\u5f0f\uff08\u5b9e\u9645\u4e0aDynamic SQL\u7684Mapper\u63a5\u53e3\u662f\u901a\u8fc7Java API\u6784\u5efa\u7684\uff0c\u7531Dynamic SQL\u7684\u8fd0\u884c\u65f6\u5e93\u63d0\u4f9b\u652f\u6301\uff09\u3002</p> </li> <li> <p>\u5728<code>jdbcConnection</code>\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528\u4e86Spring Boot\u7684<code>application.properties</code>\u4e2d\u7684\u6570\u636e\u5e93\u914d\u7f6e\uff08\u901a\u8fc7<code>${}</code>\u5360\u4f4d\u7b26\u5f15\u7528\uff09\u3002\u9700\u8981\u5728<code>generatorConfig.xml</code>\u6587\u4ef6\u4e2d\u914d\u7f6e <code>&lt;properties resource=\"application.properties\"/&gt;</code>\uff0c\u5e76\u4e14\u786e\u4fdd<code>application.properties</code>\u4e2d\u6709\u8fd9\u4e9b\u5c5e\u6027\u3002</p> </li> </ol>"},{"location":"springboot/Spring%20Boot%E4%B8%AD%E4%BD%BF%E7%94%A8MyBatis%20Generator%E7%94%9F%E6%88%90%E5%8A%A8%E6%80%81SQL/#applicationproperties","title":"\u4e09\u3001\u914d\u7f6eapplication.properties","text":"<p>\u5728<code>src/main/resources/application.properties</code>\u4e2d\u914d\u7f6e\u6570\u636e\u6e90\uff1a</p> <pre><code>spring.application.name=demo\nserver.port=8088\n# \u6570\u636e\u6e90\u914d\u7f6e\nspring.datasource.url=jdbc:mysql://localhost:3306/mydatabase\nspring.datasource.username=root\nspring.datasource.password=mysecretpassword\nspring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver\n</code></pre>"},{"location":"springboot/Spring%20Boot%E4%B8%AD%E4%BD%BF%E7%94%A8MyBatis%20Generator%E7%94%9F%E6%88%90%E5%8A%A8%E6%80%81SQL/#mybatis-generator","title":"\u56db\u3001\u8fd0\u884cMyBatis Generator\u751f\u6210\u4ee3\u7801","text":"<p>\u5728\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\u8fd0\u884c\u547d\u4ee4\uff1a</p> <pre><code>mvn mybatis-generator:generate\n</code></pre> <p>\u6216\u8005\u5728IDE\u4e2d\u8fd0\u884cMaven\u63d2\u4ef6\u7684<code>mybatis-generator:generate</code>\u76ee\u6807\u3002</p> <p></p> <p>\u751f\u6210\u7684\u6587\u4ef6\u5c06\u5305\u62ec\uff1a</p> <ol> <li> <p>\u5b9e\u4f53\u7c7b\uff08POJO\uff09\uff1a\u5728<code>com.example.demo.model.entity</code>\u5305\u4e0b\u3002</p> </li> <li> <p>Mapper\u63a5\u53e3\uff1a\u5728<code>com.example.demo.repository.generated</code>\u5305\u4e0b\u3002\u6ce8\u610f\uff0c\u751f\u6210\u7684Mapper\u63a5\u53e3\u4f1a\u7ee7\u627fMyBatis Dynamic SQL\u63d0\u4f9b\u7684<code>MyBatis3Mapper</code>\u63a5\u53e3\uff08\u6bd4\u5982<code>CommonCountMapper, CommonDeleteMapper, CommonUpdateMapper</code>\uff09\uff0c\u8fd9\u4e9b\u63a5\u53e3\u63d0\u4f9b\u4e86\u4e00\u4e9b\u57fa\u672c\u7684CRUD\u65b9\u6cd5\u3002</p> </li> </ol>"},{"location":"springboot/Spring%20Boot%E4%B8%AD%E4%BD%BF%E7%94%A8MyBatis%20Generator%E7%94%9F%E6%88%90%E5%8A%A8%E6%80%81SQL/#spring-bootmapper","title":"\u4e94\u3001\u5728Spring Boot\u4e2d\u4f7f\u7528\u751f\u6210\u7684Mapper","text":"<ol> <li>\u5728\u76ee\u5f55 <code>com.example.demo.config</code> \u521b\u5efa <code>MyBatisConfig.java</code> \u914d\u7f6e\u7c7b\uff1a</li> </ol> <pre><code>import org.apache.ibatis.session.SqlSessionFactory;\nimport org.mybatis.spring.SqlSessionFactoryBean;\nimport org.mybatis.spring.annotation.MapperScan;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\nimport javax.sql.DataSource;\n\n@Configuration\n@MapperScan(\"com.example.demo.repository\")\npublic class MyBatisConfig {\n    @Bean\n    public SqlSessionFactory sqlSessionFactory(DataSource dataSource) throws Exception {\n        SqlSessionFactoryBean sessionFactory = new SqlSessionFactoryBean();\n        sessionFactory.setDataSource(dataSource);\n        sessionFactory.setTypeAliasesPackage(\"com.example.demo.model.entity\");\n\n        return sessionFactory.getObject();\n    }\n\n}\n</code></pre> <p>\u5728Spring Boot\u9879\u76ee\u4e2d\uff0c\u4f7f\u7528<code>@MapperScan</code>\u6ce8\u89e3\u53ef\u4ee5\u65b9\u4fbf\u5730\u626b\u63cf\u5e76\u6ce8\u518cMyBatis\u7684Mapper\u63a5\u53e3\u3002\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u4e0d\u9700\u8981\u5728\u6bcf\u4e2aMapper\u63a5\u53e3\u4e0a\u90fd\u6dfb\u52a0<code>@Mapper</code>\u6ce8\u89e3\u3002</p> <p>\u6ce8\u610f\u4e8b\u9879\uff1a</p> <ul> <li> <p><code>@MapperScan</code>\u4e0e<code>@Mapper</code>\uff1a\u5982\u679c\u4f7f\u7528\u4e86<code>@MapperScan</code>\uff0c\u5219\u4e0d\u9700\u8981\u5728\u6bcf\u4e2aMapper\u63a5\u53e3\u4e0a\u518d\u5199<code>@Mapper</code>\u3002\u4f46\u662f\uff0c\u5982\u679c\u6709\u4e9bMapper\u63a5\u53e3\u4e0d\u5728\u626b\u63cf\u8def\u5f84\u4e0b\uff0c\u90a3\u4e48\u4ecd\u7136\u9700\u8981\u5728\u8be5\u63a5\u53e3\u4e0a\u4f7f\u7528<code>@Mapper</code>\u3002</p> </li> <li> <p>\u5305\u8def\u5f84\uff1a\u786e\u4fdd<code>@MapperScan</code>\u6307\u5b9a\u7684\u5305\u8def\u5f84\u6b63\u786e\uff0c\u5426\u5219Spring\u5bb9\u5668\u65e0\u6cd5\u521b\u5efaMapper\u7684Bean\uff0c\u5bfc\u81f4\u6ce8\u5165\u5931\u8d25\u3002</p> </li> <li> <p>\u591a\u6a21\u5757\u9879\u76ee\uff1a\u5982\u679c\u9879\u76ee\u6709\u591a\u4e2a\u6a21\u5757\uff0c\u5e76\u4e14Mapper\u63a5\u53e3\u5206\u5e03\u5728\u4e0d\u540c\u7684\u6a21\u5757\u4e2d\uff0c\u786e\u4fdd\u8fd9\u4e9b\u6a21\u5757\u7684\u5305\u8def\u5f84\u90fd\u88ab\u626b\u63cf\u5230\u3002</p> </li> <li> <p>\u5728Service\u4e2d\u6ce8\u5165Mapper\u5e76\u4f7f\u7528\uff1a</p> </li> </ul> <pre><code>@Service\n@RequiredArgsConstructor\npublic class UserService {\n\n    private final UserMapper userMapper;\n\n    // \u521b\u5efa\u7528\u6237\n    public int createUser(User user) {\n        return userMapper.insert(user);\n    }\n\n    // \u6839\u636eID\u83b7\u53d6\u7528\u6237\n    public Optional&lt;User&gt; getUserById(Long id) {\n        return userMapper.selectByPrimaryKey(id);\n    }\n\n    // \u66f4\u65b0\u7528\u6237\n    public int updateUser(User user) {\n        return userMapper.updateByPrimaryKeySelective(user);\n    }\n\n    // \u5220\u9664\u7528\u6237\n    public int deleteUser(Long id) {\n        return userMapper.deleteByPrimaryKey(id);\n    }\n\n    // \u52a8\u6001\u67e5\u8be2\u7528\u6237\n    public List&lt;User&gt; findUsers(String username, Integer minAge, Integer maxAge) {\n        return userMapper.select(c -&gt; c\n            .where(UserDynamicSqlSupport.username, isLikeIfPresent(username).map(s -&gt; s + \"%\")\n            .and(UserDynamicSqlSupport.age, isBetweenWhenPresent(minAge, maxAge))\n            .orderBy(UserDynamicSqlSupport.createTime.descending())\n            .build()\n            .execute());\n    }\n\n    // \u8f85\u52a9\u65b9\u6cd5\uff1a\u6761\u4ef6\u5b58\u5728\u65f6\u4f7f\u7528 LIKE\n    private Optional&lt;Condition&gt; isLikeIfPresent(String value) {\n        return Optional.ofNullable(value)\n            .filter(v -&gt; !v.isEmpty())\n            .map(v -&gt; UserDynamicSqlSupport.username.like(v));\n    }\n\n    // \u8f85\u52a9\u65b9\u6cd5\uff1a\u6761\u4ef6\u5b58\u5728\u65f6\u4f7f\u7528 BETWEEN\n    private Optional&lt;BetweenCondition&gt; isBetweenWhenPresent(Integer min, Integer max) {\n        if (min != null &amp;&amp; max != null) {\n            return Optional.of(UserDynamicSqlSupport.age.between(min, max));\n        }\n        return Optional.empty();\n    }\n}\n</code></pre> <p>\u6ce8\u610f\uff1a\u4e0a\u9762\u7684<code>user</code>\u662f\u4e00\u4e2a\u81ea\u52a8\u751f\u6210\u7684\u8868\u5bf9\u5e94\u7684\u5bf9\u8c61\uff08\u5728UserMapper\u4e2d\u6709\u4e00\u4e2a\u9759\u6001\u5b57\u6bb5<code>user</code>\uff0c\u7528\u4e8e\u6784\u5efa\u67e5\u8be2\uff09\u3002\u5b9e\u9645\u4f7f\u7528\u65f6\uff0c\u9700\u8981\u5bfc\u5165\u751f\u6210\u7684Mapper\u548c\u8868\u5bf9\u8c61\u3002</p> <p>\u4f8b\u5982\uff0c\u5728UserService\u4e2d\u5bfc\u5165\uff1a</p> <pre><code>import static com.example.demo.mapper.UserDynamicSqlSupport.*;\n\nimport static org.mybatis.dynamic.sql.SqlBuilder.*;\n</code></pre> <ol> <li>\u5728controller\u4e2d\u6ce8\u5165service\u5e76\u4f7f\u7528</li> </ol> <pre><code>@RestController\n@RequestMapping(\"/api/users\")\n@RequiredArgsConstructor\npublic class UserController {\n\n    private final UserService userService;\n\n    @PostMapping\n    public ResponseEntity&lt;?&gt; createUser(@RequestBody User user) {\n        int result = userService.createUser(user);\n        return result &gt; 0 \n            ? ResponseEntity.ok(\"User created\")\n            : ResponseEntity.badRequest().body(\"Create failed\");\n    }\n\n    @GetMapping(\"/{id}\")\n    public ResponseEntity&lt;User&gt; getUser(@PathVariable Long id) {\n        return userService.getUserById(id)\n            .map(ResponseEntity::ok)\n            .orElse(ResponseEntity.notFound().build());\n    }\n\n    @PutMapping(\"/{id}\")\n    public ResponseEntity&lt;?&gt; updateUser(@PathVariable Long id, @RequestBody User user) {\n        user.setId(id);\n        int result = userService.updateUser(user);\n        return result &gt; 0 \n            ? ResponseEntity.ok(\"User updated\")\n            : ResponseEntity.badRequest().body(\"Update failed\");\n    }\n\n    @DeleteMapping(\"/{id}\")\n    public ResponseEntity&lt;?&gt; deleteUser(@PathVariable Long id) {\n        int result = userService.deleteUser(id);\n        return result &gt; 0 \n            ? ResponseEntity.ok(\"User deleted\")\n            : ResponseEntity.badRequest().body(\"Delete failed\");\n    }\n\n    @GetMapping(\"/search\")\n    public List&lt;User&gt; searchUsers(\n            @RequestParam(required = false) String username,\n            @RequestParam(required = false) Integer minAge,\n            @RequestParam(required = false) Integer maxAge) {\n\n        return userService.findUsers(username, minAge, maxAge);\n    }\n}\n</code></pre>"},{"location":"springboot/Spring%20Boot%E4%B8%AD%E4%BD%BF%E7%94%A8MyBatis%20Generator%E7%94%9F%E6%88%90%E5%8A%A8%E6%80%81SQL/#mybatis-dynamic-sql","title":"\u516d\u3001MyBatis Dynamic SQL \u751f\u6210\u4ee3\u7801\u7684\u7279\u70b9","text":"<ol> <li> <p>\u751f\u6210\u7684Mapper\u63a5\u53e3\u5305\u542b\u7684\u65b9\u6cd5\uff1a</p> </li> <li> <p><code>insert</code>\uff1a\u63d2\u5165\u8bb0\u5f55</p> </li> <li> <p><code>insertMultiple</code>\uff1a\u6279\u91cf\u63d2\u5165</p> </li> <li> <p><code>insertSelective</code>\uff1a\u9009\u62e9\u6027\u63d2\u5165\uff08\u5ffd\u7565null\uff09</p> </li> <li> <p><code>selectByPrimaryKey</code>\uff1a\u6839\u636e\u4e3b\u952e\u67e5\u8be2</p> </li> <li> <p><code>select</code>\uff1a\u6839\u636e\u6761\u4ef6\u67e5\u8be2\uff08\u53ef\u8fd4\u56de\u591a\u6761\uff09</p> </li> <li> <p><code>selectOne</code>\uff1a\u6839\u636e\u6761\u4ef6\u67e5\u8be2\u4e00\u6761</p> </li> <li> <p><code>update</code>\uff1a\u66f4\u65b0</p> </li> <li> <p><code>delete</code>\uff1a\u5220\u9664</p> </li> <li> <p>\u7b49\u7b49</p> </li> <li> <p>\u540c\u65f6\u4f1a\u751f\u6210\u4e00\u4e2a\u4e0e\u8868\u540c\u540d\u7684\u8f85\u52a9\u7c7b\uff08\u5982<code>UserDynamicSqlSupport</code>\uff09\uff0c\u5176\u4e2d\u5305\u542b\u8868\u7684\u5217\u5b9a\u4e49\uff0c\u7528\u4e8e\u6784\u5efa\u52a8\u6001SQL\u3002</p> </li> <li> <p>\u4e0d\u9700\u8981XML\u6620\u5c04\u6587\u4ef6\uff0c\u6240\u6709SQL\u901a\u8fc7Java API\u52a8\u6001\u6784\u5efa\u3002</p> </li> </ol>"},{"location":"springboot/Spring%20Boot%E4%B8%AD%E4%BD%BF%E7%94%A8MyBatis%20Generator%E7%94%9F%E6%88%90%E5%8A%A8%E6%80%81SQL/#_1","title":"\u4e03\u3001\u6ce8\u610f\u4e8b\u9879","text":"<ol> <li> <p>\u786e\u4fdd\u6570\u636e\u5e93\u8868\u6709\u4e3b\u952e\uff0c\u5426\u5219\u751f\u6210\u4ee3\u7801\u65f6\u53ef\u80fd\u4f1a\u51fa\u73b0\u95ee\u9898\u3002</p> </li> <li> <p>\u5982\u679c\u8868\u540d\u6216\u5217\u540d\u662fSQL\u5173\u952e\u5b57\uff0c\u9700\u8981\u5728\u914d\u7f6e\u4e2d\u4f7f\u7528<code>&lt;columnOverride&gt;</code>\u6216<code>&lt;table&gt;</code>\u7684<code>delimitIdentifiers</code>\u5c5e\u6027\u5904\u7406\u3002</p> </li> <li> <p>\u751f\u6210\u7684\u4ee3\u7801\u53ef\u80fd\u4f1a\u8986\u76d6\u5df2\u6709\u7684\u6587\u4ef6\uff0c\u6ce8\u610f\u5907\u4efd\u81ea\u5b9a\u4e49\u4ee3\u7801\uff08\u901a\u5e38\u4e0d\u8981\u4fee\u6539\u751f\u6210\u7684\u4ee3\u7801\uff0c\u800c\u662f\u901a\u8fc7\u6269\u5c55\u65b9\u5f0f\uff09\u3002</p> </li> </ol>"},{"location":"springboot/Spring%20Boot%E4%B8%AD%E4%BD%BF%E7%94%A8MyBatis%20Generator%E7%94%9F%E6%88%90%E5%8A%A8%E6%80%81SQL/#_2","title":"\u516b\u3001\u603b\u7ed3","text":"<p>\u672c\u65b9\u6848\u5728 Spring Boot \u4e2d\u96c6\u6210\u4e86 MyBatis Generator\uff0c\u5e76\u914d\u7f6e\u751f\u6210 MyBatis Dynamic SQL \u98ce\u683c\u7684\u4ee3\u7801\uff0c\u5177\u6709\u4ee5\u4e0b\u7279\u70b9\uff1a</p> <ol> <li>\u4ee3\u7801\u7b80\u6d01\uff1a\u4f7f\u7528 Lombok \u51cf\u5c11\u6837\u677f\u4ee3\u7801</li> <li>\u7c7b\u578b\u5b89\u5168\uff1aDynamic SQL \u63d0\u4f9b\u7f16\u8bd1\u65f6\u68c0\u67e5</li> <li>\u6613\u4e8e\u7ef4\u62a4\uff1a\u65e0\u9700 XML \u914d\u7f6e</li> <li>\u52a8\u6001\u67e5\u8be2\uff1a\u7075\u6d3b\u6784\u5efa\u590d\u6742\u67e5\u8be2</li> <li>\u9ad8\u6548\u5f00\u53d1\uff1a\u81ea\u52a8\u751f\u6210\u57fa\u7840 CRUD \u4ee3\u7801</li> </ol> <p>\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c\u4f60\u53ef\u4ee5\u4e13\u6ce8\u4e8e\u4e1a\u52a1\u903b\u8f91\u5f00\u53d1\uff0c\u800c\u65e0\u9700\u624b\u52a8\u7f16\u5199\u91cd\u590d\u7684\u6570\u636e\u8bbf\u95ee\u5c42\u4ee3\u7801\u3002</p>"},{"location":"springboot/Spring%20Boot%E9%A1%B9%E7%9B%AE%E8%87%AA%E5%B7%B1%E5%B0%81%E8%A3%85%E4%B8%80%E4%B8%AA%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E5%B7%A5%E5%85%B7/","title":"Spring Boot\u9879\u76ee\u81ea\u5df1\u5c01\u88c5\u4e00\u4e2a\u5206\u9875\u67e5\u8be2\u5de5\u5177","text":"<p>\u5728Spring Boot\u9879\u76ee\u4e2d\u4f7f\u7528MyBatis\u8fdb\u884c\u5206\u9875\u67e5\u8be2\uff0c\u901a\u5e38\u6709\u4e24\u79cd\u4e3b\u6d41\u65b9\u5f0f\uff1a</p> <ol> <li> <p>\u4f7f\u7528MyBatis\u5185\u7f6e\u7684RowBounds\u8fdb\u884c\u5185\u5b58\u5206\u9875\uff08\u4e0d\u63a8\u8350\uff0c\u6570\u636e\u91cf\u5927\u65f6\u6027\u80fd\u5dee\uff09</p> </li> <li> <p>\u4f7f\u7528\u5206\u9875\u63d2\u4ef6\uff0c\u5982PageHelper</p> </li> </ol>"},{"location":"springboot/Spring%20Boot%E9%A1%B9%E7%9B%AE%E8%87%AA%E5%B7%B1%E5%B0%81%E8%A3%85%E4%B8%80%E4%B8%AA%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E5%B7%A5%E5%85%B7/#pagehelper","title":"\u4f7f\u7528PageHelper\u53ef\u80fd\u9047\u5230\u7684\u4e00\u4e9b\u95ee\u9898","text":"<p>PageHelper \u662f\u4e00\u4e2a\u975e\u5e38\u6d41\u884c\u7684 MyBatis \u5206\u9875\u63d2\u4ef6\uff0c\u4f46\u5b83\u4e5f\u6709\u4e00\u4e9b\u6f5c\u5728\u7684\u7f3a\u70b9\u548c\u9700\u8981\u6ce8\u610f\u7684\u5730\u65b9\u3002\u4ee5\u4e0b\u662f\u5728\u4f7f\u7528 PageHelper \u65f6\u53ef\u80fd\u9047\u5230\u7684\u4e00\u4e9b\u95ee\u9898\uff1a 1. \u7ebf\u7a0b\u5b89\u5168\u95ee\u9898</p> <ul> <li> <p>\u95ee\u9898\u63cf\u8ff0\uff1a<code>PageHelper.startPage()</code> \u65b9\u6cd5\u4f7f\u7528\u4e86 <code>ThreadLocal</code> \u6765\u4fdd\u5b58\u5206\u9875\u53c2\u6570\u3002\u5982\u679c\u5728\u540c\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u591a\u6b21\u8c03\u7528 <code>startPage()</code> \u800c\u6ca1\u6709\u53ca\u65f6\u6e05\u7406\uff08\u6bd4\u5982\u5728 finally \u5757\u4e2d\u8c03\u7528 <code>PageHelper.clearPage()</code>\uff09\uff0c\u6216\u8005\u7ebf\u7a0b\u88ab\u590d\u7528\uff08\u5982\u7ebf\u7a0b\u6c60\u573a\u666f\uff09\uff0c\u53ef\u80fd\u5bfc\u81f4\u5206\u9875\u53c2\u6570\u6df7\u4e71\u3002</p> </li> <li> <p>\u5bf9\u590d\u6742 SQL \u7684\u652f\u6301\u6709\u9650</p> </li> <li> <p>\u95ee\u9898\u63cf\u8ff0\uff1aPageHelper \u901a\u8fc7\u62e6\u622a SQL \u5e76\u91cd\u5199\u6765\u5b9e\u73b0\u5206\u9875\u3002\u5bf9\u4e8e\u7279\u522b\u590d\u6742\u7684 SQL\uff08\u4f8b\u5982\u5305\u542b\u591a\u4e2a\u5d4c\u5957\u5b50\u67e5\u8be2\u3001UNION \u7b49\uff09\uff0c\u81ea\u52a8\u751f\u6210\u7684 count \u67e5\u8be2\u8bed\u53e5\u53ef\u80fd\u4f1a\u51fa\u9519\uff0c\u5bfc\u81f4\u5206\u9875\u7ed3\u679c\u4e0d\u6b63\u786e\u3002</p> </li> <li> <p>\u6027\u80fd\u95ee\u9898</p> </li> <li> <p>Count \u67e5\u8be2\u6548\u7387\uff1a\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cPageHelper \u4f1a\u6267\u884c\u4e00\u4e2a count \u67e5\u8be2\u83b7\u53d6\u603b\u8bb0\u5f55\u6570\u3002\u5982\u679c\u8868\u6570\u636e\u91cf\u975e\u5e38\u5927\uff08\u4e0a\u5343\u4e07\uff09\uff0c\u8fd9\u4e2a count \u64cd\u4f5c\u53ef\u80fd\u5f88\u6162\uff08\u5c24\u5176\u662f\u6ca1\u6709\u5408\u9002\u7d22\u5f15\u65f6\uff09\u3002</p> </li> <li> <p>\u4e0e\u5176\u5b83\u62e6\u622a\u5668\u51b2\u7a81</p> </li> <li> <p>\u95ee\u9898\u63cf\u8ff0\uff1a\u5982\u679c\u9879\u76ee\u4e2d\u540c\u65f6\u4f7f\u7528\u4e86\u591a\u4e2a MyBatis \u62e6\u622a\u5668\uff08\u5982\u6570\u636e\u6743\u9650\u62e6\u622a\u5668\u3001\u52a0\u89e3\u5bc6\u62e6\u622a\u5668\u7b49\uff09\uff0c\u62e6\u622a\u5668\u7684\u6267\u884c\u987a\u5e8f\u53ef\u80fd\u5f71\u54cd PageHelper \u7684\u6b63\u5e38\u5de5\u4f5c\uff08\u56e0\u4e3a\u5206\u9875\u4f9d\u8d56\u4e8e\u6539\u5199 SQL\uff09\u3002\u786e\u4fdd PageHelper \u662f\u6700\u540e\u4e00\u4e2a\u6267\u884c\u7684\u62e6\u622a\u5668\uff08\u53ef\u4ee5\u901a\u8fc7\u8c03\u6574\u62e6\u622a\u5668\u6dfb\u52a0\u987a\u5e8f\u5b9e\u73b0\uff09\u3002</p> </li> <li> <p>\u5bf9\u5f02\u6b65/\u591a\u7ebf\u7a0b\u652f\u6301\u4e0d\u53cb\u597d</p> </li> <li> <p>\u95ee\u9898\u63cf\u8ff0\uff1a\u7531\u4e8e\u4f9d\u8d56 <code>ThreadLocal</code>\uff0c\u5982\u679c\u5728\u5f02\u6b65\u4efb\u52a1\uff08\u5982 <code>@Async</code>\uff09\u6216\u591a\u7ebf\u7a0b\u73af\u5883\u4e2d\u4f7f\u7528 PageHelper\uff0c\u5206\u9875\u53c2\u6570\u53ef\u80fd\u65e0\u6cd5\u6b63\u786e\u4f20\u9012\u5230\u5b50\u7ebf\u7a0b\u3002</p> </li> <li> <p>\u8fd4\u56de\u5bf9\u8c61\u8fc7\u4e8e\u81c3\u80bf</p> </li> <li> <p>\u95ee\u9898\u63cf\u8ff0\uff1a<code>PageInfo</code> \u5bf9\u8c61\u5305\u542b\u5927\u91cf\u5206\u9875\u4fe1\u606f\uff08\u5982\u603b\u9875\u6570\u3001\u5bfc\u822a\u9875\u7801\u5217\u8868\u7b49\uff09\uff0c\u4f46\u5b9e\u9645\u4e1a\u52a1\u4e2d\u53ef\u80fd\u53ea\u9700\u8981\u90e8\u5206\u5b57\u6bb5\uff08\u5982\u5f53\u524d\u9875\u6570\u636e\u3001\u603b\u8bb0\u5f55\u6570\uff09\u3002</p> </li> <li> <p>\u8bbe\u8ba1\u8026\u5408</p> </li> <li> <p>\u95ee\u9898\u63cf\u8ff0\uff1a\u5206\u9875\u903b\u8f91\u4fb5\u5165\u4e1a\u52a1\u4ee3\u7801\uff08Service \u5c42\u4e2d\u663e\u5f0f\u8c03\u7528 <code>PageHelper.startPage()</code>\uff09\uff0c\u8fdd\u53cd\u4e86\u5206\u5c42\u8bbe\u8ba1\u7684\u7eaf\u7cb9\u6027\u3002</p> </li> </ul> <p>\u5efa\u8bae\uff1aPageHelper \u9002\u5408\u4e2d\u5c0f\u578b\u9879\u76ee\u7684\u5feb\u901f\u5f00\u53d1\uff0c\u4f46\u5728\u9ad8\u5e76\u53d1\u3001\u5927\u6570\u636e\u91cf\u3001\u590d\u6742SQL\u573a\u666f\u4e0b\u9700\u8c28\u614e\u4f7f\u7528\uff0c\u5fc5\u8981\u65f6\u91c7\u7528\u66f4\u53ef\u63a7\u7684\u5206\u9875\u65b9\u6848\u3002</p>"},{"location":"springboot/Spring%20Boot%E9%A1%B9%E7%9B%AE%E8%87%AA%E5%B7%B1%E5%B0%81%E8%A3%85%E4%B8%80%E4%B8%AA%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E5%B7%A5%E5%85%B7/#_1","title":"\u81ea\u5b9a\u4e49\u5206\u9875\u67e5\u8be2\u5de5\u5177","text":"<p>\u6211\u4eec\u53ef\u4ee5\u5728Spring Boot\u9879\u76ee\u4e2d\u4e0d\u4f7f\u7528PageHelper\uff0c\u800c\u662f\u81ea\u5df1\u5c01\u88c5\u4e00\u4e2a\u5206\u9875\u67e5\u8be2\u5de5\u5177\u3002\u4e3b\u8981\u601d\u8def\u5982\u4e0b\uff1a</p> <ol> <li> <p>\u5b9a\u4e49\u4e00\u4e2a\u5206\u9875\u8bf7\u6c42\u53c2\u6570\u7c7b\uff0c\u5305\u542b\u9875\u7801\u548c\u6bcf\u9875\u6570\u91cf\u3002</p> </li> <li> <p>\u5b9a\u4e49\u4e00\u4e2a\u5206\u9875\u7ed3\u679c\u7c7b\uff0c\u5305\u542b\u6570\u636e\u5217\u8868\u3001\u603b\u8bb0\u5f55\u6570\u3001\u603b\u9875\u6570\u3001\u5f53\u524d\u9875\u7801\u3001\u6bcf\u9875\u6570\u91cf\u7b49\u4fe1\u606f\u3002</p> </li> <li> <p>\u5b9a\u4e49\u4e00\u4e2a\u5206\u9875\u67e5\u8be2\u5de5\u5177\uff1a\u5148\u67e5\u8be2\u603b\u6570\uff0c\u518d\u67e5\u8be2\u5f53\u524d\u9875\u6570\u636e\uff0c\u7136\u540e\u5c01\u88c5\u6210\u5206\u9875\u7ed3\u679c\u5bf9\u8c61\u3002</p> </li> <li> <p>\u4f7f\u7528MyBatis Dynamic SQL\u81ea\u5b9a\u4e49\u590d\u6742\u5206\u9875\u67e5\u8be2\u903b\u8f91\uff1a\u4e00\u4e2a\u7528\u4e8e\u67e5\u8be2\u7b26\u5408\u6761\u4ef6\u7684\u603b\u8bb0\u5f55\u6570\uff0c\u4e00\u4e2a\u7528\u4e8e\u67e5\u8be2\u5f53\u524d\u9875\u7684\u6570\u636e\uff08\u4f7f\u7528\u6570\u636e\u5e93\u7684\u5206\u9875\u8bed\u6cd5\uff0c\u5982MySQL\u7684LIMIT\uff09\u3002</p> </li> </ol> <p>\u4e0b\u9762\u6211\u4eec\u4e00\u6b65\u6b65\u5b9e\u73b0\uff1a</p> <p>\u6b65\u9aa41\uff1a\u521b\u5efa\u5206\u9875\u8bf7\u6c42\u53c2\u6570\u7c7b\uff08PageRequest\uff09</p> <p>\u6b65\u9aa42\uff1a\u521b\u5efa\u5206\u9875\u7ed3\u679c\u7c7b\uff08PageResult\uff09</p> <p>\u6b65\u9aa43\uff1a\u521b\u5efa\u5206\u9875\u67e5\u8be2\u5de5\u5177\uff08PaginationUtils\uff09</p> <p>\u6b65\u9aa44\uff1a\u5728Mapper\u63a5\u53e3\u4e2d\u4f7f\u7528MyBatis Dynamic SQL\u81ea\u5b9a\u4e49\u590d\u6742\u5206\u9875\u67e5\u8be2\u903b\u8f91</p> <p>\u6b65\u9aa45\uff1a\u5728Service\u5c42\u8c03\u7528Mapper\u7684\u4e24\u4e2a\u65b9\u6cd5\uff0c\u5e76\u5c01\u88c5PageResult</p> <p>\u6b65\u9aa46\uff1a\u5728Controller\u4e2d\u63a5\u6536\u5206\u9875\u53c2\u6570\uff0c\u8c03\u7528Service\u65b9\u6cd5</p>"},{"location":"springboot/Spring%20Boot%E9%A1%B9%E7%9B%AE%E8%87%AA%E5%B7%B1%E5%B0%81%E8%A3%85%E4%B8%80%E4%B8%AA%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E5%B7%A5%E5%85%B7/#_2","title":"\u5206\u9875\u67e5\u8be2\u5177\u4f53\u4ee3\u7801\u5b9e\u73b0","text":""},{"location":"springboot/Spring%20Boot%E9%A1%B9%E7%9B%AE%E8%87%AA%E5%B7%B1%E5%B0%81%E8%A3%85%E4%B8%80%E4%B8%AA%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E5%B7%A5%E5%85%B7/#1-pagerequest","title":"1. \u5206\u9875\u8bf7\u6c42\u53c2\u6570\u7c7b\uff08PageRequest\uff09\uff1a","text":"<pre><code>import jakarta.validation.constraints.Max;\nimport jakarta.validation.constraints.Min;\nimport jakarta.validation.constraints.Pattern;\n\n\nimport java.util.List;\nimport java.util.Set;\n\n/**\n * \u5206\u9875\u8bf7\u6c42\u53c2\u6570\u5c01\u88c5\u7c7b\n */\n\n\npublic class PageRequest {\n\n    /**\n     * \u9ed8\u8ba4\u7b2c\u4e00\u9875\n     */\n    public static final int DEFAULT_PAGE_NUM = 1;\n\n    /**\n     * \u9ed8\u8ba4\u6bcf\u987510\u6761\n     */\n    public static final int DEFAULT_PAGE_SIZE = 10;\n\n    /**\n     * \u9ed8\u8ba4\u6392\u5e8f\u65b9\u5411 - \u5347\u5e8f\n     */\n    public static final String DEFAULT_ORDER = \"desc\";\n\n    /**\n     * \u6700\u5927\u5141\u8bb8\u7684\u6bcf\u9875\u8bb0\u5f55\u6570\n     */\n    public static final int MAX_PAGE_SIZE = 1000;\n\n    /**\n     * \u5f53\u524d\u9875\u7801\uff08\u4ece1\u5f00\u59cb\uff09\n     */\n    @Min(value = 1, message = \"\u9875\u7801\u4e0d\u80fd\u5c0f\u4e8e1\")\n    private int pageNum = DEFAULT_PAGE_NUM;\n\n    /**\n     * \u6bcf\u9875\u8bb0\u5f55\u6570\n     */\n    @Min(value = 1, message = \"\u6bcf\u9875\u6570\u91cf\u4e0d\u80fd\u5c0f\u4e8e1\")\n    @Max(value = MAX_PAGE_SIZE, message = \"\u6bcf\u9875\u6570\u91cf\u4e0d\u80fd\u8d85\u8fc7\" + MAX_PAGE_SIZE)\n    private int pageSize = DEFAULT_PAGE_SIZE;\n\n    /**\n     * \u6392\u5e8f\u5b57\u6bb5\n     */\n    private String sort;\n\n    /**\n     * \u6392\u5e8f\u65b9\u5411\n     * asc: \u5347\u5e8f\n     * desc: \u964d\u5e8f\n     */\n    @Pattern(regexp = \"asc|desc\", message = \"\u6392\u5e8f\u65b9\u5411\u5fc5\u987b\u662fasc\u6216desc\")\n    private String order = DEFAULT_ORDER;\n\n    // \u65e0\u53c2\u6784\u9020\u5668\n    public PageRequest() {\n    }\n\n    /**\n     * \u5e26\u9875\u7801\u548c\u6bcf\u9875\u6570\u91cf\u7684\u6784\u9020\u5668\n     *\n     * @param pageNum  \u5f53\u524d\u9875\u7801\n     * @param pageSize \u6bcf\u9875\u6570\u91cf\n     */\n    public PageRequest(int pageNum, int pageSize) {\n        this.pageNum = pageNum;\n        this.pageSize = pageSize;\n    }\n\n    /**\n     * \u5e26\u6240\u6709\u53c2\u6570\u7684\u6784\u9020\u5668\n     *\n     * @param pageNum  \u5f53\u524d\u9875\u7801\n     * @param pageSize \u6bcf\u9875\u6570\u91cf\n     * @param sort     \u6392\u5e8f\u5b57\u6bb5\n     * @param order    \u6392\u5e8f\u65b9\u5411\n     */\n    public PageRequest(int pageNum, int pageSize, String sort, String order) {\n        this.pageNum = pageNum;\n        this.pageSize = pageSize;\n        this.sort = sort;\n        this.order = order;\n    }\n\n    /**\n     * \u8ba1\u7b97\u504f\u79fb\u91cf\uff08\u7528\u4e8e\u6570\u636e\u5e93\u5206\u9875\u67e5\u8be2\uff09\n     *\n     * @return \u5f53\u524d\u9875\u7684\u8d77\u59cb\u4f4d\u7f6e\n     */\n    public int getOffset() {\n        return (pageNum - 1) * pageSize;\n    }\n\n    /**\n     * \u9a8c\u8bc1\u6392\u5e8f\u5b57\u6bb5\u662f\u5426\u5728\u5141\u8bb8\u7684\u5217\u8868\u4e2d\n     *\n     * @param allowedFields \u5141\u8bb8\u7684\u6392\u5e8f\u5b57\u6bb5\u96c6\u5408\n     * @return \u5982\u679c\u6392\u5e8f\u5b57\u6bb5\u6709\u6548\u8fd4\u56detrue\uff0c\u5426\u5219\u8fd4\u56defalse\n     */\n    public boolean isSortValid(Set&lt;String&gt; allowedFields) {\n        if (sort == null || sort.isEmpty()) {\n            return true;\n        }\n        return allowedFields.contains(sort);\n    }\n\n    /**\n     * \u9a8c\u8bc1\u6392\u5e8f\u5b57\u6bb5\u662f\u5426\u5728\u5141\u8bb8\u7684\u5217\u8868\u4e2d\uff0c\u65e0\u6548\u65f6\u629b\u51fa\u5f02\u5e38\n     *\n     * @param allowedFields \u5141\u8bb8\u7684\u6392\u5e8f\u5b57\u6bb5\u96c6\u5408\n     * @param errorMessage  \u9519\u8bef\u4fe1\u606f\n     * @throws IllegalArgumentException \u5982\u679c\u6392\u5e8f\u5b57\u6bb5\u65e0\u6548\n     */\n    public void validateSort(List&lt;String&gt; allowedFields, String errorMessage) {\n        if (sort != null &amp;&amp; !sort.isEmpty() &amp;&amp; !allowedFields.contains(sort)) {\n            throw new IllegalArgumentException(errorMessage);\n        }\n    }\n\n    public int getPageNum() {\n        return pageNum;\n    }\n\n    public void setPageNum(int pageNum) {\n        this.pageNum = pageNum;\n    }\n\n    public int getPageSize() {\n        return pageSize;\n    }\n\n    public void setPageSize(int pageSize) {\n        this.pageSize = pageSize;\n    }\n\n    public String getSort() {\n        return sort;\n    }\n\n    public void setSort(String sort) {\n        this.sort = sort;\n    }\n\n    public String getOrder() {\n        return order;\n    }\n\n    public void setOrder(String order) {\n        this.order = order;\n    }\n}\n</code></pre>"},{"location":"springboot/Spring%20Boot%E9%A1%B9%E7%9B%AE%E8%87%AA%E5%B7%B1%E5%B0%81%E8%A3%85%E4%B8%80%E4%B8%AA%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E5%B7%A5%E5%85%B7/#2-pageresult","title":"2. \u5206\u9875\u7ed3\u679c\u7c7b\uff08PageResult\uff09\uff1a","text":"<pre><code>import java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.List;\nimport java.util.function.BiFunction;\nimport java.util.function.Function;\nimport java.util.stream.Collectors;\n\n\npublic class PageResult&lt;T&gt; {\n\n    private final int pageNum;        // \u5f53\u524d\u9875\u7801\n    private final int pageSize;        // \u6bcf\u9875\u6570\u91cf\n    private final long total;      // \u603b\u8bb0\u5f55\u6570\n    private final int totalPage;       // \u603b\u9875\u6570\n    private final List&lt;T&gt; data;    // \u5f53\u524d\u9875\u6570\u636e\n    private final String sort;     // \u6392\u5e8f\u5b57\u6bb5\n    private final String order;    // \u6392\u5e8f\u65b9\u5411\n\n    /**\n     * \u6784\u9020\u51fd\u6570\n     *\n     * @param pageRequest \u5206\u9875\u8bf7\u6c42\n     * @param total       \u603b\u8bb0\u5f55\u6570\n     * @param data        \u5f53\u524d\u9875\u6570\u636e\n     */\n    public PageResult(PageRequest pageRequest, long total, List&lt;T&gt; data) {\n        this.pageNum = pageRequest.getPageNum();\n        this.pageSize = pageRequest.getPageSize();\n        this.sort = pageRequest.getSort();\n        this.order = pageRequest.getOrder();\n        this.total = total;\n        this.totalPage = calculateTotalPage(total, pageRequest.getPageSize());\n        this.data = data;\n    }\n\n    /**\n     * \u6784\u9020\u51fd\u6570\n     *\n     * @param pageNum  \u5f53\u524d\u9875\u7801\n     * @param pageSize  \u6bcf\u9875\u6570\u91cf\n     * @param total \u603b\u8bb0\u5f55\u6570\n     * @param data  \u5f53\u524d\u9875\u6570\u636e\n     * @param sort  \u6392\u5e8f\u5b57\u6bb5\n     * @param order \u6392\u5e8f\u65b9\u5411\n     */\n    public PageResult(int pageNum, int pageSize, long total, List&lt;T&gt; data, String sort, String order) {\n        this.pageNum = pageNum;\n        this.pageSize = pageSize;\n        this.total = total;\n        this.data = data != null ? data : Collections.emptyList();\n        this.sort = sort;\n        this.order = order;\n\n        // \u8ba1\u7b97\u603b\u9875\u6570\n        this.totalPage = calculateTotalPage(total, pageSize);\n    }\n\n    /**\n     * \u8ba1\u7b97\u603b\u9875\u6570\n     *\n     * @param total \u603b\u8bb0\u5f55\u6570\n     * @param size  \u6bcf\u9875\u6570\u91cf\n     * @return \u603b\u9875\u6570\n     */\n    private int calculateTotalPage(long total, int size) {\n        if (size &lt;= 0) return 0;\n        return (int) Math.ceil((double) total / size);\n    }\n\n\n    // ================ \u5b9e\u7528\u9759\u6001\u65b9\u6cd5 ================ //\n\n    /**\n     * \u521b\u5efa\u7a7a\u7684\u5206\u9875\u7ed3\u679c\n     *\n     * @param &lt;T&gt; \u6570\u636e\u7c7b\u578b\n     * @return \u7a7a\u7684\u5206\u9875\u7ed3\u679c\n     */\n    public static &lt;T&gt; PageResult&lt;T&gt; empty() {\n        return new PageResult&lt;&gt;(1, 0, 0, Collections.emptyList(), null, null);\n    }\n\n    /**\n     * \u57fa\u4e8e PageRequest \u521b\u5efa\u7a7a\u7684\u5206\u9875\u7ed3\u679c\n     *\n     * @param pageRequest \u5206\u9875\u8bf7\u6c42\n     * @param &lt;T&gt;         \u6570\u636e\u7c7b\u578b\n     * @return \u7a7a\u7684\u5206\u9875\u7ed3\u679c\n     */\n    public static &lt;T&gt; PageResult&lt;T&gt; empty(PageRequest pageRequest) {\n        return new PageResult&lt;&gt;(\n                pageRequest.getPageNum(),\n                pageRequest.getPageSize(),\n                0,\n                Collections.emptyList(),\n                pageRequest.getSort(),\n                pageRequest.getOrder()\n        );\n    }\n\n    /**\n     * \u521b\u5efa\u5355\u9875\u7ed3\u679c\uff08\u9002\u7528\u4e8e\u6570\u636e\u91cf\u5c0f\u7684\u60c5\u51b5\uff09\n     *\n     * @param data \u6240\u6709\u6570\u636e\n     * @param &lt;T&gt;  \u6570\u636e\u7c7b\u578b\n     * @return \u5355\u9875\u7ed3\u679c\n     */\n    public static &lt;T&gt; PageResult&lt;T&gt; singlePage(List&lt;T&gt; data) {\n        long total = data != null ? data.size() : 0;\n        return new PageResult&lt;&gt;(1, (int) total, total, data, null, null);\n    }\n\n    /**\n     * \u521b\u5efa\u5206\u9875\u7ed3\u679c\uff08\u57fa\u4e8e PageRequest\uff09\n     *\n     * @param pageRequest \u5206\u9875\u8bf7\u6c42\n     * @param total       \u603b\u8bb0\u5f55\u6570\n     * @param data        \u5f53\u524d\u9875\u6570\u636e\n     * @param &lt;T&gt;         \u6570\u636e\u7c7b\u578b\n     * @return \u5206\u9875\u7ed3\u679c\n     */\n    public static &lt;T&gt; PageResult&lt;T&gt; of(PageRequest pageRequest, long total, List&lt;T&gt; data) {\n        return new PageResult&lt;&gt;(\n                pageRequest.getPageNum(),\n                pageRequest.getPageSize(),\n                total,\n                data,\n                pageRequest.getSort(),\n                pageRequest.getOrder()\n        );\n    }\n\n    /**\n     * \u8f6c\u6362\u5206\u9875\u7ed3\u679c\u7684\u6570\u636e\u7c7b\u578b\n     *\n     * @param source \u6e90\u5206\u9875\u7ed3\u679c\n     * @param mapper \u6570\u636e\u8f6c\u6362\u51fd\u6570\n     * @param &lt;T&gt;    \u6e90\u6570\u636e\u7c7b\u578b\n     * @param &lt;R&gt;    \u76ee\u6807\u6570\u636e\u7c7b\u578b\n     * @return \u8f6c\u6362\u540e\u7684\u5206\u9875\u7ed3\u679c\n     */\n    public static &lt;T, R&gt; PageResult&lt;R&gt; map(PageResult&lt;T&gt; source, Function&lt;T, R&gt; mapper) {\n        if (source == null || mapper == null) {\n            throw new IllegalArgumentException(\"Source and mapper must not be null\");\n        }\n\n        List&lt;R&gt; mappedData = source.getData().stream()\n                .map(mapper)\n                .collect(Collectors.toList());\n\n        return new PageResult&lt;&gt;(\n                source.getPageNum(),\n                source.getPageSize(),\n                source.getTotal(),\n                mappedData,\n                source.getSort(),\n                source.getOrder()\n        );\n    }\n\n    /**\n     * \u5408\u5e76\u4e24\u4e2a\u5206\u9875\u7ed3\u679c\uff08\u9002\u7528\u4e8e\u5e76\u884c\u67e5\u8be2\u573a\u666f\uff09\n     *\n     * @param result1  \u7b2c\u4e00\u4e2a\u5206\u9875\u7ed3\u679c\n     * @param result2  \u7b2c\u4e8c\u4e2a\u5206\u9875\u7ed3\u679c\n     * @param combiner \u6570\u636e\u5408\u5e76\u51fd\u6570\n     * @param &lt;T&gt;      \u7b2c\u4e00\u4e2a\u7ed3\u679c\u7684\u6570\u636e\u7c7b\u578b\n     * @param &lt;U&gt;      \u7b2c\u4e8c\u4e2a\u7ed3\u679c\u7684\u6570\u636e\u7c7b\u578b\n     * @param &lt;R&gt;      \u5408\u5e76\u540e\u7684\u6570\u636e\u7c7b\u578b\n     * @return \u5408\u5e76\u540e\u7684\u5206\u9875\u7ed3\u679c\n     */\n    public static &lt;T, U, R&gt; PageResult&lt;R&gt; combine(\n            PageResult&lt;T&gt; result1,\n            PageResult&lt;U&gt; result2,\n            BiFunction&lt;T, U, R&gt; combiner) {\n\n        // \u9a8c\u8bc1\u5206\u9875\u4fe1\u606f\u662f\u5426\u4e00\u81f4\n        if (result1.getPageNum() != result2.getPageNum() ||\n                result1.getPageSize() != result2.getPageSize() ||\n                result1.getTotal() != result2.getTotal()) {\n            throw new IllegalArgumentException(\"Page results are not compatible for combination\");\n        }\n\n        // \u9a8c\u8bc1\u6570\u636e\u6570\u91cf\u662f\u5426\u4e00\u81f4\n        if (result1.getData().size() != result2.getData().size()) {\n            throw new IllegalArgumentException(\"Data lists have different sizes\");\n        }\n\n        // \u5408\u5e76\u6570\u636e\n        List&lt;R&gt; combinedData = new ArrayList&lt;&gt;();\n        for (int i = 0; i &lt; result1.getData().size(); i++) {\n            R combined = combiner.apply(\n                    result1.getData().get(i),\n                    result2.getData().get(i)\n            );\n            combinedData.add(combined);\n        }\n\n        return new PageResult&lt;&gt;(\n                result1.getPageNum(),\n                result1.getPageSize(),\n                result1.getTotal(),\n                combinedData,\n                result1.getSort(),\n                result1.getOrder()\n        );\n    }\n\n    public int getPageNum() {\n        return pageNum;\n    }\n\n    public int getPageSize() {\n        return pageSize;\n    }\n\n    public long getTotal() {\n        return total;\n    }\n\n    public int getTotalPage() {\n        return totalPage;\n    }\n\n    public List&lt;T&gt; getData() {\n        return data;\n    }\n\n    public String getSort() {\n        return sort;\n    }\n\n    public String getOrder() {\n        return order;\n    }\n}\n</code></pre>"},{"location":"springboot/Spring%20Boot%E9%A1%B9%E7%9B%AE%E8%87%AA%E5%B7%B1%E5%B0%81%E8%A3%85%E4%B8%80%E4%B8%AA%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E5%B7%A5%E5%85%B7/#3-paginationutils","title":"3. \u521b\u5efa\u5206\u9875\u67e5\u8be2\u5de5\u5177\uff08PaginationUtils\uff09","text":"<pre><code>import java.util.List;\nimport java.util.function.Supplier;\n\npublic class PaginationUtils {\n\n    /**\n     * \u6267\u884c\u5206\u9875\u67e5\u8be2\uff08\u4f7f\u7528PageRequest\u5bf9\u8c61\uff09\n     *\n     * @param pageRequest   \u5206\u9875\u8bf7\u6c42\uff08\u5305\u542b\u9875\u7801\u3001\u5927\u5c0f\u3001\u6392\u5e8f\u7b49\u4fe1\u606f\uff09\n     * @param countFunction \u67e5\u8be2\u603b\u6570\u7684\u51fd\u6570\n     * @param dataFunction  \u67e5\u8be2\u6570\u636e\u7684\u51fd\u6570\n     * @return \u5206\u9875\u7ed3\u679c\n     */\n    public static &lt;T&gt; PageResult&lt;T&gt; paginate(PageRequest pageRequest,\n                                             Supplier&lt;Long&gt; countFunction,\n                                             Supplier&lt;List&lt;T&gt;&gt; dataFunction) {\n        // \u67e5\u8be2\u603b\u6570\n        long total = countFunction.get();\n\n        // \u5982\u679c\u6ca1\u6709\u6570\u636e\uff0c\u76f4\u63a5\u8fd4\u56de\u7a7a\u7ed3\u679c\n        if (total == 0) {\n            return PageResult.empty(pageRequest);\n        }\n\n        // \u67e5\u8be2\u5f53\u524d\u9875\u6570\u636e\n        List&lt;T&gt; data = dataFunction.get();\n\n        return new PageResult&lt;&gt;(pageRequest, total, data);\n    }\n}\n</code></pre>"},{"location":"springboot/Spring%20Boot%E9%A1%B9%E7%9B%AE%E8%87%AA%E5%B7%B1%E5%B0%81%E8%A3%85%E4%B8%80%E4%B8%AA%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E5%B7%A5%E5%85%B7/#4-mappermybatis-dynamic-sql","title":"4. Mapper\u63a5\u53e3\u793a\u4f8b\uff08\u4f7f\u7528MyBatis Dynamic SQL\uff09\uff1a","text":"<p>\u5f53\u8fdb\u884cJOIN\u6216\u590d\u6742\u5b50\u67e5\u8be2\u65f6\uff0c\u67e5\u8be2\u7ed3\u679c\u901a\u5e38\u6d89\u53ca\u591a\u4e2a\u5b9e\u4f53\uff0c\u56e0\u6b64\u9700\u8981\u81ea\u5b9a\u4e49\u7ed3\u679c\u6620\u5c04\u3002MyBatis Dynamic SQL\u672c\u8eab\u4e0d\u5904\u7406\u7ed3\u679c\u6620\u5c04\uff0c\u4f60\u9700\u8981\uff1a</p> <ul> <li> <p>\u4f7f\u7528\u6ce8\u89e3\uff1a\u5728Mapper\u63a5\u53e3\u7684\u65b9\u6cd5\u4e0a\u4f7f\u7528<code>@Results</code>\u548c<code>@Result</code>\u6ce8\u89e3\u5b9a\u4e49\u6620\u5c04\u5173\u7cfb\u3002</p> </li> <li> <p>\u4f7f\u7528XML\uff1a\u5728Mapper XML\u6587\u4ef6\u4e2d\u5b9a\u4e49<code>&lt;resultMap&gt;</code>\u3002</p> </li> </ul> <p>\u4f8b\u5982\uff0c\u5bf9\u4e8e\u89c4\u5219\u548c\u89c4\u5219\u7248\u672c(\u4e00\u5bf9\u591a)\u7684JOIN\u67e5\u8be2\uff0c\u7ed3\u679c\u5c01\u88c5\u5230\u4e00\u4e2aDTO\uff08Data Transfer Object\uff09\u4e2d\uff1a</p> <p><pre><code>import java.util.Date;\n\npublic class RuleWithLatestVersionDTO {\n    private Long id;\n    private String ruleId;\n    private String name;\n    private String domain;\n    private Integer latestVersion;\n    private String versionName;\n    private String versionStatus;\n    private Date versionModifiedDate;\n\n    // getters and setters\n\n}\n</code></pre> \u5728 Mapper\u63a5\u53e3\u7ed3\u679c\u6620\u5c04\u914d\u7f6e\u5982\u4e0b\uff1a <pre><code>import com.example.demo.model.dto.response.RuleWithLatestVersionDTO;\nimport org.apache.ibatis.annotations.Mapper;\nimport org.apache.ibatis.annotations.Result;\nimport org.apache.ibatis.annotations.Results;\nimport org.apache.ibatis.annotations.SelectProvider;\nimport org.mybatis.dynamic.sql.select.render.SelectStatementProvider;\nimport org.mybatis.dynamic.sql.util.SqlProviderAdapter;\nimport org.mybatis.dynamic.sql.util.mybatis3.CommonCountMapper;\n\nimport java.util.List;\n\n@Mapper\npublic interface RuleCustomMapper extends CommonCountMapper {\n\n\n    // \u4f7f\u7528@Result\u6ce8\u89e3\u5904\u7406\u591a\u8868\u5b57\u6bb5\n    @SelectProvider(type = SqlProviderAdapter.class, method = \"select\")\n    @Results({\n            @Result(column = \"id\", property = \"id\"),\n            @Result(column = \"ruleId\", property = \"ruleId\"),\n            @Result(column = \"name\", property = \"name\"),\n            @Result(column = \"domain\", property = \"domain\"),\n            @Result(column = \"latestVersion\", property = \"latestVersion\"),\n            @Result(column = \"versionName\", property = \"versionName\"),\n            @Result(column = \"versionStatus\", property = \"versionStatus\"),\n            @Result(column = \"versionModifiedDate\", property = \"versionModifiedDate\"),\n    })\n    List&lt;RuleWithLatestVersionDTO&gt; findByCondition(SelectStatementProvider selectStatement);\n}\n</code></pre></p>"},{"location":"springboot/Spring%20Boot%E9%A1%B9%E7%9B%AE%E8%87%AA%E5%B7%B1%E5%B0%81%E8%A3%85%E4%B8%80%E4%B8%AA%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E5%B7%A5%E5%85%B7/#5-mybatis-dynamic-sqljoin","title":"5. MyBatis Dynamic SQL\u5904\u7406\u590d\u6742JOIN\u548c\u5b50\u67e5\u8be2\uff1a","text":"<p>\u544a\u522b\u7e41\u7410\u7684 XML \u548c OGNL:</p> <ul> <li> <p>\u75db\u70b9\uff1a \u4f20\u7edf\u7684 MyBatis XML Mapper \u6587\u4ef6\u867d\u7136\u529f\u80fd\u5f3a\u5927\uff0c\u4f46\u7f16\u5199\u548c\u9605\u8bfb\u52a8\u6001 SQL\uff08\u4f7f\u7528 <code>&lt;if&gt;</code>, <code>&lt;choose&gt;</code>, <code>&lt;when&gt;</code>, <code>&lt;otherwise&gt;</code>, <code>&lt;foreach&gt;</code> \u7b49\u6807\u7b7e\uff09\u5728\u590d\u6742\u573a\u666f\u4e0b\u4f1a\u53d8\u5f97\u5197\u957f\u3001\u5d4c\u5957\u6df1\u3001\u53ef\u8bfb\u6027\u4e0b\u964d\uff0c\u4e14\u9700\u8981\u638c\u63e1 OGNL \u8868\u8fbe\u5f0f\u3002\u5728 Java \u548c XML \u4e4b\u95f4\u5207\u6362\u4e5f\u5f71\u54cd\u5f00\u53d1\u6548\u7387\u3002</p> </li> <li> <p>\u89e3\u51b3\uff1a Dynamic SQL \u5c06 SQL \u6784\u5efa\u903b\u8f91\u5b8c\u5168\u79fb\u56de Java \u4ee3\u7801\u4e2d\uff0c\u5229\u7528 Java \u8bed\u8a00\u7684\u6d41\u7a0b\u63a7\u5236 (if/else, \u5faa\u73af) \u548c\u5f3a\u5927\u7684 IDE \u652f\u6301\uff08\u4ee3\u7801\u8865\u5168\u3001\u91cd\u6784\u3001\u5bfc\u822a\uff09\uff0c\u5f00\u53d1\u4f53\u9a8c\u66f4\u6d41\u7545\u3001\u66f4\u73b0\u4ee3\u3002</p> </li> </ul> <p>\u6bd4\u5982\u6709\u5982\u4e0b\u7684\u4e00\u4e2asql\u8bed\u53e5\uff0c\u83b7\u53d6\u6ee1\u8db3\u6761\u4ef6\u7684\u89c4\u5219\u53ca\u5176\u6700\u65b0\u7248\u672c\u4fe1\u606f\uff1a</p> <p><pre><code>SELECT ruleTable.id AS id, ruleTable.rule_id AS ruleId, ruleTable.name AS name, ruleTable.domain AS domain, max_version AS latestVersion\n    , ruleVersionTable.name AS versionName, ruleVersionTable.status AS versionStatus, ruleVersionTable.gmt_modified AS versionModifiedDate\nFROM rule ruleTable\n    JOIN rule_version ruleVersionTable ON ruleTable.rule_id = ruleVersionTable.rule_id\n    JOIN (\n        SELECT ruleVersionTable.rule_id AS rule_uuid, MAX(ruleVersionTable.version) AS max_version\n        FROM rule_version ruleVersionTable\n        WHERE ruleVersionTable.id &gt; #{parameters.p1,jdbcType=BIGINT}\n        GROUP BY ruleVersionTable.rule_id\n    ) max_ver\n    ON ruleVersionTable.rule_id = max_ver.rule_uuid\n        AND ruleVersionTable.version = max_ver.max_version\nWHERE ruleTable.id &gt; #{parameters.p2,jdbcType=BIGINT}\n    AND ruleTable.name LIKE #{parameters.p3,jdbcType=VARCHAR}\nORDER BY ruleVersionTable.id\nLIMIT #{parameters.p5}, #{parameters.p4}\n</code></pre> \u4f7f\u7528 MyBatis Dynamic SQL \u5b9e\u73b0\u5982\u4e0b\u3010\u5904\u7406\u590d\u6742JOIN\u548c\u5b50\u67e5\u8be2\u3011\uff1a</p> <p><pre><code>import com.example.demo.common.model.page.PageRequest;\nimport com.example.demo.model.query.RuleQueryCondition;\nimport com.example.demo.repository.generated.RuleEntityDynamicSqlSupport;\nimport com.example.demo.repository.generated.RuleVersionEntityDynamicSqlSupport;\n\n\nimport org.mybatis.dynamic.sql.SortSpecification;\nimport org.mybatis.dynamic.sql.SqlColumn;\nimport org.mybatis.dynamic.sql.SqlTable;\nimport org.mybatis.dynamic.sql.select.ColumnSortSpecification;\nimport org.mybatis.dynamic.sql.select.QueryExpressionDSL;\nimport org.mybatis.dynamic.sql.select.SelectModel;\nimport org.mybatis.dynamic.sql.select.render.SelectStatementProvider;\nimport org.mybatis.dynamic.sql.render.RenderingStrategies;\nimport org.springframework.stereotype.Component;\n\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.sql.JDBCType;\n\nimport static org.mybatis.dynamic.sql.SqlBuilder.*;\n\n@Component\npublic class RuleQueryBuilder {\n    private final RuleVersionEntityDynamicSqlSupport.RuleVersionEntity ruleVersionDO = RuleVersionEntityDynamicSqlSupport.ruleVersionEntity;\n    private final RuleEntityDynamicSqlSupport.RuleEntity ruleDO = RuleEntityDynamicSqlSupport.ruleEntity;\n\n    // \u6570\u636e\u67e5\u8be2\n    public SelectStatementProvider buildDataQuery(RuleQueryCondition queryCondition, PageRequest pageRequest) {\n\n        // 1. \u521b\u5efa\u6d3e\u751f\u8868\u7684\u522b\u540d\u548c\u5217\u5b9a\u4e49\n        // \u5b50\u67e5\u8be2\u7684\u8868\u522b\u540d\n        String subQueryTable = \"max_ver\";\n        SqlTable maxVerTable = SqlTable.of(subQueryTable);\n        SqlColumn&lt;String&gt; maxVerRuleUuid = SqlColumn.of(\"rule_uuid\", maxVerTable, JDBCType.VARCHAR);\n        SqlColumn&lt;Integer&gt; maxVerMaxVersion = SqlColumn.of(\"max_version\", maxVerTable, JDBCType.INTEGER);\n        // \u52a8\u6001\u6784\u5efa\u6392\u5e8f\n        List&lt;SortSpecification&gt; sortSpecs = new ArrayList&lt;&gt;();\n        SortSpecification sortSpecification = buildSortSpecification(pageRequest.getSort(), pageRequest.getOrder());\n        if (sortSpecification != null) {\n            sortSpecs.add(sortSpecification);\n        }\n\n        // 2.\u6784\u5efa\u5b50\u67e5\u8be2\n        QueryExpressionDSL&lt;SelectModel&gt;.GroupByFinisher maxVersionSubQuery = buildMaxVersionSubQuery(queryCondition);\n\n        // 3. \u4e3b\u67e5\u8be2\uff1a\u5173\u8054\u89c4\u5219\u8868\u3001\u7248\u672c\u8868\u548c\u6700\u5927\u7248\u672c\u5b50\u67e5\u8be2\n        return select(\n                ruleDO.id.as(\"id\"),\n                ruleDO.ruleId.as(\"ruleId\"),\n                ruleDO.name.as(\"name\"),\n                ruleDO.domain.as(\"domain\"),\n                maxVerMaxVersion.as(\"latestVersion\"),\n                ruleVersionDO.name.as(\"versionName\"),\n                ruleVersionDO.status.as(\"versionStatus\"),\n                ruleVersionDO.gmtModified.as(\"versionModifiedDate\")\n        )\n                .from(ruleDO, \"ruleDO\")\n                .join(ruleVersionDO, \"ruleVersionDO\")\n                .on(ruleDO.ruleId, equalTo(ruleVersionDO.ruleId))\n                .join(maxVersionSubQuery, subQueryTable)\n                .on(ruleVersionDO.ruleId, equalTo(maxVerRuleUuid.qualifiedWith(subQueryTable)))\n                .and(ruleVersionDO.version, equalTo(maxVerMaxVersion.qualifiedWith(subQueryTable)))\n                .where(ruleDO.id, isGreaterThan(0L))\n                .and(ruleDO.tenantId, isEqualToWhenPresent(queryCondition.getTenantId()))\n                .and(ruleDO.ruleId, isLikeWhenPresent(wrapLike(queryCondition.getRuleId())))\n                .and(ruleDO.name, isLikeWhenPresent(wrapLike(queryCondition.getName())))\n                .and(ruleDO.creator, isLikeWhenPresent(wrapLike(queryCondition.getCreateBy())))\n                .and(ruleDO.type, isEqualToWhenPresent(queryCondition.getType()))\n                .and(ruleDO.domain, isEqualToWhenPresent(queryCondition.getDomain()))\n                .and(ruleDO.description, isLikeWhenPresent(wrapLike(queryCondition.getDescription())))\n                .orderBy(sortSpecs.toArray(new SortSpecification[0]))\n                .limit(pageRequest.getPageSize())\n                .offset(pageRequest.getOffset())\n                .build()\n                .render(RenderingStrategies.MYBATIS3);\n\n    }\n\n    // \u603b\u6570\u67e5\u8be2\n    public SelectStatementProvider buildCountQuery(RuleQueryCondition queryCondition) {\n        // 1. \u521b\u5efa\u6d3e\u751f\u8868\u7684\u522b\u540d\u548c\u5217\u5b9a\u4e49\n\n        String subQueryTable = \"max_ver\";\n        SqlTable maxVerTable = SqlTable.of(subQueryTable);\n        SqlColumn&lt;String&gt; maxVerRuleUuid = SqlColumn.of(\"rule_uuid\", maxVerTable, JDBCType.VARCHAR);\n        SqlColumn&lt;Integer&gt; maxVerMaxVersion = SqlColumn.of(\"max_version\", maxVerTable, JDBCType.INTEGER);\n        // 2. \u6784\u5efa\u5b50\u67e5\u8be2\n        QueryExpressionDSL&lt;SelectModel&gt;.GroupByFinisher maxVersionSubQuery = buildMaxVersionSubQuery(queryCondition);\n\n        // 3. \u4e3b\u67e5\u8be2\uff1a\u5173\u8054\u89c4\u5219\u8868\u3001\u7248\u672c\u8868\u548c\u6700\u5927\u7248\u672c\u5b50\u67e5\u8be2\n        return select(count())\n                .from(ruleDO, \"ruleDO\")\n                .join(ruleVersionDO, \"ruleVersionDO\")\n                .on(ruleDO.ruleId, equalTo(ruleVersionDO.ruleId))\n                .join(maxVersionSubQuery, subQueryTable)\n                .on(ruleVersionDO.ruleId, equalTo(maxVerRuleUuid.qualifiedWith(subQueryTable)))\n                .and(ruleVersionDO.version, equalTo(maxVerMaxVersion.qualifiedWith(subQueryTable)))\n                .where(ruleVersionDO.id, isGreaterThan(0L))  // \u786e\u4fddwhere\u6761\u4ef6\u6709\u503c\n                .and(ruleDO.tenantId, isEqualToWhenPresent(queryCondition.getTenantId()))\n                .and(ruleDO.ruleId, isLikeWhenPresent(wrapLike(queryCondition.getRuleId())))\n                .and(ruleDO.name, isLikeWhenPresent(wrapLike(queryCondition.getName())))\n                .and(ruleDO.creator, isLikeWhenPresent(wrapLike(queryCondition.getCreateBy())))\n                .and(ruleDO.type, isEqualToWhenPresent(queryCondition.getType()))\n                .and(ruleDO.domain, isEqualToWhenPresent(queryCondition.getDomain()))\n                .and(ruleDO.description, isLikeWhenPresent(wrapLike(queryCondition.getDescription())))\n                .build()\n                .render(RenderingStrategies.MYBATIS3);\n    }\n\n    // \u516c\u5171\u65b9\u6cd5\uff1a\u6784\u5efa\u6700\u5927\u7248\u672c\u5b50\u67e5\u8be2\n    private QueryExpressionDSL&lt;SelectModel&gt;.GroupByFinisher buildMaxVersionSubQuery(RuleQueryCondition queryCondition) {\n        return select(\n                ruleVersionDO.ruleId.as(\"rule_uuid\"),\n                max(ruleVersionDO.version).as(\"max_version\"))\n                .from(ruleVersionDO)\n                .where(ruleVersionDO.id, isGreaterThan(0L))\n                .and(ruleVersionDO.modifier, isLikeWhenPresent(wrapLike(queryCondition.getUpdateBy())))\n                .and(ruleVersionDO.gmtCreate, isGreaterThanOrEqualToWhenPresent(queryCondition.getGmtCreateFrom()))\n                .and(ruleVersionDO.gmtCreate, isLessThanOrEqualToWhenPresent(queryCondition.getGmtCreateTo()))\n                .and(ruleVersionDO.gmtModified, isGreaterThanOrEqualToWhenPresent(queryCondition.getGmtModifiedFrom()))\n                .and(ruleVersionDO.gmtModified, isLessThanOrEqualToWhenPresent(queryCondition.getGmtModifiedTo()))\n                .and(ruleVersionDO.description, isLikeWhenPresent(wrapLike(queryCondition.getRuleVersionDesc())))\n                .and(ruleVersionDO.name, isLikeWhenPresent(wrapLike(queryCondition.getRuleVersionName())))\n                .and(ruleVersionDO.status, isEqualToWhenPresent(queryCondition.getStatus()))\n\n                .groupBy(ruleVersionDO.ruleId);\n    }\n\n    private SortSpecification buildSortSpecification(String field, String order) {\n        if (field == null) {\n            return new ColumnSortSpecification(\"ruleVersionDO\", ruleVersionDO.id);\n        }\n        ColumnSortSpecification columnSortSpecification;\n        switch (field) {\n            case \"gmtCreate\" -&gt;\n                    columnSortSpecification = new ColumnSortSpecification(\"ruleVersionDO\", ruleVersionDO.gmtCreate);\n            case \"gmtModified\" -&gt;\n                    columnSortSpecification = new ColumnSortSpecification(\"ruleVersionDO\", ruleVersionDO.gmtModified);\n            // \u5176\u4ed6\u5b57\u6bb5...\n            // \u9ed8\u8ba4\u6392\u5e8f\u903b\u8f91\n            default -&gt; columnSortSpecification = new ColumnSortSpecification(\"ruleVersionDO\", ruleVersionDO.id);\n        }\n\n        return \"asc\".equalsIgnoreCase(order) ? columnSortSpecification : columnSortSpecification.descending();\n    }\n\n\n    private String wrapLike(String value) {\n        return value != null ? \"%\" + value + \"%\" : null;\n    }\n\n}\n</code></pre> \u4f20\u7edf mapper.xml\uff08XML \u52a8\u6001 SQL\uff09</p> <pre><code>&lt;!-- 1. \u5b9a\u4e49\u67e5\u8be2\u8bed\u53e5 --&gt;\n&lt;select id=\"selectRulesWithLatestVersion\" resultType=\"RuleWithLatestVersionDTO\"&gt;\n  SELECT \n    ruleTable.id AS id,\n    ruleTable.rule_id AS ruleId,\n    ruleTable.name AS name,\n    ruleTable.domain AS domain,\n    max_ver.max_version AS latestVersion,\n    ruleVersionTable.name AS versionName,\n    ruleVersionTable.status AS versionStatus,\n    ruleVersionTable.gmt_modified AS versionModifiedDate\n  FROM rule ruleTable\n  JOIN rule_version ruleVersionTable \n    ON ruleTable.rule_id = ruleVersionTable.rule_id\n  JOIN (\n    SELECT \n      rule_id AS rule_uuid, \n      MAX(version) AS max_version\n    FROM rule_version\n    &lt;where&gt;\n      &lt;if test=\"p1 != null\"&gt;\n        AND id &gt; #{p1}\n      &lt;/if&gt;\n    &lt;/where&gt;\n    GROUP BY rule_id\n  ) max_ver \n    ON ruleVersionTable.rule_id = max_ver.rule_uuid\n    AND ruleVersionTable.version = max_ver.max_version\n  &lt;where&gt;\n    &lt;if test=\"p2 != null\"&gt;\n      AND ruleTable.id &gt; #{p2}\n    &lt;/if&gt;\n    &lt;if test=\"p3 != null\"&gt;\n      AND ruleTable.name LIKE CONCAT('%', #{p3}, '%')\n    &lt;/if&gt;\n  &lt;/where&gt;\n  ORDER BY ruleVersionTable.id\n  LIMIT #{p5}, #{p4}\n&lt;/select&gt;\n\n&lt;!-- 2. Mapper \u63a5\u53e3 --&gt;\npublic interface RuleMapper {\n    List&lt;RuleWithLatestVersionDTO&gt; selectRulesWithLatestVersion(\n        @Param(\"p1\") Long p1, \n        @Param(\"p2\") Long p2,\n        @Param(\"p3\") String namePattern,\n        @Param(\"p4\") Integer pageSize,\n        @Param(\"p5\") Integer offset);\n}\n</code></pre>"},{"location":"springboot/Spring%20Boot%E9%A1%B9%E7%9B%AE%E8%87%AA%E5%B7%B1%E5%B0%81%E8%A3%85%E4%B8%80%E4%B8%AA%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E5%B7%A5%E5%85%B7/#_3","title":"\u5173\u952e\u5dee\u5f02\u5bf9\u6bd4","text":"\u7279\u6027 MyBatis Dynamic SQL \u4f20\u7edf mapper.xml \u4ee3\u7801\u7c7b\u578b Java \u4ee3\u7801 XML \u914d\u7f6e\u6587\u4ef6 \u53ef\u8bfb\u6027 \u2b50\u2b50\u2b50\u2b50 (\u5f3a\u7c7b\u578b\u68c0\u67e5) \u2b50\u2b50 (\u9700\u5207\u6362\u6587\u4ef6\u67e5\u770b) \u7f16\u8bd1\u65f6\u68c0\u67e5 \u2705 \u7c7b\u578b\u5b89\u5168 \u274c \u8fd0\u884c\u65f6\u53d1\u73b0\u9519\u8bef \u52a8\u6001\u6761\u4ef6 \u94fe\u5f0f\u65b9\u6cd5\u8c03\u7528 (\u5982 <code>.where(...)</code>) <code>&lt;if&gt;</code>/<code>&lt;choose&gt;</code> \u6807\u7b7e \u5b50\u67e5\u8be2\u652f\u6301 \u901a\u8fc7 DSL \u5d4c\u5957\u6784\u5efa \u539f\u751f SQL \u5199\u6cd5 \u5206\u9875\u63a7\u5236 <code>.limit()</code>/<code>.offset()</code> \u65b9\u6cd5 <code>LIMIT</code> \u76f4\u63a5\u62fc\u63a5 \u7ef4\u62a4\u6210\u672c \u4e2d (\u9700\u5b66\u4e60 DSL \u8bed\u6cd5) \u4f4e (SQL \u539f\u751f\u5199\u6cd5) \u9002\u5408\u573a\u666f \u590d\u6742\u52a8\u6001\u67e5\u8be2\u3001\u9ad8\u590d\u7528\u903b\u8f91 \u7b80\u5355\u67e5\u8be2\u3001\u56e2\u961f\u719f\u6089 XML \u8bed\u6cd5 <p>\u63a8\u8350\u9009\u62e9\uff1a - \u65b0\u9879\u76ee\u63a8\u8350 MyBatis Dynamic SQL\uff1a\u7c7b\u578b\u5b89\u5168 + \u66f4\u597d\u7684\u91cd\u6784\u80fd\u529b - \u9057\u7559\u7cfb\u7edf\u6216\u7b80\u5355\u67e5\u8be2\u53ef\u7528 mapper.xml\uff1a\u964d\u4f4e\u5b66\u4e60\u6210\u672c</p>"},{"location":"springboot/Spring%20Boot%E9%A1%B9%E7%9B%AE%E8%87%AA%E5%B7%B1%E5%B0%81%E8%A3%85%E4%B8%80%E4%B8%AA%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E5%B7%A5%E5%85%B7/#6-service","title":"6. Service\u5c42\uff1a","text":"<pre><code>import com.example.demo.common.model.page.PageRequest;\nimport com.example.demo.common.model.page.PageResult;\nimport com.example.demo.common.model.page.PaginationUtils;\nimport com.example.demo.model.dto.response.RuleWithLatestVersionDTO;\nimport com.example.demo.model.query.RuleQueryCondition;\nimport com.example.demo.repository.custom.RuleCustomMapper;\nimport com.example.demo.repository.custom.builder.RuleQueryBuilder;\nimport com.example.demo.repository.generated.RuleMapper;\nimport com.example.demo.service.RuleService;\n\n\nimport org.mybatis.dynamic.sql.SqlColumn;\nimport org.mybatis.dynamic.sql.select.render.SelectStatementProvider;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\n\nimport java.util.Arrays;\nimport java.util.List;\n\n\n@Service\npublic class RuleServiceImpl implements RuleService {\n\n    private final RuleCustomMapper ruleCustomMapper;\n\n    private final RuleMapper ruleMapper;\n\n    private final RuleQueryBuilder ruleQueryBuilder;\n\n    @Autowired\n    public RuleServiceImpl(RuleMapper ruleMapper, RuleCustomMapper ruleCustomMapper, RuleQueryBuilder ruleQueryBuilder) {\n        this.ruleMapper = ruleMapper;\n        this.ruleCustomMapper = ruleCustomMapper;\n        this.ruleQueryBuilder = ruleQueryBuilder;\n    }\n\n    @Override\n    public PageResult&lt;RuleWithLatestVersionDTO&gt; findByCondition(RuleQueryCondition condition, PageRequest pageRequest) {\n\n        List&lt;String&gt; columNames = Arrays.stream(ruleMapper.selectList).map(c -&gt; ((SqlColumn&lt;?&gt;) c).name()).toList();\n        pageRequest.validateSort(columNames, \"\u6392\u5e8f\u5b57\u6bb5\u4e0d\u5408\u6cd5\");\n        // \u6784\u5efa\u67e5\u8be2\u8bed\u53e5\n        SelectStatementProvider selectStatementProvider = ruleQueryBuilder.buildDataQuery(condition, pageRequest);\n\n        System.out.println(selectStatementProvider.getSelectStatement());\n\n        // \u6784\u5efa\u603b\u6570\u67e5\u8be2\u8bed\u53e5\n        SelectStatementProvider countQuery = ruleQueryBuilder.buildCountQuery(condition);\n        System.out.println(countQuery.getSelectStatement());\n\n        return PaginationUtils.paginate(pageRequest,\n                () -&gt; ruleMapper.count(countQuery),\n                () -&gt; ruleCustomMapper.findByCondition(selectStatementProvider));\n\n    }\n\n}\n</code></pre>"},{"location":"springboot/Spring%20Boot%E9%A1%B9%E7%9B%AE%E8%87%AA%E5%B7%B1%E5%B0%81%E8%A3%85%E4%B8%80%E4%B8%AA%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E5%B7%A5%E5%85%B7/#7-controller","title":"7. Controller\u5c42\uff1a","text":"<pre><code>package com.example.demo.controller;\n\nimport com.example.demo.common.model.page.PageResult;\nimport com.example.demo.common.model.response.Result;\nimport com.example.demo.model.dto.request.RuleQueryPageRequest;\nimport com.example.demo.model.dto.response.RuleWithLatestVersionDTO;\nimport com.example.demo.service.RuleService;\n\n\nimport jakarta.validation.Valid;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.validation.annotation.Validated;\nimport org.springframework.web.bind.annotation.PostMapping;\nimport org.springframework.web.bind.annotation.RequestBody;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\n\n@RestController\n@RequestMapping(\"/api\")\n@Validated\npublic class RuleController {\n\n    private final RuleService ruleService;\n\n    @Autowired\n    public RuleController(RuleService ruleService) {\n        this.ruleService = ruleService;\n    }\n\n\n    @PostMapping(\"/rule\")\n    public Result&lt;PageResult&lt;RuleWithLatestVersionDTO&gt;&gt; queryRule(@Valid @RequestBody RuleQueryPageRequest request) {\n\n        PageResult&lt;RuleWithLatestVersionDTO&gt; pageResult = ruleService.findByCondition(request.getQueryCondition(), request.getPageRequest());\n\n        return Result.success(pageResult);\n    }\n}\n</code></pre>"},{"location":"springboot/Spring%20Boot%E9%A1%B9%E7%9B%AE%E8%87%AA%E5%B7%B1%E5%B0%81%E8%A3%85%E4%B8%80%E4%B8%AA%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E5%B7%A5%E5%85%B7/#_4","title":"\u603b\u7ed3","text":"<p>\u81ea\u5df1\u5c01\u88c5\u5206\u9875\u67e5\u8be2\u867d\u7136\u4ee3\u7801\u91cf\u7a0d\u591a\uff0c\u4f46\u53ef\u63a7\u6027\u5f3a\uff0c\u907f\u514d\u4e86PageHelper\u7684\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898\uff0c\u9002\u5408\u5bf9\u5206\u9875\u6709\u5b9a\u5236\u9700\u6c42\u6216\u9ad8\u5e76\u53d1\u573a\u666f\u3002</p>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/","title":"springboot \u5927\u578b\u590d\u6742\u9879\u76ee\u7684\u5305\u7ed3\u6784\u8bbe\u8ba1\uff08DDD\uff09","text":""},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#spring-boot","title":"Spring Boot \u9879\u76ee\u6309\u5206\u5c42\u67b6\u6784\u5212\u5206\u7684\u4f18\u52bf","text":"<p>\u5728Spring Boot\u9879\u76ee\u4e2d\u6309\u7167\u9886\u57df\u9a71\u52a8\uff08DDD\uff09\u5206\u5c42\u67b6\u6784\u8fdb\u884c\u6a21\u5757\u5212\u5206\u7684\u4f18\u52bf\uff08\u5206\u5c42\u4f18\u52bf\uff09: 1. \u6a21\u5757\u5316\u4e0e\u89e3\u8026\uff1a\u5c06\u7cfb\u7edf\u5206\u4e3a\u4e0d\u540c\u7684\u5c42\u6b21\uff0c\u6bcf\u5c42\u6709\u660e\u786e\u7684\u804c\u8d23\uff0c\u5c42\u4e0e\u5c42\u4e4b\u95f4\u901a\u8fc7\u63a5\u53e3\u901a\u4fe1\uff0c\u964d\u4f4e\u8026\u5408\u3002</p> <ol> <li> <p>\u53ef\u7ef4\u62a4\u6027\uff1a\u5206\u5c42\u540e\uff0c\u6bcf\u5c42\u72ec\u7acb\u53d8\u5316\uff0c\u4fbf\u4e8e\u7ef4\u62a4\u548c\u6269\u5c55\u3002\u4f8b\u5982\uff0c\u57fa\u7840\u8bbe\u65bd\u5c42\u7684\u53d8\u5316\u4e0d\u4f1a\u5f71\u54cd\u5230\u6838\u5fc3\u9886\u57df\u5c42\u3002</p> </li> <li> <p>\u53ef\u6d4b\u8bd5\u6027\uff1a\u5404\u5c42\u53ef\u4ee5\u72ec\u7acb\u6d4b\u8bd5\uff0c\u7279\u522b\u662f\u6838\u5fc3\u9886\u57df\u5c42\u4e0d\u4f9d\u8d56\u5916\u90e8\u5b9e\u73b0\uff0c\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u8fdb\u884c\u5355\u5143\u6d4b\u8bd5\u3002</p> </li> <li> <p>\u4ee3\u7801\u590d\u7528\uff1a\u6838\u5fc3\u9886\u57df\u5c42\uff08domain\uff09\u4e0d\u4f9d\u8d56\u5176\u4ed6\u5c42\uff0c\u53ef\u4ee5\u88ab\u591a\u4e2a\u5e94\u7528\u5c42\uff08application\uff09\u590d\u7528\u3002</p> </li> <li> <p>\u6e05\u6670\u7684\u7ed3\u6784\uff1a\u5f00\u53d1\u4eba\u5458\u53ef\u4ee5\u5feb\u901f\u7406\u89e3\u9879\u76ee\u7ed3\u6784\uff0c\u660e\u786e\u4ee3\u7801\u5e94\u8be5\u653e\u5728\u54ea\u4e00\u5c42\uff0c\u6709\u5229\u4e8e\u56e2\u961f\u534f\u4f5c\u3002</p> </li> <li> <p>\u6280\u672f\u9009\u578b\u7684\u7075\u6d3b\u6027\uff1a\u57fa\u7840\u8bbe\u65bd\u5c42\u53ef\u4ee5\u5c01\u88c5\u4e0d\u540c\u7684\u6280\u672f\u5b9e\u73b0\uff08\u5982\u6570\u636e\u5e93\u3001\u7f13\u5b58\u7b49\uff09\uff0c\u800c\u6838\u5fc3\u4e1a\u52a1\u903b\u8f91\u4e0d\u53d7\u5f71\u54cd\u3002</p> </li> </ol>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#maven","title":"Maven\u6a21\u5757\u5c42\u6b21\u7ed3\u6784","text":"<p>\u5047\u8bbe\u9879\u76ee\u540d\u4e3a<code>example-project</code>\uff0c\u5305\u542b\u4ee5\u4e0b\u6a21\u5757\uff1a</p> <ul> <li> <p>example-project-bootstrap: \u542f\u52a8\u6a21\u5757\uff08\u5305\u542bSpring Boot\u542f\u52a8\u7c7b\uff09</p> </li> <li> <p>example-project-web: web\u5c42\uff08\u53ef\u9009\uff09</p> </li> <li> <p>example-project-facade: facade\u5c42\uff08\u63a5\u53e3\u63cf\u8ff0\uff0c\u53ef\u9009\uff0c\u5355\u72ec\u53d1\u5e03\uff09</p> </li> <li> <p>example-project-application: application\u5c42\uff08\u5e94\u7528\u5c42\uff09</p> </li> <li> <p>example-project-domain: domain\u5c42\uff08\u6838\u5fc3\u9886\u57df\u5c42\uff09</p> </li> <li> <p>example-project-infrastructure: infrastructure\u5c42\uff08\u57fa\u7840\u8bbe\u65bd\u5c42\uff09</p> </li> </ul> <p>\u4f9d\u8d56\u5173\u7cfb\uff1a</p> <ol> <li> <p>bootstrap\u5c42\u4f9d\u8d56web\u5c42\uff08\u5982\u679c\u6709web\u5c42\uff09\u548capplication\u5c42\uff08\u5982\u679c\u6ca1\u6709web\u5c42\uff0c\u5219\u76f4\u63a5\u4f9d\u8d56application\u5c42\uff09\u3002\u5982\u679c\u9879\u76ee\u6709web\u5c42\uff0c\u90a3\u4e48bootstrap\u4f1a\u4f9d\u8d56web\uff0c\u800cweb\u4f9d\u8d56application\u3002</p> </li> <li> <p>web\u5c42\uff08\u5982\u679c\u6709\uff09\u4f9d\u8d56application\u5c42\u3002</p> </li> <li> <p>application\u5c42\u4f9d\u8d56domain\u5c42\u548cinfrastructure\u5c42\uff0c\u5e76\u4e14\u5982\u679c\u5b58\u5728facade\u5c42\uff0c\u5219application\u5c42\u4e5f\u4f1a\u4f9d\u8d56facade\u5c42\uff08\u56e0\u4e3aapplication\u5c42\u8981\u5b9e\u73b0facade\u7684\u63a5\u53e3\uff09\u3002</p> </li> <li> <p>facade\u5c42\u662f\u72ec\u7acb\u7684\uff0c\u4e0d\u4f9d\u8d56\u4efb\u4f55\u5176\u4ed6\u6a21\u5757\uff08\u53ea\u5305\u542b\u63a5\u53e3\u548cDTO\uff09\u3002</p> </li> <li> <p>infrastructure\u5c42\u4f9d\u8d56domain\u5c42\uff08\u56e0\u4e3a\u9700\u8981\u5b9e\u73b0domain\u5c42\u5b9a\u4e49\u7684\u4e00\u4e9b\u63a5\u53e3\uff0c\u6bd4\u5982\u6570\u636e\u5e93\u8bbf\u95ee\u63a5\u53e3\uff09\u3002</p> </li> </ol> <p>\u6ce8\u610f\uff1afacade\u5c42\u662f\u53ef\u9009\u7684\uff0c\u5982\u679c\u5b58\u5728\uff0c\u90a3\u4e48application\u5c42\u4f1a\u4f9d\u8d56facade\u5c42\u3002\u540c\u65f6\uff0cfacade\u5c42\u9700\u8981\u5355\u72ec\u6253\u5305\u53d1\u5e03\uff0c\u4f9b\u5176\u4ed6\u7cfb\u7edf\u4f7f\u7528\u3002</p> <p>\u6ce8\u610f\uff1a\u5728Spring Boot\u9879\u76ee\u4e2d\uff0cbootstrap\u6a21\u5757\u662f\u552f\u4e00\u5305\u542b\u542f\u52a8\u7c7b\u7684\u6a21\u5757\uff0c\u5e76\u4e14\u4f1a\u6253\u5305\u6210\u53ef\u6267\u884c\u7684jar\u3002</p> <p>\u4e0b\u9762\u7528Maven\u6a21\u5757\u7684\u5f62\u5f0f\u8868\u793a\uff1a <pre><code>\u7236\u9879\u76ee\uff08parent\uff09: example-project\n\n| -- facade (example-project-facade) [\u53ef\u9009]\n\n| -- domain (example-project-domain)\n\n| -- infrastructure (example-project-infrastructure)\n\n| -- application (example-project-application) [\u4f9d\u8d56 domain \u548c facade\uff08\u5982\u679c\u5b58\u5728\uff09]\n\n| -- web (example-project-web) [\u53ef\u9009\uff0c\u4f9d\u8d56 application]\n\n| -- bootstrap (example-project-bootstrap) [\u4f9d\u8d56 web \u5c42\u548c application \u5c42\uff08\u5982\u679c\u6ca1\u6709web\u5c42\uff0c\u90a3\u4e48bootstrap\u76f4\u63a5\u4f9d\u8d56application\u5c42\u3002\uff09]\n</code></pre></p> <p>\u5177\u4f53\u7ed3\u6784\u793a\u4f8b\uff1a <pre><code>example-project (\u7236POM)  \n\u2502  \n\u251c\u2500\u2500 example-project-domain (\u6838\u5fc3\u9886\u57df\u5c42)  \n\u2502     \u251c\u2500\u2500 \u5b9a\u4e49\u9886\u57df\u6a21\u578b\uff08Domain\uff09  \n\u2502     \u251c\u2500\u2500 \u6838\u5fc3\u4e1a\u52a1\u670d\u52a1\u63a5\u53e3\uff08application Interfaces\uff09  \n\u2502     \u2514\u2500\u2500 \u4e0d\u4f9d\u8d56\u5176\u4ed6\u6a21\u5757  \n\u2502  \n\u251c\u2500\u2500 example-project-infrastructure (\u57fa\u7840\u8bbe\u65bd\u5c42)  \n\u2502     \u251c\u2500\u2500 \u6570\u636e\u5e93\u8bbf\u95ee\u5b9e\u73b0\uff08Repository Impl\uff09  \n\u2502     \u251c\u2500\u2500 RPC/\u6d88\u606f\u961f\u5217\u5ba2\u6237\u7aef  \n\u2502     \u2514\u2500\u2500 \u4f9d\u8d56 domain \u5c42\uff08\u5b9e\u73b0\u5176\u63a5\u53e3\uff09  \n\u2502  \n\u251c\u2500\u2500 example-project-application (\u5e94\u7528\u5c42)  \n\u2502     \u251c\u2500\u2500 \u5e94\u7528\u670d\u52a1\u5b9e\u73b0\uff08\u534f\u8c03\u9886\u57df\u903b\u8f91\uff09  \n\u2502     \u2514\u2500\u2500 \u4f9d\u8d56 domain \u5c42 + infrastructure\u5c42 + facade \u5c42\uff08\u82e5\u5b58\u5728\uff09  \n\u2502  \n\u251c\u2500\u2500 example-project-facade (\u5916\u89c2\u5c42 - \u53ef\u9009)  \n\u2502     \u251c\u2500\u2500 \u5bf9\u5916\u63a5\u53e3\uff08API\uff09  \n\u2502     \u251c\u2500\u2500 DTO \u5b9a\u4e49  \n\u2502     \u2514\u2500\u2500 \u65e0\u4f9d\u8d56\uff0c\u72ec\u7acb\u6253\u5305  \n\u2502  \n\u251c\u2500\u2500 example-project-web (Web \u5c42 - \u53ef\u9009)  \n\u2502     \u251c\u2500\u2500 Controller  \n\u2502     \u2514\u2500\u2500 \u4f9d\u8d56 application \u5c42  \n\u2502  \n\u2514\u2500\u2500 example-project-bootstrap (\u542f\u52a8\u5c42)  \n      \u251c\u2500\u2500 Spring Boot \u542f\u52a8\u7c7b  \n      \u251c\u2500\u2500 \u5168\u5c40\u914d\u7f6e  \n      \u2514\u2500\u2500 \u4f9d\u8d56 application \u5c42 + \u4f9d\u8d56 web \u5c42\uff08\u82e5\u5b58\u5728\uff09\n</code></pre></p>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#_1","title":"\u5206\u5c42\u67b6\u6784\u4f9d\u8d56\u5173\u7cfb\u56fe","text":"<p>\u4ee5\u4e0b\u662f\u57fa\u4e8e Spring Boot \u7684\u5206\u5c42\u67b6\u6784\u4f9d\u8d56\u5173\u7cfb\u56fe\uff0c\u6e05\u6670\u5c55\u793a\u4e86\u5404\u5c42\u4e4b\u95f4\u7684\u7f16\u8bd1\u65f6\u4f9d\u8d56\uff08\u5355\u5411\u7bad\u5934\uff09\u548c\u8fd0\u884c\u65f6\u8c03\u7528\u5173\u7cfb\uff08\u865a\u7ebf\u7bad\u5934\uff09\uff1a  </p> <pre><code>graph TD\n    %% \u5b9a\u4e49\u8282\u70b9\n    A[bootstrap\u5c42\\n\u542f\u52a8\u6a21\u5757] \n    B[web\u5c42\\n\u5c55\u73b0\u5c42] \n    C[facade\u5c42\\n\u5916\u89c2\u5c42] \n    D[application\u5c42\\n\u5e94\u7528\u5c42] \n    E[domain\u5c42\\n\u6838\u5fc3\u9886\u57df\u5c42] \n    F[infrastructure\u5c42\\n\u57fa\u7840\u8bbe\u65bd\u5c42]\n\n    %% \u7f16\u8bd1\u65f6\u4f9d\u8d56\u5173\u7cfb\uff08\u5b9e\u7ebf\u7bad\u5934\uff09\n    A --&gt;|\u4f9d\u8d56| B\n    A --&gt;|\u4f9d\u8d56| D\n    B --&gt;|\u4f9d\u8d56| D\n    D --&gt;|\u4f9d\u8d56| C\n    D --&gt;|\u4f9d\u8d56| E\n    D --&gt;|\u4f9d\u8d56| F\n    F --&gt;|\u4f9d\u8d56| E\n\n    %% \u8fd0\u884c\u65f6\u8c03\u7528\u5173\u7cfb\uff08\u865a\u7ebf\u7bad\u5934\uff09\n    B -.-&gt;|\u8c03\u7528| D\n    D -.-&gt;|\u8c03\u7528| E\n    E -.-&gt;|\u63a5\u53e3\u6ce8\u5165| F\n\n\n    style C fill:#f4f7d4,stroke:#333,stroke-width:2px\n    style E fill:#d4f7d4,stroke:#333,stroke-width:2px\n</code></pre>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#_2","title":"\u5173\u952e\u4f9d\u8d56\u8bf4\u660e","text":"<ol> <li>\u7f16\u8bd1\u65f6\u4f9d\u8d56\uff08\u5b9e\u7ebf\u7bad\u5934\uff09 </li> <li><code>bootstrap \u2192 web</code>\uff1a\u542f\u52a8\u5c42\u4f9d\u8d56 Web \u5c42\u63d0\u4f9b HTTP \u670d\u52a1\u80fd\u529b  </li> <li><code>web \u2192 application</code>\uff1aWeb \u5c42\u8c03\u7528\u5e94\u7528\u5c42\u5b9e\u73b0\u4e1a\u52a1\u903b\u8f91  </li> <li><code>application \u2192 facade</code>\uff1a\u5e94\u7528\u5c42\u5b9e\u73b0\u5916\u89c2\u5c42\u7684\u63a5\u53e3  </li> <li><code>application \u2192 domain</code>\uff1a\u5e94\u7528\u5c42\u8c03\u7528\u6838\u5fc3\u9886\u57df\u670d\u52a1</li> <li><code>application \u2192 infrastructure</code>\uff1a\u5e94\u7528\u5c42\u8c03\u7528\u57fa\u7840\u8bbe\u65bd\u670d\u52a1</li> <li> <p><code>infrastructure \u2192 domain</code>\uff1a\u57fa\u7840\u8bbe\u65bd\u5c42\u5b9e\u73b0\u6838\u5fc3\u5c42\u5b9a\u4e49\u7684\u63a5\u53e3  </p> </li> <li> <p>\u8fd0\u884c\u65f6\u8c03\u7528\uff08\u865a\u7ebf\u7bad\u5934\uff09 </p> </li> <li><code>web \u2192 application</code>\uff1aController \u8c03\u7528 application \u5e94\u7528\u903b\u8f91  </li> <li><code>application \u2192 domain</code>\uff1a\u5e94\u7528\u670d\u52a1\u8c03\u7528\u9886\u57df\u670d\u52a1  </li> <li> <p><code>domain \u2192 infrastructure</code>\uff1a\u9886\u57df\u670d\u52a1\u901a\u8fc7\u4f9d\u8d56\u6ce8\u5165\u8c03\u7528\u57fa\u7840\u8bbe\u65bd\u5b9e\u73b0  </p> </li> <li> <p>\u6838\u5fc3\u7279\u6027 </p> </li> <li>domain \u5c42\u7edd\u5bf9\u7a33\u5b9a\uff08\u7eff\u8272\u9ad8\u4eae\uff09\uff1a  <ul> <li>\u4e0d\u4f9d\u8d56\u4efb\u4f55\u5176\u4ed6\u5c42\uff08\u5305\u62ec Spring \u6846\u67b6\uff09  </li> <li>\u901a\u8fc7\u63a5\u53e3\u4e0e infrastructure \u5c42\u89e3\u8026\uff08\u4f9d\u8d56\u5012\u7f6e\u539f\u5219\uff09  </li> </ul> </li> <li>facade \u5c42\u72ec\u7acb\u5b58\u5728\uff08\u9ec4\u8272\u9ad8\u4eae\uff09\uff1a  <ul> <li>\u4ec5\u5305\u542b\u63a5\u53e3\u548c DTO\uff0c\u53ef\u72ec\u7acb\u6253\u5305\u53d1\u5e03  </li> <li>\u88ab application \u5c42\u5b9e\u73b0\u4f46\u4e0d\u88ab\u5176\u53cd\u5411\u4f9d\u8d56  </li> </ul> </li> <li>\u57fa\u7840\u8bbe\u65bd\u53ef\u66ff\u6362\uff1a  <ul> <li>\u6570\u636e\u5e93/RPC \u7b49\u5b9e\u73b0\u53ef\u5728 infrastructure \u5c42\u7075\u6d3b\u66f4\u6362  </li> <li>\u4e0d\u5f71\u54cd domain \u5c42\u4e1a\u52a1\u903b\u8f91\uff08\u5982\u5207\u6362 MyBatis \u4e3a JPA\uff09  </li> </ul> </li> </ol>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#1","title":"1. \u5355\u5411\u4f9d\u8d56","text":"<pre><code>bootstrap \u2192 web (\u6216 application) \u2192 application \u2192 domain  \ninfrastructure \u2192 domain  \n</code></pre> <p>\u4f9d\u8d56\u6ce8\u5165\u8bf4\u660e\uff1a</p> <p>\u5728domain\u5c42\u4e2d\u5b9a\u4e49\u63a5\u53e3\uff08\u5982Repository\u63a5\u53e3\uff09\uff0c\u5728infrastructure\u5c42\u4e2d\u5b9e\u73b0\u3002\u5728application\u5c42\u4e2d\uff0c\u901a\u8fc7\u4f9d\u8d56\u6ce8\u5165\uff08\u4f7f\u7528Spring\uff09\u5c06infrastructure\u5c42\u7684\u5b9e\u73b0\u6ce8\u5165\u5230domain\u5c42\u7684\u670d\u52a1\u4e2d\u3002\u4f46\u662f\u6ce8\u610f\uff0cdomain\u5c42\u672c\u8eab\u4e0d\u4f9d\u8d56infrastructure\uff0c\u6240\u4ee5domain\u5c42\u7684\u4ee3\u7801\u4e2d\u4e0d\u4f1a\u51fa\u73b0infrastructure\u7684\u5177\u4f53\u7c7b\u3002\u8fd9\u79cd\u4f9d\u8d56\u662f\u901a\u8fc7Spring\u7684IoC\u5bb9\u5668\u5728\u8fd0\u884c\u65f6\u5c06infrastructure\u7684bean\u6ce8\u5165\u5230domain\u5c42\u9700\u8981\u7684\u5730\u65b9\uff08\u6bd4\u5982domain\u5c42\u7684\u9886\u57df\u670d\u52a1\u4e2d\u9700\u8981Repository\u63a5\u53e3\uff0c\u800c\u5b9e\u9645\u6ce8\u5165\u7684\u662finfrastructure\u4e2d\u5b9e\u73b0\u7684RepositoryImpl\uff09\u3002</p> <p>\u5982\u4f55\u5b9e\u73b0\u4f9d\u8d56\u6ce8\u5165\uff1f</p> <p>\u5728bootstrap\u6a21\u5757\uff08\u542f\u52a8\u6a21\u5757\uff09\u4e2d\uff0c\u7531\u4e8e\u5b83\u4f9d\u8d56\u4e86\u6240\u6709\u6a21\u5757\uff0c\u6240\u4ee5\u53ef\u4ee5\u901a\u8fc7<code>@ComponentScan</code>\u626b\u63cf\u5230\u6240\u6709\u6a21\u5757\u7684Spring\u7ec4\u4ef6\uff0c\u7136\u540e\u8fdb\u884c\u81ea\u52a8\u88c5\u914d\u3002</p>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#2","title":"2. \u63a5\u53e3\u89e3\u8026\u793a\u4f8b","text":"<p>\u5728domain\u6a21\u5757\u4e2d\u5b9a\u4e49\u63a5\u53e3\uff1a <pre><code>package com.example.domain.repository;\n\npublic interface UserRepository {\n\n    User findById(Long id);\n\n}\n</code></pre></p> <p>\u5728infrastructure\u6a21\u5757\u4e2d\u5b9e\u73b0\uff1a <pre><code>package com.example.infrastructure.repository;\n\n@Repository\npublic class UserRepositoryImpl implements UserRepository {\n\n// \u5177\u4f53\u5b9e\u73b0\uff0c\u6bd4\u5982\u4f7f\u7528JPA\u6216\u8005MyBatis\n\n}\n</code></pre></p> <p>\u5728domain\u5c42\u7684\u9886\u57df\u670d\u52a1\u4e2d\u4f7f\u7528\uff1a <pre><code>package com.example.domain.application;\n\n@application\npublic class UserApplication {\n\n    @Autowired  // \u8fd9\u91cc\u6ce8\u5165\u7684\u662fUserRepository\u63a5\u53e3\uff0c\u5b9e\u9645\u8fd0\u884c\u65f6\u7531Spring\u5bb9\u5668\u6ce8\u5165UserRepositoryImpl\n    private UserRepository userRepository;\n\n    public User getUser(Long id) {\n\n        return userRepository.findById(id);\n\n    }\n\n}\n</code></pre></p> <p>\u5728application\u5c42\uff08\u5e94\u7528\u5c42\uff09\u4e2d\uff0c\u53ef\u4ee5\u8c03\u7528domain\u5c42\u7684\u9886\u57df\u670d\u52a1\uff08\u5982UserApplication\uff09\u6765\u534f\u8c03\u4efb\u52a1\u3002</p> <p>\u6ce8\u610f\uff1a\u7531\u4e8edomain\u5c42\u4e0d\u4f9d\u8d56infrastructure\u5c42\uff0c\u6240\u4ee5domain\u5c42\u7f16\u8bd1\u65f6\u5e76\u4e0d\u9700\u8981infrastructure\u5c42\u7684\u5b58\u5728\u3002\u4f46\u662f\u8fd0\u884c\u65f6\uff0cSpring\u5bb9\u5668\u4f1a\u9700\u8981\u5c06infrastructure\u5c42\u7684\u5b9e\u73b0\u7c7b\u6ce8\u5165\u5230domain\u5c42\u7684\u63a5\u53e3\u4e2d\u3002\u56e0\u6b64\uff0c\u5728bootstrap\u6a21\u5757\u4e2d\uff0c\u9700\u8981\u5c06domain\u5c42\u548cinfrastructure\u5c42\u90fd\u7eb3\u5165Spring\u7684\u7ec4\u4ef6\u626b\u63cf\u8303\u56f4\u3002</p>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#_3","title":"\u5178\u578b\u8c03\u7528\u6d41\u7a0b\u793a\u4f8b","text":"<pre><code>\u7528\u6237\u8bf7\u6c42 \u2192 bootstrap(\u542f\u52a8)  \n          \u2192 web(Controller)  \n          \u2192 application(\u5e94\u7528\u670d\u52a1)  \n          \u2192 domain(\u9886\u57df\u670d\u52a1)  \n          \u2192 infrastructure(\u6570\u636e\u5e93\u8bbf\u95ee)  \n</code></pre>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#_4","title":"\u67b6\u6784\u4f18\u52bf\u9a8c\u8bc1","text":"<ol> <li>\u4fee\u6539\u6570\u636e\u5e93\u5b9e\u73b0\uff1a  </li> <li>\u53ea\u9700\u91cd\u5199 <code>infrastructure</code> \u7684 <code>UserRepositoryImpl</code> </li> <li> <p><code>domain</code> \u5c42\u7684 <code>UserRepository</code> \u65e0\u9700\u4efb\u4f55\u4fee\u6539  </p> </li> <li> <p>\u65b0\u589e RPC \u670d\u52a1\uff1a  </p> </li> <li>\u5728 <code>infrastructure</code> \u6dfb\u52a0\u65b0\u6a21\u5757 <code>rpc-adapter</code> </li> <li>\u5b9e\u73b0 <code>domain</code> \u5b9a\u4e49\u7684 <code>Paymentapplication</code> \u63a5\u53e3  </li> <li> <p><code>domain</code> \u5c42\u901a\u8fc7\u4f9d\u8d56\u6ce8\u5165\u76f4\u63a5\u8c03\u7528</p> </li> <li> <p>\u79fb\u9664 Web \u5c42\uff1a  </p> </li> <li>\u5220\u9664 <code>web</code> \u6a21\u5757\u548c <code>bootstrap</code> \u4e2d\u7684\u76f8\u5173\u4f9d\u8d56  </li> <li>\u7cfb\u7edf\u81ea\u52a8\u9000\u5316\u4e3a\u7eaf\u670d\u52a1\u5316\u5e94\u7528\uff08\u901a\u8fc7 facade \u66b4\u9732\u670d\u52a1\uff09  </li> </ol>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#_5","title":"\u901a\u7528\u8bf7\u6c42\u54cd\u5e94\u53ca\u5206\u9875\u7c7b\u7684\u6a21\u5757\u5f52\u5c5e\u5efa\u8bae","text":"<p>\u6839\u636e\u5206\u5c42\u67b6\u6784\u7684\u8bbe\u8ba1\u539f\u5219\u548c\u6a21\u5757\u804c\u8d23\u5212\u5206\uff0c\u6211\u4eec\u9700\u8981\u8003\u8651\u901a\u7528\u8bf7\u6c42\u54cd\u5e94\u7c7b\uff08\u5305\u62ec\u5206\u9875\u8bf7\u6c42\u548c\u54cd\u5e94\uff09\u7684\u7528\u9014\u548c\u4f9d\u8d56\u5173\u7cfb\uff1a</p> <ol> <li> <p>\u8bf7\u6c42\u54cd\u5e94\u7c7b\u7684\u4f5c\u7528\uff1a</p> </li> <li> <p>\u901a\u5e38\u7528\u4e8eWeb\u5c42\uff08Controller\uff09\u4e0e\u524d\u7aef\u4ea4\u4e92\u7684\u6570\u636e\u4f20\u8f93\u5bf9\u8c61\uff08DTO\uff09\u3002</p> </li> <li> <p>\u5206\u9875\u8bf7\u6c42\uff08\u5982PageRequest\uff09\u5305\u542b\u9875\u7801\u3001\u6bcf\u9875\u6570\u91cf\u7b49\u5206\u9875\u4fe1\u606f\u3002</p> </li> <li> <p>\u5206\u9875\u54cd\u5e94\uff08\u5982PageResponse\uff09\u5305\u542b\u5206\u9875\u6570\u636e\u3001\u603b\u8bb0\u5f55\u6570\u3001\u603b\u9875\u6570\u7b49\u4fe1\u606f\u3002</p> </li> <li> <p>\u5404\u5c42\u804c\u8d23\uff1a</p> </li> <li> <p><code>web\u5c42</code>\uff1a\u8d1f\u8d23\u63a5\u6536HTTP\u8bf7\u6c42\uff0c\u5c06\u8bf7\u6c42\u53c2\u6570\u8f6c\u6362\u4e3aJava\u5bf9\u8c61\uff0c\u5e76\u5c06\u5904\u7406\u7ed3\u679c\u4ee5HTTP\u54cd\u5e94\u8fd4\u56de\u3002\u56e0\u6b64\uff0c\u5b83\u9700\u8981\u5b9a\u4e49Controller\u65b9\u6cd5\u7684\u53c2\u6570\u548c\u8fd4\u56de\u503c\u7684\u7c7b\u578b\uff0c\u8fd9\u4e9b\u7c7b\u578b\u901a\u5e38\u5c31\u662f\u8bf7\u6c42\u548c\u54cd\u5e94DTO\u3002</p> </li> <li> <p><code>facade\u5c42</code>\uff1a\u5982\u679c\u5b58\u5728\u5bf9\u5916\u63d0\u4f9b\u7684\u670d\u52a1\u63a5\u53e3\uff08\u5982RPC\u670d\u52a1\uff09\uff0c\u90a3\u4e48facade\u5c42\u4f1a\u5b9a\u4e49\u670d\u52a1\u63a5\u53e3\u7684\u5165\u53c2\u548c\u8fd4\u56de\u7c7b\u578b\uff08\u5305\u62ec\u5206\u9875\u8bf7\u6c42\u548c\u54cd\u5e94\uff09\u3002\u8fd9\u6837\uff0c\u65e0\u8bba\u662fWeb\u5c42\u8c03\u7528\u8fd8\u662fRPC\u8c03\u7528\uff0c\u90fd\u53ef\u4ee5\u4f7f\u7528\u76f8\u540c\u7684\u5206\u9875\u8bf7\u6c42/\u54cd\u5e94\u7ed3\u6784\u3002</p> </li> <li> <p>\u590d\u7528\u6027\u8003\u8651\uff1a</p> </li> <li> <p>\u5982\u679c\u9879\u76ee\u540c\u65f6\u63d0\u4f9bWeb\u63a5\u53e3\u548cRPC\u63a5\u53e3\uff08\u901a\u8fc7facade\u5c42\u66b4\u9732\uff09\uff0c\u90a3\u4e48\u5206\u9875\u8bf7\u6c42/\u54cd\u5e94\u7c7b\u5e94\u8be5\u653e\u5728\u4e00\u4e2a\u516c\u5171\u7684\u5730\u65b9\uff0c\u4ee5\u4fbfweb\u5c42\u548cfacade\u5c42\u90fd\u80fd\u4f7f\u7528\u3002</p> </li> <li> <p>\u4f46\u662f\uff0cfacade\u5c42\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u6a21\u5757\uff0c\u5b83\u4e0d\u5e94\u8be5\u4f9d\u8d56\u5176\u4ed6\u6a21\u5757\uff08\u9664\u4e86\u6700\u57fa\u7840\u7684\u516c\u5171\u6a21\u5757\uff0c\u5982common\u6a21\u5757\uff09\uff0c\u56e0\u4e3afacade\u9700\u8981\u88ab\u5176\u4ed6\u7cfb\u7edf\u4f9d\u8d56\uff0c\u5e94\u8be5\u5c3d\u91cf\u8f7b\u91cf\u3002</p> </li> <li> <p>\u89e3\u51b3\u65b9\u6848\uff1a</p> </li> <li> <p>\u65b9\u6848\u4e00\uff1a\u5c06\u901a\u7528\u7684\u8bf7\u6c42\u54cd\u5e94\u7c7b\uff08\u5305\u62ec\u5206\u9875\u8bf7\u6c42/\u54cd\u5e94\uff09\u653e\u5728\u4e00\u4e2a\u72ec\u7acb\u7684<code>common</code>\u6a21\u5757\u4e2d\uff0c\u8fd9\u4e2a\u6a21\u5757\u53ea\u5305\u542b\u4e00\u4e9b\u901a\u7528\u7684DTO\u3001\u5de5\u5177\u7c7b\u7b49\u3002\u8fd9\u6837web\u5c42\u548cfacade\u5c42\u90fd\u53ef\u4ee5\u4f9d\u8d56\u8fd9\u4e2acommon\u6a21\u5757\u3002</p> </li> <li> <p>\u65b9\u6848\u4e8c\uff1a\u5982\u679c\u9879\u76ee\u4e2d\u6ca1\u6709\u72ec\u7acbcommon\u6a21\u5757\uff0c\u4e14facade\u5c42\u662f\u72ec\u7acb\u7684\uff0c\u90a3\u4e48\u53ef\u4ee5\u5c06\u8fd9\u4e9b\u901a\u7528DTO\u653e\u5728facade\u6a21\u5757\u4e2d\u3002\u56e0\u4e3aweb\u5c42\u4f1a\u4f9d\u8d56facade\u5c42\uff08\u5728\u5b58\u5728facade\u5c42\u7684\u60c5\u51b5\u4e0b\uff0capplication\u5c42\u4f9d\u8d56facade\uff0c\u800cweb\u5c42\u4f9d\u8d56application\uff0c\u6240\u4ee5web\u5c42\u95f4\u63a5\u4f9d\u8d56facade\uff09\uff0c\u6240\u4ee5web\u5c42\u53ef\u4ee5\u4f7f\u7528facade\u4e2d\u7684DTO\u3002\u4f46\u662f\uff0c\u8fd9\u6837\u4f1a\u5bfc\u81f4facade\u5c42\u5305\u542b\u4e86\u4e0eWeb\u76f8\u5173\u7684DTO\uff0c\u800cfacade\u5c42\u53ef\u80fd\u88ab\u5176\u4ed6RPC\u8c03\u7528\u65b9\u5f15\u7528\uff0c\u8fd9\u4e9bDTO\u5bf9\u4e8eRPC\u8c03\u7528\u65b9\u4e5f\u662f\u9002\u7528\u7684\uff08\u56e0\u4e3a\u5206\u9875\u8bf7\u6c42/\u54cd\u5e94\u662f\u901a\u7528\u7684\uff0c\u4e0d\u9650\u4e8eWeb\uff09\u3002</p> </li> <li> <p>\u63a8\u8350\u505a\u6cd5\uff1a</p> </li> <li> <p>\u5728\u9879\u76ee\u4e2d\u521b\u5efa\u4e00\u4e2a<code>common</code>\u6a21\u5757\uff08\u6216\u79f0\u4e3a<code>api-common</code>\uff09\uff0c\u4e13\u95e8\u5b58\u653e\u8de8\u5c42\u5171\u4eab\u7684DTO\uff0c\u5305\u62ec\u901a\u7528\u7684\u8bf7\u6c42\u54cd\u5e94\u3001\u5206\u9875\u8bf7\u6c42\u54cd\u5e94\u3001\u9519\u8bef\u7801\u679a\u4e3e\u7b49\u3002\u8fd9\u4e2a\u6a21\u5757\u5e94\u8be5\u975e\u5e38\u8f7b\u91cf\uff0c\u4e0d\u4f9d\u8d56\u4efb\u4f55\u5176\u4ed6\u4e1a\u52a1\u6a21\u5757\uff08\u53ef\u4ee5\u4f9d\u8d56\u4e00\u4e9b\u901a\u7528\u7684\u5de5\u5177\u5305\u5982lombok\uff09\u3002</p> </li> <li> <p>\u7136\u540e\uff0c\u8ba9<code>web</code>\u3001<code>facade</code>\u3001<code>application</code>\uff08\u5982\u679c\u9700\u8981\uff09\u7b49\u6a21\u5757\u90fd\u4f9d\u8d56\u8fd9\u4e2a<code>common-dto</code>\u6a21\u5757\u3002</p> </li> </ol> <p>\u4f46\u662f\uff0c\u6839\u636e\u524d\u9762\u63cf\u8ff0\u7684\u5206\u5c42\u7ed3\u6784\uff0c\u6211\u4eec\u5e76\u6ca1\u6709\u63d0\u5230\u4e00\u4e2a\u72ec\u7acb\u7684common\u6a21\u5757\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u9700\u8981\u8c03\u6574\u6a21\u5757\u7ed3\u6784\uff0c\u589e\u52a0\u4e00\u4e2acommon\u6a21\u5757\u3002</p> <ol> <li> <p>\u8c03\u6574\u540e\u7684\u6a21\u5757\u7ed3\u6784\uff1a</p> </li> <li> <p>\u589e\u52a0\u4e00\u4e2a<code>example-project-common</code>\u6a21\u5757\uff0c\u7528\u4e8e\u5b58\u653e\u901a\u7528\u7684DTO\u3001\u5e38\u91cf\u3001\u5de5\u5177\u7c7b\u7b49\u3002</p> </li> <li> <p>\u5206\u9875\u8bf7\u6c42\u7c7b\uff08PageRequest\uff09\u548c\u5206\u9875\u54cd\u5e94\u7c7b\uff08PageResponse\uff09\u5c31\u653e\u5728\u8fd9\u4e2acommon\u6a21\u5757\u4e2d\u3002</p> </li> <li> <p>\u4f9d\u8d56\u5173\u7cfb\uff1a</p> </li> <li> <p><code>common</code>\u6a21\u5757\u4e0d\u4f9d\u8d56\u4efb\u4f55\u5176\u4ed6\u6a21\u5757\u3002</p> </li> <li> <p><code>facade</code>\u6a21\u5757\u4f9d\u8d56<code>common</code>\u6a21\u5757\uff08\u56e0\u4e3afacade\u4e2d\u7684\u63a5\u53e3\u53c2\u6570\u548c\u8fd4\u56de\u503c\u53ef\u80fd\u4f1a\u7528\u5230\u8fd9\u4e9b\u901a\u7528DTO\uff09\u3002</p> </li> <li> <p><code>web</code>\u6a21\u5757\u4f9d\u8d56<code>common</code>\u6a21\u5757\uff08\u56e0\u4e3aController\u4f1a\u4f7f\u7528\u8fd9\u4e9b\u901a\u7528DTO\uff09\u3002</p> </li> <li> <p><code>application</code>\u6a21\u5757\u5982\u679c\u4e5f\u9700\u8981\u4f7f\u7528\u8fd9\u4e9bDTO\uff08\u6bd4\u5982\u5728\u5e94\u7528\u670d\u52a1\u5185\u90e8\u4f20\u9012\u5206\u9875\u4fe1\u606f\uff09\uff0c\u90a3\u4e48\u4e5f\u53ef\u4ee5\u4f9d\u8d56<code>common</code>\u6a21\u5757\uff0c\u4f46\u901a\u5e38application\u5c42\u4f7f\u7528\u7684\u662f\u9886\u57df\u5bf9\u8c61\uff0c\u6240\u4ee5\u4e00\u822c\u4e0d\u9700\u8981\u3002application\u5c42\u5e94\u8be5\u5c3d\u91cf\u4f7f\u7528\u9886\u57df\u5bf9\u8c61\uff0c\u53ea\u6709\u5728\u9700\u8981\u4e0eweb\u5c42\u6216facade\u5c42\u4ea4\u4e92\u65f6\u624d\u8fdb\u884cDTO\u8f6c\u6362\u3002</p> </li> <li> <p>\u5206\u9875\u8bf7\u6c42/\u54cd\u5e94\u7c7b\u7684\u8bbe\u8ba1\uff1a</p> </li> <li> <p><code>PageRequest</code>\uff1a\u5305\u542bpageNo\uff08\u5f53\u524d\u9875\u7801\uff09\u3001pageSize\uff08\u6bcf\u9875\u5927\u5c0f\uff09\u3001sortBy\uff08\u6392\u5e8f\u5b57\u6bb5\uff09\u3001sortDirection\uff08\u6392\u5e8f\u65b9\u5411\uff09\u7b49\u3002</p> </li> <li> <p><code>PageResponse</code>\uff1a\u5305\u542bdata\uff08\u5f53\u524d\u9875\u6570\u636e\u5217\u8868\uff09\u3001total\uff08\u603b\u8bb0\u5f55\u6570\uff09\u3001pageNo\u3001pageSize\u3001totalPages\uff08\u603b\u9875\u6570\uff09\u7b49\u3002</p> </li> <li> <p>\u5177\u4f53\u653e\u7f6e\u4f4d\u7f6e\uff1a</p> </li> <li> <p>\u5728<code>example-project-common</code>\u6a21\u5757\u4e2d\u521b\u5efa\u5305\uff0c\u5982<code>com.example.common.dto</code>\uff0c\u7136\u540e\u5728\u8be5\u5305\u4e0b\u5b9a\u4e49<code>PageRequest</code>\u548c<code>PageResponse</code>\u3002</p> </li> <li> <p>\u4e3a\u4ec0\u4e48\u4e0d\u653e\u5728domain\u5c42\uff1f</p> </li> <li> <p>domain\u5c42\u662f\u6838\u5fc3\u9886\u57df\u5c42\uff0c\u5e94\u8be5\u4e13\u6ce8\u4e8e\u9886\u57df\u6a21\u578b\u548c\u4e1a\u52a1\u903b\u8f91\uff0c\u4e0d\u5e94\u8be5\u5305\u542b\u4e0e\u4f20\u8f93\u76f8\u5173\u7684DTO\u3002DTO\u662f\u7528\u4e8e\u4e0e\u5916\u90e8\u4ea4\u4e92\u7684\uff0c\u5c5e\u4e8e\u5e94\u7528\u5c42\u6216\u8868\u73b0\u5c42\u7684\u4e1c\u897f\u3002</p> </li> <li> <p>\u4e3a\u4ec0\u4e48\u4e0d\u653e\u5728web\u5c42\uff1f</p> </li> <li> <p>\u5982\u679c\u653e\u5728web\u5c42\uff0c\u90a3\u4e48facade\u5c42\u5c31\u65e0\u6cd5\u4f7f\u7528\uff08\u56e0\u4e3afacade\u5c42\u4e0d\u4f9d\u8d56web\u5c42\uff09\u3002\u800cfacade\u5c42\u66b4\u9732\u7684\u63a5\u53e3\u4e5f\u9700\u8981\u4f7f\u7528\u76f8\u540c\u7684\u5206\u9875\u7ed3\u6784\u3002</p> </li> <li> <p>\u4e3a\u4ec0\u4e48\u4e0d\u653e\u5728facade\u5c42\uff1f</p> </li> <li> <p>\u5982\u679c\u9879\u76ee\u6ca1\u6709facade\u5c42\uff08\u6bd4\u5982\u4e0d\u5bf9\u5916\u63d0\u4f9bRPC\u670d\u52a1\uff09\uff0c\u90a3\u4e48\u653e\u5728web\u5c42\u4e5f\u53ef\u4ee5\u3002\u4f46\u662f\u5982\u679c\u6709facade\u5c42\uff0c\u90a3\u4e48web\u5c42\u4f1a\u95f4\u63a5\u4f9d\u8d56facade\u5c42\uff0c\u6240\u4ee5\u653e\u5728facade\u5c42\u4e5f\u53ef\u4ee5\u88abweb\u5c42\u4f7f\u7528\u3002\u4f46\u662f\uff0c\u8fd9\u6837\u4f1a\u5bfc\u81f4facade\u5c42\u5305\u542b\u4e86\u901a\u7528\u7684DTO\uff0c\u800cfacade\u5c42\u7684\u4e3b\u8981\u804c\u8d23\u662f\u5b9a\u4e49\u5bf9\u5916\u63a5\u53e3\uff0c\u8fd9\u4e9b\u901a\u7528DTO\u662f\u591a\u4e2a\u5c42\u5171\u4eab\u7684\uff0c\u653e\u5728facade\u5c42\u53ef\u80fd\u8ba9facade\u5c42\u53d8\u5f97\u81c3\u80bf\uff0c\u800c\u4e14\u5176\u4ed6\u6a21\u5757\uff08\u5982\u57fa\u7840\u8bbe\u65bd\u5c42\uff09\u5982\u679c\u9700\u8981\u4f7f\u7528\u8fd9\u4e9bDTO\uff08\u901a\u5e38\u4e0d\u4f1a\uff09\u4e5f\u4f1a\u4f9d\u8d56facade\u5c42\uff0c\u8fd9\u662f\u4e0d\u5408\u7406\u7684\u3002</p> </li> </ol> <p>\u56e0\u6b64\uff0c\u6700\u4f73\u5b9e\u8df5\u662f\u521b\u5efa\u4e00\u4e2a\u72ec\u7acb\u7684common\u6a21\u5757\u6765\u5b58\u653e\u8fd9\u4e9b\u901a\u7528\u7c7b\u3002</p> <p>\u8c03\u6574\u540e\u7684Maven\u6a21\u5757\u7ed3\u6784\uff1a</p> <pre><code>example-project (\u7236POM)\n\n\u2502\n\n\u251c\u2500\u2500 example-project-common (\u901a\u7528\u6a21\u5757)\n\n\u2502     \u251c\u2500\u2500 \u901a\u7528DTO\uff08PageRequest, PageResponse, BaseResponse\u7b49\uff09\n\n\u2502     \u251c\u2500\u2500 \u5e38\u91cf\n\n\u2502     \u2514\u2500\u2500 \u5de5\u5177\u7c7b\n\n\u2502\n\n\u251c\u2500\u2500 example-project-domain (\u6838\u5fc3\u9886\u57df\u5c42)\n\n\u2502     \u2514\u2500\u2500 ...\n\n\u2502\n\n\u251c\u2500\u2500 example-project-infrastructure (\u57fa\u7840\u8bbe\u65bd\u5c42)\n\n\u2502     \u2514\u2500\u2500 ...\n\n\u2502\n\n\u251c\u2500\u2500 example-project-application (\u5e94\u7528\u5c42)\n\n\u2502     \u2514\u2500\u2500 ...\n\n\u2502\n\n\u251c\u2500\u2500 example-project-facade (\u5916\u89c2\u5c42)\n\n\u2502     \u2514\u2500\u2500 ...\n\n\u2502\n\n\u251c\u2500\u2500 example-project-web (Web\u5c42)\n\n\u2502     \u2514\u2500\u2500 ...\n\n\u2502\n\n\u2514\u2500\u2500 example-project-bootstrap (\u542f\u52a8\u5c42)\n\n\u2514\u2500\u2500 ...\n</code></pre> <p>\u793a\u4f8b\u4ee3\u7801\uff1a</p> <p>\u5728<code>example-project-common</code>\u6a21\u5757\u4e2d\uff1a</p> <pre><code>// PageRequest.java\npackage com.example.demo.common.model.page;\n\nimport jakarta.validation.constraints.Max;\nimport jakarta.validation.constraints.Min;\nimport jakarta.validation.constraints.Pattern;\n\nimport java.util.List;\nimport java.util.Set;\n\n/**\n * \u5206\u9875\u8bf7\u6c42\u53c2\u6570\u5c01\u88c5\u7c7b\n */\n\n\npublic class PageRequest {\n\n    /**\n     * \u9ed8\u8ba4\u7b2c\u4e00\u9875\n     */\n    public static final int DEFAULT_PAGE_NUM = 1;\n\n    /**\n     * \u9ed8\u8ba4\u6bcf\u987510\u6761\n     */\n    public static final int DEFAULT_PAGE_SIZE = 10;\n\n    /**\n     * \u9ed8\u8ba4\u6392\u5e8f\u65b9\u5411 - \u5347\u5e8f\n     */\n    public static final String DEFAULT_ORDER = \"desc\";\n\n    /**\n     * \u6700\u5927\u5141\u8bb8\u7684\u6bcf\u9875\u8bb0\u5f55\u6570\n     */\n    public static final int MAX_PAGE_SIZE = 1000;\n\n    /**\n     * \u5f53\u524d\u9875\u7801\uff08\u4ece1\u5f00\u59cb\uff09\n     */\n    @Min(value = 1, message = \"\u9875\u7801\u4e0d\u80fd\u5c0f\u4e8e1\")\n    private int pageNum = DEFAULT_PAGE_NUM;\n\n    /**\n     * \u6bcf\u9875\u8bb0\u5f55\u6570\n     */\n    @Min(value = 1, message = \"\u6bcf\u9875\u6570\u91cf\u4e0d\u80fd\u5c0f\u4e8e1\")\n    @Max(value = MAX_PAGE_SIZE, message = \"\u6bcf\u9875\u6570\u91cf\u4e0d\u80fd\u8d85\u8fc7\" + MAX_PAGE_SIZE)\n    private int pageSize = DEFAULT_PAGE_SIZE;\n\n    /**\n     * \u6392\u5e8f\u5b57\u6bb5\n     */\n    private String sort;\n\n    /**\n     * \u6392\u5e8f\u65b9\u5411\n     * asc: \u5347\u5e8f\n     * desc: \u964d\u5e8f\n     */\n    @Pattern(regexp = \"asc|desc\", message = \"\u6392\u5e8f\u65b9\u5411\u5fc5\u987b\u662fasc\u6216desc\")\n    private String order = DEFAULT_ORDER;\n\n    // \u65e0\u53c2\u6784\u9020\u5668\n    public PageRequest() {\n    }\n\n    /**\n     * \u5e26\u9875\u7801\u548c\u6bcf\u9875\u6570\u91cf\u7684\u6784\u9020\u5668\n     *\n     * @param pageNum  \u5f53\u524d\u9875\u7801\n     * @param pageSize \u6bcf\u9875\u6570\u91cf\n     */\n    public PageRequest(int pageNum, int pageSize) {\n        this.pageNum = pageNum;\n        this.pageSize = pageSize;\n    }\n\n    /**\n     * \u5e26\u6240\u6709\u53c2\u6570\u7684\u6784\u9020\u5668\n     *\n     * @param pageNum  \u5f53\u524d\u9875\u7801\n     * @param pageSize \u6bcf\u9875\u6570\u91cf\n     * @param sort     \u6392\u5e8f\u5b57\u6bb5\n     * @param order    \u6392\u5e8f\u65b9\u5411\n     */\n    public PageRequest(int pageNum, int pageSize, String sort, String order) {\n        this.pageNum = pageNum;\n        this.pageSize = pageSize;\n        this.sort = sort;\n        this.order = order;\n    }\n\n    /**\n     * \u8ba1\u7b97\u504f\u79fb\u91cf\uff08\u7528\u4e8e\u6570\u636e\u5e93\u5206\u9875\u67e5\u8be2\uff09\n     *\n     * @return \u5f53\u524d\u9875\u7684\u8d77\u59cb\u4f4d\u7f6e\n     */\n    public int getOffset() {\n        return (pageNum - 1) * pageSize;\n    }\n\n    /**\n     * \u9a8c\u8bc1\u6392\u5e8f\u5b57\u6bb5\u662f\u5426\u5728\u5141\u8bb8\u7684\u5217\u8868\u4e2d\n     *\n     * @param allowedFields \u5141\u8bb8\u7684\u6392\u5e8f\u5b57\u6bb5\u96c6\u5408\n     * @return \u5982\u679c\u6392\u5e8f\u5b57\u6bb5\u6709\u6548\u8fd4\u56detrue\uff0c\u5426\u5219\u8fd4\u56defalse\n     */\n    public boolean isSortValid(Set&lt;String&gt; allowedFields) {\n        if (sort == null || sort.isEmpty()) {\n            return true;\n        }\n        return allowedFields.contains(sort);\n    }\n\n    /**\n     * \u9a8c\u8bc1\u6392\u5e8f\u5b57\u6bb5\u662f\u5426\u5728\u5141\u8bb8\u7684\u5217\u8868\u4e2d\uff0c\u65e0\u6548\u65f6\u629b\u51fa\u5f02\u5e38\n     *\n     * @param allowedFields \u5141\u8bb8\u7684\u6392\u5e8f\u5b57\u6bb5\u96c6\u5408\n     * @param errorMessage  \u9519\u8bef\u4fe1\u606f\n     * @throws IllegalArgumentException \u5982\u679c\u6392\u5e8f\u5b57\u6bb5\u65e0\u6548\n     */\n    public void validateSort(List&lt;String&gt; allowedFields, String errorMessage) {\n        if (sort != null &amp;&amp; !sort.isEmpty() &amp;&amp; !allowedFields.contains(sort)) {\n            throw new IllegalArgumentException(errorMessage);\n        }\n    }\n\n    public int getPageNum() {\n        return pageNum;\n    }\n\n    public void setPageNum(int pageNum) {\n        this.pageNum = pageNum;\n    }\n\n    public int getPageSize() {\n        return pageSize;\n    }\n\n    public void setPageSize(int pageSize) {\n        this.pageSize = pageSize;\n    }\n\n    public String getSort() {\n        return sort;\n    }\n\n    public void setSort(String sort) {\n        this.sort = sort;\n    }\n\n    public String getOrder() {\n        return order;\n    }\n\n    public void setOrder(String order) {\n        this.order = order;\n    }\n}\n</code></pre> <pre><code>// PageResult.java\n\npackage com.example.demo.common.model.page;\n\nimport java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.List;\nimport java.util.function.BiFunction;\nimport java.util.function.Function;\nimport java.util.stream.Collectors;\n\n\npublic class PageResult&lt;T&gt; {\n\n    private final int pageNum;        // \u5f53\u524d\u9875\u7801\n    private final int pageSize;        // \u6bcf\u9875\u6570\u91cf\n    private final long total;      // \u603b\u8bb0\u5f55\u6570\n    private final int totalPage;       // \u603b\u9875\u6570\n    private final List&lt;T&gt; data;    // \u5f53\u524d\u9875\u6570\u636e\n    private final String sort;     // \u6392\u5e8f\u5b57\u6bb5\n    private final String order;    // \u6392\u5e8f\u65b9\u5411\n\n    /**\n     * \u6784\u9020\u51fd\u6570\n     *\n     * @param pageRequest \u5206\u9875\u8bf7\u6c42\n     * @param total       \u603b\u8bb0\u5f55\u6570\n     * @param data        \u5f53\u524d\u9875\u6570\u636e\n     */\n    public PageResult(PageRequest pageRequest, long total, List&lt;T&gt; data) {\n        this.pageNum = pageRequest.getPageNum();\n        this.pageSize = pageRequest.getPageSize();\n        this.sort = pageRequest.getSort();\n        this.order = pageRequest.getOrder();\n        this.total = total;\n        this.totalPage = calculateTotalPage(total, pageRequest.getPageSize());\n        this.data = data;\n    }\n\n    /**\n     * \u6784\u9020\u51fd\u6570\n     *\n     * @param pageNum  \u5f53\u524d\u9875\u7801\n     * @param pageSize  \u6bcf\u9875\u6570\u91cf\n     * @param total \u603b\u8bb0\u5f55\u6570\n     * @param data  \u5f53\u524d\u9875\u6570\u636e\n     * @param sort  \u6392\u5e8f\u5b57\u6bb5\n     * @param order \u6392\u5e8f\u65b9\u5411\n     */\n    public PageResult(int pageNum, int pageSize, long total, List&lt;T&gt; data, String sort, String order) {\n        this.pageNum = pageNum;\n        this.pageSize = pageSize;\n        this.total = total;\n        this.data = data != null ? data : Collections.emptyList();\n        this.sort = sort;\n        this.order = order;\n\n        // \u8ba1\u7b97\u603b\u9875\u6570\n        this.totalPage = calculateTotalPage(total, pageSize);\n    }\n\n    /**\n     * \u8ba1\u7b97\u603b\u9875\u6570\n     *\n     * @param total \u603b\u8bb0\u5f55\u6570\n     * @param size  \u6bcf\u9875\u6570\u91cf\n     * @return \u603b\u9875\u6570\n     */\n    private int calculateTotalPage(long total, int size) {\n        if (size &lt;= 0) return 0;\n        return (int) Math.ceil((double) total / size);\n    }\n\n\n    // ================ \u5b9e\u7528\u9759\u6001\u65b9\u6cd5 ================ //\n\n    /**\n     * \u521b\u5efa\u7a7a\u7684\u5206\u9875\u7ed3\u679c\n     *\n     * @param &lt;T&gt; \u6570\u636e\u7c7b\u578b\n     * @return \u7a7a\u7684\u5206\u9875\u7ed3\u679c\n     */\n    public static &lt;T&gt; PageResult&lt;T&gt; empty() {\n        return new PageResult&lt;&gt;(1, 0, 0, Collections.emptyList(), null, null);\n    }\n\n    /**\n     * \u57fa\u4e8e PageRequest \u521b\u5efa\u7a7a\u7684\u5206\u9875\u7ed3\u679c\n     *\n     * @param pageRequest \u5206\u9875\u8bf7\u6c42\n     * @param &lt;T&gt;         \u6570\u636e\u7c7b\u578b\n     * @return \u7a7a\u7684\u5206\u9875\u7ed3\u679c\n     */\n    public static &lt;T&gt; PageResult&lt;T&gt; empty(PageRequest pageRequest) {\n        return new PageResult&lt;&gt;(\n                pageRequest.getPageNum(),\n                pageRequest.getPageSize(),\n                0,\n                Collections.emptyList(),\n                pageRequest.getSort(),\n                pageRequest.getOrder()\n        );\n    }\n\n    /**\n     * \u521b\u5efa\u5355\u9875\u7ed3\u679c\uff08\u9002\u7528\u4e8e\u6570\u636e\u91cf\u5c0f\u7684\u60c5\u51b5\uff09\n     *\n     * @param data \u6240\u6709\u6570\u636e\n     * @param &lt;T&gt;  \u6570\u636e\u7c7b\u578b\n     * @return \u5355\u9875\u7ed3\u679c\n     */\n    public static &lt;T&gt; PageResult&lt;T&gt; singlePage(List&lt;T&gt; data) {\n        long total = data != null ? data.size() : 0;\n        return new PageResult&lt;&gt;(1, (int) total, total, data, null, null);\n    }\n\n    /**\n     * \u521b\u5efa\u5206\u9875\u7ed3\u679c\uff08\u57fa\u4e8e PageRequest\uff09\n     *\n     * @param pageRequest \u5206\u9875\u8bf7\u6c42\n     * @param total       \u603b\u8bb0\u5f55\u6570\n     * @param data        \u5f53\u524d\u9875\u6570\u636e\n     * @param &lt;T&gt;         \u6570\u636e\u7c7b\u578b\n     * @return \u5206\u9875\u7ed3\u679c\n     */\n    public static &lt;T&gt; PageResult&lt;T&gt; of(PageRequest pageRequest, long total, List&lt;T&gt; data) {\n        return new PageResult&lt;&gt;(\n                pageRequest.getPageNum(),\n                pageRequest.getPageSize(),\n                total,\n                data,\n                pageRequest.getSort(),\n                pageRequest.getOrder()\n        );\n    }\n\n    /**\n     * \u8f6c\u6362\u5206\u9875\u7ed3\u679c\u7684\u6570\u636e\u7c7b\u578b\n     *\n     * @param source \u6e90\u5206\u9875\u7ed3\u679c\n     * @param mapper \u6570\u636e\u8f6c\u6362\u51fd\u6570\n     * @param &lt;T&gt;    \u6e90\u6570\u636e\u7c7b\u578b\n     * @param &lt;R&gt;    \u76ee\u6807\u6570\u636e\u7c7b\u578b\n     * @return \u8f6c\u6362\u540e\u7684\u5206\u9875\u7ed3\u679c\n     */\n    public static &lt;T, R&gt; PageResult&lt;R&gt; map(PageResult&lt;T&gt; source, Function&lt;T, R&gt; mapper) {\n        if (source == null || mapper == null) {\n            throw new IllegalArgumentException(\"Source and mapper must not be null\");\n        }\n\n        List&lt;R&gt; mappedData = source.getData().stream()\n                .map(mapper)\n                .collect(Collectors.toList());\n\n        return new PageResult&lt;&gt;(\n                source.getPageNum(),\n                source.getPageSize(),\n                source.getTotal(),\n                mappedData,\n                source.getSort(),\n                source.getOrder()\n        );\n    }\n\n    /**\n     * \u5408\u5e76\u4e24\u4e2a\u5206\u9875\u7ed3\u679c\uff08\u9002\u7528\u4e8e\u5e76\u884c\u67e5\u8be2\u573a\u666f\uff09\n     *\n     * @param result1  \u7b2c\u4e00\u4e2a\u5206\u9875\u7ed3\u679c\n     * @param result2  \u7b2c\u4e8c\u4e2a\u5206\u9875\u7ed3\u679c\n     * @param combiner \u6570\u636e\u5408\u5e76\u51fd\u6570\n     * @param &lt;T&gt;      \u7b2c\u4e00\u4e2a\u7ed3\u679c\u7684\u6570\u636e\u7c7b\u578b\n     * @param &lt;U&gt;      \u7b2c\u4e8c\u4e2a\u7ed3\u679c\u7684\u6570\u636e\u7c7b\u578b\n     * @param &lt;R&gt;      \u5408\u5e76\u540e\u7684\u6570\u636e\u7c7b\u578b\n     * @return \u5408\u5e76\u540e\u7684\u5206\u9875\u7ed3\u679c\n     */\n    public static &lt;T, U, R&gt; PageResult&lt;R&gt; combine(\n            PageResult&lt;T&gt; result1,\n            PageResult&lt;U&gt; result2,\n            BiFunction&lt;T, U, R&gt; combiner) {\n\n        // \u9a8c\u8bc1\u5206\u9875\u4fe1\u606f\u662f\u5426\u4e00\u81f4\n        if (result1.getPageNum() != result2.getPageNum() ||\n                result1.getPageSize() != result2.getPageSize() ||\n                result1.getTotal() != result2.getTotal()) {\n            throw new IllegalArgumentException(\"Page results are not compatible for combination\");\n        }\n\n        // \u9a8c\u8bc1\u6570\u636e\u6570\u91cf\u662f\u5426\u4e00\u81f4\n        if (result1.getData().size() != result2.getData().size()) {\n            throw new IllegalArgumentException(\"Data lists have different sizes\");\n        }\n\n        // \u5408\u5e76\u6570\u636e\n        List&lt;R&gt; combinedData = new ArrayList&lt;&gt;();\n        for (int i = 0; i &lt; result1.getData().size(); i++) {\n            R combined = combiner.apply(\n                    result1.getData().get(i),\n                    result2.getData().get(i)\n            );\n            combinedData.add(combined);\n        }\n\n        return new PageResult&lt;&gt;(\n                result1.getPageNum(),\n                result1.getPageSize(),\n                result1.getTotal(),\n                combinedData,\n                result1.getSort(),\n                result1.getOrder()\n        );\n    }\n\n    public int getPageNum() {\n        return pageNum;\n    }\n\n    public int getPageSize() {\n        return pageSize;\n    }\n\n    public long getTotal() {\n        return total;\n    }\n\n    public int getTotalPage() {\n        return totalPage;\n    }\n\n    public List&lt;T&gt; getData() {\n        return data;\n    }\n\n    public String getSort() {\n        return sort;\n    }\n\n    public String getOrder() {\n        return order;\n    }\n}\n</code></pre> <p>\u5728web\u5c42\u4f7f\u7528\uff1a</p> <pre><code>// UserController.java\n\n@RestController\n@RequestMapping(\"/users\")\npublic class UserController {\n\n    @Autowired\n    private UserService userService;\n\n    @GetMapping\n    public PageResponse&lt;UserDTO&gt; listUsers(PageRequest pageRequest) {\n\n        // \u8c03\u7528application\u5c42\uff0c\u8fd4\u56dePageResponse\n\n        return userService.listUsers(pageRequest);\n\n    }\n\n}\n</code></pre> <p>\u5728facade\u5c42\u63a5\u53e3\u4e2d\u4f7f\u7528\uff08\u5982\u679cfacade\u5c42\u9700\u8981\u5206\u9875\u67e5\u8be2\u63a5\u53e3\uff09\uff1a</p> <p><pre><code>// UserFacade.java (\u5728facade\u6a21\u5757\u4e2d)\n\npublic interface UserFacade {\n\n    PageResponse&lt;UserDTO&gt; listUsers(PageRequest pageRequest);\n\n}\n</code></pre> \u901a\u7528\u8bf7\u6c42\u54cd\u5e94\u4ee5\u53ca\u5206\u9875\u8bf7\u6c42\u548c\u54cd\u5e94\u7c7b\u5e94\u8be5\u653e\u5728\u72ec\u7acb\u7684common\u6a21\u5757\u4e2d\uff0c\u4ee5\u4fbf\u591a\u4e2a\u5c42\uff08web\u3001facade\uff09\u590d\u7528\u3002 \u8fd9\u6837\uff0c\u65e0\u8bba\u662f\u901a\u8fc7Web\u63a5\u53e3\u8fd8\u662fRPC\u63a5\u53e3\uff0c\u90fd\u4f7f\u7528\u76f8\u540c\u7684\u5206\u9875\u8bf7\u6c42\u548c\u54cd\u5e94\u7ed3\u6784\uff0c\u4fdd\u6301\u4e00\u81f4\u6027\u3002</p>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#_6","title":"\u5206\u5c42\u67b6\u6784\u5404\u5c42\u804c\u8d23\u8be6\u89e3","text":""},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#1-example-project-common","title":"1. example-project-common (\u901a\u7528\u6a21\u5757)","text":"<p>\u6838\u5fc3\u804c\u8d23\uff1a\u63d0\u4f9b\u5168\u7cfb\u7edf\u5171\u4eab\u7684\u57fa\u7840\u8bbe\u65bd\u65e0\u5173\u7684\u516c\u5171\u7ec4\u4ef6 - \u901a\u7528DTO   - <code>PageRequest</code>\uff1a\u7edf\u4e00\u5206\u9875\u8bf7\u6c42\u53c2\u6570   - <code>PageResponse</code>\uff1a\u6807\u51c6\u5316\u5206\u9875\u54cd\u5e94\u7ed3\u6784   - <code>BaseResponse</code>\uff1a\u5168\u5c40\u54cd\u5e94\u5c01\u88c5\uff08\u6210\u529f/\u5931\u8d25\uff09 - \u5e38\u91cf\u5b9a\u4e49   - \u7cfb\u7edf\u7ea7\u5e38\u91cf\uff08\u5982\u7f13\u5b58Key\u524d\u7f00\uff09   - \u9519\u8bef\u7801\u679a\u4e3e\uff08<code>ErrorCode</code>\uff09 - \u5de5\u5177\u7c7b   - \u52a0\u89e3\u5bc6\u5de5\u5177\uff08<code>AESUtil</code>\uff09   - \u65e5\u671f\u5904\u7406\uff08<code>DateUtils</code>\uff09   - \u9a8c\u8bc1\u5de5\u5177\uff08<code>ValidationUtils</code>\uff09 - \u5168\u5c40\u5f02\u5e38   - <code>BusinessException</code>\uff1a\u4e1a\u52a1\u5f02\u5e38\u57fa\u7c7b   - <code>GlobalExceptionHandler</code>\uff1a\u7edf\u4e00\u5f02\u5e38\u5904\u7406\u5668  </p> <p>\ud83d\udccc \u8bbe\u8ba1\u539f\u5219\uff1a\u96f6\u4e1a\u52a1\u903b\u8f91 + \u65e0\u6280\u672f\u6846\u67b6\u4f9d\u8d56\uff0c\u53ef\u88ab\u4efb\u610f\u6a21\u5757\u5f15\u7528  </p>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#2-example-project-domain","title":"2. example-project-domain (\u6838\u5fc3\u9886\u57df\u5c42)","text":"<p>\u6838\u5fc3\u804c\u8d23\uff1a\u5b9e\u73b0\u7cfb\u7edf\u7684\u6838\u5fc3\u4e1a\u52a1\u903b\u8f91\uff0c\u4fdd\u6301\u9886\u57df\u6a21\u578b\u7eaf\u51c0 - \u9886\u57df\u6a21\u578b   - \u5b9e\u4f53\uff08<code>User</code>, <code>Product</code>\uff09   - \u503c\u5bf9\u8c61\uff08<code>Money</code>, <code>Address</code>\uff09   - \u805a\u5408\u6839\uff08<code>Order</code>\uff09 - \u9886\u57df\u670d\u52a1   - \u4e1a\u52a1\u89c4\u5219\u5c01\u88c5\uff08<code>UserRegistrationService</code>\uff09   - \u8de8\u5b9e\u4f53\u64cd\u4f5c\uff08<code>OrderPaymentService</code>\uff09 - \u4ed3\u50a8\u63a5\u53e3   - \u5b9a\u4e49\u6570\u636e\u8bbf\u95ee\u5951\u7ea6\uff08<code>UserRepository</code>, <code>OrderRepository</code>\uff09 - \u9886\u57df\u4e8b\u4ef6   - <code>UserRegisteredEvent</code> \u7b49\u4e8b\u4ef6\u5b9a\u4e49  </p> <p>\ud83d\udd12 \u5173\u952e\u7ea6\u675f\uff1a 1. \u7981\u6b62\u4f9d\u8d56\u5176\u4ed6\u6a21\u5757\uff08\u5305\u62ecSpring\u6846\u67b6\uff09 2. \u901a\u8fc7\u63a5\u53e3\u4e0e\u57fa\u7840\u8bbe\u65bd\u5c42\u89e3\u8026 3. \u4e0d\u5305\u542b\u4efb\u4f55\u4f20\u8f93\u5bf9\u8c61\uff08DTO\uff09\u6216\u6301\u4e45\u5316\u6ce8\u89e3  </p>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#3-example-project-infrastructure","title":"3. example-project-infrastructure (\u57fa\u7840\u8bbe\u65bd\u5c42)","text":"<p>\u6838\u5fc3\u804c\u8d23\uff1a\u5b9e\u73b0\u6280\u672f\u7ec6\u8282\uff0c\u4e3a\u9886\u57df\u5c42\u63d0\u4f9b\u6280\u672f\u652f\u6301 - \u6301\u4e45\u5316\u5b9e\u73b0   - MyBatis Mapper\uff08<code>UserMapper</code>\uff09   - JPA Repository\uff08<code>OrderJpaRepository</code>\uff09   - \u4ed3\u50a8\u63a5\u53e3\u5b9e\u73b0\uff08<code>UserRepositoryImpl</code>\uff09 - PO\u5bf9\u8c61   - \u6570\u636e\u5e93\u8868\u6620\u5c04\u5b9e\u4f53\uff08<code>UserPO</code>, <code>OrderPO</code>\uff09 - \u4e09\u65b9\u96c6\u6210   - Redis\u5ba2\u6237\u7aef\uff08<code>RedisTemplate</code>\u5305\u88c5\uff09   - RPC\u8c03\u7528\u9002\u914d\u5668\uff08<code>PaymentServiceAdapter</code>\uff09   - \u6d88\u606f\u961f\u5217\u751f\u4ea7\u8005\uff08<code>KafkaProducer</code>\uff09 - \u5bf9\u8c61\u8f6c\u6362\u5668   - <code>UserConverter</code>\uff1aPO \u21c4 \u9886\u57df\u5bf9\u8c61\u8f6c\u6362  </p> <p>\u2699\ufe0f \u6280\u672f\u91cd\u70b9\uff1a - \u5b9e\u73b0\u9886\u57df\u5c42\u5b9a\u4e49\u7684\u63a5\u53e3 - \u5904\u7406\u6240\u6709\u4e0e\u6280\u672f\u6808\u76f8\u5173\u7684\u4ee3\u7801  </p>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#4-example-project-application","title":"4. example-project-application (\u5e94\u7528\u5c42)","text":"<p>\u6838\u5fc3\u804c\u8d23\uff1a\u534f\u8c03\u9886\u57df\u5bf9\u8c61\u5b8c\u6210\u5177\u4f53\u5e94\u7528\u573a\u666f - \u5e94\u7528\u670d\u52a1   - \u7528\u4f8b\u5b9e\u73b0\uff08<code>UserAppService.register()</code>\uff09   - \u4e8b\u52a1\u63a7\u5236\uff08<code>@Transactional</code>\uff09 - DTO\u8f6c\u6362   - \u5c06\u9886\u57df\u5bf9\u8c61\u8f6c\u6362\u4e3a\u4f20\u8f93\u5bf9\u8c61\uff08BO \u2192 DTO\uff09 - \u8de8\u9886\u57df\u534f\u8c03   - \u8c03\u7528\u591a\u4e2a\u9886\u57df\u670d\u52a1\u5b8c\u6210\u4e1a\u52a1\u6d41   - \u4f8b\u5982\u8ba2\u5355\u521b\u5efa\uff1a <pre><code>public void createOrder(OrderRequest request) {\n    // 1. \u9a8c\u8bc1\u7528\u6237\n    User user = userService.validateUser(request.userId());\n    // 2. \u521b\u5efa\u8ba2\u5355\u9886\u57df\u5bf9\u8c61\n    Order order = OrderFactory.create(user, request.items());\n    // 3. \u652f\u4ed8\u5904\u7406\n    paymentService.process(order);\n    // 4. \u4fdd\u5b58\u8ba2\u5355\n    orderRepository.save(order);\n}\n</code></pre></p> <p>\ud83e\udde9 \u6838\u5fc3\u4ef7\u503c\uff1a\u9694\u79bb\u9886\u57df\u903b\u8f91\u4e0e\u6280\u672f\u5b9e\u73b0\uff0c\u4fdd\u6301\u7528\u4f8b\u53ef\u8bfb\u6027  </p>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#5-example-project-facade","title":"5. example-project-facade (\u5916\u89c2\u5c42)","text":"<p>\u6838\u5fc3\u804c\u8d23\uff1a\u4f5c\u4e3a\u7cfb\u7edf\u5bf9\u5916\u7684\u670d\u52a1\u5951\u7ea6 - API\u63a5\u53e3\u5b9a\u4e49   - RPC\u670d\u52a1\u63a5\u53e3\uff08<code>UserFacade</code>, <code>OrderFacade</code>\uff09 - \u63a5\u53e3\u4e13\u7528DTO   - \u8bf7\u6c42/\u54cd\u5e94\u5bf9\u8c61\uff08<code>UserCreateDTO</code>, <code>OrderResponse</code>\uff09 - \u63a5\u53e3\u7248\u672c\u7ba1\u7406   - \u652f\u6301\u591a\u7248\u672cAPI\uff08<code>@ApiVersion(\"v1\")</code>\uff09  </p> <p>\ud83c\udf10 \u5173\u952e\u7279\u6027\uff1a 1. \u72ec\u7acb\u6253\u5305\u53d1\u5e03\uff08\u5982Dubbo\u670d\u52a1jar\u5305\uff09 2. \u4e0d\u5305\u542b\u4efb\u4f55\u5b9e\u73b0\u903b\u8f91 3. \u5b9a\u4e49\u660e\u786e\u7684\u63a5\u53e3\u89c4\u8303\u6587\u6863  </p>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#6-example-project-web-web","title":"6. example-project-web (Web\u5c42)","text":"<p>\u6838\u5fc3\u804c\u8d23\uff1a\u5904\u7406HTTP\u8bf7\u6c42\u548c\u524d\u7aef\u4ea4\u4e92 - \u63a7\u5236\u5668   - RESTful API\uff08<code>UserController</code>, <code>ProductController</code>\uff09 - Web\u4e13\u7528DTO   - \u524d\u7aef\u5b9a\u5236\u5316\u5bf9\u8c61\uff08<code>UserDetailVO</code>\uff09 - \u53c2\u6570\u6821\u9a8c   - \u8bf7\u6c42\u9a8c\u8bc1\uff08<code>@Valid</code> + <code>BindingResult</code>\uff09 - \u5b89\u5168\u63a7\u5236   - \u6743\u9650\u6ce8\u89e3\uff08<code>@PreAuthorize</code>\uff09 - Swagger\u652f\u6301   - API\u6587\u6863\u751f\u6210\u914d\u7f6e  </p> <p>\ud83d\udda5\ufe0f \u524d\u7aef\u5bf9\u63a5\u8981\u70b9\uff1a - \u4f7f\u7528VO\u5bf9\u8c61\u5c4f\u853d\u9886\u57df\u6a21\u578b\u7ec6\u8282 - \u5904\u7406\u8de8\u57df\u7b49Web\u5c42\u5173\u6ce8\u70b9  </p>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#7-example-project-bootstrap","title":"7. example-project-bootstrap (\u542f\u52a8\u5c42)","text":"<p>\u6838\u5fc3\u804c\u8d23\uff1a\u6574\u5408\u6240\u6709\u6a21\u5757\u5e76\u542f\u52a8\u5e94\u7528 - \u542f\u52a8\u7c7b   - <code>Application.java</code>\uff1aSpring Boot\u5165\u53e3 - \u5168\u5c40\u914d\u7f6e   - \u6570\u636e\u6e90\u914d\u7f6e\uff08<code>DataSourceConfig</code>\uff09   - MVC\u914d\u7f6e\uff08<code>WebMvcConfig</code>\uff09   - \u5b89\u5168\u914d\u7f6e\uff08<code>SecurityConfig</code>\uff09 - \u7ec4\u4ef6\u626b\u63cf   - \u5305\u626b\u63cf\u8def\u5f84\u914d\u7f6e <pre><code>@SpringBootApplication(scanBasePackages = {\n    \"com.example.domain\",\n    \"com.example.infrastructure\",\n    \"com.example.application\",\n    \"com.example.web\"\n})\n</code></pre> - Profile\u7ba1\u7406   - \u591a\u73af\u5883\u914d\u7f6e\uff08application-{dev|prod}.yml\uff09  </p> <p>\ud83d\ude80 \u542f\u52a8\u5173\u952e\uff1a\u4ec5\u6b64\u6a21\u5757\u5305\u542b<code>spring-boot-maven-plugin</code>\u63d2\u4ef6  </p>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#webdomain","title":"\u4e3a\u4ec0\u4e48\u7981\u6b62Web\u5c42\u76f4\u63a5\u8c03\u7528Domain\u5c42\uff1f","text":"<p>\u6839\u636e\u5206\u5c42\u67b6\u6784\u7684\u4f9d\u8d56\u5173\u7cfb\uff0cweb\u5c42\uff08\u5c55\u73b0\u5c42\uff09\u901a\u5e38\u4e0d\u76f4\u63a5\u8c03\u7528domain\u5c42\uff08\u6838\u5fc3\u9886\u57df\u5c42\uff09\u3002\u6b63\u786e\u7684\u4f9d\u8d56\u5173\u7cfb\u5e94\u8be5\u662f\uff1a</p> <p>web\u5c42 \u2192 \u5e94\u7528\u5c42\uff08application\uff09 \u2192 \u6838\u5fc3\u9886\u57df\u5c42\uff08domain\uff09</p> <p>\u7406\u7531\uff1a</p> <ol> <li> <p>\u5206\u5c42\u9694\u79bb\uff1aweb\u5c42\u8d1f\u8d23\u5904\u7406HTTP\u8bf7\u6c42\u548c\u54cd\u5e94\uff0c\u4e0d\u5e94\u8be5\u5305\u542b\u4e1a\u52a1\u903b\u8f91\u3002\u4e1a\u52a1\u903b\u8f91\u5e94\u7531\u5e94\u7528\u5c42\u6216\u9886\u57df\u5c42\u5904\u7406\u3002</p> </li> <li> <p>\u5355\u4e00\u804c\u8d23\uff1aweb\u5c42\u53ea\u8d1f\u8d23\u53c2\u6570\u6821\u9a8c\u3001\u6570\u636e\u8f6c\u6362\uff08DTO/VO\u8f6c\u6362\uff09\u548c\u8def\u7531\uff0c\u4e1a\u52a1\u903b\u8f91\u534f\u8c03\u4ea4\u7ed9\u5e94\u7528\u5c42\u3002</p> </li> <li> <p>\u4f9d\u8d56\u5012\u7f6e\uff1a\u6838\u5fc3\u9886\u57df\u5c42\u5e94\u8be5\u4fdd\u6301\u7eaf\u51c0\uff0c\u4e0d\u4f9d\u8d56\u4e0a\u5c42\uff08\u5982web\u5c42\uff09\u3002\u5982\u679cweb\u5c42\u76f4\u63a5\u8c03\u7528domain\u5c42\uff0c\u4f1a\u5bfc\u81f4domain\u5c42\u88ab\u4e0a\u5c42\u6c61\u67d3\uff0c\u5e76\u4e14\u7834\u574f\u4e86\u5206\u5c42\u4f9d\u8d56\u89c4\u5219\u3002</p> </li> </ol> <p>\u6b63\u786e\u7684\u8c03\u7528\u6d41\u7a0b\uff1a</p> <ol> <li> <p>web\u5c42\uff08Controller\uff09\u63a5\u6536\u5230\u8bf7\u6c42\uff0c\u5c06\u8bf7\u6c42\u53c2\u6570\u8f6c\u6362\u4e3aDTO\u3002</p> </li> <li> <p>web\u5c42\u8c03\u7528\u5e94\u7528\u5c42\uff08Application Service\uff09\u7684\u65b9\u6cd5\uff0c\u4f20\u5165DTO\u3002</p> </li> <li> <p>\u5e94\u7528\u5c42\u8d1f\u8d23\u534f\u8c03\u591a\u4e2a\u9886\u57df\u670d\u52a1\uff08Domain Service\uff09\u6216\u805a\u5408\u6839\uff0c\u6267\u884c\u5177\u4f53\u7684\u4e1a\u52a1\u7528\u4f8b\u3002</p> </li> <li> <p>\u5e94\u7528\u5c42\u5185\u90e8\u5c06DTO\u8f6c\u6362\u4e3a\u9886\u57df\u5bf9\u8c61\uff08BO\uff09\uff0c\u7136\u540e\u8c03\u7528\u9886\u57df\u5c42\u7684\u65b9\u6cd5\u3002</p> </li> <li> <p>\u9886\u57df\u5c42\u6267\u884c\u6838\u5fc3\u4e1a\u52a1\u903b\u8f91\uff0c\u5e76\u8c03\u7528\u57fa\u7840\u8bbe\u65bd\u5c42\uff08\u5982\u4ed3\u50a8\u63a5\u53e3\uff09\u8fdb\u884c\u6301\u4e45\u5316\u64cd\u4f5c\u3002</p> </li> </ol> <p>\u56e0\u6b64\uff0cweb\u5c42\u4e0d\u5e94\u8be5\u76f4\u63a5\u8c03\u7528domain\u5c42\uff0c\u800c\u5e94\u8be5\u901a\u8fc7\u5e94\u7528\u5c42\u6765\u8bbf\u95ee\u9886\u57df\u903b\u8f91\u3002</p> <p>\u4f46\u662f\uff0c\u5728\u7b80\u5355\u7684CRUD\u9879\u76ee\u4e2d\uff0c\u6709\u65f6\u4f1a\u7701\u7565\u5e94\u7528\u5c42\uff0c\u6b64\u65f6web\u5c42\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528\u9886\u57df\u670d\u52a1\uff08\u4f46\u9886\u57df\u670d\u52a1\u4ecd\u7136\u5728domain\u5c42\uff0c\u800cweb\u5c42\u4f9d\u8d56domain\u5c42\uff09\u3002\u4f46\u8fd9\u79cd\u505a\u6cd5\u5728\u4e25\u683c\u7684\u5206\u5c42\u67b6\u6784\u4e2d\u662f\u4e0d\u63a8\u8350\u7684\uff0c\u56e0\u4e3a\u8fd9\u6837\u4f1a\u5bfc\u81f4\u9886\u57df\u5c42\u88ab\u4e0a\u5c42\u76f4\u63a5\u4f9d\u8d56\uff0c\u4f7f\u5f97\u9886\u57df\u5c42\u65e0\u6cd5\u72ec\u7acb\u4e8e\u4ea4\u4ed8\u673a\u5236\uff08\u5982Web\uff09\u5b58\u5728\u3002</p> <p>\u6839\u636e\u524d\u9762\u7684\u67b6\u6784\u8bbe\u8ba1\uff0c\u6211\u4eec\u7684\u5206\u5c42\u4f9d\u8d56\u662f\uff1a</p> <p>web\u5c42 \u2192 \u5e94\u7528\u5c42 \u2192 \u9886\u57df\u5c42</p> <p>\u57fa\u7840\u8bbe\u65bd\u5c42 \u2192 \u9886\u57df\u5c42</p> <p>\u6240\u4ee5\uff0c\u5728\u8bbe\u8ba1\u7684\u9879\u76ee\u4e2d\uff0cweb\u5c42\u4e0d\u80fd\u76f4\u63a5\u8c03\u7528domain\u5c42\uff0c\u800c\u662f\u901a\u8fc7\u5e94\u7528\u5c42\u95f4\u63a5\u8c03\u7528\u3002</p> <p>\u5982\u679cweb\u5c42\u76f4\u63a5\u8c03\u7528domain\u5c42\uff0c\u4f1a\u5bfc\u81f4\uff1a</p> <ul> <li> <p>\u9886\u57df\u5c42\u9700\u8981\u66b4\u9732\u7ed9web\u5c42\uff0c\u589e\u52a0\u4e86\u9886\u57df\u5c42\u7684\u8026\u5408\u3002</p> </li> <li> <p>\u4e1a\u52a1\u903b\u8f91\u53ef\u80fd\u4f1a\u6cc4\u9732\u5230web\u5c42\uff0c\u5bfc\u81f4\u91cd\u590d\u4ee3\u7801\u3002</p> </li> <li> <p>\u7834\u574f\u5206\u5c42\u67b6\u6784\uff0c\u4f7f\u5f97\u9886\u57df\u5c42\u65e0\u6cd5\u72ec\u7acb\u590d\u7528\uff08\u6bd4\u5982\u9886\u57df\u5c42\u9664\u4e86\u88abweb\u8c03\u7528\uff0c\u8fd8\u53ef\u80fd\u88ab\u6d88\u606f\u76d1\u542c\u5668\u7b49\u8c03\u7528\uff09\u3002</p> </li> </ul> <p>\u7ed3\u8bba\uff1aweb\u5c42\u4e0d\u80fd\u76f4\u63a5\u8c03\u7528domain\u5c42\uff0c\u5fc5\u987b\u901a\u8fc7\u5e94\u7528\u5c42\uff08application\u5c42\uff09\u6765\u534f\u8c03\u3002</p>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#mapstruct-vo-dto","title":"\u4f7f\u7528 MapStruct \u5b9e\u73b0 VO \u5230 DTO \u7684\u8f6c\u6362","text":"<p>\u4e0b\u9762\u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u6307\u5357\uff0c\u5c55\u793a\u5982\u4f55\u4f7f\u7528 MapStruct \u9ad8\u6548\u5730\u5c06 View Object (VO) \u8f6c\u6362\u4e3a Data Transfer Object (DTO)\u3002</p>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#1-mapstruct","title":"1. \u6dfb\u52a0 MapStruct \u4f9d\u8d56","text":"<pre><code>&lt;!-- pom.xml --&gt;\n&lt;properties&gt;\n    &lt;org.mapstruct.version&gt;1.5.5.Final&lt;/org.mapstruct.version&gt;\n&lt;/properties&gt;\n\n&lt;dependencies&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.mapstruct&lt;/groupId&gt;\n        &lt;artifactId&gt;mapstruct&lt;/artifactId&gt;\n        &lt;version&gt;${org.mapstruct.version}&lt;/version&gt;\n    &lt;/dependency&gt;\n&lt;/dependencies&gt;\n\n&lt;build&gt;\n    &lt;plugins&gt;\n        &lt;plugin&gt;\n            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n            &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n            &lt;version&gt;3.11.0&lt;/version&gt;\n            &lt;configuration&gt;\n                &lt;annotationProcessorPaths&gt;\n                    &lt;path&gt;\n                        &lt;groupId&gt;org.mapstruct&lt;/groupId&gt;\n                        &lt;artifactId&gt;mapstruct-processor&lt;/artifactId&gt;\n                        &lt;version&gt;${org.mapstruct.version}&lt;/version&gt;\n                    &lt;/path&gt;\n                &lt;/annotationProcessorPaths&gt;\n            &lt;/configuration&gt;\n        &lt;/plugin&gt;\n    &lt;/plugins&gt;\n&lt;/build&gt;\n</code></pre>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#2-vo-dto","title":"2. \u521b\u5efa VO \u548c DTO \u7c7b","text":""},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#vo-view-object-web","title":"VO (View Object) - Web\u5c42","text":"<pre><code>// web \u6a21\u5757\npublic class UserVO {\n    private Long id;\n    private String username;\n    private String displayName;\n    private String avatarUrl;\n    private LocalDateTime lastLoginTime;\n\n    // \u7701\u7565 getter/setter\n}\n</code></pre>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#dto-data-transfer-object-dto","title":"DTO (Data Transfer Object) - \u516c\u5171DTO","text":"<pre><code>// common-dto \u6a21\u5757\npublic class UserDTO {\n    private Long userId;\n    private String loginName;\n    private String fullName;\n    private String profileImage;\n    private LocalDateTime lastLogin;\n\n    // \u7701\u7565 getter/setter\n}\n</code></pre>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#3-mapstruct-mapper","title":"3. \u521b\u5efa MapStruct Mapper \u63a5\u53e3","text":"<pre><code>// web \u6a21\u5757 (\u6216 converter \u6a21\u5757)\n@Mapper(componentModel = \"spring\")\npublic interface UserMapper {\n\n    UserMapper INSTANCE = Mappers.getMapper(UserMapper.class);\n\n    @Mapping(source = \"id\", target = \"userId\")\n    @Mapping(source = \"username\", target = \"loginName\")\n    @Mapping(source = \"displayName\", target = \"fullName\")\n    @Mapping(source = \"avatarUrl\", target = \"profileImage\")\n    @Mapping(source = \"lastLoginTime\", target = \"lastLogin\")\n    UserDTO voToDto(UserVO vo);\n\n    @Mapping(source = \"userId\", target = \"id\")\n    @Mapping(source = \"loginName\", target = \"username\")\n    @Mapping(source = \"fullName\", target = \"displayName\")\n    @Mapping(source = \"profileImage\", target = \"avatarUrl\")\n    @Mapping(source = \"lastLogin\", target = \"lastLoginTime\")\n    UserVO dtoToVo(UserDTO dto);\n}\n</code></pre>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#4-mapstruct","title":"4. \u4f7f\u7528 MapStruct \u8fdb\u884c\u8f6c\u6362","text":""},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#controller","title":"\u5728 Controller \u4e2d\u4f7f\u7528","text":"<pre><code>// web \u6a21\u5757\n@RestController\n@RequestMapping(\"/users\")\npublic class UserController {\n\n    private final UserMapper userMapper;\n    private final UserAppService userAppService;\n\n    @GetMapping(\"/{id}\")\n    public ResponseEntity&lt;BaseResponse&lt;UserDTO&gt;&gt; getUserById(@PathVariable Long id) {\n        UserVO userVO = userAppService.getUserById(id);\n\n        // \u4f7f\u7528 MapStruct \u8fdb\u884c\u8f6c\u6362\n        UserDTO userDTO = userMapper.voToDto(userVO);\n\n        return ResponseEntity.ok(BaseResponse.success(userDTO));\n    }\n}\n</code></pre>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#service","title":"\u5728 Service \u4e2d\u4f7f\u7528","text":"<pre><code>// application \u6a21\u5757\n@Service\npublic class UserAppServiceImpl implements UserAppService {\n\n    private final UserDomainService userDomainService;\n    private final UserMapper userMapper;\n\n    public UserDTO getUserById(Long id) {\n        User user = userDomainService.findUserById(id);\n\n        // \u9886\u57df\u5bf9\u8c61\u8f6cVO\n        UserVO userVO = convertToVO(user);\n\n        // VO\u8f6cDTO\n        return userMapper.voToDto(userVO);\n    }\n\n    private UserVO convertToVO(User user) {\n        // \u9886\u57df\u5bf9\u8c61\u8f6cVO\u7684\u903b\u8f91\n    }\n}\n</code></pre>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#5","title":"5. \u9ad8\u7ea7\u6620\u5c04\u6280\u5de7","text":""},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#_7","title":"\u81ea\u5b9a\u4e49\u6620\u5c04\u65b9\u6cd5","text":"<pre><code>@Mapper(componentModel = \"spring\")\npublic interface UserMapper {\n\n    // ... \u5176\u4ed6\u6620\u5c04\n\n    @Mapping(target = \"status\", ignore = true) // \u5ffd\u7565\u5b57\u6bb5\n    @Mapping(target = \"fullName\", expression = \"java(vo.getFirstName() + ' ' + vo.getLastName())\")\n    UserDTO voToDto(UserVO vo);\n\n    // \u81ea\u5b9a\u4e49\u7c7b\u578b\u8f6c\u6362\n    @Named(\"stringToLocalDate\")\n    default LocalDate stringToLocalDate(String date) {\n        return date != null ? LocalDate.parse(date) : null;\n    }\n\n    @Mapping(source = \"birthDateStr\", target = \"birthDate\", qualifiedByName = \"stringToLocalDate\")\n    UserDTO voToDtoWithBirthDate(UserVO vo);\n}\n</code></pre>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#_8","title":"\u591a\u4e2a\u6e90\u5bf9\u8c61\u6620\u5c04","text":"<pre><code>@Mapper(componentModel = \"spring\")\npublic interface UserMapper {\n\n    @Mapping(source = \"vo.id\", target = \"userId\")\n    @Mapping(source = \"meta.createTime\", target = \"registrationDate\")\n    UserDTO voAndMetaToDto(UserVO vo, UserMeta meta);\n}\n</code></pre>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#_9","title":"\u96c6\u5408\u6620\u5c04","text":"<pre><code>@Mapper(componentModel = \"spring\")\npublic interface UserMapper {\n\n    List&lt;UserDTO&gt; vosToDtos(List&lt;UserVO&gt; vos);\n\n    Set&lt;UserDTO&gt; vosToDtos(Set&lt;UserVO&gt; vos);\n\n    @Mapping(source = \"id\", target = \"key\")\n    Map&lt;Long, UserDTO&gt; vosToDtoMap(List&lt;UserVO&gt; vos);\n}\n</code></pre>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#6","title":"6. \u6027\u80fd\u4f18\u5316\u5efa\u8bae","text":""},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#1_1","title":"1. \u4f7f\u7528\u5355\u4f8b\u6a21\u5f0f","text":"<pre><code>@Mapper(componentModel = \"spring\")\npublic interface UserMapper {\n    UserMapper INSTANCE = Mappers.getMapper(UserMapper.class);\n}\n</code></pre>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#2_1","title":"2. \u6279\u91cf\u8f6c\u6362\u907f\u514d\u5faa\u73af","text":"<pre><code>// \u9ad8\u6548\u65b9\u5f0f\nList&lt;UserDTO&gt; dtos = userMapper.vosToDtos(vos);\n\n// \u907f\u514d\u8fd9\u6837\u4f7f\u7528\uff08\u4f4e\u6548\uff09\nList&lt;UserDTO&gt; dtos = new ArrayList&lt;&gt;();\nfor (UserVO vo : vos) {\n    dtos.add(userMapper.voToDto(vo));\n}\n</code></pre>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#3-mapstruct-spi","title":"3. \u4f7f\u7528 MapStruct SPI \u8fdb\u884c\u9ad8\u7ea7\u914d\u7f6e","text":"<p>\u521b\u5efa <code>META-INF/services/org.mapstruct.ap.spi.AccessorNamingStrategy</code> \u6587\u4ef6\uff1a <pre><code>public class CustomAccessorNamingStrategy extends DefaultAccessorNamingStrategy {\n    @Override\n    public boolean isGetterMethod(ExecutableElement method) {\n        // \u81ea\u5b9a\u4e49getter\u8bc6\u522b\u903b\u8f91\n    }\n}\n</code></pre></p>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#7","title":"7. \u4e0e\u5206\u5c42\u67b6\u6784\u96c6\u6210","text":"<pre><code>graph TD\n    A[Web\u5c42] --&gt;|UserVO| B[MapStruct Mapper]\n    B --&gt;|UserDTO| C[Controller]\n    C --&gt;|UserDTO| D[\u524d\u7aef]\n\n    E[\u5e94\u7528\u5c42] --&gt;|UserVO| F[MapStruct Mapper]\n    F --&gt;|UserDTO| G[Facade/RPC]\n\n    style B fill:#fff2cc,stroke:#333</code></pre>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#_10","title":"\u5404\u5c42\u5bf9\u8c61\u8f6c\u6362\u5173\u7cfb\uff1a","text":"<ol> <li>Web\u5c42\uff1a</li> <li>\u63a5\u6536\u524d\u7aef\u8bf7\u6c42 \u2192 <code>@RequestBody UserVO</code></li> <li> <p>\u8fd4\u56de\u54cd\u5e94 \u2192 <code>UserDTO</code></p> </li> <li> <p>\u5e94\u7528\u5c42\uff1a</p> </li> <li>\u63a5\u6536Web\u5c42\u8f93\u5165 \u2192 <code>UserVO</code></li> <li>\u8c03\u7528\u9886\u57df\u5c42 \u2192 <code>User</code> (\u9886\u57df\u5bf9\u8c61)</li> <li> <p>\u8fd4\u56deWeb\u5c42 \u2192 <code>UserDTO</code></p> </li> <li> <p>Facade\u5c42\uff1a</p> </li> <li>\u63a5\u6536RPC\u8bf7\u6c42 \u2192 <code>UserDTO</code></li> <li>\u8fd4\u56deRPC\u54cd\u5e94 \u2192 <code>UserDTO</code></li> </ol>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#8","title":"8. \u6700\u4f73\u5b9e\u8df5\u603b\u7ed3","text":"<ol> <li>\u6a21\u5757\u5316\u653e\u7f6e\uff1a</li> <li>\u901a\u7528\u8f6c\u6362\u5668\uff1a\u653e\u5728 <code>common-converter</code> \u6a21\u5757</li> <li> <p>\u5c42\u7279\u5b9a\u8f6c\u6362\u5668\uff1a\u653e\u5728\u5404\u5c42\u6a21\u5757\u4e2d\uff08\u5982 <code>web-converter</code>\uff09</p> </li> <li> <p>\u547d\u540d\u89c4\u8303\uff1a    <pre><code>// \u63a8\u8350\nUserMapper\nProductConverter\n\n// \u65b9\u6cd5\u540d\nvoToDto()\nentityToResponse()\n</code></pre></p> </li> <li> <p>\u6027\u80fd\u5173\u952e\u70b9\uff1a</p> </li> <li> <p>\u5bf9\u4e8e\u9ad8\u9891\u8f6c\u6362\uff0c\u4f7f\u7528 <code>@MappingTarget</code> \u66f4\u65b0\u73b0\u6709\u5bf9\u8c61    <pre><code>@Mapping(target = \"lastLogin\", source = \"loginTime\")\nvoid updateDtoFromVo(UserVO vo, @MappingTarget UserDTO dto);\n</code></pre></p> </li> <li> <p>\u7ec4\u5408\u6620\u5c04\uff1a    <pre><code>@Mapper(uses = {DateMapper.class, AddressMapper.class})\npublic interface UserMapper {\n    // \u4f1a\u81ea\u52a8\u4f7f\u7528 DateMapper \u548c AddressMapper\n}\n\n@Mapper\npublic interface DateMapper {\n    default String localDateTimeToString(LocalDateTime date) {\n        return date != null ? date.toString() : null;\n    }\n}\n</code></pre></p> </li> </ol> <p>\u901a\u8fc7\u8fd9\u79cd\u7ed3\u6784\u5316\u7684 MapStruct \u5b9e\u73b0\uff0c\u53ef\u4ee5\u786e\u4fdd\uff1a - \u8f6c\u6362\u903b\u8f91\u96c6\u4e2d\u7ba1\u7406\uff0c\u6613\u4e8e\u7ef4\u62a4 - \u7f16\u8bd1\u65f6\u751f\u6210\u4ee3\u7801\uff0c\u65e0\u8fd0\u884c\u65f6\u53cd\u5c04\u5f00\u9500 - \u7c7b\u578b\u5b89\u5168\uff0c\u51cf\u5c11\u8f6c\u6362\u9519\u8bef - \u4e0e\u5206\u5c42\u67b6\u6784\u5b8c\u7f8e\u5951\u5408\uff0c\u4fdd\u6301\u5404\u5c42\u804c\u8d23\u6e05\u6670</p>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#_11","title":"\u5178\u578b\u8bf7\u6c42\u6d41","text":"<pre><code>sequenceDiagram\n    participant W as Web\u5c42\n    participant A as \u5e94\u7528\u5c42\n    participant D as \u9886\u57df\u5c42\n    participant I as \u57fa\u7840\u8bbe\u65bd\u5c42\n\n    W-&gt;&gt;A: \u4f20\u5165DTO\n    A-&gt;&gt;D: \u8f6c\u6362\u4e3a\u9886\u57df\u5bf9\u8c61\n    D-&gt;&gt;I: \u8c03\u7528\u4ed3\u50a8\u63a5\u53e3\n    I-&gt;&gt;\u6570\u636e\u5e93: \u6267\u884cSQL\n    \u6570\u636e\u5e93--&gt;&gt;I: \u8fd4\u56de\u6570\u636e\n    I--&gt;&gt;D: \u8fd4\u56de\u9886\u57df\u5bf9\u8c61\n    D--&gt;&gt;A: \u5904\u7406\u4e1a\u52a1\u903b\u8f91\n    A--&gt;&gt;W: \u8fd4\u56deDTO</code></pre>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#_12","title":"\u67b6\u6784\u6838\u5fc3\u4f18\u52bf","text":"<ol> <li>\u9886\u57df\u5c42\u7edd\u5bf9\u7a33\u5b9a </li> <li>\u4fee\u6539\u6570\u636e\u5e93\u4e0d\u5f71\u54cd\u4e1a\u52a1\u89c4\u5219  </li> <li> <p>\u66ff\u6362Web\u6846\u67b6\u4e0d\u6ce2\u53ca\u6838\u5fc3\u903b\u8f91  </p> </li> <li> <p>\u6280\u672f\u7ec6\u8282\u9694\u79bb </p> </li> <li> <p>\u57fa\u7840\u8bbe\u65bd\u53d8\u66f4\uff08\u5982Redis\u2192Memcached\uff09\u53ea\u9700\u4fee\u6539\u57fa\u7840\u8bbe\u65bd\u5c42  </p> </li> <li> <p>\u591a\u7aef\u63a5\u53e3\u7edf\u4e00 <pre><code>graph LR\n    Web\u524d\u7aef --&gt; web\u5c42\n    \u79fb\u52a8\u7aef --&gt; facade\u5c42\n    \u7b2c\u4e09\u65b9\u7cfb\u7edf --&gt; facade\u5c42\n    web\u5c42 &amp; facade\u5c42 --&gt; application\u5c42</code></pre></p> </li> <li> <p>\u53ef\u6d4b\u8bd5\u6027\u589e\u5f3a </p> </li> <li>\u9886\u57df\u5c42\u53ef\u8131\u79bbSpring\u72ec\u7acb\u6d4b\u8bd5  </li> <li>\u5e94\u7528\u5c42\u901a\u8fc7Mock\u9886\u57df\u670d\u52a1\u6d4b\u8bd5\u7528\u4f8b  </li> </ol> <p>\u901a\u8fc7\u8fd9\u79cd\u5206\u5c42\uff0c\u7cfb\u7edf\u83b7\u5f97\u4e1a\u52a1\u6838\u5fc3\u4e0e\u6280\u672f\u5b9e\u73b0\u7684\u5f7b\u5e95\u89e3\u8026\uff0c\u652f\u6301\u957f\u671f\u6f14\u5316\u548c\u591a\u7aef\u6269\u5c55\u3002</p>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#springboot","title":"springboot \u9879\u76ee\u76ee\u5f55\u7ed3\u6784\u793a\u4f8b","text":""},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#demo","title":"demo \u76ee\u5f55\u7ed3\u6784","text":"<pre><code>demo\n\u251c\u2500\u2500 HELP.md\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 app\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 application\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 pom.xml\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 src\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 main\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 com\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 example\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u2514\u2500\u2500 demo\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0             \u2514\u2500\u2500 application\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u251c\u2500\u2500 converter\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u2514\u2500\u2500 RuleDTO2BOConverter.java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u251c\u2500\u2500 dto\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u2514\u2500\u2500 RuleQueryDTO.java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2514\u2500\u2500 service\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                     \u251c\u2500\u2500 RuleService.java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                     \u2514\u2500\u2500 impl\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                         \u2514\u2500\u2500 RuleServiceImpl.java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 resources\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0     \u2514\u2500\u2500 spring\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0         \u2514\u2500\u2500 example.xml\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 test\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u2514\u2500\u2500 java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0             \u2514\u2500\u2500 com\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2514\u2500\u2500 example\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0                     \u2514\u2500\u2500 demo\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0                         \u2514\u2500\u2500 application\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 bootstrap\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 pom.xml\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 src\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 main\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 com\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 example\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u2514\u2500\u2500 demo\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0             \u2514\u2500\u2500 DemoApplication.java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 resources\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0     \u251c\u2500\u2500 config\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 application-default.properties\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 application-dev.properties\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 application-prod.properties\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 application-sim.properties\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 application-test.properties\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 application.properties\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0     \u251c\u2500\u2500 log4j2-spring.xml\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0     \u251c\u2500\u2500 spring\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 example.xml\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0     \u2514\u2500\u2500 static\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0         \u2514\u2500\u2500 index.html\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 test\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u2514\u2500\u2500 java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0             \u2514\u2500\u2500 com\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2514\u2500\u2500 example\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0                     \u2514\u2500\u2500 demo\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0                         \u2514\u2500\u2500 AbstractTestBase.java\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 common\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 pom.xml\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 src\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 main\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 com\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 example\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u2514\u2500\u2500 demo\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0             \u2514\u2500\u2500 common\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u251c\u2500\u2500 annotation\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u251c\u2500\u2500 constant\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u251c\u2500\u2500 enums\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u251c\u2500\u2500 AppErrorCode.java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u2514\u2500\u2500 ErrorCode.java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u251c\u2500\u2500 model\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u251c\u2500\u2500 page\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 PageRequest.java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 PageResult.java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 PaginationUtils.java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u2514\u2500\u2500 response\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0     \u2514\u2500\u2500 Result.java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2514\u2500\u2500 util\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 resources\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 test\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u2514\u2500\u2500 java\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 domain\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 pom.xml\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 src\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 main\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 com\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 example\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u2514\u2500\u2500 demo\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0             \u2514\u2500\u2500 domain\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u251c\u2500\u2500 converter\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u251c\u2500\u2500 model\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u2514\u2500\u2500 bo\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0     \u251c\u2500\u2500 RuleQueryBO.java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0     \u2514\u2500\u2500 RuleWithLatestVersionDTO.java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2514\u2500\u2500 repository\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 resources\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0     \u2514\u2500\u2500 spring\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0         \u2514\u2500\u2500 example.xml\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 test\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u2514\u2500\u2500 java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0             \u2514\u2500\u2500 com\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2514\u2500\u2500 example\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0                     \u2514\u2500\u2500 demo\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0                         \u2514\u2500\u2500 domain\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 facade\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 pom.xml\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 src\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 main\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 com\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 example\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u2514\u2500\u2500 demo\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0             \u2514\u2500\u2500 facade\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 resources\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0     \u2514\u2500\u2500 spring\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0         \u2514\u2500\u2500 example.xml\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 test\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u2514\u2500\u2500 java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0             \u2514\u2500\u2500 com\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2514\u2500\u2500 example\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0                     \u2514\u2500\u2500 demo\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0                         \u2514\u2500\u2500 facade\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 infrastructure\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 pom.xml\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 src\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 main\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 com\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 example\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u2514\u2500\u2500 demo\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0             \u2514\u2500\u2500 infrastructure\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u251c\u2500\u2500 mybatis\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u251c\u2500\u2500 MybatisConfiguration.java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u251c\u2500\u2500 mapper\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 custom\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 RuleCustomMapper.java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 builder\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 RuleQueryBuilder.java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 generated\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 RuleEntityDynamicSqlSupport.java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 RuleMapper.java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 RuleVersionEntityDynamicSqlSupport.java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 RuleVersionMapper.java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u2514\u2500\u2500 model\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0     \u2514\u2500\u2500 entity\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0         \u251c\u2500\u2500 RuleEntity.java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0         \u2514\u2500\u2500 RuleVersionEntity.java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2514\u2500\u2500 repositoryimpl\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 resources\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0     \u251c\u2500\u2500 generatorConfig.xml\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0     \u2514\u2500\u2500 spring\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2502\u00a0\u00a0         \u2514\u2500\u2500 example.xml\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 test\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u2514\u2500\u2500 java\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0             \u2514\u2500\u2500 com\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2514\u2500\u2500 example\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0                     \u2514\u2500\u2500 demo\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0                         \u2514\u2500\u2500 infrastructure\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 web\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 pom.xml\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 src\n\u2502\u00a0\u00a0         \u251c\u2500\u2500 main\n\u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u251c\u2500\u2500 java\n\u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 com\n\u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 example\n\u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u2514\u2500\u2500 demo\n\u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u2502\u00a0\u00a0             \u2514\u2500\u2500 web\n\u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u251c\u2500\u2500 controller\n\u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u2514\u2500\u2500 RuleController.java\n\u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u251c\u2500\u2500 converter\n\u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u2514\u2500\u2500 RuleConverter.java\n\u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u251c\u2500\u2500 exception\n\u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u2514\u2500\u2500 ControllerExceptionHandler.java\n\u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                 \u2514\u2500\u2500 vo\n\u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                     \u251c\u2500\u2500 request\n\u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                     \u2502\u00a0\u00a0 \u2514\u2500\u2500 RuleQueryPageRequest.java\n\u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u2502\u00a0\u00a0                     \u2514\u2500\u2500 response\n\u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u2514\u2500\u2500 resources\n\u2502\u00a0\u00a0         \u2514\u2500\u2500 test\n\u2502\u00a0\u00a0             \u2514\u2500\u2500 java\n\u2514\u2500\u2500 pom.xml\n</code></pre>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#_13","title":"\u4f9d\u8d56\u5173\u7cfb","text":"<pre><code>graph LR\n\n\nsubgraph   'demo_parent_'[\" Demo project\"]\n  click 'demo_parent_' call navigate(\"/Users/xiniao/Downloads/demo 2/pom.xml\")\n\n  direction  LR\n  'app_bootstrap'\n  click 'app_bootstrap' call navigate(\"\")\n\n  'app_application'\n  click 'app_application' call navigate(\"\")\n\n  'app_domain'\n  click 'app_domain' call navigate(\"\")\n\n  'app_infrastructure'\n  click 'app_infrastructure' call navigate(\"\")\n\n  'app_facade'\n  click 'app_facade' call navigate(\"\")\n\n  'app_common'\n  click 'app_common' call navigate(\"\")\n\n  'app_web'\n  click 'app_web' call navigate(\"\")\n\nend\n  'demo_application'(\"demo-application\")\n  click 'demo_application' call navigate(\"\")\n\n  'demo_domain'(\"demo-domain\")\n  click 'demo_domain' call navigate(\"\")\n\n  'demo_common'(\"demo-common\")\n  click 'demo_common' call navigate(\"\")\n\n  'demo_infrastructure'(\"demo-infrastructure\")\n  click 'demo_infrastructure' call navigate(\"\")\n\n  'demo_bootstrap'(\"demo-bootstrap\")\n  click 'demo_bootstrap' call navigate(\"\")\n\n  'demo_facade'(\"demo-facade\")\n  click 'demo_facade' call navigate(\"\")\n\n  'demo_web'(\"demo-web\")\n  click 'demo_web' call navigate(\"\")\n\n\n'demo_application' --&gt;|\u4f9d\u8d56| 'demo_domain'\n'demo_application' --&gt;|\u4f9d\u8d56| 'demo_facade'\n'demo_application' --&gt;|\u4f9d\u8d56| 'demo_infrastructure'\n'demo_application' --&gt;|\u4f9d\u8d56| 'demo_common'\n'demo_infrastructure' --&gt;|\u4f9d\u8d56| 'demo_domain'\n'demo_bootstrap' --&gt;|\u4f9d\u8d56| 'demo_application'\n'demo_bootstrap' --&gt;|\u4f9d\u8d56| 'demo_web'\n'demo_web' --&gt;|\u4f9d\u8d56| 'demo_application'\n'demo_web' --&gt;|\u4f9d\u8d56| 'demo_common'</code></pre> <p>\u6ce8\u610f\uff1acommon\u6a21\u5757\u5e94\u8be5\u5c3d\u91cf\u4fdd\u6301\u7cbe\u7b80\uff0c\u907f\u514d\u5f15\u5165\u4e0d\u5fc5\u8981\u7684\u4f9d\u8d56\uff0c\u4ee5\u514d\u4f20\u9012\u4f9d\u8d56\u5230\u5176\u4ed6\u6a21\u5757\u3002</p>"},{"location":"springboot/springboot%20%E5%A4%A7%E5%9E%8B%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%28DDD%29/#_14","title":"\u603b\u7ed3","text":"<ul> <li>\u6838\u5fc3\u601d\u60f3\uff1a\u9886\u57df\u9a71\u52a8\u8bbe\u8ba1\uff08DDD\uff09 \u5206\u5c42\uff0c\u786e\u4fdd\u4e1a\u52a1\u903b\u8f91\u4e0e\u6280\u672f\u5b9e\u73b0\u5206\u79bb\u3002  </li> <li>\u6700\u5927\u4f18\u52bf\uff1a<code>domain</code> \u5c42\u5b8c\u5168\u72ec\u7acb\uff0c\u4e1a\u52a1\u903b\u8f91\u4e0d\u6c61\u67d3\u6280\u672f\u7ec6\u8282\uff0c\u9002\u5e94\u9700\u6c42\u53d8\u5316\u4e0e\u6280\u672f\u6f14\u8fdb\u3002  </li> <li>\u9002\u7528\u573a\u666f\uff1a\u4e2d\u5927\u578b\u590d\u6742\u4e1a\u52a1\u7cfb\u7edf\uff0c\u9700\u957f\u671f\u7ef4\u62a4\u3001\u9ad8\u9891\u8fed\u4ee3\u7684\u9879\u76ee\u3002</li> </ul> <p>\u8fd9\u79cd\u5206\u5c42\u67b6\u6784\u4f7f\u5f97\u6838\u5fc3\u4e1a\u52a1\u903b\u8f91\uff08domain\u5c42\uff09\u72ec\u7acb\u4e8e\u6280\u672f\u5b9e\u73b0\uff08infrastructure\u5c42\uff09\uff0c\u63d0\u9ad8\u4e86\u7cfb\u7edf\u7684\u53ef\u7ef4\u62a4\u6027\u548c\u53ef\u6269\u5c55\u6027\u3002\u6b64\u5206\u5c42\u7ed3\u6784\u5b8c\u7f8e\u7b26\u5408 \u6574\u6d01\u67b6\u6784 \u548c \u516d\u8fb9\u5f62\u67b6\u6784 \u601d\u60f3\uff0c\u6838\u5fc3\u4e1a\u52a1\u903b\u8f91\uff08domain \u5c42\uff09\u59cb\u7ec8\u5904\u4e8e\u6700\u5185\u5c42\u4e14\u4e0d\u53d7\u6280\u672f\u7ec6\u8282\u6c61\u67d3\u3002</p>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/","title":"springboot\u4e2d\u4f7f\u7528MapStruct\u6559\u7a0b","text":"<p>\u5728Spring Boot\u4e2d\u4f7f\u7528MapStruct\u53ef\u4ee5\u65b9\u4fbf\u5730\u5b9e\u73b0\u5bf9\u8c61\u4e4b\u95f4\u7684\u6620\u5c04\u8f6c\u6362\u3002MapStruct\u662f\u4e00\u4e2a\u4ee3\u7801\u751f\u6210\u5668\uff0c\u5b83\u57fa\u4e8e\u7ea6\u5b9a\u4f18\u4e8e\u914d\u7f6e\u7684\u539f\u5219\uff0c\u901a\u8fc7\u6ce8\u89e3\u5728\u7f16\u8bd1\u65f6\u751f\u6210\u6620\u5c04\u5b9e\u73b0\u7c7b\uff0c\u4ece\u800c\u51cf\u5c11\u624b\u52a8\u7f16\u5199\u6620\u5c04\u4ee3\u7801\u7684\u5de5\u4f5c\u91cf\u3002</p> <p>\u4ee5\u4e0b\u662f\u4f7f\u7528MapStruct\u7684\u57fa\u672c\u6b65\u9aa4\uff1a</p>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#1","title":"1. \u6dfb\u52a0\u4f9d\u8d56","text":"<p>\u5728<code>pom.xml</code>\u4e2d\u6dfb\u52a0MapStruct\u7684\u4f9d\u8d56\u548c\u63d2\u4ef6\uff1a</p> <pre><code>&lt;properties&gt;\n    &lt;org.mapstruct.version&gt;1.5.5.Final&lt;/org.mapstruct.version&gt;\n&lt;/properties&gt;\n\n&lt;dependencies&gt;\n    &lt;!-- MapStruct\u6838\u5fc3\u4f9d\u8d56 --&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.mapstruct&lt;/groupId&gt;\n        &lt;artifactId&gt;mapstruct&lt;/artifactId&gt;\n        &lt;version&gt;${org.mapstruct.version}&lt;/version&gt;\n    &lt;/dependency&gt;\n&lt;/dependencies&gt;\n\n&lt;build&gt;\n    &lt;plugins&gt;\n        &lt;plugin&gt;\n            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n            &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n            &lt;version&gt;3.8.1&lt;/version&gt;\n            &lt;configuration&gt;\n                &lt;annotationProcessorPaths&gt;\n                    &lt;!-- MapStruct\u6ce8\u89e3\u5904\u7406\u5668 --&gt;\n                    &lt;path&gt;\n                        &lt;groupId&gt;org.mapstruct&lt;/groupId&gt;\n                        &lt;artifactId&gt;mapstruct-processor&lt;/artifactId&gt;\n                        &lt;version&gt;${org.mapstruct.version}&lt;/version&gt;\n                    &lt;/path&gt;\n                    &lt;!-- \u5982\u679c\u4f7f\u7528Lombok\uff0c\u9700\u540c\u65f6\u6dfb\u52a0 --&gt;\n                    &lt;path&gt;\n                        &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n                        &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n                        &lt;version&gt;${lombok.version}&lt;/version&gt;\n                    &lt;/path&gt;\n                &lt;/annotationProcessorPaths&gt;\n            &lt;/configuration&gt;\n        &lt;/plugin&gt;\n    &lt;/plugins&gt;\n&lt;/build&gt;\n</code></pre> <p>\u6ce8\u610f\uff1a\u5982\u679c\u4f60\u4f7f\u7528\u4e86Lombok\uff0c\u786e\u4fdd\u5728\u6ce8\u89e3\u5904\u7406\u5668\u8def\u5f84\u4e2d\u540c\u65f6\u6dfb\u52a0MapStruct\u548cLombok\uff0c\u5e76\u4e14Lombok\u7684\u7248\u672c\u9700\u8981\u6b63\u786e\u6307\u5b9a\u3002</p> <p>\u5982\u679c\u9879\u76ee\u4f7f\u7528Lombok\uff0c\u786e\u4fddMapStruct\u5904\u7406\u5668\u5728Lombok\u4e4b\u540e\u6267\u884c\uff08\u987a\u5e8f\u5f88\u91cd\u8981\uff09\u3002</p>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#2","title":"2. \u521b\u5efa\u6620\u5c04\u63a5\u53e3","text":"<p>\u4f7f\u7528<code>@Mapper</code>\u6ce8\u89e3\u5b9a\u4e49\u4e00\u4e2a\u63a5\u53e3\uff0cMapStruct\u4f1a\u4e3a\u8be5\u63a5\u53e3\u751f\u6210\u5b9e\u73b0\u7c7b\u3002</p> <p>\u4f8b\u5982\uff0c\u6709\u4e24\u4e2a\u7c7b\uff1a<code>User</code>\u548c<code>UserDTO</code>\uff0c\u9700\u8981\u76f8\u4e92\u8f6c\u6362\u3002</p> <pre><code>// \u5b9e\u4f53\u7c7b\n@Data // Lombok\u6ce8\u89e3\npublic class User {\n    private Long id;\n    private String username;\n    private String email;\n    private Date registrationDate;\n}\n</code></pre> <pre><code>// DTO\u7c7b\n@Data\npublic class UserDTO {\n    private Long id;\n    private String login;\n    private String contactEmail;\n    private String registrationDateStr; // \u683c\u5f0f\u5316\u7684\u65e5\u671f\u5b57\u7b26\u4e32\n}\n</code></pre> <p>\u521b\u5efa\u6620\u5c04\u63a5\u53e3\uff1a</p> <pre><code>import org.mapstruct.Mapper;\nimport org.mapstruct.Mapping;\nimport org.mapstruct.factory.Mappers;\n\n@Mapper\npublic interface UserMapper {\n\n    UserMapper INSTANCE = Mappers.getMapper(UserMapper.class);\n\n    @Mapping(source = \"username\", target = \"name\")\n    @Mapping(source = \"email\", target = \"emailAddress\")\n    UserDTO userToUserDTO(User user);\n\n    @Mapping(source = \"name\", target = \"username\")\n    @Mapping(source = \"emailAddress\", target = \"email\")\n    User userDTOToUser(UserDTO userDTO);\n\n}\n</code></pre> <ul> <li> <p><code>@Mapper</code>\uff1a\u6807\u8bb0\u8be5\u63a5\u53e3\u4e3a\u6620\u5c04\u63a5\u53e3\uff0cMapStruct\u4f1a\u4e3a\u5176\u751f\u6210\u5b9e\u73b0\u7c7b\u3002</p> </li> <li> <p><code>@Mapping</code>\uff1a\u7528\u4e8e\u6307\u5b9a\u5b57\u6bb5\u6620\u5c04\uff0c\u5f53\u6e90\u5bf9\u8c61\u548c\u76ee\u6807\u5bf9\u8c61\u7684\u5b57\u6bb5\u540d\u4e0d\u4e00\u81f4\u65f6\u4f7f\u7528\u3002<code>source</code>\u6307\u5b9a\u6e90\u5bf9\u8c61\u7684\u5b57\u6bb5\uff0c<code>target</code>\u6307\u5b9a\u76ee\u6807\u5bf9\u8c61\u7684\u5b57\u6bb5\u3002</p> </li> <li> <p>\u63a5\u53e3\u4e2d\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5b9e\u4f8b<code>INSTANCE</code>\uff0c\u901a\u8fc7<code>Mappers.getMapper</code>\u83b7\u53d6\u6620\u5c04\u5668\u5b9e\u4f8b\u3002\u4f46\u5728Spring\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u6620\u5c04\u5668\u4f5c\u4e3aSpring Bean\u6ce8\u5165\uff0c\u6240\u4ee5\u4e5f\u53ef\u4ee5\u4e0d\u7528\u8fd9\u79cd\u65b9\u5f0f\uff08\u540e\u9762\u4f1a\u8bf4\u660e\u5982\u4f55\u4e0eSpring\u96c6\u6210\uff09\u3002</p> </li> </ul>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#3-spring","title":"3. \u4e0eSpring\u96c6\u6210","text":"<p>\u4e3a\u4e86\u8ba9MapStruct\u751f\u6210\u7684\u6620\u5c04\u5668\u6210\u4e3aSpring Bean\uff0c\u53ef\u4ee5\u5728<code>@Mapper</code>\u6ce8\u89e3\u4e2d\u6dfb\u52a0<code>componentModel = \"spring\"</code>\u3002</p> <p>\u4fee\u6539\u6620\u5c04\u63a5\u53e3\uff1a</p> <pre><code>import org.mapstruct.Mapper;\n\nimport org.mapstruct.Mapping;\n\n@Mapper(componentModel = \"spring\")\npublic interface UserMapper {\n\n    @Mapping(source = \"username\", target = \"name\")\n    @Mapping(source = \"email\", target = \"emailAddress\")\n    UserDTO userToUserDTO(User user);\n\n    @Mapping(source = \"name\", target = \"username\")\n    @Mapping(source = \"emailAddress\", target = \"email\")\n    User userDTOToUser(UserDTO userDTO);\n\n}\n</code></pre> <p>\u8fd9\u6837\uff0cMapStruct\u751f\u6210\u7684\u5b9e\u73b0\u7c7b\u4f1a\u5e26\u6709<code>@Component</code>\u6ce8\u89e3\uff0c\u56e0\u6b64\u53ef\u4ee5\u901a\u8fc7Spring\u7684\u4f9d\u8d56\u6ce8\u5165\u6765\u4f7f\u7528\uff1a</p> <pre><code>@Service\npublic class UserService {\n\n    private final UserMapper userMapper;\n\n    public UserService(UserMapper userMapper) {\n        this.userMapper = userMapper;\n    }\n\n    public UserDTO getUserDTO(User user) {\n        return userMapper.userToUserDTO(user);\n    }\n\n}\n</code></pre>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#4-mapper","title":"4. \u4f7f\u7528 Mapper \u8fdb\u884c\u8f6c\u6362","text":""},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#spring","title":"\u65b9\u5f0f\u4e00\uff1aSpring \u4f9d\u8d56\u6ce8\u5165","text":"<pre><code>@Service\npublic class UserService {\n\n    @Autowired\n    private UserMapper userMapper; // \u81ea\u52a8\u6ce8\u5165\n\n    public UserDTO processUser(UserVO userVO) {\n        return userMapper.voToDto(userVO); // \u8f6c\u6362 VO\u2192DTO\n    }\n}\n</code></pre>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#spring_1","title":"\u65b9\u5f0f\u4e8c\uff1a\u76f4\u63a5\u4f7f\u7528\u5b9e\u4f8b\uff08\u975e Spring \u7ba1\u7406\uff09\uff08\u63a8\u8350\uff09","text":"<pre><code>UserVO vo = new UserVO(\"Tom\", 25, \"tom@example.com\");\nUserDTO dto = UserMapper.INSTANCE.voToDto(vo); // \u901a\u8fc7\u9759\u6001\u5b9e\u4f8b\u8f6c\u6362\n</code></pre>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#5","title":"5. \u9ad8\u7ea7\u529f\u80fd\u793a\u4f8b","text":"<p>\u6709\u65f6\uff0c\u5bf9\u8c61\u4e4b\u95f4\u7684\u6620\u5c04\u5e76\u4e0d\u662f\u7b80\u5355\u7684\u5b57\u6bb5\u62f7\u8d1d\uff0c\u53ef\u80fd\u9700\u8981\u8fdb\u884c\u4e00\u4e9b\u8f6c\u6362\u3002MapStruct\u5141\u8bb8\u5728\u6620\u5c04\u65b9\u6cd5\u4e2d\u8c03\u7528\u5176\u4ed6\u6620\u5c04\u65b9\u6cd5\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u8868\u8fbe\u5f0f\u3002</p>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#1_1","title":"(1) \u96c6\u5408\u6620\u5c04","text":"<p>\u81ea\u52a8\u6620\u5c04\u96c6\u5408\uff0cMapStruct\u4f1a\u81ea\u52a8\u751f\u6210\u5faa\u73af\u904d\u5386\u5e76\u8c03\u7528\u5355\u4e2a\u5bf9\u8c61\u6620\u5c04\u65b9\u6cd5\u7684\u4ee3\u7801\u3002</p> <pre><code>@Mapper(componentModel = \"spring\")\npublic interface UserMapper {\n    List&lt;UserDTO&gt; usersToUserDTOs(List&lt;User&gt; users); // \u81ea\u52a8\u904d\u5386\u8f6c\u6362\n}\n</code></pre>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#2_1","title":"(2) \u5ffd\u7565\u5b57\u6bb5","text":"<pre><code>@Mapping(target = \"id\", ignore = true) // \u5ffd\u7565id\u5b57\u6bb5\nUserDTO toDtoWithoutId(User user);\n</code></pre>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#3","title":"(3) \u8868\u8fbe\u5f0f\u8ba1\u7b97","text":"<p>\u4f7f\u7528<code>@Mapping</code>\u6ce8\u89e3\u7684<code>expression</code>\u5c5e\u6027\u53ef\u4ee5\u7f16\u5199\u8868\u8fbe\u5f0f\uff1a <pre><code>@Mapping(target = \"fullInfo\", \n         expression = \"java(user.getUsername() + \\\" (\\\" + user.getEmail() + \\\")\\\")\")\nUserDTO toDetailedDto(User user);\n</code></pre></p>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#4","title":"\uff084\uff09\u81ea\u5b9a\u4e49\u8f6c\u6362\u65b9\u6cd5","text":"<p>\u53ef\u4ee5\u5728\u6620\u5c04\u63a5\u53e3\u4e2d\u5b9a\u4e49\u9ed8\u8ba4\u65b9\u6cd5\u6765\u5b9e\u73b0\u81ea\u5b9a\u4e49\u8f6c\u6362\u903b\u8f91\uff1a</p> <pre><code>@Mapper(componentModel = \"spring\")\npublic interface UserMapper {\n\n    // ... \u5176\u4ed6\u6620\u5c04\n    default String someCustomMethod(SomeType value) {\n        // \u81ea\u5b9a\u4e49\u8f6c\u6362\u903b\u8f91\n        return value.toString();\n    }\n}\n</code></pre>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#5_1","title":"\uff085\uff09\u66f4\u65b0\u73b0\u6709\u5bf9\u8c61","text":"<p>\u6709\u65f6\u6211\u4eec\u5e0c\u671b\u66f4\u65b0\u4e00\u4e2a\u5df2\u5b58\u5728\u7684\u76ee\u6807\u5bf9\u8c61\uff0c\u800c\u4e0d\u662f\u521b\u5efa\u65b0\u7684\u5b9e\u4f8b\u3002\u53ef\u4ee5\u4f7f\u7528<code>@MappingTarget</code>\u6ce8\u89e3\u6765\u6807\u8bb0\u76ee\u6807\u5bf9\u8c61\uff1a</p> <pre><code>@Mapping(source = \"username\", target = \"name\")\n@Mapping(source = \"email\", target = \"emailAddress\")\nvoid updateUserDTOFromUser(User user, @MappingTarget UserDTO userDTO);\n</code></pre> <p>\u8fd9\u4e2a\u65b9\u6cd5\u5c06\u6839\u636e\u6e90\u5bf9\u8c61<code>User</code>\u66f4\u65b0\u5df2\u5b58\u5728\u7684<code>UserDTO</code>\u5bf9\u8c61\u3002</p>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#mapstruct","title":"\u4f7f\u7528mapstruct\u5b9e\u73b0\u591a\u4e2a\u53c2\u6570\u8f6c\u6362","text":"<p>\u5728MapStruct\u4e2d\uff0c\u5982\u679c\u9700\u8981\u5c06\u591a\u4e2a\u53c2\u6570\uff08\u4f8b\u5982\u4e24\u4e2a\u6216\u591a\u4e2a\u5bf9\u8c61\uff09\u5408\u5e76\u8f6c\u6362\u6210\u4e00\u4e2aDTO\u5bf9\u8c61\uff0c\u53ef\u4ee5\u901a\u8fc7\u5728Mapper\u63a5\u53e3\u4e2d\u5b9a\u4e49\u65b9\u6cd5\u6765\u5b9e\u73b0\u3002\u4ee5\u4e0b\u662f\u4e00\u4e2a\u793a\u4f8b\uff1a</p> <p>\u5047\u8bbe\u6211\u4eec\u6709\u4e24\u4e2a\u6e90\u5bf9\u8c61\uff1a<code>UserVO</code> \u548c <code>AddressVO</code>\uff0c\u9700\u8981\u5c06\u5b83\u4eec\u5408\u5e76\u6210\u4e00\u4e2a<code>UserDTO</code>\u5bf9\u8c61\u3002</p>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#1_2","title":"1. \u5b9a\u4e49\u6e90\u5bf9\u8c61\u548c\u76ee\u6807\u5bf9\u8c61","text":"<pre><code>// UserVO.java\npublic class UserVO {\n\n    private String username;\n    private Integer age;\n\n    // getters and setters\n\n}\n\n// AddressVO.java\n\npublic class AddressVO {\n\n    private String city;\n    private String street;\n\n    // getters and setters\n\n}\n\n// UserDTO.java\n\npublic class UserDTO {\n\n    private String name;\n    private int age;\n    private String city;\n    private String street;\n\n    // getters and setters\n\n}\n</code></pre>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#2-mapper","title":"2. \u521b\u5efaMapper\u63a5\u53e3","text":"<p>\u5728Mapper\u63a5\u53e3\u4e2d\uff0c\u5b9a\u4e49\u4e00\u4e2a\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u63a5\u53d7\u591a\u4e2a\u53c2\u6570\uff08\u8fd9\u91cc\u4e3a<code>UserVO</code>\u548c<code>AddressVO</code>\uff09\u5e76\u8fd4\u56de<code>UserDTO</code>\u3002</p> <pre><code>import org.mapstruct.Mapper;\nimport org.mapstruct.Mapping;\nimport org.mapstruct.Mappings;\nimport org.mapstruct.factory.Mappers;\n\n@Mapper(componentModel = \"spring\")\npublic interface UserMapper {\n\n    UserMapper INSTANCE = Mappers.getMapper(UserMapper.class);\n\n    @Mappings({\n        @Mapping(source = \"userVO.username\", target = \"name\"),\n        @Mapping(source = \"userVO.age\", target = \"age\"),\n        @Mapping(source = \"addressVO.city\", target = \"city\"),\n        @Mapping(source = \"addressVO.street\", target = \"street\")\n    })\n    UserDTO toUserDTO(UserVO userVO, AddressVO addressVO);\n\n}\n</code></pre>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#3-mapper","title":"3. \u4f7f\u7528Mapper","text":"<p>\u5728Service\u4e2d\uff0c\u4f60\u53ef\u4ee5\u6ce8\u5165\u8fd9\u4e2aMapper\uff08\u5982\u679c\u4f7f\u7528Spring\uff09\u6216\u8005\u4f7f\u7528\u9759\u6001\u5b9e\u4f8b\u6765\u8f6c\u6362\u3002</p> <pre><code>@Service\npublic class UserService {\n\n    @Autowired\n    private UserMapper userMapper; // \u4f7f\u7528Spring\u6ce8\u5165\n\n    public UserDTO getUserInfo(UserVO userVO, AddressVO addressVO) {\n\n        return userMapper.toUserDTO(userVO, addressVO);\n\n    }\n\n}\n</code></pre> <p>\u6216\u8005\u4e0d\u4f7f\u7528Spring\uff1a</p> <pre><code>UserVO userVO = new UserVO(\"Tom\", 25);\nAddressVO addressVO = new AddressVO(\"New York\", \"5th Avenue\");\nUserDTO dto = UserMapper.INSTANCE.toUserDTO(userVO, addressVO);\n</code></pre>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#4-null","title":"4. \u5904\u7406\u53c2\u6570\u4e3anull\u7684\u60c5\u51b5","text":"<p>MapStruct\u5728\u751f\u6210\u7684\u65b9\u6cd5\u4e2d\u4f1a\u68c0\u67e5\u6bcf\u4e2a\u6e90\u5bf9\u8c61\u662f\u5426\u4e3anull\u3002\u5982\u679c\u67d0\u4e2a\u6e90\u5bf9\u8c61\u4e3anull\uff0c\u90a3\u4e48\u8be5\u5bf9\u8c61\u5bf9\u5e94\u7684\u5c5e\u6027\u5728\u76ee\u6807\u5bf9\u8c61\u4e2d\u5c06\u88ab\u8bbe\u7f6e\u4e3anull\uff08\u6216\u9ed8\u8ba4\u503c\uff09\u3002\u5982\u679c\u4f60\u5e0c\u671b\u6709\u66f4\u4e25\u683c\u7684\u63a7\u5236\uff0c\u53ef\u4ee5\u5728\u65b9\u6cd5\u5185\u90e8\u8fdb\u884c\u975e\u7a7a\u68c0\u67e5\uff08\u4f8b\u5982\u5728\u81ea\u5b9a\u4e49\u65b9\u6cd5\u4e2d\uff09\uff0c\u6216\u8005\u4f7f\u7528MapStruct\u7684<code>@Context</code>\u53c2\u6570\u4f20\u9012\u4e0a\u4e0b\u6587\uff08\u4f46\u8fd9\u91cc\u4e0d\u9002\u7528\uff09\u3002</p>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#5_2","title":"5. \u81ea\u5b9a\u4e49\u8f6c\u6362\u903b\u8f91","text":"<p>\u5982\u679c\u8f6c\u6362\u8fc7\u7a0b\u4e2d\u9700\u8981\u4e00\u4e9b\u81ea\u5b9a\u4e49\u903b\u8f91\uff0c\u53ef\u4ee5\u5728Mapper\u63a5\u53e3\u4e2d\u5b9a\u4e49\u9ed8\u8ba4\u65b9\u6cd5\u6216\u8005\u4f7f\u7528<code>@AfterMapping</code>\u6ce8\u89e3\u3002</p>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#_1","title":"\u4f7f\u7528\u9ed8\u8ba4\u65b9\u6cd5","text":"<pre><code>@Mapper(componentModel = \"spring\")\npublic interface UserMapper {\n\n    default UserDTO toUserDTO(UserVO userVO, AddressVO addressVO) {\n\n        if (userVO == null &amp;&amp; addressVO == null) {\n            return null;\n        }\n        UserDTO userDTO = new UserDTO();\n        if (userVO != null) {\n            userDTO.setName(userVO.getUsername());\n            userDTO.setAge(userVO.getAge());\n        }\n        if (addressVO != null) {\n            userDTO.setCity(addressVO.getCity());\n            userDTO.setStreet(addressVO.getStreet());\n        }\n        return userDTO;\n\n    }\n\n}\n</code></pre>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#aftermapping","title":"\u4f7f\u7528@AfterMapping","text":"<p>\u5982\u679c\u4f60\u5e0c\u671b\u90e8\u5206\u4f7f\u7528MapStruct\u7684\u81ea\u52a8\u6620\u5c04\uff0c\u90e8\u5206\u81ea\u5b9a\u4e49\uff0c\u53ef\u4ee5\u7ed3\u5408\u4f7f\u7528<code>@MappingTarget</code>\u548c<code>@AfterMapping</code>\u3002</p> <pre><code>import org.mapstruct.AfterMapping;\nimport org.mapstruct.Mapper;\nimport org.mapstruct.Mapping;\nimport org.mapstruct.MappingTarget;\nimport org.mapstruct.Mappings;\nimport org.mapstruct.factory.Mappers;\n\n@Mapper(componentModel = \"spring\")\npublic abstract class UserMapper {\n\n    public abstract UserDTO toUserDTO(UserVO userVO, AddressVO addressVO);\n\n    @AfterMapping\n    protected void afterMapping(UserVO userVO, AddressVO addressVO, @MappingTarget UserDTO userDTO) {\n        // \u53ef\u4ee5\u5728\u8fd9\u91cc\u6dfb\u52a0\u4e00\u4e9b\u989d\u5916\u7684\u8bbe\u7f6e\n        if (userVO != null &amp;&amp; addressVO != null) {\n            userDTO.setFullAddress(addressVO.getCity() + \", \" + addressVO.getStreet());\n        }\n\n    }\n\n}\n</code></pre> <p>\u6ce8\u610f\uff1a\u4f7f\u7528<code>@AfterMapping</code>\u65f6\uff0cMapper\u7c7b\u5fc5\u987b\u662f\u62bd\u8c61\u7c7b\uff08<code>abstract class</code>\uff09\uff0c\u56e0\u4e3aMapStruct\u4f1a\u751f\u6210\u5176\u5b50\u7c7b\u3002</p>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#6","title":"6. \u591a\u4e2a\u6e90\u5bf9\u8c61\u4e2d\u5b57\u6bb5\u540d\u51b2\u7a81","text":"<p>\u5982\u679c\u591a\u4e2a\u6e90\u5bf9\u8c61\u4e2d\u6709\u76f8\u540c\u540d\u79f0\u7684\u5c5e\u6027\uff08\u6bd4\u5982\u4e24\u4e2a\u5bf9\u8c61\u90fd\u6709<code>id</code>\uff09\uff0c\u90a3\u4e48\u5728\u6620\u5c04\u5230\u76ee\u6807\u5bf9\u8c61\u65f6\uff0c\u9700\u8981\u901a\u8fc7<code>@Mapping</code>\u6ce8\u89e3\u660e\u786e\u6307\u5b9a\u6765\u6e90\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>@Mappings({\n    @Mapping(source = \"userVO.id\", target = \"userId\"),\n    @Mapping(source = \"addressVO.id\", target = \"addressId\")\n})\nUserDTO toUserDTO(UserVO userVO, AddressVO addressVO);\n</code></pre>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#7","title":"7. \u603b\u7ed3","text":"<p>\u901a\u8fc7\u4e0a\u8ff0\u65b9\u6cd5\uff0cMapStruct\u53ef\u4ee5\u8f7b\u677e\u5904\u7406\u591a\u4e2a\u6e90\u5bf9\u8c61\u8f6c\u6362\u6210\u4e00\u4e2a\u76ee\u6807\u5bf9\u8c61\u7684\u60c5\u51b5\u3002\u4f60\u53ea\u9700\u8981\u5728Mapper\u63a5\u53e3\u4e2d\u5b9a\u4e49\u5bf9\u5e94\u7684\u65b9\u6cd5\uff0c\u5e76\u4f7f\u7528<code>@Mapping</code>\u6ce8\u89e3\u6307\u5b9a\u6bcf\u4e2a\u5b57\u6bb5\u7684\u6765\u6e90\uff08\u6ce8\u610f\u8981\u6307\u5b9a\u662f\u54ea\u4e2a\u53c2\u6570\u7684\u5c5e\u6027\uff09\u3002\u5982\u679c\u8f6c\u6362\u903b\u8f91\u590d\u6742\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528\u81ea\u5b9a\u4e49\u65b9\u6cd5\u6216<code>@AfterMapping</code>\u6ce8\u89e3\u8fdb\u884c\u8865\u5145\u3002</p>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#6_1","title":"6. \u7f16\u8bd1\u9879\u76ee","text":"<p>\u5b8c\u6210\u4e0a\u8ff0\u6b65\u9aa4\u540e\uff0c\u7f16\u8bd1\u9879\u76ee\uff08\u5982\u6267\u884c<code>mvn clean compile</code>\uff09\uff0cMapStruct\u4f1a\u5728<code>target/generated-sources/annotations</code>\u76ee\u5f55\u4e0b\u751f\u6210\u6620\u5c04\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b\u3002</p>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#7_1","title":"7. \u5e38\u89c1\u95ee\u9898\u89e3\u51b3","text":""},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#mapper","title":"\u274c \u95ee\u9898\uff1a\u7f16\u8bd1\u540e\u627e\u4e0d\u5230Mapper\u5b9e\u73b0\u7c7b","text":"<ul> <li>\u539f\u56e0\uff1a\u6ce8\u89e3\u5904\u7406\u5668\u672a\u6b63\u786e\u914d\u7f6e\u3002</li> <li>\u89e3\u51b3\uff1a</li> <li>\u68c0\u67e5<code>pom.xml</code>\u4e2d\u7684<code>mapstruct-processor</code>\u4f9d\u8d56\u3002</li> <li>\u6267\u884cMaven\u547d\u4ee4\uff1a<code>mvn clean compile</code>\uff08\u5b9e\u73b0\u7c7b\u4f1a\u5728<code>target/generated-sources/annotations/</code>\u4e0b\u751f\u6210\uff09\u3002</li> </ul>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#lombokmapstruct","title":"\u274c \u95ee\u9898\uff1aLombok\u548cMapStruct\u51b2\u7a81","text":"<ul> <li>\u73b0\u8c61\uff1a\u7f16\u8bd1\u65f6\u5b57\u6bb5\u4e3a<code>null</code>\u3002</li> <li>\u89e3\u51b3\uff1a</li> <li>\u786e\u4fdd\u6ce8\u89e3\u5904\u7406\u5668\u987a\u5e8f\uff1aLombok\u5728\u524d\uff0cMapStruct\u5728\u540e\u3002</li> <li>\u5728IDE\u4e2d\u542f\u7528\u6ce8\u89e3\u5904\u7406\uff08IntelliJ\uff1a<code>Settings &gt; Build &gt; Compiler &gt; Annotation Processors</code>\uff09\u3002</li> </ul>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#8","title":"8. \u6700\u4f73\u5b9e\u8df5","text":"<ol> <li>\u4fdd\u6301Mapper\u5355\u4e00\u804c\u8d23\uff1a\u6bcf\u4e2aMapper\u53ea\u5904\u7406\u4e00\u7ec4\u76f8\u5173\u5bf9\u8c61\u7684\u8f6c\u6362\u3002</li> <li>\u5355\u5143\u6d4b\u8bd5\uff1a\u4e3aMapper\u7f16\u5199\u6d4b\u8bd5\u9a8c\u8bc1\u8f6c\u6362\u903b\u8f91\u3002</li> <li>\u4f7f\u7528<code>componentModel = \"spring\"</code>\uff1a\u65b9\u4fbf\u4f9d\u8d56\u6ce8\u5165\u3002</li> <li>\u590d\u6742\u903b\u8f91\u62c6\u5206\uff1a\u5c06\u81ea\u5b9a\u4e49\u65b9\u6cd5\u63d0\u53d6\u5230\u5de5\u5177\u7c7b\u4e2d\u3002</li> </ol>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#mapstruct_1","title":"mapstruct\u539f\u7406\u89e3\u6790","text":"<p>MapStruct \u662f\u4e00\u4e2a\u57fa\u4e8e\u6ce8\u89e3\u7684 Java \u5bf9\u8c61\u6620\u5c04\u6846\u67b6\uff0c\u5b83\u901a\u8fc7\u5728\u7f16\u8bd1\u65f6\u751f\u6210\u6620\u5c04\u5b9e\u73b0\u7c7b\uff0c\u907f\u514d\u4e86\u8fd0\u884c\u65f6\u7684\u53cd\u5c04\u5f00\u9500\uff0c\u4ece\u800c\u63d0\u4f9b\u4e86\u9ad8\u6027\u80fd\u7684\u5bf9\u8c61\u8f6c\u6362\u3002\u4e0b\u9762\u6211\u4eec\u6765\u8be6\u7ec6\u89e3\u6790 MapStruct \u7684\u5de5\u4f5c\u539f\u7406\u3002</p>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#_2","title":"\u6838\u5fc3\u539f\u7406","text":"<p>MapStruct \u7684\u6838\u5fc3\u601d\u60f3\u662f\uff1a\u5728\u7f16\u8bd1\u9636\u6bb5\u901a\u8fc7\u6ce8\u89e3\u5904\u7406\u5668\uff08Annotation Processor\uff09\u751f\u6210\u6620\u5c04\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b\u3002\u8fd9\u4e9b\u5b9e\u73b0\u7c7b\u5305\u542b\u4e86\u5177\u4f53\u7684\u5b57\u6bb5\u8d4b\u503c\u4ee3\u7801\uff0c\u56e0\u6b64\u8fd0\u884c\u671f\u95f4\u76f4\u63a5\u8c03\u7528\u8fd9\u4e9b\u5b9e\u73b0\u7c7b\uff0c\u65e0\u9700\u53cd\u5c04\uff0c\u6548\u7387\u6781\u9ad8\u3002</p>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#_3","title":"\u5de5\u4f5c\u6d41\u7a0b","text":"<ol> <li>\u5b9a\u4e49\u6620\u5c04\u63a5\u53e3\uff1a</li> </ol> <p>\u5f00\u53d1\u8005\u5b9a\u4e49\u4e00\u4e2a\u63a5\u53e3\uff0c\u5e76\u4f7f\u7528 MapStruct \u63d0\u4f9b\u7684\u6ce8\u89e3\uff08\u5982 <code>@Mapper</code>\u3001<code>@Mapping</code> \u7b49\uff09\u6765\u63cf\u8ff0\u5bf9\u8c61\u4e4b\u95f4\u7684\u6620\u5c04\u89c4\u5219\u3002</p> <ol> <li>\u7f16\u8bd1\u65f6\u5904\u7406\uff1a</li> </ol> <p>\u5728\u7f16\u8bd1\u9636\u6bb5\uff0cMapStruct \u7684\u6ce8\u89e3\u5904\u7406\u5668\u4f1a\u626b\u63cf\u6240\u6709\u5e26\u6709 <code>@Mapper</code> \u6ce8\u89e3\u7684\u63a5\u53e3\uff0c\u5e76\u6839\u636e\u6ce8\u89e3\u4fe1\u606f\u751f\u6210\u8be5\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b\u3002\u751f\u6210\u7684\u7c7b\u4f4d\u4e8e\u9879\u76ee\u7684 <code>target/generated-sources/annotations</code> \u76ee\u5f55\uff08Maven \u9879\u76ee\uff09\u4e2d\u3002</p> <ol> <li>\u751f\u6210\u5b9e\u73b0\u7c7b\uff1a</li> </ol> <p>\u751f\u6210\u7684\u5b9e\u73b0\u7c7b\u4e2d\uff0c\u6bcf\u4e2a\u6620\u5c04\u65b9\u6cd5\u90fd\u662f\u5177\u4f53\u7684 Java \u4ee3\u7801\uff0c\u4f8b\u5982\uff1a</p> <pre><code>public class UserMapperImpl implements UserMapper {\n\n@Override\n\npublic UserDTO userToUserDTO(User user) {\n\nif (user == null) {\n\nreturn null;\n\n}\n\nUserDTO userDTO = new UserDTO();\n\nuserDTO.setLogin(user.getUsername());\n\nuserDTO.setContactEmail(user.getEmail());\n\n// \u5176\u4ed6\u5b57\u6bb5\u8f6c\u6362\n\nreturn userDTO;\n\n}\n\n}\n</code></pre> <ol> <li>\u8fd0\u884c\u65f6\u4f7f\u7528\uff1a</li> </ol> <p>\u5728\u8fd0\u884c\u65f6\uff0c\u5f00\u53d1\u8005\u53ea\u9700\u8981\u901a\u8fc7\u4f9d\u8d56\u6ce8\u5165\uff08\u5982 Spring \u7684 <code>@Autowired</code>\uff09\u6216\u8005\u76f4\u63a5\u5b9e\u4f8b\u5316 Mapper \u63a5\u53e3\uff0c\u8c03\u7528\u5176\u65b9\u6cd5\u5373\u53ef\u5b8c\u6210\u5bf9\u8c61\u8f6c\u6362\u3002\u7531\u4e8e\u5b9e\u73b0\u7c7b\u662f\u76f4\u63a5\u64cd\u4f5c\u5b57\u6bb5\u7684\uff0c\u6ca1\u6709\u53cd\u5c04\uff0c\u6240\u4ee5\u6027\u80fd\u63a5\u8fd1\u624b\u5199\u4ee3\u7801\u3002</p>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#_4","title":"\u5173\u952e\u6ce8\u89e3\u89e3\u6790","text":"<ul> <li> <p><code>@Mapper</code>\uff1a\u6807\u8bb0\u4e00\u4e2a\u63a5\u53e3\u4e3a\u6620\u5c04\u5668\u63a5\u53e3\u3002\u4e3b\u8981\u5c5e\u6027\uff1a</p> <ul> <li> <p><code>componentModel</code>\uff1a\u6307\u5b9a\u751f\u6210\u7684 Mapper \u5b9e\u73b0\u7c7b\u7684\u7ec4\u4ef6\u6a21\u578b\u3002\u5e38\u7528\u503c\u6709\uff1a</p> </li> <li> <p><code>default</code>\uff1a\u4e0d\u751f\u6210\u7ec4\u4ef6\uff0c\u9700\u624b\u52a8\u5b9e\u4f8b\u5316\u3002</p> </li> <li> <p><code>spring</code>\uff1a\u751f\u6210\u7684\u5b9e\u73b0\u7c7b\u5e26\u6709 <code>@Component</code> \u6ce8\u89e3\uff0c\u53ef\u88ab Spring \u5bb9\u5668\u7ba1\u7406\u3002</p> </li> <li> <p><code>cdi</code>\uff1a\u4f7f\u7528 CDI\uff08Contexts and Dependency Injection\uff09\u3002</p> </li> <li> <p><code>jsr330</code>\uff1a\u4f7f\u7528 JSR-330 \u89c4\u8303\uff08\u5982 <code>@Named</code>\uff09\u3002</p> </li> </ul> </li> <li> <p><code>@Mapping</code>\uff1a\u7528\u4e8e\u65b9\u6cd5\u6216\u65b9\u6cd5\u53c2\u6570\u4e0a\uff0c\u6307\u5b9a\u5b57\u6bb5\u6620\u5c04\u89c4\u5219\u3002\u4e3b\u8981\u5c5e\u6027\uff1a</p> <ul> <li> <p><code>source</code>\uff1a\u6e90\u5bf9\u8c61\u7684\u5b57\u6bb5\u540d\u3002</p> </li> <li> <p><code>target</code>\uff1a\u76ee\u6807\u5bf9\u8c61\u7684\u5b57\u6bb5\u540d\u3002</p> </li> <li> <p><code>ignore</code>\uff1a\u662f\u5426\u5ffd\u7565\u8be5\u5b57\u6bb5\uff08\u9ed8\u8ba4 <code>false</code>\uff09\u3002</p> </li> <li> <p><code>expression</code>\uff1a\u4f7f\u7528\u8868\u8fbe\u5f0f\u8fdb\u884c\u8d4b\u503c\uff08\u5982 <code>java(...)</code>\uff09\u3002</p> </li> <li> <p><code>qualifiedByName</code>\uff1a\u6307\u5b9a\u81ea\u5b9a\u4e49\u65b9\u6cd5\uff08\u901a\u8fc7 <code>@Named</code> \u6807\u8bb0\uff09\u8fdb\u884c\u8f6c\u6362\u3002</p> </li> <li> <p><code>dateFormat</code>\uff1a\u65e5\u671f\u683c\u5f0f\u8f6c\u6362\uff08\u5b57\u7b26\u4e32\u4e0e\u65e5\u671f\u4e4b\u95f4\uff09\u3002</p> </li> </ul> </li> <li> <p><code>@Mappings</code>\uff1a\u5f53\u9700\u8981\u591a\u4e2a <code>@Mapping</code> \u65f6\uff0c\u53ef\u7528 <code>@Mappings</code> \u5305\u88f9\uff08Java 8+ \u53ef\u4f7f\u7528\u91cd\u590d\u6ce8\u89e3\uff09\u3002</p> </li> <li> <p><code>@Named</code>\uff1a \u6807\u8bb0\u4e00\u4e2a\u81ea\u5b9a\u4e49\u65b9\u6cd5\uff0c\u7136\u540e\u901a\u8fc7 <code>qualifiedByName</code> \u5f15\u7528\u3002</p> </li> <li> <p><code>@AfterMapping</code> \u548c <code>@BeforeMapping</code>\uff1a\u5728\u6620\u5c04\u524d\u540e\u6267\u884c\u81ea\u5b9a\u4e49\u65b9\u6cd5\u3002</p> </li> </ul>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#_5","title":"\u6620\u5c04\u89c4\u5219","text":"<ol> <li>\u81ea\u52a8\u6620\u5c04\uff1a</li> </ol> <p>\u5982\u679c\u6e90\u5bf9\u8c61\u548c\u76ee\u6807\u5bf9\u8c61\u7684\u5b57\u6bb5\u540d\u76f8\u540c\uff0cMapStruct \u4f1a\u81ea\u52a8\u6620\u5c04\uff0c\u65e0\u9700\u989d\u5916\u914d\u7f6e\u3002</p> <ol> <li> <p>\u7c7b\u578b\u8f6c\u6362\uff1a</p> </li> <li> <p>\u57fa\u672c\u7c7b\u578b\u548c\u5305\u88c5\u7c7b\u578b\u81ea\u52a8\u8f6c\u6362\u3002</p> </li> <li> <p>\u81ea\u52a8\u8fdb\u884c\u88c5\u7bb1\u548c\u62c6\u7bb1\u3002</p> </li> <li> <p>\u7b80\u5355\u7c7b\u578b\u8f6c\u6362\uff08\u5982 <code>int</code> \u8f6c <code>String</code>\uff09\u4f1a\u8c03\u7528\u76f8\u5e94\u7684\u8f6c\u6362\u65b9\u6cd5\uff08\u5982 <code>String.valueOf()</code>\uff09\u3002</p> </li> <li> <p>\u65e5\u671f\u548c\u5b57\u7b26\u4e32\u4e4b\u95f4\u53ef\u901a\u8fc7 <code>dateFormat</code> \u5c5e\u6027\u8f6c\u6362\u3002</p> </li> <li> <p>\u5d4c\u5957\u5bf9\u8c61\u6620\u5c04\uff1a</p> </li> </ol> <p>\u5982\u679c\u5bf9\u8c61\u4e2d\u5305\u542b\u5176\u4ed6\u5bf9\u8c61\uff0cMapStruct \u4f1a\u5c1d\u8bd5\u81ea\u52a8\u5bfb\u627e\u5bf9\u5e94\u7684\u6620\u5c04\u65b9\u6cd5\uff08\u5728\u540c\u4e00\u4e2a Mapper \u6216\u5176\u4ed6 Mapper \u4e2d\uff09\u3002</p> <ol> <li>\u96c6\u5408\u6620\u5c04\uff1a</li> </ol> <p>\u652f\u6301 <code>List</code>\u3001<code>Set</code>\u3001<code>Map</code> \u7b49\u96c6\u5408\u7c7b\u578b\uff0c\u4f1a\u81ea\u52a8\u904d\u5386\u5e76\u8f6c\u6362\u6bcf\u4e2a\u5143\u7d20\u3002</p>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#_6","title":"\u81ea\u5b9a\u4e49\u6620\u5c04\u65b9\u6cd5","text":"<ol> <li>\u5728 Mapper \u63a5\u53e3\u4e2d\u5b9a\u4e49\u9ed8\u8ba4\u65b9\u6cd5\uff1a</li> </ol> <pre><code>@Mapper\n\npublic interface CarMapper {\n\ndefault PersonDTO personToPersonDTO(Person person) {\n\n// \u81ea\u5b9a\u4e49\u8f6c\u6362\u903b\u8f91\n\n}\n\n}\n</code></pre> <ol> <li>\u5f15\u7528\u5176\u4ed6 Mapper\uff1a</li> </ol> <pre><code>@Mapper(uses = { AddressMapper.class })\n\npublic interface UserMapper {\n\n// \u4f1a\u81ea\u52a8\u4f7f\u7528 AddressMapper \u8f6c\u6362 Address \u5b57\u6bb5\n\n}\n</code></pre>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#_7","title":"\u4e3a\u4ec0\u4e48\u9ad8\u6027\u80fd\uff1f","text":"<ul> <li> <p>\u7f16\u8bd1\u65f6\u751f\u6210\u4ee3\u7801\uff1a\u907f\u514d\u4e86\u8fd0\u884c\u65f6\u7684\u53cd\u5c04\uff0c\u76f4\u63a5\u8c03\u7528 setter/getter \u65b9\u6cd5\u3002</p> </li> <li> <p>\u65e0\u989d\u5916\u4f9d\u8d56\uff1a\u751f\u6210\u7684\u4ee3\u7801\u662f\u7eaf Java\uff0c\u4e0d\u4f9d\u8d56\u4efb\u4f55\u7b2c\u4e09\u65b9\u5e93\u3002</p> </li> <li> <p>\u53ef\u8bfb\u6027\u5f3a\uff1a\u751f\u6210\u7684\u4ee3\u7801\u7c7b\u4f3c\u4e8e\u624b\u5199\u4ee3\u7801\uff0c\u4fbf\u4e8e\u8c03\u8bd5\u3002</p> </li> </ul>"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#_8","title":"\u4e0e\u5176\u5b83\u6620\u5c04\u6846\u67b6\u5bf9\u6bd4","text":"\u7279\u6027 MapStruct ModelMapper Orika Dozer \u539f\u7406 \u7f16\u8bd1\u65f6\u4ee3\u7801\u751f\u6210 \u8fd0\u884c\u65f6\u53cd\u5c04 \u8fd0\u884c\u65f6\u5b57\u8282\u7801\u751f\u6210 \u8fd0\u884c\u65f6\u53cd\u5c04 \u6027\u80fd \u2b50\u2b50\u2b50\u2b50\u2b50 \u2b50\u2b50 \u2b50\u2b50\u2b50\u2b50 \u2b50\u2b50 \u914d\u7f6e\u65b9\u5f0f \u6ce8\u89e3/\u63a5\u53e3 API/\u914d\u7f6e\u6587\u4ef6 API/\u6ce8\u89e3 XML/\u6ce8\u89e3 \u5b66\u4e60\u66f2\u7ebf \u4f4e \u4f4e \u4e2d \u4e2d \u652f\u6301\u590d\u6742\u6620\u5c04 \u5f3a \u4e00\u822c \u5f3a \u5f3a \u7f16\u8bd1\u65f6\u9519\u8bef\u68c0\u67e5 \u6709 \u65e0 \u65e0 \u65e0"},{"location":"springboot/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8MapStruct%E6%95%99%E7%A8%8B/#9","title":"9. \u603b\u7ed3","text":"<p>MapStruct \u901a\u8fc7\u7f16\u8bd1\u65f6\u751f\u6210\u6620\u5c04\u5b9e\u73b0\u7c7b\uff0c\u65e2\u4fdd\u8bc1\u4e86\u9ad8\u6027\u80fd\uff0c\u53c8\u63d0\u4f9b\u4e86\u7075\u6d3b\u7684\u914d\u7f6e\u65b9\u5f0f\uff08\u6ce8\u89e3\uff09\u3002\u5b83\u7684\u8bbe\u8ba1\u54f2\u5b66\u662f\u201c\u7ea6\u5b9a\u4f18\u4e8e\u914d\u7f6e\u201d\uff0c\u5927\u90e8\u5206\u7b80\u5355\u6620\u5c04\u53ef\u4ee5\u96f6\u914d\u7f6e\u5b8c\u6210\uff0c\u590d\u6742\u6620\u5c04\u5219\u901a\u8fc7\u6ce8\u89e3\u7cbe\u786e\u63a7\u5236\u3002\u5728 Spring Boot \u9879\u76ee\u4e2d\uff0c\u7ed3\u5408 <code>componentModel = \"spring\"</code>\uff0c\u53ef\u4ee5\u65e0\u7f1d\u96c6\u6210\u5230 Spring \u5bb9\u5668\u4e2d\uff0c\u5927\u5927\u7b80\u5316\u4e86\u5bf9\u8c61\u8f6c\u6362\u7684\u4ee3\u7801\u3002</p> <p>\u56e0\u6b64\uff0c\u5bf9\u4e8e\u6027\u80fd\u654f\u611f\u6216\u5927\u578b\u9879\u76ee\uff0cMapStruct \u662f\u4e00\u4e2a\u975e\u5e38\u4f18\u79c0\u7684\u5bf9\u8c61\u6620\u5c04\u5de5\u5177\u3002</p> <p>\u5728Spring Boot\u4e2d\u4f7f\u7528MapStruct\u7684\u6b65\u9aa4\uff1a</p> <ol> <li> <p>\u6dfb\u52a0\u4f9d\u8d56\u548c\u6ce8\u89e3\u5904\u7406\u5668\u3002</p> </li> <li> <p>\u5b9a\u4e49\u6620\u5c04\u63a5\u53e3\uff0c\u4f7f\u7528<code>@Mapper(componentModel = \"spring\")</code>\u3002</p> </li> <li> <p>\u5728\u63a5\u53e3\u4e2d\u5b9a\u4e49\u6620\u5c04\u65b9\u6cd5\uff0c\u4f7f\u7528<code>@Mapping</code>\u6ce8\u89e3\u914d\u7f6e\u5b57\u6bb5\u6620\u5c04\u3002</p> </li> <li> <p>\u5728\u9700\u8981\u7684\u5730\u65b9\u6ce8\u5165\u6620\u5c04\u5668\u5e76\u8c03\u7528\u6620\u5c04\u65b9\u6cd5\u3002</p> </li> </ol> <p>MapStruct\u5927\u5927\u7b80\u5316\u4e86\u5bf9\u8c61\u4e4b\u95f4\u7684\u8f6c\u6362\u4ee3\u7801\uff0c\u5e76\u4e14\u56e0\u4e3a\u662f\u5728\u7f16\u8bd1\u65f6\u751f\u6210\u4ee3\u7801\uff0c\u6240\u4ee5\u6ca1\u6709\u53cd\u5c04\u5e26\u6765\u7684\u6027\u80fd\u635f\u5931\u3002 \u901a\u8fc7\u4ee5\u4e0a\u6b65\u9aa4\uff0c\u4f60\u53ef\u4ee5\u5728Spring Boot\u4e2d\u9ad8\u6548\u4f7f\u7528MapStruct\u5b9e\u73b0\u5bf9\u8c61\u8f6c\u6362\uff0c\u51cf\u5c11\u624b\u52a8\u7f16\u7801\u5e76\u63d0\u5347\u53ef\u7ef4\u62a4\u6027\u3002</p>"},{"location":"springboot/springboot%E9%A1%B9%E7%9B%AE%E4%B8%AD%20PO%20BO%20VO%20DTO%20POJO%20DAO%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%85%B6%E4%BD%9C%E7%94%A8%EF%BC%88%E9%99%84%E8%BD%AC%E6%8D%A2%E5%9B%BE%EF%BC%89/","title":"springboot\u9879\u76ee\u4e2d PO BO VO DTO POJO DAO\u6982\u5ff5\u53ca\u5176\u4f5c\u7528\uff08\u9644\u8f6c\u6362\u56fe\uff09","text":"<p>\u4e0b\u9762\u8be6\u7ec6\u89e3\u91caSpring Boot\u9879\u76ee\u4e2d\u5e38\u89c1\u7684\u5bf9\u8c61\u7c7b\u578b\uff1aPO\u3001BO\u3001VO\u3001DTO\u3001POJO\u3001DAO\uff0c\u5e76\u8bf4\u660e\u5b83\u4eec\u5728\u5206\u5c42\u67b6\u6784\u4e2d\u7684\u4f4d\u7f6e\u3002</p>"},{"location":"springboot/springboot%E9%A1%B9%E7%9B%AE%E4%B8%AD%20PO%20BO%20VO%20DTO%20POJO%20DAO%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%85%B6%E4%BD%9C%E7%94%A8%EF%BC%88%E9%99%84%E8%BD%AC%E6%8D%A2%E5%9B%BE%EF%BC%89/#spring-boot","title":"Spring Boot \u9879\u76ee\u4e2d\u5e38\u89c1\u5bf9\u8c61\u7c7b\u578b\u8be6\u89e3","text":""},{"location":"springboot/springboot%E9%A1%B9%E7%9B%AE%E4%B8%AD%20PO%20BO%20VO%20DTO%20POJO%20DAO%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%85%B6%E4%BD%9C%E7%94%A8%EF%BC%88%E9%99%84%E8%BD%AC%E6%8D%A2%E5%9B%BE%EF%BC%89/#1-po-persistent-object","title":"1. PO (Persistent Object) \u6301\u4e45\u5316\u5bf9\u8c61","text":"<ul> <li>\u5b9a\u4e49\uff1a\u4e0e\u6570\u636e\u5e93\u8868\u7ed3\u6784\u4e00\u4e00\u5bf9\u5e94\u7684 Java \u5bf9\u8c61</li> <li>\u7279\u5f81\uff1a</li> <li>\u6bcf\u4e2a\u5c5e\u6027\u5bf9\u5e94\u6570\u636e\u5e93\u8868\u7684\u4e00\u4e2a\u5b57\u6bb5</li> <li>\u901a\u5e38\u5305\u542b ORM \u6846\u67b6\u6ce8\u89e3\uff08\u5982 <code>@Table</code>, <code>@Column</code>\uff09</li> <li>\u4f5c\u7528\uff1a\u4f5c\u4e3a ORM \u6846\u67b6\u64cd\u4f5c\u6570\u636e\u5e93\u7684\u8f7d\u4f53</li> <li>\u4f4d\u7f6e\uff1a\u4f4d\u4e8e<code>infrastructure</code>\u5c42\uff08\u56e0\u4e3a\u4e0e\u6570\u636e\u5e93\u76f4\u63a5\u76f8\u5173\uff09\u3002   (e.g., <code>UserEntity.java</code>)</li> </ul>"},{"location":"springboot/springboot%E9%A1%B9%E7%9B%AE%E4%B8%AD%20PO%20BO%20VO%20DTO%20POJO%20DAO%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%85%B6%E4%BD%9C%E7%94%A8%EF%BC%88%E9%99%84%E8%BD%AC%E6%8D%A2%E5%9B%BE%EF%BC%89/#2-dao-data-access-object","title":"2. DAO (Data Access Object) \u6570\u636e\u8bbf\u95ee\u5bf9\u8c61","text":"<ul> <li>\u5b9a\u4e49\uff1a\u5c01\u88c5\u6570\u636e\u5e93\u8bbf\u95ee\u64cd\u4f5c\u7684\u5bf9\u8c61</li> <li>\u7279\u5f81\uff1a</li> <li>\u5305\u542b CRUD \u64cd\u4f5c\u65b9\u6cd5</li> <li>\u9694\u79bb\u6570\u636e\u5e93\u64cd\u4f5c\u7ec6\u8282</li> <li>\u4f5c\u7528\uff1a\u63d0\u4f9b\u7edf\u4e00\u7684\u6570\u636e\u8bbf\u95ee\u63a5\u53e3</li> <li>\u4f4d\u7f6e\uff1a\u4f4d\u4e8e<code>infrastructure</code>\u5c42\uff08\u56e0\u4e3a\u76f4\u63a5\u64cd\u4f5c\u6570\u636e\u5e93\uff09\u3002   (e.g., <code>UserRepositoryImpl.java</code>, <code>UserMapper.java</code>)</li> </ul>"},{"location":"springboot/springboot%E9%A1%B9%E7%9B%AE%E4%B8%AD%20PO%20BO%20VO%20DTO%20POJO%20DAO%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%85%B6%E4%BD%9C%E7%94%A8%EF%BC%88%E9%99%84%E8%BD%AC%E6%8D%A2%E5%9B%BE%EF%BC%89/#3-dto-data-transfer-object","title":"3. DTO (Data Transfer Object) \u6570\u636e\u4f20\u8f93\u5bf9\u8c61","text":"<ul> <li>\u5b9a\u4e49\uff1a\u8de8\u5c42/\u8de8\u7cfb\u7edf\u4f20\u8f93\u6570\u636e\u7684\u5bf9\u8c61</li> <li>\u7279\u5f81\uff1a</li> <li>\u6241\u5e73\u5316\u7ed3\u6784\uff0c\u65e0\u4e1a\u52a1\u903b\u8f91</li> <li>\u901a\u5e38\u5b9e\u73b0\u5e8f\u5217\u5316\u63a5\u53e3</li> <li>\u4f5c\u7528\uff1a\u51cf\u5c11\u7f51\u7edc\u4f20\u8f93\u6b21\u6570\uff0c\u89e3\u8026\u63a5\u53e3</li> <li>\u4f4d\u7f6e\uff1a</li> <li>\u901a\u7528DTO\uff08\u5982\u5206\u9875\u8bf7\u6c42/\u54cd\u5e94\uff09\u653e\u5728<code>common-dto</code>\u6a21\u5757\u3002</li> <li>\u5404\u5c42\u7279\u6709\u7684DTO\u653e\u5728\u5404\u81ea\u6a21\u5757\uff1a</li> <li>Web\u5c42\uff1a\u63a5\u6536\u524d\u7aef\u8bf7\u6c42\u7684DTO\uff08\u5982<code>UserCreateRequest</code>\uff09\u548c\u8fd4\u56de\u7ed9\u524d\u7aef\u7684\u54cd\u5e94DTO\uff08\u5982<code>UserResponse</code>\uff09\u653e\u5728<code>web</code>\u6a21\u5757\u3002</li> <li>Facade\u5c42\uff1a\u5bf9\u5916\u66b4\u9732\u7684\u63a5\u53e3\u4f7f\u7528\u7684DTO\u653e\u5728<code>facade</code>\u6a21\u5757\u3002</li> </ul>"},{"location":"springboot/springboot%E9%A1%B9%E7%9B%AE%E4%B8%AD%20PO%20BO%20VO%20DTO%20POJO%20DAO%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%85%B6%E4%BD%9C%E7%94%A8%EF%BC%88%E9%99%84%E8%BD%AC%E6%8D%A2%E5%9B%BE%EF%BC%89/#4-bo-business-object","title":"4. BO (Business Object) \u4e1a\u52a1\u5bf9\u8c61","text":"<ul> <li>\u5b9a\u4e49\uff1a\u5305\u542b\u4e1a\u52a1\u903b\u8f91\u7684\u9886\u57df\u6838\u5fc3\u5bf9\u8c61</li> <li>\u7279\u5f81\uff1a</li> <li>\u805a\u5408\u591a\u4e2a PO \u6216\u503c\u5bf9\u8c61</li> <li>\u5305\u542b\u4e1a\u52a1\u65b9\u6cd5\u548c\u9886\u57df\u89c4\u5219</li> <li>\u4f5c\u7528\uff1a\u5c01\u88c5\u6838\u5fc3\u4e1a\u52a1\u903b\u8f91\u548c\u72b6\u6001</li> <li>\u4f4d\u7f6e\uff1a\u4f4d\u4e8e<code>domain</code>\u5c42\uff08\u6838\u5fc3\u4e1a\u52a1\u9886\u57df\u5c42\uff09\u3002   (e.g., <code>User.java</code>)</li> </ul>"},{"location":"springboot/springboot%E9%A1%B9%E7%9B%AE%E4%B8%AD%20PO%20BO%20VO%20DTO%20POJO%20DAO%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%85%B6%E4%BD%9C%E7%94%A8%EF%BC%88%E9%99%84%E8%BD%AC%E6%8D%A2%E5%9B%BE%EF%BC%89/#5-vo-view-object","title":"5. VO (View Object) \u89c6\u56fe\u5bf9\u8c61","text":"<ul> <li>\u5b9a\u4e49\uff1a\u524d\u7aef\u5c55\u793a\u4e13\u7528\u7684\u6570\u636e\u5bf9\u8c61</li> <li>\u7279\u5f81\uff1a</li> <li>\u805a\u5408\u591a\u4e2a\u9886\u57df\u5bf9\u8c61\u7684\u5c55\u793a\u6570\u636e</li> <li>\u5305\u542b\u524d\u7aef\u9700\u8981\u7684\u7279\u5b9a\u5b57\u6bb5\u548c\u683c\u5f0f</li> <li>\u4f5c\u7528\uff1a\u4e3a\u524d\u7aef\u63d0\u4f9b\u5b9a\u5236\u5316\u6570\u636e\u7ed3\u6784</li> <li>\u4f4d\u7f6e\uff1a\u653e\u5728<code>web</code>\u6a21\u5757\uff08\u4f5c\u4e3aController\u7684\u54cd\u5e94\u5bf9\u8c61\uff09\u3002\u5b9e\u9645\u4e0a\uff0c\u5728\u6211\u4eec\u7684\u7ed3\u6784\u4e2d\uff0cWeb\u5c42\u7684\u54cd\u5e94DTO\u5c31\u53ef\u4ee5\u89c6\u4e3aVO\u3002   (e.g., <code>UserResponse.java</code>) <p>\u6ce8\u610f\uff1a\u5728\u6709\u4e9b\u4e0a\u4e0b\u6587\u4e2d\uff0cVO\u4e0eDTO\u6982\u5ff5\u91cd\u53e0\uff0c\u4f46\u5728\u5206\u5c42\u67b6\u6784\u4e2d\uff0c\u6211\u4eec\u901a\u5e38\u5c06\u7528\u4e8e\u5c55\u793a\u7684VO\u653e\u5728Web\u5c42\u3002</p> </li> </ul>"},{"location":"springboot/springboot%E9%A1%B9%E7%9B%AE%E4%B8%AD%20PO%20BO%20VO%20DTO%20POJO%20DAO%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%85%B6%E4%BD%9C%E7%94%A8%EF%BC%88%E9%99%84%E8%BD%AC%E6%8D%A2%E5%9B%BE%EF%BC%89/#6-pojo-plain-old-java-object-java","title":"6. POJO (Plain Old Java Object) \u666e\u901aJava\u5bf9\u8c61","text":"<ul> <li>\u5b9a\u4e49\uff1a\u4e0d\u7ee7\u627f\u6846\u67b6\u7279\u5b9a\u57fa\u7c7b\u7684\u7b80\u5355\u5bf9\u8c61</li> <li>\u7279\u5f81\uff1a</li> <li>\u53ea\u6709\u5c5e\u6027\u548c getter/setter</li> <li>\u65e0\u6846\u67b6\u4f9d\u8d56</li> <li>\u4f5c\u7528\uff1a\u4f5c\u4e3a\u5176\u4ed6\u5bf9\u8c61\u7684\u57fa\u7c7b</li> <li>\u4f4d\u7f6e\uff1a\u6240\u6709\u5c42\u901a\u7528\u57fa\u7840\u5bf9\u8c61</li> </ul>"},{"location":"springboot/springboot%E9%A1%B9%E7%9B%AE%E4%B8%AD%20PO%20BO%20VO%20DTO%20POJO%20DAO%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%85%B6%E4%BD%9C%E7%94%A8%EF%BC%88%E9%99%84%E8%BD%AC%E6%8D%A2%E5%9B%BE%EF%BC%89/#_1","title":"\u5206\u5c42\u67b6\u6784\u4e2d\u7684\u4f4d\u7f6e\u5206\u914d","text":"<pre><code>graph TD\n    A[\u57fa\u7840\u8bbe\u65bd\u5c42] --&gt;|\u5305\u542b| A1(PO)\n    A --&gt;|\u5305\u542b| A2(DAO\u5b9e\u73b0)\n\n    B[\u6838\u5fc3\u9886\u57df\u5c42] --&gt;|\u5305\u542b| B1(BO)\n    B --&gt;|\u5305\u542b| B2(\u9886\u57df\u670d\u52a1)\n\n    C[Web\u5c42] --&gt;|\u5305\u542b| C1(VO)\n    C --&gt;|\u5305\u542b| C2(Controller)\n\n    D[\u516c\u5171DTO] --&gt;|\u5305\u542b| D1(\u901a\u7528DTO)\n\n    E[\u5916\u89c2\u5c42] --&gt;|\u5305\u542b| E1(RPC DTO)\n\n    style A fill:#f4cccc\n    style B fill:#d9ead3\n    style C fill:#cfe2f3\n    style D fill:#fff2cc\n    style E fill:#d9d2e9</code></pre> <p>\u603b\u7ed3\u5b83\u4eec\u5728\u5206\u5c42\u67b6\u6784\u4e2d\u7684\u4f4d\u7f6e\uff1a</p> \u5bf9\u8c61\u7c7b\u578b \u6240\u5728\u6a21\u5757 \u8bf4\u660e \u793a\u4f8b\u6587\u4ef6 PO infrastructure \u4e0e\u6570\u636e\u5e93\u8868\u5bf9\u5e94\u7684\u5b9e\u4f53 <code>UserEntity.java</code> DAO infrastructure \u6570\u636e\u8bbf\u95ee\u63a5\u53e3\uff08\u5982Mapper\uff09 <code>UserMapper.java</code> DTO common-dto, web, facade \u6570\u636e\u4f20\u8f93\u5bf9\u8c61\uff0c\u6309\u4f7f\u7528\u573a\u666f\u5206\u6a21\u5757\u5b58\u653e <code>PageRequest.java</code> BO domain \u4e1a\u52a1\u5bf9\u8c61\uff08\u9886\u57df\u6a21\u578b\uff09 <code>User.java</code> VO web \u89c6\u56fe\u5bf9\u8c61\uff08\u53ef\u89c6\u4e3aWeb\u5c42\u7684\u54cd\u5e94DTO\uff09 <code>UserResponse.java</code> POJO \u6240\u6709\u6a21\u5757 \u6cdb\u6307\u7b80\u5355\u7684Java\u5bf9\u8c61\uff0c\u65e0\u7279\u5b9a\u4f4d\u7f6e \u7b80\u5355\u503c\u5bf9\u8c61"},{"location":"springboot/springboot%E9%A1%B9%E7%9B%AE%E4%B8%AD%20PO%20BO%20VO%20DTO%20POJO%20DAO%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%85%B6%E4%BD%9C%E7%94%A8%EF%BC%88%E9%99%84%E8%BD%AC%E6%8D%A2%E5%9B%BE%EF%BC%89/#_2","title":"\u5bf9\u8c61\u8f6c\u6362\u6d41\u7a0b","text":"<p>\u5728\u5178\u578b\u7684\u8bf7\u6c42\u6d41\u7a0b\u4e2d\uff0c\u5bf9\u8c61\u8f6c\u6362\u5982\u4e0b\uff1a</p> <pre><code>\u8bf7\u6c42\uff1a\n\n\u524d\u7aef -&gt; web (\u63a5\u6536DTO, \u5982UserCreateRequest) -&gt; application (\u5c06DTO\u8f6c\u6362\u4e3aBO) -&gt; domain (\u5904\u7406BO)\n\n-&gt; Infrastructure (\u5c06BO\u8f6c\u6362\u4e3aPO, \u7136\u540e\u901a\u8fc7DAO\u64cd\u4f5c\u6570\u636e\u5e93)\n\n\u54cd\u5e94\uff1a\n\nInfrastructure (\u4ece\u6570\u636e\u5e93\u83b7\u53d6PO) -&gt; \u5c06PO\u8f6c\u6362\u4e3aBO -&gt; domain (\u8fd4\u56deBO) -&gt; application (\u5c06BO\u8f6c\u6362\u4e3aDTO)\n\n-&gt; web (\u8fd4\u56deDTO/VO\u7ed9\u524d\u7aef)\n</code></pre>"},{"location":"springboot/springboot%E9%A1%B9%E7%9B%AE%E4%B8%AD%20PO%20BO%20VO%20DTO%20POJO%20DAO%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%85%B6%E4%BD%9C%E7%94%A8%EF%BC%88%E9%99%84%E8%BD%AC%E6%8D%A2%E5%9B%BE%EF%BC%89/#_3","title":"\u5177\u4f53\u8f6c\u6362\u6b65\u9aa4","text":"<ol> <li> <p>web\u5c42\uff1a</p> </li> <li> <p>\u63a5\u6536\u524d\u7aef\u8bf7\u6c42\uff1a\u4f7f\u7528<code>DTO</code>\uff08\u5982<code>UserCreateRequest</code>\uff09\u63a5\u6536\u53c2\u6570\u3002</p> </li> <li> <p>\u8c03\u7528application\u5c42\uff1a\u5c06<code>DTO</code>\u8f6c\u6362\u4e3a<code>BO</code>\uff08\u4e1a\u52a1\u5bf9\u8c61\uff09\u4f20\u9012\u7ed9application\u3002</p> </li> <li> <p>application\u5c42\uff08\u5e94\u7528\u670d\u52a1\u5c42\uff09\uff1a</p> </li> <li> <p>\u5904\u7406\u4e1a\u52a1\u903b\u8f91\uff1a\u4f7f\u7528<code>BO</code>\u8fdb\u884c\u4e1a\u52a1\u64cd\u4f5c\u3002</p> </li> <li> <p>\u8c03\u7528domain\u5c42\uff08\u9886\u57df\u670d\u52a1\uff09\uff1a\u4f20\u9012<code>BO</code>\u3002</p> </li> <li> <p>domain\u5c42\uff1a</p> </li> <li> <p>\u6267\u884c\u6838\u5fc3\u4e1a\u52a1\u903b\u8f91\uff1a\u4f7f\u7528<code>BO</code>\uff08\u9886\u57df\u5bf9\u8c61\uff09\u3002</p> </li> <li> <p>\u8c03\u7528Repository\u63a5\u53e3\uff1a\u4f20\u9012<code>BO</code>\uff08\u6ce8\u610f\uff1a\u8fd9\u91ccdomain\u5c42\u53ea\u4f9d\u8d56\u63a5\u53e3\uff09\u3002</p> </li> <li> <p>Infrastructure\u5c42\uff1a</p> </li> <li> <p>\u5b9e\u73b0Repository\uff1a\u5c06<code>BO</code>\u8f6c\u6362\u4e3a<code>PO</code>\uff08\u6301\u4e45\u5316\u5bf9\u8c61\uff09\u3002</p> </li> <li> <p>\u4f7f\u7528DAO\uff08\u5982MyBatis Mapper\uff09\u64cd\u4f5c\u6570\u636e\u5e93\uff1a\u64cd\u4f5c\u7684\u662f<code>PO</code>\u3002</p> </li> <li> <p>\u4ece\u6570\u636e\u5e93\u83b7\u53d6\u6570\u636e\uff1a\u5c06<code>PO</code>\u8f6c\u6362\u4e3a<code>BO</code>\u8fd4\u56de\u7ed9domain\u5c42\u3002</p> </li> <li> <p>\u8fd4\u56de\u6d41\u7a0b\uff1a</p> </li> <li> <p>domain\u5c42\u8fd4\u56de<code>BO</code>\u7ed9application\u5c42\u3002</p> </li> <li> <p>application\u5c42\u5c06<code>BO</code>\u8f6c\u6362\u4e3a<code>DTO</code>\uff08\u5982<code>UserResponse</code>\uff09\u8fd4\u56de\u7ed9web\u3002</p> </li> <li> <p>web\u5c06<code>DTO</code>\u8fd4\u56de\u7ed9\u524d\u7aef\uff08\u6b64\u65f6\u4f5c\u4e3aVO\u4f7f\u7528\uff09\u3002</p> </li> </ol>"},{"location":"springboot/springboot%E9%A1%B9%E7%9B%AE%E4%B8%AD%20PO%20BO%20VO%20DTO%20POJO%20DAO%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%85%B6%E4%BD%9C%E7%94%A8%EF%BC%88%E9%99%84%E8%BD%AC%E6%8D%A2%E5%9B%BE%EF%BC%89/#_4","title":"\u8f6c\u6362\u6d41\u7a0b","text":"<ol> <li> <p>web \u5c42 <code>VO/RequestDTO</code> \u2794 <code>BO</code>    (e.g., <code>UserCreateRequest</code> \u2794 <code>User</code>)</p> </li> <li> <p>application \u5c42 <code>BO</code> \u2794 <code>PO</code>    (e.g., <code>User</code> \u2794 <code>UserEntity</code>)</p> </li> <li> <p>Repository \u5c42 <code>PO</code> \u2794 \u6570\u636e\u5e93\u8bb0\u5f55</p> </li> <li> <p>\u8fd4\u56de\u6d41\u7a0b    \u6570\u636e\u5e93\u8bb0\u5f55 \u2794 <code>PO</code> \u2794 <code>BO</code> \u2794 <code>VO/ResponseDTO</code></p> </li> </ol> <p>\u8f6c\u6362\u6d41\u7a0b</p> <pre><code>graph LR\n    A[\u524d\u7aef\u8bf7\u6c42] --&gt;|1.\u63d0\u4ea4| B(VO/RequestDTO)\n    B --&gt; C[web]\n    C --&gt;|2.\u8f6c\u6362| D(BO)\n    D --&gt; E[application]\n    E --&gt;|3.\u4e1a\u52a1\u5904\u7406| F(BO)\n    F --&gt; G[Repository]\n    G --&gt;|4.\u8f6c\u6362| H(PO)\n    H --&gt; I[(\u6570\u636e\u5e93)]\n    I --&gt;|5.\u8fd4\u56de| H\n    H --&gt;|6.\u8f6c\u6362| F\n    F --&gt;|7.\u8f6c\u6362| J(VO/ResponseDTO)\n    J --&gt; K[\u524d\u7aef\u54cd\u5e94]\n\n    style B fill:#cfe2f3,stroke:#333\n    style D fill:#d9ead3,stroke:#333\n    style H fill:#f4cccc,stroke:#333\n    style J fill:#cfe2f3,stroke:#333</code></pre> <p>\u8bf7\u6c42\u54cd\u5e94\u6d41\u7a0b\u56fe</p> <pre><code>\nsequenceDiagram\n    participant Frontend as \u524d\u7aef\n    participant web as web\u5c42\n    participant application as application\u5c42\n    participant domain as domain\u9886\u57df\u5c42\n    participant Infrastructure as Infrastructure\u5c42\n    participant Database as \u6570\u636e\u5e93\n\n    rect rgb(191, 223, 255, 0.3)\n    note over Frontend,Database: \u8bf7\u6c42\u6d41\u7a0b\n    Frontend-&gt;&gt;web: \u53d1\u9001\u8bf7\u6c42(DTO)&lt;br/&gt;e.g. UserCreateRequest\n    web-&gt;&gt;application: \u4f20\u9012DTO\n    application-&gt;&gt;application: DTO \u2192 BO\u8f6c\u6362&lt;br/&gt;e.g. UserCreateRequest \u2192 User\n    application-&gt;&gt;domain: \u4f20\u9012BO\n    domain-&gt;&gt;Infrastructure: \u8c03\u7528\u4ed3\u50a8\u65b9\u6cd5&lt;br/&gt;\u4f20\u9012BO\n    Infrastructure-&gt;&gt;Infrastructure: BO \u2192 PO\u8f6c\u6362&lt;br/&gt;e.g. User \u2192 UserEntity\n    Infrastructure-&gt;&gt;Database: \u6267\u884cDAO\u64cd\u4f5c&lt;br/&gt;\u4fdd\u5b58PO\n    end\n\n    rect rgb(191, 255, 191, 0.3)\n    note over Database,Frontend: \u54cd\u5e94\u6d41\u7a0b\n    Database-&gt;&gt;Infrastructure: \u8fd4\u56dePO&lt;br/&gt;e.g. UserEntity\n    Infrastructure-&gt;&gt;Infrastructure: PO \u2192 BO\u8f6c\u6362&lt;br/&gt;e.g. UserEntity \u2192 User\n    Infrastructure-&gt;&gt;domain: \u8fd4\u56deBO\n    domain-&gt;&gt;application: \u8fd4\u56deBO\n    application-&gt;&gt;application: BO \u2192 DTO\u8f6c\u6362&lt;br/&gt;e.g. User \u2192 UserResponse\n    application-&gt;&gt;web: \u8fd4\u56deDTO\n    web-&gt;&gt;Frontend: \u8fd4\u56deDTO/VO\n    end</code></pre>"},{"location":"springboot/springboot%E9%A1%B9%E7%9B%AE%E4%B8%AD%20PO%20BO%20VO%20DTO%20POJO%20DAO%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%85%B6%E4%BD%9C%E7%94%A8%EF%BC%88%E9%99%84%E8%BD%AC%E6%8D%A2%E5%9B%BE%EF%BC%89/#_5","title":"\u5404\u5c42\u5bf9\u8c61\u8f6c\u6362\u793a\u4f8b\u4ee3\u7801","text":"<ol> <li>web\uff08\u63a5\u6536DTO\uff0c\u8fd4\u56deDTO\uff09\uff1a</li> </ol> <pre><code>@PostMapping(\"/users\")\npublic UserResponse createUser(@RequestBody UserCreateRequest request) {\n\n    User user = userConverter.toDomain(request); // DTO\u8f6cBO\n\n    User createdUser = userapplication.createUser(user);\n\n    return userConverter.toResponse(createdUser); // BO\u8f6cDTO\n\n}\n</code></pre> <ol> <li>application\uff08\u4f7f\u7528BO\uff09\uff1a</li> </ol> <pre><code>public User createUser(User user) {\n\n    // \u4e1a\u52a1\u903b\u8f91\u5904\u7406\n    user = userDomainapplication.create(user); // \u8c03\u7528\u9886\u57df\u670d\u52a1\n    return user;\n}\n</code></pre> <ol> <li>Infrastructure\uff08BO\u4e0ePO\u8f6c\u6362\uff09\uff1a</li> </ol> <pre><code>@Repository\npublic class UserRepositoryImpl implements UserRepository {\n\n    @Autowired\n    private UserMapper userMapper;\n\n    @Override\n    public User save(User user) {\n\n        UserEntity entity = UserConverter.toEntity(user); // BO\u8f6cPO\n\n        userMapper.insert(entity);\n\n        return UserConverter.toDomain(entity); // PO\u8f6cBO\n\n    }\n\n}\n</code></pre> <ol> <li> <p>Converter\uff08\u8f6c\u6362\u5668\uff09\uff1a</p> </li> <li> <p>\u901a\u5e38\u653e\u5728<code>infrastructure</code>\u5c42\uff08\u8d1f\u8d23BO\u4e0ePO\u7684\u8f6c\u6362\uff09\u548c<code>web</code>\u5c42\uff08\u8d1f\u8d23BO\u4e0eDTO\u7684\u8f6c\u6362\uff09\u3002</p> </li> <li> <p>\u4e5f\u53ef\u4ee5\u72ec\u7acb\u653e\u5728<code>common</code>\u6a21\u5757\uff0c\u4f46\u8981\u6ce8\u610f\u907f\u514d\u5faa\u73af\u4f9d\u8d56\u3002</p> </li> </ol> <p>\u603b\u7ed3\uff1a</p> <ul> <li> <p>\u4e25\u683c\u7684\u5206\u5c42\u548c\u5bf9\u8c61\u8f6c\u6362\u867d\u7136\u589e\u52a0\u4e86\u4ee3\u7801\u91cf\uff0c\u4f46\u63d0\u9ad8\u4e86\u7cfb\u7edf\u7684\u53ef\u7ef4\u62a4\u6027\u548c\u53ef\u6269\u5c55\u6027\u3002</p> </li> <li> <p>\u6838\u5fc3\u662f\u4fdd\u6301<code>domain</code>\u5c42\u7684\u7eaf\u51c0\uff08\u53ea\u4f7f\u7528BO\uff09\uff0c\u907f\u514d\u6280\u672f\u7ec6\u8282\u6c61\u67d3\u4e1a\u52a1\u903b\u8f91\u3002</p> </li> <li> <p>\u901a\u8fc7\u8f6c\u6362\u5668\uff08Converter\uff09\u5b9e\u73b0\u5404\u5c42\u5bf9\u8c61\u4e4b\u95f4\u7684\u8f6c\u6362\uff0c\u786e\u4fdd\u5404\u5c42\u804c\u8d23\u660e\u786e\u3002</p> </li> </ul>"},{"location":"springboot/springboot%E9%A1%B9%E7%9B%AE%E4%B8%AD%20PO%20BO%20VO%20DTO%20POJO%20DAO%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%85%B6%E4%BD%9C%E7%94%A8%EF%BC%88%E9%99%84%E8%BD%AC%E6%8D%A2%E5%9B%BE%EF%BC%89/#_6","title":"\u6700\u4f73\u5b9e\u8df5\u793a\u4f8b","text":""},{"location":"springboot/springboot%E9%A1%B9%E7%9B%AE%E4%B8%AD%20PO%20BO%20VO%20DTO%20POJO%20DAO%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%85%B6%E4%BD%9C%E7%94%A8%EF%BC%88%E9%99%84%E8%BD%AC%E6%8D%A2%E5%9B%BE%EF%BC%89/#1-po","title":"1. PO \u5b9a\u4e49 (\u57fa\u7840\u8bbe\u65bd\u5c42)","text":"<pre><code>// infrastructure \u6a21\u5757\n@Table(name = \"t_user\")\npublic class UserEntity {\n    @Id\n    private Long id;\n    private String username;\n    private String encryptedPassword;\n    // \u7701\u7565getter/setter\n}\n</code></pre>"},{"location":"springboot/springboot%E9%A1%B9%E7%9B%AE%E4%B8%AD%20PO%20BO%20VO%20DTO%20POJO%20DAO%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%85%B6%E4%BD%9C%E7%94%A8%EF%BC%88%E9%99%84%E8%BD%AC%E6%8D%A2%E5%9B%BE%EF%BC%89/#2-bo","title":"2. BO \u5b9a\u4e49 (\u6838\u5fc3\u5c42)","text":"<pre><code>// domain \u6a21\u5757\npublic class User {\n    private Long id;\n    private String username;\n    private Password password; // \u503c\u5bf9\u8c61\n\n    // \u4e1a\u52a1\u65b9\u6cd5\n    public void changePassword(String newPassword) {\n        this.password = Password.create(newPassword);\n    }\n}\n</code></pre>"},{"location":"springboot/springboot%E9%A1%B9%E7%9B%AE%E4%B8%AD%20PO%20BO%20VO%20DTO%20POJO%20DAO%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%85%B6%E4%BD%9C%E7%94%A8%EF%BC%88%E9%99%84%E8%BD%AC%E6%8D%A2%E5%9B%BE%EF%BC%89/#3-vo-web","title":"3. VO \u5b9a\u4e49 (Web\u5c42)","text":"<pre><code>// web \u6a21\u5757\npublic class UserResponse {\n    private Long id;\n    private String name;\n    private String avatarUrl;\n    private LocalDateTime lastLoginTime;\n    // \u7701\u7565getter/setter\n}\n</code></pre>"},{"location":"springboot/springboot%E9%A1%B9%E7%9B%AE%E4%B8%AD%20PO%20BO%20VO%20DTO%20POJO%20DAO%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%85%B6%E4%BD%9C%E7%94%A8%EF%BC%88%E9%99%84%E8%BD%AC%E6%8D%A2%E5%9B%BE%EF%BC%89/#4-dto","title":"4. DTO \u5b9a\u4e49 (\u516c\u5171\u6a21\u5757)","text":"<pre><code>// common-dto \u6a21\u5757\npublic class PageRequest {\n    private int pageNum = 1;\n    private int pageSize = 10;\n    // \u8ba1\u7b97\u504f\u79fb\u91cf\n    public int getOffset() {\n        return (pageNum - 1) * pageSize;\n    }\n}\n</code></pre>"},{"location":"springboot/springboot%E9%A1%B9%E7%9B%AE%E4%B8%AD%20PO%20BO%20VO%20DTO%20POJO%20DAO%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%85%B6%E4%BD%9C%E7%94%A8%EF%BC%88%E9%99%84%E8%BD%AC%E6%8D%A2%E5%9B%BE%EF%BC%89/#5","title":"5. \u8f6c\u6362\u5668 (\u57fa\u7840\u8bbe\u65bd\u5c42)","text":"<pre><code>// infrastructure \u6a21\u5757\n@Component\npublic class UserConverter {\n\n    // PO -&gt; BO\n    public User toDomain(UserEntity entity) {\n        User user = new User();\n        user.setId(entity.getId());\n        user.setUsername(entity.getUsername());\n        user.setPassword(Password.fromEncrypted(entity.getEncryptedPassword()));\n        return user;\n    }\n\n    // BO -&gt; VO\n    public UserResponse toResponse(User user) {\n        UserResponse response = new UserResponse();\n        response.setId(user.getId());\n        response.setName(user.getUsername());\n        response.setLastLoginTime(user.getLastLogin());\n        return response;\n    }\n}\n</code></pre>"},{"location":"springboot/springboot%E9%A1%B9%E7%9B%AE%E4%B8%AD%20PO%20BO%20VO%20DTO%20POJO%20DAO%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%85%B6%E4%BD%9C%E7%94%A8%EF%BC%88%E9%99%84%E8%BD%AC%E6%8D%A2%E5%9B%BE%EF%BC%89/#_7","title":"\u5173\u952e\u8bbe\u8ba1\u539f\u5219","text":"<ol> <li>\u5355\u4e00\u804c\u8d23\uff1a</li> <li>PO \u53ea\u8d1f\u8d23\u6570\u636e\u5e93\u6620\u5c04</li> <li>BO \u53ea\u5305\u542b\u4e1a\u52a1\u903b\u8f91</li> <li> <p>VO \u53ea\u670d\u52a1\u524d\u7aef\u5c55\u793a</p> </li> <li> <p>\u5c42\u95f4\u9694\u79bb\uff1a</p> </li> <li>Controller \u4e0d\u5e94\u76f4\u63a5\u64cd\u4f5c PO</li> <li>application \u4e0d\u5e94\u8fd4\u56de VO/DTO</li> <li> <p>Repository \u4e0d\u5e94\u63a5\u6536 BO</p> </li> <li> <p>\u8f6c\u6362\u65f6\u673a\uff1a    <pre><code>sequenceDiagram\n    Controller-&gt;&gt;application: DTO-&gt;BO\n    application-&gt;&gt;Repository: BO-&gt;PO\n    Repository-&gt;&gt;application: PO-&gt;BO\n    application-&gt;&gt;Controller: BO-&gt;VO</code></pre></p> </li> <li> <p>\u6027\u80fd\u4f18\u5316\uff1a</p> </li> <li>\u4f7f\u7528 MapStruct \u8fdb\u884c\u9ad8\u6548\u5bf9\u8c61\u8f6c\u6362</li> <li>\u907f\u514d\u5728\u5faa\u73af\u4e2d\u8fdb\u884c\u8f6c\u6362</li> <li>VO \u53ea\u5305\u542b\u524d\u7aef\u9700\u8981\u7684\u5b57\u6bb5</li> </ol> <p>\u901a\u8fc7\u8fd9\u79cd\u4e25\u683c\u7684\u5206\u5c42\u548c\u5bf9\u8c61\u5206\u79bb\uff0c\u7cfb\u7edf\u83b7\u5f97\uff1a - \u6838\u5fc3\u4e1a\u52a1\u4e0e\u6280\u672f\u5b9e\u73b0\u89e3\u8026 - \u6570\u636e\u5e93\u53d8\u66f4\u4e0d\u5f71\u54cd\u4e1a\u52a1\u903b\u8f91 - \u524d\u7aef\u5c55\u793a\u72ec\u7acb\u6f14\u5316 - \u5fae\u670d\u52a1\u95f4\u63a5\u53e3\u7a33\u5b9a</p>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/","title":"\u4ece\u96f6\u5f00\u59cb\u5341\u5206\u949f\u5b9e\u73b0springboot + MyBatis Dynamic SQL","text":"<p>\u5199\u8fd9\u7bc7\u6587\u7ae0\u672c\u6765\u662f\u4e3a\u4e86\u8bb0\u5f55\u4e00\u4e0b MyBatis Dynamic SQL \u5904\u7406\u590d\u6742JOIN \u6216\u8005\u5b50\u67e5\u8be2\uff0c\u4f46\u662f\u4e3a\u4e86\u66f4\u597d\u7684\u5b9e\u8df5\uff0c\u6253\u7b97\u4ece\u96f6\u5efa\u4e00\u4e2aspringboot\u9879\u76ee\uff0c\u6240\u4ee5\u5c06\u6574\u4e2a\u5b9e\u8df5\u8fc7\u7a0b\u8bb0\u5f55\u4e0b\u6765\uff0c\u672c\u6587\u5c06\u4ece\u5982\u4e0b\u51e0\u4e2a\u65b9\u9762\u4ecb\u7ecd\uff1a</p> <ul> <li>\u5b89\u88c5 JDK21</li> <li>\u4f7f\u7528 docker \u521b\u5efa\u6570\u636e\u5e93\u5e76\u521b\u5efa\u8868</li> <li>\u4f7f\u7528 spring initializr \u521d\u59cb\u5316 springboot \u9879\u76ee</li> <li>\u4f7f\u7528 MyBatis Generator \u81ea\u52a8\u751f\u6210 MySQL \u8868\u7ed3\u6784\u4ee3\u7801</li> <li>\u4f7f\u7528 MyBatis Dynamic SQL \u5b9e\u73b0\u5904\u7406\u590d\u6742JOIN \u6216\u8005\u5b50\u67e5\u8be2</li> <li>\u5206\u9875\u67e5\u8be2\u5c01\u88c5</li> <li>\u7edf\u4e00\u8fd4\u56de\u53c2\u6570\u548c\u5168\u5c40\u5f02\u5e38\u5904\u7406</li> <li>\u901a\u8fc7 http \u63a5\u53e3\u63d0\u4f9b\u670d\u52a1</li> </ul> <p>\u901a\u8fc7\u672c\u6587\u7684\u5b66\u4e60\uff0c\u6211\u5c06\u6307\u5bfc\u4f60\u521b\u5efa\u4e00\u4e2a Spring Boot \u9879\u76ee\uff0c\u7ed3\u5408 MyBatis Generator \u548c MyBatis Dynamic SQL \u6765\u5904\u7406\u590d\u6742\u67e5\u8be2\uff0c\u5e76\u901a\u8fc7 HTTP \u63a5\u53e3\u63d0\u4f9b\u670d\u52a1\uff0c\u4f60\u53ef\u4ee5\u5feb\u901f\u4ece\u96f6\u5f00\u53d1\u4e00\u4e2a\u5b8c\u6574\u7684 springboot \u9879\u76ee\u3002</p>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#jdk21","title":"\u5b89\u88c5 JDK21","text":"<p>\u5b89\u88c5 JDK 21 \u7684\u6b65\u9aa4\u5982\u4e0b\uff08\u6839\u636e\u64cd\u4f5c\u7cfb\u7edf\u9009\u62e9\u5bf9\u5e94\u65b9\u6cd5\uff09\uff1a</p>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#windows","title":"Windows \u7cfb\u7edf","text":""},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#_1","title":"\u624b\u52a8\u5b89\u88c5","text":"<ol> <li>\u4ece Oracle \u5b98\u7f51\u4e0b\u8f7d ZIP \u683c\u5f0f\u7684 JDK 21\uff08\u5982 <code>jdk-21_windows-x64_bin.zip</code>\uff09\u3002</li> <li>\u89e3\u538b\u5230\u4efb\u610f\u76ee\u5f55\uff08\u4f8b\u5982 <code>D:\\Java\\jdk-21</code>\uff09\u3002</li> <li>\u914d\u7f6e <code>JAVA_HOME</code> \u548c <code>Path</code> \u53d8\u91cf\uff08\u540c\u4e0a\uff09\uff0c\u6307\u5411\u89e3\u538b\u540e\u7684 <code>bin</code> \u76ee\u5f55\u3002</li> </ol>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#macos","title":"macOS \u7cfb\u7edf","text":""},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#_2","title":"\u624b\u52a8\u5b89\u88c5","text":"<ol> <li>\u4e0b\u8f7d macOS \u7248 <code>.dmg</code> \u6216 <code>.tar.gz</code> \u6587\u4ef6 \u4ece Oracle \u5b98\u7f51\u3002</li> <li>\u53cc\u51fb <code>.dmg</code> \u8fd0\u884c\u5b89\u88c5\uff0c\u6216\u89e3\u538b <code>.tar.gz</code> \u5230 <code>/Library/Java/JavaVirtualMachines/</code>\u3002</li> <li> <p>\u914d\u7f6e\u73af\u5883\u53d8\u91cf</p> </li> <li> <p>\u6253\u5f00\u7ec8\u7aef\uff0c\u7f16\u8f91<code>~/.zshrc</code>\uff08\u5982\u679c\u4f7f\u7528Zsh\uff09\u6216<code>~/.bash_profile</code>\uff08\u5982\u679c\u4f7f\u7528Bash\uff09</p> </li> <li>\u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9\uff1a</li> </ol> <pre><code>export JAVA_HOME=/usr/lib/jvm/jdk-21\n\nexport PATH=$JAVA_HOME/bin:$PATH\n</code></pre> <ul> <li>\u7136\u540e\u8fd0\u884c<code>source ~/.zshrc</code>\uff08\u6216<code>source ~/.bash_profile</code>\uff09\u4f7f\u914d\u7f6e\u751f\u6548</li> </ul>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#linux-ubuntudebian","title":"Linux \u7cfb\u7edf\uff08Ubuntu/Debian\uff09","text":""},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#oracle-jdk","title":"\u624b\u52a8\u5b89\u88c5\uff08Oracle JDK\uff09","text":"<ol> <li>\u4e0b\u8f7d <code>.tar.gz</code> \u5305 \u4ece Oracle \u5b98\u7f51\u3002</li> <li>\u89e3\u538b\u5230 <code>/usr/lib/jvm/</code>\uff1a</li> </ol> <pre><code>sudo tar -xzvf jdk-21_linux-x64_bin.tar.gz -C /usr/lib/jvm/\n</code></pre> <ol> <li>\u914d\u7f6e\u73af\u5883\u53d8\u91cf\uff1a</li> </ol> <pre><code>echo 'export JAVA_HOME=/usr/lib/jvm/jdk-21' &gt;&gt; ~/.bashrc\necho 'export PATH=$JAVA_HOME/bin:$PATH' &gt;&gt; ~/.bashrc\nsource ~/.bashrc\n</code></pre>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#_3","title":"\u9a8c\u8bc1\u5b89\u88c5","text":"<p>\u5728\u6240\u6709\u7cfb\u7edf\u4e0a\uff0c\u7ec8\u7aef\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u68c0\u67e5\u7248\u672c\uff1a</p> <pre><code>java -version\njavac -version\n</code></pre> <p>\u5e94\u663e\u793a <code>JDK 21</code> \u76f8\u5173\u4fe1\u606f\u3002</p>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#_4","title":"\u6ce8\u610f\u4e8b\u9879","text":"<ol> <li>\u9009\u62e9\u7248\u672c\uff1a<ul> <li>Oracle JDK\uff1a\u9700\u6ce8\u518c Oracle \u8d26\u6237\u4e0b\u8f7d\uff08\u542b\u5546\u4e1a\u8bb8\u53ef\u6761\u6b3e\uff09\u3002</li> <li>OpenJDK\uff1a\u5f00\u6e90\u514d\u8d39\uff0c\u63a8\u8350\u901a\u8fc7 Adoptium \u6216\u7cfb\u7edf\u5305\u7ba1\u7406\u5668\u5b89\u88c5\u3002</li> </ul> </li> <li>\u9632\u706b\u5899\u95ee\u9898\uff1a<ul> <li>\u82e5\u4e0b\u8f7d\u6162\uff0c\u53ef\u5c1d\u8bd5\u56fd\u5185\u955c\u50cf\uff08\u5982 \u6e05\u534e\u955c\u50cf\uff09\u3002</li> </ul> </li> </ol> <p>\u6309\u6b65\u9aa4\u64cd\u4f5c\u5373\u53ef\u987a\u5229\u5b8c\u6210\u5b89\u88c5\uff01</p>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#docker","title":"\u4f7f\u7528 docker \u521b\u5efa\u6570\u636e\u5e93\u5e76\u521b\u5efa\u8868","text":"<p>\u4f7f\u7528 Docker \u521b\u5efa\u6570\u636e\u5e93\u5e76\u5efa\u8868\u7684\u5b8c\u6574\u6d41\u7a0b\u5982\u4e0b\uff08\u4ee5 MySQL \u4e3a\u4f8b\uff09\uff1a</p>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#1-mysql","title":"1. \u62c9\u53d6 MySQL \u955c\u50cf","text":"<pre><code>docker pull mysql:latest\n</code></pre>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#2-mysql","title":"2. \u542f\u52a8 MySQL \u5bb9\u5668","text":"<pre><code>docker run -d \\\n  --name mysql-container \\\n  -e MYSQL_ROOT_PASSWORD=mysecretpassword \\\n  -e MYSQL_DATABASE=testdb \\\n  -e MYSQL_USER=testuser \\\n  -e MYSQL_PASSWORD=testpass \\\n  -p 3306:3306 \\\n  mysql:latest\n</code></pre> <p>\u53c2\u6570\u8bf4\u660e\uff1a</p> <ul> <li><code>-d</code>\uff1a\u540e\u53f0\u8fd0\u884c</li> <li><code>--name</code>\uff1a\u5bb9\u5668\u540d\u79f0</li> <li><code>-e</code>\uff1a\u73af\u5883\u53d8\u91cf\uff08\u8bbe\u7f6e\u5bc6\u7801/\u6570\u636e\u5e93/\u7528\u6237\uff09</li> <li><code>-p</code>\uff1a\u7aef\u53e3\u6620\u5c04\uff08\u4e3b\u673a\u7aef\u53e3:\u5bb9\u5668\u7aef\u53e3\uff09</li> </ul>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#3","title":"3. \u8fdb\u5165\u5bb9\u5668\u7ec8\u7aef","text":"<pre><code>docker exec -it mysql-container mysql -u root -p\n# \u8f93\u5165\u5bc6\u7801\uff1amysecretpassword\n</code></pre>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#4","title":"4. \u521b\u5efa\u6570\u636e\u5e93\uff08\u53ef\u9009\uff09","text":"<p>\u5982\u679c\u672a\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u521b\u5efa\u6570\u636e\u5e93\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u521b\u5efa\u6570\u636e\u5e93\uff1a</p> <pre><code>CREATE DATABASE mydatabase;\nUSE mydatabase;\n</code></pre>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#5","title":"5. \u521b\u5efa\u6570\u636e\u8868","text":"<pre><code>CREATE TABLE `rule` (\n  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '\u4e3b\u952e',\n  `gmt_create` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '\u521b\u5efa\u65f6\u95f4',\n  `gmt_modified` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '\u4fee\u6539\u65f6\u95f4',\n  `rule_id` varchar(64) NOT NULL COMMENT '\u89c4\u5219ID',\n  `domain` varchar(32) NOT NULL COMMENT '\u4e1a\u52a1\u57df',\n  `name` varchar(128) NOT NULL COMMENT '\u89c4\u5219\u540d\u79f0',\n  `description` varchar(512) DEFAULT NULL COMMENT '\u89c4\u5219\u63cf\u8ff0',\n  `type` varchar(32) NOT NULL COMMENT '\u89c4\u5219\u7c7b\u578b',\n  `creator` varchar(32) DEFAULT NULL COMMENT '\u521b\u5efa\u8005',\n  `modifier` varchar(32) DEFAULT NULL COMMENT '\u66f4\u65b0\u8005',\n  `tenant_id` varchar(32) NOT NULL COMMENT '\u79df\u6237ID',\n  `ext_info` text DEFAULT NULL COMMENT '\u6269\u5c55\u5b57\u6bb5',\n  PRIMARY KEY(`id`),\n  UNIQUE KEY `uk_uuid`(`rule_id`, `tenant_id`),\n  KEY `idx_rule_name`(`name`, `tenant_id`)\n)  DEFAULT CHARSET = utf8mb4 COMMENT = '\u89c4\u5219\u8868';\n\n\nCREATE TABLE `rule_version` (\n  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '\u4e3b\u952e',\n  `gmt_create` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '\u521b\u5efa\u65f6\u95f4',\n  `gmt_modified` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '\u4fee\u6539\u65f6\u95f4',\n  `rule_id` varchar(32) NOT NULL COMMENT '\u89c4\u5219ID',\n  `version` int(11) NOT NULL DEFAULT '1' COMMENT '\u7248\u672c\u53f7',\n  `name` varchar(128) NOT NULL COMMENT '\u89c4\u5219\u7248\u672c\u540d\u79f0',\n  `description` varchar(512) DEFAULT NULL COMMENT '\u89c4\u5219\u7248\u672c\u63cf\u8ff0',\n  `status` varchar(32) NOT NULL DEFAULT 'DRAFT' COMMENT '\u7248\u672c\u72b6\u6001',\n  `creator` varchar(32) DEFAULT NULL COMMENT '\u521b\u5efa\u4eba',\n  `modifier` varchar(32) DEFAULT NULL COMMENT '\u66f4\u65b0\u4eba',\n  `ext_info` text DEFAULT NULL COMMENT '\u6269\u5c55\u5b57\u6bb5',\n  `config` varchar(1024) DEFAULT NULL COMMENT '\u89c4\u5219\u914d\u7f6e\u8be6\u60c5',\n  PRIMARY KEY(`id`),\n  UNIQUE KEY `uk_uuid_version`(`rule_id`, `version`)\n)  DEFAULT CHARSET = utf8mb4 COMMENT = '\u89c4\u5219\u7248\u672c\u8868';\n</code></pre>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#6","title":"6. \u9a8c\u8bc1\u8868\u7ed3\u6784","text":"<pre><code>mysql&gt; SHOW TABLES;\n+----------------------+\n| Tables_in_mydatabase |\n+----------------------+\n| rule                 |\n| rule_version         |\n+----------------------+\n2 rows in set (0.004 sec)\n\nmysql&gt; DESCRIBE rule;\n</code></pre>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#7","title":"7. \u63d2\u5165\u6d4b\u8bd5\u6570\u636e","text":"<p>\u6ce8\u610f\u26a0\ufe0f\uff1a\u56e0\u4e3a\u4e0b\u9762\u7684\u63d2\u5165\u8bed\u53e5\u5305\u542b\u4e2d\u6587\uff0c\u5982\u679c\u76f4\u63a5\u5728docker\u5bb9\u5668\u4e2d\u901a\u8fc7\u547d\u4ee4\u6267\u884c\u4e0b\u9762\u7684\u63d2\u5165\u8bed\u53e5\uff0c\u90a3\u4e48\u4e2d\u6587\u4f1a\u4e0d\u53ef\u89c1\uff0c\u5efa\u8bae\u901a\u8fc7\u540e\u9762\u63d0\u4f9b\u7684\u5de5\u5177\u6267\u884c\u63d2\u5165\u6570\u636e\u64cd\u4f5c</p> <pre><code>-- \u63d2\u5165\u89c4\u5219\u8868\u6570\u636e\nINSERT INTO `rule` (\n  `rule_id`, `domain`, `name`, `description`, `type`, \n  `creator`, `modifier`, `tenant_id`, `ext_info`\n) VALUES\n('RULE_001', 'RISK', '\u98ce\u63a7\u89c4\u5219', '\u9ad8\u98ce\u9669\u64cd\u4f5c\u62e6\u622a\u89c4\u5219', 'RISK_CONTROL', \n 'admin', 'admin', 'TNT_A', '{\"priority\": 1}'),\n('RULE_002', 'PROMOTION', '\u4f18\u60e0\u5238\u89c4\u5219', '\u6ee1\u51cf\u4f18\u60e0\u5238\u53d1\u653e\u89c4\u5219', 'MARKETING', \n 'marketing_user', 'marketing_user', 'TNT_B', '{\"scope\": \"global\"}'),\n('RULE_003', 'INVENTORY', '\u5e93\u5b58\u89c4\u5219', '\u81ea\u52a8\u8865\u8d27\u8ba1\u7b97\u89c4\u5219', 'SUPPLY_CHAIN', \n 'ops_user', 'ops_user', 'TNT_A', NULL);\n\n-- \u63d2\u5165\u89c4\u5219\u7248\u672c\u8868\u6570\u636e\nINSERT INTO `rule_version` (\n  `rule_id`, `version`, `name`, `description`, `status`, \n  `creator`, `modifier`, `ext_info`, `config`\n) VALUES\n-- RULE_001\u76843\u4e2a\u7248\u672c\n('RULE_001', 1, 'V1\u57fa\u7840\u7248', '\u521d\u59cb\u98ce\u63a7\u89c4\u5219', 'DRAFT', \n 'admin', 'admin', NULL, '{\"threshold\": 50}'),\n('RULE_001', 2, 'V2\u589e\u5f3a\u7248', '\u589e\u52a0\u4e8c\u6b21\u9a8c\u8bc1', 'PUBLISHED', \n 'admin', 'admin', '{\"reviewer\":\"john\"}', '{\"threshold\": 70, \"2fa\": true}'),\n('RULE_001', 3, 'V3\u4f18\u5316\u7248', '\u6027\u80fd\u4f18\u5316\u7248\u672c', 'PUBLISHED', \n 'admin', 'admin', NULL, '{\"threshold\": 65, \"2fa\": true, \"timeout\": 500}'),\n\n-- RULE_002\u76842\u4e2a\u7248\u672c\n('RULE_002', 1, '\u57fa\u7840\u7248', '\u6ee1100\u51cf10\u89c4\u5219', 'PUBLISHED', \n 'marketing_user', 'marketing_user', NULL, '{\"condition\": 100, \"discount\": 10}'),\n('RULE_002', 2, '618\u5927\u4fc3\u7248', '618\u6d3b\u52a8\u4e13\u5c5e\u89c4\u5219', 'DRAFT', \n 'marketing_user', 'marketing_user', '{\"event\":\"618\"}', '{\"condition\": 80, \"discount\": 15}'),\n\n-- RULE_003\u76842\u4e2a\u7248\u672c\n('RULE_003', 1, '\u521d\u59cb\u7248\u672c', '\u9ed8\u8ba4\u8865\u8d27\u89c4\u5219', 'PUBLISHED', \n 'ops_user', 'ops_user', NULL, '{\"min_stock\": 100, \"reorder_qty\": 500}'),\n('RULE_003', 2, '\u5b63\u8282\u8c03\u6574\u7248', '\u51ac\u5b63\u8865\u8d27\u7b56\u7565', 'PUBLISHED', \n 'ops_user', 'ops_user', '{\"season\":\"winter\"}', '{\"min_stock\": 150, \"reorder_qty\": 700}');\n</code></pre>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#8","title":"8. \u67e5\u8be2\u6570\u636e","text":"<pre><code>-- \u9a8c\u8bc1\u89c4\u5219\u8868\u6570\u636e\nSELECT * FROM rule WHERE tenant_id IN ('TNT_A', 'TNT_B');\n\n-- \u9a8c\u8bc1\u6700\u65b0\u7248\u672c\u89c4\u5219\nSELECT r.rule_id, r.name, MAX(rv.version) AS latest_version\nFROM rule r\nJOIN rule_version rv ON r.rule_id = rv.rule_id\nGROUP BY r.rule_id, r.name;\n</code></pre>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#9-mysql","title":"9. \u9000\u51fa MySQL","text":"<pre><code>EXIT;\n</code></pre>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#10","title":"10. \u6301\u4e45\u5316\u6570\u636e\uff08\u53ef\u9009\uff09","text":"<p>\u9ed8\u8ba4\u6570\u636e\u5b58\u50a8\u5728\u5bb9\u5668\u5185\uff0c\u9700\u521b\u5efa\u5377\u6301\u4e45\u5316\uff1a</p> <pre><code># \u505c\u6b62\u5e76\u5220\u9664\u539f\u5bb9\u5668\ndocker stop mysql-container\ndocker rm mysql-container\n\n# \u521b\u5efa\u6570\u636e\u5377\ndocker volume create mysql-data\n\n# \u542f\u52a8\u65b0\u5bb9\u5668\uff08\u6dfb\u52a0 -v \u53c2\u6570\uff09\ndocker run -d \\\n  --name mysql-container \\\n  -v mysql-data:/var/lib/mysql \\\n  -e MYSQL_ROOT_PASSWORD=mysecretpassword \\\n  -p 3306:3306 \\\n  mysql:latest\n</code></pre>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#_5","title":"\u5e38\u7528\u7ba1\u7406\u547d\u4ee4","text":"\u547d\u4ee4 \u8bf4\u660e <code>docker logs mysql-container</code> \u67e5\u770b\u5bb9\u5668\u65e5\u5fd7 <code>docker inspect mysql-container</code> \u67e5\u770b\u5bb9\u5668\u8be6\u60c5 <code>docker cp file.sql mysql-container:/</code> \u590d\u5236\u6587\u4ef6\u5230\u5bb9\u5668 <code>docker exec -i mysql-container mysql -u root -p &lt; file.sql</code> \u6267\u884cSQL\u6587\u4ef6"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#_6","title":"\u53ef\u89c6\u5316\u5de5\u5177\u63a8\u8350","text":"<ol> <li>DBeaver\uff1a\u5f00\u6e90\u901a\u7528\u6570\u636e\u5e93\u5de5\u5177</li> <li>TablePlus\uff1a\u8f7b\u91cf\u7ea7\u591a\u6570\u636e\u5e93\u5ba2\u6237\u7aef</li> <li>phpMyAdmin\uff08MySQL\u4e13\u7528\uff09\uff1a</li> </ol> <p>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u542f\u52a8 <code>**phpMyAdmin**</code>\uff1a</p> <pre><code>docker run -d \\\n  --name phpmyadmin \\\n  --link mysql-container:db \\\n  -p 8080:80 \\\n  phpmyadmin\n</code></pre> <p>\u8bbf\u95ee http://localhost:8080\uff0c\u8f93\u5165\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c\u53ef\u4ee5\u770b\u5230\u524d\u9762\u521b\u5efa\u7684\u8868\u548c\u6570\u636e</p> <p></p> <p>\u6ce8\u610f\u4e8b\u9879\uff1a</p> <ol> <li>\u751f\u4ea7\u73af\u5883\u52a1\u5fc5\u4f7f\u7528\u5f3a\u5bc6\u7801</li> <li>\u91cd\u8981\u6570\u636e\u5fc5\u987b\u914d\u7f6e\u5377\u6301\u4e45\u5316</li> <li>\u53ef\u6dfb\u52a0 <code>--restart=always</code> \u53c2\u6570\u5b9e\u73b0\u81ea\u52a8\u91cd\u542f</li> <li>\u9700\u8981\u8fdc\u7a0b\u8bbf\u95ee\u65f6\u914d\u7f6e <code>-e MYSQL_ROOT_HOST=%</code></li> </ol>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#spring-boot","title":"\u521b\u5efa Spring Boot \u9879\u76ee","text":"<ol> <li>\u8bbf\u95ee Spring Initializr</li> <li>\u9009\u62e9\u4ee5\u4e0b\u914d\u7f6e\uff1a<ul> <li>Project: Maven Project</li> <li>Language: Java</li> <li>Spring Boot: 3.4.6 (\u6700\u65b0\u7a33\u5b9a\u7248)</li> </ul> </li> <li>\u6dfb\u52a0\u4f9d\u8d56\uff1a<ul> <li>Spring Web</li> <li>MyBatis Framework</li> <li>MySQL Driver</li> <li>Lombok (\u63a8\u8350)</li> </ul> </li> <li>\u70b9\u51fb \"Generate\" \u4e0b\u8f7d\u9879\u76ee</li> </ol> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u521b\u5efa\u9879\u76ee\u540e\uff0c\u5bf9\u4e8e\u5c0f\u9879\u76ee\u53ef\u4ee5\u521b\u5efa\u5982\u4e0b\u7684\u76ee\u5f55\u7ed3\u6784\uff1a</p> <pre><code>src/main/java\n\u2514\u2500\u2500 com\n    \u2514\u2500\u2500 example\n        \u2514\u2500\u2500 demo\n            \u251c\u2500\u2500 Application.java                  # \u542f\u52a8\u7c7b\n            \u2502\n            \u251c\u2500\u2500 config                            # \u914d\u7f6e\u7c7b\n            \u2502   \u251c\u2500\u2500 MyBatisDynamicConfig.java\n            \u2502   \u251c\u2500\u2500 WebMvcConfig.java\n            \u2502   \u2514\u2500\u2500 SecurityConfig.java\n            \u2502\n            \u251c\u2500\u2500 common                            # \u516c\u5171\u6a21\u5757\n            \u2502   \u251c\u2500\u2500 annotation                    # \u81ea\u5b9a\u4e49\u6ce8\u89e3\n            \u2502   \u251c\u2500\u2500 constant                      # \u5e38\u91cf\n            \u2502   \u251c\u2500\u2500 enums                         # \u679a\u4e3e\u7c7b\n            \u2502   \u2502   \u251c\u2500\u2500 AppErrorCode.java\n            \u2502   \u2502   \u2514\u2500\u2500 ErrorCode.java            \n            \u2502   \u251c\u2500\u2500 exception                     # \u5f02\u5e38\u5904\u7406\n            \u2502   \u2502   \u251c\u2500\u2500 GlobalExceptionHandler.java\n            \u2502   \u2502   \u2514\u2500\u2500 BusinessException.java\n            \u2502   \u251c\u2500\u2500 model                         # \u516c\u5171\u6a21\u578b\n            \u2502   \u2502   \u251c\u2500\u2500 page                      # \u5206\u9875\u76f8\u5173\n            \u2502   \u2502   \u2502   \u251c\u2500\u2500 PageRequest.java\n            \u2502   \u2502   \u2502   \u251c\u2500\u2500 PageResult.java\n            \u2502   \u2502   \u2502   \u2514\u2500\u2500 PaginationUtils.java\n            \u2502   \u2502   \u251c\u2500\u2500 response                  # \u54cd\u5e94\u5c01\u88c5\n            \u2502   \u2502   \u2502   \u251c\u2500\u2500 Result.java\n            \u2502   \u2502   \u2514\u2500\u2500 validation                # \u9a8c\u8bc1\u5de5\u5177\n            \u2502   \u2514\u2500\u2500 util                          # \u5de5\u5177\u7c7b\n            \u2502\n            \u251c\u2500\u2500 controller                        # \u63a7\u5236\u5668\u5c42\n            \u2502   \u251c\u2500\u2500 UserController.java\n            \u2502   \u251c\u2500\u2500 ProductController.java\n            \u2502   \u2514\u2500\u2500 ...\n            \u2502\n            \u251c\u2500\u2500 service                           # \u670d\u52a1\u5c42\n            \u2502   \u251c\u2500\u2500 UserService.java\n            \u2502   \u251c\u2500\u2500 ProductService.java\n            \u2502   \u2514\u2500\u2500 impl                          # \u670d\u52a1\u5b9e\u73b0\n            \u2502       \u251c\u2500\u2500 UserServiceImpl.java\n            \u2502       \u251c\u2500\u2500 ProductServiceImpl.java\n            \u2502       \u2514\u2500\u2500 ...\n            \u2502\n            \u251c\u2500\u2500 repository                        # \u6570\u636e\u8bbf\u95ee\u5c42\n            \u2502   \u251c\u2500\u2500 generated                     # MyBatis Generator \u751f\u6210 MyBatis Dynamic SQL \u4ee3\u7801\n            \u2502   \u2502   \u251c\u2500\u2500 UserMapper.java\n            \u2502   \u2502   \u251c\u2500\u2500 UserDynamicSqlSupport.java\n            \u2502   \u2502   \u251c\u2500\u2500 ProductMapper.java\n            \u2502   \u2502   \u251c\u2500\u2500 ProductDynamicSqlSupport.java            \n            \u2502   \u2502   \u2514\u2500\u2500 ...\n            \u2502   \u251c\u2500\u2500 custom                        # \u81ea\u5b9a\u4e49Mapper\u63a5\u53e3\n            \u2502   \u2502   \u251c\u2500\u2500 UserCustomMapper.java\n            \u2502   \u2502   \u251c\u2500\u2500 ProductCustomMapper.java\n            \u2502   \u2502   \u2514\u2500\u2500 ...\n            \u2502   \u2502   \u2514\u2500\u2500builder                          # \u6784\u5efa SelectStatementProvider\n            \u2502   \u2502       \u251c\u2500\u2500 UserQueryBuilder.java\n            \u2502   \u2502       \u251c\u2500\u2500 ProductQueryBuilder.java\n            \u2502   \u2502       \u2514\u2500\u2500 ...\n            \u2502   \u2502\n            \u251c\u2500\u2500 model                             # \u6570\u636e\u6a21\u578b\u5c42\n            \u2502   \u251c\u2500\u2500 entity                        # \u5b9e\u4f53\u7c7b (MyBatis Generator \u751f\u6210)\n            \u2502   \u2502   \u251c\u2500\u2500 UserEntity.java\n            \u2502   \u2502   \u251c\u2500\u2500 ProductEntity.java\n            \u2502   \u2502   \u2514\u2500\u2500 ...\n            \u2502   \u251c\u2500\u2500 dto                           # \u6570\u636e\u4f20\u8f93\u5bf9\u8c61\n            \u2502   \u2502   \u251c\u2500\u2500 request                   # \u8bf7\u6c42DTO\n            \u2502   \u2502   \u2502   \u251c\u2500\u2500 UserCreateRequest.java\n            \u2502   \u2502   \u2502   \u251c\u2500\u2500 UserUpdateRequest.java\n            \u2502   \u2502   \u2502   \u251c\u2500\u2500 UserQueryRequest.java\n            \u2502   \u2502   \u2502   \u2514\u2500\u2500 ...\n            \u2502   \u2502   \u2514\u2500\u2500 response                  # \u54cd\u5e94DTO\n            \u2502   \u2502       \u251c\u2500\u2500 UserResponse.java\n            \u2502   \u2502       \u251c\u2500\u2500 ProductResponse.java\n            \u2502   \u2502       \u2514\u2500\u2500 ...\n            \u2502   \u2514\u2500\u2500 query                         # \u67e5\u8be2\u6761\u4ef6\u5c01\u88c5\n            \u2502       \u251c\u2500\u2500 UserQueryCondition.java\n            \u2502       \u251c\u2500\u2500 ProductQueryCondition.java\n            \u2502       \u2514\u2500\u2500 ...\n            \u2502\n            \u2514\u2500\u2500 converter                         # \u5bf9\u8c61\u8f6c\u6362\u5668\n                \u251c\u2500\u2500 UserConverter.java\n                \u251c\u2500\u2500 ProductConverter.java\n                \u2514\u2500\u2500 ...\n\nsrc/main/resources\n\u251c\u2500 application.yml      // \u914d\u7f6e\u6587\u4ef6\n\u2514\u2500 generatorConfig.xml  // MyBatis Generator \u914d\u7f6e\n</code></pre>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#mybatis-generator-mysql","title":"\u4f7f\u7528 MyBatis Generator \u81ea\u52a8\u751f\u6210 MySQL \u8868\u7ed3\u6784\u4ee3\u7801","text":"<p>MyBatis Generator (MBG) \u662f\u4e00\u4e2a\u5f3a\u5927\u7684\u4ee3\u7801\u751f\u6210\u5de5\u5177\uff0c\u53ef\u4ee5\u81ea\u52a8\u521b\u5efa\u4e0e\u6570\u636e\u5e93\u8868\u7ed3\u6784\u5bf9\u5e94\u7684\u6a21\u578b\u7c7b\u3001Mapper \u63a5\u53e3\u548c XML \u6620\u5c04\u6587\u4ef6\u3002\u4e0b\u9762\u6211\u5c06\u8be6\u7ec6\u4ecb\u7ecd\u5b8c\u6574\u7684\u4f7f\u7528\u6d41\u7a0b\u3002</p>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#_7","title":"\u4e00\u3001\u73af\u5883\u51c6\u5907\u4e0e\u914d\u7f6e","text":"<ol> <li>\u5728 <code>pom.xml</code> \u4e2d\u6dfb\u52a0 MyBatis Generator \u63d2\u4ef6\uff1a</li> </ol> <pre><code>&lt;build&gt;\n    &lt;plugins&gt;\n        &lt;!-- MyBatis Generator Maven \u63d2\u4ef6 --&gt;\n        &lt;plugin&gt;\n            &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt;\n            &lt;artifactId&gt;mybatis-generator-maven-plugin&lt;/artifactId&gt;\n            &lt;version&gt;1.4.2&lt;/version&gt;\n            &lt;dependencies&gt;\n                &lt;!-- \u4f7f\u7528 MySQL \u9a71\u52a8 --&gt;\n                &lt;dependency&gt;\n                    &lt;groupId&gt;mysql&lt;/groupId&gt;\n                    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;\n                    &lt;version&gt;8.0.33&lt;/version&gt;\n                &lt;/dependency&gt;\n            &lt;/dependencies&gt;\n            &lt;configuration&gt;\n                &lt;!-- \u914d\u7f6e\u6587\u4ef6\u8def\u5f84 --&gt;\n                &lt;configurationFile&gt;src/main/resources/generatorConfig.xml&lt;/configurationFile&gt;\n                &lt;overwrite&gt;true&lt;/overwrite&gt;\n                &lt;verbose&gt;true&lt;/verbose&gt;\n            &lt;/configuration&gt;\n        &lt;/plugin&gt;\n    &lt;/plugins&gt;\n&lt;/build&gt;\n</code></pre> <ol> <li>\u5728 <code>src/main/resources</code> \u76ee\u5f55\u4e0b\u521b\u5efa <code>generatorConfig.xml</code> \u6587\u4ef6\uff1a</li> </ol> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;!DOCTYPE generatorConfiguration\n        PUBLIC \"-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN\"\n        \"https://mybatis.org/dtd/mybatis-generator-config_1_0.dtd\"&gt;\n\n&lt;generatorConfiguration&gt;\n    &lt;!-- \u6570\u636e\u5e93\u9a71\u52a8\u8def\u5f84\uff08\u5982\u679c\u672a\u901a\u8fc7Maven\u4f9d\u8d56\u7ba1\u7406\uff09 --&gt;\n    &lt;!-- &lt;classPathEntry location=\"/path/to/mysql-connector-java-8.0.33.jar\"/&gt; --&gt;\n\n    &lt;context id=\"mysql\" targetRuntime=\"MyBatis3DynamicSql\"&gt;\n        &lt;!-- \u751f\u6210\u7684Java\u6587\u4ef6\u7f16\u7801 --&gt;\n        &lt;property name=\"javaFileEncoding\" value=\"UTF-8\"/&gt;\n\n        &lt;!-- \u751f\u6210\u7684Java\u6587\u4ef6\u7684\u6ce8\u91ca --&gt;\n        &lt;commentGenerator&gt;\n            &lt;!-- \u6ce8\u91ca\u914d\u7f6e\uff1a\u4e0d\u751f\u6210\u6ce8\u91ca --&gt;\n&lt;!--            &lt;property name=\"suppressAllComments\" value=\"true\"/&gt;--&gt;\n            &lt;!-- \u751f\u6210\u6ce8\u91ca --&gt;\n            &lt;property name=\"addRemarkComments\" value=\"true\"/&gt;\n\n        &lt;/commentGenerator&gt;\n        &lt;!-- \u6570\u636e\u5e93\u8fde\u63a5\u4fe1\u606f --&gt;\n        &lt;jdbcConnection driverClass=\"com.mysql.cj.jdbc.Driver\"\n                        connectionURL=\"jdbc:mysql://localhost:3306/mydatabase\"\n                        userId=\"root\"\n                        password=\"mysecretpassword\"&gt;\n        &lt;/jdbcConnection&gt;\n        &lt;!-- Java\u6a21\u578b\u751f\u6210\u914d\u7f6e --&gt;\n        &lt;javaModelGenerator targetPackage=\"com.example.demo.model.entity\" targetProject=\"src/main/java\"&gt;\n            &lt;property name=\"enableSubPackages\" value=\"true\"/&gt;\n            &lt;property name=\"trimStrings\" value=\"true\"/&gt;\n        &lt;/javaModelGenerator&gt;\n        &lt;!-- SQL\u6620\u5c04\u6587\u4ef6\u751f\u6210\u914d\u7f6e\uff08\u5982\u679c\u4f7f\u7528XML\uff09 --&gt;\n        &lt;!-- \u6ce8\u610f\uff1a\u5982\u679c\u4f7f\u7528Dynamic SQL\u65b9\u5f0f\uff0c\u4e0d\u9700\u8981XML\u6620\u5c04\u6587\u4ef6 --&gt;\n&lt;!--        &lt;sqlMapGenerator targetPackage=\"mapper\"--&gt;\n&lt;!--                         targetProject=\"src/main/resources\"&gt;--&gt;\n&lt;!--            &lt;property name=\"enableSubPackages\" value=\"true\"/&gt;--&gt;\n&lt;!--        &lt;/sqlMapGenerator&gt;--&gt;\n        &lt;!-- Mapper\u63a5\u53e3\u751f\u6210\u914d\u7f6e --&gt;\n        &lt;javaClientGenerator type=\"ANNOTATEDMAPPER\"\n                             targetPackage=\"com.example.demo.repository.generated\"\n                             targetProject=\"src/main/java\"&gt;\n            &lt;property name=\"enableSubPackages\" value=\"true\"/&gt;\n        &lt;/javaClientGenerator&gt;\n        &lt;!-- \u6307\u5b9a\u8981\u751f\u6210\u7684\u8868 --&gt;\n        &lt;table tableName=\"rule\" domainObjectName=\"RuleEntity\" mapperName=\"RuleMapper\"&gt;\n            &lt;generatedKey column=\"id\" sqlStatement=\"MySql\" identity=\"true\"/&gt;\n        &lt;/table&gt;\n\n        &lt;table tableName=\"rule_version\" domainObjectName=\"RuleVersionEntity\" mapperName=\"RuleVersionMapper\"&gt;\n            &lt;generatedKey column=\"id\" sqlStatement=\"MySql\" identity=\"true\"/&gt;\n        &lt;/table&gt;\n        &lt;!-- \u751f\u6210\u6240\u6709\u8868 --&gt;\n&lt;!--         &lt;table tableName=\"%\" /&gt;--&gt;\n    &lt;/context&gt;\n&lt;/generatorConfiguration&gt;\n</code></pre>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#_8","title":"\u4e8c\u3001\u914d\u7f6e\u8be6\u89e3\u4e0e\u9ad8\u7ea7\u9009\u9879","text":""},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#1","title":"1. \u5173\u952e\u914d\u7f6e\u9879\u8bf4\u660e","text":"\u914d\u7f6e\u9879 \u8bf4\u660e \u63a8\u8350\u503c targetRuntime \u751f\u6210\u4ee3\u7801\u7684\u8fd0\u884c\u65f6\u73af\u5883 <code>MyBatis3DynamicSql</code> (\u63a8\u8350) \u6216 <code>MyBatis3</code> javaClientGenerator type Mapper\u63a5\u53e3\u7c7b\u578b <code>ANNOTATEDMAPPER</code> (\u6ce8\u89e3\u65b9\u5f0f) \u6216 <code>XMLMAPPER</code> enableSubPackages \u662f\u5426\u4f7f\u7528\u5b50\u5305 <code>true</code> (\u6309\u8868\u540d\u5206\u5305) trimStrings \u81ea\u52a8\u53bb\u9664\u5b57\u7b26\u4e32\u7a7a\u683c <code>true</code> suppressAllComments \u662f\u5426\u751f\u6210\u6ce8\u91ca <code>true</code> (\u51cf\u5c11\u5197\u4f59)"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#2","title":"2. \u9ad8\u7ea7\u8868\u914d\u7f6e","text":"<pre><code>&lt;table tableName=\"employee\" domainObjectName=\"Employee\"&gt;\n    &lt;!-- \u5ffd\u7565\u5b57\u6bb5 --&gt;\n    &lt;ignoreColumn column=\"deleted\"/&gt;\n\n    &lt;!-- \u91cd\u547d\u540d\u5b57\u6bb5 --&gt;\n    &lt;columnOverride column=\"start_date\" property=\"employmentDate\"/&gt;\n\n    &lt;!-- \u679a\u4e3e\u7c7b\u578b\u5904\u7406 --&gt;\n    &lt;columnOverride column=\"status\" \n                   javaType=\"com.example.enums.EmployeeStatus\"\n                   typeHandler=\"org.apache.ibatis.type.EnumTypeHandler\"/&gt;\n\n    &lt;!-- \u903b\u8f91\u5220\u9664\u914d\u7f6e --&gt;\n    &lt;columnOverride column=\"is_deleted\" \n                   jdbcType=\"TINYINT\" \n                   javaType=\"java.lang.Boolean\"\n                   delimitedColumnName=\"true\"&gt;\n        &lt;property name=\"logicalDeleteColumn\" value=\"true\"/&gt;\n    &lt;/columnOverride&gt;\n&lt;/table&gt;\n</code></pre>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#3_1","title":"3.\u81ea\u5b9a\u4e49\u63d2\u4ef6\u6269\u5c55","text":"<p>\u521b\u5efa\u81ea\u5b9a\u4e49\u751f\u6210\u5668\u63d2\u4ef6\uff0c\u5728 <code>generatorConfig.xml</code> \u4e2d\u6dfb\u52a0\uff1a</p> <pre><code>&lt;context id=\"mysql\" targetRuntime=\"MyBatis3DynamicSql\"&gt;\n    &lt;!-- \u6dfb\u52a0\u81ea\u5b9a\u4e49\u63d2\u4ef6 --&gt;\n    &lt;plugin type=\"com.example.generator.CustomPlugin\"/&gt;\n    ...\n&lt;/context&gt;\n</code></pre> <p>\u81ea\u5b9a\u4e49\u63d2\u4ef6\u793a\u4f8b\uff1a</p> <pre><code>public class CustomPlugin extends PluginAdapter {\n    // \u5728\u6a21\u578b\u7c7b\u751f\u6210\u540e\u6dfb\u52a0 Lombok \u6ce8\u89e3\n    @Override\n    public boolean modelBaseRecordClassGenerated(TopLevelClass topLevelClass, \n            IntrospectedTable introspectedTable) {\n        topLevelClass.addAnnotation(\"@Data\");\n        topLevelClass.addAnnotation(\"@Builder\");\n        topLevelClass.addAnnotation(\"@NoArgsConstructor\");\n        topLevelClass.addAnnotation(\"@AllArgsConstructor\");\n\n        topLevelClass.addImportedType(\"lombok.Data\");\n        topLevelClass.addImportedType(\"lombok.Builder\");\n        topLevelClass.addImportedType(\"lombok.NoArgsConstructor\");\n        topLevelClass.addImportedType(\"lombok.AllArgsConstructor\");\n\n        return true;\n    }\n\n    // \u6dfb\u52a0 Swagger \u6ce8\u89e3\n    @Override\n    public boolean modelFieldGenerated(Field field, \n            TopLevelClass topLevelClass, \n            IntrospectedColumn introspectedColumn,\n            IntrospectedTable introspectedTable, \n            ModelClassType modelClassType) {\n\n        field.addAnnotation(\"@ApiModelProperty(value = \\\"\" + \n                introspectedColumn.getRemarks() + \"\\\")\");\n\n        topLevelClass.addImportedType(\"io.swagger.annotations.ApiModelProperty\");\n        return true;\n    }\n}\n</code></pre>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#_9","title":"\u4e09\u3001\u8fd0\u884c\u4ee3\u7801\u751f\u6210\u5668","text":""},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#1-maven","title":"1. \u4f7f\u7528 Maven \u547d\u4ee4\u751f\u6210","text":"<pre><code>mvn mybatis-generator:generate\n</code></pre>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#2-ide-intellij-idea","title":"2. \u5728 IDE \u4e2d\u8fd0\u884c\uff08\u4ee5 IntelliJ IDEA \u4e3a\u4f8b\uff09","text":"<ol> <li>\u6253\u5f00 Maven \u5de5\u5177\u7a97\u53e3</li> <li>\u5c55\u5f00 Plugins &gt; mybatis-generator</li> <li>\u53cc\u51fb mybatis-generator:generate</li> </ol>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#3_2","title":"3. \u751f\u6210\u540e\u9879\u76ee\u7ed3\u6784","text":"<pre><code>src/main/java\n\u2514\u2500\u2500 com\n    \u2514\u2500\u2500 example\n        \u2514\u2500\u2500 demo\n            \u251c\u2500\u2500 model\n            \u2502   \u251c\u2500\u2500 entity\n            \u2502   \u2502   \u251c\u2500\u2500 RuleEntity.java\n            \u2502   \u2502   \u2514\u2500\u2500 RuleVersionEntity.java\n            \u251c\u2500\u2500 repository\n            \u2502   \u2514\u2500\u2500 generated\n            \u2502       \u251c\u2500\u2500 RuleEntityDynamicSqlSupport.java\n            \u2502       \u251c\u2500\u2500 RuleMapper.java\n            \u2502       \u251c\u2500\u2500 RuleVersionEntityDynamicSqlSupport.java\n            \u2514\u2500\u2500     \u2514\u2500\u2500 RuleVersionMapper.java\n</code></pre>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#mybatis-dynamic-sql","title":"\u4f7f\u7528 MyBatis Dynamic SQL \u5904\u7406\u590d\u6742\u5b50\u67e5\u8be2","text":""},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#_10","title":"\u9700\u6c42\u63cf\u8ff0","text":"<p>\u6839\u636e\u63d0\u4f9b\u7684\u5efa\u8868\u8bed\u53e5\uff0c\u4ee5\u4e0b\u662f\u4e24\u4e2a\u8868\u7684ER\u56fe\uff08\u4f7f\u7528mermaid\u8bed\u6cd5\u8868\u793a\uff09\uff0c\u5c55\u793a\u4e86 \u4e00\u4e2a\u89c4\u5219\uff08rule\uff09\u5bf9\u5e94\u591a\u4e2a\u89c4\u5219\u7248\u672c\uff08rule_version\uff09 \u7684\u4e00\u5bf9\u591a\u5173\u7cfb\uff1a</p> <pre><code>erDiagram\n    rule ||--o{ rule_version : \"1:N\"\n    rule {\n        bigint id PK \"\u4e3b\u952e\"\n        timestamp gmt_create \"\u521b\u5efa\u65f6\u95f4\"\n        timestamp gmt_modified \"\u4fee\u6539\u65f6\u95f4\"\n        varchar(64) rule_id \"\u89c4\u5219ID\"\n        varchar(32) domain \"\u4e1a\u52a1\u57df\"\n        varchar(128) name \"\u89c4\u5219\u540d\u79f0\"\n        varchar(512) description \"\u89c4\u5219\u63cf\u8ff0\"\n        varchar(32) type \"\u89c4\u5219\u7c7b\u578b\"\n        varchar(32) creator \"\u521b\u5efa\u8005\"\n        varchar(32) modifier \"\u66f4\u65b0\u8005\"\n        varchar(32) tenant_id \"\u79df\u6237ID\"\n        text ext_info \"\u6269\u5c55\u5b57\u6bb5\"\n    }\n    rule_version {\n        bigint id PK \"\u4e3b\u952e\"\n        timestamp gmt_create \"\u521b\u5efa\u65f6\u95f4\"\n        timestamp gmt_modified \"\u4fee\u6539\u65f6\u95f4\"\n        varchar(32) rule_id \"\u89c4\u5219ID\uff08FK\uff09\"\n        int version \"\u7248\u672c\u53f7\"\n        varchar(128) name \"\u7248\u672c\u540d\u79f0\"\n        varchar(512) description \"\u7248\u672c\u63cf\u8ff0\"\n        varchar(32) status \"\u72b6\u6001\"\n        varchar(32) creator \"\u521b\u5efa\u4eba\"\n        varchar(32) modifier \"\u66f4\u65b0\u4eba\"\n        text ext_info \"\u6269\u5c55\u5b57\u6bb5\"\n        varchar(1024) config \"\u89c4\u5219\u914d\u7f6e\"\n    }\n</code></pre> <p>\u9700\u6c42\u63cf\u8ff0\uff1a\u6839\u636e\u524d\u9762\u7684\u63d0\u4f9b\u7684\u4e24\u4e2a\u8868\uff0c\u5206\u9875\u67e5\u8be2\u89c4\u5219\u4fe1\u606f\u548c\u89c4\u5219\u5bf9\u5e94\u7684\u6700\u5927\u7248\u672c\u4fe1\u606f\u5e76\u6309\u7167\u89c4\u5219\u7248\u672c\u7684\u66f4\u65b0\u65f6\u95f4\u5012\u5e8f\u6392\u5217</p> <p>\u9700\u6c42\u5206\u6790\uff1a\u6211\u4eec\u53ef\u4ee5\u5148\u83b7\u53d6\u6bcf\u4e2a\u89c4\u5219\u7684\u6700\u65b0\u7248\u672c\u8bb0\u5f55\uff08\u6700\u5927\u7248\u672c\u53f7\u5bf9\u5e94\u7684\u8bb0\u5f55\uff09\uff0c\u7136\u540e\u4e0e\u89c4\u5219\u7248\u672c\u8868\u518d\u6b21\u5173\u8054\u4ee5\u83b7\u53d6\u6700\u65b0\u7248\u672c\u7684\u5b8c\u6574\u4fe1\u606f\uff0c\u6700\u540e\u518d\u4e0e\u89c4\u5219\u8868\u5173\u8054\u3002</p> <p>\u9700\u6c42\u5b9e\u73b0\uff1a\u6839\u636e\u9700\u6c42\uff0c\u9700\u8981\u67e5\u8be2\u89c4\u5219\u4fe1\u606f\u53ca\u5176\u5bf9\u5e94\u7684\u6700\u65b0\u7248\u672c\u4fe1\u606f\uff08\u6700\u5927\u7248\u672c\u53f7\uff09\uff0c\u5e76\u6309\u7248\u672c\u66f4\u65b0\u65f6\u95f4\u5012\u5e8f\u6392\u5217\u3002\u4ee5\u4e0b\u662f\u5b9e\u73b0\u8be5\u67e5\u8be2\u7684SQL\u8bed\u53e5\uff1a</p> <pre><code>SELECT ruleDO.id AS id, ruleDO.rule_id AS ruleId, ruleDO.name AS name, ruleDO.domain AS domain, max_version AS latestVersion\n    , ruleVersionDO.name AS versionName, ruleVersionDO.status AS versionStatus, ruleVersionDO.gmt_modified AS versionModifiedDate\nFROM rule ruleDO\n    JOIN rule_version ruleVersionDO ON ruleDO.rule_id = ruleVersionDO.rule_id\n    JOIN (\n        SELECT ruleVersionDO.rule_id AS rule_uuid, MAX(ruleVersionDO.version) AS max_version\n        FROM rule_version ruleVersionDO\n        WHERE ruleVersionDO.id &gt; #{parameters.p1,jdbcType=BIGINT}\n            AND ruleVersionDO.modifier LIKE #{parameters.p2,jdbcType=VARCHAR}\n            AND ruleVersionDO.gmt_create &gt;= #{parameters.p3,jdbcType=TIMESTAMP}\n            AND ruleVersionDO.gmt_create &lt;= #{parameters.p4,jdbcType=TIMESTAMP}\n            AND ruleVersionDO.gmt_modified &gt;= #{parameters.p5,jdbcType=TIMESTAMP}\n            AND ruleVersionDO.gmt_modified &lt;= #{parameters.p6,jdbcType=TIMESTAMP}\n            AND ruleVersionDO.description LIKE #{parameters.p7,jdbcType=VARCHAR}\n            AND ruleVersionDO.name LIKE #{parameters.p8,jdbcType=VARCHAR}\n            AND ruleVersionDO.status = #{parameters.p9,jdbcType=VARCHAR}\n        GROUP BY ruleVersionDO.rule_id\n    ) max_ver\n    ON ruleVersionDO.rule_id = max_ver.rule_uuid\n        AND ruleVersionDO.version = max_ver.max_version\nWHERE ruleDO.id &gt; #{parameters.p10,jdbcType=BIGINT}\n    AND ruleDO.tenant_id = #{parameters.p11,jdbcType=VARCHAR}\n    AND ruleDO.rule_id LIKE #{parameters.p12,jdbcType=VARCHAR}\n    AND ruleDO.name LIKE #{parameters.p13,jdbcType=VARCHAR}\n    AND ruleDO.creator LIKE #{parameters.p14,jdbcType=VARCHAR}\n    AND ruleDO.type = #{parameters.p15,jdbcType=VARCHAR}\n    AND ruleDO.domain = #{parameters.p16,jdbcType=VARCHAR}\n    AND ruleDO.description LIKE #{parameters.p17,jdbcType=VARCHAR}\nORDER BY ruleVersionDO.id\nLIMIT #{parameters.p19}, #{parameters.p18}\n</code></pre>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#_11","title":"\u9700\u6c42\u5206\u6790","text":"<p>\u5728springboot \u4e2d\u4f7f\u7528 mybatis dynamic sql \u5b9e\u73b0\u4e0a\u9762\u7684sql\u8bed\u53e5\uff0c\u6211\u4eec\u9996\u5148\u9700\u8981\u5206\u6790\u8fd9\u4e2aSQL\u8bed\u53e5\u7684\u7ed3\u6784\u3002\u8be5SQL\u8bed\u53e5\u7684\u4e3b\u8981\u90e8\u5206\u5305\u62ec\uff1a</p> <ol> <li>\u4ecerule\u8868\uff08\u522b\u540d\u4e3aruleDO\uff09\u548crule_version\u8868\uff08\u522b\u540d\u4e3aruleVersionDO\uff09\u4e2d\u9009\u53d6\u5b57\u6bb5\u3002</li> <li>\u4f7f\u7528\u4e00\u4e2a\u5b50\u67e5\u8be2\uff08\u522b\u540d\u4e3amax_ver\uff09\u6765\u83b7\u53d6\u6bcf\u4e2arule_id\u7684\u6700\u5927\u7248\u672c\u53f7\uff0c\u540c\u65f6\u5b50\u67e5\u8be2\u4e2d\u6709\u4e00\u7cfb\u5217\u7684\u6761\u4ef6\u3002</li> <li>\u5c06ruleDO\u548cruleVersionDO\u8868\u4e0e\u5b50\u67e5\u8be2max_ver\u8fdb\u884c\u8fde\u63a5\uff0c\u8fde\u63a5\u6761\u4ef6\u662frule_id\u76f8\u7b49\u5e76\u4e14\u7248\u672c\u53f7\u7b49\u4e8e\u6700\u5927\u7248\u672c\u3002</li> <li>\u5bf9ruleDO\u8868\u6709\u4e00\u7cfb\u5217\u7684\u6761\u4ef6\u3002</li> <li>\u6309\u7167ruleVersionDO.id\u6392\u5e8f\uff0c\u5e76\u5206\u9875\u3002</li> </ol> <p>\u5728MyBatis Dynamic SQL\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u6784\u5efa\uff1a</p> <p>\u6b65\u9aa4\uff1a</p> <ol> <li>\u521b\u5efarule\u548crule_version\u8868\u7684\u52a8\u6001SQL\u652f\u6301\u7c7b\uff08\u901a\u5e38\u4f7f\u7528\u4ee3\u7801\u751f\u6210\u5668\u751f\u6210\uff0c\u8fd9\u91cc\u5047\u8bbe\u6211\u4eec\u5df2\u7ecf\u6709\u4e86RuleDynamicSqlSupport\u548cRuleVersionDynamicSqlSupport\uff09\u3002</li> <li>\u5c06\u6574\u4e2a\u67e5\u8be2\u62c6\u5206\u4e3a\u51e0\u4e2a\u90e8\u5206\uff1a</li> </ol> <p>a. \u5b50\u67e5\u8be2\uff08max_ver\uff09\uff1a\u4ecerule_version\u8868\u4e2d\uff0c\u6839\u636e\u6761\u4ef6\u5206\u7ec4\u83b7\u53d6\u6bcf\u4e2arule_id\u7684\u6700\u5927\u7248\u672c\u3002</p> <p>b. \u4e3b\u67e5\u8be2\uff1a\u8fde\u63a5rule\u3001rule_version\u548c\u5b50\u67e5\u8be2max_ver\uff0c\u5e76\u6dfb\u52a0\u6761\u4ef6\uff0c\u6700\u540e\u6392\u5e8f\u5206\u9875\u3002</p> <p>\u6ce8\u610f\uff1a\u7531\u4e8e\u5b50\u67e5\u8be2\u4e2d\u4f7f\u7528\u4e86\u591a\u4e2a\u6761\u4ef6\uff0c\u4e14\u4e3b\u67e5\u8be2\u4e5f\u6709\u591a\u4e2a\u6761\u4ef6\uff0c\u6211\u4eec\u9700\u8981\u5206\u522b\u6784\u5efa\u3002</p>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#mybatis-dynamic-sql_1","title":"\u4f7f\u7528 mybatis dynamic sql \u5b9e\u73b0","text":"<p>\u53c2\u8003\u524d\u9762Mybatis Generator\u6839\u636e\u8868\u7ed3\u6784\u81ea\u52a8\u751f\u6210\u7684\u8868\u5b9a\u4e49\u7c7b\u3002</p>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#1_1","title":"1. \u521b\u5efa\u8868\u5b9a\u4e49","text":"<p>\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>import jakarta.annotation.Generated;\nimport java.sql.JDBCType;\nimport java.util.Date;\nimport org.mybatis.dynamic.sql.AliasableSqlTable;\nimport org.mybatis.dynamic.sql.SqlColumn;\n\n// \u81ea\u52a8\u751f\u6210\u7684\u8868\u5b9a\u4e49\u7c7b\uff08\u7531MyBatis Generator\u521b\u5efa\uff09\npublic final class RuleVersionEntityDynamicSqlSupport {\n    @Generated(\"org.mybatis.generator.api.MyBatisGenerator\")\n    public static final RuleVersionEntity ruleVersionEntity = new RuleVersionEntity();\n\n    @Generated(\"org.mybatis.generator.api.MyBatisGenerator\")\n    public static final SqlColumn&lt;Long&gt; id = ruleVersionEntity.id;\n\n    @Generated(\"org.mybatis.generator.api.MyBatisGenerator\")\n    public static final SqlColumn&lt;Date&gt; gmtCreate = ruleVersionEntity.gmtCreate;\n\n    @Generated(\"org.mybatis.generator.api.MyBatisGenerator\")\n    public static final SqlColumn&lt;Date&gt; gmtModified = ruleVersionEntity.gmtModified;\n\n    @Generated(\"org.mybatis.generator.api.MyBatisGenerator\")\n    public static final SqlColumn&lt;String&gt; ruleId = ruleVersionEntity.ruleId;\n\n    @Generated(\"org.mybatis.generator.api.MyBatisGenerator\")\n    public static final SqlColumn&lt;Integer&gt; version = ruleVersionEntity.version;\n\n    @Generated(\"org.mybatis.generator.api.MyBatisGenerator\")\n    public static final SqlColumn&lt;String&gt; name = ruleVersionEntity.name;\n\n    @Generated(\"org.mybatis.generator.api.MyBatisGenerator\")\n    public static final SqlColumn&lt;String&gt; description = ruleVersionEntity.description;\n\n    @Generated(\"org.mybatis.generator.api.MyBatisGenerator\")\n    public static final SqlColumn&lt;String&gt; status = ruleVersionEntity.status;\n\n    @Generated(\"org.mybatis.generator.api.MyBatisGenerator\")\n    public static final SqlColumn&lt;String&gt; creator = ruleVersionEntity.creator;\n\n    @Generated(\"org.mybatis.generator.api.MyBatisGenerator\")\n    public static final SqlColumn&lt;String&gt; modifier = ruleVersionEntity.modifier;\n\n    @Generated(\"org.mybatis.generator.api.MyBatisGenerator\")\n    public static final SqlColumn&lt;String&gt; config = ruleVersionEntity.config;\n\n    @Generated(\"org.mybatis.generator.api.MyBatisGenerator\")\n    public static final SqlColumn&lt;String&gt; extInfo = ruleVersionEntity.extInfo;\n\n    @Generated(\"org.mybatis.generator.api.MyBatisGenerator\")\n    public static final class RuleVersionEntity extends AliasableSqlTable&lt;RuleVersionEntity&gt; {\n        public final SqlColumn&lt;Long&gt; id = column(\"id\", JDBCType.BIGINT);\n\n        public final SqlColumn&lt;Date&gt; gmtCreate = column(\"gmt_create\", JDBCType.TIMESTAMP);\n\n        public final SqlColumn&lt;Date&gt; gmtModified = column(\"gmt_modified\", JDBCType.TIMESTAMP);\n\n        public final SqlColumn&lt;String&gt; ruleId = column(\"rule_id\", JDBCType.VARCHAR);\n\n        public final SqlColumn&lt;Integer&gt; version = column(\"version\", JDBCType.INTEGER);\n\n        public final SqlColumn&lt;String&gt; name = column(\"name\", JDBCType.VARCHAR);\n\n        public final SqlColumn&lt;String&gt; description = column(\"description\", JDBCType.VARCHAR);\n\n        public final SqlColumn&lt;String&gt; status = column(\"status\", JDBCType.VARCHAR);\n\n        public final SqlColumn&lt;String&gt; creator = column(\"creator\", JDBCType.VARCHAR);\n\n        public final SqlColumn&lt;String&gt; modifier = column(\"modifier\", JDBCType.VARCHAR);\n\n        public final SqlColumn&lt;String&gt; config = column(\"config\", JDBCType.VARCHAR);\n\n        public final SqlColumn&lt;String&gt; extInfo = column(\"ext_info\", JDBCType.LONGVARCHAR);\n\n        public RuleVersionEntity() {\n            super(\"rule_version\", RuleVersionEntity::new);\n        }\n    }\n}\n</code></pre>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#2-mybatis-dynamic-sql","title":"2. \u6784\u5efaMyBatis Dynamic SQL\u590d\u6742\u67e5\u8be2","text":"<pre><code>import com.example.demo.common.model.page.PageRequest;\nimport com.example.demo.model.query.RuleQueryCondition;\nimport com.example.demo.repository.generated.RuleEntityDynamicSqlSupport;\nimport com.example.demo.repository.generated.RuleVersionEntityDynamicSqlSupport;\nimport org.mybatis.dynamic.sql.SortSpecification;\nimport org.mybatis.dynamic.sql.SqlColumn;\nimport org.mybatis.dynamic.sql.SqlTable;\nimport org.mybatis.dynamic.sql.select.ColumnSortSpecification;\nimport org.mybatis.dynamic.sql.select.QueryExpressionDSL;\nimport org.mybatis.dynamic.sql.select.SelectModel;\nimport org.mybatis.dynamic.sql.select.render.SelectStatementProvider;\nimport org.mybatis.dynamic.sql.render.RenderingStrategies;\nimport org.springframework.stereotype.Component;\n\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.sql.JDBCType;\n\nimport static org.mybatis.dynamic.sql.SqlBuilder.*;\n\n@Component\npublic class RuleQueryBuilder {\n    private final RuleVersionEntityDynamicSqlSupport.RuleVersionEntity ruleVersionDO = RuleVersionEntityDynamicSqlSupport.ruleVersionEntity;\n    private final RuleEntityDynamicSqlSupport.RuleEntity ruleDO = RuleEntityDynamicSqlSupport.ruleEntity;\n\n    // \u6570\u636e\u67e5\u8be2\n    public SelectStatementProvider buildDataQuery(RuleQueryCondition queryCondition, PageRequest pageRequest) {\n\n        // 1. \u521b\u5efa\u5b50\u67e5\u8be2\u8868\u7684\u522b\u540d\u548c\u5217\u5b9a\u4e49\n        // \u5b50\u67e5\u8be2\u7684\u8868\u522b\u540d\n        String subQueryTable = \"max_ver\";\n        SqlTable maxVerTable = SqlTable.of(subQueryTable);\n        SqlColumn&lt;String&gt; maxVerRuleUuid = SqlColumn.of(\"rule_uuid\", maxVerTable, JDBCType.VARCHAR);\n        SqlColumn&lt;Integer&gt; maxVerMaxVersion = SqlColumn.of(\"max_version\", maxVerTable, JDBCType.INTEGER);\n        // \u52a8\u6001\u6784\u5efa\u6392\u5e8f\n        List&lt;SortSpecification&gt; sortSpecs = new ArrayList&lt;&gt;();\n        SortSpecification sortSpecification = buildSortSpecification(pageRequest.getSort(), pageRequest.getOrder());\n        if (sortSpecification != null) {\n            sortSpecs.add(sortSpecification);\n        }\n\n        // 2.\u6784\u5efa\u5b50\u67e5\u8be2\n        QueryExpressionDSL&lt;SelectModel&gt;.GroupByFinisher maxVersionSubQuery = buildMaxVersionSubQuery(queryCondition);\n\n        // 3. \u4e3b\u67e5\u8be2\uff1a\u5173\u8054\u89c4\u5219\u8868\u3001\u7248\u672c\u8868\u548c\u6700\u5927\u7248\u672c\u5b50\u67e5\u8be2\n        return select(\n                ruleDO.id.as(\"id\"),\n                ruleDO.ruleId.as(\"ruleId\"),\n                ruleDO.name.as(\"name\"),\n                ruleDO.domain.as(\"domain\"),\n                maxVerMaxVersion.as(\"latestVersion\"),\n                ruleVersionDO.name.as(\"versionName\"),\n                ruleVersionDO.status.as(\"versionStatus\"),\n                ruleVersionDO.gmtModified.as(\"versionModifiedDate\")\n        )\n                .from(ruleDO, \"ruleDO\")\n                .join(ruleVersionDO, \"ruleVersionDO\")\n                .on(ruleDO.ruleId, equalTo(ruleVersionDO.ruleId))\n                .join(maxVersionSubQuery, subQueryTable)\n                .on(ruleVersionDO.ruleId, equalTo(maxVerRuleUuid.qualifiedWith(subQueryTable)))\n                .and(ruleVersionDO.version, equalTo(maxVerMaxVersion.qualifiedWith(subQueryTable)))\n                .where(ruleDO.id, isGreaterThan(0L))\n                .and(ruleDO.tenantId, isEqualToWhenPresent(queryCondition.getTenantId()))\n                .and(ruleDO.ruleId, isLikeWhenPresent(wrapLike(queryCondition.getRuleId())))\n                .and(ruleDO.name, isLikeWhenPresent(wrapLike(queryCondition.getName())))\n                .and(ruleDO.creator, isLikeWhenPresent(wrapLike(queryCondition.getCreateBy())))\n                .and(ruleDO.type, isEqualToWhenPresent(queryCondition.getType()))\n                .and(ruleDO.domain, isEqualToWhenPresent(queryCondition.getDomain()))\n                .and(ruleDO.description, isLikeWhenPresent(wrapLike(queryCondition.getDescription())))\n                .orderBy(sortSpecs.toArray(new SortSpecification[0]))\n                .limit(pageRequest.getPageSize())\n                .offset(pageRequest.getOffset())\n                .build()\n                .render(RenderingStrategies.MYBATIS3);\n\n    }\n\n    // \u603b\u6570\u67e5\u8be2\n    public SelectStatementProvider buildCountQuery(RuleQueryCondition queryCondition) {\n        // 1. \u521b\u5efa\u6d3e\u751f\u8868\u7684\u522b\u540d\u548c\u5217\u5b9a\u4e49\n\n        String subQueryTable = \"max_ver\";\n        SqlTable maxVerTable = SqlTable.of(subQueryTable);\n        SqlColumn&lt;String&gt; maxVerRuleUuid = SqlColumn.of(\"rule_uuid\", maxVerTable, JDBCType.VARCHAR);\n        SqlColumn&lt;Integer&gt; maxVerMaxVersion = SqlColumn.of(\"max_version\", maxVerTable, JDBCType.INTEGER);\n        // 2. \u6784\u5efa\u5b50\u67e5\u8be2\n        QueryExpressionDSL&lt;SelectModel&gt;.GroupByFinisher maxVersionSubQuery = buildMaxVersionSubQuery(queryCondition);\n\n        // 3. \u4e3b\u67e5\u8be2\uff1a\u5173\u8054\u89c4\u5219\u8868\u3001\u7248\u672c\u8868\u548c\u6700\u5927\u7248\u672c\u5b50\u67e5\u8be2\n        return select(count())\n                .from(ruleDO, \"ruleDO\")\n                .join(ruleVersionDO, \"ruleVersionDO\")\n                .on(ruleDO.ruleId, equalTo(ruleVersionDO.ruleId))\n                .join(maxVersionSubQuery, subQueryTable)\n                .on(ruleVersionDO.ruleId, equalTo(maxVerRuleUuid.qualifiedWith(subQueryTable)))\n                .and(ruleVersionDO.version, equalTo(maxVerMaxVersion.qualifiedWith(subQueryTable)))\n                .where(ruleVersionDO.id, isGreaterThan(0L))  // \u786e\u4fddwhere\u6761\u4ef6\u6709\u503c\n                .and(ruleDO.tenantId, isEqualToWhenPresent(queryCondition.getTenantId()))\n                .and(ruleDO.ruleId, isLikeWhenPresent(wrapLike(queryCondition.getRuleId())))\n                .and(ruleDO.name, isLikeWhenPresent(wrapLike(queryCondition.getName())))\n                .and(ruleDO.creator, isLikeWhenPresent(wrapLike(queryCondition.getCreateBy())))\n                .and(ruleDO.type, isEqualToWhenPresent(queryCondition.getType()))\n                .and(ruleDO.domain, isEqualToWhenPresent(queryCondition.getDomain()))\n                .and(ruleDO.description, isLikeWhenPresent(wrapLike(queryCondition.getDescription())))\n                .build()\n                .render(RenderingStrategies.MYBATIS3);\n    }\n\n    // \u516c\u5171\u65b9\u6cd5\uff1a\u6784\u5efa\u6700\u5927\u7248\u672c\u5b50\u67e5\u8be2\n    private QueryExpressionDSL&lt;SelectModel&gt;.GroupByFinisher buildMaxVersionSubQuery(RuleQueryCondition queryCondition) {\n        return select(\n                ruleVersionDO.ruleId.as(\"rule_uuid\"),\n                max(ruleVersionDO.version).as(\"max_version\"))\n                .from(ruleVersionDO)\n                .where(ruleVersionDO.id, isGreaterThan(0L))\n                .and(ruleVersionDO.modifier, isLikeWhenPresent(wrapLike(queryCondition.getUpdateBy())))\n                .and(ruleVersionDO.gmtCreate, isGreaterThanOrEqualToWhenPresent(queryCondition.getGmtCreateFrom()))\n                .and(ruleVersionDO.gmtCreate, isLessThanOrEqualToWhenPresent(queryCondition.getGmtCreateTo()))\n                .and(ruleVersionDO.gmtModified, isGreaterThanOrEqualToWhenPresent(queryCondition.getGmtModifiedFrom()))\n                .and(ruleVersionDO.gmtModified, isLessThanOrEqualToWhenPresent(queryCondition.getGmtModifiedTo()))\n                .and(ruleVersionDO.description, isLikeWhenPresent(wrapLike(queryCondition.getRuleVersionDesc())))\n                .and(ruleVersionDO.name, isLikeWhenPresent(wrapLike(queryCondition.getRuleVersionName())))\n                .and(ruleVersionDO.status, isEqualToWhenPresent(queryCondition.getStatus()))\n\n                .groupBy(ruleVersionDO.ruleId);\n    }\n\n    private SortSpecification buildSortSpecification(String field, String order) {\n        if (field == null) {\n            return new ColumnSortSpecification(\"ruleVersionDO\", ruleVersionDO.id);\n        }\n        ColumnSortSpecification columnSortSpecification;\n        switch (field) {\n            case \"gmtCreate\" -&gt;\n                    columnSortSpecification = new ColumnSortSpecification(\"ruleVersionDO\", ruleVersionDO.gmtCreate);\n            case \"gmtModified\" -&gt;\n                    columnSortSpecification = new ColumnSortSpecification(\"ruleVersionDO\", ruleVersionDO.gmtModified);\n            // \u5176\u4ed6\u5b57\u6bb5...\n            // \u9ed8\u8ba4\u6392\u5e8f\u903b\u8f91\n            default -&gt; columnSortSpecification = new ColumnSortSpecification(\"ruleVersionDO\", ruleVersionDO.id);\n        }\n\n        return \"asc\".equalsIgnoreCase(order) ? columnSortSpecification : columnSortSpecification.descending();\n    }\n\n\n    private String wrapLike(String value) {\n        return value != null ? \"%\" + value + \"%\" : null;\n    }\n\n\n}\n</code></pre> <p>\u5728\u4f7f\u7528MyBatis Dynamic SQL\u5904\u7406\u590d\u6742\u7684JOIN\u6216\u5b50\u67e5\u8be2\u65f6\uff0c\u9700\u8981\u901a\u8fc7\u4e0b\u9762\u7684\u65b9\u5f0f\u521b\u5efa\u5b50\u67e5\u8be2\u7684\u8868\u548c\u5b57\u6bb5\u5b9a\u4e49\uff1a</p> <pre><code>// 1. \u521b\u5efa\u5b50\u67e5\u8be2\u8868\u7684\u522b\u540d\u548c\u5217\u5b9a\u4e49\n// \u5b50\u67e5\u8be2\u7684\u8868\u522b\u540d\nString subQueryTable = \"max_ver\";\nSqlTable maxVerTable = SqlTable.of(subQueryTable);\nSqlColumn&lt;String&gt; maxVerRuleUuid = SqlColumn.of(\"rule_uuid\", maxVerTable, JDBCType.VARCHAR);\nSqlColumn&lt;Integer&gt; maxVerMaxVersion = SqlColumn.of(\"max_version\", maxVerTable, JDBCType.INTEGER);\n</code></pre>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#3_3","title":"3. \u7ed3\u679c\u6620\u5c04","text":"<p>\u521b\u5efa\u81ea\u5b9a\u4e49\u7684Mapper\u63a5\u53e3\uff0c\u56e0\u4e3a\u5f53\u8fdb\u884cJOIN\u6216\u590d\u6742\u5b50\u67e5\u8be2\u65f6\uff0c\u67e5\u8be2\u7ed3\u679c\u901a\u5e38\u6d89\u53ca\u591a\u4e2a\u5b9e\u4f53\uff0c\u56e0\u6b64\u9700\u8981\u81ea\u5b9a\u4e49\u7ed3\u679c\u6620\u5c04\u3002MyBatis Dynamic SQL\u672c\u8eab\u4e0d\u5904\u7406\u7ed3\u679c\u6620\u5c04\uff0c\u4f60\u9700\u8981\uff1a</p> <ul> <li>\u4f7f\u7528\u6ce8\u89e3\uff1a\u5728Mapper\u63a5\u53e3\u7684\u65b9\u6cd5\u4e0a\u4f7f\u7528<code>@Results</code>\u548c<code>@Result</code>\u6ce8\u89e3\u5b9a\u4e49\u6620\u5c04\u5173\u7cfb\u3002</li> <li>\u4f7f\u7528XML\uff1a\u5728Mapper XML\u6587\u4ef6\u4e2d\u5b9a\u4e49<code>&lt;resultMap&gt;</code>\u3002</li> </ul> <pre><code>import com.example.demo.model.dto.response.RuleWithLatestVersionDTO;\nimport org.apache.ibatis.annotations.Mapper;\nimport org.apache.ibatis.annotations.Result;\nimport org.apache.ibatis.annotations.Results;\nimport org.apache.ibatis.annotations.SelectProvider;\nimport org.mybatis.dynamic.sql.select.render.SelectStatementProvider;\nimport org.mybatis.dynamic.sql.util.SqlProviderAdapter;\nimport org.mybatis.dynamic.sql.util.mybatis3.CommonCountMapper;\n\nimport java.util.List;\n\n@Mapper\npublic interface RuleCustomMapper extends CommonCountMapper {\n\n\n    // \u4f7f\u7528@Result\u6ce8\u89e3\u5904\u7406\u591a\u8868\u5b57\u6bb5\n    @SelectProvider(type = SqlProviderAdapter.class, method = \"select\")\n    @Results({\n            @Result(column = \"id\", property = \"id\"),\n            @Result(column = \"ruleId\", property = \"ruleId\"),\n            @Result(column = \"name\", property = \"name\"),\n            @Result(column = \"domain\", property = \"domain\"),\n            @Result(column = \"latestVersion\", property = \"latestVersion\"),\n            @Result(column = \"versionName\", property = \"versionName\"),\n            @Result(column = \"versionStatus\", property = \"versionStatus\"),\n            @Result(column = \"versionModifiedDate\", property = \"versionModifiedDate\"),\n    })\n    List&lt;RuleWithLatestVersionDTO&gt; findByCondition(SelectStatementProvider selectStatement);\n}\n</code></pre>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#_12","title":"\u5206\u9875\u67e5\u8be2\u5c01\u88c5","text":""},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#1-pagerequest","title":"1. \u5206\u9875\u8bf7\u6c42\u53c2\u6570\u7c7b\uff08PageRequest\uff09\uff1a","text":"<pre><code>import jakarta.validation.constraints.Max;\nimport jakarta.validation.constraints.Min;\nimport jakarta.validation.constraints.Pattern;\n\n\nimport java.util.List;\nimport java.util.Set;\n\n/**\n * \u5206\u9875\u8bf7\u6c42\u53c2\u6570\u5c01\u88c5\u7c7b\n */\n\n\npublic class PageRequest {\n\n    /**\n     * \u9ed8\u8ba4\u7b2c\u4e00\u9875\n     */\n    public static final int DEFAULT_PAGE_NUM = 1;\n\n    /**\n     * \u9ed8\u8ba4\u6bcf\u987510\u6761\n     */\n    public static final int DEFAULT_PAGE_SIZE = 10;\n\n    /**\n     * \u9ed8\u8ba4\u6392\u5e8f\u65b9\u5411 - \u5347\u5e8f\n     */\n    public static final String DEFAULT_ORDER = \"desc\";\n\n    /**\n     * \u6700\u5927\u5141\u8bb8\u7684\u6bcf\u9875\u8bb0\u5f55\u6570\n     */\n    public static final int MAX_PAGE_SIZE = 1000;\n\n    /**\n     * \u5f53\u524d\u9875\u7801\uff08\u4ece1\u5f00\u59cb\uff09\n     */\n    @Min(value = 1, message = \"\u9875\u7801\u4e0d\u80fd\u5c0f\u4e8e1\")\n    private int pageNum = DEFAULT_PAGE_NUM;\n\n    /**\n     * \u6bcf\u9875\u8bb0\u5f55\u6570\n     */\n    @Min(value = 1, message = \"\u6bcf\u9875\u6570\u91cf\u4e0d\u80fd\u5c0f\u4e8e1\")\n    @Max(value = MAX_PAGE_SIZE, message = \"\u6bcf\u9875\u6570\u91cf\u4e0d\u80fd\u8d85\u8fc7\" + MAX_PAGE_SIZE)\n    private int pageSize = DEFAULT_PAGE_SIZE;\n\n    /**\n     * \u6392\u5e8f\u5b57\u6bb5\n     */\n    private String sort;\n\n    /**\n     * \u6392\u5e8f\u65b9\u5411\n     * asc: \u5347\u5e8f\n     * desc: \u964d\u5e8f\n     */\n    @Pattern(regexp = \"asc|desc\", message = \"\u6392\u5e8f\u65b9\u5411\u5fc5\u987b\u662fasc\u6216desc\")\n    private String order = DEFAULT_ORDER;\n\n    // \u65e0\u53c2\u6784\u9020\u5668\n    public PageRequest() {\n    }\n\n    /**\n     * \u5e26\u9875\u7801\u548c\u6bcf\u9875\u6570\u91cf\u7684\u6784\u9020\u5668\n     *\n     * @param pageNum  \u5f53\u524d\u9875\u7801\n     * @param pageSize \u6bcf\u9875\u6570\u91cf\n     */\n    public PageRequest(int pageNum, int pageSize) {\n        this.pageNum = pageNum;\n        this.pageSize = pageSize;\n    }\n\n    /**\n     * \u5e26\u6240\u6709\u53c2\u6570\u7684\u6784\u9020\u5668\n     *\n     * @param pageNum  \u5f53\u524d\u9875\u7801\n     * @param pageSize \u6bcf\u9875\u6570\u91cf\n     * @param sort     \u6392\u5e8f\u5b57\u6bb5\n     * @param order    \u6392\u5e8f\u65b9\u5411\n     */\n    public PageRequest(int pageNum, int pageSize, String sort, String order) {\n        this.pageNum = pageNum;\n        this.pageSize = pageSize;\n        this.sort = sort;\n        this.order = order;\n    }\n\n    /**\n     * \u8ba1\u7b97\u504f\u79fb\u91cf\uff08\u7528\u4e8e\u6570\u636e\u5e93\u5206\u9875\u67e5\u8be2\uff09\n     *\n     * @return \u5f53\u524d\u9875\u7684\u8d77\u59cb\u4f4d\u7f6e\n     */\n    public int getOffset() {\n        return (pageNum - 1) * pageSize;\n    }\n\n    /**\n     * \u9a8c\u8bc1\u6392\u5e8f\u5b57\u6bb5\u662f\u5426\u5728\u5141\u8bb8\u7684\u5217\u8868\u4e2d\n     *\n     * @param allowedFields \u5141\u8bb8\u7684\u6392\u5e8f\u5b57\u6bb5\u96c6\u5408\n     * @return \u5982\u679c\u6392\u5e8f\u5b57\u6bb5\u6709\u6548\u8fd4\u56detrue\uff0c\u5426\u5219\u8fd4\u56defalse\n     */\n    public boolean isSortValid(Set&lt;String&gt; allowedFields) {\n        if (sort == null || sort.isEmpty()) {\n            return true;\n        }\n        return allowedFields.contains(sort);\n    }\n\n    /**\n     * \u9a8c\u8bc1\u6392\u5e8f\u5b57\u6bb5\u662f\u5426\u5728\u5141\u8bb8\u7684\u5217\u8868\u4e2d\uff0c\u65e0\u6548\u65f6\u629b\u51fa\u5f02\u5e38\n     *\n     * @param allowedFields \u5141\u8bb8\u7684\u6392\u5e8f\u5b57\u6bb5\u96c6\u5408\n     * @param errorMessage  \u9519\u8bef\u4fe1\u606f\n     * @throws IllegalArgumentException \u5982\u679c\u6392\u5e8f\u5b57\u6bb5\u65e0\u6548\n     */\n    public void validateSort(List&lt;String&gt; allowedFields, String errorMessage) {\n        if (sort != null &amp;&amp; !sort.isEmpty() &amp;&amp; !allowedFields.contains(sort)) {\n            throw new IllegalArgumentException(errorMessage);\n        }\n    }\n\n    public int getPageNum() {\n        return pageNum;\n    }\n\n    public void setPageNum(int pageNum) {\n        this.pageNum = pageNum;\n    }\n\n    public int getPageSize() {\n        return pageSize;\n    }\n\n    public void setPageSize(int pageSize) {\n        this.pageSize = pageSize;\n    }\n\n    public String getSort() {\n        return sort;\n    }\n\n    public void setSort(String sort) {\n        this.sort = sort;\n    }\n\n    public String getOrder() {\n        return order;\n    }\n\n    public void setOrder(String order) {\n        this.order = order;\n    }\n}\n</code></pre>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#2-pageresult","title":"2. \u5206\u9875\u7ed3\u679c\u7c7b\uff08PageResult\uff09\uff1a","text":"<pre><code>import java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.List;\nimport java.util.function.BiFunction;\nimport java.util.function.Function;\nimport java.util.stream.Collectors;\n\n\npublic class PageResult&lt;T&gt; {\n\n    private final int pageNum;        // \u5f53\u524d\u9875\u7801\n    private final int pageSize;        // \u6bcf\u9875\u6570\u91cf\n    private final long total;      // \u603b\u8bb0\u5f55\u6570\n    private final int totalPage;       // \u603b\u9875\u6570\n    private final List&lt;T&gt; data;    // \u5f53\u524d\u9875\u6570\u636e\n    private final String sort;     // \u6392\u5e8f\u5b57\u6bb5\n    private final String order;    // \u6392\u5e8f\u65b9\u5411\n\n    /**\n     * \u6784\u9020\u51fd\u6570\n     *\n     * @param pageRequest \u5206\u9875\u8bf7\u6c42\n     * @param total       \u603b\u8bb0\u5f55\u6570\n     * @param data        \u5f53\u524d\u9875\u6570\u636e\n     */\n    public PageResult(PageRequest pageRequest, long total, List&lt;T&gt; data) {\n        this.pageNum = pageRequest.getPageNum();\n        this.pageSize = pageRequest.getPageSize();\n        this.sort = pageRequest.getSort();\n        this.order = pageRequest.getOrder();\n        this.total = total;\n        this.totalPage = calculateTotalPage(total, pageRequest.getPageSize());\n        this.data = data;\n    }\n\n    /**\n     * \u6784\u9020\u51fd\u6570\n     *\n     * @param pageNum  \u5f53\u524d\u9875\u7801\n     * @param pageSize  \u6bcf\u9875\u6570\u91cf\n     * @param total \u603b\u8bb0\u5f55\u6570\n     * @param data  \u5f53\u524d\u9875\u6570\u636e\n     * @param sort  \u6392\u5e8f\u5b57\u6bb5\n     * @param order \u6392\u5e8f\u65b9\u5411\n     */\n    public PageResult(int pageNum, int pageSize, long total, List&lt;T&gt; data, String sort, String order) {\n        this.pageNum = pageNum;\n        this.pageSize = pageSize;\n        this.total = total;\n        this.data = data != null ? data : Collections.emptyList();\n        this.sort = sort;\n        this.order = order;\n\n        // \u8ba1\u7b97\u603b\u9875\u6570\n        this.totalPage = calculateTotalPage(total, pageSize);\n    }\n\n    /**\n     * \u8ba1\u7b97\u603b\u9875\u6570\n     *\n     * @param total \u603b\u8bb0\u5f55\u6570\n     * @param size  \u6bcf\u9875\u6570\u91cf\n     * @return \u603b\u9875\u6570\n     */\n    private int calculateTotalPage(long total, int size) {\n        if (size &lt;= 0) return 0;\n        return (int) Math.ceil((double) total / size);\n    }\n\n\n    // ================ \u5b9e\u7528\u9759\u6001\u65b9\u6cd5 ================ //\n\n    /**\n     * \u521b\u5efa\u7a7a\u7684\u5206\u9875\u7ed3\u679c\n     *\n     * @param &lt;T&gt; \u6570\u636e\u7c7b\u578b\n     * @return \u7a7a\u7684\u5206\u9875\u7ed3\u679c\n     */\n    public static &lt;T&gt; PageResult&lt;T&gt; empty() {\n        return new PageResult&lt;&gt;(1, 0, 0, Collections.emptyList(), null, null);\n    }\n\n    /**\n     * \u57fa\u4e8e PageRequest \u521b\u5efa\u7a7a\u7684\u5206\u9875\u7ed3\u679c\n     *\n     * @param pageRequest \u5206\u9875\u8bf7\u6c42\n     * @param &lt;T&gt;         \u6570\u636e\u7c7b\u578b\n     * @return \u7a7a\u7684\u5206\u9875\u7ed3\u679c\n     */\n    public static &lt;T&gt; PageResult&lt;T&gt; empty(PageRequest pageRequest) {\n        return new PageResult&lt;&gt;(\n                pageRequest.getPageNum(),\n                pageRequest.getPageSize(),\n                0,\n                Collections.emptyList(),\n                pageRequest.getSort(),\n                pageRequest.getOrder()\n        );\n    }\n\n    /**\n     * \u521b\u5efa\u5355\u9875\u7ed3\u679c\uff08\u9002\u7528\u4e8e\u6570\u636e\u91cf\u5c0f\u7684\u60c5\u51b5\uff09\n     *\n     * @param data \u6240\u6709\u6570\u636e\n     * @param &lt;T&gt;  \u6570\u636e\u7c7b\u578b\n     * @return \u5355\u9875\u7ed3\u679c\n     */\n    public static &lt;T&gt; PageResult&lt;T&gt; singlePage(List&lt;T&gt; data) {\n        long total = data != null ? data.size() : 0;\n        return new PageResult&lt;&gt;(1, (int) total, total, data, null, null);\n    }\n\n    /**\n     * \u521b\u5efa\u5206\u9875\u7ed3\u679c\uff08\u57fa\u4e8e PageRequest\uff09\n     *\n     * @param pageRequest \u5206\u9875\u8bf7\u6c42\n     * @param total       \u603b\u8bb0\u5f55\u6570\n     * @param data        \u5f53\u524d\u9875\u6570\u636e\n     * @param &lt;T&gt;         \u6570\u636e\u7c7b\u578b\n     * @return \u5206\u9875\u7ed3\u679c\n     */\n    public static &lt;T&gt; PageResult&lt;T&gt; of(PageRequest pageRequest, long total, List&lt;T&gt; data) {\n        return new PageResult&lt;&gt;(\n                pageRequest.getPageNum(),\n                pageRequest.getPageSize(),\n                total,\n                data,\n                pageRequest.getSort(),\n                pageRequest.getOrder()\n        );\n    }\n\n    /**\n     * \u8f6c\u6362\u5206\u9875\u7ed3\u679c\u7684\u6570\u636e\u7c7b\u578b\n     *\n     * @param source \u6e90\u5206\u9875\u7ed3\u679c\n     * @param mapper \u6570\u636e\u8f6c\u6362\u51fd\u6570\n     * @param &lt;T&gt;    \u6e90\u6570\u636e\u7c7b\u578b\n     * @param &lt;R&gt;    \u76ee\u6807\u6570\u636e\u7c7b\u578b\n     * @return \u8f6c\u6362\u540e\u7684\u5206\u9875\u7ed3\u679c\n     */\n    public static &lt;T, R&gt; PageResult&lt;R&gt; map(PageResult&lt;T&gt; source, Function&lt;T, R&gt; mapper) {\n        if (source == null || mapper == null) {\n            throw new IllegalArgumentException(\"Source and mapper must not be null\");\n        }\n\n        List&lt;R&gt; mappedData = source.getData().stream()\n                .map(mapper)\n                .collect(Collectors.toList());\n\n        return new PageResult&lt;&gt;(\n                source.getPageNum(),\n                source.getPageSize(),\n                source.getTotal(),\n                mappedData,\n                source.getSort(),\n                source.getOrder()\n        );\n    }\n\n    /**\n     * \u5408\u5e76\u4e24\u4e2a\u5206\u9875\u7ed3\u679c\uff08\u9002\u7528\u4e8e\u5e76\u884c\u67e5\u8be2\u573a\u666f\uff09\n     *\n     * @param result1  \u7b2c\u4e00\u4e2a\u5206\u9875\u7ed3\u679c\n     * @param result2  \u7b2c\u4e8c\u4e2a\u5206\u9875\u7ed3\u679c\n     * @param combiner \u6570\u636e\u5408\u5e76\u51fd\u6570\n     * @param &lt;T&gt;      \u7b2c\u4e00\u4e2a\u7ed3\u679c\u7684\u6570\u636e\u7c7b\u578b\n     * @param &lt;U&gt;      \u7b2c\u4e8c\u4e2a\u7ed3\u679c\u7684\u6570\u636e\u7c7b\u578b\n     * @param &lt;R&gt;      \u5408\u5e76\u540e\u7684\u6570\u636e\u7c7b\u578b\n     * @return \u5408\u5e76\u540e\u7684\u5206\u9875\u7ed3\u679c\n     */\n    public static &lt;T, U, R&gt; PageResult&lt;R&gt; combine(\n            PageResult&lt;T&gt; result1,\n            PageResult&lt;U&gt; result2,\n            BiFunction&lt;T, U, R&gt; combiner) {\n\n        // \u9a8c\u8bc1\u5206\u9875\u4fe1\u606f\u662f\u5426\u4e00\u81f4\n        if (result1.getPageNum() != result2.getPageNum() ||\n                result1.getPageSize() != result2.getPageSize() ||\n                result1.getTotal() != result2.getTotal()) {\n            throw new IllegalArgumentException(\"Page results are not compatible for combination\");\n        }\n\n        // \u9a8c\u8bc1\u6570\u636e\u6570\u91cf\u662f\u5426\u4e00\u81f4\n        if (result1.getData().size() != result2.getData().size()) {\n            throw new IllegalArgumentException(\"Data lists have different sizes\");\n        }\n\n        // \u5408\u5e76\u6570\u636e\n        List&lt;R&gt; combinedData = new ArrayList&lt;&gt;();\n        for (int i = 0; i &lt; result1.getData().size(); i++) {\n            R combined = combiner.apply(\n                    result1.getData().get(i),\n                    result2.getData().get(i)\n            );\n            combinedData.add(combined);\n        }\n\n        return new PageResult&lt;&gt;(\n                result1.getPageNum(),\n                result1.getPageSize(),\n                result1.getTotal(),\n                combinedData,\n                result1.getSort(),\n                result1.getOrder()\n        );\n    }\n\n    public int getPageNum() {\n        return pageNum;\n    }\n\n    public int getPageSize() {\n        return pageSize;\n    }\n\n    public long getTotal() {\n        return total;\n    }\n\n    public int getTotalPage() {\n        return totalPage;\n    }\n\n    public List&lt;T&gt; getData() {\n        return data;\n    }\n\n    public String getSort() {\n        return sort;\n    }\n\n    public String getOrder() {\n        return order;\n    }\n}\n</code></pre>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#3-paginationutils","title":"3. \u521b\u5efa\u5206\u9875\u67e5\u8be2\u5de5\u5177\uff08PaginationUtils\uff09","text":"<pre><code>import java.util.List;\nimport java.util.function.Supplier;\n\npublic class PaginationUtils {\n\n    /**\n     * \u6267\u884c\u5206\u9875\u67e5\u8be2\uff08\u4f7f\u7528PageRequest\u5bf9\u8c61\uff09\n     *\n     * @param pageRequest   \u5206\u9875\u8bf7\u6c42\uff08\u5305\u542b\u9875\u7801\u3001\u5927\u5c0f\u3001\u6392\u5e8f\u7b49\u4fe1\u606f\uff09\n     * @param countFunction \u67e5\u8be2\u603b\u6570\u7684\u51fd\u6570\n     * @param dataFunction  \u67e5\u8be2\u6570\u636e\u7684\u51fd\u6570\n     * @return \u5206\u9875\u7ed3\u679c\n     */\n    public static &lt;T&gt; PageResult&lt;T&gt; paginate(PageRequest pageRequest,\n                                             Supplier&lt;Long&gt; countFunction,\n                                             Supplier&lt;List&lt;T&gt;&gt; dataFunction) {\n        // \u67e5\u8be2\u603b\u6570\n        long total = countFunction.get();\n\n        // \u5982\u679c\u6ca1\u6709\u6570\u636e\uff0c\u76f4\u63a5\u8fd4\u56de\u7a7a\u7ed3\u679c\n        if (total == 0) {\n            return PageResult.empty(pageRequest);\n        }\n\n        // \u67e5\u8be2\u5f53\u524d\u9875\u6570\u636e\n        List&lt;T&gt; data = dataFunction.get();\n\n        return new PageResult&lt;&gt;(pageRequest, total, data);\n    }\n}\n</code></pre>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#_13","title":"\u7edf\u4e00\u8fd4\u56de\u53c2\u6570\u548c\u5168\u5c40\u5f02\u5e38\u5904\u7406","text":""},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#_14","title":"\u7edf\u4e00\u8fd4\u56de\u53c2\u6570","text":"<p>\u5b9a\u4e49\u4e00\u4e2a <code>Result</code> \u7c7b\uff0c\u7528\u6765\u5c01\u88c5REST\u8bf7\u6c42\u7684\u8fd4\u56de\u7ed3\u679c\uff1a</p> <pre><code>package com.example.demo.common.model.response;\n\nimport com.example.demo.common.enums.AppErrorCode;\nimport com.example.demo.common.enums.ErrorCode;\n\nimport java.io.Serial;\nimport java.io.Serializable;\n\n/**\n * result \u7ed3\u679c\u7c7b\n *\n */\npublic class Result&lt;T&gt; implements Serializable {\n\n    @Serial\n    private static final long serialVersionUID = -1525914055479353120L;\n    /**\n     * \u9519\u8bef\u7801\n     */\n    private final String code;\n    /**\n     * \u63d0\u793a\u4fe1\u606f\n     */\n    private final String message;\n    /**\n     * \u8fd4\u56de\u6570\u636e\n     */\n    private final T data;\n    /**\n     * \u662f\u5426\u6210\u529f\n     */\n    private final Boolean success;\n\n    /**\n     * \u79c1\u6709\u6784\u9020\u65b9\u6cd5\uff0c\u4e0d\u5141\u8bb8\u76f4\u63a5\u521b\u5efa\u5bf9\u8c61\n     * \u4e5f\u5c31\u662f\u4e0d\u5141\u8bb8\u4f20\u5165\u81ea\u5b9a\u4e49\u7684\u9519\u8bef\u7801\uff0c\u6240\u6709\u9519\u8bef\u7801\u7684\u5b9a\u4e49\u5fc5\u987b\u5728\u679a\u4e3e\u4e2d\u5b9a\u4e49\n     *\n     * @param code    \u9519\u8bef\u7801\n     * @param message \u63d0\u793a\u4fe1\u606f\n     * @param data    \u8fd4\u56de\u7684\u6570\u636e\n     * @param success \u662f\u5426\u6210\u529f\n     */\n    private Result(String code, String message, T data, Boolean success) {\n        this.code = code;\n        this.message = message;\n        this.data = data;\n        this.success = success;\n    }\n\n\n    /**\n     * \u521b\u5efa Result \u5bf9\u8c61\n     *\n     * @param errorCode ErrorCode \u9519\u8bef\u7801\n     * @param data      \u8fd4\u56de\u7684\u6570\u636e\n     * @param success   \u662f\u5426\u6210\u529f\n     */\n    private static &lt;T&gt; Result&lt;T&gt; of(ErrorCode errorCode, T data, Boolean success) {\n        return new Result&lt;&gt;(errorCode.getCode(), errorCode.getMessage(), data, success);\n    }\n\n    /**\n     * \u6210\u529f\uff0c\u6ca1\u6709\u8fd4\u56de\u6570\u636e\n     *\n     * @param &lt;T&gt; \u8303\u578b\u53c2\u6570\n     * @return Result\n     */\n    public static &lt;T&gt; Result&lt;T&gt; success() {\n        return of(AppErrorCode.SUCCESS, null, true);\n    }\n\n    /**\n     * \u6210\u529f\uff0c\u6709\u8fd4\u56de\u6570\u636e\n     *\n     * @param data \u8fd4\u56de\u6570\u636e\n     * @param &lt;T&gt;  \u8303\u578b\u53c2\u6570\n     * @return Result\n     */\n    public static &lt;T&gt; Result&lt;T&gt; success(T data) {\n        return of(AppErrorCode.SUCCESS, data, true);\n    }\n\n    /**\n     * \u5931\u8d25\uff0c\u6709\u9519\u8bef\u4fe1\u606f\n     *\n     * @param message \u9519\u8bef\u4fe1\u606f\n     * @param &lt;T&gt;     \u8303\u578b\u53c2\u6570\n     * @return Result\n     */\n    public static &lt;T&gt; Result&lt;T&gt; fail(String message) {\n        return of(AppErrorCode.FAIL.setMessage(message), null, false);\n    }\n\n    /**\n     * \u5931\u8d25\uff0c\u6709\u9519\u8bef\u7801\u548c\u9519\u8bef\u4fe1\u606f\n     *\n     * @param errorCode ErrorCode \u9519\u8bef\u7801\n     * @param &lt;T&gt;       \u8303\u578b\u53c2\u6570\n     * @return Result\n     */\n    public static &lt;T&gt; Result&lt;T&gt; fail(ErrorCode errorCode) {\n        return of(errorCode, null, false);\n    }\n\n\n    /**\n     * \u83b7\u53d6\u9519\u8bef\u7801\n     *\n     * @return \u9519\u8bef\u7801\n     */\n    public String getCode() {\n        return code;\n    }\n\n    /**\n     * \u83b7\u53d6\u63d0\u793a\u4fe1\u606f\n     *\n     * @return \u63d0\u793a\u4fe1\u606f\n     */\n    public String getMessage() {\n        return message;\n    }\n\n    /**\n     * \u83b7\u53d6\u6570\u636e\n     *\n     * @return \u8fd4\u56de\u7684\u6570\u636e\n     */\n    public T getData() {\n        return data;\n    }\n\n    /**\n     * \u83b7\u53d6\u662f\u5426\u6210\u529f\n     *\n     * @return \u662f\u5426\u6210\u529f\n     */\n    public Boolean getSuccess() {\n        return success;\n    }\n}\n</code></pre>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#_15","title":"\u5168\u5c40\u5f02\u5e38\u5904\u7406","text":"<p>\u5728 Spring Boot \u4e2d\u4f7f\u7528 Validation \u53ef\u4ee5\u8f7b\u677e\u5b9e\u73b0\u6570\u636e\u6821\u9a8c\u529f\u80fd\uff0c\u786e\u4fdd\u5e94\u7528\u7a0b\u5e8f\u63a5\u6536\u7684\u6570\u636e\u7b26\u5408\u9884\u671f\u683c\u5f0f\u548c\u4e1a\u52a1\u89c4\u5219\u3002</p> <p>\u5f53\u4f7f\u7528 Validation \u6821\u9a8c\u5931\u8d25\u65f6\uff0c\u4f1a\u629b\u51fa\u5982\u4e0b\u7684\u5f02\u5e38\uff1a</p> <ul> <li><code>MethodArgumentNotValidException</code>\uff08\u5bf9\u4e8e\u8bf7\u6c42\u4f53\uff09</li> <li><code>ConstraintViolationException</code>\uff08\u5bf9\u4e8e\u8def\u5f84\u53d8\u91cf/\u8bf7\u6c42\u53c2\u6570\uff09\u3002</li> </ul> <p>\u53ef\u4ee5\u5b9a\u4e00\u4e2a<code>GlobalExceptionHandler</code>\u7c7b\uff0c\u5728\u7c7b\u4e0a\u6dfb\u52a0\u6ce8\u89e3<code>@RestControllerAdvice</code>\uff08 <code>@ControllerAdvice</code> + <code>@ResponseBody</code>\uff09\uff0c\u7528\u6765\u5b9e\u73b0\u5168\u5c40\u5f02\u5e38\u6355\u83b7\uff1a</p> <pre><code>import jakarta.servlet.http.HttpServletRequest;\nimport jakarta.validation.ConstraintViolationException;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.validation.FieldError;\nimport org.springframework.web.bind.MethodArgumentNotValidException;\nimport org.springframework.web.bind.annotation.ExceptionHandler;\nimport org.springframework.web.bind.annotation.RestControllerAdvice;\n\nimport java.util.HashMap;\nimport java.util.Map;\n\n\n@RestControllerAdvice(\"com.example.demo.controller\")\npublic class GlobalExceptionHandler {\n\n\n    /**\n     * \u5904\u7406\u8bf7\u6c42\u4f53\u6821\u9a8c\u5931\u8d25\n     *\n     * @param ex \u5f02\u5e38\n     * @return Result\n     */\n    @ExceptionHandler(MethodArgumentNotValidException.class)\n    public ResponseEntity&lt;?&gt; handleValidationExceptions(MethodArgumentNotValidException ex) {\n\n        Map&lt;String, String&gt; errors = new HashMap&lt;&gt;();\n        ex.getBindingResult().getAllErrors().forEach(error -&gt; {\n            String fieldName = ((FieldError) error).getField();\n            String errorMessage = error.getDefaultMessage();\n            errors.put(fieldName, errorMessage);\n\n        });\n        return ResponseEntity.badRequest().body(errors);\n\n    }\n\n    /**\n     * \u5904\u7406\u8def\u5f84\u53d8\u91cf\u6216\u8bf7\u6c42\u53c2\u6570\u6821\u9a8c\u5931\u8d25\n     *\n     * @param ex \u5f02\u5e38\n     * @return Result\n     */\n    @ExceptionHandler(ConstraintViolationException.class)\n    public ResponseEntity&lt;?&gt; handleConstraintViolationExceptions(ConstraintViolationException ex) {\n\n        Map&lt;String, String&gt; errors = new HashMap&lt;&gt;();\n        ex.getConstraintViolations().forEach(violation -&gt; {\n            String fieldName = violation.getPropertyPath().toString();\n            String errorMessage = violation.getMessage();\n            errors.put(fieldName, errorMessage);\n\n        });\n\n        return ResponseEntity.badRequest().body(errors);\n\n    }\n\n\n    /**\n     * \u5904\u7406\u672a\u77e5\u5f02\u5e38\n     *\n     * @param request \u8bf7\u6c42\u53c2\u6570\n     * @param e       \u5f02\u5e38\n     * @return Result\n     */\n    @ExceptionHandler(value = Throwable.class)\n    public ResponseEntity&lt;?&gt; unknownExceptionHandler(HttpServletRequest request, Throwable e) {\n        return ResponseEntity.badRequest().body(e.getMessage());\n    }\n\n}\n</code></pre>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#http","title":"\u901a\u8fc7 http \u63a5\u53e3\u63d0\u4f9b\u670d\u52a1","text":""},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#service","title":"Service\u5c42","text":"<pre><code>import com.example.demo.common.model.page.PageRequest;\nimport com.example.demo.common.model.page.PageResult;\nimport com.example.demo.common.model.page.PaginationUtils;\nimport com.example.demo.model.dto.response.RuleWithLatestVersionDTO;\nimport com.example.demo.model.query.RuleQueryCondition;\nimport com.example.demo.repository.custom.RuleCustomMapper;\nimport com.example.demo.repository.custom.builder.RuleQueryBuilder;\nimport com.example.demo.repository.generated.RuleMapper;\nimport com.example.demo.service.RuleService;\n\n\nimport org.mybatis.dynamic.sql.SqlColumn;\nimport org.mybatis.dynamic.sql.select.render.SelectStatementProvider;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\n\nimport java.util.Arrays;\nimport java.util.List;\n\n\n@Service\npublic class RuleServiceImpl implements RuleService {\n\n    private final RuleCustomMapper ruleCustomMapper;\n\n    private final RuleMapper ruleMapper;\n\n    private final RuleQueryBuilder ruleQueryBuilder;\n\n    @Autowired\n    public RuleServiceImpl(RuleMapper ruleMapper, RuleCustomMapper ruleCustomMapper, RuleQueryBuilder ruleQueryBuilder) {\n        this.ruleMapper = ruleMapper;\n        this.ruleCustomMapper = ruleCustomMapper;\n        this.ruleQueryBuilder = ruleQueryBuilder;\n    }\n\n    @Override\n    public PageResult&lt;RuleWithLatestVersionDTO&gt; findByCondition(RuleQueryCondition condition, PageRequest pageRequest) {\n\n        List&lt;String&gt; columNames = Arrays.stream(ruleMapper.selectList).map(c -&gt; ((SqlColumn&lt;?&gt;) c).name()).toList();\n        pageRequest.validateSort(columNames, \"\u6392\u5e8f\u5b57\u6bb5\u4e0d\u5408\u6cd5\");\n        // \u6784\u5efa\u67e5\u8be2\u8bed\u53e5\n        SelectStatementProvider selectStatementProvider = ruleQueryBuilder.buildDataQuery(condition, pageRequest);\n\n        System.out.println(selectStatementProvider.getSelectStatement());\n\n        // \u6784\u5efa\u603b\u6570\u67e5\u8be2\u8bed\u53e5\n        SelectStatementProvider countQuery = ruleQueryBuilder.buildCountQuery(condition);\n        System.out.println(countQuery.getSelectStatement());\n\n        return PaginationUtils.paginate(pageRequest,\n                () -&gt; ruleMapper.count(countQuery),\n                () -&gt; ruleCustomMapper.findByCondition(selectStatementProvider));\n\n    }\n\n}\n</code></pre>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#controller","title":"Controller\u5c42","text":"<pre><code>package com.example.demo.controller;\n\nimport com.example.demo.common.model.page.PageResult;\nimport com.example.demo.common.model.response.Result;\nimport com.example.demo.model.dto.request.RuleQueryPageRequest;\nimport com.example.demo.model.dto.response.RuleWithLatestVersionDTO;\nimport com.example.demo.service.RuleService;\n\n\nimport jakarta.validation.Valid;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.validation.annotation.Validated;\nimport org.springframework.web.bind.annotation.PostMapping;\nimport org.springframework.web.bind.annotation.RequestBody;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\n\n@RestController\n@RequestMapping(\"/api\")\n@Validated\npublic class RuleController {\n\n    private final RuleService ruleService;\n\n    @Autowired\n    public RuleController(RuleService ruleService) {\n        this.ruleService = ruleService;\n    }\n\n\n    @PostMapping(\"/rule\")\n    public Result&lt;PageResult&lt;RuleWithLatestVersionDTO&gt;&gt; queryRule(@Valid @RequestBody RuleQueryPageRequest request) {\n\n        PageResult&lt;RuleWithLatestVersionDTO&gt; pageResult = ruleService.findByCondition(request.getQueryCondition(), request.getPageRequest());\n\n        return Result.success(pageResult);\n    }\n}\n</code></pre>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#_16","title":"\u5e38\u89c1\u95ee\u9898\u89e3\u51b3","text":""},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#1_2","title":"1. \u65e0\u6cd5\u627e\u5230\u6570\u636e\u5e93\u9a71\u52a8","text":"<p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <ul> <li>\u786e\u4fdd\u5728 Maven \u63d2\u4ef6\u4e2d\u6b63\u786e\u914d\u7f6e\u4e86\u6570\u636e\u5e93\u9a71\u52a8\u4f9d\u8d56</li> <li>\u6216\u8005\u4f7f\u7528 <code>&lt;classPathEntry&gt;</code> \u6307\u5b9a\u9a71\u52a8 JAR \u7684\u7edd\u5bf9\u8def\u5f84</li> </ul>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#2_1","title":"2. \u751f\u6210\u7684\u5b57\u6bb5\u540d\u4e0d\u7b26\u5408\u9884\u671f","text":"<p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <ul> <li>\u4f7f\u7528 <code>&lt;columnOverride&gt;</code> \u91cd\u547d\u540d\u5b57\u6bb5</li> <li>\u914d\u7f6e\u9a7c\u5cf0\u547d\u540d\u8f6c\u6362\uff1a</li> </ul> <pre><code>&lt;property name=\"useActualColumnNames\" value=\"false\"/&gt;\n</code></pre>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#3_4","title":"3. \u9700\u8981\u751f\u6210\u590d\u6742\u67e5\u8be2","text":"<p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <ol> <li>\u751f\u6210\u57fa\u7840 CRUD \u4ee3\u7801</li> <li>\u624b\u52a8\u6269\u5c55 Mapper \u63a5\u53e3\u6dfb\u52a0\u81ea\u5b9a\u4e49\u65b9\u6cd5</li> <li>\u4f7f\u7528 XML \u6216\u6ce8\u89e3\u5b9e\u73b0\u590d\u6742\u67e5\u8be2</li> </ol>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#4_1","title":"4. \u5904\u7406\u6570\u636e\u5e93\u6ce8\u91ca","text":"<pre><code>&lt;commentGenerator&gt;\n    &lt;property name=\"addRemarkComments\" value=\"true\"/&gt;\n&lt;/commentGenerator&gt;\n</code></pre>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#5_1","title":"5. \u751f\u6210\u4ee3\u7801\u4e0d\u7b26\u5408\u9879\u76ee\u89c4\u8303","text":"<p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <ul> <li>\u4f7f\u7528\u81ea\u5b9a\u4e49\u63d2\u4ef6\u4fee\u6539\u4ee3\u7801\u751f\u6210\u89c4\u5219</li> <li>\u914d\u7f6e\u6a21\u677f\u6587\u4ef6\uff08\u9700\u8981\u5207\u6362\u5230 <code>MyBatis3</code> \u8fd0\u884c\u65f6\uff09</li> </ul>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#_17","title":"\u751f\u4ea7\u73af\u5883\u5efa\u8bae","text":"<ol> <li>\u4ee3\u7801\u5206\u79bb\u7ba1\u7406\uff1a</li> </ol> <pre><code>src/main/java\n\u251c\u2500\u2500 generated   // \u751f\u6210\u7684\u4ee3\u7801\uff08.gitignore \u6392\u9664\uff09\n\u2514\u2500\u2500 custom      // \u624b\u52a8\u7f16\u5199\u7684\u4ee3\u7801\n</code></pre> <ol> <li>\u591a\u73af\u5883\u914d\u7f6e\uff1a</li> </ol> <pre><code>&lt;!-- generatorConfig-dev.xml --&gt;\n&lt;jdbcConnection \n    connectionURL=\"jdbc:mysql://dev-db:3306/db\"\n    userId=\"dev_user\" ... /&gt;\n\n&lt;!-- generatorConfig-prod.xml --&gt;\n&lt;jdbcConnection \n    connectionURL=\"jdbc:mysql://prod-db:3306/db\"\n    userId=\"prod_user\" ... /&gt;\n</code></pre> <ol> <li>\u7248\u672c\u63a7\u5236\u7b56\u7565\uff1a<ul> <li>\u5c06 <code>generatorConfig.xml</code> \u7eb3\u5165\u7248\u672c\u63a7\u5236</li> <li>\u5c06\u751f\u6210\u7684\u4ee3\u7801\u6807\u8bb0\u4e3a \"generated\" \u6765\u6e90</li> <li>\u4f7f\u7528 <code>.gitattributes</code> \u5ffd\u7565\u751f\u6210\u4ee3\u7801\u7684\u53d8\u66f4\uff1a</li> </ul> </li> </ol> <pre><code>src/main/java/generated/** linguist-generated=true\n</code></pre> <p>\u901a\u8fc7\u4ee5\u4e0a\u5b8c\u6574\u914d\u7f6e\u548c\u4f7f\u7528\u6307\u5357\uff0c\u4f60\u53ef\u4ee5\u9ad8\u6548\u5730\u4f7f\u7528 MyBatis Generator \u4e3a MySQL \u6570\u636e\u5e93\u751f\u6210\u5065\u58ee\u3001\u7c7b\u578b\u5b89\u5168\u7684\u6301\u4e45\u5c42\u4ee3\u7801\uff0c\u5927\u5e45\u63d0\u5347\u5f00\u53d1\u6548\u7387\u3002</p>"},{"location":"springboot/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%8D%81%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0springboot%20%2B%20MyBatis%20Dynamic%20SQL/#_18","title":"\u603b\u7ed3","text":"<p>\u672c\u6587\u4ece\u96f6\u5f00\u59cb\u5b8c\u6574\u7684\u4ecb\u7ecd\u4e86\u5982\u4f55\u5feb\u901f\u5b9e\u73b0springboot+mybatis dynamic sql\uff0c\u5bf9\u4e8e\u5c0f\u578b\u9879\u76ee\u53ef\u4ee5\u5feb\u901f\u5f00\u53d1\uff0c\u6709\u5982\u4e0b\u4f18\u52bf\uff1a</p> <ol> <li>\u52a8\u6001 SQL\uff1a\u4f7f\u7528 MyBatis Dynamic SQL \u6784\u5efa\u590d\u6742 JOIN \u548c\u5b50\u67e5\u8be2</li> <li>\u7c7b\u578b\u5b89\u5168\uff1a\u901a\u8fc7\u652f\u6301\u7c7b\u786e\u4fdd\u5217\u540d\u6b63\u786e</li> <li>\u9ad8\u6548\u5206\u9875\uff1a\u652f\u6301\u6570\u636e\u5e93\u7ea7\u5206\u9875\u4f18\u5316</li> <li>\u81ea\u52a8\u6620\u5c04\uff1a\u7ed3\u679c\u81ea\u52a8\u6620\u5c04\u5230 DTO \u5bf9\u8c61</li> <li>RESTful API\uff1a\u63d0\u4f9b\u6807\u51c6\u5316\u7684 HTTP \u63a5\u53e3</li> </ol>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/","title":"LLM\u7edf\u4e00\u7f51\u5173\uff1aLiteLLM \u8be6\u7ec6\u4ecb\u7ecd","text":""},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#litellm","title":"LiteLLM \u57fa\u672c\u4ecb\u7ecd","text":""},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#litellm_1","title":"\u4e3a\u4ec0\u4e48\u9700\u8981LiteLLM\uff1f","text":"<p>\u5728AI\u5e94\u7528\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u5f00\u53d1\u8005\u5e38\u5e38\u9047\u5230\u4ee5\u4e0b\u75db\u70b9\uff1a - \u63a5\u53e3\u788e\u7247\u5316\uff1a\u4e0d\u540c\u5382\u5546\u7684API\u63a5\u53e3\u5dee\u5f02\u5de8\u5927\uff0c\u4ece\u53c2\u6570\u547d\u540d\u5230\u54cd\u5e94\u683c\u5f0f\u90fd\u4e0d\u7edf\u4e00 - \u5bc6\u94a5\u7ba1\u7406\u590d\u6742\uff1a\u6bcf\u4e2a\u670d\u52a1\u5546\u90fd\u6709\u72ec\u7acb\u7684\u8ba4\u8bc1\u673a\u5236\uff0c\u5bc6\u94a5\u7ba1\u7406\u6210\u4e3a\u8fd0\u7ef4\u8d1f\u62c5 - \u591a\u6a21\u578b\u7ba1\u7406\u6210\u672c\uff1a\u66f4\u6362\u6a21\u578b\u63d0\u4f9b\u5546\u9700\u8981\u91cd\u5199\u5927\u91cf\u4ee3\u7801\uff0c\u9879\u76ee\u96be\u4ee5\u7075\u6d3b\u8c03\u6574 - \u5b89\u5168\u4e0e\u5408\u89c4\uff1a\u533b\u7597\u6216\u91d1\u878d\u573a\u666f\u9700\u786e\u4fdd\u6570\u636e\u4e0d\u7ecf\u8fc7\u7b2c\u4e09\u65b9\u6a21\u578b\uff0c\u9700\u8981\u5728\u8c03\u7528\u7b2c\u4e09\u65b9\u6a21\u578b\u524d\u62e6\u622a - \u5f00\u53d1\u8fed\u4ee3\uff1a\u5feb\u901f\u5bf9\u6bd4\u4e0d\u540c\u6a21\u578b\u5728\u4e1a\u52a1\u573a\u666f\u4e2d\u7684\u6548\u679c\uff0c\u9700\u4e3a\u6bcf\u4e2a\u6a21\u578b\u5355\u72ec\u7f16\u5199\u8bc4\u6d4b\u4ee3\u7801 - \u7cfb\u7edf\u7a33\u5b9a\u6027\uff1a\u52a8\u6001\u8def\u7531\u4e0e\u8d1f\u8f7d\u5747\u8861\uff0c\u5bb9\u707e\u4e0e\u6545\u969c\u8f6c\u79fb\uff0c\u667a\u80fd\u91cd\u8bd5\u4e0e\u9650\u6d41</p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_1","title":"\u9879\u76ee\u6982\u8ff0","text":"<p>LiteLLM \u662f\u4e00\u4e2a\u5f00\u6e90\u5de5\u5177\uff0cLiteLLM\u901a\u8fc7\u63d0\u4f9b\u7edf\u4e00\u7684OpenAI\u517c\u5bb9\u63a5\u53e3\uff0c\u4f5c\u4e3a LLM API \u7684\u901a\u7528\u9002\u914d\u5668\uff0c\u7b80\u5316\u5927\u578b\u8bed\u8a00\u6a21\u578b\uff08LLM\uff09\u7684\u96c6\u6210\u4e0e\u7ba1\u7406\uff0c\u5141\u8bb8\u5f00\u53d1\u4eba\u5458\u901a\u8fc7\u6807\u51c6\u5316\u63a5\u53e3\u4e0e\u5404\u79cd\u5927\u6a21\u578b\u8fdb\u884c\u4ea4\u4e92\u3002\u8be5\u9879\u76ee\u652f\u6301\u76ee\u524d\u5e02\u9762\u4e0a\u5927\u591a\u6570LLM\u63d0\u4f9b\u5546\uff0c\u5305\u62ec Anthropic\u3001AWS Bedrock\u3001AWS SageMaker\u3001Azure OpenAI\u3001deepseek\u3001Google Vertex AI\u3001OpenAI\u7b49\u7b49\uff0c\u9664\u4e86\u4e91\u7aef\u4ea7\u54c1\uff0c\u8fd8\u652f\u6301\u672c\u5730\u5316\u90e8\u7f72\u5de5\u5177\uff0c\u5982Ollama\u7b49\u3002</p> <p>\u9664\u4e86\u7edf\u4e00\u63a5\u53e3\u4e4b\u5916\uff0c\u8fd8\u5b9e\u73b0\u4e86\u6210\u672c\u8ddf\u8e2a\u3001\u8bbf\u95ee\u63a7\u5236\u548c API \u8c03\u7528\u7684\u5b9e\u65f6\u76d1\u63a7\u7b49\u529f\u80fd\u3002\u8be5\u9879\u76ee\u6838\u5fc3\u76ee\u6807\u662f\u662f\u7b80\u5316\u591a LLM \u5e94\u7528\u7684\u5f00\u53d1\uff0c\u63d0\u9ad8\u5e73\u53f0\u56e2\u961f\u7ba1\u7406\u591a\u63d0\u4f9b\u5546\u7684\u6548\u7387\u3002\u76ee\u524d\uff0cLiteLLM \u96c6\u6210\u4e86100\u591a\u4e2aLLM\u7684\u8bbf\u95ee\u3001\u8d39\u7528\u8ddf\u8e2a\u548c\u56de\u9000\u3002</p> <p>\u4f7f\u7528LiteLLM\uff0c\u53ef\u4e3a\u5f00\u53d1\u56e2\u961f\u8282\u7701\u65f6\u95f4\u548c\u7cbe\u529b\u3002\u5f00\u53d1\u8005\u65e0\u9700\u81ea\u5b9a\u4e49\u96c6\u6210\u6bcf\u4e2a\u65b0\u7684\u6a21\u578b API \uff0c\u6216\u7b49\u5f85\u7279\u5b9a\u63d0\u4f9b\u5546\u53d1\u5e03SDK\u3002</p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_2","title":"\u6838\u5fc3\u529f\u80fd","text":"<ol> <li>\u6807\u51c6\u5316API\u63a5\u53e3</li> <li>\u7edf\u4e00\u8c03\u7528\u683c\u5f0f\uff1a\u65e0\u8bba\u5e95\u5c42\u6a21\u578b\u5982\u4f55\uff0c\u6240\u6709\u8bf7\u6c42\u5747\u4f7f\u7528\u76f8\u540c\u7ed3\u6784\uff08\u5982OpenAI\u683c\u5f0f\uff09\uff0c\u964d\u4f4e\u4ee3\u7801\u9002\u914d\u6210\u672c\u3002</li> <li> <p>\u793a\u4f8b\uff1a\u8c03\u7528GPT-4\u4e0eClaude 2\u5747\u901a\u8fc7 <code>litellm.completion(model=\"\u6a21\u578b\u540d\", messages=[...])</code> \u5b9e\u73b0\u3002</p> </li> <li> <p>\u591a\u6a21\u578b\u652f\u6301</p> </li> <li>\u8986\u76d6\u4e3b\u6d41LLM\uff1a\u652f\u6301\u5305\u62ecOpenAI\u3001Anthropic\u3001Google Vertex AI\u3001Hugging Face\u3001Cohere\u7b4920+\u6a21\u578b\uff0c\u6301\u7eed\u6269\u5c55\u4e2d\u3002</li> <li> <p>\u81ea\u5b9a\u4e49\u6a21\u578b\u63a5\u5165\uff1a\u901a\u8fc7\u914d\u7f6e\u53ef\u63a5\u5165\u79c1\u6709\u5316\u90e8\u7f72\u6a21\u578b\u6216\u5c0f\u4f17API\u3002</p> </li> <li> <p>\u667a\u80fd\u8def\u7531\u4e0e\u8d1f\u8f7d\u5747\u8861</p> </li> <li>\u8def\u7531\u7b56\u7565\uff1a\u6839\u636e\u6a21\u578b\u7c7b\u578b\u3001\u53ef\u7528\u6027\u3001\u6210\u672c\u6216\u65f6\u5ef6\u81ea\u52a8\u9009\u62e9\u6700\u4f18\u670d\u52a1\u8282\u70b9\u3002</li> <li> <p>\u6545\u969c\u8f6c\u79fb\uff1a\u5f53\u67d0\u6a21\u578b\u670d\u52a1\u4e0d\u53ef\u7528\u65f6\uff0c\u81ea\u52a8\u5207\u6362\u81f3\u5907\u7528\u6a21\u578b\uff0c\u786e\u4fdd\u4e1a\u52a1\u8fde\u7eed\u6027\u3002</p> </li> <li> <p>\u7f13\u5b58\u4e0e\u6210\u672c\u4f18\u5316</p> </li> <li>\u8bf7\u6c42\u7f13\u5b58\uff1a\u5bf9\u91cd\u590d\u67e5\u8be2\u7ed3\u679c\u7f13\u5b58\uff0c\u51cf\u5c11API\u8c03\u7528\u6b21\u6570\u3002</li> <li> <p>\u7528\u91cf\u7edf\u8ba1\uff1a\u5b9e\u65f6\u76d1\u63a7\u5404\u6a21\u578bToken\u6d88\u8017\uff0c\u751f\u6210\u6210\u672c\u62a5\u544a\uff0c\u652f\u6301\u9884\u7b97\u544a\u8b66\u3002</p> </li> <li> <p>\u76d1\u63a7\u4e0e\u65e5\u5fd7</p> </li> <li>\u6027\u80fd\u6307\u6807\uff1a\u8bb0\u5f55\u54cd\u5e94\u65f6\u95f4\u3001\u9519\u8bef\u7387\u3001Token\u7528\u91cf\u7b49\u5173\u952e\u6307\u6807\u3002</li> <li> <p>\u5ba1\u8ba1\u65e5\u5fd7\uff1a\u8ffd\u8e2a\u6240\u6709\u8bf7\u6c42\u8be6\u60c5\uff0c\u4fbf\u4e8e\u8c03\u8bd5\u4e0e\u5408\u89c4\u5ba1\u67e5\u3002</p> </li> <li> <p>\u5b89\u5168\u589e\u5f3a</p> </li> <li>API\u5bc6\u94a5\u7ba1\u7406\uff1a\u96c6\u4e2d\u5b58\u50a8\u52a0\u5bc6\u5bc6\u94a5\uff0c\u907f\u514d\u786c\u7f16\u7801\u6cc4\u9732\u98ce\u9669\u3002</li> <li>\u8bbf\u95ee\u63a7\u5236\uff1a\u652f\u6301\u57fa\u4e8e\u89d2\u8272\u7684\u6743\u9650\u7ba1\u7406\uff08RBAC\uff09\uff0c\u9650\u5236\u654f\u611f\u64cd\u4f5c\u3002</li> </ol>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_3","title":"\u6280\u672f\u67b6\u6784","text":"<p>LiteLLM\u91c7\u7528\u6a21\u5757\u5316\u8bbe\u8ba1\uff0c\u5173\u952e\u7ec4\u4ef6\u5305\u62ec\uff1a - API\u7f51\u5173\uff1a\u63a5\u6536\u8bf7\u6c42\u5e76\u8f6c\u53d1\u81f3\u9002\u914d\u5668\uff0c\u5904\u7406\u8ba4\u8bc1\u3001\u9650\u6d41\u7b49\u3002 - \u6a21\u578b\u9002\u914d\u5668\uff1a\u5c06\u7edf\u4e00API\u8f6c\u6362\u4e3a\u5404LLM\u539f\u751f\u63a5\u53e3\uff08\u5982\u5c06OpenAI\u683c\u5f0f\u8f6c\u4e3aAnthropic\u7684HTTP\u53c2\u6570\uff09\u3002 - \u8def\u7531\u5f15\u64ce\uff1a\u52a8\u6001\u51b3\u7b56\u6a21\u578b\u8c03\u7528\u8def\u5f84\uff0c\u652f\u6301\u81ea\u5b9a\u4e49\u89c4\u5219\uff08\u5982\u201c\u4f18\u5148\u4f7f\u7528\u6210\u672c\u4f4e\u4e8e$0.01/1k Tokens\u7684\u6a21\u578b\u201d\uff09\u3002 - \u7f13\u5b58\u5c42\uff1a\u57fa\u4e8eRedis\u6216\u5185\u5b58\u5b58\u50a8\u9ad8\u9891\u67e5\u8be2\u7ed3\u679c\u3002 - \u76d1\u63a7\u4ee3\u7406\uff1a\u96c6\u6210Prometheus\u3001Grafana\u7b49\u5de5\u5177\uff0c\u63d0\u4f9b\u53ef\u89c6\u5316\u770b\u677f\u3002</p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_4","title":"\u5178\u578b\u5e94\u7528\u573a\u666f","text":"<ol> <li>\u591a\u6a21\u578bA/B\u6d4b\u8bd5</li> <li> <p>\u540c\u65f6\u5411GPT-4\u548cClaude 2\u53d1\u9001\u8bf7\u6c42\uff0c\u6bd4\u8f83\u751f\u6210\u8d28\u91cf\uff0c\u8f85\u52a9\u6a21\u578b\u9009\u578b\u3002</p> </li> <li> <p>\u6df7\u5408\u4e91LLM\u8c03\u5ea6</p> </li> <li> <p>\u7ed3\u5408\u516c\u6709\u4e91API\uff08\u5982OpenAI\uff09\u4e0e\u672c\u5730\u90e8\u7f72\u6a21\u578b\uff08\u5982Llama 2\uff09\uff0c\u6839\u636e\u6570\u636e\u654f\u611f\u6027\u81ea\u52a8\u8def\u7531\u3002</p> </li> <li> <p>\u6210\u672c\u654f\u611f\u578b\u5e94\u7528</p> </li> <li> <p>\u914d\u7f6e\u8def\u7531\u7b56\u7565\uff0c\u5728\u975e\u5173\u952e\u4efb\u52a1\u4e2d\u4f7f\u7528\u4f4e\u4ef7\u6a21\u578b\uff08\u5982GPT-3.5\uff09\uff0c\u5173\u952e\u4efb\u52a1\u5207\u6362\u81f3\u9ad8\u6210\u672c\u6a21\u578b\uff08\u5982GPT-4\uff09\u3002</p> </li> <li> <p>\u5bb9\u707e\u5907\u4efd</p> </li> <li>\u5f53Qwen\u6a21\u578b\u8c03\u7528\u670d\u52a1\u51fa\u73b0\u6545\u969c\u65f6\uff0c\u81ea\u52a8\u5c06\u8bf7\u6c42\u8f6c\u53d1\u81f3deepseek\u6a21\u578b\u8c03\u7528\u670d\u52a1\uff0c\u907f\u514d\u670d\u52a1\u4e2d\u65ad\u3002</li> </ol>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_5","title":"\u4f18\u52bf\u5bf9\u6bd4","text":"\u7279\u6027 \u539f\u751f\u591a\u6a21\u578b\u5f00\u53d1 \u4f7f\u7528LiteLLM \u4ee3\u7801\u590d\u6742\u5ea6 \u9700\u4e3a\u6bcf\u4e2a\u6a21\u578b\u7f16\u5199\u9002\u914d\u5c42 \u7edf\u4e00API\uff0c\u4ee3\u7801\u590d\u7528\u7387\u9ad8 \u7ef4\u62a4\u6210\u672c \u9700\u8ddf\u8e2a\u5404API\u66f4\u65b0 \u81ea\u52a8\u5904\u7406\u63a5\u53e3\u53d8\u66f4 \u6545\u969c\u6062\u590d \u624b\u52a8\u5b9e\u73b0\u91cd\u8bd5\u903b\u8f91 \u5185\u7f6e\u667a\u80fd\u6545\u969c\u8f6c\u79fb \u6210\u672c\u4f18\u5316 \u9700\u81ea\u884c\u7edf\u8ba1\u4e0e\u5206\u6790 \u63d0\u4f9b\u7528\u91cf\u4eea\u8868\u76d8"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_6","title":"\u603b\u7ed3","text":"<p>LiteLLM\u901a\u8fc7\u62bd\u8c61\u5316\u5e95\u5c42LLM\u7684\u590d\u6742\u6027\uff0c\u663e\u8457\u964d\u4f4e\u4e86\u591a\u6a21\u578b\u5e94\u7528\u7684\u5f00\u53d1\u95e8\u69db\u3002\u5176\u6838\u5fc3\u4ef7\u503c\u5728\u4e8e\uff1a - \u5f00\u53d1\u8005\u53cb\u597d\uff1a\u51cf\u5c1170%\u4ee5\u4e0a\u7684\u6a21\u578b\u96c6\u6210\u4ee3\u7801\u91cf\u3002 - \u4f01\u4e1a\u7ea7\u7ba1\u63a7\uff1a\u63d0\u4f9b\u4ece\u6210\u672c\u63a7\u5236\u5230\u5b89\u5168\u5ba1\u8ba1\u7684\u5168\u751f\u547d\u5468\u671f\u7ba1\u7406\u3002 - \u751f\u6001\u517c\u5bb9\u6027\uff1a\u65e0\u7f1d\u5bf9\u63a5\u73b0\u6709MLOps\u5de5\u5177\u94fe\uff08\u5982MLflow\u3001Weights &amp; Biases\uff09\u3002</p> <p>\u968f\u7740LLM\u6280\u672f\u7684\u5feb\u901f\u6f14\u8fdb\uff0cLiteLLM\u6b63\u6210\u4e3a\u6784\u5efa\u7a33\u5065\u3001\u53ef\u6269\u5c55AI\u5e94\u7528\u7684\u5173\u952e\u57fa\u7840\u8bbe\u65bd\u3002</p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#litellm_2","title":"LiteLLM \u4e24\u79cd\u4f7f\u7528\u65b9\u5f0f\u4ecb\u7ecd","text":"<p>LiteLLM\u6709\u4e24\u79cd\u4f7f\u7528\u65b9\u5f0f\uff1a - Python SDK\uff1a\u5728 Python \u4ee3\u7801\u4e2d\u4f7f\u7528 LiteLLM\uff0c\u901a\u5e38\u7531\u6784\u5efa llm \u9879\u76ee\u7684\u5f00\u53d1\u4eba\u5458\u4f7f\u7528\u3002 - Proxy Server\uff1a\u9700\u8981\u4e2d\u592e\u670d\u52a1\uff08LLM \u7f51\u5173\uff09\u8bbf\u95ee\u591a\u4e2a LLM\uff0c\u901a\u5e38\u7531 Gen AI \u652f\u6301/ML \u5e73\u53f0\u56e2\u961f\u4f7f\u7528\u3002</p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#litellm-proxy-server-vs-python-sdk","title":"LiteLLM Proxy Server vs. Python SDK\uff1a\u6838\u5fc3\u533a\u522b\u8be6\u89e3","text":""},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_7","title":"\u5b9a\u4f4d\u4e0e\u67b6\u6784\u5dee\u5f02","text":"\u7ef4\u5ea6 LiteLLM Python SDK LiteLLM Proxy Server \u672c\u8d28 \u8f7b\u91cf\u7ea7Python\u5ba2\u6237\u7aef\u5e93 \u72ec\u7acb\u90e8\u7f72\u7684API\u7f51\u5173\u670d\u52a1 \u8fd0\u884c\u65b9\u5f0f \u5d4c\u5165\u5e94\u7528\u4ee3\u7801\u4e2d\uff08\u5982Django/Flask/fastapi\uff09 \u72ec\u7acb\u8fdb\u7a0b\uff08Docker/K8s\u90e8\u7f72\uff09 \u901a\u4fe1\u534f\u8bae \u51fd\u6570\u8c03\u7528\uff08Python\u8fdb\u7a0b\u5185\uff09 HTTP REST API\uff08\u8de8\u8bed\u8a00\u8c03\u7528\uff09 \u4f9d\u8d56 \u9700Python\u73af\u5883 \u9700\u8981\u5355\u72ec\u90e8\u7f72\uff08\u4efb\u4f55HTTP\u5ba2\u6237\u7aef\u53ef\u8bbf\u95ee\uff0c\u65e0\u8bed\u8a00\u9650\u5236\uff09"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#litellm-python-sdk","title":"\u4e00\u3001LiteLLM Python SDK","text":""},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_8","title":"\u6838\u5fc3\u7279\u5f81","text":"<ul> <li>\u672c\u5730\u96c6\u6210\uff1a\u4f5c\u4e3aPython\u5305\u76f4\u63a5\u5b89\u88c5\uff08<code>pip install litellm</code>\uff09</li> <li>\u5f00\u53d1\u8005\u53cb\u597d\uff1a\u9762\u5411Python\u5f00\u53d1\u8005\uff0c\u63d0\u4f9b\u540c\u6b65/\u5f02\u6b65API</li> <li>\u65e0\u670d\u52a1\u4f9d\u8d56\uff1a\u65e0\u9700\u989d\u5916\u57fa\u7840\u8bbe\u65bd</li> </ul>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_9","title":"\u5178\u578b\u4f7f\u7528\u573a\u666f","text":"<ol> <li> <p>\u5355\u5e94\u7528\u5feb\u901f\u96c6\u6210 <pre><code>import litellm  # \u5355\u5e93\u96c6\u6210\u6240\u6709\u529f\u80fd\n# \u76f4\u63a5\u8c03\u7528\u6a21\u578b\nresponse = litellm.completion(model=\"gpt-4\", messages=[...])\n</code></pre></p> </li> <li> <p>\u811a\u672c/\u5b9e\u9a8c\u73af\u5883 <pre><code># Jupyter Notebook\u4e2d\u5feb\u901f\u6d4b\u8bd5\u6a21\u578b\n import litellm\n model_list = litellm.model_list # \u67e5\u770b\u652f\u6301\u6a21\u578b\n print(len(model_list)) # 791\n</code></pre></p> </li> <li> <p>\u4e0e\u5176\u4ed6Python\u5e93\u534f\u540c <pre><code> # \u5b89\u88c5 langchain-litellm \u4f9d\u8d56\n !pip install -qU langchain-litellm\n # \u65e0\u7f1d\u63a5\u5165LangChain\n from langchain_litellm import ChatLiteLLM\n llm = ChatLiteLLM(model=\"gpt-4.1-nano\", temperature=0.1)\n</code></pre></p> </li> </ol>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#litellm-proxy-server","title":"\u4e8c\u3001LiteLLM Proxy Server","text":""},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#docker","title":"\u4f7f\u7528docker\u90e8\u7f72","text":"<pre><code>docker run \\\n    -v $(pwd)/litellm_config.yaml:/app/config.yaml \\\n    -e AZURE_API_KEY=d6*********** \\\n    -e AZURE_API_BASE=https://openai-***********/ \\\n    -p 4000:4000 \\\n    ghcr.io/berriai/litellm:main-latest \\\n    --config /app/config.yaml --detailed_debug\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_10","title":"\u6838\u5fc3\u529f\u80fd","text":"<ul> <li>\u4e2d\u5fc3\u5316\u7f51\u5173\uff1a\u72ec\u7acb\u670d\u52a1\uff0c\u901a\u8fc7HTTP\u66b4\u9732\u7edf\u4e00API</li> <li>\u4f01\u4e1a\u7ea7\u529f\u80fd\uff1a</li> <li>\u591a\u79df\u6237\u7ba1\u7406\uff08\u56e2\u961f/\u9879\u76ee\u9694\u79bb\uff09</li> <li>\u96c6\u4e2d\u5f0f\u76d1\u63a7\u9762\u677f</li> <li>\u5168\u5c40\u901f\u7387\u9650\u5236</li> <li>\u6210\u672c\u8ddf\u8e2a</li> </ul>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_11","title":"\u5178\u578b\u4f7f\u7528\u573a\u666f","text":"<ol> <li>\u591a\u8bed\u8a00\u67b6\u6784</li> </ol> <p>\u4f7f\u7528 javascript \u8c03\u7528    <pre><code>// \u524d\u7aefJS\u76f4\u63a5\u8c03\u7528\nfetch(\"http://llm-gateway.company.com/completions\", {\n  method: \"POST\",\n  headers: { \n    \"Authorization\": \"Bearer team-123\",\n    \"Content-Type\": \"application/json\"\n  },\n  body: JSON.stringify({\n    model: \"gpt-4\",\n    messages: [{role: \"user\", content: \"Hello\"}]\n  })\n})\n</code></pre>    \u4f7f\u7528 curl \u8c03\u7528    <pre><code> curl -X POST 'http://0.0.0.0:4000/chat/completions' \\\n -H 'Content-Type: application/json' \\\n -H 'Authorization: Bearer sk-1234' \\\n -d '{\n     \"model\": \"gpt-4o\",\n     \"messages\": [\n       {\n         \"role\": \"system\",\n         \"content\": \"You are an LLM named gpt-4o\"\n       },\n       {\n         \"role\": \"user\",\n         \"content\": \"what is your name?\"\n       }\n     ]\n }'\n</code></pre>    \u4f7f\u7528 openai \u517c\u5bb9\u63a5\u53e3\u8c03\u7528</p> <pre><code> import openai # openai v1.0.0+\n client = openai.OpenAI(api_key=\"anything\",base_url=\"http://0.0.0.0:4000\") # set proxy to base_url\n messages = [{\n                 \"role\": \"user\",\n                 \"content\": \"this is a test request, write a short poem\"\n             }]\n # request sent to model set on litellm proxy, `litellm --model`\n response = client.chat.completions.create(model=\"gpt-3.5-turbo\", messages=messages )\n\n print(response)\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_12","title":"\u4e09\u3001\u6838\u5fc3\u80fd\u529b\u5bf9\u6bd4","text":"\u529f\u80fd Python SDK Proxy Server \u591a\u6a21\u578b\u8c03\u7528 \u2705 \u652f\u6301 \u2705 \u652f\u6301 \u8d1f\u8f7d\u5747\u8861 \u2705 \u57fa\u7840\u8def\u7531\u7b56\u7565 \u2705 \u9ad8\u7ea7\u7b97\u6cd5\uff08\u4e00\u81f4\u6027\u54c8\u5e0c/\u6743\u91cd\u8f6e\u8be2\uff09 \u6210\u672c\u8ddf\u8e2a \u2705 \u5355\u8fdb\u7a0b\u7ea7\u7edf\u8ba1 \u2705 \u591a\u56e2\u961f\u7ec6\u7c92\u5ea6\u5206\u6790 \u5bc6\u94a5\u7ba1\u7406 \u274c \u9700\u81ea\u884c\u5b9e\u73b0\u52a0\u5bc6 \u2705 \u96c6\u4e2d\u5b58\u50a8\uff08Vault\u96c6\u6210\uff09 \u8bbf\u95ee\u63a7\u5236 \u274c \u65e0 \u2705 RBAC/\u56e2\u961f\u9694\u79bb \u5168\u5c40\u901f\u7387\u9650\u5236 \u274c \u4ec5\u5355\u8fdb\u7a0b\u6709\u6548 \u2705 \u96c6\u7fa4\u7ea7\u63a7\u5236 \u5ba1\u8ba1\u65e5\u5fd7 \u2705 \u57fa\u7840\u65e5\u5fd7 \u2705 \u7ed3\u6784\u5316\u65e5\u5fd7\uff08ElasticSearch\u96c6\u6210\uff09 \u670d\u52a1\u53d1\u73b0 \u274c \u65e0 \u2705 \u5065\u5eb7\u68c0\u67e5+\u81ea\u52a8\u6545\u969c\u8f6c\u79fb"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_13","title":"\u56db\u3001\u5982\u4f55\u9009\u62e9\uff1f","text":""},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#python-sdk","title":"\u9009\u62e9 Python SDK \uff1a","text":"<ul> <li>\u6784\u5efa\u7eafPython\u5e94\u7528\uff08\u5982AI\u52a9\u624b\u811a\u672c\uff09</li> <li>\u9700\u8981\u6781\u7b80\u539f\u578b\u9a8c\u8bc1\uff08POC\u9636\u6bb5\uff09</li> <li>\u65e0\u591a\u56e2\u961f/\u591a\u8bed\u8a00\u96c6\u6210\u9700\u6c42</li> </ul>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#proxy-server","title":"\u9009\u62e9 Proxy Server \uff1a","text":"<ul> <li>\u4f01\u4e1a\u751f\u4ea7\u73af\u5883\u90e8\u7f72</li> <li>\u9700\u8981\u652f\u6301Java/Go/Node.js\u7b49\u591a\u8bed\u8a00\u5ba2\u6237\u7aef</li> <li>\u8981\u6c42\u56e2\u961f\u9694\u79bb\u4e0eSLA\u4fdd\u969c</li> <li>\u5df2\u6709Prometheus/Grafana\u76d1\u63a7\u6808</li> </ul>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_14","title":"\u4e94\u3001\u534f\u540c\u4f7f\u7528\u65b9\u6848","text":"<p><pre><code>graph LR\n    A[Python\u5e94\u7528] --&gt;|\u76f4\u63a5\u8c03\u7528| B(Python SDK)\n    C[Java\u5e94\u7528] --&gt;|HTTP| D(Proxy Server)\n    E[Node.js\u5e94\u7528] --&gt;|HTTP| D\n\n    D --&gt;|\u8def\u7531\u8bf7\u6c42| F[OpenAI]\n    D --&gt;|\u8def\u7531\u8bf7\u6c42| G[Anthropic]\n    D --&gt;|\u8def\u7531\u8bf7\u6c42| H[\u672c\u5730\u6a21\u578b]\n    B --&gt;|\u7ed5\u8fc7\u7f51\u5173\u76f4\u8fde| F\n    B --&gt;|\u7ed5\u8fc7\u7f51\u5173\u76f4\u8fde| G\n</code></pre> \u6700\u4f73\u5b9e\u8df5\uff1a - \u5f00\u53d1\u73af\u5883\u7528SDK\u5feb\u901f\u8fed\u4ee3 - \u751f\u4ea7\u73af\u5883\u901a\u8fc7Proxy\u7edf\u4e00\u7ba1\u7406 - SDK\u5e94\u7528\u53ef\u9010\u6b65\u8fc1\u79fb\u81f3Proxy</p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#litellm_3","title":"LiteLLM \u5b9e\u8df5","text":"<p>\u56e0\u4e3a\u6211\u4eec\u4f7f\u7528\u7684\u662fpython\u5e94\u7528\uff0c\u5e76\u4e14\u4e3b\u8981\u4f7f\u7528\u7684\u662f langchain \u6846\u67b6\uff0c\u6240\u4ee5\u63a5\u4e0b\u6765\u7684\u5b9e\u8df5\u5185\u5bb9\u4ee5 LiteLLM Python SDK \u4e3a\u4e3b\uff0c\u91cd\u70b9\u4ecb\u7ecd\u4e0b\u9762\u529f\u80fd\u7684\u4f7f\u7528\u65b9\u6cd5\u3002</p> <ul> <li>\u975e\u6d41\u5f0f\u5bf9\u8bdd</li> <li>\u6d41\u5f0f\u5bf9\u8bdd</li> <li>\u51fd\u6570\u8c03\u7528</li> <li>\u52a8\u6001\u8def\u7531</li> <li>\u667a\u80fd\u91cd\u8bd5</li> </ul> <p>\u8fd9\u91cc\u4ece\u4e24\u4e2a\u5927\u7684\u65b9\u9762\u4ecb\u7ecd\u8fd9\u4e9b\u529f\u80fd\u7684\u4f7f\u7528 1. \u4f7f\u7528 LiteLLM Python SDK \u76f4\u63a5\u63d0\u4f9b\u7684\u63a5\u53e3 2. \u4e0elangchain\u96c6\u6210\uff0c\u4f7f\u7528 langchain-litellm \u63d0\u4f9b\u7684\u63a5\u53e3</p> <p>\u4e3a\u4e86\u66f4\u597d\u7684\u5b9e\u8df5\uff0c\u63a5\u4e0b\u6765\u4ece deepseek \u548c \u963f\u91cc\u4e91\u767e\u70bc \u8fd9\u4e24\u4e2a\u5e73\u53f0\u7533\u8bf7\u6a21\u578b\u8c03\u7528\u670d\u52a1\u3002 - \u7533\u8bf7 deepseek \u6a21\u578b\u8c03\u7528\u670d\u52a1\u9700\u8981\u5145\u503c\uff0c\u5177\u4f53\u4f7f\u7528\u53ef\u4ee5\u67e5\u770bdeepseek\u5b98\u65b9\u6587\u6863\u3002 - \u7533\u8bf7\u963f\u91cc\u4e91\u767e\u70bc\u6a21\u578b\u8c03\u7528\u670d\u52a1\uff0c\u9996\u6b21\u5f00\u901a\u6bcf\u4e2a\u6a21\u578b\u53ef\u4ee5\u514d\u8d39\u9886\u53d6100\u4e07token\u4f7f\u7528\u989d\u5ea6\uff0c\u5177\u4f53\u4f7f\u7528\u53ef\u4ee5\u67e5\u770b\u963f\u91cc\u4e91\u767e\u70bc\u5b98\u65b9\u6587\u6863\u3002</p> <p>\u5047\u8bbe\u4f60\u5df2\u7ecf\u7533\u8bf7\u597d\u4e86\u5bf9\u5e94\u7684 api_key \uff0c\u63a5\u4e0b\u6765\u5f00\u59cb\u5b9e\u8df5\u3002</p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#litellm-python-sdk_1","title":"LiteLLM Python SDK \u7684 \u57fa\u672c\u4f7f\u7528","text":""},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_15","title":"\u5b89\u88c5\u4f9d\u8d56","text":"<pre><code>pip install litellm -U\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#litellmcompletion","title":"litellm.completion\u65b9\u6cd5\u53c2\u6570\u8be6\u89e3","text":"<p>\u4f7f\u7528 LiteLLM Python SDK \u4e3b\u8981\u7684\u63a5\u53e3\u662f litellm.completion()\uff0c\u67e5\u770b\u6e90\u7801\u53c2\u6570\u53ca\u8bf4\u660e\u5982\u4e0b\uff1a</p> <pre><code>@client\ndef completion(  # type: ignore # noqa: PLR0915\n    model: str,\n    # Optional OpenAI params: see https://platform.openai.com/docs/api-reference/chat/create\n    messages: List = [],\n    timeout: Optional[Union[float, str, httpx.Timeout]] = None,\n    temperature: Optional[float] = None,\n    top_p: Optional[float] = None,\n    n: Optional[int] = None,\n    stream: Optional[bool] = None,\n    stream_options: Optional[dict] = None,\n    stop=None,\n    max_completion_tokens: Optional[int] = None,\n    max_tokens: Optional[int] = None,\n    modalities: Optional[List[ChatCompletionModality]] = None,\n    prediction: Optional[ChatCompletionPredictionContentParam] = None,\n    audio: Optional[ChatCompletionAudioParam] = None,\n    presence_penalty: Optional[float] = None,\n    frequency_penalty: Optional[float] = None,\n    logit_bias: Optional[dict] = None,\n    user: Optional[str] = None,\n    # openai v1.0+ new params\n    reasoning_effort: Optional[Literal[\"low\", \"medium\", \"high\"]] = None,\n    response_format: Optional[Union[dict, Type[BaseModel]]] = None,\n    seed: Optional[int] = None,\n    tools: Optional[List] = None,\n    tool_choice: Optional[Union[str, dict]] = None,\n    logprobs: Optional[bool] = None,\n    top_logprobs: Optional[int] = None,\n    parallel_tool_calls: Optional[bool] = None,\n    web_search_options: Optional[OpenAIWebSearchOptions] = None,\n    deployment_id=None,\n    extra_headers: Optional[dict] = None,\n    # soon to be deprecated params by OpenAI\n    functions: Optional[List] = None,\n    function_call: Optional[str] = None,\n    # set api_base, api_version, api_key\n    base_url: Optional[str] = None,\n    api_version: Optional[str] = None,\n    api_key: Optional[str] = None,\n    model_list: Optional[list] = None,  # pass in a list of api_base,keys, etc.\n    # Optional liteLLM function params\n    thinking: Optional[AnthropicThinkingParam] = None,\n    **kwargs,\n) -&gt; Union[ModelResponse, CustomStreamWrapper]:\n</code></pre> <p>\u6ce8\u610f\uff1a\u7531\u4e8e\u53c2\u6570\u5f88\u591a\uff0c\u6211\u4f1a\u5c3d\u91cf\u7b80\u6d01\u660e\u4e86\u5730\u89e3\u91ca\u6bcf\u4e2a\u53c2\u6570\u3002</p> <ol> <li> <p><code>model: str</code>\uff1a\u6307\u5b9a\u8981\u4f7f\u7528\u7684\u6a21\u578b\u540d\u79f0\uff0c\u4f8b\u5982 \"gpt-3.5-turbo\"\u3002</p> </li> <li> <p><code>messages: List = []</code>\uff1a\u804a\u5929\u6d88\u606f\u5217\u8868\uff0c\u6bcf\u4e2a\u6d88\u606f\u662f\u4e00\u4e2a\u5b57\u5178\uff0c\u5305\u542b\"role\"\uff08\u5982\"user\"\u3001\"assistant\"\uff09\u548c\"content\"\u3002</p> </li> <li> <p><code>timeout: Optional[Union[float, str, httpx.Timeout]] = None</code>\uff1a\u8bf7\u6c42\u8d85\u65f6\u65f6\u95f4\uff0c\u53ef\u4ee5\u662f\u79d2\u6570\uff08float\uff09\uff0c\u5b57\u7b26\u4e32\uff08\u5982\"5s\"\uff09\u6216httpx.Timeout\u5bf9\u8c61\u3002</p> </li> <li> <p><code>temperature: Optional[float] = None</code>\uff1a\u63a7\u5236\u751f\u6210\u6587\u672c\u7684\u968f\u673a\u6027\u3002\u503c\u8d8a\u9ad8\uff0c\u8f93\u51fa\u8d8a\u968f\u673a\uff1b\u503c\u8d8a\u4f4e\uff0c\u8f93\u51fa\u8d8a\u786e\u5b9a\u3002</p> </li> <li> <p><code>top_p: Optional[float] = None</code>\uff1a\u6838\u91c7\u6837\uff08nucleus sampling\uff09\u7684\u53c2\u6570\uff0c\u63a7\u5236\u751f\u6210\u6587\u672c\u7684\u591a\u6837\u6027\u3002\u4e0etemperature\u7c7b\u4f3c\uff0c\u4f46\u901a\u5e38\u53ea\u8003\u8651\u6982\u7387\u8d28\u91cf\u7d2f\u8ba1\u5230top_p\u7684\u8bcd\u6c47\u3002</p> </li> <li> <p><code>n: Optional[int] = None</code>\uff1a\u751f\u6210\u591a\u4e2a\u72ec\u7acb\u7684\u56de\u590d\uff08\u9009\u62e9\u5176\u4e2d\u4e00\u4e2a\u8fd4\u56de\uff09\u3002</p> </li> <li> <p><code>stream: Optional[bool] = None</code>\uff1a\u662f\u5426\u4ee5\u6d41\u5f0f\uff08stream\uff09\u65b9\u5f0f\u8fd4\u56de\u54cd\u5e94\u3002</p> </li> <li> <p><code>stream_options: Optional[dict] = None</code>\uff1a\u6d41\u5f0f\u4f20\u8f93\u7684\u989d\u5916\u9009\u9879\u3002</p> </li> <li> <p><code>stop</code>\uff1a\u53ef\u9009\uff0c\u6307\u5b9a\u4e00\u4e2a\u6216\u591a\u4e2a\u5b57\u7b26\u4e32\uff0c\u5f53\u6a21\u578b\u751f\u6210\u8fd9\u4e9b\u5b57\u7b26\u4e32\u65f6\u505c\u6b62\u751f\u6210\u3002</p> </li> <li> <p><code>max_completion_tokens: Optional[int] = None</code>\uff1a\u9650\u5236\u5b8c\u6210\u90e8\u5206\u7684\u6700\u5927token\u6570\uff08\u4e0d\u5305\u62ec\u63d0\u793a\uff09\u3002</p> </li> <li> <p><code>max_tokens: Optional[int] = None</code>\uff1a\u6574\u4e2a\u751f\u6210\u7684\u6700\u5927token\u6570\uff08\u5305\u62ec\u63d0\u793a\u548c\u5b8c\u6210\u90e8\u5206\uff09\u3002\u901a\u5e38\u7528\u8fd9\u4e2a\u6216max_completion_tokens\u3002</p> </li> <li> <p><code>modalities: Optional[List[ChatCompletionModality]] = None</code>\uff1a\u6307\u5b9a\u4ea4\u4e92\u7684\u6a21\u6001\uff08\u5982\u6587\u672c\u3001\u56fe\u50cf\u7b49\uff09\uff0c\u53ef\u80fd\u662f\u591a\u6a21\u6001\u8f93\u5165\u3002</p> </li> <li> <p><code>prediction: Optional[ChatCompletionPredictionContentParam] = None</code>\uff1a\u9884\u6d4b\u5185\u5bb9\u53c2\u6570\uff0c\u53ef\u80fd\u7528\u4e8e\u6307\u5b9a\u751f\u6210\u5185\u5bb9\u7684\u7ed3\u6784\u6216\u7c7b\u578b\u3002</p> </li> <li> <p><code>audio: Optional[ChatCompletionAudioParam] = None</code>\uff1a\u97f3\u9891\u53c2\u6570\uff0c\u53ef\u80fd\u7528\u4e8e\u8bed\u97f3\u8f93\u5165\u6216\u8f93\u51fa\u3002</p> </li> <li> <p><code>presence_penalty: Optional[float] = None</code>\uff1a\u5b58\u5728\u60e9\u7f5a\uff0c\u7528\u4e8e\u964d\u4f4e\u5df2\u7ecf\u51fa\u73b0\u8fc7\u7684token\u7684\u6982\u7387\u3002</p> </li> <li> <p><code>frequency_penalty: Optional[float] = None</code>\uff1a\u9891\u7387\u60e9\u7f5a\uff0c\u7528\u4e8e\u964d\u4f4e\u9891\u7e41\u51fa\u73b0\u7684token\u7684\u6982\u7387\u3002</p> </li> <li> <p><code>logit_bias: Optional[dict] = None</code>\uff1a\u4e00\u4e2a\u5b57\u5178\uff0c\u7528\u4e8e\u8c03\u6574\u7279\u5b9atoken\u7684\u751f\u6210\u6982\u7387\uff08\u901a\u8fc7\u8c03\u6574logit\u503c\uff09\u3002</p> </li> <li> <p><code>user: Optional[str] = None</code>\uff1a\u7ec8\u7aef\u7528\u6237\u7684\u6807\u8bc6\u7b26\uff0c\u7528\u4e8e\u76d1\u63a7\u548c\u6ee5\u7528\u68c0\u6d4b\u3002</p> </li> <li> <p><code>reasoning_effort: Optional[Literal[\"low\", \"medium\", \"high\"]] = None</code>\uff1a\u6307\u5b9a\u6a21\u578b\u63a8\u7406\u7684\u52aa\u529b\u7a0b\u5ea6\uff08\u53ef\u80fd\u5f71\u54cd\u54cd\u5e94\u65f6\u95f4\u548c\u8d28\u91cf\uff09\u3002</p> </li> <li> <p><code>response_format: Optional[Union[dict, Type[BaseModel]]] = None</code>\uff1a\u6307\u5b9a\u54cd\u5e94\u683c\u5f0f\uff0c\u6bd4\u5982JSON\u5bf9\u8c61\uff0c\u6216\u8005\u4f7f\u7528Pydantic\u7684BaseModel\u5b9a\u4e49\u7ed3\u6784\u3002</p> </li> <li> <p><code>seed: Optional[int] = None</code>\uff1a\u968f\u673a\u79cd\u5b50\uff0c\u7528\u4e8e\u4f7f\u751f\u6210\u7ed3\u679c\u5177\u6709\u786e\u5b9a\u6027\u3002</p> </li> <li> <p><code>tools: Optional[List] = None</code>\uff1a\u4e00\u4e2a\u5de5\u5177\u5217\u8868\uff0c\u6a21\u578b\u53ef\u4ee5\u8c03\u7528\u8fd9\u4e9b\u5de5\u5177\uff08\u7c7b\u4f3c\u4e8efunctions\u7684\u66ff\u4ee3\uff09\u3002</p> </li> <li> <p><code>tool_choice: Optional[Union[str, dict]] = None</code>\uff1a\u63a7\u5236\u6a21\u578b\u5982\u4f55\u9009\u62e9\u5de5\u5177\uff0c\u53ef\u4ee5\u662f\"auto\"\u3001\"none\"\uff0c\u6216\u6307\u5b9a\u67d0\u4e2a\u5de5\u5177\u3002</p> </li> <li> <p><code>logprobs: Optional[bool] = None</code>\uff1a\u662f\u5426\u8fd4\u56de\u6bcf\u4e2atoken\u7684\u5bf9\u6570\u6982\u7387\u3002</p> </li> <li> <p><code>top_logprobs: Optional[int] = None</code>\uff1a\u5982\u679clogprobs\u4e3aTrue\uff0c\u8fd9\u4e2a\u53c2\u6570\u6307\u5b9a\u8fd4\u56de\u6bcf\u4e2a\u4f4d\u7f6e\u6982\u7387\u6700\u9ad8\u7684\u51e0\u4e2atoken\u53ca\u5176\u5bf9\u6570\u6982\u7387\u3002</p> </li> <li> <p><code>parallel_tool_calls: Optional[bool] = None</code>\uff1a\u662f\u5426\u5141\u8bb8\u6a21\u578b\u5e76\u884c\u8c03\u7528\u591a\u4e2a\u5de5\u5177\uff08\u5982\u679c\u652f\u6301\uff09\u3002</p> </li> <li> <p><code>web_search_options: Optional[OpenAIWebSearchOptions] = None</code>\uff1a\u7f51\u7edc\u641c\u7d22\u9009\u9879\uff0c\u53ef\u80fd\u7528\u4e8e\u8ba9\u6a21\u578b\u5728\u751f\u6210\u524d\u8fdb\u884c\u7f51\u7edc\u641c\u7d22\u3002</p> </li> <li> <p><code>deployment_id=None</code>\uff1a\u90e8\u7f72ID\uff0c\u53ef\u80fd\u7528\u4e8eAzure OpenAI\u670d\u52a1\uff0c\u6307\u5b9a\u7279\u5b9a\u7684\u90e8\u7f72\u3002</p> </li> <li> <p><code>extra_headers: Optional[dict] = None</code>\uff1a\u989d\u5916\u7684HTTP\u5934\uff0c\u7528\u4e8e\u81ea\u5b9a\u4e49\u8bf7\u6c42\u3002</p> </li> <li> <p><code>functions: Optional[List] = None</code>\uff1a\u51fd\u6570\u5217\u8868\uff08\u65e7\u7248\uff09\uff0c\u6a21\u578b\u53ef\u4ee5\u8c03\u7528\u8fd9\u4e9b\u51fd\u6570\uff08\u5c06\u88abtools\u53d6\u4ee3\uff09\u3002</p> </li> <li> <p><code>function_call: Optional[str] = None</code>\uff1a\u63a7\u5236\u51fd\u6570\u8c03\u7528\u884c\u4e3a\uff0c\u5982\"auto\"\u3001\"none\"\u6216\u5f3a\u5236\u8c03\u7528\u7279\u5b9a\u51fd\u6570\u3002</p> </li> <li> <p><code>base_url: Optional[str] = None</code>\uff1aAPI\u7684\u57fa\u7840URL\uff0c\u7528\u4e8e\u8986\u76d6\u9ed8\u8ba4\u7684OpenAI API\u5730\u5740\u3002</p> </li> <li> <p><code>api_version: Optional[str] = None</code>\uff1aAPI\u7248\u672c\uff0c\u7279\u522b\u7528\u4e8eAzure OpenAI\u670d\u52a1\u3002</p> </li> <li> <p><code>api_key: Optional[str] = None</code>\uff1aAPI\u5bc6\u94a5\uff0c\u7528\u4e8e\u8ba4\u8bc1\u3002</p> </li> <li> <p><code>model_list: Optional[list] = None</code>\uff1a\u4e00\u4e2a\u5217\u8868\uff0c\u53ef\u80fd\u5305\u542b\u591a\u4e2aAPI\u7684\u914d\u7f6e\uff08\u5982\u591a\u4e2abase_url\u548capi_key\uff09\uff0c\u7528\u4e8e\u8d1f\u8f7d\u5747\u8861\u6216\u56de\u9000\u3002</p> </li> <li> <p><code>thinking: Optional[AnthropicThinkingParam] = None</code>\uff1a\u7279\u5b9a\u4e8eAnthropic\u6a21\u578b\u7684\u53c2\u6570\uff0c\u53ef\u80fd\u7528\u4e8e\u63a7\u5236\u6a21\u578b\u7684\u201c\u601d\u8003\u201d\u8fc7\u7a0b\u3002</p> </li> <li> <p><code>**kwargs</code>\uff1a\u5176\u4ed6\u672a\u6307\u5b9a\u7684\u53c2\u6570\uff0c\u7528\u4e8e\u5411\u524d\u6216\u5411\u540e\u517c\u5bb9\u3002</p> </li> </ol> <p>\u8fd4\u56de\u7c7b\u578b\uff1a<code>Union[ModelResponse, CustomStreamWrapper]</code>\uff0c\u8868\u793a\u8fd4\u56de\u4e00\u4e2a\u6a21\u578b\u54cd\u5e94\u5bf9\u8c61\uff0c\u6216\u8005\u5982\u679c\u662f\u6d41\u5f0f\u54cd\u5e94\uff0c\u5219\u8fd4\u56de\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684\u6d41\u5305\u88c5\u5668\u3002</p> <p>\u6ce8\u610f\uff1a\u8fd9\u4e2a\u51fd\u6570\u662f\u4e00\u4e2a\u5c01\u88c5\u51fd\u6570\uff0c\u7528\u4e8e\u7edf\u4e00\u8c03\u7528\u4e0d\u540c\u63d0\u4f9b\u8005\uff08\u5982OpenAI\u3001Anthropic\u7b49\uff09\u7684API\uff0c\u56e0\u6b64\u53c2\u6570\u975e\u5e38\u4e30\u5bcc\uff0c\u6db5\u76d6\u4e86\u591a\u4e2a\u63d0\u4f9b\u8005\u7684\u7279\u5b9a\u53c2\u6570\u3002</p> <p>\u4e3a\u4e86\u4fbf\u4e8e\u7406\u89e3\u5404\u4e2a\u53c2\u6570\u7684\u4f5c\u7528\uff0c\u63a5\u4e0b\u6765\u5c06\u6309\u7167\u53c2\u6570\u7684\u529f\u80fd\u5206\u7c7b\uff0c\u6574\u7406\u6210\u8868\u683c\uff0c\u4ee5\u4e0b\u662f <code>completion</code> \u51fd\u6570\u53c2\u6570\u7684\u5206\u7c7b\u6574\u7406\u8868\u683c\uff1a</p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_16","title":"\u57fa\u7840\u53c2\u6570","text":"\u53c2\u6570\u540d \u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e <code>model</code> <code>str</code> - \u5fc5\u9700\uff0c\u6a21\u578b\u540d\u79f0\uff08\u5982 <code>gpt-4-turbo</code>\uff09 <code>messages</code> <code>List</code> <code>[]</code> \u5fc5\u9700\uff0c\u804a\u5929\u6d88\u606f\u5217\u8868\uff08\u683c\u5f0f\uff1a<code>[{\"role\": \"user\", \"content\": \"text\"}]</code>\uff09"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_17","title":"\u751f\u6210\u63a7\u5236\u53c2\u6570","text":"\u53c2\u6570\u540d \u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e <code>temperature</code> <code>float</code> <code>None</code> \u968f\u673a\u6027\u63a7\u5236\uff080.0-2.0\uff09\uff0c\u503c\u8d8a\u9ad8\u8f93\u51fa\u8d8a\u968f\u673a <code>top_p</code> <code>float</code> <code>None</code> \u6838\u91c7\u6837\u9608\u503c\uff080.0-1.0\uff09\uff0c\u4ec5\u7d2f\u79ef\u6982\u7387\u8d85\u8fc7\u9608\u503c\u7684\u8bcd\u53c2\u4e0e\u91c7\u6837 <code>max_tokens</code> <code>int</code> <code>None</code> \u8f93\u5165+\u8f93\u51fa\u603b token \u6570\u4e0a\u9650 <code>max_completion_tokens</code> <code>int</code> <code>None</code> \u4ec5\u8f93\u51fa token \u6570\u4e0a\u9650 <code>stop</code> <code>Union[str, List[str]]</code> <code>None</code> \u505c\u6b62\u751f\u6210\u6807\u8bb0\uff08\u5982 <code>[\"\\n\", \".\"]</code>\uff09 <code>n</code> <code>int</code> <code>None</code> \u751f\u6210\u591a\u6761\u72ec\u7acb\u56de\u590d\u7684\u6570\u91cf <code>seed</code> <code>int</code> <code>None</code> \u968f\u673a\u79cd\u5b50\uff0c\u786e\u4fdd\u7ed3\u679c\u53ef\u590d\u73b0"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_18","title":"\u9ad8\u7ea7\u63a7\u5236\u53c2\u6570","text":"\u53c2\u6570\u540d \u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e <code>presence_penalty</code> <code>float</code> <code>None</code> \u60e9\u7f5a\u5df2\u51fa\u73b0 token\uff08-2.0~2.0\uff09\uff0c\u907f\u514d\u91cd\u590d\u5185\u5bb9 <code>frequency_penalty</code> <code>float</code> <code>None</code> \u60e9\u7f5a\u9ad8\u9891 token\uff08-2.0~2.0\uff09\uff0c\u907f\u514d\u5e38\u89c1\u8bcd\u6ee5\u7528 <code>logit_bias</code> <code>dict</code> <code>None</code> \u7279\u5b9a token \u6982\u7387\u504f\u79fb\uff08\u5982 <code>{12345: 5.0}</code> \u63d0\u9ad8\u8be5 token \u6982\u7387\uff09 <code>logprobs</code> <code>bool</code> <code>None</code> \u662f\u5426\u8fd4\u56de token \u5bf9\u6570\u6982\u7387 <code>top_logprobs</code> <code>int</code> <code>None</code> \u8fd4\u56de\u6bcf\u4e2a\u4f4d\u7f6e\u6982\u7387\u6700\u9ad8\u7684 token \u6570\u91cf\uff08\u9700 <code>logprobs=True</code>\uff09 <code>user</code> <code>str</code> <code>None</code> \u7ec8\u7aef\u7528\u6237 ID\uff08\u7528\u4e8e\u6ee5\u7528\u76d1\u63a7\uff09"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_19","title":"\u591a\u6a21\u6001\u4e0e\u5de5\u5177\u8c03\u7528","text":"\u53c2\u6570\u540d \u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e <code>modalities</code> <code>List[ChatCompletionModality]</code> <code>None</code> \u591a\u6a21\u6001\u8f93\u5165\u7c7b\u578b\uff08\u6587\u672c/\u56fe\u50cf/\u97f3\u9891\uff09 <code>audio</code> <code>ChatCompletionAudioParam</code> <code>None</code> \u97f3\u9891\u8f93\u5165\u53c2\u6570\uff08\u5982\u8bed\u97f3\u8f6c\u6587\u672c\uff09 <code>tools</code> <code>List</code> <code>None</code> \u65b0\u7248\u5de5\u5177\u8c03\u7528\u5217\u8868\uff08\u66ff\u4ee3 <code>functions</code>\uff09 <code>tool_choice</code> <code>Union[str, dict]</code> <code>None</code> \u5de5\u5177\u8c03\u7528\u63a7\u5236\uff08<code>\"auto\"</code>/<code>\"none\"</code> \u6216\u6307\u5b9a\u5de5\u5177\uff09 <code>parallel_tool_calls</code> <code>bool</code> <code>None</code> \u662f\u5426\u5141\u8bb8\u5e76\u884c\u8c03\u7528\u591a\u4e2a\u5de5\u5177 <code>functions</code> <code>List</code> <code>None</code> \u65e7\u7248\u51fd\u6570\u5217\u8868\uff08\u5373\u5c06\u5f03\u7528\uff09 <code>function_call</code> <code>str</code> <code>None</code> \u65e7\u7248\u51fd\u6570\u8c03\u7528\u63a7\u5236\uff08\u5373\u5c06\u5f03\u7528\uff09"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_20","title":"\u6d41\u5f0f\u4f20\u8f93","text":"\u53c2\u6570\u540d \u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e <code>stream</code> <code>bool</code> <code>None</code> \u662f\u5426\u542f\u7528\u6d41\u5f0f\u4f20\u8f93 <code>stream_options</code> <code>dict</code> <code>None</code> \u6d41\u5f0f\u914d\u7f6e\uff08\u5982 <code>{\"include_usage\": true}</code>\uff09"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_21","title":"\u6a21\u578b\u63a8\u7406\u63a7\u5236","text":"\u53c2\u6570\u540d \u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e <code>reasoning_effort</code> <code>Literal[\"low\",\"medium\",\"high\"]</code> <code>None</code> \u63a8\u7406\u5f3a\u5ea6\uff08\u5f71\u54cd\u54cd\u5e94\u8d28\u91cf\u4e0e\u5ef6\u8fdf\uff09 <code>prediction</code> <code>ChatCompletionPredictionContentParam</code> <code>None</code> \u9884\u6d4b\u5185\u5bb9\u7ed3\u6784\u5316\u53c2\u6570 <code>thinking</code> <code>AnthropicThinkingParam</code> <code>None</code> Anthropic \u6a21\u578b\u4e13\u7528\u601d\u8003\u63a7\u5236"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_22","title":"\u641c\u7d22\u4e0e\u54cd\u5e94\u683c\u5f0f","text":"\u53c2\u6570\u540d \u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e <code>web_search_options</code> <code>OpenAIWebSearchOptions</code> <code>None</code> \u7f51\u7edc\u641c\u7d22\u914d\u7f6e\uff08\u5982\u542f\u7528\u5b9e\u65f6\u641c\u7d22\uff09 <code>response_format</code> <code>Union[dict, Type[BaseModel]]</code> <code>None</code> \u54cd\u5e94\u683c\u5f0f\uff08\u5982 <code>{\"type\": \"json_object\"}</code> \u6216 Pydantic \u6a21\u578b\uff09"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#api","title":"API \u914d\u7f6e","text":"\u53c2\u6570\u540d \u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e <code>api_key</code> <code>str</code> <code>None</code> \u8986\u76d6\u9ed8\u8ba4 API \u5bc6\u94a5 <code>base_url</code> <code>str</code> <code>None</code> \u8986\u76d6 API \u5730\u5740\uff08\u5982 Azure \u7aef\u70b9\uff09 <code>api_version</code> <code>str</code> <code>None</code> \u6307\u5b9a API \u7248\u672c\uff08Azure \u5fc5\u9700\uff09 <code>model_list</code> <code>list</code> <code>None</code> \u591a\u6a21\u578b\u914d\u7f6e\u5217\u8868\uff08\u8d1f\u8f7d\u5747\u8861/\u6545\u969c\u8f6c\u79fb\uff09 <code>deployment_id</code> <code>str</code> <code>None</code> Azure \u90e8\u7f72 ID"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_23","title":"\u5176\u4ed6\u53c2\u6570","text":"\u53c2\u6570\u540d \u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e <code>timeout</code> <code>Union[float, str, httpx.Timeout]</code> <code>None</code> \u8bf7\u6c42\u8d85\u65f6\u65f6\u95f4\uff08\u79d2\u6216 <code>httpx.Timeout</code> \u5bf9\u8c61\uff09 <code>extra_headers</code> <code>dict</code> <code>None</code> \u81ea\u5b9a\u4e49 HTTP \u5934 <code>kwargs</code> <code>Any</code> - \u517c\u5bb9\u672a\u6765\u6269\u5c55\u7684\u989d\u5916\u53c2\u6570"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_24","title":"\u8fd4\u56de\u503c","text":"\u7c7b\u578b \u8bf4\u660e <code>ModelResponse</code> \u975e\u6d41\u5f0f\u54cd\u5e94\u65f6\u7684\u7ed3\u6784\u5316\u5bf9\u8c61 <code>CustomStreamWrapper</code> \u6d41\u5f0f\u54cd\u5e94\u65f6\u7684\u8fed\u4ee3\u5668\u5305\u88c5\u5668 <p>\u5173\u952e\u8bf4\u660e\uff1a 1. \u90e8\u5206\u53c2\u6570\uff08\u5982 <code>modalities</code>\u3001<code>audio</code>\uff09\u9700\u7279\u5b9a\u6a21\u578b\u652f\u6301\uff08\u5982 GPT-4o\uff09 2. <code>tools</code> \u5df2\u53d6\u4ee3 <code>functions</code>\uff0c\u63a8\u8350\u4f7f\u7528\u65b0\u53c2\u6570 3. openai\u63a5\u53e3\u5b8c\u6574\u6587\u6863\u53c2\u8003\uff1aOpenAI API \u6587\u6863(https://platform.openai.com/docs/api-reference/chat/create)</p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#litellm-python-sdk_2","title":"LiteLLM Python SDK \u5b9e\u8df5","text":"<p>\u4e0b\u9762\u7684\u5b9e\u8df5\u4e2d\u4e3b\u8981\u4f7f\u7528\u4e86 completion \u65b9\u6cd5\u7684\u57fa\u7840\u53c2\u6570(model\u548cmessages)\u548cAPI \u914d\u7f6e\u53c2\u6570(base_url \u548c api_key)\u3002</p> <p>\u26a0\ufe0f\u6ce8\u610f\uff1a\u4f7f\u7528 model \u53c2\u6570\u65f6\u9700\u8981\u5728\u6a21\u578b\u540d\u79f0\u524d\u9762\u6dfb\u52a0 provider \u7684\u540d\u79f0\uff0c\u67e5\u770b litellm \u652f\u6301\u7684 provider \u3002 \u5728 LiteLLM \u4e2d\uff0c<code>model</code> \u53c2\u6570\u7684\u8bbe\u8ba1\u975e\u5e38\u7075\u6d3b\uff0c\u5b83\u5141\u8bb8\u4f60\u901a\u8fc7\u4e00\u4e2a\u5b57\u7b26\u4e32\u540c\u65f6\u6307\u5b9a\u6a21\u578b\u540d\u79f0\u548c\u63d0\u4f9b\u5546\uff08provider\uff09\uff0c\u8fd9\u79cd\u8bbe\u8ba1\u4e3b\u8981\u662f\u4e3a\u4e86\u7b80\u5316\u591a\u6a21\u578b\u3001\u591a\u63d0\u4f9b\u5546\u7684\u8c03\u7528\u7ba1\u7406\u3002</p> <p>provider \u540d\u79f0\u7684\u4f5c\u7528 1. \u786e\u5b9a API \u7aef\u70b9\uff1a\u5982\u679c\u6ca1\u6709\u6307\u5b9a base_url \u53c2\u6570\uff0c\u90a3\u4e48\u5219LiteLLM \u6839\u636e provider \u540d\u79f0\u786e\u5b9a\u5e94\u8be5\u5c06\u8bf7\u6c42\u53d1\u9001\u5230\u54ea\u4e2a API \u7aef\u70b9\u3002 2. \u9009\u62e9\u6b63\u786e\u7684\u8ba4\u8bc1\u65b9\u5f0f\uff1a\u4e0d\u540c\u7684\u63d0\u4f9b\u5546\u4f7f\u7528\u4e0d\u540c\u7684\u8ba4\u8bc1\u65b9\u5f0f\uff08\u4f8b\u5982 API Key \u7684\u4f4d\u7f6e\u548c\u683c\u5f0f\uff09\u3002LiteLLM \u4f1a\u6839\u636e provider \u4f7f\u7528\u6b63\u786e\u7684\u8ba4\u8bc1\u65b9\u5f0f\u3002 3. \u8f6c\u6362\u8bf7\u6c42\u683c\u5f0f\uff1a\u6bcf\u4e2a\u63d0\u4f9b\u5546\u7684 API \u8bf7\u6c42\u683c\u5f0f\u53ef\u80fd\u4e0d\u540c\u3002LiteLLM \u4f1a\u5c06\u6807\u51c6\u7684 <code>messages</code> \u5217\u8868\u8f6c\u6362\u4e3a\u76ee\u6807\u63d0\u4f9b\u5546\u6240\u9700\u7684\u683c\u5f0f\u3002 4. \u8f6c\u6362\u54cd\u5e94\u683c\u5f0f\uff1aLiteLLM \u4f1a\u5c06\u4e0d\u540c\u63d0\u4f9b\u5546\u7684\u54cd\u5e94\u8f6c\u6362\u4e3a\u7edf\u4e00\u7684\u6807\u51c6\u683c\u5f0f\uff08\u7c7b\u4f3c\u4e8e OpenAI \u7684\u683c\u5f0f\uff09\u3002</p> <p>\u5982\u679c\u4f60\u6709\u4e00\u4e2a\u81ea\u5b9a\u4e49\u6a21\u578b\u6216\u8005\u672c\u5730\u90e8\u7f72\u7684\u6a21\u578b\uff0c\u53ef\u80fd\u5c31\u9700\u8981\u660e\u786e\u6307\u5b9a provider\u3002</p> <p>\u56e0\u4e3a\u8fd9\u91cc\u5b9e\u8df5\u4f7f\u7528\u7684 deepseek \u548c \u963f\u91cc\u4e91\u767e\u70bc \u8fd9\u4e24\u4e2a\u5e73\u53f0\u63d0\u4f9b\u7684\u670d\u52a1\u63a5\u53e3\u90fd\u517c\u5bb9 openai \u63a5\u53e3\u683c\u5f0f\uff0c\u6240\u4ee5\u5728\u8bbe\u7f6e model \u53c2\u6570\u65f6\u90fd\u5e94\u8be5\u5728\u6a21\u578b\u7684\u540d\u79f0\u524d\u9762\u52a0\u4e0a openai/\uff0c\u4f8b\u5982\uff1a<code>openai/qwen-turbo</code> \u6216 <code>openai/deepseek-chat</code></p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#1","title":"1.\u975e\u6d41\u5f0f\u5bf9\u8bdd","text":""},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_25","title":"\u4f7f\u7528\u963f\u91cc\u4e91\u767e\u70bc\u5e73\u53f0\u975e\u6d41\u5f0f\u5bf9\u8bdd","text":"<p>\u53c2\u8003\u6587\u6863\uff1a\u901a\u4e49\u5343\u95ee API \u7684\u8f93\u5165\u8f93\u51fa\u53c2\u6570</p> <pre><code>import os\nimport litellm\n\nBAILIAN_API_KEY = \"sk-a47e70844cc843cea2ba5f23663f13d5\"\nos.environ[\"BAILIAN_API_KEY\"] = BAILIAN_API_KEY\n\nmessages=[{\"role\": \"user\", \"content\": \"\u4f60\u662f\u8c01\"}]\n\nresponse = litellm.completion(\n    model=\"openai/qwen-turbo\",\n    messages=messages,\n    base_url=\"https://dashscope.aliyuncs.com/compatible-mode/v1\",\n    api_key=os.getenv(\"BAILIAN_API_KEY\"),\n)\n\nresponse.choices[0].message\n</code></pre> <pre><code>Message(content='\u6211\u662f\u901a\u4e49\u5343\u95ee\uff0c\u963f\u91cc\u5df4\u5df4\u96c6\u56e2\u65d7\u4e0b\u7684\u901a\u4e49\u5b9e\u9a8c\u5ba4\u81ea\u4e3b\u7814\u53d1\u7684\u8d85\u5927\u89c4\u6a21\u8bed\u8a00\u6a21\u578b\u3002\u6211\u80fd\u591f\u5e2e\u52a9\u60a8\u56de\u7b54\u95ee\u9898\u3001\u521b\u4f5c\u6587\u5b57\uff0c\u5982\u5199\u6545\u4e8b\u3001\u516c\u6587\u3001\u6280\u672f\u6587\u6863\u7b49\uff0c\u8fd8\u80fd\u8fdb\u884c\u903b\u8f91\u63a8\u7406\u3001\u7f16\u7a0b\uff0c\u8868\u8fbe\u89c2\u70b9\uff0c\u73a9\u6e38\u620f\u7b49\u3002\u5982\u679c\u60a8\u6709\u4efb\u4f55\u95ee\u9898\u6216\u9700\u8981\u5e2e\u52a9\uff0c\u6b22\u8fce\u968f\u65f6\u544a\u8bc9\u6211\uff01', role='assistant', tool_calls=None, function_call=None, provider_specific_fields={'refusal': None})\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#deepseek","title":"\u4f7f\u7528 deepseek \u975e\u6d41\u5f0f\u5bf9\u8bdd","text":"<p>\u53c2\u8003 deepseek \u5b98\u65b9\u6587\u6863\uff0c\u53ef\u4ee5\u77e5\u9053 <code>base_url=https://api.deepseek.com/</code>, \u56e0\u4e3a deepseek \u5e73\u53f0\u63d0\u4f9b\u7684\u63a5\u53e3\u4e5f\u662f\u517c\u5bb9 openai \u63a5\u53e3\u7684\uff0c\u6240\u4ee5 model \u53c2\u6570\u9700\u8981\u8bbe\u7f6e\u4e3a <code>openai/deepseek-chat</code>\uff0cdeepseek \u5176\u4ed6\u53ef\u9009\u7684\u6a21\u578b\u540d\u79f0\u53ef\u4ee5\u5728deepseek\u5b98\u7f51\u67e5\u770b\u3002</p> <p>\u4e0b\u9762\u662f\u4f7f\u7528 litellm \u96c6\u6210 deepseek \u6a21\u578b\u670d\u52a1\u975e\u6d41\u5f0f\u63a5\u53e3\u7684\u793a\u4f8b\uff1a</p> <pre><code>import os\nimport litellm\n\nDEEPSEEK_API_KEY = \"sk-783df6a1c50445d7b0994a7a5b3ef6e3\"\nos.environ[\"DEEPSEEK_API_KEY\"] = DEEPSEEK_API_KEY\n\nmessages=[{\"role\": \"user\", \"content\": \"\u4f60\u662f\u8c01\"}]\n\nresponse = litellm.completion(\n    model=\"openai/deepseek-chat\",\n    messages=messages,\n    base_url=\"https://api.deepseek.com/\",\n    api_key=os.getenv(\"DEEPSEEK_API_KEY\"),\n)\n\nresponse.choices[0].message\n</code></pre> <pre><code>Message(content='\u6211\u662fDeepSeek Chat\uff0c\u7531\u6df1\u5ea6\u6c42\u7d22\u516c\u53f8\u521b\u9020\u7684\u667a\u80fdAI\u52a9\u624b\uff01\ud83e\udd16\u2728 \u6211\u7684\u4f7f\u547d\u662f\u4e3a\u4f60\u63d0\u4f9b\u5404\u79cd\u95ee\u9898\u7684\u89e3\u7b54\u3001\u521b\u610f\u7075\u611f\u3001\u5b66\u4e60\u8f85\u52a9\uff0c\u751a\u81f3\u966a\u4f60\u804a\u5929\u89e3\u95f7\u3002\u65e0\u8bba\u662f\u77e5\u8bc6\u67e5\u8be2\u3001\u5199\u4f5c\u5efa\u8bae\uff0c\u8fd8\u662f\u65e5\u5e38\u5c0f\u56f0\u60d1\uff0c\u90fd\u53ef\u4ee5\u95ee\u6211\u54e6\uff01\u6709\u4ec0\u4e48\u6211\u53ef\u4ee5\u5e2e\u4f60\u7684\u5417\uff1f\ud83d\ude0a', role='assistant', tool_calls=None, function_call=None, provider_specific_fields={'refusal': None})\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#2","title":"2.\u6d41\u5f0f\u5bf9\u8bdd","text":"<p>\u4f7f\u7528 litellm \u5f00\u542f\u6d41\u5f0f\u5bf9\u8bdd\u975e\u5e38\u7b80\u5355\uff0c\u53ea\u9700\u8981\u5728 <code>completion</code> \u65b9\u6cd5\u4e2d\u6dfb\u52a0\u53c2\u6570 <code>stream=True</code> \u5373\u53ef\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>import os\nimport litellm\n\n\nmessages=[{\"role\": \"user\", \"content\": \"\u4f60\u662f\u8c01\"}]\n\nresponse = litellm.completion(\n    model=\"openai/qwen-turbo\",\n    messages=messages,\n    base_url=\"https://dashscope.aliyuncs.com/compatible-mode/v1\",\n    api_key=os.getenv(\"BAILIAN_API_KEY\"),\n    stream=True,  # \u5f00\u542f\u6d41\u5f0f\u5bf9\u8bdd\n)\n# \u6d41\u5f0f\u5bf9\u8bddcompletion\u65b9\u6cd5\u8fd4\u56de\u7684\u662f CustomStreamWrapper\uff0c\u53ef\u4ee5\u8fed\u4ee3\u83b7\u53d6\u6d41\u5f0f\u5bf9\u8bdd\u7684chunk\nfor chunk in response:\n    print(chunk.choices[0].delta or \"\")\n</code></pre> <pre><code>Delta(provider_specific_fields=None, refusal=None, content='\u6211\u662f', role='assistant', function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u901a', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u4e49', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u5343\u95ee\uff0c\u963f\u91cc\u5df4\u5df4', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u96c6\u56e2\u65d7\u4e0b\u7684\u901a\u4e49', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u5b9e\u9a8c\u5ba4\u81ea\u4e3b\u7814\u53d1\u7684\u8d85', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u5927\u89c4\u6a21\u8bed\u8a00\u6a21\u578b\u3002', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u6211\u80fd\u591f\u5e2e\u52a9\u60a8', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u56de\u7b54\u95ee\u9898\u3001\u521b\u4f5c', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u6587\u5b57\uff0c\u5982\u5199', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u6545\u4e8b\u3001\u516c\u6587', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u3001\u6280\u672f\u6587\u6863\u7b49', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\uff0c\u8fd8\u80fd\u8fdb\u884c\u903b\u8f91', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u63a8\u7406\u3001\u7f16\u7a0b\uff0c', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u8868\u8fbe\u89c2\u70b9\uff0c\u73a9\u6e38\u620f', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u7b49\u3002\u5982\u679c\u60a8\u6709\u4efb\u4f55', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u95ee\u9898\u6216\u9700\u8981\u5e2e\u52a9', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\uff0c\u6b22\u8fce\u968f\u65f6\u544a\u8bc9\u6211', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\uff01', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, content=None, role=None, function_call=None, tool_calls=None, audio=None)\n</code></pre> <pre><code>import os\nimport litellm\n\nmessages=[{\"role\": \"user\", \"content\": \"\u4f60\u662f\u8c01\"}]\n\nresponse = litellm.completion(\n    model=\"openai/deepseek-chat\",\n    messages=messages,\n    base_url=\"https://api.deepseek.com/\",\n    api_key=os.getenv(\"DEEPSEEK_API_KEY\"),\n    stream=True,  # \u5f00\u542f\u6d41\u5f0f\u5bf9\u8bdd\n)\n\nfor chunk in response:\n    print(chunk.choices[0].delta or \"\")\n</code></pre> <pre><code>Delta(provider_specific_fields=None, refusal=None, content='\u6211\u662f', role='assistant', function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='Deep', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='Se', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='ek', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content=' Chat', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\uff0c', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u7531', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u6df1\u5ea6', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u6c42', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u7d22', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u516c\u53f8', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u521b\u9020\u7684', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u667a\u80fd', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='AI', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u52a9\u624b', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\uff01', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\ud83e\udd16', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u2728', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content=' ', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u6211\u7684', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u4f7f\u547d', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u662f', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u5e2e\u52a9\u4f60', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u89e3\u7b54', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u5404\u79cd', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u95ee\u9898', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\uff0c', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u65e0\u8bba\u662f', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u5b66\u4e60', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u3001', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u5de5\u4f5c', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\uff0c', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u8fd8\u662f', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u65e5\u5e38', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u751f\u6d3b\u4e2d\u7684', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u5c0f', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u56f0\u60d1', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u3002', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u6211\u53ef\u4ee5', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u966a\u4f60', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u804a\u5929', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u3001', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u63d0\u4f9b', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u5efa\u8bae', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u3001', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u67e5\u627e', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u4fe1\u606f', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\uff0c', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u751a\u81f3', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u5e2e\u4f60', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u5206\u6790', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u6587\u6863', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\uff01', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\ud83d\udcda', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\ud83d\udca1', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='  \\n\\n', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u6709\u4ec0\u4e48', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u6211\u53ef\u4ee5', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u5e2e', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u4f60\u7684', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\u5417', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\uff1f', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, refusal=None, content='\ud83d\ude0a', role=None, function_call=None, tool_calls=None, audio=None)\nDelta(provider_specific_fields=None, content=None, role=None, function_call=None, tool_calls=None, audio=None)\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_26","title":"\u6d41\u5f0f\u5bf9\u8bdd\u8f85\u52a9\u51fd\u6570","text":"<p>LiteLLM\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e2a\u8f85\u52a9\u51fd\u6570 <code>litellm.stream_chunk_builder</code>\uff0c\u7528\u4e8e\u4ecechunk\u5217\u8868\u4e2d\u91cd\u5efa\u5b8c\u6574\u7684\u6d41\u54cd\u5e94\u3002</p> <pre><code>import os\nimport litellm\n\nmessages=[{\"role\": \"user\", \"content\": \"\u4f60\u662f\u8c01\"}]\n\nresponse = litellm.completion(\n    model=\"openai/deepseek-chat\",\n    messages=messages,\n    base_url=\"https://api.deepseek.com/\",\n    api_key=os.getenv(\"DEEPSEEK_API_KEY\"),\n    stream=True,  # \u5f00\u542f\u6d41\u5f0f\u5bf9\u8bdd\n)\nchunks = []\nfor chunk in response:\n    chunks.append(chunk)\n\nmodel_response = litellm.stream_chunk_builder(chunks)\nprint(model_response)\nprint(model_response.choices[0].message.content)\n</code></pre> <pre><code>ModelResponse(id='chatcmpl-fc4abbab-0992-432a-8141-6b23098508ae', created=1749107445, model='deepseek-chat', object='chat.completion', system_fingerprint='fp_8802369eaa_prod0425fp8', choices=[Choices(finish_reason='stop', index=0, message=Message(content='\u6211\u662fDeepSeek Chat\uff0c\u7531\u6df1\u5ea6\u6c42\u7d22\u516c\u53f8\u521b\u9020\u7684\u667a\u80fdAI\u52a9\u624b\uff01\ud83e\udd16\u2728 \u6211\u7684\u76ee\u6807\u662f\u5e2e\u52a9\u4f60\u89e3\u7b54\u95ee\u9898\u3001\u63d0\u4f9b\u4fe1\u606f\u3001\u966a\u4f60\u804a\u5929\uff0c\u8fd8\u80fd\u5904\u7406\u5404\u79cd\u6587\u672c\u548c\u6587\u4ef6\u5185\u5bb9\u3002\u65e0\u8bba\u662f\u5b66\u4e60\u3001\u5de5\u4f5c\u8fd8\u662f\u65e5\u5e38\u751f\u6d3b\u4e2d\u7684\u7591\u95ee\uff0c\u90fd\u53ef\u4ee5\u6765\u95ee\u6211\uff01\u6709\u4ec0\u4e48\u6211\u53ef\u4ee5\u5e2e\u4f60\u7684\u5417\uff1f\ud83d\ude0a', role='assistant', tool_calls=None, function_call=None, provider_specific_fields=None))], usage=Usage(completion_tokens=61, prompt_tokens=4, total_tokens=65, completion_tokens_details=CompletionTokensDetailsWrapper(accepted_prediction_tokens=None, audio_tokens=None, reasoning_tokens=0, rejected_prediction_tokens=None, text_tokens=None), prompt_tokens_details=None))\n\u6211\u662fDeepSeek Chat\uff0c\u7531\u6df1\u5ea6\u6c42\u7d22\u516c\u53f8\u521b\u9020\u7684\u667a\u80fdAI\u52a9\u624b\uff01\ud83e\udd16\u2728 \u6211\u7684\u76ee\u6807\u662f\u5e2e\u52a9\u4f60\u89e3\u7b54\u95ee\u9898\u3001\u63d0\u4f9b\u4fe1\u606f\u3001\u966a\u4f60\u804a\u5929\uff0c\u8fd8\u80fd\u5904\u7406\u5404\u79cd\u6587\u672c\u548c\u6587\u4ef6\u5185\u5bb9\u3002\u65e0\u8bba\u662f\u5b66\u4e60\u3001\u5de5\u4f5c\u8fd8\u662f\u65e5\u5e38\u751f\u6d3b\u4e2d\u7684\u7591\u95ee\uff0c\u90fd\u53ef\u4ee5\u6765\u95ee\u6211\uff01\u6709\u4ec0\u4e48\u6211\u53ef\u4ee5\u5e2e\u4f60\u7684\u5417\uff1f\ud83d\ude0a\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_27","title":"\u5f02\u6b65\u6d41\u5f0f\u5bf9\u8bdd","text":"<p><code>litellm.completion</code> \u65b9\u6cd5\u5728\u8fd4\u56de\u7684\u6d41\u5bf9\u8c61\u4e2d\u5b9e\u73b0\u4e86\u4e00\u4e2a<code>__anext__\uff08\uff09</code>\u51fd\u6570\uff0c\u8fd9\u5141\u8bb8\u5bf9\u6d41\u5bf9\u8c61\u8fdb\u884c\u5f02\u6b65\u8fed\u4ee3\u3002</p> <p>\u4f7f\u7528\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>import asyncio, os\nfrom typing import Union, List, Dict, Optional\nimport logging\n\nlogger = logging.getLogger(__name__)\n\nmodel_config_dict = {\n    \"deepseek-chat\": {\n        \"model\": \"openai/deepseek-chat\",\n        \"base_url\": \"https://api.deepseek.com/v1\",\n        \"api_key\": os.getenv(\"DEEPSEEK_API_KEY\"),\n    },\n}\n\nasync def llm_chat(model: str, messages: Union[str, List[Dict[str, str]]], tools: Optional[List] = None, stream=True):\n    logger.info(f'\u4f7f\u7528\u7684\u6a21\u578b\u5982\u4e0b\uff1a{model}')\n    model_config = model_config_dict.get(model)\n    if isinstance(messages, str):\n        messages = [{\"role\": \"user\", \"content\": messages}]\n\n    response = await litellm.acompletion(\n        model=model_config.get('model'),\n        base_url=model_config.get('base_url'),\n        api_key=model_config.get('api_key'),\n        messages=messages,\n        tools=tools,\n        stream=stream,\n    )\n\n    return response\n\nresponse = asyncio.run(llm_chat(model='deepseek-chat', messages='\u4f60\u662f\u8c01', stream=True))\nfor chunk in response:\n    print(chunk.choices[0].delta or \"\")\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_28","title":"\u51fd\u6570\u8c03\u7528","text":"<p>\u63a5\u4e0b\u6765\u91cd\u70b9\u4ecb\u7ecdLiteLLM\u7684\u51fd\u6570\u8c03\u7528\u529f\u80fd\uff0c\u5305\u62ec\u5982\u4f55\u4f7f\u7528\u3001\u652f\u6301\u7684\u6a21\u578b\u4ee5\u53ca\u5e95\u5c42\u673a\u5236</p> <p>\u51fd\u6570\u8c03\u7528\uff08Function Calling\uff09\u5141\u8bb8\u5927\u6a21\u578b\u6839\u636e\u7528\u6237\u8f93\u5165\u667a\u80fd\u8c03\u7528\u9884\u5b9a\u4e49\u7684\u5de5\u5177\u51fd\u6570\u3002LiteLLM\u901a\u8fc7\u6807\u51c6\u5316\u63a5\u53e3\u652f\u6301\u591a\u79cd\u6a21\u578b\u63d0\u4f9b\u5546\u7684\u51fd\u6570\u8c03\u7528\u529f\u80fd\u3002</p> <p>\u5173\u952e\u70b9\uff1a</p> <ol> <li> <p>\u7edf\u4e00\u63a5\u53e3\uff1a\u4f7f\u7528OpenAI\u683c\u5f0f\u7684\u51fd\u6570\u5b9a\u4e49</p> </li> <li> <p>\u591a\u6a21\u578b\u652f\u6301\uff1a\u5305\u62ecOpenAI, Anthropic, Azure, Google\u7b49</p> </li> <li> <p>\u81ea\u52a8\u8f6c\u6362\uff1a\u5c06\u975eOpenAI\u6a21\u578b\u7684\u51fd\u6570\u8c03\u7528\u54cd\u5e94\u8f6c\u6362\u4e3aOpenAI\u683c\u5f0f</p> </li> </ol> <p>\u4f7f\u7528\u6b65\u9aa4\uff1a</p> <ol> <li> <p>\u5b9a\u4e49\u5de5\u5177\u51fd\u6570\u5217\u8868\uff08tools\uff09</p> </li> <li> <p>\u5728completion\u8c03\u7528\u4e2d\u4f20\u5165tools\u53c2\u6570</p> </li> <li> <p>\u89e3\u6790\u6a21\u578b\u8fd4\u56de\u7684\u5de5\u5177\u8c03\u7528\u8bf7\u6c42</p> </li> <li> <p>\u6267\u884c\u672c\u5730\u51fd\u6570</p> </li> <li> <p>\u5c06\u51fd\u6570\u6267\u884c\u7ed3\u679c\u4f20\u56de\u6a21\u578b\uff08\u53ef\u9009\uff0c\u7528\u4e8e\u591a\u8f6e\u5bf9\u8bdd\uff09</p> </li> </ol> <p>\u4e0b\u9762\u8be6\u7ec6\u5c55\u5f00\uff1a</p> <p>\u5982\u679c\u8981\u4f7f\u7528\u51fd\u6570\u8c03\u7528\u529f\u80fd\uff0c\u90a3\u4e48\u9009\u62e9\u7684\u6a21\u578b\u9700\u8981\u652f\u6301\u51fd\u6570\u8c03\u7528\uff0c\u5728 litellm \u4e2d\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5de5\u5177\u65b9\u6cd5 <code>litellm.supports_function_calling</code> \u7528\u6765\u68c0\u67e5\u6a21\u578b\u662f\u5426\u652f\u6301\u51fd\u6570\u8c03\u7528\u3002</p> <p><code>litellm.supports_function_calling</code> \u65b9\u6cd5\u662f\u4ece https://github.com/BerriAI/litellm/blob/main/model_prices_and_context_window.json \u4e2d\u67e5\u8be2\u6a21\u578b\u662f\u5426\u652f\u6301\u51fd\u6570\u8c03\u7528\u3002</p> <p>\u5982\u679c\u9009\u62e9\u7684\u6a21\u578b\u6ca1\u6709\u5728\u8fd9\u4e2a\u5b57\u5178\u4e2d\uff0c\u5219\u65e0\u6cd5\u901a\u8fc7\u8be5\u65b9\u6cd5\u5224\u65ad\uff0c\u6240\u4ee5\u5e94\u8be5\u4ece\u5e73\u53f0\u4e0a\u9762\u9009\u62e9\u652f\u6301\u51fd\u6570\u8c03\u7528\u7684\u6a21\u578b\u3002</p> <p>\u67e5\u770b deepseek \u5b98\u7f51\uff0c\u53ef\u4ee5\u770b\u5230 deepseek-chat \u652f\u6301\u51fd\u6570\u8c03\u7528\u3002</p> <p>\u51fd\u6570\u8c03\u7528\u6d41\u7a0b\u5982\u4e0b\uff1a <pre><code>graph LR\n    A[\u7528\u6237\u8bf7\u6c42] --&gt; B(\u6a21\u578b\u5206\u6790)\n    B --&gt; C{\u662f\u5426\u9700\u8981\u5de5\u5177}\n    C -- \u662f --&gt; D[\u8fd4\u56de\u5de5\u5177\u8c03\u7528\u8bf7\u6c42]\n    C -- \u5426 --&gt; E[\u76f4\u63a5\u751f\u6210\u56de\u7b54]\n    D --&gt; F[\u5f00\u53d1\u8005\u6267\u884c\u51fd\u6570]\n    F --&gt; G[\u8fd4\u56de\u51fd\u6570\u7ed3\u679c]\n    G --&gt; H[\u6a21\u578b\u6574\u5408\u7ed3\u679c]\n    H --&gt; I[\u6700\u7ec8\u54cd\u5e94]</code></pre> \u4e0b\u9762\u662f\u5b9e\u8df5\u4ee3\u7801\uff1a</p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#1_1","title":"1. \u5b9a\u4e49\u5de5\u5177\u51fd\u6570","text":"<pre><code>from pydantic import BaseModel, Field\n\n# \u5b9a\u4e49\u5de5\u5177\u53c2\u6570\u7ed3\u6784\nclass WeatherParams(BaseModel):\n    location: str = Field(description=\"\u57ce\u5e02\u540d\u79f0\uff0c\u5982 '\u5317\u4eac'\")\n    unit: str = Field(description=\"\u6e29\u5ea6\u5355\u4f4d\", default=\"celsius\")\n\n# \u5b9a\u4e49\u80a1\u7968\u67e5\u8be2\u5de5\u5177\nclass StockParams(BaseModel):\n    symbol: str = Field(description=\"\u80a1\u7968\u4ee3\u7801\uff0c\u5982 'AAPL'\")\n    timeframe: str = Field(description=\"\u65f6\u95f4\u8303\u56f4\", default=\"1d\")\n\n\ndef get_weather(params: dict):\n    weather = WeatherParams(**params)\n    if '\u4e0a\u6d77' in weather.location.lower():\n        return {\"location\": \"\u4e0a\u6d77\", \"temperature\": \"10\", \"unit\": \"celsius\"}\n    elif \"\u5317\u4eac\" in weather.location.lower():\n        return {\"location\": \"\u5317\u4eac\", \"temperature\": \"72\", \"unit\": \"fahrenheit\"}\n    elif \"\u6210\u90fd\" in weather.location.lower():\n        return {\"location\": \"\u6210\u90fd\", \"temperature\": \"22\", \"unit\": \"celsius\"}\n    else:\n        return {\"location\": weather.location, \"temperature\": \"\u4e0d\u77e5\u9053\"}\n\ndef get_stock_price(params: dict):\n    stock_param = StockParams(**params)\n    if 'AAPL' in stock_param.symbol:\n        return {\"symbol\": \"AAPL\",\"name\": \"\u82f9\u679c\", \"price\": \"202.82\", \"unit\": \"USD\"}\n    elif \"AMZN\" in stock_param.symbol:\n        return {\"symbol\": \"AMZN\", \"name\": \"\u4e9a\u9a6c\u900a\",\"price\": \"207.23\", \"unit\": \"USD\"}\n    else:\n        return {\"symbol\": stock_param.symbol, \"name\": \"\",\"price\": \"\u4e0d\u77e5\u9053\", \"unit\": \"USD\"}\n\n# \u5de5\u5177\u5217\u8868\ntools = [\n    {\n        \"type\": \"function\",\n        \"function\": {\n            \"name\": \"get_weather\",\n            \"description\": \"\u83b7\u53d6\u6307\u5b9a\u4f4d\u7f6e\u7684\u5f53\u524d\u5929\u6c14\",\n            \"parameters\": WeatherParams.model_json_schema()\n        }\n    },\n    {\n        \"type\": \"function\",\n        \"function\": {\n            \"name\": \"get_stock_price\",\n            \"description\": \"\u83b7\u53d6\u80a1\u7968\u6700\u65b0\u4ef7\u683c\",\n            \"parameters\": StockParams.model_json_schema()\n        }\n    }\n]\n\ntools\n</code></pre> <pre><code>[{'type': 'function',\n  'function': {'name': 'get_weather',\n   'description': '\u83b7\u53d6\u6307\u5b9a\u4f4d\u7f6e\u7684\u5f53\u524d\u5929\u6c14',\n   'parameters': {'properties': {'location': {'description': \"\u57ce\u5e02\u540d\u79f0\uff0c\u5982 '\u5317\u4eac'\",\n      'title': 'Location',\n      'type': 'string'},\n     'unit': {'default': 'celsius',\n      'description': '\u6e29\u5ea6\u5355\u4f4d',\n      'title': 'Unit',\n      'type': 'string'}},\n    'required': ['location'],\n    'title': 'WeatherParams',\n    'type': 'object'}}},\n {'type': 'function',\n  'function': {'name': 'get_stock_price',\n   'description': '\u83b7\u53d6\u80a1\u7968\u6700\u65b0\u4ef7\u683c',\n   'parameters': {'properties': {'symbol': {'description': \"\u80a1\u7968\u4ee3\u7801\uff0c\u5982 'AAPL'\",\n      'title': 'Symbol',\n      'type': 'string'},\n     'timeframe': {'default': '1d',\n      'description': '\u65f6\u95f4\u8303\u56f4',\n      'title': 'Timeframe',\n      'type': 'string'}},\n    'required': ['symbol'],\n    'title': 'StockParams',\n    'type': 'object'}}}]\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#2_1","title":"2. \u53d1\u8d77\u51fd\u6570\u8c03\u7528\u8bf7\u6c42","text":"<pre><code>import asyncio, os\nfrom typing import Union, List, Dict, Optional\nimport logging\n\nlogger = logging.getLogger(__name__)\n\nmodel_config_dict = {\n    \"deepseek-chat\": {\n        \"model\": \"openai/deepseek-chat\",\n        \"base_url\": \"https://api.deepseek.com/v1\",\n        \"api_key\": os.getenv(\"DEEPSEEK_API_KEY\"),\n    },\n}\n\ndef llm_chat(model: str, messages: Union[str, List[Dict[str, str]]], tools: Optional[List] = None, stream=True):\n    logger.info(f'\u4f7f\u7528\u7684\u6a21\u578b\u5982\u4e0b\uff1a{model}')\n    model_config = model_config_dict.get(model)\n    if isinstance(messages, str):\n        messages = [{\"role\": \"user\", \"content\": messages}]\n\n    response = litellm.completion(\n        model=model_config.get('model'),\n        base_url=model_config.get('base_url'),\n        api_key=model_config.get('api_key'),\n        messages=messages,\n        tools=tools,\n        stream=stream,\n    )\n\n    return response\n\nmessages=[{\"role\": \"user\", \"content\": \"\u4e0a\u6d77\u73b0\u5728\u7684\u5929\u6c14\u600e\u4e48\u6837\uff1f\u82f9\u679c\u80a1\u4ef7\u662f\u591a\u5c11\uff1f\"}]\n\nresponse = llm_chat(\n    model='deepseek-chat', \n    messages=messages, \n    tools=tools,\n    stream=False\n)\n\nresponse\n</code></pre> <pre><code>ModelResponse(id='5de8bff5-fa6b-414e-9948-62f43d4abb07', created=1749126781, model='deepseek-chat', object='chat.completion', system_fingerprint='fp_8802369eaa_prod0425fp8', choices=[Choices(finish_reason='tool_calls', index=0, message=Message(content='', role='assistant', tool_calls=[ChatCompletionMessageToolCall(index=0, function=Function(arguments='{\"location\": \"\u4e0a\u6d77\", \"unit\": \"celsius\"}', name='get_weather'), id='call_0_afd2cb42-f93d-45f6-9a40-32020366337b', type='function'), ChatCompletionMessageToolCall(index=1, function=Function(arguments='{\"symbol\": \"AAPL\"}', name='get_stock_price'), id='call_1_f800d8fb-3084-425f-bb5f-fc62a45bc047', type='function')], function_call=None, provider_specific_fields={'refusal': None}))], usage=Usage(completion_tokens=48, prompt_tokens=323, total_tokens=371, completion_tokens_details=None, prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=None, cached_tokens=320, text_tokens=None, image_tokens=None), prompt_cache_hit_tokens=320, prompt_cache_miss_tokens=3), service_tier=None)\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#3","title":"3. \u89e3\u6790\u5e76\u6267\u884c\u5de5\u5177\u8c03\u7528","text":"<p>\u5728\u51fd\u6570\u8c03\u7528\u7684\u6d41\u7a0b\u4e2d\uff0c\u6b63\u786e\u7684\u6d88\u606f\u987a\u5e8f\u5e94\u8be5\u662f\uff1a</p> <ol> <li> <p>\u7528\u6237\u6d88\u606f\uff08user\uff09\u6216\u7cfb\u7edf\u6d88\u606f\uff08system\uff09</p> </li> <li> <p>\u6a21\u578b\u7684\u6d88\u606f\uff0c\u5176\u4e2d\u5305\u542b\u4e86 <code>tool_calls</code>\uff08\u8868\u793a\u6a21\u578b\u51b3\u5b9a\u8c03\u7528\u5de5\u5177\uff09</p> </li> <li> <p>\u5de5\u5177\u6d88\u606f\uff08tool\uff09\uff0c\u4f5c\u4e3a\u5bf9 <code>tool_calls</code> \u7684\u54cd\u5e94</p> </li> </ol> <pre><code>import json\n\navailable_functions = {\n                \"get_weather\": get_weather,\n                \"get_stock_price\": get_stock_price,\n            }\n\ndef execute_tool_call(response, messages):\n    \"\"\"\u5904\u7406\u5de5\u5177\u8c03\u7528\u5e76\u8fd4\u56de\u66f4\u65b0\u540e\u7684\u6d88\u606f\u5217\u8868\"\"\"\n    if not hasattr(response.choices[0].message, 'tool_calls') or not response.choices[0].message.tool_calls:\n        return messages, None\n    tool_calls = response.choices[0].message.tool_calls\n    updated_messages = messages.copy()\n\n    # \u6dfb\u52a0\u6a21\u578b\u7684\u6d88\u606f\uff08\u5305\u542btool_calls\uff09\n    # updated_messages.append({\n    #     \"role\": \"assistant\",\n    #     \"content\": None,\n    #     \"tool_calls\": [\n    #         {\n    #             \"id\": call.id,\n    #             \"type\": \"function\",\n    #             \"function\": {\n    #                 \"name\": call.function.name,\n    #                 \"arguments\": call.function.arguments\n    #             }\n    #         } for call in tool_calls\n    #     ]\n    # })\n    # \u6dfb\u52a0\u6a21\u578b\u7684\u6d88\u606f\uff0c\u4e0e\u524d\u9762\u6784\u9020\u7684\u6a21\u578b\u6d88\u606f\u76f8\u4f3c\n    updated_messages.append(response.choices[0].message)\n\n    # \u6267\u884c\u5de5\u5177\u5e76\u6dfb\u52a0\u7ed3\u679c\n    for tool_call in tool_calls:\n\n        function_name = tool_call.function.name\n        args = json.loads(tool_call.function.arguments)\n\n        # \u6267\u884c\u5bf9\u5e94\u51fd\u6570\n        function_to_call = available_functions[function_name]\n        function_response = function_to_call(args)\n\n\n        updated_messages.append({\n            \"role\": \"tool\",\n            \"name\": function_name,\n            \"content\": json.dumps(function_response, ensure_ascii=False),\n            \"tool_call_id\": tool_call.id\n        })\n\n    return updated_messages, tool_calls\n\nupdated_messages, tool_calls = execute_tool_call(response=response, messages=messages)\nupdated_messages, tool_calls\n</code></pre> <pre><code>([{'role': 'user', 'content': '\u4e0a\u6d77\u73b0\u5728\u7684\u5929\u6c14\u600e\u4e48\u6837\uff1f\u82f9\u679c\u80a1\u4ef7\u662f\u591a\u5c11\uff1f'},\n  Message(content='', role='assistant', tool_calls=[ChatCompletionMessageToolCall(index=0, function=Function(arguments='{\"location\": \"\u4e0a\u6d77\", \"unit\": \"celsius\"}', name='get_weather'), id='call_0_afd2cb42-f93d-45f6-9a40-32020366337b', type='function'), ChatCompletionMessageToolCall(index=1, function=Function(arguments='{\"symbol\": \"AAPL\"}', name='get_stock_price'), id='call_1_f800d8fb-3084-425f-bb5f-fc62a45bc047', type='function')], function_call=None, provider_specific_fields={'refusal': None}),\n  {'role': 'tool',\n   'name': 'get_weather',\n   'content': '{\"location\": \"\u4e0a\u6d77\", \"temperature\": \"10\", \"unit\": \"celsius\"}',\n   'tool_call_id': 'call_0_afd2cb42-f93d-45f6-9a40-32020366337b'},\n  {'role': 'tool',\n   'name': 'get_stock_price',\n   'content': '{\"symbol\": \"AAPL\", \"name\": \"\u82f9\u679c\", \"price\": \"202.82\", \"unit\": \"USD\"}',\n   'tool_call_id': 'call_1_f800d8fb-3084-425f-bb5f-fc62a45bc047'}],\n [ChatCompletionMessageToolCall(index=0, function=Function(arguments='{\"location\": \"\u4e0a\u6d77\", \"unit\": \"celsius\"}', name='get_weather'), id='call_0_afd2cb42-f93d-45f6-9a40-32020366337b', type='function'),\n  ChatCompletionMessageToolCall(index=1, function=Function(arguments='{\"symbol\": \"AAPL\"}', name='get_stock_price'), id='call_1_f800d8fb-3084-425f-bb5f-fc62a45bc047', type='function')])\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#4","title":"4. \u83b7\u53d6\u6700\u7ec8\u54cd\u5e94","text":"<p>\u5c06\u51fd\u6570\u6267\u884c\u7ed3\u679c\u4f20\u56de\u6a21\u578b\uff08\u53ef\u9009\uff0c\u7528\u4e8e\u591a\u8f6e\u5bf9\u8bdd\uff09</p> <pre><code>final_response = llm_chat(\n    model='deepseek-chat', \n    messages=updated_messages, \n    stream=False\n)\n\nprint(\"\u6700\u7ec8\u56de\u7b54:\", final_response.choices[0].message.content)\n</code></pre> <pre><code>/Users/xiniao/myenv/lib/python3.12/site-packages/pydantic/main.py:463: UserWarning: Pydantic serializer warnings:\n  PydanticSerializationUnexpectedValue(Expected `ChatCompletionMessageToolCall` - serialized value may not be as expected [input_value={'index': 0, 'function': ...7b', 'type': 'function'}, input_type=dict])\n  PydanticSerializationUnexpectedValue(Expected `ChatCompletionMessageToolCall` - serialized value may not be as expected [input_value={'index': 1, 'function': ...47', 'type': 'function'}, input_type=dict])\n  return self.__pydantic_serializer__.to_python(\n\n\n\u6700\u7ec8\u56de\u7b54: \u4e0a\u6d77\u73b0\u5728\u7684\u5929\u6c14\u662f10\u00b0C\u3002\u82f9\u679c(AAPL)\u7684\u80a1\u4ef7\u76ee\u524d\u662f202.82\u7f8e\u5143\u3002\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#litellm_4","title":"LiteLLM \u667a\u80fd\u8def\u7531\u529f\u80fd\u8be6\u89e3","text":"<p>LiteLLM \u7684\u52a8\u6001\u8def\u7531\u662f\u5176\u6700\u5f3a\u5927\u7684\u529f\u80fd\u4e4b\u4e00\uff0c\u5b83\u5141\u8bb8\u5f00\u53d1\u8005\u6784\u5efa\u667a\u80fd\u7684\u6a21\u578b\u8c03\u7528\u7f51\u5173\uff0c\u6839\u636e\u6210\u672c\u3001\u6027\u80fd\u3001\u53ef\u7528\u6027\u7b49\u6307\u6807\u81ea\u52a8\u9009\u62e9\u6700\u4f18\u6a21\u578b\u3002</p> <p>\u5728 LiteLLM \u4e2d\u63d0\u4f9b\u4e86<code>Router</code>\u7c7b\uff0c<code>Router</code>\u7c7b\u7684\u4f5c\u7528\u8986\u76d6\u4e86\u6a21\u578b\u7ba1\u7406\u3001\u7f13\u5b58\u3001\u8c03\u5ea6\u3001\u53ef\u9760\u6027\u3001\u56de\u9000\u7b56\u7565\u3001\u8def\u7531\u7b56\u7565\u3001\u6545\u969c\u5904\u7406\u3001\u9884\u7b97\u63a7\u5236\u7b49\u591a\u4e2a\u65b9\u9762\uff0c\u63d0\u4f9b\u4e86\u9ad8\u5ea6\u53ef\u914d\u7f6e\u7684\u8def\u7531\u673a\u5236\u3002\u901a\u8fc7\u5408\u7406\u914d\u7f6e\u8fd9\u4e9b\u53c2\u6570\uff0c\u53ef\u4ee5\u6784\u5efa\u51fa\u9002\u5e94\u4e0d\u540c\u573a\u666f\u9700\u6c42\u7684\u667a\u80fd\u6a21\u578b\u8def\u7531\u7cfb\u7edf\u3002</p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#litellm-router","title":"LiteLLM Router \u53c2\u6570\u8be6\u89e3","text":"<p>\u67e5\u770b <code>Router</code>\u7c7b\u7684\u6e90\u7801\u53c2\u6570\u5982\u4e0b\uff1a <pre><code>def __init__(  # noqa: PLR0915\n        self,\n        model_list: Optional[\n            Union[List[DeploymentTypedDict], List[Dict[str, Any]]]\n        ] = None,\n        ## ASSISTANTS API ##\n        assistants_config: Optional[AssistantsTypedDict] = None,\n        ## CACHING ##\n        redis_url: Optional[str] = None,\n        redis_host: Optional[str] = None,\n        redis_port: Optional[int] = None,\n        redis_password: Optional[str] = None,\n        cache_responses: Optional[bool] = False,\n        cache_kwargs: dict = {},  # additional kwargs to pass to RedisCache (see caching.py)\n        caching_groups: Optional[\n            List[tuple]\n        ] = None,  # if you want to cache across model groups\n        client_ttl: int = 3600,  # ttl for cached clients - will re-initialize after this time in seconds\n        ## SCHEDULER ##\n        polling_interval: Optional[float] = None,\n        default_priority: Optional[int] = None,\n        ## RELIABILITY ##\n        num_retries: Optional[int] = None,\n        max_fallbacks: Optional[\n            int\n        ] = None,  # max fallbacks to try before exiting the call. Defaults to 5.\n        timeout: Optional[float] = None,\n        stream_timeout: Optional[float] = None,\n        default_litellm_params: Optional[\n            dict\n        ] = None,  # default params for Router.chat.completion.create\n        default_max_parallel_requests: Optional[int] = None,\n        set_verbose: bool = False,\n        debug_level: Literal[\"DEBUG\", \"INFO\"] = \"INFO\",\n        default_fallbacks: Optional[\n            List[str]\n        ] = None,  # generic fallbacks, works across all deployments\n        fallbacks: List = [],\n        context_window_fallbacks: List = [],\n        content_policy_fallbacks: List = [],\n        model_group_alias: Optional[\n            Dict[str, Union[str, RouterModelGroupAliasItem]]\n        ] = {},\n        enable_pre_call_checks: bool = False,\n        enable_tag_filtering: bool = False,\n        retry_after: int = 0,  # min time to wait before retrying a failed request\n        retry_policy: Optional[\n            Union[RetryPolicy, dict]\n        ] = None,  # set custom retries for different exceptions\n        model_group_retry_policy: Dict[\n            str, RetryPolicy\n        ] = {},  # set custom retry policies based on model group\n        allowed_fails: Optional[\n            int\n        ] = None,  # Number of times a deployment can failbefore being added to cooldown\n        allowed_fails_policy: Optional[\n            AllowedFailsPolicy\n        ] = None,  # set custom allowed fails policy\n        cooldown_time: Optional[\n            float\n        ] = None,  # (seconds) time to cooldown a deployment after failure\n        disable_cooldowns: Optional[bool] = None,\n        routing_strategy: Literal[\n            \"simple-shuffle\",\n            \"least-busy\",\n            \"usage-based-routing\",\n            \"latency-based-routing\",\n            \"cost-based-routing\",\n            \"usage-based-routing-v2\",\n        ] = \"simple-shuffle\",\n        optional_pre_call_checks: Optional[OptionalPreCallChecks] = None,\n        routing_strategy_args: dict = {},  # just for latency-based\n        provider_budget_config: Optional[GenericBudgetConfigType] = None,\n        alerting_config: Optional[AlertingConfig] = None,\n        router_general_settings: Optional[\n            RouterGeneralSettings\n        ] = RouterGeneralSettings(),\n        ignore_invalid_deployments: bool = False,\n    ) -&gt; None:\n</code></pre></p> <p>\u4e3a\u4e86\u66f4\u597d\u7684\u4f7f\u7528<code>Router</code>\u7c7b\uff0c\u4e0b\u9762\u662f\u5bf9 <code>Router</code> \u7c7b\u521d\u59cb\u5316\u53c2\u6570\u7684\u8be6\u7ec6\u89e3\u91ca\uff0c\u6309\u529f\u80fd\u5206\u7c7b\u8bf4\u660e\uff1a</p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_29","title":"\u4e00\u3001\u6838\u5fc3\u6a21\u578b\u914d\u7f6e","text":"<ol> <li><code>model_list</code></li> <li>\u4f5c\u7528\uff1a\u5b9a\u4e49\u8def\u7531\u7ba1\u7406\u7684\u6a21\u578b\u5217\u8868\uff0c\u6bcf\u4e2a\u6a21\u578b\u662f\u4e00\u4e2a\u5b57\u5178\uff0c\u5305\u542b\u6a21\u578b\u522b\u540d\u548c\u5177\u4f53\u7684\u8c03\u7528\u53c2\u6570\u3002</li> <li>\u683c\u5f0f\uff1a\u5b57\u5178\u5217\u8868\uff0c\u6bcf\u4e2a\u5b57\u5178\u5305\u542b\u6a21\u578b\u914d\u7f6e</li> <li> <p>\u793a\u4f8b\uff1a   <pre><code>[\n    {\n        \"model_name\": \"azure-gpt-4\",  # \u6a21\u578b\u522b\u540d\n        \"litellm_params\": {\u3002# \u5177\u4f53\u7684\u8c03\u7528\u53c2\u6570\n            \"model\": \"azure/gpt-4-turbo\",  # \u5b9e\u9645\u6a21\u578b\u540d\n            \"api_key\": \"...\",\n            \"api_base\": \"...\"\n        },\n        \"model_info\": {\"id\": \"gpt-4-turbo\"}  # \u989d\u5916\u6a21\u578b\u4fe1\u606f\n    },\n    # \u66f4\u591a\u6a21\u578b...\n]\n</code></pre></p> </li> <li> <p><code>assistants_config</code></p> </li> <li>\u4f5c\u7528\uff1a\u914d\u7f6e OpenAI Assistants API \u76f8\u5173\u53c2\u6570</li> <li>\u7c7b\u578b\uff1a\u5b57\u5178</li> <li>\u7528\u9014\uff1a\u6784\u5efa\u57fa\u4e8e\u52a9\u624b\u7684\u5de5\u4f5c\u6d41</li> </ol>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_30","title":"\u4e8c\u3001\u7f13\u5b58\u914d\u7f6e","text":"\u53c2\u6570 \u4f5c\u7528 \u9ed8\u8ba4\u503c <code>redis_url</code> Redis\u670d\u52a1\u5668\u7684URL\uff0c\u7528\u4e8e\u7f13\u5b58\u54cd\u5e94\u3002\u5982\u679c\u63d0\u4f9b\uff0c\u5c06\u8986\u76d6<code>redis_host</code>\u548c<code>redis_port</code> <code>None</code> <code>redis_host</code> Redis \u4e3b\u673a\u5730\u5740 <code>None</code> <code>redis_port</code> Redis \u7aef\u53e3 <code>None</code> <code>redis_password</code> Redis \u5bc6\u7801 <code>None</code> <code>cache_responses</code> \u662f\u5426\u7f13\u5b58\u54cd\u5e94 <code>False</code> <code>cache_kwargs</code> \u4f20\u9012\u7ed9\u7f13\u5b58\u7cfb\u7edf\u7684\u989d\u5916\u53c2\u6570 <code>{}</code> <code>caching_groups</code> \u8de8\u6a21\u578b\u7ec4\u7684\u7f13\u5b58\u914d\u7f6e <code>None</code> <code>client_ttl</code> \u5ba2\u6237\u7aef\u7f13\u5b58\u751f\u5b58\u65f6\u95f4\uff08\u79d2\uff09 <code>3600</code> (1\u5c0f\u65f6)"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_31","title":"\u4e09\u3001\u8c03\u5ea6\u4e0e\u961f\u5217","text":"\u53c2\u6570 \u4f5c\u7528 \u5907\u6ce8 <code>polling_interval</code> \u8f6e\u8be2\u961f\u5217\u7684\u9891\u7387\uff08\u79d2\uff09 \u7528\u4e8e <code>.scheduler_acompletion()</code> <code>default_priority</code> \u8bf7\u6c42\u7684\u9ed8\u8ba4\u4f18\u5148\u7ea7,\u4f18\u5148\u7ea7\u9ad8\u7684\u8bf7\u6c42\u4f1a\u88ab\u4f18\u5148\u5904\u7406 <code>None</code>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_32","title":"\u56db\u3001\u53ef\u9760\u6027\u914d\u7f6e","text":"\u53c2\u6570 \u4f5c\u7528 \u9ed8\u8ba4\u503c <code>num_retries</code> \u5931\u8d25\u8bf7\u6c42\u7684\u91cd\u8bd5\u6b21\u6570 <code>None</code> <code>max_fallbacks</code> \u6700\u5927\u56de\u9000\u5c1d\u8bd5\u6b21\u6570 <code>5</code> <code>timeout</code> \u8bf7\u6c42\u8d85\u65f6\u65f6\u95f4\uff08\u79d2\uff09 <code>None</code> <code>stream_timeout</code> \u6d41\u5f0f\u8bf7\u6c42\u8d85\u65f6\u65f6\u95f4\uff08\u79d2\uff09 <code>None</code> <code>retry_after</code> \u91cd\u8bd5\u524d\u6700\u5c0f\u7b49\u5f85\u65f6\u95f4\uff08\u79d2\uff09 <code>0</code> <code>retry_policy</code> \u4f7f\u7528<code>RetryPolicy</code>\u81ea\u5b9a\u4e49\u91cd\u8bd5\u7b56\u7565 <code>None</code> <code>model_group_retry_policy</code> \u6309\u6a21\u578b\u7ec4\u7684\u91cd\u8bd5\u7b56\u7565 <code>{}</code>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_33","title":"\u4e94\u3001\u56de\u9000\u7b56\u7565","text":"\u53c2\u6570 \u4f5c\u7528 \u793a\u4f8b <code>default_fallbacks</code> \u901a\u7528\u56de\u9000\u5217\u8868\uff0c\u9002\u7528\u4e8e\u6240\u6709\u90e8\u7f72\u3002\u5f53\u4e3b\u6a21\u578b\u5931\u8d25\u65f6\uff0c\u4f1a\u5c1d\u8bd5\u56de\u9000\u5230\u5217\u8868\u4e2d\u7684\u6a21\u578b\u3002 <code>[\"gpt-3.5-turbo\"]</code> <code>fallbacks</code> \u7279\u5b9a\u6a21\u578b\u7684\u56de\u9000\u94fe <code>[{\"gpt-4\": \"claude-3\"}]</code> <code>context_window_fallbacks</code> \u4e0a\u4e0b\u6587\u7a97\u53e3\u4e0d\u8db3\u65f6\u7684\u56de\u9000 <code>[{\"llama3\": \"claude-3\"}]</code> <code>content_policy_fallbacks</code> \u5185\u5bb9\u7b56\u7565\u8fdd\u89c4\u65f6\u7684\u56de\u9000 <code>[{\"gpt-4\": \"gemini\"}]</code>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_34","title":"\u516d\u3001\u8def\u7531\u7b56\u7565","text":"<ol> <li><code>routing_strategy</code></li> <li>\u4f5c\u7528\uff1a\u9009\u62e9\u8def\u7531\u7b97\u6cd5</li> <li> <p>\u53ef\u9009\u503c\uff1a</p> <ul> <li><code>\"simple-shuffle\"</code>\uff1a\u7b80\u5355\u968f\u673a\u9009\u62e9\uff08\u9ed8\u8ba4\uff09</li> <li><code>\"least-busy\"</code>\uff1a\u9009\u62e9\u5f53\u524d\u8bf7\u6c42\u6700\u5c11\u7684\u6a21\u578b</li> <li><code>\"usage-based-routing\"</code>\uff1a\u57fa\u4e8e\u4f7f\u7528\u91cf\uff08\u5982Token\u6d88\u8017\uff09\u7684\u8def\u7531</li> <li><code>\"latency-based-routing\"</code>\uff1a\u57fa\u4e8e\u5ef6\u8fdf\u7684\u8def\u7531</li> <li><code>\"cost-based-routing\"</code>\uff1a\u57fa\u4e8e\u6210\u672c\u7684\u8def\u7531</li> <li><code>\"usage-based-routing-v2\"</code>\uff1a\u6539\u8fdb\u7248\u7684\u4f7f\u7528\u91cf\u8def\u7531</li> </ul> </li> <li> <p>\u9ed8\u8ba4\u503c\uff1a<code>\"simple-shuffle\"</code></p> </li> <li> <p><code>routing_strategy_args</code></p> </li> <li>\u4f5c\u7528\uff1a\u8def\u7531\u7b56\u7565\u7684\u989d\u5916\u53c2\u6570</li> <li>\u7c7b\u578b\uff1a\u5b57\u5178</li> <li>\u7528\u9014\uff1a\u4f20\u9012\u7b56\u7565\u7279\u5b9a\u53c2\u6570\uff0c\u5982\u6210\u672c\u6743\u91cd</li> </ol>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_35","title":"\u4e03\u3001\u6a21\u578b\u5065\u5eb7\u4e0e\u6545\u969c\u5904\u7406","text":"\u53c2\u6570 \u4f5c\u7528 \u9ed8\u8ba4\u503c <code>allowed_fails</code> \u6545\u969c\u9608\u503c\uff08\u89e6\u53d1\u51b7\u5374\u7684\u5931\u8d25\u6b21\u6570\uff09 <code>None</code> <code>allowed_fails_policy</code> \u4f7f\u7528<code>AllowedFailsPolicy</code>\u81ea\u5b9a\u4e49\u6545\u969c\u7b56\u7565 <code>None</code> <code>cooldown_time</code> \u6a21\u578b\u51b7\u5374\u65f6\u95f4\uff08\u79d2\uff09 <code>1</code> <code>disable_cooldowns</code> \u662f\u5426\u7981\u7528\u51b7\u5374\u673a\u5236 <code>None</code>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_36","title":"\u516b\u3001\u9884\u68c0\u67e5\u4e0e\u8fc7\u6ee4","text":"\u53c2\u6570 \u4f5c\u7528 \u9ed8\u8ba4\u503c <code>enable_pre_call_checks</code> \u662f\u5426\u5728\u8c03\u7528\u524d\u68c0\u67e5\u90e8\u7f72\u7684\u4e0a\u4e0b\u6587\u7a97\u53e3\u9650\u5236\u3002\u5982\u679c\u63d0\u793a\u8d85\u51fa\u9650\u5236\uff0c\u5219\u8fc7\u6ee4\u6389\u8be5\u90e8\u7f72 <code>False</code> <code>enable_tag_filtering</code> \u542f\u7528\u6807\u7b7e\u8fc7\u6ee4 <code>False</code> <code>optional_pre_call_checks</code> \u53ef\u9009\u7684\u9884\u8c03\u7528\u68c0\u67e5\u914d\u7f6e <code>None</code>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_37","title":"\u4e5d\u3001\u6a21\u578b\u522b\u540d\u4e0e\u5206\u7ec4","text":"\u53c2\u6570 \u4f5c\u7528 \u793a\u4f8b <code>model_group_alias</code> \u6a21\u578b\u7ec4\u522b\u540d\u914d\u7f6e <code>{\"fast-group\": [\"gpt-4\", \"claude-3\"]}</code>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_38","title":"\u5341\u3001\u9884\u7b97\u4e0e\u544a\u8b66","text":"\u53c2\u6570 \u4f5c\u7528 \u7c7b\u578b <code>provider_budget_config</code> \u8bbe\u7f6eLLM\u63d0\u4f9b\u5546\u7684\u9884\u7b97\u9650\u5236\u3002\u4f8b\u5982\uff0c\u6bcf\u5929\u4e3aOpenAI\u8bbe\u7f6e100\u7f8e\u5143\u9884\u7b97\u3002 \u5b57\u5178 <code>alerting_config</code> \u544a\u8b66\u914d\u7f6e\uff08\u5982Slack\u96c6\u6210\uff09\u5f53\u53d1\u751f\u7279\u5b9a\u4e8b\u4ef6\uff08\u5982\u90e8\u7f72\u5931\u8d25\uff09\u65f6\u53d1\u9001\u544a\u8b66 <code>AlertingConfig</code>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_39","title":"\u5341\u4e00\u3001\u8c03\u8bd5\u4e0e\u65e5\u5fd7","text":"\u53c2\u6570 \u4f5c\u7528 \u9ed8\u8ba4\u503c <code>set_verbose</code> \u542f\u7528\u8be6\u7ec6\u65e5\u5fd7 <code>False</code> <code>debug_level</code> \u65e5\u5fd7\u7ea7\u522b\uff08\"DEBUG\"/\"INFO\"\uff09 <code>\"INFO\"</code> <code>ignore_invalid_deployments</code> \u662f\u5426\u5ffd\u7565\u65e0\u6548\u7684\u90e8\u7f72\u3002\u5982\u679c\u4e3aTrue\uff0c\u5219\u521d\u59cb\u5316\u65f6\u9047\u5230\u65e0\u6548\u90e8\u7f72\u4e0d\u4f1a\u5f15\u53d1\u9519\u8bef\uff0c\u800c\u662f\u8df3\u8fc7\u5e76\u7ee7\u7eed\u3002\u9ed8\u8ba4\u4e3aFalse\u3002 <code>False</code>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_40","title":"\u5341\u4e8c\u3001\u9ad8\u7ea7\u914d\u7f6e","text":"\u53c2\u6570 \u4f5c\u7528 \u8bf4\u660e <code>default_litellm_params</code> \u9ed8\u8ba4\u8c03\u7528\u53c2\u6570 \u5168\u5c40\u53c2\u6570\u8986\u76d6 <code>default_max_parallel_requests</code> \u9ed8\u8ba4\u6700\u5927\u5e76\u884c\u8bf7\u6c42\u6570 \u63a7\u5236\u5e76\u53d1 <code>router_general_settings</code> \u8def\u7531\u5668\u901a\u7528\u8bbe\u7f6e <code>RouterGeneralSettings</code> \u5bf9\u8c61"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_41","title":"\u53c2\u6570\u529f\u80fd\u5173\u7cfb\u56fe","text":"<pre><code>graph TD\n    A[\u6a21\u578b\u5217\u8868 model_list] --&gt; B[\u8def\u7531\u7b56\u7565 routing_strategy]\n    B --&gt; C{\u8def\u7531\u51b3\u7b56}\n    C --&gt; D[\u7f13\u5b58\u914d\u7f6e redis_url\u7b49]\n    C --&gt; E[\u56de\u9000\u7b56\u7565 fallbacks]\n    C --&gt; F[\u6545\u969c\u5904\u7406 allowed_fails]\n    D --&gt; G[\u54cd\u5e94\u8fd4\u56de]\n    E --&gt; G\n    F --&gt; G\n    H[\u76d1\u63a7\u544a\u8b66 alerting_config] --&gt; F\n    I[\u9884\u68c0\u67e5 enable_pre_call_checks] --&gt; C</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_42","title":"\u5178\u578b\u914d\u7f6e\u793a\u4f8b","text":"<pre><code>from litellm import Router\n\nrouter = Router(\n    model_list=[\n        {\n            \"model_name\": \"gpt-4-turbo\",\n            \"litellm_params\": {\n                \"model\": \"azure/gpt-4-turbo\",\n                \"api_key\": \"azure-key\",\n                \"api_base\": \"https://azure-endpoint\"\n            },\n            \"model_info\": {\"cost\": 0.00003}\n        },\n        {\n            \"model_name\": \"claude-3-haiku\",\n            \"litellm_params\": {\n                \"model\": \"anthropic/claude-3-haiku\",\n                \"api_key\": \"anthropic-key\"\n            },\n            \"model_info\": {\"cost\": 0.00001}\n        }\n    ],\n    routing_strategy=\"cost-based-routing\",\n    redis_url=\"redis://localhost:6379\",\n    cache_responses=True,\n    num_retries=3,\n    timeout=30,\n    fallbacks=[{\"gpt-4-turbo\": \"claude-3-haiku\"}],\n    allowed_fails=3,\n    cooldown_time=60,\n    set_verbose=True\n)\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_43","title":"\u5173\u952e\u529f\u80fd\u8bf4\u660e","text":"<ol> <li> <p>\u8def\u7531\u7b56\u7565\u9009\u62e9\u6307\u5357\uff1a    <pre><code> graph TD\n     A[\u9009\u62e9\u8def\u7531\u7b56\u7565] --&gt; B{\u5173\u952e\u9700\u6c42}\n     B --&gt;|\u6210\u672c\u4f18\u5316| C[cost-based-routing]\n     B --&gt;|\u6700\u4f4e\u5ef6\u8fdf| D[latency-based-routing]\n     B --&gt;|\u9ad8\u5e76\u53d1| E[least-busy]\n     B --&gt;|\u9884\u7b97\u63a7\u5236| F[usage-based-routing]\n     B --&gt;|\u9ad8\u53ef\u7528| G[model-fallback]\n     B --&gt;|\u7b80\u5355\u5747\u8861| H[simple-shuffle]\n     B --&gt;|\u81ea\u5b9a\u4e49\u903b\u8f91| I[custom-function]</code></pre></p> </li> <li> <p>\u6545\u969c\u5904\u7406\u6d41\u7a0b\uff1a</p> </li> <li>\u6a21\u578b\u5931\u8d25\u6b21\u6570\u8d85\u8fc7 <code>allowed_fails</code> \u9608\u503c</li> <li>\u8fdb\u5165 <code>cooldown_time</code> \u79d2\u7684\u51b7\u5374\u671f</li> <li>\u8def\u7531\u81ea\u52a8\u5207\u6362\u5230\u56de\u9000\u6a21\u578b</li> <li> <p>\u51b7\u5374\u7ed3\u675f\u540e\u91cd\u65b0\u5c1d\u8bd5</p> </li> <li> <p>\u7f13\u5b58\u673a\u5236\uff1a</p> </li> <li>\u4f7f\u7528 Redis \u5b58\u50a8\u54cd\u5e94</li> <li><code>client_ttl</code> \u63a7\u5236\u7f13\u5b58\u6709\u6548\u671f</li> <li> <p>\u76f8\u540c\u8bf7\u6c42\u76f4\u63a5\u8fd4\u56de\u7f13\u5b58\u7ed3\u679c</p> </li> <li> <p>\u9884\u7b97\u63a7\u5236\uff1a</p> </li> <li>\u901a\u8fc7 <code>provider_budget_config</code> \u8bbe\u7f6e\u9884\u7b97</li> <li>\u8d85\u8fc7\u9884\u7b97\u81ea\u52a8\u5207\u6362\u5230\u5176\u4ed6\u63d0\u4f9b\u5546</li> <li>\u652f\u6301\u6309\u5929/\u5468/\u6708\u8bbe\u7f6e\u9650\u989d</li> </ol>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_44","title":"\u6838\u5fc3\u4ef7\u503c","text":"<ol> <li>\u667a\u80fd\u8d1f\u8f7d\u5747\u8861\uff1a\u5728\u591a\u4e2a\u6a21\u578b/\u4f9b\u5e94\u5546\u95f4\u5206\u914d\u8bf7\u6c42</li> <li>\u6210\u672c\u4f18\u5316\uff1a\u81ea\u52a8\u9009\u62e9\u6027\u4ef7\u6bd4\u6700\u9ad8\u7684\u6a21\u578b</li> <li>\u9ad8\u53ef\u7528\u6027\uff1a\u6545\u969c\u65f6\u81ea\u52a8\u5207\u6362\u5230\u5907\u7528\u6a21\u578b</li> <li>\u6d41\u91cf\u63a7\u5236\uff1a\u6309\u914d\u989d\u5206\u914d\u8c03\u7528\u91cf</li> <li>A/B\u6d4b\u8bd5\uff1a\u65e0\u7f1d\u5bf9\u6bd4\u6a21\u578b\u6027\u80fd</li> </ol>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_45","title":"\u8def\u7531\u7b56\u7565\u5b9e\u6218\u914d\u7f6e","text":""},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_46","title":"\u968f\u673a\u8def\u7531\u914d\u7f6e","text":"<pre><code>from litellm import Router\n\n# \u5b9a\u4e49\u6a21\u578b\u6c60\nmodel_list = [\n    {\n        \"model_name\": \"my-llm-test\",  # \u6a21\u578b\u522b\u540d-&gt;\u5177\u6709\u76f8\u540c'model_name'\u7684\u6a21\u578b\u4e4b\u95f4\u7684\u8d1f\u8f7d\u5e73\u8861\n        \"litellm_params\": {  # litellm completion/embedding \u5b9e\u9645\u8c03\u7528\u53c2\u6570\n            \"model\": \"openai/deepseek-chat\",\n            \"api_base\": \"https://api.deepseek.com/v1\",\n            \"api_key\": os.getenv(\"DEEPSEEK_API_KEY\"),\n        },\n    },\n    {\n        \"model_name\": \"my-llm-test\",\n        \"litellm_params\": {\n            \"model\": \"openai/qwen-turbo\",\n            \"api_base\": \"https://dashscope.aliyuncs.com/compatible-mode/v1\",\n            \"api_key\": os.getenv(\"BAILIAN_API_KEY\"),\n        },\n    },\n]\n\n# \u521b\u5efa\u8def\u7531\nrouter = Router(\n    model_list=model_list,\n    routing_strategy=\"simple-shuffle\",  # \u9ed8\u8ba4\u8def\u7531\u7b56\u7565 simple-shuffle\uff0c\u968f\u673a\u9009\u62e9\u6a21\u578b\n    set_verbose=True\n)\n\nmessages=[{\"role\": \"user\", \"content\": \"\u4f60\u662f\u8c01\"}]\n\n# \u4f7f\u7528\u8def\u7531\nresponse = router.completion(\n    model=\"my-llm-test\",  # \u4f7f\u7528\u6a21\u578b\u522b\u540d\u8c03\u7528\n    messages=messages\n)\n\nprint(response)\n\n# \u4f7f\u7528\u8def\u7531\nresponse = router.completion(\n    model=\"my-llm-test\",  # \u4f7f\u7528\u6a21\u578b\u522b\u540d\u8c03\u7528\n    messages=messages\n)\n\nprint(response)\n</code></pre> <pre><code>11:15:13 - LiteLLM Router:INFO: router.py:660 - Routing strategy: simple-shuffle\n11:15:14 - LiteLLM Router:INFO: router.py:893 - litellm.completion(model=openai/qwen-turbo)[32m 200 OK\n\n\nModelResponse(id='chatcmpl-6c983ebb-54f1-9b7b-8385-347de1515a04', created=1749179715, model='qwen-turbo', object='chat.completion', system_fingerprint=None, choices=[Choices(finish_reason='stop', index=0, message=Message(content='\u6211\u662f\u901a\u4e49\u5343\u95ee\uff0c\u963f\u91cc\u5df4\u5df4\u96c6\u56e2\u65d7\u4e0b\u7684\u901a\u4e49\u5b9e\u9a8c\u5ba4\u81ea\u4e3b\u7814\u53d1\u7684\u8d85\u5927\u89c4\u6a21\u8bed\u8a00\u6a21\u578b\u3002\u6211\u80fd\u591f\u5e2e\u52a9\u4f60\u56de\u7b54\u95ee\u9898\u3001\u521b\u4f5c\u6587\u5b57\uff0c\u5982\u5199\u6545\u4e8b\u3001\u516c\u6587\u3001\u6280\u672f\u6587\u6863\u7b49\uff0c\u8fd8\u80fd\u8fdb\u884c\u903b\u8f91\u63a8\u7406\u3001\u7f16\u7a0b\uff0c\u8868\u8fbe\u89c2\u70b9\uff0c\u73a9\u6e38\u620f\u7b49\u3002\u5982\u679c\u4f60\u6709\u4efb\u4f55\u95ee\u9898\u6216\u9700\u8981\u5e2e\u52a9\uff0c\u6b22\u8fce\u968f\u65f6\u544a\u8bc9\u6211\uff01', role='assistant', tool_calls=None, function_call=None, provider_specific_fields={'refusal': None}))], usage=Usage(completion_tokens=64, prompt_tokens=10, total_tokens=74, completion_tokens_details=None, prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=None, cached_tokens=0, text_tokens=None, image_tokens=None)), service_tier=None)\n\n\n11:15:21 - LiteLLM Router:INFO: router.py:893 - litellm.completion(model=openai/deepseek-chat)[32m 200 OK\n\n\nModelResponse(id='36c23345-aa7f-4ed8-a525-19d7eb869a3e', created=1749179715, model='deepseek-chat', object='chat.completion', system_fingerprint='fp_8802369eaa_prod0425fp8', choices=[Choices(finish_reason='stop', index=0, message=Message(content='\u6211\u662fDeepSeek Chat\uff0c\u7531\u6df1\u5ea6\u6c42\u7d22\u516c\u53f8\uff08DeepSeek\uff09\u521b\u9020\u7684\u667a\u80fdAI\u52a9\u624b\uff01\u2728 \u6211\u7684\u4f7f\u547d\u662f\u5e2e\u52a9\u4f60\u89e3\u7b54\u95ee\u9898\u3001\u63d0\u4f9b\u4fe1\u606f\u3001\u966a\u4f60\u804a\u5929\uff0c\u8fd8\u80fd\u5e2e\u4f60\u5904\u7406\u5404\u79cd\u6587\u672c\u3001\u6587\u6863\u7b49\u5185\u5bb9\u3002\u65e0\u8bba\u662f\u5b66\u4e60\u3001\u5de5\u4f5c\uff0c\u8fd8\u662f\u65e5\u5e38\u751f\u6d3b\u4e2d\u7684\u5c0f\u7591\u95ee\uff0c\u90fd\u53ef\u4ee5\u6765\u627e\u6211\u54e6\uff01\ud83d\ude0a  \\n\\n\u6709\u4ec0\u4e48\u6211\u53ef\u4ee5\u5e2e\u4f60\u7684\u5417\uff1f', role='assistant', tool_calls=None, function_call=None, provider_specific_fields={'refusal': None}))], usage=Usage(completion_tokens=70, prompt_tokens=4, total_tokens=74, completion_tokens_details=None, prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=None, cached_tokens=0, text_tokens=None, image_tokens=None), prompt_cache_hit_tokens=0, prompt_cache_miss_tokens=4), service_tier=None)\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_47","title":"\u57fa\u4e8e\u6743\u91cd\u7684\u968f\u673a\u8def\u7531","text":"<p>\u5bf9\u6a21\u578b\u8bbe\u7f6e\u6743\u91cd<code>litellm_params[\"weight\"]</code>\u4ee5\u6bd4\u5176\u4ed6\u6a21\u578b\u66f4\u9891\u7e41\u5730\u9009\u62e9\u4e00\u79cd\u8def\u7531\uff0c\u8fd9\u9002\u7528\u4e8e<code>simple-shuffle</code>\u8def\u7531\u7b56\u7565\uff08\u5982\u679c\u672a\u9009\u62e9\u8def\u7531\u7b56\u7565\uff0c\u8fd9\u662f\u9ed8\u8ba4\u503c\uff09\u3002</p> <pre><code>from litellm import Router\n\n# \u5b9a\u4e49\u6a21\u578b\u6c60\nmodel_list = [\n    {\n        \"model_name\": \"my-llm-test\",  # \u6a21\u578b\u522b\u540d-&gt;\u5177\u6709\u76f8\u540c'model_name'\u7684\u6a21\u578b\u4e4b\u95f4\u7684\u8d1f\u8f7d\u5e73\u8861\n        \"litellm_params\": {  # litellm completion/embedding \u5b9e\u9645\u8c03\u7528\u53c2\u6570\n            \"model\": \"openai/deepseek-chat\",\n            \"api_base\": \"https://api.deepseek.com/v1\",\n            \"api_key\": os.getenv(\"DEEPSEEK_API_KEY\"),\n            \"weight\": 1,\n        },\n    },\n    {\n        \"model_name\": \"my-llm-test\",\n        \"litellm_params\": {\n            \"model\": \"openai/qwen-turbo\",\n            \"api_base\": \"https://dashscope.aliyuncs.com/compatible-mode/v1\",\n            \"api_key\": os.getenv(\"BAILIAN_API_KEY\"),\n            \"weight\": 2,  # \u9009\u62e9\u6b64\u6a21\u578b\u6bd4\u524d\u4e00\u4e2a\u66f4\u9891\u7e412\u500d\n        },\n    },\n]\n\n# \u521b\u5efa\u8def\u7531\nrouter = Router(\n    model_list=model_list,\n    routing_strategy=\"simple-shuffle\",  # \u9ed8\u8ba4\u8def\u7531\u7b56\u7565 simple-shuffle\uff0c\u968f\u673a\u9009\u62e9\u6a21\u578b\n    set_verbose=True\n)\n\nmessages=[{\"role\": \"user\", \"content\": \"\u4f60\u662f\u8c01\"}]\n\n# \u4f7f\u7528\u8def\u7531\nresponse = router.completion(\n    model=\"my-llm-test\",  # \u4f7f\u7528\u6a21\u578b\u522b\u540d\u8c03\u7528\n    messages=messages\n)\n\nprint(response)\n\n# \u4f7f\u7528\u8def\u7531\nresponse = router.completion(\n    model=\"my-llm-test\",  # \u4f7f\u7528\u6a21\u578b\u522b\u540d\u8c03\u7528\n    messages=messages\n)\n\nprint(response)\n\n# \u4f7f\u7528\u8def\u7531\nresponse = router.completion(\n    model=\"my-llm-test\",  # \u4f7f\u7528\u6a21\u578b\u522b\u540d\u8c03\u7528\n    messages=messages\n)\n\nprint(response)\n</code></pre> <pre><code>11:35:29 - LiteLLM Router:INFO: router.py:660 - Routing strategy: simple-shuffle\n11:35:29 - LiteLLM Router:INFO: simple_shuffle.py:55 - get_available_deployment for model: my-llm-test, Selected deployment: {'model_name': 'my-llm-test', 'litellm_params': {'api_key': 'sk**********', 'api_base': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'use_in_pass_through': False, 'use_litellm_proxy': False, 'merge_reasoning_content_in_choices': False, 'model': 'openai/qwen-turbo', 'weight': 2}, 'model_info': {'id': '7c6b876813711f84e643255a92267a1ecd18a012c6df37bbfa010ca6572a54eb', 'db_model': False, 'cost': 1e-05}} for model: my-llm-test\n11:35:30 - LiteLLM Router:INFO: router.py:893 - litellm.completion(model=openai/qwen-turbo)[32m 200 OK\n11:35:30 - LiteLLM Router:INFO: simple_shuffle.py:55 - get_available_deployment for model: my-llm-test, Selected deployment: {'model_name': 'my-llm-test', 'litellm_params': {'api_key': 'sk**********', 'api_base': 'https://api.deepseek.com/v1', 'use_in_pass_through': False, 'use_litellm_proxy': False, 'merge_reasoning_content_in_choices': False, 'model': 'openai/deepseek-chat', 'weight': 1}, 'model_info': {'id': '7cc6bbf33429d66def887cba459d00b997960200174b741ccee0d683662febb6', 'db_model': False, 'cost': 3e-05}} for model: my-llm-test\n\n\nModelResponse(id='chatcmpl-595a9128-72f4-9406-b6ea-cafd8b9741dc', created=1749180931, model='qwen-turbo', object='chat.completion', system_fingerprint=None, choices=[Choices(finish_reason='stop', index=0, message=Message(content='\u6211\u662f\u901a\u4e49\u5343\u95ee\uff0c\u963f\u91cc\u5df4\u5df4\u96c6\u56e2\u65d7\u4e0b\u7684\u8d85\u5927\u89c4\u6a21\u8bed\u8a00\u6a21\u578b\u3002\u6211\u80fd\u591f\u5e2e\u52a9\u4f60\u56de\u7b54\u95ee\u9898\u3001\u521b\u4f5c\u6587\u5b57\uff0c\u5982\u5199\u6545\u4e8b\u3001\u516c\u6587\u3001\u6280\u672f\u6587\u6863\u7b49\uff0c\u8fd8\u80fd\u8868\u8fbe\u89c2\u70b9\u3001\u73a9\u6e38\u620f\u7b49\u3002\u5982\u679c\u4f60\u6709\u4efb\u4f55\u95ee\u9898\u6216\u9700\u8981\u5e2e\u52a9\uff0c\u5c3d\u7ba1\u544a\u8bc9\u6211\uff01', role='assistant', tool_calls=None, function_call=None, provider_specific_fields={'refusal': None}))], usage=Usage(completion_tokens=52, prompt_tokens=10, total_tokens=62, completion_tokens_details=None, prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=None, cached_tokens=0, text_tokens=None, image_tokens=None)), service_tier=None)\n\n\n11:35:37 - LiteLLM Router:INFO: router.py:893 - litellm.completion(model=openai/deepseek-chat)[32m 200 OK\n11:35:37 - LiteLLM Router:INFO: simple_shuffle.py:55 - get_available_deployment for model: my-llm-test, Selected deployment: {'model_name': 'my-llm-test', 'litellm_params': {'api_key': 'sk**********', 'api_base': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'use_in_pass_through': False, 'use_litellm_proxy': False, 'merge_reasoning_content_in_choices': False, 'model': 'openai/qwen-turbo', 'weight': 2}, 'model_info': {'id': '7c6b876813711f84e643255a92267a1ecd18a012c6df37bbfa010ca6572a54eb', 'db_model': False, 'cost': 1e-05}} for model: my-llm-test\n\n\nModelResponse(id='47f1ccde-679d-4b97-ba8d-3c2ffc797c57', created=1749180931, model='deepseek-chat', object='chat.completion', system_fingerprint='fp_8802369eaa_prod0425fp8', choices=[Choices(finish_reason='stop', index=0, message=Message(content='\u6211\u662fDeepSeek Chat\uff0c\u7531\u6df1\u5ea6\u6c42\u7d22\u516c\u53f8\u6253\u9020\u7684\u667a\u80fdAI\u52a9\u624b\uff01\u2728 \u6211\u7684\u4f7f\u547d\u662f\u5e2e\u52a9\u4f60\u89e3\u7b54\u95ee\u9898\u3001\u63d0\u4f9b\u5efa\u8bae\u3001\u966a\u4f60\u804a\u5929\uff0c\u8fd8\u80fd\u5904\u7406\u5404\u79cd\u6587\u672c\u3001\u6587\u6863\u4fe1\u606f\u3002\u65e0\u8bba\u662f\u5b66\u4e60\u3001\u5de5\u4f5c\uff0c\u8fd8\u662f\u65e5\u5e38\u751f\u6d3b\u4e2d\u7684\u5c0f\u56f0\u60d1\uff0c\u90fd\u53ef\u4ee5\u6765\u627e\u6211\u804a\u804a\uff01\ud83d\ude0a  \\n\\n\u6709\u4ec0\u4e48\u6211\u53ef\u4ee5\u5e2e\u4f60\u7684\u5417\uff1f', role='assistant', tool_calls=None, function_call=None, provider_specific_fields={'refusal': None}))], usage=Usage(completion_tokens=64, prompt_tokens=4, total_tokens=68, completion_tokens_details=None, prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=None, cached_tokens=0, text_tokens=None, image_tokens=None), prompt_cache_hit_tokens=0, prompt_cache_miss_tokens=4), service_tier=None)\n\n\n11:35:38 - LiteLLM Router:INFO: router.py:893 - litellm.completion(model=openai/qwen-turbo)[32m 200 OK\n\n\nModelResponse(id='chatcmpl-31cded70-dda4-98ff-bf1c-acd593954f76', created=1749180939, model='qwen-turbo', object='chat.completion', system_fingerprint=None, choices=[Choices(finish_reason='stop', index=0, message=Message(content='\u6211\u662f\u901a\u4e49\u5343\u95ee\uff0c\u963f\u91cc\u5df4\u5df4\u96c6\u56e2\u65d7\u4e0b\u7684\u901a\u4e49\u5b9e\u9a8c\u5ba4\u81ea\u4e3b\u7814\u53d1\u7684\u8d85\u5927\u89c4\u6a21\u8bed\u8a00\u6a21\u578b\u3002\u6211\u80fd\u591f\u5e2e\u52a9\u60a8\u56de\u7b54\u95ee\u9898\u3001\u521b\u4f5c\u6587\u5b57\uff0c\u5982\u5199\u6545\u4e8b\u3001\u516c\u6587\u3001\u6280\u672f\u6587\u6863\uff0c\u8fd8\u80fd\u8fdb\u884c\u903b\u8f91\u63a8\u7406\u3001\u7f16\u7a0b\u7b49\u4efb\u52a1\uff0c\u5e76\u652f\u6301\u591a\u79cd\u8bed\u8a00\u3002\u5982\u679c\u60a8\u6709\u4efb\u4f55\u95ee\u9898\u6216\u9700\u8981\u5e2e\u52a9\uff0c\u6b22\u8fce\u968f\u65f6\u544a\u8bc9\u6211\uff01', role='assistant', tool_calls=None, function_call=None, provider_specific_fields={'refusal': None}))], usage=Usage(completion_tokens=63, prompt_tokens=10, total_tokens=73, completion_tokens_details=None, prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=None, cached_tokens=0, text_tokens=None, image_tokens=None)), service_tier=None)\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_48","title":"\u57fa\u4e8e\u6700\u4f4e\u5ef6\u8fdf\u8def\u7531\u914d\u7f6e","text":"<p>\u9009\u62e9\u54cd\u5e94\u65f6\u95f4\u6700\u77ed\u7684\u6a21\u578b\uff0c\u5b83\u6839\u636e\u4ece\u6a21\u578b\u53d1\u9001\u548c\u63a5\u6536\u8bf7\u6c42\u7684\u65f6\u95f4\u7f13\u5b58\u5e76\u66f4\u65b0\u6a21\u578b\u7684\u54cd\u5e94\u65f6\u95f4\u3002</p> <pre><code>from litellm import Router\n\n# \u5b9a\u4e49\u6a21\u578b\u6c60\nmodel_list = [\n    {\n        \"model_name\": \"my-llm-test\",  # \u6a21\u578b\u522b\u540d-&gt;\u5177\u6709\u76f8\u540c'model_name'\u7684\u6a21\u578b\u4e4b\u95f4\u7684\u8d1f\u8f7d\u5e73\u8861\n        \"litellm_params\": {  # litellm completion/embedding \u5b9e\u9645\u8c03\u7528\u53c2\u6570\n            \"model\": \"openai/deepseek-chat\",\n            \"api_base\": \"https://api.deepseek.com/v1\",\n            \"api_key\": os.getenv(\"DEEPSEEK_API_KEY\"),\n        },\n        \"model_info\": {\"id\":\"deepseek-chat\"} \n    },\n    {\n        \"model_name\": \"my-llm-test\",\n        \"litellm_params\": {\n            \"model\": \"openai/qwen-turbo\",\n            \"api_base\": \"https://dashscope.aliyuncs.com/compatible-mode/v1\",\n            \"api_key\": os.getenv(\"BAILIAN_API_KEY\"),\n        },\n        \"model_info\": {\"id\":\"qwen-turbo\"}\n    },\n]\n\n# \u521b\u5efa\u8def\u7531\nrouter = Router(\n    model_list=model_list,\n    routing_strategy=\"latency-based-routing\",  # \u9009\u62e9\u57fa\u4e8e\u6700\u4f4e\u5ef6\u8fdf\u8def\u7531\u914d\u7f6e\n    set_verbose=True\n)\n\nmessages=[{\"role\": \"user\", \"content\": \"\u4f60\u662f\u8c01\"}]\ntasks = []\n# \u5faa\u73af\u8c03\u7528\uff0c\u7f13\u5b58\u5e76\u66f4\u65b0\u6a21\u578b\u7684\u54cd\u5e94\u65f6\u95f4\uff0c\u5728\u540e\u7eed\u7684\u8c03\u7528\u4e2d\u9009\u62e9\u54cd\u5e94\u65f6\u95f4\u6700\u77ed\u7684\u6a21\u578b\nfor _ in range(5):\n    tasks.append(router.acompletion(model=\"my-llm-test\", messages=messages))\nresponse = await asyncio.gather(*tasks)\nprint(response)\n\n\n# \u4f7f\u7528\u8def\u7531\nresponse = router.completion(\n    model=\"my-llm-test\",  # \u4f7f\u7528\u6a21\u578b\u522b\u540d\u8c03\u7528\n    messages=messages\n)\n\nprint(response)\n</code></pre> <pre><code>12:00:54 - LiteLLM Router:INFO: router.py:660 - Routing strategy: latency-based-routing\n12:00:54 - LiteLLM Router:INFO: router.py:6292 - get_available_deployment for model: my-llm-test, Selected deployment: {'model_name': 'my-llm-test', 'litellm_params': {'api_key': 'sk**********', 'api_base': 'https://api.deepseek.com/v1', 'use_in_pass_through': False, 'use_litellm_proxy': False, 'merge_reasoning_content_in_choices': False, 'model': 'openai/deepseek-chat'}, 'model_info': {'id': 'deepseek-chat', 'db_model': False, 'cost': 3e-05}} for model: my-llm-test\n12:00:54 - LiteLLM Router:INFO: router.py:6292 - get_available_deployment for model: my-llm-test, Selected deployment: {'model_name': 'my-llm-test', 'litellm_params': {'api_key': 'sk**********', 'api_base': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'use_in_pass_through': False, 'use_litellm_proxy': False, 'merge_reasoning_content_in_choices': False, 'model': 'openai/qwen-turbo'}, 'model_info': {'id': 'qwen-turbo', 'db_model': False, 'cost': 1e-05}} for model: my-llm-test\n12:00:54 - LiteLLM Router:INFO: router.py:6292 - get_available_deployment for model: my-llm-test, Selected deployment: {'model_name': 'my-llm-test', 'litellm_params': {'api_key': 'sk**********', 'api_base': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'use_in_pass_through': False, 'use_litellm_proxy': False, 'merge_reasoning_content_in_choices': False, 'model': 'openai/qwen-turbo'}, 'model_info': {'id': 'qwen-turbo', 'db_model': False, 'cost': 1e-05}} for model: my-llm-test\n12:00:54 - LiteLLM Router:INFO: router.py:6292 - get_available_deployment for model: my-llm-test, Selected deployment: {'model_name': 'my-llm-test', 'litellm_params': {'api_key': 'sk**********', 'api_base': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'use_in_pass_through': False, 'use_litellm_proxy': False, 'merge_reasoning_content_in_choices': False, 'model': 'openai/qwen-turbo'}, 'model_info': {'id': 'qwen-turbo', 'db_model': False, 'cost': 1e-05}} for model: my-llm-test\n12:00:54 - LiteLLM Router:INFO: router.py:6292 - get_available_deployment for model: my-llm-test, Selected deployment: {'model_name': 'my-llm-test', 'litellm_params': {'api_key': 'sk**********', 'api_base': 'https://api.deepseek.com/v1', 'use_in_pass_through': False, 'use_litellm_proxy': False, 'merge_reasoning_content_in_choices': False, 'model': 'openai/deepseek-chat'}, 'model_info': {'id': 'deepseek-chat', 'db_model': False, 'cost': 3e-05}} for model: my-llm-test\n12:00:56 - LiteLLM Router:INFO: router.py:1103 - litellm.acompletion(model=openai/qwen-turbo)[32m 200 OK\n12:00:56 - LiteLLM Router:INFO: router.py:1103 - litellm.acompletion(model=openai/qwen-turbo)[32m 200 OK\n12:00:56 - LiteLLM Router:INFO: router.py:1103 - litellm.acompletion(model=openai/qwen-turbo)[32m 200 OK\n12:01:00 - LiteLLM Router:INFO: router.py:1103 - litellm.acompletion(model=openai/deepseek-chat)[32m 200 OK\n12:01:01 - LiteLLM Router:INFO: router.py:1103 - litellm.acompletion(model=openai/deepseek-chat)[32m 200 OK\n12:01:01 - LiteLLM Router:INFO: router.py:6448 - get_available_deployment for model: my-llm-test, Selected deployment: {'model_name': 'my-llm-test', 'litellm_params': {'api_key': 'sk**********', 'api_base': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'use_in_pass_through': False, 'use_litellm_proxy': False, 'merge_reasoning_content_in_choices': False, 'model': 'openai/qwen-turbo'}, 'model_info': {'id': 'qwen-turbo', 'db_model': False, 'cost': 1e-05}} for model: my-llm-test\n\n\n[ModelResponse(id='c62a00d2-410c-4e8e-ad93-c2692c01231e', created=1749182454, model='deepseek-chat', object='chat.completion', system_fingerprint='fp_8802369eaa_prod0425fp8', choices=[Choices(finish_reason='stop', index=0, message=Message(content='\u6211\u662fDeepSeek Chat\uff0c\u7531\u6df1\u5ea6\u6c42\u7d22\u516c\u53f8\uff08DeepSeek\uff09\u7814\u53d1\u7684\u667a\u80fdAI\u52a9\u624b\uff01\ud83e\udd16\u2728 \u6211\u53ef\u4ee5\u5e2e\u4f60\u89e3\u7b54\u5404\u79cd\u95ee\u9898\uff0c\u6bd4\u5982\u5b66\u4e60\u3001\u5de5\u4f5c\u3001\u79d1\u6280\u3001\u751f\u6d3b\u5c0f\u7a8d\u95e8\uff0c\u751a\u81f3\u966a\u4f60\u804a\u5929\u89e3\u95f7\u3002\u6709\u4ec0\u4e48\u60f3\u95ee\u7684\uff0c\u5c3d\u7ba1\u6765\u5427\uff01\ud83d\ude0a', role='assistant', tool_calls=None, function_call=None, provider_specific_fields={'refusal': None}))], usage=Usage(completion_tokens=59, prompt_tokens=4, total_tokens=63, completion_tokens_details=None, prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=None, cached_tokens=0, text_tokens=None, image_tokens=None), prompt_cache_hit_tokens=0, prompt_cache_miss_tokens=4), service_tier=None), ModelResponse(id='chatcmpl-3b50779a-a89d-9edf-b94d-ac02558db233', created=1749182456, model='qwen-turbo', object='chat.completion', system_fingerprint=None, choices=[Choices(finish_reason='stop', index=0, message=Message(content='\u6211\u662f\u901a\u4e49\u5343\u95ee\uff0c\u963f\u91cc\u5df4\u5df4\u96c6\u56e2\u65d7\u4e0b\u7684\u901a\u4e49\u5b9e\u9a8c\u5ba4\u81ea\u4e3b\u7814\u53d1\u7684\u8d85\u5927\u89c4\u6a21\u8bed\u8a00\u6a21\u578b\u3002\u6211\u80fd\u591f\u5e2e\u52a9\u4f60\u56de\u7b54\u95ee\u9898\u3001\u521b\u4f5c\u6587\u5b57\uff0c\u5982\u5199\u6545\u4e8b\u3001\u516c\u6587\u3001\u6280\u672f\u6587\u6863\u7b49\uff0c\u8fd8\u80fd\u8fdb\u884c\u903b\u8f91\u63a8\u7406\u3001\u7f16\u7a0b\uff0c\u8868\u8fbe\u89c2\u70b9\uff0c\u73a9\u6e38\u620f\u7b49\u3002\u5982\u679c\u4f60\u6709\u4efb\u4f55\u95ee\u9898\u6216\u9700\u8981\u5e2e\u52a9\uff0c\u6b22\u8fce\u968f\u65f6\u544a\u8bc9\u6211\uff01', role='assistant', tool_calls=None, function_call=None, provider_specific_fields={'refusal': None}))], usage=Usage(completion_tokens=64, prompt_tokens=10, total_tokens=74, completion_tokens_details=None, prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=None, cached_tokens=0, text_tokens=None, image_tokens=None)), service_tier=None), ModelResponse(id='chatcmpl-0a80858c-b588-9efc-a633-de9042621458', created=1749182457, model='qwen-turbo', object='chat.completion', system_fingerprint=None, choices=[Choices(finish_reason='stop', index=0, message=Message(content='\u6211\u662f\u901a\u4e49\u5343\u95ee\uff0c\u963f\u91cc\u5df4\u5df4\u96c6\u56e2\u65d7\u4e0b\u7684\u8d85\u5927\u89c4\u6a21\u8bed\u8a00\u6a21\u578b\u3002\u6211\u80fd\u591f\u5e2e\u52a9\u60a8\u56de\u7b54\u95ee\u9898\u3001\u521b\u4f5c\u6587\u5b57\uff0c\u5982\u5199\u6545\u4e8b\u3001\u516c\u6587\u3001\u6280\u672f\u6587\u6863\u7b49\uff0c\u8fd8\u80fd\u8fdb\u884c\u903b\u8f91\u63a8\u7406\u3001\u8868\u8fbe\u89c2\u70b9\uff0c\u73a9\u6e38\u620f\u7b49\u3002\u5982\u679c\u60a8\u6709\u4efb\u4f55\u95ee\u9898\u6216\u9700\u8981\u5e2e\u52a9\uff0c\u6b22\u8fce\u968f\u65f6\u544a\u8bc9\u6211\uff01', role='assistant', tool_calls=None, function_call=None, provider_specific_fields={'refusal': None}))], usage=Usage(completion_tokens=57, prompt_tokens=10, total_tokens=67, completion_tokens_details=None, prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=None, cached_tokens=0, text_tokens=None, image_tokens=None)), service_tier=None), ModelResponse(id='chatcmpl-6996d035-f7f3-90f2-baa0-5b05bf83fb41', created=1749182457, model='qwen-turbo', object='chat.completion', system_fingerprint=None, choices=[Choices(finish_reason='stop', index=0, message=Message(content='\u6211\u662f\u901a\u4e49\u5343\u95ee\uff0c\u963f\u91cc\u5df4\u5df4\u96c6\u56e2\u65d7\u4e0b\u7684\u8d85\u5927\u89c4\u6a21\u8bed\u8a00\u6a21\u578b\u3002\u6211\u80fd\u591f\u5e2e\u52a9\u4f60\u56de\u7b54\u95ee\u9898\u3001\u521b\u4f5c\u6587\u5b57\uff0c\u5982\u5199\u6545\u4e8b\u3001\u516c\u6587\u3001\u6280\u672f\u6587\u6863\u7b49\uff0c\u8fd8\u80fd\u8fdb\u884c\u903b\u8f91\u63a8\u7406\u3001\u8868\u8fbe\u89c2\u70b9\uff0c\u73a9\u6e38\u620f\u7b49\u3002\u5982\u679c\u4f60\u6709\u4efb\u4f55\u95ee\u9898\u6216\u9700\u8981\u5e2e\u52a9\uff0c\u5c3d\u7ba1\u544a\u8bc9\u6211\uff01', role='assistant', tool_calls=None, function_call=None, provider_specific_fields={'refusal': None}))], usage=Usage(completion_tokens=56, prompt_tokens=10, total_tokens=66, completion_tokens_details=None, prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=None, cached_tokens=0, text_tokens=None, image_tokens=None)), service_tier=None), ModelResponse(id='9d3fe083-a7d4-437c-a83d-4a5936570846', created=1749182454, model='deepseek-chat', object='chat.completion', system_fingerprint='fp_8802369eaa_prod0425fp8', choices=[Choices(finish_reason='stop', index=0, message=Message(content='\u6211\u662fDeepSeek Chat\uff0c\u7531\u6df1\u5ea6\u6c42\u7d22\u516c\u53f8\uff08DeepSeek\uff09\u7814\u53d1\u7684\u667a\u80fdAI\u52a9\u624b\uff01\ud83e\udd16\u2728  \\n\\n\u6211\u53ef\u4ee5\u5e2e\u4f60\u89e3\u7b54\u5404\u79cd\u95ee\u9898\uff0c\u65e0\u8bba\u662f\u5b66\u4e60\u3001\u5de5\u4f5c\u3001\u7f16\u7a0b\uff0c\u8fd8\u662f\u65e5\u5e38\u751f\u6d3b\u4e2d\u7684\u5c0f\u56f0\u60d1\uff0c\u90fd\u53ef\u4ee5\u6765\u95ee\u6211\uff01\u5982\u679c\u4f60\u6709\u4ec0\u4e48\u9700\u8981\uff0c\u5c3d\u7ba1\u5f00\u53e3\u5427~ \ud83d\ude0a', role='assistant', tool_calls=None, function_call=None, provider_specific_fields={'refusal': None}))], usage=Usage(completion_tokens=59, prompt_tokens=4, total_tokens=63, completion_tokens_details=None, prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=None, cached_tokens=0, text_tokens=None, image_tokens=None), prompt_cache_hit_tokens=0, prompt_cache_miss_tokens=4), service_tier=None)]\n\n\n12:01:02 - LiteLLM Router:INFO: router.py:893 - litellm.completion(model=openai/qwen-turbo)[32m 200 OK\n\n\nModelResponse(id='chatcmpl-1f8f351f-2858-9e7c-9de1-33249ac4b589', created=1749182463, model='qwen-turbo', object='chat.completion', system_fingerprint=None, choices=[Choices(finish_reason='stop', index=0, message=Message(content='\u6211\u662f\u901a\u4e49\u5343\u95ee\uff0c\u963f\u91cc\u5df4\u5df4\u96c6\u56e2\u65d7\u4e0b\u7684\u8d85\u5927\u89c4\u6a21\u8bed\u8a00\u6a21\u578b\u3002\u6211\u80fd\u591f\u5e2e\u52a9\u60a8\u56de\u7b54\u95ee\u9898\u3001\u521b\u4f5c\u6587\u5b57\uff0c\u5982\u5199\u6545\u4e8b\u3001\u516c\u6587\u3001\u6280\u672f\u6587\u6863\u7b49\uff0c\u8fd8\u80fd\u8868\u8fbe\u89c2\u70b9\u3001\u73a9\u6e38\u620f\u7b49\u3002\u5982\u679c\u4f60\u6709\u4efb\u4f55\u95ee\u9898\u6216\u9700\u8981\u5e2e\u52a9\uff0c\u6b22\u8fce\u968f\u65f6\u544a\u8bc9\u6211\uff01', role='assistant', tool_calls=None, function_call=None, provider_specific_fields={'refusal': None}))], usage=Usage(completion_tokens=53, prompt_tokens=10, total_tokens=63, completion_tokens_details=None, prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=None, cached_tokens=0, text_tokens=None, image_tokens=None)), service_tier=None)\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_49","title":"\u57fa\u4e8e\u6700\u5c11\u8bf7\u6c42\u8def\u7531\u914d\u7f6e","text":"<p>\u9009\u62e9\u5f53\u524d\u8bf7\u6c42\u6700\u5c11\u7684\u6a21\u578b</p> <pre><code>from litellm import Router\n\n# \u5b9a\u4e49\u6a21\u578b\u6c60\nmodel_list = [\n    {\n        \"model_name\": \"my-llm-test\",  # \u6a21\u578b\u522b\u540d-&gt;\u5177\u6709\u76f8\u540c'model_name'\u7684\u6a21\u578b\u4e4b\u95f4\u7684\u8d1f\u8f7d\u5e73\u8861\n        \"litellm_params\": {  # litellm completion/embedding \u5b9e\u9645\u8c03\u7528\u53c2\u6570\n            \"model\": \"openai/deepseek-chat\",\n            \"api_base\": \"https://api.deepseek.com/v1\",\n            \"api_key\": os.getenv(\"DEEPSEEK_API_KEY\"),\n        },\n        \"model_info\": {\"id\":\"deepseek-chat\"}\n    },\n    {\n        \"model_name\": \"my-llm-test\",\n        \"litellm_params\": {\n            \"model\": \"openai/qwen-turbo\",\n            \"api_base\": \"https://dashscope.aliyuncs.com/compatible-mode/v1\",\n            \"api_key\": os.getenv(\"BAILIAN_API_KEY\"),\n        },\n        \"model_info\": {\"id\":\"qwen-turbo\"}\n    },\n]\n\n# \u521b\u5efa\u8def\u7531\nrouter = Router(\n    model_list=model_list,\n    routing_strategy=\"least-busy\",  # \u9009\u62e9\u57fa\u4e8e\u6700\u5c11\u8bf7\u6c42\u8def\u7531\u914d\u7f6e\n    set_verbose=True\n)\n\nmessages=[{\"role\": \"user\", \"content\": \"\u4f60\u662f\u8c01\"}]\ntasks = []\n# \u5faa\u73af\u8c03\u7528\nfor _ in range(2):\n    tasks.append(router.acompletion(model=\"my-llm-test\", messages=messages))\nresponse = await asyncio.gather(*tasks)\nprint(response)\n\n\n# \u4f7f\u7528\u8def\u7531\nresponse = router.completion(\n    model=\"my-llm-test\",  # \u4f7f\u7528\u6a21\u578b\u522b\u540d\u8c03\u7528\n    messages=messages\n)\n\nprint(response)\n</code></pre> <pre><code>13:35:20 - LiteLLM Router:INFO: router.py:660 - Routing strategy: least-busy\n13:35:20 - LiteLLM Router:INFO: router.py:6292 - get_available_deployment for model: my-llm-test, Selected deployment: {'model_name': 'my-llm-test', 'litellm_params': {'api_key': 'sk**********', 'api_base': 'https://api.deepseek.com/v1', 'use_in_pass_through': False, 'use_litellm_proxy': False, 'merge_reasoning_content_in_choices': False, 'model': 'openai/deepseek-chat'}, 'model_info': {'id': 'deepseek-chat', 'db_model': False, 'cost': 3e-05}} for model: my-llm-test\n13:35:20 - LiteLLM Router:INFO: router.py:6292 - get_available_deployment for model: my-llm-test, Selected deployment: {'model_name': 'my-llm-test', 'litellm_params': {'api_key': 'sk**********', 'api_base': 'https://api.deepseek.com/v1', 'use_in_pass_through': False, 'use_litellm_proxy': False, 'merge_reasoning_content_in_choices': False, 'model': 'openai/deepseek-chat'}, 'model_info': {'id': 'deepseek-chat', 'db_model': False, 'cost': 3e-05}} for model: my-llm-test\n13:35:26 - LiteLLM Router:INFO: router.py:1103 - litellm.acompletion(model=openai/deepseek-chat)[32m 200 OK\n13:35:31 - LiteLLM Router:INFO: router.py:1103 - litellm.acompletion(model=openai/deepseek-chat)[32m 200 OK\n13:35:31 - LiteLLM Router:INFO: router.py:6448 - get_available_deployment for model: my-llm-test, Selected deployment: {'model_name': 'my-llm-test', 'litellm_params': {'api_key': 'sk**********', 'api_base': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'use_in_pass_through': False, 'use_litellm_proxy': False, 'merge_reasoning_content_in_choices': False, 'model': 'openai/qwen-turbo'}, 'model_info': {'id': 'qwen-turbo', 'db_model': False, 'cost': 1e-05}} for model: my-llm-test\n\n\n[ModelResponse(id='0249d7e2-ceef-426d-9d43-62d43008be46', created=1749188120, model='deepseek-chat', object='chat.completion', system_fingerprint='fp_8802369eaa_prod0425fp8', choices=[Choices(finish_reason='stop', index=0, message=Message(content='\u6211\u662fDeepSeek Chat\uff0c\u7531\u6df1\u5ea6\u6c42\u7d22\u516c\u53f8\uff08DeepSeek\uff09\u521b\u9020\u7684\u667a\u80fd\u5bf9\u8bdd\u52a9\u624b\uff01\ud83d\ude0a \u6211\u7684\u4f7f\u547d\u662f\u5e2e\u52a9\u4f60\u89e3\u7b54\u5404\u79cd\u95ee\u9898\uff0c\u65e0\u8bba\u662f\u5b66\u4e60\u3001\u5de5\u4f5c\uff0c\u8fd8\u662f\u751f\u6d3b\u4e2d\u7684\u5c0f\u56f0\u60d1\uff0c\u6211\u90fd\u4f1a\u5c3d\u529b\u63d0\u4f9b\u6709\u7528\u7684\u4fe1\u606f\u548c\u5efa\u8bae\u3002  \\n\\n\u4f60\u53ef\u4ee5\u95ee\u6211\u4efb\u4f55\u95ee\u9898\uff0c\u6bd4\u5982\uff1a  \\n- **\u77e5\u8bc6\u79d1\u666e**\uff1a\u9ed1\u6d1e\u662f\u600e\u4e48\u5f62\u6210\u7684\uff1f  \\n- **\u5b66\u4e60\u8f85\u5bfc**\uff1a\u5982\u4f55\u63d0\u9ad8\u82f1\u8bed\u5199\u4f5c\u80fd\u529b\uff1f  \\n- **\u5b9e\u7528\u5efa\u8bae**\uff1a\u6709\u4ec0\u4e48\u65f6\u95f4\u7ba1\u7406\u7684\u597d\u65b9\u6cd5\uff1f  \\n- **\u5a31\u4e50\u4f11\u95f2**\uff1a\u63a8\u8350\u51e0\u672c\u597d\u770b\u7684\u5c0f\u8bf4\u5427\uff01  \\n\\n\u6211\u76ee\u524d\u662f**\u514d\u8d39**\u7684\uff0c\u800c\u4e14\u652f\u6301**\u957f\u6587\u672c\u5bf9\u8bdd\uff08128K\u4e0a\u4e0b\u6587\uff09**\uff0c\u8fd8\u80fd\u8bfb\u53d6\u4f60\u4e0a\u4f20\u7684**\u56fe\u7247\u3001PDF\u3001Word\u3001Excel\u7b49\u6587\u4ef6**\uff0c\u5e76\u4ece\u4e2d\u63d0\u53d6\u6587\u5b57\u4fe1\u606f\u6765\u5e2e\u52a9\u4f60\u5206\u6790\u5185\u5bb9\u3002  \\n\\n\u6709\u4ec0\u4e48\u6211\u53ef\u4ee5\u5e2e\u4f60\u7684\u5417\uff1f\ud83d\ude03', role='assistant', tool_calls=None, function_call=None, provider_specific_fields={'refusal': None}))], usage=Usage(completion_tokens=166, prompt_tokens=4, total_tokens=170, completion_tokens_details=None, prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=None, cached_tokens=0, text_tokens=None, image_tokens=None), prompt_cache_hit_tokens=0, prompt_cache_miss_tokens=4), service_tier=None), ModelResponse(id='65ea6058-2214-42a1-9a51-d3178cd83539', created=1749188120, model='deepseek-chat', object='chat.completion', system_fingerprint='fp_8802369eaa_prod0425fp8', choices=[Choices(finish_reason='stop', index=0, message=Message(content='\u6211\u662fDeepSeek Chat\uff0c\u7531\u6df1\u5ea6\u6c42\u7d22\u516c\u53f8\u521b\u9020\u7684\u667a\u80fdAI\u52a9\u624b\uff01\ud83e\udd16\u2728 \u6211\u53ef\u4ee5\u5e2e\u4f60\u89e3\u7b54\u5404\u79cd\u95ee\u9898\u3001\u63d0\u4f9b\u77e5\u8bc6\u652f\u6301\u3001\u966a\u4f60\u804a\u5929\uff0c\u751a\u81f3\u5e2e\u4f60\u5904\u7406\u6587\u6863\u548c\u6587\u4ef6\u3002\u6709\u4ec0\u4e48\u6211\u53ef\u4ee5\u5e2e\u4f60\u7684\u5417\uff1f\ud83d\ude0a', role='assistant', tool_calls=None, function_call=None, provider_specific_fields={'refusal': None}))], usage=Usage(completion_tokens=48, prompt_tokens=4, total_tokens=52, completion_tokens_details=None, prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=None, cached_tokens=0, text_tokens=None, image_tokens=None), prompt_cache_hit_tokens=0, prompt_cache_miss_tokens=4), service_tier=None)]\n\n\n13:35:32 - LiteLLM Router:INFO: router.py:893 - litellm.completion(model=openai/qwen-turbo)[32m 200 OK\n\n\nModelResponse(id='chatcmpl-ca30bd33-b748-9ff2-9cf9-dcc254c88712', created=1749188132, model='qwen-turbo', object='chat.completion', system_fingerprint=None, choices=[Choices(finish_reason='stop', index=0, message=Message(content='\u6211\u662f\u901a\u4e49\u5343\u95ee\uff0c\u963f\u91cc\u5df4\u5df4\u96c6\u56e2\u65d7\u4e0b\u7684\u8d85\u5927\u89c4\u6a21\u8bed\u8a00\u6a21\u578b\u3002\u6211\u80fd\u591f\u5e2e\u52a9\u4f60\u56de\u7b54\u95ee\u9898\u3001\u521b\u4f5c\u6587\u5b57\uff0c\u5982\u5199\u6545\u4e8b\u3001\u516c\u6587\u3001\u6280\u672f\u6587\u6863\u7b49\uff0c\u8fd8\u80fd\u8868\u8fbe\u89c2\u70b9\uff0c\u73a9\u6e38\u620f\u7b49\u3002\u5982\u679c\u4f60\u6709\u4efb\u4f55\u95ee\u9898\u6216\u9700\u8981\u5e2e\u52a9\uff0c\u5c3d\u7ba1\u544a\u8bc9\u6211\uff01', role='assistant', tool_calls=None, function_call=None, provider_specific_fields={'refusal': None}))], usage=Usage(completion_tokens=52, prompt_tokens=10, total_tokens=62, completion_tokens_details=None, prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=None, cached_tokens=0, text_tokens=None, image_tokens=None)), service_tier=None)\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_50","title":"\u57fa\u4e8e\u6700\u4f4e\u6210\u672c\u8def\u7531\u914d\u7f6e","text":"<p>\u6700\u4f4e\u6210\u672c\u8def\u7531\u7b56\u7565\u7684\u5de5\u4f5c\u539f\u7406\u3002</p> <ol> <li> <p>\u83b7\u53d6\u6240\u6709\u5065\u5eb7\u7684\u90e8\u7f72\uff08deployment\uff09\u6a21\u578b</p> </li> <li> <p>\u9009\u62e9\u90a3\u4e9b\u5728\u5176\u63d0\u4f9b\u7684rpm\uff08\u6bcf\u5206\u949f\u8bf7\u6c42\u6570\uff09\u548ctpm\uff08\u6bcf\u5206\u949ftoken\u6570\uff09\u9650\u5236\u5185\u7684\u90e8\u7f72</p> </li> <li> <p>\u5bf9\u4e8e\u6bcf\u4e2a\u90e8\u7f72\uff0c\u68c0\u67e5\u5b83\u662f\u5426\u5728litellm_model_cost_map\uff08\u6210\u672c\u6620\u5c04\u8868\uff09\u4e2d\u5b58\u5728</p> </li> <li> <p>\u5982\u679c\u90e8\u7f72\u4e0d\u5b58\u5728\u4e8e\u6210\u672c\u6620\u5c04\u8868\u4e2d\uff0c\u5219\u4f7f\u7528\u9ed8\u8ba4\u6210\u672c\uff081\u7f8e\u5143\uff09</p> </li> <li> <p>\u9009\u62e9\u6210\u672c\u6700\u4f4e\u7684\u90e8\u7f72</p> </li> </ol> <p>\u53ef\u4ee5\u8bbe\u7f6e<code>litellm_params[\"input_cost_per_token\"]</code>\u548c<code>litellm_params[\"output_cost_per_token\"]</code>\u4ee5\u4fbf\u5728\u8def\u7531\u65f6\u4f7f\u7528\u81ea\u5b9a\u4e49\u6210\u672c\u3002 \u5982\u679c\u8bbe\u7f6e\u4e86\u81ea\u5b9a\u4e49\u6210\u672c\uff0c\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684\u6210\u672c\u8fdb\u884c\u6bd4\u8f83\u3002</p> <pre><code>from litellm import Router\nimport asyncio\n# \u5b9a\u4e49\u6a21\u578b\u6c60\nmodel_list = [\n    {\n        \"model_name\": \"my-llm-test\",  # \u6a21\u578b\u522b\u540d-&gt;\u5177\u6709\u76f8\u540c'model_name'\u7684\u6a21\u578b\u4e4b\u95f4\u7684\u8d1f\u8f7d\u5e73\u8861\n        \"litellm_params\": {  # litellm completion/embedding \u5b9e\u9645\u8c03\u7528\u53c2\u6570\n            \"model\": \"openai/deepseek-chat\",\n            \"api_base\": \"https://api.deepseek.com/v1\",\n            \"api_key\": os.getenv(\"DEEPSEEK_API_KEY\"),\n            \"input_cost_per_token\": 0.00003,  # \u6bcfToken\u6210\u672c\n            \"output_cost_per_token\": 0.00003,\n        },\n        \"model_info\": {\"id\":\"deepseek-chat\"}  \n    },\n    {\n        \"model_name\": \"my-llm-test\",\n        \"litellm_params\": {\n            \"model\": \"openai/qwen-turbo\",\n            \"api_base\": \"https://dashscope.aliyuncs.com/compatible-mode/v1\",\n            \"api_key\": os.getenv(\"BAILIAN_API_KEY\"),\n            \"input_cost_per_token\": 0.00001,\n            \"output_cost_per_token\": 0.00001,\n        },\n        \"model_info\": {\"id\":\"qwen-turbo\"}\n    },\n]\n\n# \u521b\u5efa\u8def\u7531\nrouter = Router(\n    model_list=model_list,\n    routing_strategy=\"cost-based-routing\",  # \u9009\u62e9\u57fa\u4e8e\u6700\u4f4e\u6210\u672c\u8def\u7531\u914d\u7f6e\n    set_verbose=True\n)\n\nmessages=[{\"role\": \"user\", \"content\": \"\u4f60\u662f\u8c01\"}]\ntasks = []\n# \u5faa\u73af\u8c03\u7528\nfor _ in range(2):\n    tasks.append(router.acompletion(model=\"my-llm-test\", messages=messages))\nresponse = await asyncio.gather(*tasks)\nprint(response)\n</code></pre> <pre><code>13:57:07 - LiteLLM Router:INFO: router.py:660 - Routing strategy: cost-based-routing\n13:57:07 - LiteLLM:WARNING: logging_callback_manager.py:124 - Cannot add callback - would exceed MAX_CALLBACKS limit of 30. Current callbacks: 30\n13:57:07 - LiteLLM:WARNING: logging_callback_manager.py:124 - Cannot add callback - would exceed MAX_CALLBACKS limit of 30. Current callbacks: 30\n13:57:07 - LiteLLM:WARNING: logging_callback_manager.py:124 - Cannot add callback - would exceed MAX_CALLBACKS limit of 30. Current callbacks: 30\n13:57:07 - LiteLLM:WARNING: logging_callback_manager.py:124 - Cannot add callback - would exceed MAX_CALLBACKS limit of 30. Current callbacks: 30\n13:57:07 - LiteLLM Router:INFO: router.py:6292 - get_available_deployment for model: my-llm-test, Selected deployment: {'model_name': 'my-llm-test', 'litellm_params': {'input_cost_per_token': 1e-05, 'output_cost_per_token': 1e-05, 'api_key': 'sk**********', 'api_base': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'use_in_pass_through': False, 'use_litellm_proxy': False, 'merge_reasoning_content_in_choices': False, 'model': 'openai/qwen-turbo'}, 'model_info': {'id': 'qwen-turbo', 'db_model': False, 'input_cost_per_token': 1e-05, 'output_cost_per_token': 1e-05}} for model: my-llm-test\n13:57:07 - LiteLLM Router:INFO: router.py:6292 - get_available_deployment for model: my-llm-test, Selected deployment: {'model_name': 'my-llm-test', 'litellm_params': {'input_cost_per_token': 1e-05, 'output_cost_per_token': 1e-05, 'api_key': 'sk**********', 'api_base': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'use_in_pass_through': False, 'use_litellm_proxy': False, 'merge_reasoning_content_in_choices': False, 'model': 'openai/qwen-turbo'}, 'model_info': {'id': 'qwen-turbo', 'db_model': False, 'input_cost_per_token': 1e-05, 'output_cost_per_token': 1e-05}} for model: my-llm-test\n13:57:08 - LiteLLM Router:INFO: router.py:1103 - litellm.acompletion(model=openai/qwen-turbo)[32m 200 OK\n13:57:09 - LiteLLM Router:INFO: router.py:1103 - litellm.acompletion(model=openai/qwen-turbo)[32m 200 OK\n\n\n[ModelResponse(id='chatcmpl-73379046-922b-9e10-9193-cda015839781', created=1749189429, model='qwen-turbo', object='chat.completion', system_fingerprint=None, choices=[Choices(finish_reason='stop', index=0, message=Message(content='\u6211\u662f\u901a\u4e49\u5343\u95ee\uff0c\u963f\u91cc\u5df4\u5df4\u96c6\u56e2\u65d7\u4e0b\u7684\u901a\u4e49\u5b9e\u9a8c\u5ba4\u81ea\u4e3b\u7814\u53d1\u7684\u8d85\u5927\u89c4\u6a21\u8bed\u8a00\u6a21\u578b\u3002\u6211\u80fd\u591f\u5e2e\u52a9\u60a8\u56de\u7b54\u95ee\u9898\u3001\u521b\u4f5c\u6587\u5b57\uff0c\u5982\u5199\u6545\u4e8b\u3001\u516c\u6587\u3001\u6280\u672f\u6587\u6863\u7b49\uff0c\u8fd8\u80fd\u8fdb\u884c\u903b\u8f91\u63a8\u7406\u3001\u7f16\u7a0b\u7b49\u4efb\u52a1\uff0c\u5e76\u652f\u6301\u591a\u8bed\u8a00\u4ea4\u6d41\u3002\u5982\u679c\u60a8\u6709\u4efb\u4f55\u95ee\u9898\u6216\u9700\u8981\u5e2e\u52a9\uff0c\u6b22\u8fce\u968f\u65f6\u544a\u8bc9\u6211\uff01', role='assistant', tool_calls=None, function_call=None, provider_specific_fields={'refusal': None}))], usage=Usage(completion_tokens=65, prompt_tokens=10, total_tokens=75, completion_tokens_details=None, prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=None, cached_tokens=0, text_tokens=None, image_tokens=None)), service_tier=None), ModelResponse(id='chatcmpl-b7cfda24-8c92-9e7d-b840-0ec80285c323', created=1749189429, model='qwen-turbo', object='chat.completion', system_fingerprint=None, choices=[Choices(finish_reason='stop', index=0, message=Message(content='\u6211\u662f\u901a\u4e49\u5343\u95ee\uff0c\u963f\u91cc\u5df4\u5df4\u96c6\u56e2\u65d7\u4e0b\u7684\u8d85\u5927\u89c4\u6a21\u8bed\u8a00\u6a21\u578b\u3002\u6211\u80fd\u591f\u56de\u7b54\u95ee\u9898\u3001\u521b\u4f5c\u6587\u5b57\uff0c\u5982\u5199\u6545\u4e8b\u3001\u516c\u6587\u3001\u6280\u672f\u6587\u6863\uff0c\u8fd8\u80fd\u8868\u8fbe\u89c2\u70b9\uff0c\u73a9\u6e38\u620f\u7b49\u3002\u5982\u679c\u4f60\u6709\u4efb\u4f55\u95ee\u9898\u6216\u9700\u8981\u5e2e\u52a9\uff0c\u6b22\u8fce\u968f\u65f6\u544a\u8bc9\u6211\uff01', role='assistant', tool_calls=None, function_call=None, provider_specific_fields={'refusal': None}))], usage=Usage(completion_tokens=50, prompt_tokens=10, total_tokens=60, completion_tokens_details=None, prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=None, cached_tokens=0, text_tokens=None, image_tokens=None)), service_tier=None)]\n\n\n/var/folders/ln/2_qqbq993pv1yc5c8_dm5q6h0000gp/T/ipykernel_1818/4150574972.py:41: RuntimeWarning: coroutine 'Router.acompletion' was never awaited\n  response = await asyncio.gather(*tasks)\nRuntimeWarning: Enable tracemalloc to get the object allocation traceback\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_51","title":"\u57fa\u4e8e\u6700\u5c11\u4f7f\u7528\u8def\u7531\u914d\u7f6e","text":"<p>\u8fd9\u5c06\u8def\u7531\u5230tpm(\u6bcf\u5206\u949ftoken\u6570)\u4f7f\u7528\u7387\u6700\u4f4e\u7684\u90e8\u7f72\u3002</p> <p>\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528Redis\u6765\u8ddf\u8e2a\u591a\u4e2a\u90e8\u7f72\u4e2dtpm(\u6bcf\u5206\u949ftoken\u6570)\u7684\u4f7f\u7528\u60c5\u51b5\u3002</p> <p>\u5982\u679c\u4f20\u5165\u6a21\u578b\u7684tpm/rpm\u9650\u5236\uff0c\u8fd9\u4e5f\u5c06\u5bf9\u6b64\u8fdb\u884c\u68c0\u67e5\uff0c\u5e76\u8fc7\u6ee4\u6389\u4efb\u4f55\u8d85\u51fa\u9650\u5236\u7684\u6a21\u578b\u3002</p> <p>\u5bf9\u4e8eAzure\uff0crpm(\u6bcf\u5206\u949f\u8bf7\u6c42\u6570)=tpm(\u6bcf\u5206\u949ftoken\u6570)/6\u3002</p> <pre><code>from litellm import Router\nimport asyncio\n# \u5b9a\u4e49\u6a21\u578b\u6c60\nmodel_list = [\n    {\n        \"model_name\": \"my-llm-test\",  # \u6a21\u578b\u522b\u540d-&gt;\u5177\u6709\u76f8\u540c'model_name'\u7684\u6a21\u578b\u4e4b\u95f4\u7684\u8d1f\u8f7d\u5e73\u8861\n        \"litellm_params\": {  # litellm completion/embedding \u5b9e\u9645\u8c03\u7528\u53c2\u6570\n            \"model\": \"openai/deepseek-chat\",\n            \"api_base\": \"https://api.deepseek.com/v1\",\n            \"api_key\": os.getenv(\"DEEPSEEK_API_KEY\"),\n            \"tpm\": 1000,  # \u6bcf\u5206\u949ftoken\u6570\n            \"rpm\": 100,  # \u6bcf\u5206\u949f\u8bf7\u6c42\u6570\n        },\n        \"model_info\": {\"id\":\"deepseek-chat\"}  \n    },\n    {\n        \"model_name\": \"my-llm-test\",\n        \"litellm_params\": {\n            \"model\": \"openai/qwen-turbo\",\n            \"api_base\": \"https://dashscope.aliyuncs.com/compatible-mode/v1\",\n            \"api_key\": os.getenv(\"BAILIAN_API_KEY\"),\n            \"tpm\": 100000,\n            \"rpm\": 10000,\n        },\n        \"model_info\": {\"id\":\"qwen-turbo\"}\n    },\n]\n\n# \u521b\u5efa\u8def\u7531\nrouter = Router(\n    model_list=model_list,\n    routing_strategy=\"usage-based-routing-v2\",  # \u9009\u62e9\u57fa\u4e8e\u6700\u5c11\u4f7f\u7528\u60c5\u51b5\u8def\u7531\u914d\u7f6e\n    set_verbose=True,\n    # cache_responses=True  # \u5728\u751f\u4ea7\u4e2d\uff0c\u6211\u4eec\u5efa\u8bae\u4f7f\u7528Redis\u7f13\u5b58\u3002\u4e3a\u4e86\u5728\u672c\u5730\u5feb\u901f\u6d4b\u8bd5\uff0c\u6211\u4eec\u8fd8\u652f\u6301\u7b80\u5355\u7684\u5185\u5b58\u7f13\u5b58\u3002\n)\n\nmessages=[{\"role\": \"user\", \"content\": \"\u4f60\u662f\u8c01\"}]\ntasks = []\n# \u5faa\u73af\u8c03\u7528\nfor _ in range(2):\n    tasks.append(router.acompletion(model=\"my-llm-test\", messages=messages))\nresponse = await asyncio.gather(*tasks)\nprint(response)\n</code></pre> <pre><code>14:20:05 - LiteLLM Router:INFO: router.py:660 - Routing strategy: usage-based-routing-v2\n14:20:05 - LiteLLM:WARNING: logging_callback_manager.py:124 - Cannot add callback - would exceed MAX_CALLBACKS limit of 30. Current callbacks: 30\n14:20:05 - LiteLLM:WARNING: logging_callback_manager.py:124 - Cannot add callback - would exceed MAX_CALLBACKS limit of 30. Current callbacks: 30\n14:20:05 - LiteLLM:WARNING: logging_callback_manager.py:124 - Cannot add callback - would exceed MAX_CALLBACKS limit of 30. Current callbacks: 30\n14:20:05 - LiteLLM:WARNING: logging_callback_manager.py:124 - Cannot add callback - would exceed MAX_CALLBACKS limit of 30. Current callbacks: 30\n14:20:05 - LiteLLM Router:INFO: router.py:6292 - get_available_deployment for model: my-llm-test, Selected deployment: {'model_name': 'my-llm-test', 'litellm_params': {'api_key': 'sk**********', 'api_base': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'tpm': 100000, 'rpm': 10000, 'use_in_pass_through': False, 'use_litellm_proxy': False, 'merge_reasoning_content_in_choices': False, 'model': 'openai/qwen-turbo'}, 'model_info': {'id': 'qwen-turbo', 'db_model': False}} for model: my-llm-test\n14:20:05 - LiteLLM:WARNING: logging_callback_manager.py:124 - Cannot add callback - would exceed MAX_CALLBACKS limit of 30. Current callbacks: 30\n14:20:05 - LiteLLM:WARNING: logging_callback_manager.py:124 - Cannot add callback - would exceed MAX_CALLBACKS limit of 30. Current callbacks: 30\n14:20:05 - LiteLLM:WARNING: logging_callback_manager.py:124 - Cannot add callback - would exceed MAX_CALLBACKS limit of 30. Current callbacks: 30\n14:20:05 - LiteLLM:WARNING: logging_callback_manager.py:124 - Cannot add callback - would exceed MAX_CALLBACKS limit of 30. Current callbacks: 30\n14:20:05 - LiteLLM:WARNING: logging_callback_manager.py:124 - Cannot add callback - would exceed MAX_CALLBACKS limit of 30. Current callbacks: 30\n14:20:05 - LiteLLM:WARNING: logging_callback_manager.py:124 - Cannot add callback - would exceed MAX_CALLBACKS limit of 30. Current callbacks: 30\n14:20:05 - LiteLLM:WARNING: logging_callback_manager.py:124 - Cannot add callback - would exceed MAX_CALLBACKS limit of 30. Current callbacks: 30\n14:20:05 - LiteLLM:WARNING: logging_callback_manager.py:124 - Cannot add callback - would exceed MAX_CALLBACKS limit of 30. Current callbacks: 30\n14:20:05 - LiteLLM Router:INFO: router.py:6292 - get_available_deployment for model: my-llm-test, Selected deployment: {'model_name': 'my-llm-test', 'litellm_params': {'api_key': 'sk**********', 'api_base': 'https://api.deepseek.com/v1', 'tpm': 1000, 'rpm': 100, 'use_in_pass_through': False, 'use_litellm_proxy': False, 'merge_reasoning_content_in_choices': False, 'model': 'openai/deepseek-chat'}, 'model_info': {'id': 'deepseek-chat', 'db_model': False}} for model: my-llm-test\n14:20:05 - LiteLLM:WARNING: logging_callback_manager.py:124 - Cannot add callback - would exceed MAX_CALLBACKS limit of 30. Current callbacks: 30\n14:20:05 - LiteLLM:WARNING: logging_callback_manager.py:124 - Cannot add callback - would exceed MAX_CALLBACKS limit of 30. Current callbacks: 30\n14:20:05 - LiteLLM:WARNING: logging_callback_manager.py:124 - Cannot add callback - would exceed MAX_CALLBACKS limit of 30. Current callbacks: 30\n14:20:05 - LiteLLM:WARNING: logging_callback_manager.py:124 - Cannot add callback - would exceed MAX_CALLBACKS limit of 30. Current callbacks: 30\n14:20:05 - LiteLLM:WARNING: logging_callback_manager.py:124 - Cannot add callback - would exceed MAX_CALLBACKS limit of 30. Current callbacks: 30\n14:20:05 - LiteLLM:WARNING: logging_callback_manager.py:124 - Cannot add callback - would exceed MAX_CALLBACKS limit of 30. Current callbacks: 30\n14:20:05 - LiteLLM:WARNING: logging_callback_manager.py:124 - Cannot add callback - would exceed MAX_CALLBACKS limit of 30. Current callbacks: 30\n14:20:05 - LiteLLM:WARNING: logging_callback_manager.py:124 - Cannot add callback - would exceed MAX_CALLBACKS limit of 30. Current callbacks: 30\n14:20:10 - LiteLLM Router:INFO: router.py:1103 - litellm.acompletion(model=openai/qwen-turbo)[32m 200 OK\n14:20:12 - LiteLLM Router:INFO: router.py:1103 - litellm.acompletion(model=openai/deepseek-chat)[32m 200 OK\n\n\n[ModelResponse(id='chatcmpl-c1b6361b-864f-9a9f-8f4f-121204e778ff', created=1749190810, model='qwen-turbo', object='chat.completion', system_fingerprint=None, choices=[Choices(finish_reason='stop', index=0, message=Message(content='\u6211\u662f\u901a\u4e49\u5343\u95ee\uff0c\u963f\u91cc\u5df4\u5df4\u96c6\u56e2\u65d7\u4e0b\u7684\u8d85\u5927\u89c4\u6a21\u8bed\u8a00\u6a21\u578b\u3002\u6211\u80fd\u591f\u5e2e\u52a9\u60a8\u56de\u7b54\u95ee\u9898\u3001\u521b\u4f5c\u6587\u5b57\uff0c\u5982\u5199\u6545\u4e8b\u3001\u516c\u6587\u3001\u6280\u672f\u6587\u6863\u7b49\uff0c\u8fd8\u80fd\u8868\u8fbe\u89c2\u70b9\u3001\u73a9\u6e38\u620f\u7b49\u3002\u5982\u679c\u4f60\u6709\u4efb\u4f55\u95ee\u9898\u6216\u9700\u8981\u5e2e\u52a9\uff0c\u6b22\u8fce\u968f\u65f6\u544a\u8bc9\u6211\uff01', role='assistant', tool_calls=None, function_call=None, provider_specific_fields={'refusal': None}))], usage=Usage(completion_tokens=53, prompt_tokens=10, total_tokens=63, completion_tokens_details=None, prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=None, cached_tokens=0, text_tokens=None, image_tokens=None)), service_tier=None), ModelResponse(id='59af6dbe-193f-4e30-b4de-c8d01a988e48', created=1749190806, model='deepseek-chat', object='chat.completion', system_fingerprint='fp_8802369eaa_prod0425fp8', choices=[Choices(finish_reason='stop', index=0, message=Message(content='\u6211\u662fDeepSeek Chat\uff0c\u7531\u6df1\u5ea6\u6c42\u7d22\u516c\u53f8\uff08DeepSeek\uff09\u7814\u53d1\u7684AI\u52a9\u624b\uff01\ud83e\udd16\u2728 \u6211\u7684\u4f7f\u547d\u662f\u5e2e\u52a9\u4f60\u89e3\u7b54\u95ee\u9898\u3001\u63d0\u4f9b\u4fe1\u606f\u3001\u966a\u4f60\u804a\u5929\uff0c\u751a\u81f3\u5e2e\u4f60\u5904\u7406\u5404\u79cd\u6587\u672c\u548c\u6587\u4ef6\u5185\u5bb9\u3002\u65e0\u8bba\u662f\u5b66\u4e60\u3001\u5de5\u4f5c\uff0c\u8fd8\u662f\u65e5\u5e38\u751f\u6d3b\u4e2d\u7684\u7591\u95ee\uff0c\u90fd\u53ef\u4ee5\u6765\u627e\u6211\uff01\ud83d\ude0a  \\n\\n\u6709\u4ec0\u4e48\u6211\u53ef\u4ee5\u5e2e\u4f60\u7684\u5417\uff1f', role='assistant', tool_calls=None, function_call=None, provider_specific_fields={'refusal': None}))], usage=Usage(completion_tokens=70, prompt_tokens=4, total_tokens=74, completion_tokens_details=None, prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=None, cached_tokens=0, text_tokens=None, image_tokens=None), prompt_cache_hit_tokens=0, prompt_cache_miss_tokens=4), service_tier=None)]\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_52","title":"\u5931\u8d25\u91cd\u8bd5","text":"<ul> <li> <p>\u5bf9\u4e8easync\u548csync\u51fd\u6570\u90fd\u652f\u6301\u91cd\u8bd5\u5931\u8d25\u7684\u8bf7\u6c42\u3002</p> </li> <li> <p>\u5bf9\u4e8eRateLimitError\uff0c\u5b9e\u73b0\u4e86\u6307\u6570\u9000\u907f\u3002</p> </li> <li> <p>\u5bf9\u4e8e\u4e00\u822c\u9519\u8bef\uff0c\u4f1a\u7acb\u5373\u91cd\u8bd5</p> </li> <li> <p>\u652f\u6301\u5728\u91cd\u8bd5\u5931\u8d25\u7684\u8bf7\u6c42\u4e4b\u524d\u8bbe\u7f6e\u6700\u77ed\u7b49\u5f85\u65f6\u95f4\uff0c\u53ef\u4ee5\u901a\u8fc7retry_after\u53c2\u6570\u8bbe\u7f6e\u3002</p> </li> </ul> <p>\u4e0b\u9762\u5feb\u901f\u6d4f\u89c8\u4e00\u4e0b\u6211\u4eec\u5982\u4f55\u8bbe\u7f6enum_retries=3\uff1a</p> <pre><code>import os\nfrom litellm import Router\nfrom openai import OpenAIError\nimport asyncio\n# \u5b9a\u4e49\u6a21\u578b\u6c60\nmodel_list = [\n    {\n        \"model_name\": \"my-llm-test\",  # \u6a21\u578b\u522b\u540d-&gt;\u5177\u6709\u76f8\u540c'model_name'\u7684\u6a21\u578b\u4e4b\u95f4\u7684\u8d1f\u8f7d\u5e73\u8861\n        \"litellm_params\": {  # litellm completion/embedding \u5b9e\u9645\u8c03\u7528\u53c2\u6570\n            \"model\": \"openai/deepseek-chat\",\n            \"api_base\": \"https://api.deepseek.com/v1\",\n            \"api_key\": os.getenv(\"DEEPSEEK_API_KEY\"),\n        },\n        \"model_info\": {\"id\":\"deepseek-chat\"}  \n    },\n    {\n        \"model_name\": \"my-llm-test\",\n        \"litellm_params\": {\n            \"model\": \"openai/qwen-turbo\",\n            \"api_base\": \"https://dashscope.aliyuncs.com/compatible-mode/v1\",\n            # \"api_key\": os.getenv(\"BAILIAN_API_KEY\"),\n        },\n        \"model_info\": {\"id\":\"qwen-turbo\"}\n    },\n]\n\n# \u521b\u5efa\u8def\u7531\nrouter = Router(\n    model_list=model_list,\n    routing_strategy=\"simple-shuffle\",  \n    set_verbose=True,\n    num_retries=3,  # \u5931\u8d25\u91cd\u8bd5 3 \u6b21\n    retry_after=5,  # \u91cd\u8bd5\u5931\u8d25\u7684\u8bf7\u6c42\u4e4b\u524d\u7b49\u5f85 5 \u79d2\n    # cache_responses=True  # \u5728\u751f\u4ea7\u4e2d\uff0c\u6211\u4eec\u5efa\u8bae\u4f7f\u7528Redis\u7f13\u5b58\u3002\u4e3a\u4e86\u5728\u672c\u5730\u5feb\u901f\u6d4b\u8bd5\uff0c\u6211\u4eec\u8fd8\u652f\u6301\u7b80\u5355\u7684\u5185\u5b58\u7f13\u5b58\u3002\n)\n\nmessages=[{\"role\": \"user\", \"content\": \"\u4f60\u662f\u8c01\"}]\n\ntry:\n    # \u4f7f\u7528\u8def\u7531\n    response = router.completion(\n        model=\"my-llm-test\",  # \u4f7f\u7528\u6a21\u578b\u522b\u540d\u8c03\u7528\n        messages=messages\n    )\n\n    print(response)\nexcept OpenAIError as e:\n    print(str(e))\n</code></pre> <pre><code>14:36:00 - LiteLLM Router:INFO: router.py:660 - Routing strategy: simple-shuffle\n14:36:00 - LiteLLM Router:INFO: router.py:911 - litellm.completion(model=openai/deepseek-chat)[31m Exception litellm.AuthenticationError: AuthenticationError: OpenAIException - The api_key client option must be set either by passing api_key to the client or by setting the OPENAI_API_KEY environment variable\n14:36:00 - LiteLLM Router:INFO: router.py:3670 - Retrying request with num_retries: 3\n14:36:00 - LiteLLM Router:INFO: router.py:911 - litellm.completion(model=openai/qwen-turbo)[31m Exception litellm.AuthenticationError: AuthenticationError: OpenAIException - The api_key client option must be set either by passing api_key to the client or by setting the OPENAI_API_KEY environment variable\n14:36:05 - LiteLLM Router:INFO: router.py:911 - litellm.completion(model=openai/qwen-turbo)[31m Exception litellm.AuthenticationError: AuthenticationError: OpenAIException - The api_key client option must be set either by passing api_key to the client or by setting the OPENAI_API_KEY environment variable\n14:36:05 - LiteLLM Router:INFO: router.py:911 - litellm.completion(model=openai/deepseek-chat)[31m Exception litellm.AuthenticationError: AuthenticationError: OpenAIException - The api_key client option must be set either by passing api_key to the client or by setting the OPENAI_API_KEY environment variable\n14:36:10 - LiteLLM Router:INFO: router.py:3379 - Trying to fallback b/w models\n\n\nlitellm.AuthenticationError: AuthenticationError: OpenAIException - The api_key client option must be set either by passing api_key to the client or by setting the OPENAI_API_KEY environment variable. Received Model Group=my-llm-test\nAvailable Model Group Fallbacks=None LiteLLM Retried: 2 times, LiteLLM Max Retries: 3\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_53","title":"\u6a21\u578b\u8c03\u7528\u5931\u8d25\u56de\u9000\u7b56\u7565\u914d\u7f6e","text":"<p>Fallbacks\uff08\u56de\u9000\u673a\u5236\uff09\u662f LiteLLM \u7684\u6838\u5fc3\u9ad8\u53ef\u7528\u7279\u6027\uff0c\u5b83\u80fd\u5728\u4e3b\u6a21\u578b\u8c03\u7528\u5931\u8d25\u65f6\u81ea\u52a8\u5207\u6362\u5230\u5907\u7528\u6a21\u578b\uff0c\u786e\u4fdd\u670d\u52a1\u7684\u8fde\u7eed\u6027\u548c\u7a33\u5b9a\u6027\u3002\u4ee5\u4e0b\u662f\u5168\u9762\u7684\u529f\u80fd\u89e3\u6790\uff1a</p> <p>\u6839\u636e\u4e4b\u524d\u63d0\u4f9b\u7684 Router \u53c2\u6570\uff0c\u6211\u4eec\u77e5\u9053\u6709\u51e0\u79cd\u7c7b\u578b\u7684\u56de\u9000\u914d\u7f6e\uff1a</p> <ol> <li> <p><code>default_fallbacks</code>: \u901a\u7528\u56de\u9000\u5217\u8868\uff0c\u9002\u7528\u4e8e\u6240\u6709\u6a21\u578b\uff0c\u89e6\u53d1\u6761\u4ef6\uff1a\u4efb\u4f55\u6a21\u578b\u8c03\u7528\u5931\u8d25\u65f6</p> </li> <li> <p><code>fallbacks</code>: \u6307\u5b9a\u7279\u5b9a\u6a21\u578b\u7ec4\u7684\u56de\u9000\u94fe\uff0c\u7cbe\u7ec6\u5316\u63a7\u5236\u56de\u9000\u8def\u5f84</p> </li> <li> <p><code>context_window_fallbacks</code>: \u5f53\u8f93\u5165\u8d85\u51fa\u6a21\u578b\u4e0a\u4e0b\u6587\u7a97\u53e3\u65f6\u7684\u56de\u9000\uff0c\u89e6\u53d1\u6761\u4ef6\uff1a\u6536\u5230\u9519\u8bef<code>ContextWindowExceededError</code>\uff0c\u5178\u578b\u573a\u666f\uff1a\u5904\u7406\u957f\u6587\u6863\u6458\u8981\u3001\u4ee3\u7801\u5206\u6790</p> </li> <li> <p><code>content_policy_fallbacks</code>: \u5f53\u5185\u5bb9\u8fdd\u53cd\u6a21\u578b\u4f7f\u7528\u7b56\u7565\u65f6\u7684\u56de\u9000\uff0c\u89e6\u53d1\u6761\u4ef6\uff1a \u6536\u5230\u9519\u8bef<code>PolicyViolationError</code>\uff0c\u5e94\u7528\u573a\u666f\uff1a\u533b\u7597/\u91d1\u878d\u7b49\u654f\u611f\u9886\u57df</p> </li> </ol> <p>\u6b64\u5916\uff0c\u5728\u6545\u969c\u5904\u7406\u65b9\u9762\uff0c\u8fd8\u6709 <code>max_fallbacks</code> \u53c2\u6570\u63a7\u5236\u6700\u5927\u56de\u9000\u5c1d\u8bd5\u6b21\u6570\u3002</p> <p>\u56de\u9000\u987a\u5e8f\uff1a\u4e3b\u6a21\u578b\u5931\u8d25 \u2192 \u5b9a\u5411\u56de\u9000\uff08fallbacks\uff09 \u2192 \u901a\u7528\u56de\u9000\uff08default_fallbacks\uff09 \u2192 \u6700\u7ec8\u515c\u5e95</p> <p>\u56de\u9000\u7b56\u7565\u6267\u884c\u987a\u5e8f\u6d41\u7a0b\u56fe <pre><code>graph TD\n    A[\u4e3b\u6a21\u578b\u8c03\u7528] --&gt; B{\u5931\u8d25\u539f\u56e0?}\n    B --&gt;|\u5e38\u89c4\u9519\u8bef| C[\u89e6\u53d1fallbacks\u5b9a\u5411\u56de\u9000]\n    B --&gt;|\u4e0a\u4e0b\u6587\u8d85\u9650\uff0c\u629b\u51fa\u5f02\u5e38ContextWindowExceededError| D[\u89e6\u53d1context_window_fallbacks]\n    B --&gt;|\u7b56\u7565\u8fdd\u89c4\uff0c\u629b\u51fa\u5f02\u5e38PolicyViolationError| E[\u89e6\u53d1content_policy_fallbacks]\n    C --&gt; F{\u662f\u5426\u7528\u5c3dfallbacks?}\n    D --&gt; G{\u662f\u5426\u7528\u5c3dcontext\u56de\u9000?}\n    E --&gt; H{\u662f\u5426\u7528\u5c3dpolicy\u56de\u9000?}\n    F --&gt;|\u662f| I[\u89e6\u53d1default_fallbacks]\n    G --&gt;|\u662f| I\n    H --&gt;|\u662f| I\n    I --&gt; J{\u662f\u5426\u7528\u5c3ddefault\u56de\u9000?}\n    J --&gt;|\u662f| K[\u629b\u51fa\u6700\u7ec8\u9519\u8bef]</code></pre></p> <p>Fallbacks \u5de5\u4f5c\u6d41\u7a0b <pre><code>sequenceDiagram\n    participant Client\n    participant Router\n    participant ModelA\n    participant ModelB\n    participant ModelC\n\n    Client-&gt;&gt;Router: \u8bf7\u6c42(gpt-4-turbo)\n    Router-&gt;&gt;ModelA: \u8c03\u7528\u4e3b\u6a21\u578b\n    ModelA--&gt;&gt;Router: \u5931\u8d25(\u8d85\u65f6)\n    Router-&gt;&gt;ModelB: \u56de\u9000(claude-3-opus)\n    ModelB--&gt;&gt;Router: \u5931\u8d25(\u7b56\u7565\u8fdd\u89c4)\n    Router-&gt;&gt;ModelC: \u56de\u9000(deepseek-chat)\n    ModelC--&gt;&gt;Router: \u6210\u529f\u54cd\u5e94\n    Router--&gt;&gt;Client: \u8fd4\u56de\u7ed3\u679c</code></pre></p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#_54","title":"\u5b8c\u6574\u5de5\u4f5c\u6d41\u793a\u4f8b","text":"<pre><code>import os\nfrom litellm import Router\nfrom openai import OpenAIError\nimport asyncio\n# \u5b9a\u4e49\u6a21\u578b\u6c60\nmodel_list = [\n    {\n        \"model_name\": \"deepseek-chat\",  # \u6a21\u578b\u522b\u540d-&gt;\u5177\u6709\u76f8\u540c'model_name'\u7684\u6a21\u578b\u4e4b\u95f4\u7684\u8d1f\u8f7d\u5e73\u8861\n        \"litellm_params\": {  # litellm completion/embedding \u5b9e\u9645\u8c03\u7528\u53c2\u6570\n            \"model\": \"openai/deepseek-chat\",\n            \"api_base\": \"https://api.deepseek.com/v1\",\n            \"api_key\": os.getenv(\"DEEPSEEK_API_KEY\"),\n        },\n        \"model_info\": {\"id\":\"deepseek-chat\"}  \n    },\n    {\n        \"model_name\": \"qwen-turbo\",\n        \"litellm_params\": {\n            \"model\": \"openai/qwen-turbo\",\n            \"api_base\": \"https://dashscope.aliyuncs.com/compatible-mode/v1\",\n            # \"api_key\": os.getenv(\"BAILIAN_API_KEY\"),\n        },\n        \"model_info\": {\"id\":\"qwen-turbo\"}\n    },\n]\n\n# \u521b\u5efa\u8def\u7531\nrouter = Router(\n    model_list=model_list,\n    routing_strategy=\"simple-shuffle\",  \n    set_verbose=True,\n\n    # \u56de\u9000\u7b56\u7565\n    default_fallbacks=[\"deepseek-chat\"],\n    fallbacks=[{\"qwen-turbo\": \"claude-3-opus\"}],\n    context_window_fallbacks=[{\"qwen-turbo\": \"deepseek-chat\"}],\n    content_policy_fallbacks=[{\"qwen-turbo\": \"deepseek-chat\"}],\n\n    # \u91cd\u8bd5\u914d\u7f6e\n    num_retries=3,  # \u5931\u8d25\u91cd\u8bd5 3 \u6b21\n    retry_after=5,  # \u91cd\u8bd5\u5931\u8d25\u7684\u8bf7\u6c42\u4e4b\u524d\u7b49\u5f85 5 \u79d2\n    # cache_responses=True  # \u5728\u751f\u4ea7\u4e2d\uff0c\u6211\u4eec\u5efa\u8bae\u4f7f\u7528Redis\u7f13\u5b58\u3002\u4e3a\u4e86\u5728\u672c\u5730\u5feb\u901f\u6d4b\u8bd5\uff0c\u6211\u4eec\u8fd8\u652f\u6301\u7b80\u5355\u7684\u5185\u5b58\u7f13\u5b58\u3002\n)\n\nmessages=[{\"role\": \"user\", \"content\": \"\u4f60\u662f\u8c01\"}]\n\ntry:\n    # \u4f7f\u7528\u8def\u7531\n    response = router.completion(\n        model=\"qwen-turbo\", \n        messages=messages\n    )\n\n    print(response)\nexcept OpenAIError as e:\n    print(str(e))\n</code></pre> <pre><code>15:20:23 - LiteLLM Router:INFO: router.py:660 - Routing strategy: simple-shuffle\n15:20:23 - LiteLLM Router:INFO: router.py:911 - litellm.completion(model=openai/qwen-turbo)[31m Exception litellm.AuthenticationError: AuthenticationError: OpenAIException - The api_key client option must be set either by passing api_key to the client or by setting the OPENAI_API_KEY environment variable\n15:20:23 - LiteLLM Router:INFO: router.py:3379 - Trying to fallback b/w models\n15:20:23 - LiteLLM Router:INFO: fallback_event_handlers.py:128 - Falling back to model_group = c\n15:20:23 - LiteLLM Router:INFO: router.py:911 - litellm.completion(model=None)[31m Exception litellm.BadRequestError: You passed in model=c. There is no 'model_name' with this string \n15:20:23 - LiteLLM Router:INFO: router.py:3379 - Trying to fallback b/w models\n15:20:23 - LiteLLM Router:INFO: fallback_event_handlers.py:128 - Falling back to model_group = deepseek-chat\n15:20:31 - LiteLLM Router:INFO: router.py:893 - litellm.completion(model=openai/deepseek-chat)[32m 200 OK\n15:20:31 - LiteLLM Router:INFO: fallback_event_handlers.py:142 - Successful fallback b/w models.\n15:20:31 - LiteLLM Router:INFO: fallback_event_handlers.py:142 - Successful fallback b/w models.\n\n\nModelResponse(id='f2e51863-6047-49fe-a562-db168ded247e', created=1749194424, model='deepseek-chat', object='chat.completion', system_fingerprint='fp_8802369eaa_prod0425fp8', choices=[Choices(finish_reason='stop', index=0, message=Message(content='\u6211\u662fDeepSeek Chat\uff0c\u7531\u6df1\u5ea6\u6c42\u7d22\u516c\u53f8\u5f00\u53d1\u7684\u667a\u80fdAI\u52a9\u624b\uff01\u2728 \u6211\u7684\u4f7f\u547d\u662f\u5e2e\u52a9\u4f60\u89e3\u7b54\u95ee\u9898\u3001\u63d0\u4f9b\u4fe1\u606f\u3001\u966a\u4f60\u804a\u5929\uff0c\u8fd8\u80fd\u5e2e\u4f60\u5904\u7406\u5404\u79cd\u6587\u672c\u3001\u6587\u4ef6\u5185\u5bb9\u3002\u65e0\u8bba\u662f\u5b66\u4e60\u3001\u5de5\u4f5c\uff0c\u8fd8\u662f\u65e5\u5e38\u751f\u6d3b\u4e2d\u7684\u5c0f\u56f0\u60d1\uff0c\u90fd\u53ef\u4ee5\u6765\u627e\u6211\u804a\u804a\uff01\ud83d\ude0a  \\n\\n\u6709\u4ec0\u4e48\u6211\u53ef\u4ee5\u5e2e\u4f60\u7684\u5417\uff1f', role='assistant', tool_calls=None, function_call=None, provider_specific_fields={'refusal': None}))], usage=Usage(completion_tokens=65, prompt_tokens=4, total_tokens=69, completion_tokens_details=None, prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=None, cached_tokens=0, text_tokens=None, image_tokens=None), prompt_cache_hit_tokens=0, prompt_cache_miss_tokens=4), service_tier=None)\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/LLM%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%EF%BC%9ALiteLLM%20%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/#jupyter-notebook-markdown","title":"\u5c06 jupyter notebook \u8f6c\u6362\u4e3a markdown \u683c\u5f0f","text":"<p>\u5b89\u88c5nbconverter: <code>pip install nbconvert</code></p> <p>\u6267\u884c\u547d\u4ee4\uff1a<code>jupyter nbconvert --to FORMAT notebook.ipynb</code></p> <p>\u8fd9\u91ccFORMAT \u7528\u5177\u4f53\u7684\u683c\u5f0f\u66ff\u6362\uff0c\u5982 markdown, html\u7b49</p> <pre><code>!jupyter nbconvert --to markdown litellm_use.ipynb\n</code></pre> <pre><code>[NbConvertApp] Converting notebook litellm_use.ipynb to markdown\n[NbConvertApp] Writing 103765 bytes to litellm_use.md\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/langchain%E4%BD%BF%E7%94%A8token%E5%88%87%E5%88%86chunk/","title":"langchain\u4f7f\u7528token\u5207\u5206chunk","text":"<pre><code>from modelscope.hub.snapshot_download import snapshot_download\nfrom transformers import AutoTokenizer\nfrom langchain_text_splitters import RecursiveCharacterTextSplitter\nimport PyPDF2\n\n\ndef extract_text_from_pdf(pdf_file):\n    with open(pdf_file, 'rb') as file:\n        reader = PyPDF2.PdfReader(file)\n        text = \"\"\n        for page_num in range(len(reader.pages)):\n            text += reader.pages[page_num].extract_text()\n    return text\n\n\npdf_text = extract_text_from_pdf('/Users/xiniao/Downloads/FATF-ME-FATF-HK-FUR-4-1-202302.pdf')\nprint(pdf_text)\n\nif __name__ == '__main__':\n    model_id = 'Qwen/Qwen2.5-72B-Instruct'\n    # cache_dir = './models'\n    ignore_patterns=['*.safetensors']\n    print(\"\u5f00\u59cb\u4e0b\u8f7d\u6a21\u578b\")\n    model_dir = snapshot_download(model_id, ignore_patterns=ignore_patterns)\n    print(model_dir)\n    print(\"\u5f00\u59cb\u52a0\u8f7dtokenizer\")\n\n    tokenizer = AutoTokenizer.from_pretrained(model_dir, trust_remote_code=True)\n    print(tokenizer)\n    encode = tokenizer.encode('\u4f60\u597d')\n\n    print(encode)\n\n    text_splitter = RecursiveCharacterTextSplitter.from_huggingface_tokenizer(\n        tokenizer, chunk_size=1000, chunk_overlap=100\n    )\n    texts = text_splitter.split_text(pdf_text)\n\n    for t in texts:\n        print(\"-\" * 80)\n        print()\n        print(t)\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%E5%8E%9F%E7%90%86%E5%92%8C%E5%AE%9E%E8%B7%B5/","title":"\u5927\u6a21\u578b\u5de5\u5177/\u51fd\u6570\u8c03\u7528\u539f\u7406\u548c\u5b9e\u8df5","text":"<p>OpenAI\u6700\u521d\u57282023\u5e746\u670813\u65e5\u7684\u66f4\u65b0\u4e2d\u4e3aChat Completions\u6a21\u578b\u5f15\u5165\u4e86Function calling\uff08\u5de5\u5177\u8c03\u7528\uff09\u529f\u80fd\u3002\u968f\u7740\u6280\u672f\u53d1\u5c55\uff0cOpenAI\u5df2\u5c06Function calling\u5347\u7ea7\u4e3a\u66f4\u901a\u7528\u7684Tool calling\uff08\u5de5\u5177\u8c03\u7528\uff09\u673a\u5236\uff0c\u4f7f\u6a21\u578b\u80fd\u591f\u8c03\u7528\u66f4\u5e7f\u6cdb\u7684\u5de5\u5177\u96c6\u3002</p> <p>OpenAI\u5f53\u524d\u7684API\u8bbe\u8ba1\u4e2d\uff0cfunctions\u53c2\u6570\u5df2\u88abtools\u53c2\u6570\u53d6\u4ee3\uff0cfunction_call\u53c2\u6570\u4e5f\u88abtool_choice\u53c2\u6570\u53d6\u4ee3\uff0c\u4f53\u73b0\u4e86\u4ece\u5355\u4e00\u5de5\u5177\u8c03\u7528\u5411\u591a\u529f\u80fd\u5de5\u5177\u8c03\u7528\u7684\u6f14\u8fdb\u3002</p> <p>\u56e0\u4e3aFunction calling\u548cTool calling\u672c\u8d28\u4e0a\u662f\u4e00\u6837\u7684\uff0c\u53ef\u4ee5\u4e92\u6362\u4f7f\u7528\uff0c\u6240\u4ee5\u8fd9\u91cc\u4e3a\u4e86\u65b9\u4fbf\uff0c\u7edf\u4e00\u53eb\u505a\u5de5\u5177\u8c03\u7528\u3002 </p> <p>\u6700\u5f00\u59cb\u5199\u8fd9\u7bc7\u6587\u7ae0\u7684\u6807\u9898\u662f \u201c\u5982\u4f55\u8ba9\u5927\u6a21\u578b\u8fdb\u884c\u5de5\u5177\u8c03\u7528\u201d\uff0c\u53d1\u73b0\u8fd9\u4e2a\u6807\u9898\u975e\u5e38\u5bb9\u6613\u5f15\u8d77\u8bef\u89e3\uff0c\u867d\u7136 \"\u5de5\u5177\u8c03\u7528 \"\u8fd9\u4e2a\u540d\u79f0\u610f\u5473\u7740\u6a21\u578b\u76f4\u63a5\u6267\u884c\u67d0\u4e9b\u64cd\u4f5c\uff0c\u4f46\u5b9e\u9645\u4e0a\u5e76\u975e\u5982\u6b64\uff01\u6a21\u578b\u53ea\u662f\u6839\u636e\u4f20\u5165\u7684\u5de5\u5177\u5b9a\u4e49\u6309\u7167\u7279\u5b9a\u7684\u683c\u5f0f\u8fd4\u56de\u9700\u8981\u8c03\u7528\u7684\u5de5\u5177\u540d\u79f0\u548c\u5de5\u5177\u8c03\u7528\u5165\u53c2\uff0c\u800c\u5de5\u5177\u7684\u5b9e\u9645\u8fd0\u884c\uff08\u6216\u4e0d\u8fd0\u884c\uff09\u53d6\u51b3\u4e8e\u7528\u6237\u3002</p> <p>\u5927\u6a21\u578b\u5de5\u5177\u8c03\u7528\u7684\u6838\u5fc3\u539f\u7406\u662f\uff1a\u5927\u6a21\u578b\u672c\u8eab\u5e76\u4e0d\u76f4\u63a5\u6267\u884c\u4ee3\u7801\u6216\u8c03\u7528API\uff0c\u800c\u662f\u626e\u6f14\u4e00\u4e2a\u201c\u5927\u8111\u201d\u6216\u201c\u89c4\u5212\u8005\u201d\u7684\u89d2\u8272\u3002\u5b83\u7406\u89e3\u7528\u6237\u7684\u610f\u56fe\uff0c\u89c4\u5212\u9700\u8981\u6267\u884c\u7684\u6b65\u9aa4\uff0c\u5e76\u751f\u6210\u7ed3\u6784\u5316\u7684\u8bf7\u6c42\uff0c\u7531\u5916\u90e8\u7cfb\u7edf\uff08\u6267\u884c\u73af\u5883\uff09\u6765\u5b9e\u9645\u6267\u884c\u8fd9\u4e9b\u5de5\u5177\uff0c\u6700\u540e\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9\u6a21\u578b\u8fdb\u884c\u603b\u7ed3\u548c\u56de\u590d\u3002</p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%E5%8E%9F%E7%90%86%E5%92%8C%E5%AE%9E%E8%B7%B5/#_2","title":"\u4e3a\u4ec0\u4e48\u5927\u6a21\u578b\u9700\u8981\u5de5\u5177\u8c03\u7528\u80fd\u529b","text":"<p>\u5927\u8bed\u8a00\u6a21\u578b\uff08LLMs\uff09\u662f\u5f3a\u5927\u7684\u5de5\u5177\uff0c\u7136\u800c\u6709\u65f6LLMs\u672c\u8eab\u7684\u80fd\u529b\u4e0d\u8db3\u4ee5\u5e94\u5bf9\u6240\u6709\u4efb\u52a1\u3002</p> <ul> <li>\u4e00\u65b9\u9762\uff0cLLMs\u5b58\u5728\u56fa\u6709\u7684\u5efa\u6a21\u5c40\u9650\u6027\u3002\u9996\u5148\uff0c\u5b83\u4eec\u65e0\u6cd5\u4e86\u89e3\u8bad\u7ec3\u6570\u636e\u4e4b\u5916\u7684\u5185\u5bb9\uff0c\u5305\u62ec\u8bad\u7ec3\u7ed3\u675f\u540e\u53d1\u751f\u7684\u65b0\u4fe1\u606f\u3002\u6b64\u5916\uff0c\u5b83\u4eec\u901a\u8fc7\u6982\u7387\u5b66\u4e60\u77e5\u8bc6\uff0c\u8fd9\u610f\u5473\u7740\u5bf9\u4e8e\u5177\u6709\u56fa\u5b9a\u89c4\u5219\u7684\u4efb\u52a1\uff08\u4f8b\u5982\u6570\u5b66\u8ba1\u7b97\uff09\uff0cLLMs\u53ef\u80fd\u4e0d\u591f\u7cbe\u786e\u3002</li> <li>\u53e6\u4e00\u65b9\u9762\uff0cLLMs\u96be\u4ee5\u4f5c\u4e3a\u5373\u63d2\u5373\u7528\uff08Plug-and-Play\uff09\u7684\u670d\u52a1\u4e0e\u5176\u4ed6\u7cfb\u7edf\u7f16\u7a0b\u4ea4\u4e92\u3002LLMs\u4e3b\u8981\u901a\u8fc7\u5f00\u653e\u6027\u6587\u672c\u8fdb\u884c\u4ea4\u6d41\uff0c\u800c\u5176\u4ed6\u8f6f\u4ef6\u3001\u5e94\u7528\u7a0b\u5e8f\u6216\u7cfb\u7edf\u5219\u901a\u8fc7\u9884\u5b9a\u4e49\u7684\u3001\u7ed3\u6784\u5316\u7684\u7f16\u7a0b\u63a5\u53e3\u8fdb\u884c\u901a\u4fe1\uff0c\u4e24\u8005\u4e4b\u95f4\u5b58\u5728\u8bed\u4e49\u548c\u683c\u5f0f\u7684\u9e3f\u6c9f\u3002</li> </ul> <p>\u5de5\u5177\u8c03\u7528\u63d0\u4f9b\u4e86\"\u4f7f\u7528\u5de5\u5177\u884c\u52a8\u7684\u80fd\u529b\"\uff0c\u4f7f\u5927\u6a21\u578b\u4ece\u88ab\u52a8\u54cd\u5e94\u8005\u8f6c\u53d8\u4e3a\u4e3b\u52a8\u6267\u884c\u8005\u3002</p> <p>\u5de5\u5177\u8c03\u7528\u662f\u5b9e\u73b0\u667a\u80fd\u4f53(Agent)\u80fd\u529b\u7684\u5173\u952e\u6280\u672f\uff1aAgent \u667a\u80fd\u4f53 = \u5927\u8bed\u8a00\u6a21\u578b\u7684\u63a8\u7406\u80fd\u529b + \u4f7f\u7528\u5de5\u5177\u884c\u52a8\u7684\u80fd\u529b\u3002</p> <p>\u5de5\u5177\u8c03\u7528\u901a\u8fc7\u6807\u51c6\u5316LLMs\u4e0e\u5916\u90e8\u7cfb\u7edf\u7684\u4ea4\u4e92\uff0c\u5f25\u8865\u4e86LLMs\u7684\u5c40\u9650\u6027\uff0c\u4f7f\u5176\u80fd\u591f\u7ed3\u5408\u5916\u90e8\u5de5\u5177\uff08\u5982\u6570\u636e\u5e93\u3001API\u3001\u4ee3\u7801\u89e3\u91ca\u5668\uff09\u5b8c\u6210\u590d\u6742\u4efb\u52a1\uff0c\u662f\u6784\u5efaAI\u5e94\u7528\u7684\u5173\u952e\u6280\u672f\u4e4b\u4e00\u3002</p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%E5%8E%9F%E7%90%86%E5%92%8C%E5%AE%9E%E8%B7%B5/#_3","title":"\u5de5\u5177\u8c03\u7528\u6838\u5fc3\u67b6\u6784\u4e0e\u6d41\u7a0b","text":"<p>\u4e00\u4e2a\u5178\u578b\u7684\u5927\u6a21\u578b\u5de5\u5177\u8c03\u7528\u7cfb\u7edf\u9075\u5faa\u4ee5\u4e0b\u6d41\u7a0b\uff0c\u8fd9\u662f\u4e00\u4e2a\u7ecf\u5178\u7684 ReAct (Reason + Act) \u6a21\u5f0f\uff1a</p> <pre><code>graph TD\n    A[1.\u7528\u6237\u8f93\u5165] --&gt; B[2.\u5927\u6a21\u578b + \u5de5\u5177]\n    subgraph \u5faa\u73af\u76f4\u81f3\u4efb\u52a1\u5b8c\u6210\n        B -- \u601d\u8003\u4e0e\u89c4\u5212 --&gt; C[3.\u751f\u6210\u7ed3\u6784\u5316\u8bf7\u6c42: \u9009\u62e9\u5de5\u5177 &amp; \u8f93\u5165\u53c2\u6570]\n        C --&gt; D[4.\u5916\u90e8\u7cfb\u7edf\u6267\u884c\u5de5\u5177]\n        D --&gt; E[5.\u83b7\u53d6\u5de5\u5177\u6267\u884c\u7ed3\u679c]\n        E --&gt; F[6.\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9\u5927\u6a21\u578b]\n    end\n    F --&gt; B\n    B -- \u6574\u5408\u4fe1\u606f\u751f\u6210\u6700\u7ec8\u56de\u7b54 --&gt; G[7.\u56de\u590d\u7528\u6237]</code></pre> <p>\u4e0b\u56fe\u6e05\u6670\u5730\u5c55\u793a\u4e86\u5927\u6a21\u578b\u5de5\u5177\u8c03\u7528\u7684\u4ea4\u4e92\u548c\u5faa\u73af\u5173\u7cfb\uff1a</p> <pre><code>sequenceDiagram\n    participant \u7528\u6237\n    participant \u5e94\u7528\n    participant \u6a21\u578b\n\n    \u7528\u6237-&gt;&gt;\u5e94\u7528: \u63d0\u51fa\u95ee\u9898 (Prompt)\n    \u5e94\u7528-&gt;&gt;\u6a21\u578b: \u8bf7\u6c421: \u7528\u6237\u95ee\u9898 + \u5de5\u5177\u5b9a\u4e49\n    \u6a21\u578b-&gt;&gt;\u5e94\u7528: \u54cd\u5e941: \u8fd4\u56de\u5de5\u5177\u8c03\u7528\u8bf7\u6c42(\u540d\u79f0,\u53c2\u6570)\n    \u5e94\u7528-&gt;&gt;\u5e94\u7528: \u6267\u884c\u76f8\u5e94\u5de5\u5177/\u51fd\u6570/API\n    \u5e94\u7528-&gt;&gt;\u6a21\u578b: \u8bf7\u6c422: \u8ffd\u52a0\u5de5\u5177\u6267\u884c\u7ed3\u679c\n    \u6a21\u578b-&gt;&gt;\u5e94\u7528: \u54cd\u5e942: \u751f\u6210\u6700\u7ec8\u56de\u7b54(\u6216\u7ee7\u7eed\u8c03\u7528)\n    \u5e94\u7528-&gt;&gt;\u7528\u6237: \u5c55\u793a\u6700\u7ec8\u56de\u7b54</code></pre> <p>\u6d41\u7a0b\u8bf4\u660e\uff1a</p> <ol> <li>\u7528\u6237\u5411\u5e94\u7528\u63d0\u51fa\u95ee\u9898\u3002</li> <li>\u5e94\u7528\u5c06\u95ee\u9898\u548c\u53ef\u4f9b\u8c03\u7528\u7684\u5de5\u5177\u5217\u8868\u4e00\u5e76\u53d1\u9001\u7ed9\u6a21\u578b\u3002</li> <li>\u6a21\u578b\u8fd4\u56de\u4e00\u4e2a\u7ed3\u6784\u5316\u7684\u5de5\u5177\u8c03\u7528\u8bf7\u6c42\uff08\u4f8b\u5982\uff0c\u8c03\u7528\u67d0\u4e2aAPI\u5e76\u4f20\u5165\u7279\u5b9a\u53c2\u6570\uff09\u3002</li> <li>\u5e94\u7528\u63a5\u6536\u8be5\u8bf7\u6c42\uff0c\u5e76\u5728\u5176\u540e\u53f0\u5b89\u5168\u5730\u6267\u884c\u6307\u5b9a\u7684\u5de5\u5177\uff08\u5982\u8fd0\u884c\u4ee3\u7801\u3001\u67e5\u8be2\u6570\u636e\u5e93\uff09\u3002</li> <li>\u5e94\u7528\u5c06\u5de5\u5177\u6267\u884c\u7684\u7ed3\u679c\u4f5c\u4e3a\u65b0\u7684\u6d88\u606f\u4e0a\u4e0b\u6587\uff0c\u518d\u6b21\u53d1\u9001\u7ed9\u6a21\u578b\u3002</li> <li>\u6a21\u578b\u6536\u5230\u7ed3\u679c\u540e\uff0c\u5c06\u5176\u6574\u5408\u5e76\u751f\u6210\u9762\u5411\u7528\u6237\u7684\u6700\u7ec8\u56de\u7b54\uff0c\u8fd4\u56de\u7ed9\u5e94\u7528\u3002</li> <li>\u5e94\u7528\u5c06\u6700\u7ec8\u56de\u7b54\u5448\u73b0\u7ed9\u7528\u6237\u3002</li> </ol> <p>\u8fd9\u4e2a\u8fc7\u7a0b\u7684\u6838\u5fc3\u5728\u4e8e\u6a21\u578b\u8d1f\u8d23\u51b3\u7b56\u548c\u89c4\u5212\uff0c\u800c\u5e94\u7528\u8d1f\u8d23\u4fe1\u4efb\u6267\u884c\u548c\u5b89\u5168\u4fdd\u969c\uff0c\u4e24\u8005\u901a\u8fc7\u7ed3\u6784\u5316\u6570\u636e\u7d27\u5bc6\u534f\u4f5c\u3002</p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%E5%8E%9F%E7%90%86%E5%92%8C%E5%AE%9E%E8%B7%B5/#_4","title":"\u5b9e\u73b0\u5de5\u5177\u8c03\u7528\u7684\u5173\u952e\u6280\u672f","text":""},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%E5%8E%9F%E7%90%86%E5%92%8C%E5%AE%9E%E8%B7%B5/#1-prompt-engineeringcot","title":"1. \u63d0\u793a\u5de5\u7a0b\uff08Prompt Engineering\uff09\u4e0e\u601d\u7ef4\u94fe\uff08CoT\uff09","text":"<p>\u63d0\u793a\u5de5\u7a0b\u662f\u6700\u57fa\u7840\u7684\u65b9\u6cd5\uff0c\u901a\u8fc7\u7cbe\u5fc3\u8bbe\u8ba1\u7684\u63d0\u793a\u8bcd\u6765\u5f15\u5bfc\u6a21\u578b\u3002</p> <p>\u6b65\u9aa4\uff1a  1. \u7cfb\u7edf\u63d0\u793a\u8bcd\uff08System Prompt\uff09\uff1a \u5728\u5bf9\u8bdd\u5f00\u59cb\u65f6\uff0c\u7ed9\u6a21\u578b\u4e00\u4e2a\u660e\u786e\u7684\u6307\u4ee4\uff0c\u5b9a\u4e49\u5b83\u53ef\u4ee5\u4f7f\u7528\u7684\u5de5\u5177\u5217\u8868\u3001\u6bcf\u4e2a\u5de5\u5177\u7684\u529f\u80fd\u3001\u8f93\u5165\u53c2\u6570\u683c\u5f0f\u4ee5\u53ca\u8f93\u51fa\u683c\u5f0f\u3002  2. \u7528\u6237\u8bf7\u6c42\uff08User Query\uff09\uff1a \u7528\u6237\u63d0\u51fa\u81ea\u7136\u8bed\u8a00\u8bf7\u6c42\u3002  3. \u6a21\u578b\u54cd\u5e94\uff08Model Response\uff09\uff1a \u6a21\u578b\u6839\u636e\u63d0\u793a\u8bcd\uff0c\u751f\u6210\u4e00\u4e2a\u7ed3\u6784\u5316\u7684\u54cd\u5e94\uff08\u5982JSON\u683c\u5f0f\uff09\uff0c\u6307\u660e\u8981\u8c03\u7528\u54ea\u4e2a\u5de5\u5177\u4ee5\u53ca\u53c2\u6570\u662f\u4ec0\u4e48\u3002  4. \u5916\u90e8\u6267\u884c\uff1a \u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\u89e3\u6790\u6a21\u578b\u7684\u54cd\u5e94\uff0c\u8c03\u7528\u76f8\u5e94\u7684API\u6216\u51fd\u6570\u3002  5. \u7ed3\u679c\u8fd4\u56de\uff1a \u5c06API\u8fd4\u56de\u7684\u7ed3\u679c\u518d\u6b21\u63d0\u4f9b\u7ed9\u6a21\u578b\uff0c\u8ba9\u6a21\u578b\u751f\u6210\u6700\u7ec8\u7684\u7528\u6237\u56de\u590d\u3002</p> <p>\u793a\u4f8b\u63d0\u793a\u8bcd\uff1a</p> <pre><code>\u4f60\u662f\u4e00\u4e2a\u6709\u5e2e\u52a9\u7684AI\u52a9\u624b\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u5de5\u5177\u6765\u5e2e\u52a9\u7528\u6237\uff1a\n- get_current_weather(location: string): \u83b7\u53d6\u6307\u5b9a\u57ce\u5e02\u7684\u5f53\u524d\u5929\u6c14\u3002\n- send_email(to: string, subject: string, body: string): \u53d1\u9001\u7535\u5b50\u90ae\u4ef6\u3002\n\n\u8bf7\u6839\u636e\u7528\u6237\u8bf7\u6c42\uff0c\u51b3\u5b9a\u662f\u5426\u9700\u8981\u8c03\u7528\u5de5\u5177\u3002\u5982\u679c\u9700\u8981\uff0c\u8bf7\u4e25\u683c\u6309\u7167\u4ee5\u4e0bJSON\u683c\u5f0f\u56de\u590d\uff1a\n{\"tool\": \"tool_name\", \"parameters\": {\"arg1\": \"value1\", \"arg2\": \"value2\"}}\n\n\u5982\u679c\u4e0d\u9700\u8981\u8c03\u7528\u5de5\u5177\uff0c\u8bf7\u76f4\u63a5\u56de\u590d\u7528\u6237\u3002\n\n\u7528\u6237\u8bf7\u6c42\uff1a&lt;\u7528\u6237\u7684\u8f93\u5165&gt;\n</code></pre> <p>\u5bf9\u4e8e\u4e0d\u652f\u6301\u51fd\u6570\u8c03\u7528\u7684\u6a21\u578b\u53ef\u4ee5\u5c1d\u8bd5\u4f7f\u7528\u63d0\u793a\u5de5\u7a0b\u5b9e\u73b0\u5de5\u5177\u8c03\u7528\uff0c\u4f46\u662f\u4f7f\u7528\u63d0\u793a\u5de5\u7a0b\u6709\u5982\u4e0b\u7f3a\u70b9\uff1a</p> <ul> <li>\u63d0\u793a\u8bcd\u957f\u5ea6\u9650\u5236\uff1a\u5982\u679c\u51fd\u6570\u6570\u91cf\u975e\u5e38\u591a\u3001\u63cf\u8ff0\u975e\u5e38\u590d\u6742\uff0c\u53ef\u80fd\u4f1a\u5360\u7528\u5927\u91cf Token\uff0c\u751a\u81f3\u8d85\u51fa\u6a21\u578b\u7684\u4e0a\u4e0b\u6587\u7a97\u53e3\u3002</li> <li>\u53ef\u9760\u6027\u95ee\u9898\uff1a\u6a21\u578b\u7684\u8f93\u51fa\u53ef\u80fd\u5b58\u5728\u683c\u5f0f\u9519\u8bef\u6216\u504f\u5dee\uff0c\u9700\u8981\u5f3a\u5927\u7684\u540e\u5904\u7406\uff08\u89e3\u6790\u3001\u91cd\u8bd5\uff09\u903b\u8f91\u6765\u4fdd\u8bc1\u7a33\u5b9a\u6027\u3002</li> <li>\u4f9d\u8d56\u57fa\u7840\u6a21\u578b\u80fd\u529b\uff1a\u5982\u679c\u57fa\u7840\u6a21\u578b\u672c\u8eab\u903b\u8f91\u6216\u6307\u4ee4\u9075\u5faa\u80fd\u529b\u4e0d\u5f3a\uff0c\u6548\u679c\u4f1a\u5927\u6253\u6298\u6263\u3002</li> <li>\u6f5c\u5728\u5ef6\u8fdf\uff1a\u590d\u6742\u7684\u63d0\u793a\u8bcd\u53ef\u80fd\u4f1a\u5bfc\u81f4\u66f4\u957f\u7684\u751f\u6210\u65f6\u95f4\u3002</li> </ul>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%E5%8E%9F%E7%90%86%E5%92%8C%E5%AE%9E%E8%B7%B5/#2-function-calling-","title":"2. \u51fd\u6570\u8c03\u7528\uff08Function Calling\uff09 - \u5f53\u524d\u7684\u4e3b\u6d41\u65b9\u5f0f","text":"<p>OpenAI\u3001Qwen\u3001deepeek \u7b49\u4e3b\u6d41\u5382\u5546\u5728\u5176API\u4e2d\u76f4\u63a5\u5185\u7f6e\u4e86\u6b64\u529f\u80fd\uff0c\u6781\u5927\u5730\u7b80\u5316\u4e86\u6d41\u7a0b\u3002</p> <p>\u5de5\u4f5c\u539f\u7406\uff1a   1. \u5b9a\u4e49\u51fd\u6570\uff1a \u5f00\u53d1\u8005\u5411\u6a21\u578b\u7684API\u8c03\u7528\uff08\u5982 <code>ChatCompletions</code>\uff09\u63d0\u4ea4\u4e00\u4e2a\u5217\u8868\uff0c\u5176\u4e2d\u8be6\u7ec6\u63cf\u8ff0\u4e86\u53ef\u7528\u51fd\u6570\u7684\u540d\u79f0\u3001\u63cf\u8ff0\u3001\u53c2\u6570\uff08\u9075\u5faaJSON Schema\u683c\u5f0f\uff09\u3002   2. \u6a21\u578b\u51b3\u7b56\uff1a \u6a21\u578b\u5206\u6790\u7528\u6237\u8f93\u5165\uff0c\u51b3\u5b9a\u662f\u5426\u8c03\u7528\u51fd\u6570\u3002       * \u5982\u679c\u4e0d\u9700\u8981\u8c03\u7528\uff0c\u5219\u6b63\u5e38\u56de\u590d\u3002       * \u5982\u679c\u9700\u8981\u8c03\u7528\uff0c\u5219\u8fd4\u56de\u4e00\u4e2a\u7ed3\u6784\u5316\u7684JSON\u5bf9\u8c61\uff0c\u5176\u4e2d\u5305\u542b\u9700\u8981\u8c03\u7528\u7684\u51fd\u6570\u540d\u548c\u5177\u4f53\u7684\u53c2\u6570\u3002   3. \u6267\u884c\u51fd\u6570\uff1a \u4f60\u7684\u4ee3\u7801\u89e3\u6790\u8fd9\u4e2aJSON\u5bf9\u8c61\uff0c\u5728\u4f60\u7684\u670d\u52a1\u5668\u4e0a\u8c03\u7528\u76f8\u5e94\u7684\u51fd\u6570\u3002   4. \u63d0\u4ea4\u7ed3\u679c\uff1a \u4f60\u5c06\u51fd\u6570\u7684\u6267\u884c\u7ed3\u679c\u518d\u6b21\u63d0\u4ea4\u7ed9\u6a21\u578b\u7684API\uff0c\u6a21\u578b\u4f1a\u6c47\u603b\u7ed3\u679c\u5e76\u751f\u6210\u6700\u7ec8\u7684\u7528\u6237\u56de\u590d\u3002</p> <p>\u4f18\u52bf\uff1a  - \u6807\u51c6\u5316\uff1a \u63d0\u4f9b\u4e86\u6807\u51c6\u7684\u3001\u53ef\u9760\u7684JSON\u8f93\u51fa\uff0c\u65e0\u9700\u4f9d\u8d56\u4e0d\u7a33\u5b9a\u7684\u6a21\u578b\u81ea\u7531\u751f\u6210\u3002  - \u9ad8\u6548\uff1a \u5c06\u201c\u51b3\u7b56\u201d\u548c\u201c\u56de\u590d\u751f\u6210\u201d\u4e24\u6b65\u5206\u5f00\uff0c\u6d41\u7a0b\u66f4\u6e05\u6670\u3002  - \u53ef\u9760\uff1a \u964d\u4f4e\u4e86\u63d0\u793a\u8bcd\u5de5\u7a0b\u7684\u9700\u6c42\u548c\u8f93\u51fa\u89e3\u6790\u7684\u96be\u5ea6\u3002</p> <p>\u56e0\u4e3a\u8fd9\u4e9b\u6a21\u578b\u7ecf\u8fc7\u4e86\u5fae\u8c03\uff0c\u65e2\u80fd\u68c0\u6d4b\u4f55\u65f6\u9700\u8981\u8c03\u7528\u5de5\u5177\uff08\u53d6\u51b3\u4e8e\u7528\u6237\u7684\u8f93\u5165\uff09\uff0c\u53c8\u80fd\u4f7f\u7528\u7b26\u5408\u5de5\u5177\u5b9a\u4e49\u7684 JSON \u8fdb\u884c\u54cd\u5e94\u3002\u51fd\u6570\u8c03\u7528\u80fd\u529b\u662f\u5927\u6a21\u578b\uff08\u5982GPT\uff09\u7684\u4e00\u4e2a\u91cd\u8981\u7279\u6027\uff0c\u5176\u539f\u7406\u5927\u81f4\u5982\u4e0b\uff1a</p> <ul> <li>\u901a\u8fc7\u6307\u4ee4\u5fae\u8c03\uff08instruction tuning\uff09\u548c\u5f3a\u5316\u5b66\u4e60\uff08RLHF\uff09\uff0c\u6a21\u578b\u88ab\u8bad\u7ec3\u6210\u80fd\u591f\u6839\u636e\u7528\u6237\u6307\u4ee4\u751f\u6210\u5de5\u5177\u8c03\u7528\u7684\u683c\u5f0f\u3002</li> <li>\u6a21\u578b\u672c\u8eab\u5e76\u4e0d\u771f\u6b63\u6267\u884c\u51fd\u6570\uff0c\u800c\u662f\u751f\u6210\u4e00\u4e2a\u7b26\u5408\u89c4\u8303\u7684\u5de5\u5177\u8c03\u7528\u8bf7\u6c42\uff0c\u7531\u5916\u90e8\u7cfb\u7edf\u6267\u884c\u3002</li> </ul> <p>\u8bad\u7ec3\u5927\u6a21\u578b\u5177\u6709\u5de5\u5177\u8c03\u7528\u80fd\u529b\u7684\u6570\u636e\u96c6\u53ef\u4ee5\u5230 huggingface \u7684 dataset \u4e2d\u641c\u7d22 <code>function_call</code> \uff0c\u53ef\u4ee5\u770b\u5230\u5f88\u591a\u5f00\u6e90\u7684\u652f\u6301\u51fd\u6570\u8c03\u7528\u7684\u6570\u636e\u96c6\uff0c\u8fd9\u91cc\u4ee5Hermes Function-Calling V1\u4e3a\u4f8b\uff0c\u67e5\u770b\u4e00\u6761\u5355\u8f6e\u5bf9\u8bdd\u7684\u5de5\u5177\u8c03\u7528\u8bad\u7ec3\u6570\u636e\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>[\n  {\n    \"from\": \"system\",\n    \"value\": \"You are a function calling AI model. You are provided with function signatures within &lt;tools&gt; &lt;/tools&gt; XML tags. You may call one or more functions to assist with the user query. Don't make assumptions about what values to plug into functions.\\n&lt;tools&gt;\\n[{'type': 'function', 'function': {'name': 'get_camera_live_feed', 'description': 'Retrieves the live feed from a specified security camera.', 'parameters': {'type': 'object', 'properties': {'camera_id': {'type': 'string', 'description': 'The unique identifier for the camera.'}, 'stream_quality': {'type': 'string', 'description': 'The desired quality of the live stream.', 'enum': ['720p', '1080p', '4k']}}, 'required': ['camera_id']}}}, {'type': 'function', 'function': {'name': 'list_all_cameras', 'description': 'Lists all the security cameras connected to the home network.', 'parameters': {'type': 'object', 'properties': {'include_offline': {'type': 'boolean', 'description': 'Whether to include cameras that are currently offline.', 'default': False}}, 'required': []}}}, {'type': 'function', 'function': {'name': 'record_camera_feed', 'description': 'Starts recording the live feed from a specified security camera.', 'parameters': {'type': 'object', 'properties': {'camera_id': {'type': 'string', 'description': 'The unique identifier for the camera.'}, 'duration': {'type': 'integer', 'description': 'The duration in minutes for which to record the feed.', 'default': 60}}, 'required': ['camera_id']}}}, {'type': 'function', 'function': {'name': 'get_recorded_feed', 'description': 'Retrieves a previously recorded feed from a specified security camera.', 'parameters': {'type': 'object', 'properties': {'camera_id': {'type': 'string', 'description': 'The unique identifier for the camera.'}, 'start_time': {'type': 'string', 'description': 'The start time of the recording to retrieve, in ISO 8601 format.'}, 'end_time': {'type': 'string', 'description': 'The end time of the recording to retrieve, in ISO 8601 format.'}}, 'required': ['camera_id', 'start_time', 'end_time']}}}, {'type': 'function', 'function': {'name': 'pan_tilt_camera', 'description': 'Controls the pan and tilt functions of a PTZ (Pan-Tilt-Zoom) security camera.', 'parameters': {'type': 'object', 'properties': {'camera_id': {'type': 'string', 'description': 'The unique identifier for the PTZ camera.'}, 'pan_angle': {'type': 'integer', 'description': 'The angle in degrees to pan the camera. Positive values pan right, negative values pan left.'}, 'tilt_angle': {'type': 'integer', 'description': 'The angle in degrees to tilt the camera. Positive values tilt up, negative values tilt down.'}}, 'required': ['camera_id', 'pan_angle', 'tilt_angle']}}}]\\n&lt;/tools&gt;\\nFor each function call return a json object with function name and arguments within &lt;tool_call&gt; &lt;/tool_call&gt; tags with the following schema:\\n&lt;tool_call&gt;\\n{'arguments': &lt;args-dict&gt;, 'name': &lt;function-name&gt;}\\n&lt;/tool_call&gt;\\n\"\n  },\n  {\n    \"from\": \"human\",\n    \"value\": \"I've recently installed a new security system at my home, and I want to ensure everything is functioning as it should. Specifically, I'd like to start by checking the live feed from the camera located at the front door to monitor any activity. The camera has a unique identifier, which I've already configured to be \\\"front_door.\\\" I'd prefer to view the live stream in high definition, so a 1080p quality would be ideal. Could you please call the appropriate function to retrieve the live feed from my front door camera in 1080p quality and provide me with the link to the stream?\\n\\nFollowing this, I would also like to record the live feed from this camera for the next 30 minutes. This is to test the recording feature and to keep an archived copy for security purposes. Please initiate the recording function for the \\\"front_door\\\" camera with a recording duration of 30 minutes.\\n\\nLastly, as part of my routine surveillance checks, I need to review footage from yesterday between 3 PM and 5 PM. The camera \\\"front_garden\\\" should have the recording for that period. I need to retrieve this specific recorded feed. The start time for the recording was at 15:00 on April 22, 2023, and it ended at 17:00 on the same day.\\n\\nTo summarize, I request the execution of the following functions with the provided details:\\n1. Retrieve the live feed from the \\\"front_door\\\" camera at 1080p quality.\\n2. Start a 30-minute recording of the live feed from the \\\"front_door\\\" camera.\\n3. Retrieve the recorded feed from the \\\"front_garden\\\" camera, focusing on the time period between 15:00 and 17:00 on April 22, 2023.\\n\\nThank you for assisting with the management of my home security camera feeds.\"\n  },\n  {\n    \"from\": \"gpt\",\n    \"value\": \"&lt;tool_call&gt;\\n{'arguments': {'camera_id': 'front_door', 'stream_quality': '1080p'}, 'name': 'get_camera_live_feed'}\\n&lt;/tool_call&gt;\\n&lt;tool_call&gt;\\n{'arguments': {'camera_id': 'front_door', 'duration': 30}, 'name': 'record_camera_feed'}\\n&lt;/tool_call&gt;\\n&lt;tool_call&gt;\\n{'arguments': {'camera_id': 'front_garden', 'start_time': '2023-04-22T15:00:00Z', 'end_time': '2023-04-22T17:00:00Z'}, 'name': 'get_recorded_feed'}\\n&lt;/tool_call&gt;\\n\"\n  }\n]\n</code></pre> <p>\u8fd9\u4e2a\u8bad\u7ec3\u6570\u636e\u7684\u7ed3\u6784\u662f\u4e00\u4e2aJSON\u6570\u7ec4\uff0c\u5305\u542b\u4e09\u4e2a\u5bf9\u8c61\uff0c\u5206\u522b\u5bf9\u5e94\u7cfb\u7edf\u63d0\u793a\u3001\u7528\u6237\u8f93\u5165\u548c\u6a21\u578b\u8f93\u51fa\u3002\u6bcf\u4e2a\u5bf9\u8c61\u90fd\u6709from\u548cvalue\u5b57\u6bb5\u3002\u7cfb\u7edf\u63d0\u793a\u91cc\u8be6\u7ec6\u5217\u51fa\u4e86\u53ef\u7528\u7684\u51fd\u6570\u53ca\u5176\u53c2\u6570\uff0c\u7528\u6237\u8f93\u5165\u662f\u4e00\u4e2a\u5177\u4f53\u7684\u8bf7\u6c42\uff0c\u8981\u6c42\u6267\u884c\u4e09\u4e2a\u51fd\u6570\u8c03\u7528\uff0c\u800c\u6a21\u578b\u8f93\u51fa\u5219\u662f\u4e09\u4e2a\u51fd\u6570\u8c03\u7528\u7684JSON\u7ed3\u6784\u3002</p> <p>\u51fd\u6570\u8c03\u7528\u80fd\u529b\u7684\u8bad\u7ec3\u901a\u5e38\u9700\u8981\u6a21\u578b\u5b66\u4f1a\u8bc6\u522b\u4f55\u65f6\u9700\u8981\u8c03\u7528\u51fd\u6570\uff0c\u5e76\u6b63\u786e\u751f\u6210\u5bf9\u5e94\u7684\u51fd\u6570\u540d\u548c\u53c2\u6570\u3002\u7528\u6237\u7684\u6570\u636e\u4e2d\uff0c\u7cfb\u7edf\u63d0\u793a\u90e8\u5206\u5df2\u7ecf\u660e\u786e\u63d0\u4f9b\u4e86\u51fd\u6570\u5217\u8868\uff0c\u8fd9\u53ef\u80fd\u5e2e\u52a9\u6a21\u578b\u5728\u8bad\u7ec3\u65f6\u7406\u89e3\u53ef\u7528\u7684\u5de5\u5177\u3002\u7528\u6237\u8f93\u5165\u4e2d\u7684\u8be6\u7ec6\u63cf\u8ff0\u548c\u660e\u786e\u7684\u6b65\u9aa4\u8981\u6c42\uff08\u5982\u4e09\u4e2a\u5177\u4f53\u4efb\u52a1\uff09\u6709\u52a9\u4e8e\u6a21\u578b\u5b66\u4e60\u5982\u4f55\u5c06\u81ea\u7136\u8bed\u8a00\u6307\u4ee4\u6620\u5c04\u5230\u5177\u4f53\u7684\u51fd\u6570\u8c03\u7528\u3002</p> <p>\u6a21\u578b\u8f93\u51fa\u4e2d\u7684\u6bcf\u4e2a\u51fd\u6570\u8c03\u7528\u90fd\u4f7f\u7528\u4e86\u81ea\u5b9a\u4e49\u7684XML\u6807\u7b7e\uff08\u5982\u548c\uff09\uff0c\u5e76\u4ee5JSON\u683c\u5f0f\u8868\u793a\u51fd\u6570\u540d\u548c\u53c2\u6570\u3002\u8fd9\u79cd\u7ed3\u6784\u5316\u7684\u8f93\u51fa\u6709\u52a9\u4e8e\u8bad\u7ec3\u6a21\u578b\u751f\u6210\u51c6\u786e\u7684\u51fd\u6570\u8c03\u7528\uff0c\u5c24\u5176\u662f\u5728\u76d1\u7763\u5b66\u4e60\u9636\u6bb5\uff0c\u6a21\u578b\u53ef\u4ee5\u5b66\u4e60\u5230\u6b63\u786e\u7684\u683c\u5f0f\u548c\u53c2\u6570\u7ec4\u5408\u3002</p> <p>\u5173\u4e8e\u5982\u4f55\u8bad\u7ec3\u6a21\u578b\u5177\u6709\u5de5\u5177\u8c03\u7528\u80fd\u529b\u540e\u7eed\u4f1a\u5199\u4e00\u7bc7\u6587\u7ae0\u8be6\u7ec6\u4ecb\u7ecd\uff0c\u8bf7\u7ee7\u7eed\u5173\u6ce8 </p> <p>\u5982\u4f55\u5224\u65ad\u4e00\u4e2a\u5f00\u6e90\u6a21\u578b\u662f\u5426\u652f\u6301\u51fd\u6570\u8c03\u7528  \u9664\u4e86\u67e5\u770b\u6a21\u578b\u7684\u5b98\u65b9\u4ecb\u7ecd\u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7\u67e5\u770b\u6a21\u578b\u6587\u4ef6<code>tokenizer_config.json</code>\u4e2d\u7684<code>chat_template</code>\u5b57\u6bb5\u7684\u5185\u5bb9\uff0c\u5982\u679c<code>chat_template</code>\u5b57\u6bb5\u5185\u5bb9\u4e2d\u6709tool\u76f8\u5173\u63cf\u8ff0\uff0c\u5219\u8868\u793a\u8be5\u6a21\u578b\u652f\u6301\u51fd\u6570\u8c03\u7528\u3002\u4e0b\u9762\u4ee5deepseek\u7684\u6a21\u578b\u4e3e\u4f8b\uff0c\u67e5\u770btokenizer_config.json\u4e2d\u7684<code>chat_template</code>\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>{% if not add_generation_prompt is defined %}{% set add_generation_prompt = false %}{% endif %}{% if not thinking is defined %}{% set thinking = false %}{% endif %}{% set ns = namespace(is_first=false, is_tool=false, system_prompt='', is_first_sp=true, is_last_user=false) %}{%- for message in messages %}{%- if message['role'] == 'system' %}{%- if ns.is_first_sp %}{% set ns.system_prompt = ns.system_prompt + message['content'] %}{% set ns.is_first_sp = false %}{%- else %}{% set ns.system_prompt = ns.system_prompt + '\n\n' + message['content'] %}{%- endif %}{%- endif %}{%- endfor %}{{ bos_token }}{{ ns.system_prompt }}{%- for message in messages %}{%- if message['role'] == 'user' %}{%- set ns.is_tool = false -%}{%- set ns.is_first = false -%}{%- set ns.is_last_user = true -%}{{'&lt;\uff5cUser\uff5c&gt;' + message['content']}}{%- endif %}{%- if message['role'] == 'assistant' and message['tool_calls'] is defined and message['tool_calls'] is not none %}{%- if ns.is_last_user %}{{'&lt;\uff5cAssistant\uff5c&gt;&lt;/think&gt;'}}{%- endif %}{%- set ns.is_last_user = false -%}{%- set ns.is_first = false %}{%- set ns.is_tool = false -%}{%- for tool in message['tool_calls'] %}{%- if not ns.is_first %}{%- if message['content'] is none %}{{'&lt;\uff5ctool\u2581calls\u2581begin\uff5c&gt;&lt;\uff5ctool\u2581call\u2581begin\uff5c&gt;'+ tool['function']['name'] + '&lt;\uff5ctool\u2581sep\uff5c&gt;' + tool['function']['arguments'] + '&lt;\uff5ctool\u2581call\u2581end\uff5c&gt;'}}{%- else %}{{message['content'] + '&lt;\uff5ctool\u2581calls\u2581begin\uff5c&gt;&lt;\uff5ctool\u2581call\u2581begin\uff5c&gt;' + tool['function']['name'] + '&lt;\uff5ctool\u2581sep\uff5c&gt;' + tool['function']['arguments'] + '&lt;\uff5ctool\u2581call\u2581end\uff5c&gt;'}}{%- endif %}{%- set ns.is_first = true -%}{%- else %}{{'&lt;\uff5ctool\u2581call\u2581begin\uff5c&gt;'+ tool['function']['name'] + '&lt;\uff5ctool\u2581sep\uff5c&gt;' + tool['function']['arguments'] + '&lt;\uff5ctool\u2581call\u2581end\uff5c&gt;'}}{%- endif %}{%- endfor %}{{'&lt;\uff5ctool\u2581calls\u2581end\uff5c&gt;&lt;\uff5cend\u2581of\u2581sentence\uff5c&gt;'}}{%- endif %}{%- if message['role'] == 'assistant' and (message['tool_calls'] is not defined or message['tool_calls'] is none) %}{%- if ns.is_last_user %}{{'&lt;\uff5cAssistant\uff5c&gt;'}}{%- if message['prefix'] is defined and message['prefix'] and thinking %}{{'&lt;think&gt;'}}  {%- else %}{{'&lt;/think&gt;'}}{%- endif %}{%- endif %}{%- set ns.is_last_user = false -%}{%- if ns.is_tool %}{{message['content'] + '&lt;\uff5cend\u2581of\u2581sentence\uff5c&gt;'}}{%- set ns.is_tool = false -%}{%- else %}{%- set content = message['content'] -%}{%- if '&lt;/think&gt;' in content %}{%- set content = content.split('&lt;/think&gt;', 1)[1] -%}{%- endif %}{{content + '&lt;\uff5cend\u2581of\u2581sentence\uff5c&gt;'}}{%- endif %}{%- endif %}{%- if message['role'] == 'tool' %}{%- set ns.is_last_user = false -%}{%- set ns.is_tool = true -%}{{'&lt;\uff5ctool\u2581output\u2581begin\uff5c&gt;' + message['content'] + '&lt;\uff5ctool\u2581output\u2581end\uff5c&gt;'}}{%- endif %}{%- endfor -%}{%- if add_generation_prompt and ns.is_last_user and not ns.is_tool %}{{'&lt;\uff5cAssistant\uff5c&gt;'}}{%- if not thinking %}{{'&lt;/think&gt;'}}{%- else %}{{'&lt;think&gt;'}}{%- endif %}{% endif %}\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%E5%8E%9F%E7%90%86%E5%92%8C%E5%AE%9E%E8%B7%B5/#_5","title":"\u5de5\u5177\u8c03\u7528\u5b9a\u4e49","text":"<p>\u53c2\u8003openai\u7684\u5de5\u5177\u8c03\u7528\u63a5\u53e3\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u5de5\u5177\uff08tool\uff09\u7684\u5b9a\u4e49\uff0c\u5b83\u662f\u4e00\u4e2a JSON \u5bf9\u8c61\uff0c\u5305\u542b\u4e0b\u9762\u7684\u5b57\u6bb5\uff1a</p> <ol> <li>type\uff1a\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u6307\u5b9a\u5de5\u5177\u7684\u7c7b\u578b\uff0c\u76ee\u524d\u4ec5\u652f\u6301 <code>\"function\"</code>\u3002</li> <li>name\uff1a\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u8868\u793a\u51fd\u6570\u7684\u540d\u79f0\u3002</li> <li>description\uff1a\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u63cf\u8ff0\u51fd\u6570\u7684\u7528\u9014\u3002</li> <li>parameters\uff1a\u4e00\u4e2a JSON Schema\uff0c\u5b9a\u4e49\u51fd\u6570\u63a5\u53d7\u7684\u53c2\u6570\u3002\u5177\u4f53\u7f16\u5199\u65b9\u6cd5\u53ef\u53c2\u8003\u76f8\u5173\u6587\u6863\u3002\u9700\u8981\u6ce8\u610f\u7684\u5b57\u6bb5\u5305\u62ec\uff1a<ul> <li>type\uff1a\u53c2\u6570\u7684\u6570\u636e\u7c7b\u578b\uff08\u5982 <code>string</code>\u3001<code>integer</code> \u7b49\uff09\u3002</li> <li>description\uff1a\u53c2\u6570\u63cf\u8ff0</li> <li>required\uff1a\u5fc5\u586b\u53c2\u6570\u5217\u8868\u3002</li> <li>enum\uff1a\u679a\u4e3e\u503c\uff08\u7528\u4e8e\u9650\u5b9a\u53c2\u6570\u7684\u53d6\u503c\u8303\u56f4\uff09\u3002</li> </ul> </li> </ol> <p>\u4e0b\u9762\u662fget_weather\u51fd\u6570\u7684\u5de5\u5177\u8c03\u7528\u5b9a\u4e49\u793a\u4f8b\uff1a</p> <pre><code>{\n    \"type\": \"function\",\n    \"name\": \"get_weather\",\n    \"description\": \"Retrieves current weather for the given location.\",\n    \"parameters\": {\n        \"type\": \"object\",\n        \"properties\": {\n            \"location\": {\n                \"type\": \"string\",\n                \"description\": \"City and country e.g. Bogot\u00e1, Colombia\"\n            },\n            \"units\": {\n                \"type\": \"string\",\n                \"enum\": [\"celsius\", \"fahrenheit\"],\n                \"description\": \"Units the temperature will be returned in.\"\n            }\n        },\n        \"required\": [\"location\", \"units\"],\n        \"additionalProperties\": false\n    },\n    \"strict\": true\n}\n</code></pre> <p>\u5b9a\u4e49\u51fd\u6570\u7684\u6700\u4f73\u5b9e\u8df5 </p> <ol> <li>\u7f16\u5199\u6e05\u6670\u8be6\u7ec6\u7684\u51fd\u6570\u540d\u79f0\u3001\u53c2\u6570\u63cf\u8ff0\u548c\u8bf4\u660e <ul> <li>\u660e\u786e\u63cf\u8ff0\u51fd\u6570\u7684\u7528\u9014\u3001\u6bcf\u4e2a\u53c2\u6570\uff08\u53ca\u5176\u683c\u5f0f\uff09\u4ee5\u53ca\u8f93\u51fa\u7684\u542b\u4e49</li> <li>\u4f7f\u7528\u7cfb\u7edf\u63d0\u793a\u63cf\u8ff0\u4f55\u65f6\uff08\u53ca\u4f55\u65f6\u4e0d\uff09\u4f7f\u7528\u6bcf\u4e2a\u51fd\u6570\uff0c\u901a\u5e38\u9700\u8981\u660e\u786e\u544a\u77e5\u6a21\u578b\u5177\u4f53\u64cd\u4f5c\u65b9\u5f0f</li> <li>\u5305\u542b\u793a\u4f8b\u548c\u8fb9\u754c\u60c5\u51b5\uff0c\u7279\u522b\u662f\u7ea0\u6b63\u91cd\u590d\u51fa\u73b0\u7684\u9519\u8bef\uff08\u6ce8\u610f\uff1a\u6dfb\u52a0\u793a\u4f8b\u53ef\u80fd\u5f71\u54cd\u63a8\u7406\u6a21\u578b\u7684\u6027\u80fd\uff09</li> </ul> </li> <li>\u5e94\u7528\u8f6f\u4ef6\u5de5\u7a0b\u6700\u4f73\u5b9e\u8df5 <ul> <li>\u4fdd\u6301\u51fd\u6570\u7684\u76f4\u89c2\u6027\u548c\u6613\u7528\u6027\uff08\u9075\u5faa\u6700\u5c0f\u610f\u5916\u539f\u5219\uff09</li> <li>\u4f7f\u7528\u679a\u4e3e\u548c\u5bf9\u8c61\u7ed3\u6784\u907f\u514d\u65e0\u6548\u72b6\u6001\uff08\u4f8b\u5982\uff1atoggle_light(on: bool, off: bool)\u53ef\u80fd\u5bfc\u81f4\u65e0\u6548\u8c03\u7528\uff09</li> <li>\u901a\u8fc7\u5185\u90e8\u6d4b\u8bd5\uff1a\u5982\u679c\u4ec5\u51ed\u63d0\u4f9b\u7ed9\u6a21\u578b\u7684\u4fe1\u606f\uff0c\u65b0\u624b/\u4eba\u7c7b\u662f\u5426\u80fd\u6b63\u786e\u4f7f\u7528\u51fd\u6570\uff1f\uff08\u5982\u679c\u4e0d\u80fd\uff0c\u4ed6\u4eec\u4f1a\u63d0\u51fa\u4ec0\u4e48\u95ee\u9898\uff1f\u5c06\u7b54\u6848\u6dfb\u52a0\u5230\u63d0\u793a\u4e2d\uff09</li> </ul> </li> <li>\u51cf\u8f7b\u6a21\u578b\u8d1f\u62c5\uff0c\u5c3d\u53ef\u80fd\u4f7f\u7528\u4ee3\u7801\u5904\u7406 <ul> <li>\u907f\u514d\u8ba9\u6a21\u578b\u586b\u5199\u5df2\u77e5\u53c2\u6570\uff08\u4f8b\u5982\uff1a\u5982\u679c\u5df2\u901a\u8fc7\u5148\u524d\u83dc\u5355\u83b7\u53d6order_id\uff0c\u5219\u4e0d\u5e94\u8bbe\u7f6eorder_id\u53c2\u6570\uff0c\u800c\u5e94\u901a\u8fc7\u65e0\u53c2\u6570\u51fd\u6570submit_refund()\u5e76\u901a\u8fc7\u4ee3\u7801\u4f20\u9012order_id\uff09</li> <li>\u5408\u5e76\u603b\u662f\u6309\u987a\u5e8f\u8c03\u7528\u7684\u51fd\u6570\uff08\u4f8b\u5982\uff1a\u5982\u679c\u5728query_location()\u540e\u603b\u662f\u8c03\u7528mark_location()\uff0c\u53ea\u9700\u5c06\u6807\u8bb0\u903b\u8f91\u79fb\u81f3\u67e5\u8be2\u51fd\u6570\u4e2d\uff09</li> </ul> </li> <li>\u4fdd\u6301\u51fd\u6570\u6570\u91cf\u8f83\u5c11\u4ee5\u63d0\u9ad8\u51c6\u786e\u6027 <ul> <li>\u8bc4\u4f30\u4e0d\u540c\u51fd\u6570\u6570\u91cf\u4e0b\u7684\u6027\u80fd</li> <li>\u5efa\u8bae\u540c\u65f6\u4f7f\u7528\u7684\u51fd\u6570\u6570\u91cf\u5c11\u4e8e20\u4e2a\uff08\u6b64\u4e3a\u8f6f\u6027\u5efa\u8bae\uff09</li> </ul> </li> </ol> <p>token\u4f7f\u7528 \u5728\u5e95\u5c42\uff0c\u5de5\u5177\u8c03\u7528\u5b9a\u4e49\u4f1a\u4ee5\u6a21\u578b\u8bad\u7ec3\u8fc7\u7684\u8bed\u6cd5\u6ce8\u5165\u7cfb\u7edf\u6d88\u606f\u4e2d\uff0c\u8fd9\u610f\u5473\u7740\u5de5\u5177\u8c03\u7528\u5b9a\u4e49\u4f1a\u8ba1\u5165\u6a21\u578b\u7684\u4e0a\u4e0b\u6587\u9650\u5236\uff0c\u5e76\u4f5c\u4e3a\u8f93\u5165token\u8ba1\u8d39\u3002\u5982\u679c\u9047\u5230token\u9650\u5236\uff0c\u5efa\u8bae\u9650\u5236\u51fd\u6570\u6570\u91cf\u6216\u7f29\u77ed\u51fd\u6570\u53c2\u6570\u63cf\u8ff0\u7684\u957f\u5ea6\u3002</p> <p>\u5982\u679c\u5728\u5de5\u5177\u89c4\u8303\u4e2d\u5b9a\u4e49\u4e86\u591a\u4e2a\u51fd\u6570\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5fae\u8c03\u51cf\u5c11\u4f7f\u7528\u7684token\u6570\u91cf\u3002</p> <p>\u603b\u7ed3 \u524d\u9762\u8be6\u7ec6\u4ecb\u7ecd\u4e86\u5728API\u8bf7\u6c42\u4e2d\u5b9a\u4e49\u51fd\u6570\u7684\u89c4\u8303\u4e0e\u6700\u4f73\u5b9e\u8df5\uff0c\u6838\u5fc3\u8981\u70b9\u5305\u62ec\uff1a  </p> <ol> <li>\u51fd\u6570\u901a\u8fc7JSON\u6a21\u5f0f\u5b9a\u4e49\uff0c\u9700\u660e\u786e\u6307\u5b9a\u7c7b\u578b\u3001\u540d\u79f0\u3001\u63cf\u8ff0\u3001\u53c2\u6570  </li> <li>\u5f3a\u8c03\u901a\u8fc7\u6e05\u6670\u63cf\u8ff0\u3001\u8f6f\u4ef6\u5de5\u7a0b\u539f\u5219\u548c\u4ee3\u7801\u8f85\u52a9\u6765\u4f18\u5316\u51fd\u6570\u8bbe\u8ba1  </li> <li>\u5efa\u8bae\u63a7\u5236\u51fd\u6570\u6570\u91cf\uff08&lt;20\u4e2a\uff09</li> <li>\u51fd\u6570\u5b9a\u4e49\u4f1a\u6d88\u8017\u4e0a\u4e0b\u6587token\uff0c\u5efa\u8bae\u901a\u8fc7\u7cbe\u7b80\u63cf\u8ff0\u6216\u5fae\u8c03\u6765\u63a7\u5236token\u7528\u91cf</li> </ol> <p>\u5173\u952e\u5b9e\u8df5\u5efa\u8bae\uff1a\u91c7\u7528\u76f4\u89c2\u547d\u540d\u3001\u89c4\u907f\u65e0\u6548\u72b6\u6001\u3001\u5408\u5e76\u4e32\u8054\u64cd\u4f5c\u3001\u4f18\u5148\u4ee3\u7801\u903b\u8f91\u5904\u7406\u5df2\u77e5\u53c2\u6570\uff0c\u540c\u65f6\u901a\u8fc7\u793a\u4f8b\u8bf4\u660e\u548c\u7cfb\u7edf\u63d0\u793a\u63d0\u5347\u6a21\u578b\u8c03\u7528\u51c6\u786e\u6027\u3002</p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%E5%8E%9F%E7%90%86%E5%92%8C%E5%AE%9E%E8%B7%B5/#_6","title":"\u5de5\u5177\u8c03\u7528\u5b9e\u8df5\u3010\u91cd\u70b9\u3011","text":"<p>\u4ece\u524d\u9762\u5de5\u5177\u8c03\u7528\u5b9a\u4e49\u53ef\u4ee5\u77e5\u9053\uff0c\u6bcf\u4e2a\u5de5\u5177\u8c03\u7528\u5b9a\u4e49\u90fd\u662f\u4e00\u4e2aJSON\u5bf9\u8c61\uff0c\u53ef\u4ee5\u6309\u7167\u5de5\u5177\u8c03\u7528\u5b9a\u4e49\u89c4\u5b9a\u7684\u683c\u5f0f\u624b\u52a8\u7f16\u5199\u8fd9\u4e2aJSON\u5bf9\u8c61\uff0c\u4f46\u662f\u624b\u52a8\u5b9a\u4e49\u975e\u5e38\u7e41\u7410\uff0c\u6709\u6ca1\u6709\u5de5\u5177\u53ef\u4ee5\u81ea\u52a8\u751f\u6210\u5de5\u5177\u8c03\u7528\u7684\u5b9a\u4e49\u5462\uff1f</p> <p>\u63a5\u4e0b\u6765\u5c06\u4ecb\u7ecd\u4e00\u4e0b\u4f7f\u7528 langchain \u63d0\u4f9b\u7684\u5de5\u5177\u5b9e\u73b0\u5de5\u5177\u8c03\u7528\u7684\u5b9a\u4e49\u3002</p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%E5%8E%9F%E7%90%86%E5%92%8C%E5%AE%9E%E8%B7%B5/#langchain","title":"\u4f7f\u7528 LangChain \u5b9a\u4e49\u5de5\u5177","text":"<p>\u5728langchain\u4e2d\u53ef\u4ee5\u4f7f\u7528<code>@tool</code>\u88c5\u9970\u5668\u521b\u5efa\u5de5\u5177\uff0c\u8be5\u88c5\u9970\u5668\u7b80\u5316\u4e86\u5de5\u5177\u521b\u5efa\u8fc7\u7a0b\uff0c\u652f\u6301\u4ee5\u4e0b\u529f\u80fd\uff1a  </p> <ul> <li>\u81ea\u52a8\u63a8\u65ad\u5de5\u5177\u7684\u540d\u79f0\u3001\u63cf\u8ff0\u548c\u9884\u671f\u53c2\u6570\uff0c\u540c\u65f6\u652f\u6301\u81ea\u5b9a\u4e49\u3002  </li> <li>\u901a\u8fc7\u6ce8\u5165\u5de5\u5177\u53c2\u6570\uff0c\u4ece\u6a21\u5f0f\uff08\u4ee5\u53ca\u6a21\u578b\uff09\u4e2d\u9690\u85cf\u8f93\u5165\u53c2\u6570\u3002</li> </ul> <p>\u5de5\u5177\u63a5\u53e3 \u5de5\u5177\u63a5\u53e3\u5728<code>BaseTool</code>\u7c7b\u4e2d\u5b9a\u4e49\uff0c\u8be5\u7c7b\u662f<code>Runnable</code>\u63a5\u53e3\u7684\u5b50\u7c7b\uff0c\u5173\u952e\u5c5e\u6027\u5305\u62ec\uff1a  </p> <ul> <li><code>name</code>\uff1a\u5de5\u5177\u7684\u540d\u79f0\u3002  </li> <li><code>description</code>\uff1a\u5de5\u5177\u529f\u80fd\u7684\u63cf\u8ff0\u3002  </li> <li><code>args</code>\uff1a\u5de5\u5177\u53c2\u6570\u7684JSON\u6a21\u5f0f\u7684\u5c5e\u6027\u3002</li> </ul> <p>\u4e0e\u5de5\u5177\u5173\u8054\u51fd\u6570\u6267\u884c\u7684\u5173\u952e\u65b9\u6cd5\u5305\u62ec\uff1a  </p> <ul> <li><code>invoke</code>\uff1a\u4f7f\u7528\u7ed9\u5b9a\u53c2\u6570\u8c03\u7528\u5de5\u5177\u3002  </li> <li><code>ainvoke</code>\uff1a\u5f02\u6b65\u8c03\u7528\u5de5\u5177\uff08\u7528\u4e8eLangChain\u4e2d\u7684\u5f02\u6b65\u7f16\u7a0b\uff09\u3002</li> </ul>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%E5%8E%9F%E7%90%86%E5%92%8C%E5%AE%9E%E8%B7%B5/#tool","title":"\u4f7f\u7528<code>@tool</code>\u88c5\u9970\u5668\u521b\u5efa\u5de5\u5177","text":"<p>\u63a8\u8350\u4f7f\u7528<code>@tool</code>\u88c5\u9970\u5668\u521b\u5efa\u5de5\u5177\u3002\u8be5\u88c5\u9970\u5668\u65e8\u5728\u7b80\u5316\u5de5\u5177\u521b\u5efa\u8fc7\u7a0b\uff0c\u9002\u7528\u4e8e\u5927\u591a\u6570\u573a\u666f\u3002\u5b9a\u4e49\u51fd\u6570\u540e\uff0c\u53ef\u901a\u8fc7<code>@tool</code>\u88c5\u9970\u5668\u5c06\u5176\u8f6c\u6362\u4e3a\u5b9e\u73b0\u5de5\u5177\u63a5\u53e3\u7684\u5de5\u5177\u3002</p> <pre><code>from langchain_core.tools import tool\n\n\n@tool\ndef get_current_weather(location: str) -&gt; str:\n    \"\"\"\u6a21\u62df\u83b7\u53d6\u5929\u6c14\u7684\u5de5\u5177\"\"\"\n    print(f\"[\u6a21\u62df\u8c03\u7528] \u6b63\u5728\u67e5\u8be2 {location} \u7684\u5929\u6c14...\")\n    return f\"{location}\u7684\u5929\u6c14\u662f\u6674\u6717\u7684\uff0c22\u6444\u6c0f\u5ea6\u3002\"\n\n\n# \u83b7\u53d6\u5de5\u5177\u8c03\u7528\u7684schema\ntool_call_schema = get_current_weather.tool_call_schema.model_json_schema()\n# \u8f93\u51fa\u5de5\u5177\u8c03\u7528\u7684schema\nprint(tool_call_schema)\n</code></pre> <p>\u5728\u51fd\u6570\u524d\u9762\u6dfb\u52a0 <code>@tool</code>\u6ce8\u89e3\u5c31\u53ef\u4ee5\u751f\u6210\u5de5\u5177\u8c03\u7528\u7684\u5b9a\u4e49\uff0c\u8f93\u51fa\u5982\u4e0b\uff1a</p> <pre><code>{\n  \"description\": \"\u6a21\u62df\u83b7\u53d6\u5929\u6c14\u7684\u5de5\u5177\",\n  \"properties\": {\n    \"location\": {\n      \"title\": \"Location\",\n      \"type\": \"string\"\n    }\n  },\n  \"required\": [\n    \"location\"\n  ],\n  \"title\": \"get_current_weather\",\n  \"type\": \"object\"\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u4f7f\u7528<code>@tool</code>\u5b9a\u4e49\u5de5\u5177\u65f6\uff0c\u751f\u6210\u7684\u5de5\u5177\u8c03\u7528\u7684JSON\u5bf9\u8c61\u548c openai \u63a5\u53e3\u5b9a\u4e49\u7684\u5de5\u5177\u5bf9\u8c61\u5b57\u6bb5\u4e0d\u4e00\u6837\u3002</p> <p>\u5982\u679c\u4f60\u7684\u5e94\u7528\u4e3b\u8981\u662f\u4f7f\u7528\u7684langchain\u751f\u6001\uff0c\u90a3\u4e48\u4f7f\u7528langchain\u63d0\u4f9b\u7684<code>@tool</code>\u5b9a\u4e49\u5de5\u5177\u66f4\u52a0\u65b9\u4fbf\u3002</p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%E5%8E%9F%E7%90%86%E5%92%8C%E5%AE%9E%E8%B7%B5/#openai","title":"\u8f6c\u6362\u4e3aOpenAI\u7684\u5de5\u5177\u5b9a\u4e49","text":"<p>\u56e0\u4e3a\u6211\u4eec\u5728\u4f7f\u7528\u7b2c\u4e09\u65b9\u6a21\u578b\u63d0\u4f9b\u7684API\u670d\u52a1\u65f6\uff0c\u8fd9\u4e9b\u670d\u52a1\u57fa\u672c\u90fd\u63d0\u4f9b\u4e86 openai \u63a5\u53e3\u517c\u5bb9\u7684\u8c03\u7528\u65b9\u5f0f\uff0c\u6240\u4ee5\u4e3a\u4e86\u7edf\u4e00\u5de5\u5177\u8c03\u7528\u63a5\u53e3\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u65b9\u5f0f\u5c06\u4e00\u4e2a\u51fd\u6570\u8f6c\u6362\u4e3a openai \u63a5\u53e3\u7684\u5de5\u5177\u5b9a\u4e49\u3002</p> <p>\u5728langchian\u4e2d\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5de5\u5177<code>from langchain_core.utils.function_calling import convert_to_openai_tool</code>\uff0c\u4f7f\u7528<code>convert_to_openai_tool</code>\u53ef\u4ee5\u5c06\u4e00\u4e2a\u51fd\u6570\u8f6c\u6362\u4e3aopenai \u7684\u5de5\u5177\u8c03\u7528\u5b9a\u4e49\uff1a</p> <pre><code>import json\nfrom langchain_core.utils.function_calling import convert_to_openai_tool\n\ndef get_current_weather(location: str) -&gt; str:\n    \"\"\"\u6a21\u62df\u83b7\u53d6\u5929\u6c14\u7684\u5de5\u5177\"\"\"\n    print(f\"[\u6a21\u62df\u8c03\u7528] \u6b63\u5728\u67e5\u8be2 {location} \u7684\u5929\u6c14...\")\n    return f\"{location}\u7684\u5929\u6c14\u662f\u6674\u6717\u7684\uff0c22\u6444\u6c0f\u5ea6\u3002\"\n\n\n\"\"\"\nconvert_to_openai_tool() \u5c06\u7c7b\u5de5\u5177\u5bf9\u8c61\u8f6c\u6362\u4e3a OpenAI \u5de5\u5177\u6a21\u5f0f\u3002\n\nOpenAI \u5de5\u5177\u6a21\u5f0f\u53c2\u8003\uff1a\nhttps://platform.openai.com/docs/api-reference/chat/create#chat-create-tools\n\n\u53c2\u6570\uff1a\n    tool:\n        \u53ef\u4ee5\u662f\u5b57\u5178\u3001pydantic.BaseModel \u7c7b\u3001Python \u51fd\u6570\u6216 BaseTool\u3002\n        \u5982\u679c\u4f20\u5165\u5b57\u5178\uff0c\u5219\u5047\u8bbe\u8be5\u5b57\u5178\u5df2\u7ecf\u662f\u6709\u6548\u7684 OpenAI \u51fd\u6570\u3001\n        \u5305\u542b\u9876\u7ea7 'title' \u952e\u7684 JSON \u6a21\u5f0f\u3001Anthropic \u683c\u5f0f\u5de5\u5177\uff0c\n        \u6216 Amazon Bedrock Converse \u683c\u5f0f\u5de5\u5177\u3002\n    strict:\n        \u5982\u679c\u4e3a True\uff0c\u5219\u6a21\u578b\u8f93\u51fa\u4fdd\u8bc1\u4e0e\u51fd\u6570\u5b9a\u4e49\u4e2d\u63d0\u4f9b\u7684 JSON \u6a21\u5f0f\u5b8c\u5168\u5339\u914d\u3002\n        \u5982\u679c\u4e3a None\uff0c\u5219\u4e0d\u4f1a\u5728\u5de5\u5177\u5b9a\u4e49\u4e2d\u5305\u542b strict \u53c2\u6570\u3002\n\n\u8fd4\u56de\uff1a\n    \u4e0e\u4f20\u5165\u5de5\u5177\u517c\u5bb9\u7684 OpenAI \u5de5\u5177\u8c03\u7528 API \u7684\u5b57\u5178\u7248\u672c\u3002\n\n\"\"\"\nopenai_tool = convert_to_openai_tool(tool=get_current_weather)\n\nresult = json.dumps(openai_tool, ensure_ascii=False, indent=2)\nprint(result)\n</code></pre> <p>\u8f93\u51fa\u7684\u5de5\u5177\u8c03\u7528\u5982\u4e0b\uff1a</p> <pre><code>{\n  \"type\": \"function\",\n  \"function\": {\n    \"name\": \"get_current_weather\",\n    \"description\": \"\u6a21\u62df\u83b7\u53d6\u5929\u6c14\u7684\u5de5\u5177\",\n    \"parameters\": {\n      \"properties\": {\n        \"location\": {\n          \"type\": \"string\"\n        }\n      },\n      \"required\": [\n        \"location\"\n      ],\n      \"type\": \"object\"\n    }\n  }\n}\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%E5%8E%9F%E7%90%86%E5%92%8C%E5%AE%9E%E8%B7%B5/#langchain_1","title":"\u4f7f\u7528 LangChain \u7684\u5b9e\u73b0\u793a\u4f8b","text":"<p>LangChain \u7684\u6838\u5fc3\u62bd\u8c61\u6781\u5927\u5730\u7b80\u5316\u4e86\u5de5\u5177\u8c03\u7528\u7684\u6d41\u7a0b\uff0c\u6211\u4eec\u5c06\u5b9e\u73b0\u4e00\u4e2a\u7b80\u5355\u7684\u5929\u6c14\u67e5\u8be2\u548c\u90ae\u4ef6\u53d1\u9001\u5de5\u5177\u3002</p> <ul> <li>\u7b2c 1 \u6b65\uff1a\u5b9a\u4e49\u5de5\u5177\u51fd\u6570</li> <li>\u7b2c 2 \u6b65\uff1a\u6a21\u578b\u7ed1\u5b9a\u5de5\u5177</li> <li>\u7b2c 3 \u6b65\uff1a\u5411\u6a21\u578b\u53d1\u9001\u7528\u6237\u95ee\u9898</li> <li>\u7b2c 4 \u6b65\uff1a\u89e3\u6790\u6a21\u578b\u54cd\u5e94\u7684\u8f93\u51fa - \u4f7f\u7528\u6a21\u578b\u63d0\u4f9b\u7684\u53c2\u6570\u6267\u884c\u5de5\u5177\u8c03\u7528</li> <li>\u7b2c 5 \u6b65\uff1a\u5411\u6a21\u578b\u53d1\u9001\u5de5\u5177\u8c03\u7528\u7684\u7ed3\u679c\uff0c\u751f\u6210\u6700\u7ec8\u56de\u590d</li> </ul>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%E5%8E%9F%E7%90%86%E5%92%8C%E5%AE%9E%E8%B7%B5/#1","title":"\u6b65\u9aa4 1: \u5b9a\u4e49\u5de5\u5177\u51fd\u6570","text":"<p>\u9996\u5148\uff0c\u6211\u4eec\u5b9a\u4e49\u4e24\u4e2a\u7b80\u5355\u7684\u5de5\u5177\u51fd\u6570\uff08\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u8fd9\u4e9b\u51fd\u6570\u4f1a\u8c03\u7528\u771f\u5b9e\u7684API\uff09\u3002</p> <pre><code># \u5047\u8bbe\u7684\u5de5\u5177\u51fd\u6570\ndef get_current_weather(location: str) -&gt; str:\n    \"\"\"\u6a21\u62df\u83b7\u53d6\u5929\u6c14\u7684\u5de5\u5177\"\"\"\n    print(f\"[\u6a21\u62df\u8c03\u7528] \u6b63\u5728\u67e5\u8be2 {location} \u7684\u5929\u6c14...\")\n    return f\"{location}\u7684\u5929\u6c14\u662f\u6674\u6717\u7684\uff0c22\u6444\u6c0f\u5ea6\u3002\"\n\ndef send_email(to: str, subject: str, body: str) -&gt; str:\n    \"\"\"\u6a21\u62df\u53d1\u9001\u90ae\u4ef6\u7684\u5de5\u5177\"\"\"\n    print(f\"[\u6a21\u62df\u8c03\u7528] \u6b63\u5728\u53d1\u9001\u90ae\u4ef6\u7ed9 {to}...\")\n    print(f\"\u4e3b\u9898: {subject}\")\n    print(f\"\u5185\u5bb9: {body}\")\n    return f\"\u90ae\u4ef6\u5df2\u6210\u529f\u53d1\u9001\u81f3 {to}\u3002\"\n\n# \u521b\u5efa\u5de5\u5177\u5217\u8868\ntools = [get_current_weather, send_email]\n\n# \u5b9a\u4e49\u4e00\u4e2a\u5de5\u5177\u5de5\u5382\uff0c\u540e\u7eed\u901a\u8fc7\u540d\u79f0\u8c03\u7528\u5de5\u5177\ntool_factory = {\n    \"get_current_weather\": get_current_weather,\n    \"send_email\": send_email\n}\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%E5%8E%9F%E7%90%86%E5%92%8C%E5%AE%9E%E8%B7%B5/#2-agent","title":"\u6b65\u9aa4 2: \u6a21\u578b\u7ed1\u5b9a\u5de5\u5177\uff08Agent\uff09","text":"<p>\u6a21\u578b\u7ed1\u5b9a\u5de5\u5177\u65f6\uff0c\u9700\u8981\u9009\u62e9\u652f\u6301\u51fd\u6570/\u5de5\u5177\u8c03\u7528\u7684\u6a21\u578b\u3002\u8fd9\u91cc\u4f7f\u7528<code>langchain_litellm</code>\u8d1f\u8d23\u7406\u89e3\u7528\u6237\u6307\u4ee4\u3001\u9009\u62e9\u5de5\u5177\u3001\u751f\u6210\u8f93\u5165\u53c2\u6570\u3002</p> <pre><code>import os\nfrom langchain_litellm import ChatLiteLLM\nfrom langchain_core.language_models.chat_models import BaseChatModel\n\nmodel_config_dict = {\n    \"deepseek-chat\": {\n        \"model\": \"openai/deepseek-chat\",\n        \"base_url\": \"https://api.deepseek.com/v1\",\n        \"api_key\": os.getenv(\"DEEPSEEK_API_KEY\"),\n    },\n}\n\n# \u4e3a\u4e86\u66f4\u597d\u7684\u652f\u6301\u5176\u4ed6\u6a21\u578b\u548clangchain\u96c6\u6210\uff0c\u8fd9\u91cc\u4f7f\u7528 langchain_litellm \u7684 ChatLiteLLM \u5b9e\u73b0\u6a21\u578b\u8c03\u7528\uff0c\u800c\u4e0d\u662f init_chat_model\n# \u53c2\u8003\uff1ahttps://python.langchain.com/docs/integrations/chat/litellm/\ndef create_llm_chat(model: str = \"deepseek-chat\") -&gt; BaseChatModel:\n    model_config = model_config_dict.get(model)\n\n    llm = ChatLiteLLM(\n        model=model_config.get('model'),\n        api_base=model_config.get('base_url'),\n        api_key=model_config.get('api_key'),\n    )\n    return llm\n\nllm =  create_llm_chat(\"deepseek-chat\")\n# \u5176\u5185\u90e8\u4f7f\u7528 convert_to_openai_tool \u5de5\u5177\u5c06\u51fd\u6570\u8f6c\u6362\u4e3a openai \u7684\u5de5\u5177\u5b9a\u4e49\nagent = llm.bind_tools(tools=tools)\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%E5%8E%9F%E7%90%86%E5%92%8C%E5%AE%9E%E8%B7%B5/#3","title":"\u6b65\u9aa4 3: \u89e3\u6790\u5e76\u8c03\u7528\u5de5\u5177","text":"<p>\u73b0\u5728\uff0c\u6211\u4eec\u53ef\u4ee5\u5411 agent \u63d0\u51fa\u590d\u6742\u7684\u3001\u9700\u8981\u7ec4\u5408\u5de5\u5177\u7684\u8bf7\u6c42\u4e86\u3002\u8fd9\u91cc\u4f7f\u7528<code>langchain</code>\u8d1f\u8d23\u5904\u7406\u6a21\u578b\u9009\u62e9\u7684\u5de5\u5177\u548c\u751f\u6210\u7684\u8f93\u5165\u53c2\u6570\u3001\u6267\u884c\u5de5\u5177\u5e76\u89e3\u6790\u7ed3\u679c\u3002</p> <p>\u5173\u4e8e litellm \u7684\u5de5\u5177\u8c03\u7528\u8bf4\u660e\uff0c\u53c2\u8003\u6587\u6863\uff1ahttps://docs.litellm.ai/docs/completion/function_call</p> <p>\u5173\u4e8e langchian \u7684\u5de5\u5177\u8c03\u7528\u8bf4\u660e\uff0c\u53c2\u8003\u6587\u6863\uff1ahttps://python.langchain.com/docs/how_to/function_calling </p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%E5%8E%9F%E7%90%86%E5%92%8C%E5%AE%9E%E8%B7%B5/#1_1","title":"\u793a\u4f8b 1: \u7b80\u5355\u5de5\u5177\u8c03\u7528","text":"<pre><code># \u793a\u4f8b 1: \u7b80\u5355\u5de5\u5177\u8c03\u7528\nquery = \"\u5317\u4eac\u7684\u5929\u6c14\u600e\u4e48\u6837\uff1f\"\nprint(f'\u793a\u4f8b\u4e00\uff1a{query}')\n# \u8c03\u7528 agent\nresponse = agent.invoke(query)\ntool_calls = response.tool_calls\nprint(f\"\u5de5\u5177\u8c03\u7528\u5217\u8868: {tool_calls}\")\n# \u68c0\u67e5\u662f\u5426\u6709\u5de5\u5177\u8c03\u7528\nif tool_calls:\n    for tool_call in tool_calls:\n        print(f\"\u6267\u884c\u5de5\u5177\u8c03\u7528: {tool_call}\")\n        function_name = tool_call.get(\"name\")\n        function_args = tool_call.get(\"args\")\n\n        function_to_call = tool_factory[function_name]\n        if function_to_call is None:\n            print(f\"\u5de5\u5177 {function_name} \u4e0d\u5b58\u5728\")\n            continue\n        function_response = function_to_call(**function_args)\n\n        print(f\"\u5de5\u5177\u54cd\u5e94: {function_response}\")\n</code></pre> <p>\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>\u793a\u4f8b\u4e00\uff1a\u5317\u4eac\u7684\u5929\u6c14\u600e\u4e48\u6837\uff1f\n\u5de5\u5177\u8c03\u7528\u5217\u8868: [{'name': 'get_current_weather', 'args': {'location': '\u5317\u4eac'}, 'id': 'fc-07ec4672-6865-4f67-a6cb-3971bb17fc3e', 'type': 'tool_call'}]\n\u6267\u884c\u5de5\u5177\u8c03\u7528: {'name': 'get_current_weather', 'args': {'location': '\u5317\u4eac'}, 'id': 'fc-07ec4672-6865-4f67-a6cb-3971bb17fc3e', 'type': 'tool_call'}\n[\u6a21\u62df\u8c03\u7528] \u6b63\u5728\u67e5\u8be2 \u5317\u4eac \u7684\u5929\u6c14...\n\u5de5\u5177\u54cd\u5e94: \u5317\u4eac\u7684\u5929\u6c14\u662f\u6674\u6717\u7684\uff0c22\u6444\u6c0f\u5ea6\u3002\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%E5%8E%9F%E7%90%86%E5%92%8C%E5%AE%9E%E8%B7%B5/#2","title":"\u793a\u4f8b 2: \u9700\u8981\u63a8\u7406\u7684\u5e76\u884c\u5de5\u5177\u8c03\u7528","text":"<p>\u5e76\u884c\u5de5\u5177\u8c03\u7528\u662f\u6a21\u578b\u5728\u4e00\u8f6e\u5bf9\u8bdd\u4e2d\u8fd4\u56de\u591a\u4e2a\u5de5\u5177\u8c03\u7528\uff0c\u5ba2\u6237\u7aef\u80fd\u591f\u540c\u65f6\u6267\u884c\u591a\u4e2a\u51fd\u6570\u8c03\u7528\uff0c\u5141\u8bb8\u5e76\u884c\u89e3\u6790\u8fd9\u4e9b\u51fd\u6570\u8c03\u7528\u7684\u7ed3\u679c</p> <p>\u5e76\u884c\u5de5\u5177\u8c03\u7528\u9700\u8981\u5927\u6a21\u578b\u652f\u6301\uff0c\u5728 openai \u7684\u63a5\u53e3\u4e2d\u901a\u8fc7 <code>parallel_tool_calls</code>\u53c2\u6570\u63a7\u5236\u662f\u5426\u5f00\u542f\u5e76\u884c\u5de5\u5177\u8c03\u7528</p> <p>\u53c2\u8003\u6587\u6863\uff1ahttps://docs.litellm.ai/docs/completion/input </p> <p>\u63a5\u4e0b\u6765\u4ecb\u7ecd\u4e00\u4e0b\u5e76\u884c\u5de5\u5177\u8c03\u7528\uff0c\u95ee\u9898\u5982\u4e0b\uff1a</p> <pre><code>\u7ed9tom@example.com\u53d1\u4e00\u5c01\u90ae\u4ef6\uff0c\u795d\u4ed6\u751f\u65e5\u5feb\u4e50\uff0c\u4e3b\u9898\u5199'\u751f\u65e5\u5feb\u4e50'\uff0c\u540c\u65f6\u67e5\u4e00\u4e0b\u5317\u4eac\u7684\u5929\u6c14\n</code></pre> <p>\u5206\u6790\u524d\u9762\u7684\u95ee\u9898\uff0c\u53ef\u4ee5\u77e5\u9053\u8be5\u95ee\u9898\u9700\u8981\u8c03\u7528\u4e24\u4e2a\u5de5\u5177\uff1a <code>get_current_weather</code>\u548c<code>send_email</code>\uff0c\u8fd9\u4e24\u4e2a\u5de5\u5177\u4e92\u4e0d\u5f71\u54cd\u53ef\u4ee5\u540c\u65f6\u8c03\u7528\uff0c\u56e0\u6b64\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u5e76\u884c\u5de5\u5177\u8c03\u7528\u3002</p> <p>\u5f00\u542f\u5e76\u884c\u5de5\u5177\u8c03\u7528\u7684\u65b9\u6cd5\uff1a</p> <ol> <li>\u68c0\u67e5\u6a21\u578b\u662f\u5426\u652f\u6301\u5e76\u884c\u5de5\u5177\u8c03\u7528</li> <li>\u5982\u679c\u6a21\u578b\u652f\u6301\u5e76\u884c\u5de5\u5177\u8c03\u7528\uff0c\u90a3\u4e48\u9700\u8981\u8bbe\u7f6e\u6a21\u578b\u8c03\u7528\u53c2\u6570<code>arallel_tool_calls=True</code></li> </ol> <p>\u56e0\u4e3a\u5728\u8fd9\u91cc\u4f7f\u7528\u7684\u662f<code>langchain_litellm</code>\uff0c\u8fd9\u4e2a\u5de5\u5177\u662f\u5bf9 <code>litellm</code> \u8fdb\u884c\u4e86\u5c01\u88c5\u4ee5\u65e0\u7f1d\u96c6\u6210 <code>langchain</code>\uff0c\u4e0b\u9762\u6f14\u793a\u5982\u4f55\u914d\u7f6e\u4f7f\u7528 <code>langchain_litellm</code>\u5f00\u542f\u5e76\u884c\u5de5\u5177\u8c03\u7528\uff1a</p> <pre><code>def create_llm_chat(model: str = \"deepseek-chat\") -&gt; BaseChatModel:\n    model_config = model_config_dict.get(model)\n\n    llm = ChatLiteLLM(\n        model=model_config.get('model'),\n        api_base=model_config.get('base_url'),\n        api_key=model_config.get('api_key'),\n        model_kwargs={\n            \"parallel_tool_calls\": True,\n        }\n    )\n    return llm\n</code></pre> <p>\u9700\u8981\u5728\u521b\u5efa <code>ChatLiteLLM</code>\u5b9e\u4f8b\u65f6\uff0c\u914d\u7f6e<code>model_kwargs</code>\u53c2\u6570\u4e3a <code>{\"parallel_tool_calls\": True}</code>,\u7136\u540e\u8c03\u7528\u6a21\u578b\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code># \u793a\u4f8b 2: \u9700\u8981\u63a8\u7406\u7684\u5e76\u884c\u5de5\u5177\u8c03\u7528\nquery2 = \"\u7ed9tom@example.com\u53d1\u4e00\u5c01\u90ae\u4ef6\uff0c\u795d\u4ed6\u751f\u65e5\u5feb\u4e50\uff0c\u4e3b\u9898\u5199'\u751f\u65e5\u5feb\u4e50'\uff0c\u540c\u65f6\u67e5\u4e00\u4e0b\u5317\u4eac\u7684\u5929\u6c14\"\nprint(f'\u793a\u4f8b\u4e8c\uff1a{query2}')\nresponse = agent.invoke(query2)\ntool_calls = response.tool_calls\nprint(f\"\u5de5\u5177\u8c03\u7528\u5217\u8868: {tool_calls}\")\nif tool_calls:\n    for tool_call in tool_calls:\n        print(f\"\u6267\u884c\u5de5\u5177\u8c03\u7528: {tool_call}\")\n        function_name = tool_call.get(\"name\")\n        function_args = tool_call.get(\"args\")\n\n        function_to_call = tool_factory[function_name]\n        if function_to_call is None:\n            print(f\"\u5de5\u5177 {function_name} \u4e0d\u5b58\u5728\")\n            continue\n        function_response = function_to_call(**function_args)\n\n        print(f\"\u5de5\u5177\u54cd\u5e94: {function_response}\")\n</code></pre> <p>\u6ca1\u6709\u5f00\u542f\u5e76\u884c\u5de5\u5177\u8c03\u7528\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>\u793a\u4f8b\u4e8c\uff1a\u7ed9tom@example.com\u53d1\u4e00\u5c01\u90ae\u4ef6\uff0c\u795d\u4ed6\u751f\u65e5\u5feb\u4e50\uff0c\u4e3b\u9898\u5199'\u751f\u65e5\u5feb\u4e50'\uff0c\u540c\u65f6\u67e5\u4e00\u4e0b\u5317\u4eac\u7684\u5929\u6c14\n\u5de5\u5177\u8c03\u7528\u5217\u8868: [{'name': 'get_current_weather', 'args': {'location': '\u5317\u4eac'}, 'id': 'fc-5e439bb0-07f3-4bce-b73e-90e7776879a8', 'type': 'tool_call'}]\n\u6267\u884c\u5de5\u5177\u8c03\u7528: {'name': 'get_current_weather', 'args': {'location': '\u5317\u4eac'}, 'id': 'fc-5e439bb0-07f3-4bce-b73e-90e7776879a8', 'type': 'tool_call'}\n[\u6a21\u62df\u8c03\u7528] \u6b63\u5728\u67e5\u8be2 \u5317\u4eac \u7684\u5929\u6c14...\n\u5de5\u5177\u54cd\u5e94: \u5317\u4eac\u7684\u5929\u6c14\u662f\u6674\u6717\u7684\uff0c22\u6444\u6c0f\u5ea6\u3002\n</code></pre> <p>\u5f00\u542f\u5e76\u884c\u5de5\u5177\u8c03\u7528\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>\u793a\u4f8b\u4e8c\uff1a\u7ed9tom@example.com\u53d1\u4e00\u5c01\u90ae\u4ef6\uff0c\u795d\u4ed6\u751f\u65e5\u5feb\u4e50\uff0c\u4e3b\u9898\u5199'\u751f\u65e5\u5feb\u4e50'\uff0c\u540c\u65f6\u67e5\u4e00\u4e0b\u5317\u4eac\u7684\u5929\u6c14\n\u5de5\u5177\u8c03\u7528\u5217\u8868: [{'name': 'send_email', 'args': {'to': 'tom@example.com', 'subject': '\u751f\u65e5\u5feb\u4e50', 'body': '\u795d\u4f60\u751f\u65e5\u5feb\u4e50\uff01'}, 'id': 'fc-d333c46b-9a44-4e67-b45e-c57f3d765999', 'type': 'tool_call'}, {'name': 'get_current_weather', 'args': {'location': '\u5317\u4eac'}, 'id': 'fc-04b118f7-f8b6-4405-8a2b-965d37fe956c', 'type': 'tool_call'}]\n\u6267\u884c\u5de5\u5177\u8c03\u7528: {'name': 'send_email', 'args': {'to': 'tom@example.com', 'subject': '\u751f\u65e5\u5feb\u4e50', 'body': '\u795d\u4f60\u751f\u65e5\u5feb\u4e50\uff01'}, 'id': 'fc-d333c46b-9a44-4e67-b45e-c57f3d765999', 'type': 'tool_call'}\n[\u6a21\u62df\u8c03\u7528] \u6b63\u5728\u53d1\u9001\u90ae\u4ef6\u7ed9 tom@example.com...\n\u4e3b\u9898: \u751f\u65e5\u5feb\u4e50\n\u5185\u5bb9: \u795d\u4f60\u751f\u65e5\u5feb\u4e50\uff01\n\u5de5\u5177\u54cd\u5e94: \u90ae\u4ef6\u5df2\u6210\u529f\u53d1\u9001\u81f3 tom@example.com\u3002\n\u6267\u884c\u5de5\u5177\u8c03\u7528: {'name': 'get_current_weather', 'args': {'location': '\u5317\u4eac'}, 'id': 'fc-04b118f7-f8b6-4405-8a2b-965d37fe956c', 'type': 'tool_call'}\n[\u6a21\u62df\u8c03\u7528] \u6b63\u5728\u67e5\u8be2 \u5317\u4eac \u7684\u5929\u6c14...\n\u5de5\u5177\u54cd\u5e94: \u5317\u4eac\u7684\u5929\u6c14\u662f\u6674\u6717\u7684\uff0c22\u6444\u6c0f\u5ea6\u3002\n</code></pre> <p>\u5f00\u542f\u5e76\u884c\u5de5\u5177\u8c03\u7528\u540e\uff0c\u6a21\u578b\u5728\u4e00\u8f6e\u5bf9\u8bdd\u4e2d\u8fd4\u56de\u4e86\u591a\u4e2a\u5de5\u5177\u8c03\u7528\uff0c\u7528\u6237\u53ef\u4ee5\u540c\u65f6\u6267\u884c\u5bf9\u5e94\u7684\u5de5\u5177\u8c03\u7528\u3002</p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%E5%8E%9F%E7%90%86%E5%92%8C%E5%AE%9E%E8%B7%B5/#3_1","title":"\u793a\u4f8b 3: \u53e6\u4e00\u4e2a\u7ec4\u5408\u4efb\u52a1","text":"<p>\u63a5\u4e0b\u6765\u4ecb\u7ecd\u4e00\u4e0b\u4e32\u884c\u5de5\u5177\u8c03\u7528\uff0c\u95ee\u9898\u5982\u4e0b\uff1a</p> <pre><code>\u67e5\u4e00\u4e0b\u5df4\u9ece\u7684\u5929\u6c14\uff0c\u7136\u540e\u5199\u4e00\u5c01\u90ae\u4ef6\u7ed9alice@example.com\uff0c\u544a\u8bc9\u5979\u5929\u6c14\u60c5\u51b5\uff0c\u4e3b\u9898\u5c31\u53eb'\u5df4\u9ece\u5929\u6c14\u7b80\u62a5'\u3002\n</code></pre> <p>\u5206\u6790\u8be5\u95ee\u9898\uff0c\u53ef\u4ee5\u77e5\u9053\u9700\u8981\u4e32\u884c\u8c03\u7528\u4e24\u4e2a\u5de5\u5177\uff1a\u5148\u8c03\u7528<code>get_current_weather</code>\uff0c\u7136\u540e\u5c06<code>get_current_weather</code>\u7684\u8c03\u7528\u7ed3\u679c\u4f5c\u4e3a\u53c2\u6570\u4f20\u7ed9 <code>send_email</code>\u5de5\u5177\uff0c\u6240\u4ee5\u6211\u4eec\u5728\u8c03\u7528\u8fc7\u7a0b\u4e2d\u9700\u8981\u5c06\u6bcf\u4e00\u6b65\u8c03\u7528\u7684\u7ed3\u679c\u8bb0\u5f55\u4e0b\u6765\uff0c\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a<code>messages</code>\u5217\u8868\u7528\u6765\u8bb0\u5f55\u6240\u6709\u7684\u6d88\u606f\uff0c\u4ee3\u7801\u5b9e\u73b0\u5982\u4e0b\uff1a</p> <pre><code># \u793a\u4f8b 3: \u53e6\u4e00\u4e2a\u7ec4\u5408\u4efb\u52a1\nquery3 = \"\u67e5\u4e00\u4e0b\u5df4\u9ece\u7684\u5929\u6c14\uff0c\u7136\u540e\u5199\u4e00\u5c01\u90ae\u4ef6\u7ed9alice@example.com\uff0c\u544a\u8bc9\u5979\u5929\u6c14\u60c5\u51b5\uff0c\u4e3b\u9898\u5c31\u53eb'\u5df4\u9ece\u5929\u6c14\u7b80\u62a5'\u3002\"\nprint(f'\u793a\u4f8b\u4e09\uff1a{query3}')\nmessages: list[BaseMessage] = [HumanMessage(query3)]\nresponse = agent.invoke(query3)\nmessages.append(response)\n\nlast_massage = messages[-1]\n# \u68c0\u67e5\u6700\u540e\u4e00\u4e2a\u6d88\u606f\u662f\u5426\u6709\u5de5\u5177\u8c03\u7528\nwhile last_massage.tool_calls:\n    tool_calls = last_massage.tool_calls\n    print(f\"\u5de5\u5177\u8c03\u7528\u5217\u8868: {tool_calls}\")\n    for tool_call in tool_calls:\n        print()\n        print(f\"\u6267\u884c\u5de5\u5177\u8c03\u7528: {tool_call}\")\n        function_name = tool_call.get(\"name\")\n        function_args = tool_call.get(\"args\")\n\n        function_to_call = tool_factory[function_name]\n        if function_to_call is None:\n            print(f\"\u5de5\u5177 {function_name} \u4e0d\u5b58\u5728\")\n            continue\n        function_response = function_to_call(**function_args)\n        print(f\"\u5de5\u5177\u54cd\u5e94: {function_response}\")\n        # \u5982\u679c\u6211\u4eec\u4f7f\u7528\u6a21\u578b\u751f\u6210\u7684\u5de5\u5177\u8c03\u7528\u6765\u5b9e\u9645\u8c03\u7528\u5de5\u5177\u5e76\u5e0c\u671b\u5c06\u5de5\u5177\u7ed3\u679c\u4f20\u9012\u56de\u6a21\u578b\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 ToolMessages \u6765\u5b9e\u73b0\u3002\n        messages.append(ToolMessage(content=function_response, tool_call_id=tool_call[\"id\"]))\n\n    response = agent.invoke(messages)\n    messages.append(response)\n    last_massage = messages[-1]\n\nprint(f\"\u6d88\u606f\u5217\u8868: {messages}\")\nprint(f'\u6700\u7ec8\u54cd\u5e94: {last_massage.content}')\n</code></pre> <p>\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>\u793a\u4f8b\u4e09\uff1a\u67e5\u4e00\u4e0b\u5df4\u9ece\u7684\u5929\u6c14\uff0c\u7136\u540e\u5199\u4e00\u5c01\u90ae\u4ef6\u7ed9alice@example.com\uff0c\u544a\u8bc9\u5979\u5929\u6c14\u60c5\u51b5\uff0c\u4e3b\u9898\u5c31\u53eb'\u5df4\u9ece\u5929\u6c14\u7b80\u62a5'\u3002\n\u5de5\u5177\u8c03\u7528\u5217\u8868: [{'name': 'get_current_weather', 'args': {'location': 'Paris'}, 'id': 'fc-dcf08102-877d-411f-b4a7-61e409b91c9f', 'type': 'tool_call'}]\n\n\u6267\u884c\u5de5\u5177\u8c03\u7528: {'name': 'get_current_weather', 'args': {'location': 'Paris'}, 'id': 'fc-dcf08102-877d-411f-b4a7-61e409b91c9f', 'type': 'tool_call'}\n[\u6a21\u62df\u8c03\u7528] \u6b63\u5728\u67e5\u8be2 Paris \u7684\u5929\u6c14...\n\u5de5\u5177\u54cd\u5e94: Paris\u7684\u5929\u6c14\u662f\u6674\u6717\u7684\uff0c22\u6444\u6c0f\u5ea6\u3002\n\u5de5\u5177\u8c03\u7528\u5217\u8868: [{'name': 'send_email', 'args': {'to': 'alice@example.com', 'subject': '\u5df4\u9ece\u5929\u6c14\u7b80\u62a5', 'body': '\u4eb2\u7231\u7684Alice\uff0c\\n\u6839\u636e\u6211\u67e5\u8be2\u5230\u7684\u6700\u65b0\u4fe1\u606f\uff0c\u5df4\u9ece\u73b0\u5728\u662f\u6674\u6717\u7684\u5929\u6c14\uff0c\u6c14\u6e29\u662f22\u6444\u6c0f\u5ea6\u3002\u5e0c\u671b\u8fd9\u80fd\u5e2e\u52a9\u4f60\u505a\u597d\u51fa\u884c\u51c6\u5907\u3002\\n\u795d\u597d\uff0c\\n\u4f60\u7684\u52a9\u624b'}, 'id': 'fc-d6331298-76db-4ea0-b65e-7676ac352585', 'type': 'tool_call'}]\n\n\u6267\u884c\u5de5\u5177\u8c03\u7528: {'name': 'send_email', 'args': {'to': 'alice@example.com', 'subject': '\u5df4\u9ece\u5929\u6c14\u7b80\u62a5', 'body': '\u4eb2\u7231\u7684Alice\uff0c\\n\u6839\u636e\u6211\u67e5\u8be2\u5230\u7684\u6700\u65b0\u4fe1\u606f\uff0c\u5df4\u9ece\u73b0\u5728\u662f\u6674\u6717\u7684\u5929\u6c14\uff0c\u6c14\u6e29\u662f22\u6444\u6c0f\u5ea6\u3002\u5e0c\u671b\u8fd9\u80fd\u5e2e\u52a9\u4f60\u505a\u597d\u51fa\u884c\u51c6\u5907\u3002\\n\u795d\u597d\uff0c\\n\u4f60\u7684\u52a9\u624b'}, 'id': 'fc-d6331298-76db-4ea0-b65e-7676ac352585', 'type': 'tool_call'}\n[\u6a21\u62df\u8c03\u7528] \u6b63\u5728\u53d1\u9001\u90ae\u4ef6\u7ed9 alice@example.com...\n\u4e3b\u9898: \u5df4\u9ece\u5929\u6c14\u7b80\u62a5\n\u5185\u5bb9: \u4eb2\u7231\u7684Alice\uff0c\n\u6839\u636e\u6211\u67e5\u8be2\u5230\u7684\u6700\u65b0\u4fe1\u606f\uff0c\u5df4\u9ece\u73b0\u5728\u662f\u6674\u6717\u7684\u5929\u6c14\uff0c\u6c14\u6e29\u662f22\u6444\u6c0f\u5ea6\u3002\u5e0c\u671b\u8fd9\u80fd\u5e2e\u52a9\u4f60\u505a\u597d\u51fa\u884c\u51c6\u5907\u3002\n\u795d\u597d\uff0c\n\u4f60\u7684\u52a9\u624b\n\u5de5\u5177\u54cd\u5e94: \u90ae\u4ef6\u5df2\u6210\u529f\u53d1\u9001\u81f3 alice@example.com\u3002\n\u6d88\u606f\u5217\u8868: \n[HumanMessage(content=\"\u67e5\u4e00\u4e0b\u5df4\u9ece\u7684\u5929\u6c14\uff0c\u7136\u540e\u5199\u4e00\u5c01\u90ae\u4ef6\u7ed9alice@example.com\uff0c\u544a\u8bc9\u5979\u5929\u6c14\u60c5\u51b5\uff0c\u4e3b\u9898\u5c31\u53eb'\u5df4\u9ece\u5929\u6c14\u7b80\u62a5'\u3002\", additional_kwargs={}, response_metadata={}), \nAIMessage(content='', additional_kwargs={'tool_calls': [ChatCompletionMessageToolCall(function=Function(arguments='{\"location\": \"Paris\"}', name='get_current_weather'), id='fc-dcf08102-877d-411f-b4a7-61e409b91c9f', type='function')]}, response_metadata={'token_usage': Usage(completion_tokens=21, prompt_tokens=781, total_tokens=802, completion_tokens_details=None, prompt_tokens_details=None), 'model': 'openai/deepseek', 'finish_reason': 'tool_calls', 'model_name': 'openai/deepseek'}, id='run--e10556e4-4b94-4e25-bef8-a51bc11c3226-0', tool_calls=[{'name': 'get_current_weather', 'args': {'location': 'Paris'}, 'id': 'fc-dcf08102-877d-411f-b4a7-61e409b91c9f', 'type': 'tool_call'}], usage_metadata={'input_tokens': 781, 'output_tokens': 21, 'total_tokens': 802}), \nToolMessage(content='Paris\u7684\u5929\u6c14\u662f\u6674\u6717\u7684\uff0c22\u6444\u6c0f\u5ea6\u3002', tool_call_id='fc-dcf08102-877d-411f-b4a7-61e409b91c9f'), \nAIMessage(content='\\n', additional_kwargs={'tool_calls': [ChatCompletionMessageToolCall(function=Function(arguments='{\"to\": \"alice@example.com\", \"subject\": \"\u5df4\u9ece\u5929\u6c14\u7b80\u62a5\", \"body\": \"\u4eb2\u7231\u7684Alice\uff0c\\\\n\u6839\u636e\u6211\u67e5\u8be2\u5230\u7684\u6700\u65b0\u4fe1\u606f\uff0c\u5df4\u9ece\u73b0\u5728\u662f\u6674\u6717\u7684\u5929\u6c14\uff0c\u6c14\u6e29\u662f22\u6444\u6c0f\u5ea6\u3002\u5e0c\u671b\u8fd9\u80fd\u5e2e\u52a9\u4f60\u505a\u597d\u51fa\u884c\u51c6\u5907\u3002\\\\n\u795d\u597d\uff0c\\\\n\u4f60\u7684\u52a9\u624b\"}', name='send_email'), id='fc-d6331298-76db-4ea0-b65e-7676ac352585', type='function')]}, response_metadata={'token_usage': Usage(completion_tokens=74, prompt_tokens=838, total_tokens=912, completion_tokens_details=None, prompt_tokens_details=None), 'model': 'openai/deepseek', 'finish_reason': 'tool_calls', 'model_name': 'openai/deepseek'}, id='run--d37b2a21-1b9d-43d7-8dcd-3db39d2a362f-0', tool_calls=[{'name': 'send_email', 'args': {'to': 'alice@example.com', 'subject': '\u5df4\u9ece\u5929\u6c14\u7b80\u62a5', 'body': '\u4eb2\u7231\u7684Alice\uff0c\\n\u6839\u636e\u6211\u67e5\u8be2\u5230\u7684\u6700\u65b0\u4fe1\u606f\uff0c\u5df4\u9ece\u73b0\u5728\u662f\u6674\u6717\u7684\u5929\u6c14\uff0c\u6c14\u6e29\u662f22\u6444\u6c0f\u5ea6\u3002\u5e0c\u671b\u8fd9\u80fd\u5e2e\u52a9\u4f60\u505a\u597d\u51fa\u884c\u51c6\u5907\u3002\\n\u795d\u597d\uff0c\\n\u4f60\u7684\u52a9\u624b'}, 'id': 'fc-d6331298-76db-4ea0-b65e-7676ac352585', 'type': 'tool_call'}], usage_metadata={'input_tokens': 838, 'output_tokens': 74, 'total_tokens': 912}), \nToolMessage(content='\u90ae\u4ef6\u5df2\u6210\u529f\u53d1\u9001\u81f3 alice@example.com\u3002', tool_call_id='fc-d6331298-76db-4ea0-b65e-7676ac352585'), AIMessage(content=\"\u90ae\u4ef6\u5df2\u6210\u529f\u53d1\u9001\u81f3Alice\u7684\u90ae\u7bb1\uff0c\u4e3b\u9898\u4e3a'\u5df4\u9ece\u5929\u6c14\u7b80\u62a5'\uff0c\u5185\u5bb9\u5305\u542b\u5f53\u524d\u5df4\u9ece\u7684\u5929\u6c14\u60c5\u51b5\u3002\u611f\u8c22\u60a8\u7684\u67e5\u8be2\uff0c\u795d\u60a8\u6709\u7f8e\u597d\u7684\u4e00\u5929\uff01\", additional_kwargs={}, response_metadata={'token_usage': Usage(completion_tokens=33, prompt_tokens=1198, total_tokens=1231, completion_tokens_details=None, prompt_tokens_details=None), 'model': 'openai/deepseek', 'finish_reason': 'stop', 'model_name': 'openai/deepseek'}, id='run--d833972f-7eaf-48ff-8578-95ea769142b8-0', usage_metadata={'input_tokens': 1198, 'output_tokens': 33, 'total_tokens': 1231})]\n\u6700\u7ec8\u54cd\u5e94: \u90ae\u4ef6\u5df2\u6210\u529f\u53d1\u9001\u81f3Alice\u7684\u90ae\u7bb1\uff0c\u4e3b\u9898\u4e3a'\u5df4\u9ece\u5929\u6c14\u7b80\u62a5'\uff0c\u5185\u5bb9\u5305\u542b\u5f53\u524d\u5df4\u9ece\u7684\u5929\u6c14\u60c5\u51b5\u3002\u611f\u8c22\u60a8\u7684\u67e5\u8be2\uff0c\u795d\u60a8\u6709\u7f8e\u597d\u7684\u4e00\u5929\uff01\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%E5%8E%9F%E7%90%86%E5%92%8C%E5%AE%9E%E8%B7%B5/#4","title":"\u6b65\u9aa4 4: \u751f\u6210\u6700\u7ec8\u56de\u590d","text":"<p>\u5982\u679c\u6211\u4eec\u4f7f\u7528\u6a21\u578b\u751f\u6210\u7684\u5de5\u5177\u8c03\u7528\u6765\u5b9e\u9645\u8c03\u7528\u5de5\u5177\uff0c\u5e76\u5e0c\u671b\u5c06\u5de5\u5177\u7ed3\u679c\u4f20\u9012\u56de\u6a21\u578b\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 <code>ToolMessages</code> \u6765\u5b9e\u73b0\u3002\u6211\u4eec\u9700\u8981\u5b9a\u4e49\u5b9a\u4e49\u4e00\u4e2a<code>messages</code>\u5217\u8868\u7528\u6765\u8bb0\u5f55\u6240\u6709\u7684\u6d88\u606f\uff0c\u5e76\u4e14\u5c06 <code>ToolMessages</code>\u653e\u5728\u6d88\u606f\u5217\u8868\u4e2d\uff0c\u4f7f\u7528 <code>messages</code>\u5217\u8868\u518d\u6b21\u8c03\u7528\u6a21\u578b\u83b7\u53d6\u6700\u7ec8\u7684\u56de\u590d\uff0c\u4ee3\u7801\u53ef\u4ee5\u53c2\u8003\u524d\u9762\u793a\u4f8b3\u3002 \u5176\u4e2d <code>ToolMessages.model_dump_json()</code> \u7684\u5185\u5bb9\u5982\u4e0b\uff1a <pre><code>{\n    \"content\": \"\u5317\u4eac\u7684\u5929\u6c14\u662f\u6674\u6717\u7684\uff0c22\u6444\u6c0f\u5ea6\u3002\",\n    \"additional_kwargs\": {\n\n    },\n    \"response_metadata\": {\n\n    },\n    \"type\": \"tool\",\n    \"name\": null,\n    \"id\": null,\n    \"tool_call_id\": \"fc-b250b7b8-f297-4fac-9f56-9ea0e7c94d3f\",\n    \"artifact\": null,\n    \"status\": \"success\"\n}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%E5%8E%9F%E7%90%86%E5%92%8C%E5%AE%9E%E8%B7%B5/#_7","title":"\u5b8c\u6574\u4ee3\u7801","text":"<pre><code>import os\nfrom langchain_litellm import ChatLiteLLM\nfrom langchain_core.language_models.chat_models import BaseChatModel\nfrom langchain_core.messages import ToolMessage, HumanMessage, BaseMessage\n\nfrom dotenv import load_dotenv\nload_dotenv()\n\n\n# \u5047\u8bbe\u7684\u5de5\u5177\u51fd\u6570\ndef get_current_weather(location: str) -&gt; str:\n    \"\"\"\u6a21\u62df\u83b7\u53d6\u5929\u6c14\u7684\u5de5\u5177\"\"\"\n    print(f\"[\u6a21\u62df\u8c03\u7528] \u6b63\u5728\u67e5\u8be2 {location} \u7684\u5929\u6c14...\")\n    return f\"{location}\u7684\u5929\u6c14\u662f\u6674\u6717\u7684\uff0c22\u6444\u6c0f\u5ea6\u3002\"\n\ndef send_email(to: str, subject: str, body: str) -&gt; str:\n    \"\"\"\u6a21\u62df\u53d1\u9001\u90ae\u4ef6\u7684\u5de5\u5177\"\"\"\n    print(f\"[\u6a21\u62df\u8c03\u7528] \u6b63\u5728\u53d1\u9001\u90ae\u4ef6\u7ed9 {to}...\")\n    print(f\"\u4e3b\u9898: {subject}\")\n    print(f\"\u5185\u5bb9: {body}\")\n    return f\"\u90ae\u4ef6\u5df2\u6210\u529f\u53d1\u9001\u81f3 {to}\u3002\"\n\n\n# \u521b\u5efa\u5de5\u5177\u5217\u8868\ntools = [get_current_weather, send_email]\n\n# \u5b9a\u4e49\u4e00\u4e2a\u5de5\u5177\u5de5\u5382\uff0c\u540e\u7eed\u901a\u8fc7\u540d\u79f0\u8c03\u7528\u5de5\u5177\ntool_factory = {\n    \"get_current_weather\": get_current_weather,\n    \"send_email\": send_email\n}\n\n\nmodel_config_dict = {\n    \"deepseek-chat\": {\n        \"model\": \"openai/deepseek-chat\",\n        \"base_url\": \"https://api.deepseek.com/v1\",\n        \"api_key\": os.getenv(\"DEEPSEEK_API_KEY\"),\n    },\n}\n\n# \u4e3a\u4e86\u66f4\u597d\u7684\u652f\u6301\u5176\u4ed6\u6a21\u578b\u548clangchain\u96c6\u6210\uff0c\u8fd9\u91cc\u4f7f\u7528 langchain_litellm \u7684 ChatLiteLLM \u5b9e\u73b0\u6a21\u578b\u8c03\u7528\uff0c\u800c\u4e0d\u662f init_chat_model\n# \u53c2\u8003\uff1ahttps://python.langchain.com/docs/integrations/chat/litellm/\ndef create_llm_chat(model: str = \"deepseek-chat\") -&gt; BaseChatModel:\n    model_config = model_config_dict.get(model)\n\n    llm = ChatLiteLLM(\n        model=model_config.get('model'),\n        api_base=model_config.get('base_url'),\n        api_key=model_config.get('api_key'),\n        model_kwargs={\n            \"parallel_tool_calls\": True,\n        }\n    )\n    return llm\n\nllm =  create_llm_chat(\"deepseek-chat\")\n\nagent = llm.bind_tools(tools=tools)\n\nif __name__ == '__main__':\n\n    # \u793a\u4f8b 1: \u7b80\u5355\u5de5\u5177\u8c03\u7528\n    # query = \"\u5317\u4eac\u7684\u5929\u6c14\u600e\u4e48\u6837\uff1f\"\n    # \u793a\u4f8b 2: \u9700\u8981\u63a8\u7406\u7684\u5e76\u884c\u5de5\u5177\u8c03\u7528\n    query = \"\u7ed9tom@example.com\u53d1\u4e00\u5c01\u90ae\u4ef6\uff0c\u795d\u4ed6\u751f\u65e5\u5feb\u4e50\uff0c\u4e3b\u9898\u5199'\u751f\u65e5\u5feb\u4e50'\uff0c\u540c\u65f6\u67e5\u4e00\u4e0b\u5317\u4eac\u7684\u5929\u6c14\"\n    # \u793a\u4f8b 3: \u53e6\u4e00\u4e2a\u7ec4\u5408\u4efb\u52a1\n    # query = \"\u67e5\u4e00\u4e0b\u5df4\u9ece\u7684\u5929\u6c14\uff0c\u7136\u540e\u5199\u4e00\u5c01\u90ae\u4ef6\u7ed9alice@example.com\uff0c\u544a\u8bc9\u5979\u5929\u6c14\u60c5\u51b5\uff0c\u4e3b\u9898\u5c31\u53eb'\u5df4\u9ece\u5929\u6c14\u7b80\u62a5'\u3002\"\n    print(f'\u793a\u4f8b\uff1a{query}')\n    messages: list[BaseMessage] = [HumanMessage(query)]\n    response = agent.invoke(query)\n    messages.append(response)\n\n    last_massage = messages[-1]\n    # \u68c0\u67e5\u6700\u540e\u4e00\u4e2a\u6d88\u606f\u662f\u5426\u6709\u5de5\u5177\u8c03\u7528\n    while last_massage.tool_calls:\n        tool_calls = last_massage.tool_calls\n        print(f\"\u5de5\u5177\u8c03\u7528\u5217\u8868: {tool_calls}\")\n        for tool_call in tool_calls:\n            print()\n            print(f\"\u6267\u884c\u5de5\u5177\u8c03\u7528: {tool_call}\")\n            function_name = tool_call.get(\"name\")\n            function_args = tool_call.get(\"args\")\n\n            function_to_call = tool_factory[function_name]\n            if function_to_call is None:\n                print(f\"\u5de5\u5177 {function_name} \u4e0d\u5b58\u5728\")\n                continue\n            function_response = function_to_call(**function_args)\n            print(f\"\u5de5\u5177\u54cd\u5e94: {function_response}\")\n            # \u5982\u679c\u6211\u4eec\u4f7f\u7528\u6a21\u578b\u751f\u6210\u7684\u5de5\u5177\u8c03\u7528\u6765\u5b9e\u9645\u8c03\u7528\u5de5\u5177\u5e76\u5e0c\u671b\u5c06\u5de5\u5177\u7ed3\u679c\u4f20\u9012\u56de\u6a21\u578b\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 ToolMessages \u6765\u5b9e\u73b0\u3002\n            messages.append(ToolMessage(content=function_response, tool_call_id=tool_call[\"id\"]))\n\n        response = agent.invoke(messages)\n        messages.append(response)\n        last_massage = messages[-1]\n\n    print(f\"\u6d88\u606f\u5217\u8868: {messages}\")\n    print(f'\u6700\u7ec8\u54cd\u5e94: {last_massage.content}')\n    import time\n\n    time.sleep(5)\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%E5%8E%9F%E7%90%86%E5%92%8C%E5%AE%9E%E8%B7%B5/#_8","title":"\u603b\u7ed3","text":"<p>\u901a\u8fc7\u4ee5\u4e0a\u6b65\u9aa4\uff0c\u6211\u4eec\u5b9e\u73b0\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u5de5\u5177\u8c03\u7528\u548c\u7ec4\u5408\u4efb\u52a1\u7684\u793a\u4f8b\u3002\u8fd9\u4e2a\u793a\u4f8b\u5c55\u793a\u4e86\u5982\u4f55\u4f7f\u7528 LangChain \u548c LiteLLM \u6765\u521b\u5efa\u4e00\u4e2a\u80fd\u591f\u7406\u89e3\u81ea\u7136\u8bed\u8a00\u5e76\u6267\u884c\u76f8\u5e94\u64cd\u4f5c\u7684\u667a\u80fd\u52a9\u624b\u3002</p> <p>\u53c2\u8003\u6587\u6863</p> <ul> <li>https://qwen.readthedocs.io/en/latest/framework/function_call.html</li> <li>https://platform.openai.com/docs/guides/function-calling</li> <li>https://python.langchain.com/docs/how_to/tool_calling/</li> <li>https://python.langchain.com/docs/how_to/function_calling/</li> <li>https://python.langchain.com/docs/how_to/custom_tools/</li> <li>https://python.langchain.com/docs/concepts/tools/</li> </ul>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/","title":"\u5982\u4f55\u8ba9\u5927\u6a21\u578b\u8f93\u51fa\u7ed3\u6784\u5316\u6570\u636e","text":"<p>\u7ed3\u6784\u5316\u8f93\u51fa\u662f\u6307\u8ba9\u5927\u6a21\u578b\uff08\u5982GPT\u3001LLama\u7b49\uff09\u7684\u8f93\u51fa\u7ed3\u679c\u7b26\u5408\u9884\u5b9a\u4e49\u7684\u683c\u5f0f\uff08\u5982 JSON\u3001Pydantic \u5bf9\u8c61\u3001\u8868\u683c\u7b49\uff09\u800c\u4e0d\u662f\u81ea\u7531\u6587\u672c\uff0c\u8fd9\u5728\u9700\u8981\u7a0b\u5e8f\u5316\u5904\u7406\u7ed3\u679c\uff08\u5982\u6570\u636e\u63d0\u53d6\u3001\u540e\u7eed\u81ea\u52a8\u5316\u64cd\u4f5c\uff09\u65f6\u975e\u5e38\u6709\u7528\uff0c\u4e00\u4e2a\u5e38\u89c1\u7684\u7528\u4f8b\u662f\u4ece\u6587\u672c\u4e2d\u63d0\u53d6\u6570\u636e\u4ee5\u63d2\u5165\u6570\u636e\u5e93\u6216\u4e0e\u5176\u4ed6\u4e0b\u6e38\u7cfb\u7edf\u4e00\u8d77\u4f7f\u7528\u3002\u672c\u6587\u4ecb\u7ecd\u4e00\u4e0b\u5982\u4f55\u4f7f\u7528 LangChain \u6846\u67b6\u8ba9\u5927\u6a21\u578b\u8f93\u51fa\u7ed3\u6784\u5316\u6570\u636e\u3002</p> <p>\u5b9e\u73b0\u7ed3\u6784\u5316\u8f93\u51fa\u7684\u5e38\u89c1\u65b9\u6cd5\u5305\u62ec\uff1a</p> <ul> <li>\u63d0\u793a\u5de5\u7a0b\uff1a\u901a\u8fc7\u7cfb\u7edf\u63d0\u793a\u6307\u4ee4LLM\u4ee5\u7279\u5b9a\u683c\u5f0f\u8fdb\u884c\u54cd\u5e94\u3002</li> <li>\u8f93\u51fa\u89e3\u6790\u5668\uff1a\u4f7f\u7528\u540e\u5904\u7406\u6280\u672f\u4eceLLM\u54cd\u5e94\u4e2d\u63d0\u53d6\u7ed3\u6784\u5316\u6570\u636e\u3002</li> <li>\u5de5\u5177\u8c03\u7528\uff1a\u5229\u7528\u67d0\u4e9bLLM\u5185\u7f6e\u7684\u5de5\u5177\u8c03\u7528\u529f\u80fd\u751f\u6210\u7ed3\u6784\u5316\u8f93\u51fa\u3002</li> </ul>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#_2","title":"\u4f7f\u7528\u63d0\u793a\u5de5\u7a0b\u5b9e\u73b0\u7ed3\u6784\u5316\u8f93\u51fa","text":""},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#_3","title":"\u624b\u52a8\u7f16\u5199\u63d0\u793a\u5de5\u7a0b","text":"<p>\u4f7f\u7528\u63d0\u793a\u5de5\u7a0b\u5b9e\u73b0\u7ed3\u6784\u5316\u8f93\u51fa\u9700\u8981\u901a\u8fc7\u8bbe\u8ba1\u660e\u786e\u7684\u7cfb\u7edf\u63d0\u793a\uff08System Prompt\uff09\uff0c\u76f4\u63a5\u8981\u6c42\u6a21\u578b\u8f93\u51fa\u7b26\u5408\u7279\u5b9a\u683c\u5f0f\uff08\u5982 JSON\u3001\u8868\u683c\u7b49\uff09\u7684\u6570\u636e\uff0c\u800c\u4e0d\u662f\u81ea\u7531\u6587\u672c\u3002\u8fd9\u79cd\u65b9\u6cd5\u4f9d\u8d56\u6a21\u578b\u7684\u7406\u89e3\u80fd\u529b\uff0c\u6240\u4ee5\u5728\u6a21\u578b\u8f93\u51fa\u6570\u636e\u540e\u9700\u8981\u5bf9\u6570\u636e\u8fdb\u884c\u540e\u5904\u7406\uff08\u53ef\u4ee5\u4f7f\u7528langchain\u63d0\u4f9b\u7684\u8f93\u51fa\u89e3\u6790\u5668<code>**BaseLLMOutputParser**</code>\u7684\u5b50\u7c7b\uff0c\u540e\u9762\u4f1a\u8be6\u7ec6\u4ecb\u7ecd\uff09\u3002</p> <p>\u4ee5\u4e0b\u662f\u4e00\u4e9b\u5e38\u89c1\u7684\u65b9\u6cd5\u548c\u6280\u5de7\uff1a</p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#1","title":"1. \u660e\u786e\u76ee\u6807","text":"<p>\u5728\u63d0\u95ee\u65f6\u660e\u786e\u8981\u6c42\u6a21\u578b\u8f93\u51fa\u7ed3\u6784\u5316\u6570\u636e\u3002\u4f8b\u5982\uff1a</p> <ul> <li>\u201c\u8bf7\u4ee5JSON\u683c\u5f0f\u8f93\u51fa\u3002\u201d</li> <li>\u201c\u8bf7\u7528XML\u683c\u5f0f\u56de\u7b54\uff0c\u5e76\u5305\u542b\u4ee5\u4e0b\u5b57\u6bb5\uff1a...\u201d</li> <li>\u201c\u8bf7\u8f93\u51faCSV\u683c\u5f0f\uff0c\u7b2c\u4e00\u884c\u662f\u8868\u5934\u3002\u201d</li> </ul>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#2","title":"2. \u63d0\u4f9b\u793a\u4f8b","text":"<p>\u7ed9\u51fa\u4e00\u4e2a\u8f93\u51fa\u793a\u4f8b\uff0c\u8fd9\u6837\u6a21\u578b\u53ef\u4ee5\u6a21\u4eff\u683c\u5f0f\u3002\u4f8b\u5982\uff1a</p> <ul> <li>\u201c\u4f8b\u5982\uff1a{'name': 'John', 'age': 30}\u201d</li> <li>\u5728\u590d\u6742\u7ed3\u6784\u4e2d\uff0c\u63d0\u4f9b\u793a\u4f8b\u5c24\u4e3a\u91cd\u8981\u3002</li> </ul>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#3","title":"3. \u6307\u5b9a\u5b57\u6bb5","text":"<p>\u660e\u786e\u5217\u51fa\u9700\u8981\u5305\u542b\u7684\u5b57\u6bb5\uff0c\u4ee5\u53ca\u5b83\u4eec\u7684\u6570\u636e\u7c7b\u578b\u3002\u4f8b\u5982\uff1a</p> <ul> <li>\u201c\u8bf7\u8f93\u51fa\u4e00\u4e2aJSON\u5bf9\u8c61\uff0c\u5305\u542b\u4ee5\u4e0b\u5b57\u6bb5\uff1aname\uff08\u5b57\u7b26\u4e32\uff09\u3001age\uff08\u6574\u6570\uff09\u3001hobbies\uff08\u5b57\u7b26\u4e32\u5217\u8868\uff09\u3002\u201d</li> </ul>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#4","title":"4. \u5206\u6b65\u5f15\u5bfc","text":"<p>\u5bf9\u4e8e\u590d\u6742\u7ed3\u6784\uff0c\u53ef\u4ee5\u5206\u6b65\u5f15\u5bfc\u6a21\u578b\u3002\u5148\u8ba9\u6a21\u578b\u8f93\u51fa\u4e00\u90e8\u5206\uff0c\u518d\u9010\u6b65\u5b8c\u5584\u3002</p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#5-api","title":"5. \u5f3a\u5236\u7ea6\u675f\uff08\u5982\u679cAPI\u652f\u6301\uff09","text":"<p>\u5728API\u8c03\u7528\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7\u7cfb\u7edf\u6d88\u606f\uff08system message\uff09\u6765\u8bbe\u5b9a\u8f93\u51fa\u683c\u5f0f\u3002\u4f8b\u5982\uff1a</p> <pre><code>{\n  \"role\": \"system\",\n  \"content\": \"\u4e0d\u8981\u89e3\u91ca\uff0c\u4ec5\u4ee5JSON\u683c\u5f0f\u8f93\u51fa\uff0c\u5305\u542bname\u548cage\u5b57\u6bb5\u3002\"\n}\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#6","title":"6. \u540e\u5904\u7406","text":"<p>\u5982\u679c\u6a21\u578b\u8f93\u51fa\u4e0d\u662f\u5b8c\u5168\u7ed3\u6784\u5316\u7684\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u7528\u540e\u5904\u7406\uff08\u5982\u6b63\u5219\u8868\u8fbe\u5f0f\uff09\u6765\u63d0\u53d6\u4fe1\u606f\u5e76\u8f6c\u5316\u4e3a\u7ed3\u6784\u5316\u7684\u6570\u636e\u3002</p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#7","title":"7. \u8c03\u6574\u6e29\u5ea6\u53c2\u6570","text":"<p>\u5c06\u6e29\u5ea6\uff08temperature\uff09\u8bbe\u7f6e\u4e3a0\uff08\u6216\u8f83\u4f4e\u503c\uff09\uff0c\u4f7f\u8f93\u51fa\u66f4\u52a0\u786e\u5b9a\uff0c\u51cf\u5c11\u968f\u673a\u6027\uff0c\u6709\u52a9\u4e8e\u7a33\u5b9a\u8f93\u51fa\u7ed3\u6784\u3002</p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#8","title":"8. \u4f7f\u7528\u6a21\u677f","text":"<p>\u5728\u63d0\u793a\u8bcd\u4e2d\u63d0\u4f9b\u6a21\u677f\uff0c\u8ba9\u6a21\u578b\u586b\u5145\u5185\u5bb9\u3002\u4f8b\u5982\uff1a</p> <pre><code>\u8bf7\u6309\u7167\u4ee5\u4e0b\u6a21\u677f\u8f93\u51fa\uff1a\n| \u4e66\u540d | \u4f5c\u8005 | \u51fa\u7248\u5e74\u4efd |\n|------|------|----------|\n| &lt;\u4e66\u540d&gt; | &lt;\u4f5c\u8005&gt; | &lt;\u5e74\u4efd&gt;   |\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <p>\u5047\u8bbe\u6211\u4eec\u60f3\u8ba9\u6a21\u578b\u8f93\u51fa\u4e00\u672c\u4e66\u7684\u4fe1\u606f\uff0c\u5305\u62ec\u4e66\u540d\u3001\u4f5c\u8005\u548c\u51fa\u7248\u5e74\u4efd\uff0c\u8981\u6c42\u662fJSON\u683c\u5f0f\u3002 \u63d0\u95ee\uff1a</p> <pre><code>\u8bf7\u4ee5JSON\u683c\u5f0f\u8f93\u51fa\u300a\u4e09\u4f53\u300b\u8fd9\u672c\u4e66\u7684\u4fe1\u606f\uff0c\u5305\u542b\u5b57\u6bb5\uff1atitle\uff08\u5b57\u7b26\u4e32\uff09\u3001author\uff08\u5b57\u7b26\u4e32\uff09\u3001year\uff08\u6574\u6570\uff09\u3002\n</code></pre> <p>\u671f\u671b\u8f93\u51fa\uff1a</p> <pre><code>{\n  \"title\": \"\u4e09\u4f53\",\n  \"author\": \"\u5218\u6148\u6b23\",\n  \"year\": 2008\n}\n</code></pre> <p>\u6ce8\u610f\uff1a</p> <ul> <li>\u6a21\u578b\u6709\u65f6\u53ef\u80fd\u4f1a\u5728\u7ed3\u6784\u5316\u6570\u636e\u4e4b\u5916\u6dfb\u52a0\u989d\u5916\u6587\u672c\u3002\u5982\u679c\u8981\u6c42\u4e25\u683c\u7684JSON\uff0c\u53ef\u4ee5\u5728\u6307\u4ee4\u4e2d\u5f3a\u8c03\u201c\u53ea\u8f93\u51faJSON\uff0c\u4e0d\u8981\u5176\u4ed6\u4efb\u4f55\u6587\u5b57\u201d\u3002</li> <li>\u5982\u679c\u8f93\u51fa\u590d\u6742\u5d4c\u5957\u7ed3\u6784\uff0c\u63d0\u4f9b\u66f4\u8be6\u7ec6\u7684\u793a\u4f8b\u548c\u8bf4\u660e\u3002  </li> </ul> <p>\u603b\u7ed3\uff1a</p> <p>\u624b\u52a8\u7f16\u5199\u63d0\u793a\u5de5\u7a0b\u5b9e\u73b0\u7ed3\u6784\u5316\u8f93\u51fa\u7684\u4e00\u822c\u6b65\u9aa4\uff1a</p> <ul> <li>\u5b9a\u4e49\u76ee\u6807\u683c\u5f0f\uff1a\u5728\u7cfb\u7edf\u63d0\u793a\u4e2d\u660e\u786e\u8f93\u51fa\u683c\u5f0f\uff08\u5982 JSON\u3001XML\u3001\u8868\u683c\u7b49\uff09\u3002</li> <li>\u63d0\u4f9b\u793a\u4f8b\uff1a\u5728\u63d0\u793a\u4e2d\u52a0\u5165\u793a\u4f8b\uff0c\u5e2e\u52a9\u6a21\u578b\u7406\u89e3\u671f\u671b\u7684\u7ed3\u6784\u3002</li> <li>\u5f3a\u5236\u7ea6\u675f\uff1a\u5728\u63d0\u793a\u4e2d\u52a0\u5165\u7ea6\u675f\uff0c\u786e\u4fdd\u6a21\u578b\u8f93\u51fa\u7b26\u5408\u683c\u5f0f\u8981\u6c42\uff0c\u6bd4\u5982 \"\u8bf7\u4e25\u683c\u6309\u7167\u4ee5\u4e0b\u683c\u5f0f\u8f93\u51fa\"\u3002</li> <li>\u540e\u5904\u7406\uff1a\u5728\u6a21\u578b\u8f93\u51fa\u540e\uff0c\u4f7f\u7528\u8f93\u51fa\u89e3\u6790\u5668\uff08\u6b63\u5219\u8868\u8fbe\u5f0f\uff09\u89e3\u6790\u5e76\u9a8c\u8bc1\u6570\u636e\u3002</li> </ul> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u624b\u52a8\u7f16\u5199\u63d0\u793a\u8bcd\u5b9e\u73b0\u7ed3\u6784\u5316\u8f93\u51fa\u7684\u793a\u4f8b\uff1a</p> <pre><code>system_prompt = \"\"\"\n\u6839\u636e\u7528\u6237\u7684\u8f93\u5165\u751f\u6210\u8f6c\u8d26\u6216\u8005\u7ea2\u5305\u7684\u91d1\u989d\u548c\u5907\u6ce8\uff0c\u8bf7\u4e25\u683c\u6309\u7167\u4ee5\u4e0bJSON\u683c\u5f0f\u8f93\u51fa\n\u4e0b\u9762\u662f\u4e00\u4e9b\u4f8b\u5b50:\n\u793a\u4f8b\u4e00\uff1a\n\u8f93\u5165: \u5f20\u4e09\u8bf4\u7ed9\u674e\u56db\u8f6c\u8d261000\u5143\n\u8f93\u51fa: {\"money\": 1000, \"unit\":\"\u5143\",\"remark\": \"\u8f6c\u7ed9\u674e\u56db\"}\n\u793a\u4f8b\u4e8c\uff1a\n\u8f93\u5165: \u8f6c\u8d26100\u5143\n\u8f93\u51fa: {\"money\": 100, \"unit\":\"\u5143\",\"remark\": \"\"}\n\n\"\"\"\n\nuser_input = \"\u674e\u96f7\u7ed9\u97e9\u6885\u6885\u8f6c\u8d262000\u5143\"\n\nmessages = [\n    {\"role\": \"system\", \"content\": system_prompt},\n    {\"role\": \"user\", \"content\": user_input}\n]\n</code></pre> <p>\u901a\u8fc7\u4ee5\u4e0a\u65b9\u6cd5\uff0c\u53ef\u4ee5\u5927\u5927\u63d0\u9ad8\u6a21\u578b\u8f93\u51fa\u7ed3\u6784\u5316\u6570\u636e\u7684\u6982\u7387\u548c\u51c6\u786e\u6027\u3002</p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#_4","title":"\u624b\u52a8\u7f16\u5199\u63d0\u793a\u5de5\u7a0b\u7684\u7f3a\u70b9\u603b\u7ed3","text":"<p>\u624b\u52a8\u7f16\u5199\u63d0\u793a\u5de5\u7a0b\uff08Prompt Engineering\uff09\u5b9e\u73b0\u7ed3\u6784\u5316\u8f93\u51fa\u867d\u7136\u76f4\u89c2\uff0c\u4f46\u5b58\u5728\u4ee5\u4e0b\u663e\u8457\u7f3a\u70b9\uff1a</p> \u95ee\u9898\u7c7b\u522b \u5177\u4f53\u95ee\u9898 \u8be6\u7ec6\u8bf4\u660e \u793a\u4f8b/\u5907\u6ce8 1. \u8f93\u51fa\u7a33\u5b9a\u6027\u95ee\u9898 \u683c\u5f0f\u6f02\u79fb \u6a21\u578b\u53ef\u80fd\u5728\u8f93\u51fa\u4e2d\u6dfb\u52a0\u89e3\u91ca\u6027\u6587\u5b57\u6216\u524d\u7f00\uff0c\u7834\u574f\u7ed3\u6784\u5316\u683c\u5f0f <code>\"\u7b54\u6848\uff1a{ \\\"name\\\": \\\"Alice\\\" }\"</code> \u968f\u673a\u6027 \u5373\u4f7f\u8bbe\u7f6e <code>temperature=0</code>\uff0c\u590d\u6742\u4efb\u52a1\u4ecd\u53ef\u80fd\u751f\u6210\u975e\u6cd5\u683c\u5f0f \u8f93\u51fa\u7f3a\u5c11\u5f15\u53f7\u3001\u62ec\u53f7\u4e0d\u5339\u914d\u7b49 \u8fb9\u754c\u6848\u4f8b\u5904\u7406\u5dee \u5bf9\u7a7a\u503c\u3001\u7279\u6b8a\u5b57\u7b26\u3001\u6781\u7aef\u8f93\u5165\u5904\u7406\u4e0d\u4f73\uff0c\u6613\u5bfc\u81f4\u683c\u5f0f\u9519\u8bef <code>null</code> \u88ab\u66ff\u6362\u4e3a <code>\"N/A\"</code> \u6216\u9057\u6f0f 2. \u5f00\u53d1\u7ef4\u62a4\u6210\u672c\u9ad8 \u8106\u5f31\u63d0\u793a \u4e0d\u540c\u6a21\u578b\uff08\u5982 GPT-4\u3001Claude\u3001Llama\uff09\u5bf9\u540c\u4e00\u63d0\u793a\u54cd\u5e94\u4e0d\u4e00\u81f4\uff0c\u9700\u5355\u72ec\u8c03\u6574 \u63d0\u793a\u9700\u4e3a\u6bcf\u4e2a\u6a21\u578b\u5b9a\u5236\u4f18\u5316 \u7248\u672c\u654f\u611f \u6a21\u578b\u66f4\u65b0\u540e\u539f\u6709\u63d0\u793a\u53ef\u80fd\u5931\u6548\uff0c\u9700\u91cd\u65b0\u6d4b\u8bd5\u548c\u4fee\u6539 OpenAI \u6a21\u578b\u5fae\u66f4\u65b0\u5bfc\u81f4 JSON \u5931\u6548 \u957f\u63d0\u793a\u96be\u4f18\u5316 \u590d\u6742\u7ed3\u6784\u63d0\u793a\u5e38\u8d85 100 token\uff0c\u8c03\u8bd5\u56f0\u96be\uff0c\u5f71\u54cd\u53ef\u8bfb\u6027\u548c\u7ef4\u62a4\u6027 \u63d0\u793a\u8fc7\u957f\u5bfc\u81f4\u6ce8\u610f\u529b\u5206\u6563 3. \u7c7b\u578b\u63a7\u5236\u8584\u5f31 \u65e0\u5f3a\u5236\u7c7b\u578b\u6821\u9a8c \u6a21\u578b\u53ef\u80fd\u8fd4\u56de\u5b57\u7b26\u4e32\u800c\u975e\u6570\u5b57\u3001\u65e5\u671f\u7b49\u9884\u671f\u7c7b\u578b <code>\"age\": \"\u4e8c\u5341\u516b\"</code> \u5e94\u4e3a <code>28</code> \u683c\u5f0f\u9519\u8bef\u65e0\u81ea\u6108 \u65e0\u6cd5\u81ea\u52a8\u4fee\u590d\u975e\u6cd5 JSON\uff08\u5982\u5c3e\u9017\u53f7\u3001\u672a\u8f6c\u4e49\u5b57\u7b26\uff09 <code>[\"a\",\"b\",]</code> \u662f\u975e\u6cd5 JSON \u590d\u6742\u7ed3\u6784\u96be\u5b9e\u73b0 \u5d4c\u5957\u5bf9\u8c61\u3001\u8054\u5408\u7c7b\u578b\u3001\u679a\u4e3e\u7b49\u590d\u6742 Schema \u51e0\u4e4e\u65e0\u6cd5\u7a33\u5b9a\u751f\u6210 \u96be\u4ee5\u4fdd\u8bc1 <code>{ user: { profile: { ... } } }</code> \u7684\u5b8c\u6574\u6027 4. \u9519\u8bef\u5904\u7406\u7f3a\u5931 \u65e0\u91cd\u8bd5\u673a\u5236 \u89e3\u6790\u5931\u8d25\u540e\u9700\u5916\u90e8\u903b\u8f91\u89e6\u53d1\u91cd\u8bd5\uff0c\u63d0\u793a\u672c\u8eab\u4e0d\u5177\u5907\u5bb9\u9519\u80fd\u529b \u9700\u624b\u52a8\u7f16\u5199\u91cd\u8bd5\u5faa\u73af \u65e0\u9519\u8bef\u53cd\u9988 \u6a21\u578b\u4e0d\u77e5\u9053\u8f93\u51fa\u4e3a\u4f55\u88ab\u62d2\u7edd\uff0c\u65e0\u6cd5\u4ece\u9519\u8bef\u4e2d\u5b66\u4e60 \u65e0\u6cd5\u544a\u77e5\u6a21\u578b\u201c\u7f3a\u5c11\u5b57\u6bb5 <code>email</code>\u201d \u5f02\u5e38\u5904\u7406\u5168\u624b\u52a8 \u6240\u6709\u683c\u5f0f\u5f02\u5e38\u9700\u7528\u4ee3\u7801\u6355\u83b7\u5e76\u5904\u7406\uff0c\u589e\u52a0\u5f00\u53d1\u8d1f\u62c5 <code>try-except</code> \u5757\u904d\u5730\u5f00\u82b1 5. \u6269\u5c55\u6027\u9650\u5236 \u591a\u5b57\u6bb5\u7ef4\u62a4\u96be \u5b57\u6bb5\u8d85\u8fc7 10 \u4e2a\u65f6\uff0c\u63d0\u793a\u8bcd\u53d8\u5f97\u5197\u957f\u4e14\u96be\u4ee5\u7ba1\u7406 \u63d0\u793a\u81a8\u80c0\u81f3\u6570\u767e token \u52a8\u6001\u7ed3\u6784\u4e0d\u652f\u6301 \u65e0\u6cd5\u6839\u636e\u8f93\u5165\u5185\u5bb9\u52a8\u6001\u8c03\u6574\u8f93\u51fa\u7ed3\u6784\uff08\u5982\u6761\u4ef6\u5b57\u6bb5\u3001\u53ef\u9009\u5bf9\u8c61\uff09 \u8f93\u5165\u4e3a\u201c\u516c\u53f8\u201d\u5219\u8f93\u51fa\u4ea7\u54c1\u5217\u8868\uff0c\u5426\u5219\u4e0d\u8f93\u51fa \u591a\u8bed\u8a00\u9002\u914d\u590d\u6742 \u4e0d\u540c\u8bed\u8a00\u9700\u91cd\u5199\u6574\u4e2a\u63d0\u793a\u89c4\u5219\u4ee5\u4fdd\u6301\u7ed3\u6784\u4e00\u81f4\u6027 \u4e2d\u6587\u63d0\u793a\u9700\u91cd\u65b0\u8bbe\u8ba1\u683c\u5f0f\u7ea6\u675f 6. \u6548\u7387\u95ee\u9898 token \u6d6a\u8d39 \u6bcf\u6b21\u8bf7\u6c42\u90fd\u9700\u91cd\u590d\u4f20\u8f93\u5b8c\u6574\u7684 Schema \u63cf\u8ff0\uff0c\u5360\u7528\u5927\u91cf\u4e0a\u4e0b\u6587 \u6bcf\u6b21\u90fd\u4f20 <code>\"\u8f93\u51fa\u4e25\u683cJSON\u683c\u5f0f\uff1a...\"</code> \u54cd\u5e94\u5ef6\u8fdf \u6a21\u578b\u9700\u82b1\u8d39\u8ba1\u7b97\u8d44\u6e90\u7406\u89e3\u683c\u5f0f\u8981\u6c42\uff0c\u800c\u975e\u4e13\u6ce8\u4e8e\u5185\u5bb9\u751f\u6210 \u5f71\u54cd\u63a8\u7406\u901f\u5ea6 \u89e3\u6790\u5f00\u9500 \u9700\u5148\u63d0\u53d6\u6587\u672c\u518d\u89e3\u6790 JSON\uff0c\u65e0\u6cd5\u76f4\u63a5\u83b7\u53d6\u7ed3\u6784\u5316\u6570\u636e\uff0c\u589e\u52a0\u540e\u5904\u7406\u6210\u672c \u5927\u54cd\u5e94\u4f53\u4e0b\u89e3\u6790\u8017\u65f6\u663e\u8457 7. \u4e0e\u5de5\u7a0b\u5b9e\u8df5\u8131\u8282 \u65e0\u7248\u672c\u63a7\u5236 \u63d0\u793a\u8bcd\u901a\u5e38\u4ee5\u5b57\u7b26\u4e32\u5f62\u5f0f\u5b58\u5728\uff0c\u96be\u4ee5\u8fdb\u884c <code>git diff</code>\u3001\u5408\u5e76\u51b2\u7a81\u7ba1\u7406\u7b49\u4ee3\u7801\u7ea7\u64cd\u4f5c \u4fee\u6539\u63d0\u793a\u65e0\u6cd5\u8ffd\u6eaf\u53d8\u66f4\u5386\u53f2 \u6d4b\u8bd5\u56f0\u96be \u7f3a\u4e4f\u5bf9\u63d0\u793a\u7684\u6709\u6548\u5355\u5143\u6d4b\u8bd5\u673a\u5236\uff0c\u96be\u4ee5\u9a8c\u8bc1\u5176\u5728\u5404\u79cd\u8f93\u5165\u4e0b\u7684\u884c\u4e3a\u4e00\u81f4\u6027 \u65e0\u6cd5\u50cf\u51fd\u6570\u4e00\u6837\u8fdb\u884c\u81ea\u52a8\u5316\u6d4b\u8bd5 \u534f\u4f5c\u969c\u788d \u975e\u6280\u672f\u4eba\u5458\uff08\u5982\u4ea7\u54c1\u7ecf\u7406\uff09\u96be\u4ee5\u53c2\u4e0e\u7ed3\u6784\u8bbe\u8ba1\uff0c\u56e0\u63d0\u793a\u8bcd\u6df7\u5408\u4e86\u903b\u8f91\u4e0e\u683c\u5f0f\u6307\u4ee4 \u4e1a\u52a1\u4eba\u5458\u770b\u4e0d\u61c2\u6280\u672f\u63d0\u793a"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#_5","title":"\u4f55\u65f6\u4ecd\u9700\u624b\u52a8\u7f16\u5199\u63d0\u793a\u5de5\u7a0b\uff1f","text":"<ol> <li>\u539f\u578b\u9a8c\u8bc1\u9636\u6bb5\uff1a\u5feb\u901f\u9a8c\u8bc1\u6982\u5ff5</li> <li>\u7b80\u5355\u683c\u5f0f\u8f93\u51fa\uff1a\u5355\u5c42CSV/\u7b80\u5355\u5217\u8868</li> <li>\u65e0LangChain\u73af\u5883\uff1a\u53d7\u9650\u73af\u5883\u4e0b\u7684\u4e34\u65f6\u65b9\u6848</li> <li>\u975e\u6280\u672f\u7528\u6237\uff1a\u9700\u907f\u514d\u4ee3\u7801\u4f9d\u8d56\u7684\u573a\u666f</li> </ol> <p>\u5efa\u8bae\uff1a\u5bf9\u4e8e\u751f\u4ea7\u7cfb\u7edf\uff0c\u4f18\u5148\u91c7\u7528<code>PydanticOutputParser</code>\u3001<code>OpenAI Function Calling</code>\u6216\u4e13\u7528\u8f93\u51fa\u89e3\u6790\u5e93\u3002\u624b\u52a8\u63d0\u793a\u4ec5\u4f5c\u4e3a\u4e34\u65f6\u65b9\u6848\uff0c\u5176\u7ef4\u62a4\u6210\u672c\u968f\u7cfb\u7edf\u590d\u6742\u5ea6\u5448\u6307\u6570\u7ea7\u589e\u957f\u3002 </p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#langchain","title":"\u4f7f\u7528langchain\u5b9e\u73b0\u7ed3\u6784\u5316\u8f93\u51fa","text":"<p>\u5728 langchain \u4e2d\u4f7f\u7528\u5185\u7f6e\u7684<code>Pydanticoutputparser</code>\u5b9e\u73b0\u4ece\u5927\u6a21\u578b\u7684\u8f93\u51fa\u4e2d\u89e3\u6790\u51fa\u7ed3\u6784\u5316\u7684\u6570\u636e\u3002</p> <p>\u6211\u4eec\u4f7f\u7528<code>PydanticOutputParser</code>\u7684\u4e3b\u8981\u597d\u5904\u5728\u4e8e\uff1a</p> <ol> <li>\u7ed3\u6784\u5316\u6570\u636e\uff1a<code>Pydantic</code>\u6a21\u578b\u53ef\u4ee5\u5b9a\u4e49\u6211\u4eec\u671f\u671b\u8f93\u51fa\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5305\u62ec\u5b57\u6bb5\u540d\u79f0\u3001\u7c7b\u578b\u548c\u63cf\u8ff0\uff0c\u4f7f\u5f97\u8f93\u51fa\u66f4\u52a0\u89c4\u8303\u3002</li> <li>\u7c7b\u578b\u5b89\u5168\uff1a<code>Pydantic</code>\u4f1a\u81ea\u52a8\u8fdb\u884c\u7c7b\u578b\u68c0\u67e5\uff0c\u5982\u679c\u6a21\u578b\u8f93\u51fa\u4e0d\u7b26\u5408\u5b9a\u4e49\uff0c\u4f1a\u629b\u51fa\u9519\u8bef\uff0c\u4fbf\u4e8e\u6211\u4eec\u6355\u83b7\u548c\u5904\u7406\u5f02\u5e38\u3002</li> <li>\u81ea\u52a8\u89e3\u6790\uff1a<code>LangChain</code>\u7684<code>PydanticOutputParser</code>\u53ef\u4ee5\u5c06\u8bed\u8a00\u6a21\u578b\u7684\u8f93\u51fa\u81ea\u52a8\u89e3\u6790\u6210\u6211\u4eec\u5b9a\u4e49\u7684<code>Pydantic</code>\u6a21\u578b\u5bf9\u8c61\uff0c\u7b80\u5316\u4e86\u4ee3\u7801\u3002</li> <li>\u63d0\u793a\u8bcd\u4f18\u5316\uff1a<code>Parser</code>\u53ef\u4ee5\u6839\u636e<code>Pydantic</code>\u6a21\u578b\u81ea\u52a8\u751f\u6210\u683c\u5f0f\u8bf4\u660e\uff0c\u51cf\u5c11\u624b\u52a8\u7f16\u5199\u63d0\u793a\u8bcd\u7684\u5de5\u4f5c\u91cf\uff0c\u5e76\u964d\u4f4e\u51fa\u9519\u6982\u7387\u3002</li> </ol> <p>\u5982\u4f55\u4f7f\u7528<code>LangChain</code>\u7684<code>PydanticOutputParser</code>\u5b9e\u73b0\u6a21\u578b\u7ed3\u6784\u5316\u8f93\u51fa\uff1f</p> <ol> <li>\u5b9a\u4e49Pydantic\u6a21\u578b\uff1a\u63cf\u8ff0\u671f\u671b\u8f93\u51fa\u7684\u6570\u636e\u7ed3\u6784\u3002</li> <li>\u521d\u59cb\u5316\u89e3\u6790\u5668\uff1a\u4f20\u5165\u5b9a\u4e49\u597d\u7684<code>Pydantic</code>\u6a21\u578b\u5230<code>PydanticOutputParse(pydantic_object=\u6a21\u578b)</code>\u3002</li> <li>\u6784\u5efa\u63d0\u793a\u8bcd\uff1a\u4f7f\u7528<code>PydanticOutputParser</code>\u7684<code>get_format_instructions</code>\u65b9\u6cd5\u83b7\u53d6\u683c\u5f0f\u6307\u4ee4\uff0c\u5e76\u52a0\u5165\u5230\u63d0\u793a\u8bcd\u4e2d\u3002</li> <li>\u8c03\u7528\u6a21\u578b\uff1a\u5c06\u63d0\u793a\u8bcd\u8f93\u5165\u6a21\u578b\uff0c\u5f97\u5230\u8f93\u51fa\u3002</li> <li>\u89e3\u6790\u8f93\u51fa\uff1a\u4f7f\u7528<code>PydanticOutputParser</code>\u7684 <code>parse</code>\u65b9\u6cd5\u89e3\u6790\u6a21\u578b\u7684\u8f93\u51fa\uff0c\u5f97\u5230\u7ed3\u6784\u5316\u7684\u6570\u636e\u5bf9\u8c61\u3002</li> </ol> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u5177\u4f53\u7684\u793a\u4f8b\uff0c\u901a\u8fc7\u7ed3\u6784\u5316\u8f93\u51fa\u4e00\u4e2a\u4e3b\u9898\u7684\u5404\u4e2a\u7ae0\u8282\u5217\u8868\uff0c\u5305\u542b\u590d\u6742\u5d4c\u5957\u7ed3\u6784\u7684\u5904\u7406\uff1a</p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#1-pydantic","title":"1. \u5b9a\u4e49Pydantic\u6a21\u578b","text":"<pre><code>from pydantic import BaseModel, Field\nfrom langchain.output_parsers import PydanticOutputParser\n\n# 1. \u5b9a\u4e49\u6570\u636e\u7ed3\u6784\u6a21\u578b (Pydantic)\nclass Section(BaseModel):\n    name: str = Field(\n        description=\"\u7ae0\u8282\u540d\u79f0\",\n    )\n    description: str = Field(\n        description=\"\u7b80\u8981\u6982\u8ff0\u672c\u7ae0\u8282\u6d89\u53ca\u7684\u4e3b\u8981\u4e3b\u9898\u548c\u6982\u5ff5\uff0c\u4e0d\u8d85\u8fc750\u5b57\",\n    )\n\n# Pydantic \u652f\u6301\u5d4c\u5957\u6a21\u578b\uff0c\u8f7b\u677e\u5904\u7406\u591a\u5c42\u6570\u636e\nclass Sections(BaseModel):\n    sections: List[Section] = Field(\n        description=\"\u62a5\u544a\u7684\u7ae0\u8282\u5217\u8868\",\n    )\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#2_1","title":"2. \u521d\u59cb\u5316\u89e3\u6790\u5668","text":"<pre><code># 2. \u521d\u59cb\u5316\u89e3\u6790\u5668\nparser = PydanticOutputParser(pydantic_object=Sections)\n\n# \u67e5\u770b\u751f\u6210\u7684\u683c\u5f0f\u6307\u4ee4\nformat_instructions = parser.get_format_instructions()\nprint(format_instructions)\n</code></pre> <p>\u8f93\u51fa\u7684promp\u5185\u5bb9\u5982\u4e0b\uff08\u8fd9\u4e2aprompt\u662f <code>PydanticOutputParser</code> \u6839\u636e\u63d0\u4f9b\u7684<code>Pydantic</code>\u6a21\u578b\u81ea\u52a8\u751f\u6210\u7684\uff09\uff1a</p> <pre><code>The output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\": \"Foo\", \"description\": \"a list of strings\", \"type\": \"array\", \"items\": {\"type\": \"string\"}}}, \"required\": [\"foo\"]}\nthe object {\"foo\": [\"bar\", \"baz\"]} is a well-formatted instance of the schema. The object {\"properties\": {\"foo\": [\"bar\", \"baz\"]}} is not well-formatted.\n\nHere is the output schema:\n```\n{\"$defs\": {\"Section\": {\"properties\": {\"name\": {\"description\": \"\u7ae0\u8282\u540d\u79f0\", \"title\": \"Name\", \"type\": \"string\"}, \"description\": {\"description\": \"\u7b80\u8981\u6982\u8ff0\u672c\u7ae0\u8282\u6d89\u53ca\u7684\u4e3b\u8981\u4e3b\u9898\u548c\u6982\u5ff5\", \"title\": \"Description\", \"type\": \"string\"}}, \"required\": [\"name\", \"description\"], \"title\": \"Section\", \"type\": \"object\"}}, \"properties\": {\"sections\": {\"description\": \"\u62a5\u544a\u7684\u7ae0\u8282\u5217\u8868\", \"items\": {\"$ref\": \"#/$defs/Section\"}, \"title\": \"Sections\", \"type\": \"array\"}}, \"required\": [\"sections\"]}\n```\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u8be5prompt\u6309\u7167\u524d\u9762\u624b\u52a8\u7f16\u5199\u63d0\u793a\u5de5\u7a0b\u7684\u6280\u5de7\uff1a</p> <ul> <li>\u660e\u786e\u8981\u6c42\u8f93\u51fa\u683c\u5f0f\u4e3aJSON\uff0c\u5e76\u4e14\u6307\u5b9a\u4e86\u5177\u4f53\u7684Schema\u3002</li> <li>\u901a\u8fc7\u793a\u4f8b\u5e2e\u52a9\u6a21\u578b\u7406\u89e3\u8981\u6c42\uff08\u5c55\u793a\u4e86\u6b63\u786e\u7684\u683c\u5f0f\u548c\u9519\u8bef\u7684\u683c\u5f0f\uff09\u3002</li> <li>\u63d0\u4f9b\u4e86\u8be6\u7ec6\u7684Schema\uff0c\u5305\u62ec\u6bcf\u4e2a\u5b57\u6bb5\u7684\u7c7b\u578b\u3001\u63cf\u8ff0\u548c\u662f\u5426\u5fc5\u9700\u3002</li> </ul> <p>\u5728LangChain\u7684PydanticOutputParser\u4e2d\uff0c\u6211\u4eec\u901a\u8fc7\u7f16\u7a0b\u65b9\u5f0f\u5b9a\u4e49\u6570\u636e\u7ed3\u6784\uff0c\u7136\u540e\u81ea\u52a8\u751f\u6210\u683c\u5f0f\u6307\u4ee4\uff0c\u8fd9\u6837\u66f4\u7b80\u6d01\uff0c\u4e14\u907f\u514d\u4e86\u624b\u52a8\u7f16\u5199\u590d\u6742\u7684Schema\u63cf\u8ff0\u3002 </p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#3_1","title":"3.\u6784\u5efa\u63d0\u793a\u8bcd\uff08\u5305\u542b\u683c\u5f0f\u8bf4\u660e\uff09","text":"<p>\u63a5\u4e0b\u6765\u9700\u8981\u5c06<code>format_instructions</code>\u7684\u683c\u5f0f\u6307\u4ee4\u653e\u5728<code>system_prompt</code>\u4e2d\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>topic = \"\u521b\u5efa\u5173\u4e8e LLM \u7f29\u653e\u5b9a\u5f8b\u7684\u62a5\u544a\"\nsystem_prompt = f\"\"\"\n\u8bf7\u751f\u6210\u62a5\u544a\u7ed3\u6784\uff0c\u4e25\u683c\u9075\u5b88\u4ee5\u4e0b\u8981\u6c42\uff1a\n{format_instructions}\n\u4e0d\u8981\u6dfb\u52a0\u4efb\u4f55\u989d\u5916\u6587\u672c\uff0c\u4ec5\u8f93\u51faJSON\u3002\n\"\"\"\nuser_prompt = f\"\"\"\n\u8fd9\u91cc\u662f\u62a5\u544a\u4e3b\u9898: {topic}\n\"\"\"\nmessages = [\n    {\"role\": \"system\", \"content\": system_prompt},\n    {\"role\": \"user\", \"content\": user_prompt}\n]\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#4_1","title":"4.\u8c03\u7528\u6a21\u578b","text":"<p>\u5c06\u63d0\u793a\u8bcd\u8f93\u5165\u6a21\u578b\uff0c\u5f97\u5230\u8f93\u51fa\u3002\u8fd9\u91cc\u4f7f\u7528 litellm \u8fdb\u884c\u6a21\u578b\u8c03\u7528\uff0c\u5173\u4e8e litellm \u7684\u4f7f\u7528\u53ef\u4ee5\u67e5\u770b\u6211\u524d\u9762\u7684\u6587\u7ae0\uff0c\u8c03\u7528\u6a21\u578b\u7684\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>import litellm\nfrom typing import Union, List, Dict, Optional\n\nmodel_config_dict = {\n    \"deepseek-chat\": {\n        \"model\": \"openai/deepseek-chat\",\n        \"base_url\": \"https://api.deepseek.com/v1\",\n        \"api_key\": os.getenv(\"DEEPSEEK_API_KEY\"),\n    },\n}\n\n\ndef llm_chat( messages: Union[str, List[Dict[str, str]]], model: str=\"deepseek-chat\",  tools: Optional[List] = None, stream=False):\n    print(f'\u8c03\u7528\u6a21\u578b\uff1a{model}')\n    model_config = model_config_dict.get(model)\n    if isinstance(messages, str):\n        messages = [{\"role\": \"user\", \"content\": messages}]\n\n    response = litellm.completion(\n        model=model_config.get('model'),\n        base_url=model_config.get('base_url'),\n        api_key=model_config.get('api_key'),\n        messages=messages,\n        tools=tools,\n        stream=stream,\n    )\n\n    return  response.choices[0].message\n\n\nresponse = llm_chat(messages)\n\nprint(response.content)\n</code></pre> <p>\u8c03\u7528\u6a21\u578b\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>```json\n{\n  \"sections\": [\n    {\n      \"name\": \"\u5f15\u8a00\",\n      \"description\": \"\u4ecb\u7ecdLLM\uff08\u5927\u578b\u8bed\u8a00\u6a21\u578b\uff09\u7684\u57fa\u672c\u6982\u5ff5\u548c\u7f29\u653e\u5b9a\u5f8b\u7684\u91cd\u8981\u6027\u3002\"\n    },\n    {\n      \"name\": \"LLM\u7f29\u653e\u5b9a\u5f8b\u7684\u5b9a\u4e49\",\n      \"description\": \"\u8be6\u7ec6\u89e3\u91caLLM\u7f29\u653e\u5b9a\u5f8b\u7684\u542b\u4e49\u53ca\u5176\u5728\u6a21\u578b\u6027\u80fd\u9884\u6d4b\u4e2d\u7684\u4f5c\u7528\u3002\"\n    },\n    {\n      \"name\": \"\u7f29\u653e\u5b9a\u5f8b\u7684\u6570\u5b66\u57fa\u7840\",\n      \"description\": \"\u63a2\u8ba8\u7f29\u653e\u5b9a\u5f8b\u80cc\u540e\u7684\u6570\u5b66\u539f\u7406\u548c\u5173\u952e\u516c\u5f0f\u3002\"\n    },\n    {\n      \"name\": \"\u5b9e\u8bc1\u7814\u7a76\",\n      \"description\": \"\u603b\u7ed3\u5173\u4e8eLLM\u7f29\u653e\u5b9a\u5f8b\u7684\u5b9e\u8bc1\u7814\u7a76\u7ed3\u679c\u548c\u4e3b\u8981\u53d1\u73b0\u3002\"\n    },\n    {\n      \"name\": \"\u5e94\u7528\u4e0e\u5f71\u54cd\",\n      \"description\": \"\u5206\u6790\u7f29\u653e\u5b9a\u5f8b\u5728\u5b9e\u9645LLM\u5f00\u53d1\u4e2d\u7684\u5e94\u7528\u53ca\u5176\u5bf9\u884c\u4e1a\u7684\u5f71\u54cd\u3002\"\n    },\n    {\n      \"name\": \"\u672a\u6765\u7814\u7a76\u65b9\u5411\",\n      \"description\": \"\u63d0\u51fa\u5173\u4e8eLLM\u7f29\u653e\u5b9a\u5f8b\u672a\u6765\u53ef\u80fd\u7684\u7814\u7a76\u65b9\u5411\u548c\u6311\u6218\u3002\"\n    },\n    {\n      \"name\": \"\u7ed3\u8bba\",\n      \"description\": \"\u603b\u7ed3\u62a5\u544a\u7684\u4e3b\u8981\u89c2\u70b9\u548c\u7f29\u653e\u5b9a\u5f8b\u5728LLM\u53d1\u5c55\u4e2d\u7684\u91cd\u8981\u6027\u3002\"\n    }\n  ]\n}\n```\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#5","title":"5.\u89e3\u6790\u8f93\u51fa","text":"<p>\u4ece\u524d\u9762\u53ef\u4ee5\u770b\u5230\u6a21\u578b\u8f93\u51fa\u7684\u7ed3\u679c\u4e0d\u662f\u4e00\u4e2a\u5b58\u7cb9\u7684json\u5b57\u7b26\u4e32\uff0c\u5305\u542b\u7279\u6b8a\u7b26\u53f7<code>```json</code>\uff0c\u6240\u4ee5\u8fd8\u9700\u8981\u4f7f\u7528<code>PydanticOutputParser</code>\u7684 <code>parse</code>\u65b9\u6cd5\u89e3\u6790\u6a21\u578b\u7684\u8f93\u51fa\uff0c\u5f97\u5230\u7ed3\u6784\u5316\u7684\u6570\u636e\u5bf9\u8c61\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code># 5. \u4f7f\u7528PydanticOutputParser\u7684 parse \u65b9\u6cd5\u89e3\u6790\u6a21\u578b\u7684\u8f93\u51fa\ncontent = response.content\nresult: Sections = parser.parse(content)\nprint(result)\n</code></pre> <p>\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>sections=[Section(name='\u5f15\u8a00', description='\u4ecb\u7ecdLLM\uff08\u5927\u578b\u8bed\u8a00\u6a21\u578b\uff09\u7684\u57fa\u672c\u6982\u5ff5\u548c\u7f29\u653e\u5b9a\u5f8b\u7684\u91cd\u8981\u6027\u3002'), Section(name='LLM\u7f29\u653e\u5b9a\u5f8b\u7684\u5b9a\u4e49', description='\u8be6\u7ec6\u89e3\u91caLLM\u7f29\u653e\u5b9a\u5f8b\u7684\u542b\u4e49\u53ca\u5176\u5728\u6a21\u578b\u6027\u80fd\u9884\u6d4b\u4e2d\u7684\u4f5c\u7528\u3002'), Section(name='\u7f29\u653e\u5b9a\u5f8b\u7684\u6570\u5b66\u57fa\u7840', description='\u63a2\u8ba8\u7f29\u653e\u5b9a\u5f8b\u80cc\u540e\u7684\u6570\u5b66\u539f\u7406\u548c\u5173\u952e\u516c\u5f0f\u3002'), Section(name='\u5b9e\u8bc1\u7814\u7a76', description='\u603b\u7ed3\u5173\u4e8eLLM\u7f29\u653e\u5b9a\u5f8b\u7684\u5b9e\u8bc1\u7814\u7a76\u7ed3\u679c\u548c\u4e3b\u8981\u53d1\u73b0\u3002'), Section(name='\u5e94\u7528\u4e0e\u5f71\u54cd', description='\u5206\u6790\u7f29\u653e\u5b9a\u5f8b\u5728\u5b9e\u9645LLM\u5f00\u53d1\u4e2d\u7684\u5e94\u7528\u53ca\u5176\u5bf9\u884c\u4e1a\u7684\u5f71\u54cd\u3002'), Section(name='\u672a\u6765\u7814\u7a76\u65b9\u5411', description='\u63d0\u51fa\u5173\u4e8eLLM\u7f29\u653e\u5b9a\u5f8b\u672a\u6765\u53ef\u80fd\u7684\u7814\u7a76\u65b9\u5411\u548c\u6311\u6218\u3002'), Section(name='\u7ed3\u8bba', description='\u603b\u7ed3\u62a5\u544a\u7684\u4e3b\u8981\u89c2\u70b9\u548c\u7f29\u653e\u5b9a\u5f8b\u5728LLM\u53d1\u5c55\u4e2d\u7684\u91cd\u8981\u6027\u3002')]\n</code></pre> <p>\u4f7f\u7528 <code>pydantic</code> \u7684 <code>model_dump_json()</code> \u67e5\u770bjson\u5b57\u7b26\u4e32</p> <pre><code>json_result = result.model_dump_json()\nprint(json_result)\n</code></pre> <p>\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>{\n    \"sections\": [\n        {\n            \"name\": \"\u5f15\u8a00\",\n            \"description\": \"\u4ecb\u7ecdLLM\uff08\u5927\u578b\u8bed\u8a00\u6a21\u578b\uff09\u7684\u57fa\u672c\u6982\u5ff5\u548c\u7f29\u653e\u5b9a\u5f8b\u7684\u91cd\u8981\u6027\u3002\"\n        },\n        {\n            \"name\": \"LLM\u7f29\u653e\u5b9a\u5f8b\u7684\u5b9a\u4e49\",\n            \"description\": \"\u8be6\u7ec6\u89e3\u91caLLM\u7f29\u653e\u5b9a\u5f8b\u7684\u542b\u4e49\u53ca\u5176\u5728\u6a21\u578b\u6027\u80fd\u9884\u6d4b\u4e2d\u7684\u4f5c\u7528\u3002\"\n        },\n        {\n            \"name\": \"\u7f29\u653e\u5b9a\u5f8b\u7684\u6570\u5b66\u57fa\u7840\",\n            \"description\": \"\u63a2\u8ba8\u7f29\u653e\u5b9a\u5f8b\u80cc\u540e\u7684\u6570\u5b66\u539f\u7406\u548c\u5173\u952e\u516c\u5f0f\u3002\"\n        },\n        {\n            \"name\": \"\u5b9e\u8bc1\u7814\u7a76\",\n            \"description\": \"\u603b\u7ed3\u5173\u4e8eLLM\u7f29\u653e\u5b9a\u5f8b\u7684\u5b9e\u8bc1\u7814\u7a76\u7ed3\u679c\u548c\u4e3b\u8981\u53d1\u73b0\u3002\"\n        },\n        {\n            \"name\": \"\u5e94\u7528\u4e0e\u5f71\u54cd\",\n            \"description\": \"\u5206\u6790\u7f29\u653e\u5b9a\u5f8b\u5728\u5b9e\u9645LLM\u5f00\u53d1\u4e2d\u7684\u5e94\u7528\u53ca\u5176\u5bf9\u884c\u4e1a\u7684\u5f71\u54cd\u3002\"\n        },\n        {\n            \"name\": \"\u672a\u6765\u7814\u7a76\u65b9\u5411\",\n            \"description\": \"\u63d0\u51fa\u5173\u4e8eLLM\u7f29\u653e\u5b9a\u5f8b\u672a\u6765\u53ef\u80fd\u7684\u7814\u7a76\u65b9\u5411\u548c\u6311\u6218\u3002\"\n        },\n        {\n            \"name\": \"\u7ed3\u8bba\",\n            \"description\": \"\u603b\u7ed3\u62a5\u544a\u7684\u4e3b\u8981\u89c2\u70b9\u548c\u7f29\u653e\u5b9a\u5f8b\u5728LLM\u53d1\u5c55\u4e2d\u7684\u91cd\u8981\u6027\u3002\"\n        }\n    ]\n}\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#parse","title":"parse\u65b9\u6cd5\u6e90\u7801\u5206\u6790","text":"<p>\u67e5\u770b <code>PydanticOutputParser.parse()</code>\u65b9\u6cd5\u7684\u6e90\u7801\uff0c\u770b\u770b\u5b83\u5230\u5e95\u5e2e\u6211\u4eec\u505a\u4e86\u4ec0\u4e48\uff0c\u9996\u5148\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u63d0\u53d6json\u5b57\u7b26\u4e32\uff1a</p> <pre><code>_json_markdown_re = re.compile(r\"```(json)?(.*)\", re.DOTALL)\n# Try to find JSON string within triple backticks\nmatch = _json_markdown_re.search(json_string)\n# If no match found, assume the entire string is a JSON string\n# Else, use the content within the backticks\njson_str = json_string if match is None else match.group(2)\n</code></pre> <p>\u7136\u540e\u4f7f\u7528\u4e0b\u9762\u7684\u4ee3\u7801\u8fdb\u884cjson\u5b57\u7b26\u4e32\u8865\u5168\uff1a</p> <pre><code>def parse_partial_json(s: str, *, strict: bool = False) -&gt; Any:\n    \"\"\"Parse a JSON string that may be missing closing braces.\n\n    Args:\n        s: The JSON string to parse.\n        strict: Whether to use strict parsing. Defaults to False.\n\n    Returns:\n        The parsed JSON object as a Python dictionary.\n    \"\"\"\n    # Attempt to parse the string as-is.\n    try:\n        return json.loads(s, strict=strict)\n    except json.JSONDecodeError:\n        pass\n\n    # Initialize variables.\n    new_chars = []\n    stack = []\n    is_inside_string = False\n    escaped = False\n\n    # Process each character in the string one at a time.\n    for char in s:\n        new_char = char\n        if is_inside_string:\n            if char == '\"' and not escaped:\n                is_inside_string = False\n            elif char == \"\\n\" and not escaped:\n                new_char = (\n                    \"\\\\n\"  # Replace the newline character with the escape sequence.\n                )\n            elif char == \"\\\\\":\n                escaped = not escaped\n            else:\n                escaped = False\n        elif char == '\"':\n            is_inside_string = True\n            escaped = False\n        elif char == \"{\":\n            stack.append(\"}\")\n        elif char == \"[\":\n            stack.append(\"]\")\n        elif char in {\"}\", \"]\"}:\n            if stack and stack[-1] == char:\n                stack.pop()\n            else:\n                # Mismatched closing character; the input is malformed.\n                return None\n\n        # Append the processed character to the new string.\n        new_chars.append(new_char)\n\n    # If we're still inside a string at the end of processing,\n    # we need to close the string.\n    if is_inside_string:\n        if escaped:  # Remoe unterminated escape character\n            new_chars.pop()\n        new_chars.append('\"')\n\n    # Reverse the stack to get the closing characters.\n    stack.reverse()\n\n    # Try to parse mods of string until we succeed or run out of characters.\n    while new_chars:\n        # Close any remaining open structures in the reverse\n        # order that they were opened.\n        # Attempt to parse the modified string as JSON.\n        try:\n            return json.loads(\"\".join(new_chars + stack), strict=strict)\n        except json.JSONDecodeError:\n            # If we still can't parse the string as JSON,\n            # try removing the last character\n            new_chars.pop()\n\n    # If we got here, we ran out of characters to remove\n    # and still couldn't parse the string as JSON, so return the parse error\n    # for the original string.\n    return json.loads(s, strict=strict)\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#_6","title":"\u5b8c\u6574\u7684\u7ed3\u6784\u5316\u8f93\u51fa\u4ee3\u7801","text":"<pre><code>from pydantic import BaseModel, Field\nfrom langchain.output_parsers import PydanticOutputParser\nimport litellm\nfrom typing import Union, List, Dict, Optional\n\n\nmodel_config_dict = {\n    \"deepseek-chat\": {\n        \"model\": \"openai/deepseek-chat\",\n        \"base_url\": \"https://api.deepseek.com/v1\",\n        \"api_key\": os.getenv(\"DEEPSEEK_API_KEY\"),\n    },\n}\n\n\ndef llm_chat( messages: Union[str, List[Dict[str, str]]], model: str=\"deepseek-chat\",  tools: Optional[List] = None, stream=False):\n    print(f'\u8c03\u7528\u6a21\u578b\uff1a{model}')\n    model_config = model_config_dict.get(model)\n    if isinstance(messages, str):\n        messages = [{\"role\": \"user\", \"content\": messages}]\n\n    response = litellm.completion(\n        model=model_config.get('model'),\n        base_url=model_config.get('base_url'),\n        api_key=model_config.get('api_key'),\n        messages=messages,\n        tools=tools,\n        stream=stream,\n    )\n\n    return  response.choices[0].message\n\n# 1. \u5b9a\u4e49\u6570\u636e\u7ed3\u6784\u6a21\u578b (Pydantic)\nclass Section(BaseModel):\n    name: str = Field(\n        description=\"\u7ae0\u8282\u540d\u79f0\",\n    )\n    description: str = Field(\n        description=\"\u7b80\u8981\u6982\u8ff0\u672c\u7ae0\u8282\u6d89\u53ca\u7684\u4e3b\u8981\u4e3b\u9898\u548c\u6982\u5ff5\",\n    )\n\n# Pydantic \u652f\u6301\u5d4c\u5957\u6a21\u578b\uff0c\u8f7b\u677e\u5904\u7406\u591a\u5c42\u6570\u636e\nclass Sections(BaseModel):\n    sections: List[Section] = Field(\n        description=\"\u62a5\u544a\u7684\u7ae0\u8282\u5217\u8868\",\n    )\n\n# 2. \u521d\u59cb\u5316\u89e3\u6790\u5668\nparser = PydanticOutputParser(pydantic_object=Sections)\n\n# \u67e5\u770b\u751f\u6210\u7684\u683c\u5f0f\u6307\u4ee4\nformat_instructions = parser.get_format_instructions()\nprint(format_instructions)\n\n# 3.\u6784\u5efa\u63d0\u793a\u8bcd\uff08\u5305\u542b\u683c\u5f0f\u8bf4\u660e\uff09\ntopic = \"\u521b\u5efa\u5173\u4e8e LLM \u7f29\u653e\u5b9a\u5f8b\u7684\u62a5\u544a\"\n\nsystem_prompt = f\"\"\"\u8bf7\u751f\u6210\u62a5\u544a\u7ed3\u6784\uff0c\u4e25\u683c\u9075\u5b88\u4ee5\u4e0b\u8981\u6c42\uff1a\n{format_instructions}\n\u4e0d\u8981\u6dfb\u52a0\u4efb\u4f55\u989d\u5916\u6587\u672c\uff0c\u4ec5\u8f93\u51faJSON\u3002\n\"\"\"\nuser_prompt = f\"\"\"\u8fd9\u91cc\u662f\u62a5\u544a\u4e3b\u9898: {topic}\"\"\"\nmessages = [\n    {\"role\": \"system\", \"content\": system_prompt},\n    {\"role\": \"user\", \"content\": user_prompt}\n]\nprint(messages)\n\n# 4.\u8c03\u7528\u6a21\u578b\n\nresponse = llm_chat(messages)\n\ncontent = response.content\nprint(content)\n\n# 5. \u4f7f\u7528PydanticOutputParser\u7684 parse \u65b9\u6cd5\u89e3\u6790\u6a21\u578b\u7684\u8f93\u51fa\ncontent = response.content\nresult: Sections = parser.parse(content)\nprint(result)\njson_result = result.model_dump_json()\nprint(json_result)\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#_7","title":"\u4f7f\u7528\u652f\u6301\u51fd\u6570\u8c03\u7528\u7684\u6a21\u578b\u5b9e\u73b0\u7ed3\u6784\u5316\u8f93\u51fa","text":"<p>\u6211\u4eec\u4f7f\u7528 LangChain \u7684 <code>.with_structured_output()</code> \u65b9\u6cd5\u6765\u5b9e\u73b0\u7ed3\u6784\u5316\u8f93\u51fa\uff0c\u8fd9\u662f LangChain \u63d0\u4f9b\u7684\u4e00\u4e2a\u9ad8\u7ea7\u62bd\u8c61\uff0c\u5b83\u7b80\u5316\u4e86\u4ece\u6a21\u578b\u4e2d\u83b7\u53d6\u7ed3\u6784\u5316\u8f93\u51fa\u7684\u8fc7\u7a0b\u3002\u8fd9\u4e2a\u65b9\u6cd5\u901a\u5e38\u4e0e\u652f\u6301\u5de5\u5177\u8c03\u7528\u6216\u51fd\u6570\u8c03\u7528\u7684\u6a21\u578b\u4e00\u8d77\u4f7f\u7528\u3002</p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#_8","title":"\u4e3a\u4ec0\u4e48\u6a21\u578b\u5177\u6709\u51fd\u6570\u8c03\u7528\u529f\u80fd\uff1f","text":"<p>\u51fd\u6570\u8c03\u7528\uff08\u6216\u5de5\u5177\u8c03\u7528\uff09\u529f\u80fd\u662f\u6307\u5927\u6a21\u578b\uff08\u5982 OpenAI \u7684 GPT-4 \u7b49\uff09\u80fd\u591f\u6839\u636e\u7528\u6237\u8bf7\u6c42\u548c\u9884\u5b9a\u4e49\u7684\u51fd\u6570\u63cf\u8ff0\uff0c\u8f93\u51fa\u4e00\u4e2a\u7b26\u5408\u51fd\u6570\u53c2\u6570\u7684\u8c03\u7528\u8bf7\u6c42\u3002\u8fd9\u79cd\u80fd\u529b\u4f7f\u5f97\u6a21\u578b\u80fd\u591f\u4e0e\u5916\u90e8\u5de5\u5177\u6216API\u8fdb\u884c\u4ea4\u4e92\uff0c\u4ece\u800c\u6267\u884c\u5177\u4f53\u7684\u64cd\u4f5c\uff08\u5982\u67e5\u8be2\u5929\u6c14\u3001\u8ba1\u7b97\u7b49\uff09\u6216\u8005\u8fd4\u56de\u7ed3\u6784\u5316\u7684\u6570\u636e\u3002 \u6a21\u578b\u4e4b\u6240\u4ee5\u5177\u6709\u51fd\u6570\u8c03\u7528\u529f\u80fd\uff0c\u662f\u56e0\u4e3a\u5728\u8bad\u7ec3\u8fc7\u7a0b\u4e2d\uff0c\u5b83\u4eec\u63a5\u89e6\u5230\u4e86\u5305\u542b\u51fd\u6570\u8c03\u7528\u793a\u4f8b\u7684\u6570\u636e\uff0c\u6216\u8005\u901a\u8fc7\u5fae\u8c03\uff08fine-tuning\uff09\u6765\u5b66\u4e60\u5982\u4f55\u6839\u636e\u7528\u6237\u6307\u4ee4\u548c\u51fd\u6570\u63cf\u8ff0\u751f\u6210\u6b63\u786e\u7684\u51fd\u6570\u8c03\u7528\u53c2\u6570\u3002\u5728\u63a8\u7406\u65f6\uff0c\u6211\u4eec\u901a\u8fc7\u63d0\u4f9b\u51fd\u6570\u7684\u63cf\u8ff0\uff08\u540d\u79f0\u3001\u63cf\u8ff0\u3001\u53c2\u6570\u53ca\u5176\u7c7b\u578b\uff09\u6765\u5f15\u5bfc\u6a21\u578b\u751f\u6210\u76f8\u5e94\u7684\u8c03\u7528\u3002</p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#_9","title":"\u4f7f\u7528\u793a\u4f8b","text":"<p>\u4e0b\u9762\u6211\u4eec\u4ee5 OpenAI \u7684\u6a21\u578b\uff08\u652f\u6301\u51fd\u6570\u8c03\u7528\uff09\u548c Pydantic \u6a21\u578b\u4e3a\u4f8b\uff0c\u5c55\u793a\u5982\u4f55\u4f7f\u7528 <code>.with_structured_output()</code>\u3002</p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#1-pydantic_1","title":"\u6b65\u9aa4 1\uff1a\u5b9a\u4e49 Pydantic \u6a21\u578b","text":"<pre><code>from pydantic import BaseModel, Field\nclass Person(BaseModel):\n    name: str = Field(description=\"The person's name\")\n    age: int = Field(description=\"The person's age\")\n    hobbies: list[str] = Field(description=\"The person's hobbies\")\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#2_2","title":"\u6b65\u9aa4 2\uff1a\u521b\u5efa\u6a21\u578b\u5e76\u7ed1\u5b9a\u7ed3\u6784\u5316\u8f93\u51fa","text":"<pre><code>from langchain_openai import ChatOpenAI\n# \u521b\u5efa\u652f\u6301\u51fd\u6570\u8c03\u7528\u7684\u6a21\u578b\u5b9e\u4f8b\nmodel = ChatOpenAI(model=\"gpt-3.5-turbo\", temperature=0)\n# \u4f7f\u7528 with_structured_output \u7ed1\u5b9a\u8f93\u51fa\u7ed3\u6784\nstructured_model = model.with_structured_output(Person)\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#3_2","title":"\u6b65\u9aa4 3\uff1a\u8c03\u7528\u6a21\u578b\u83b7\u53d6\u7ed3\u6784\u5316\u8f93\u51fa","text":"<pre><code># \u76f4\u63a5\u8c03\u7528\uff0c\u8fd4\u56de\u7684\u662f Person \u5b9e\u4f8b\nresult = structured_model.invoke(\"John Doe is a 30 year old who likes hiking and reading.\")\nprint(result)\n# \u8f93\u51fa\uff1aname='John Doe' age=30 hobbies=['hiking', 'reading']\n</code></pre>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#_10","title":"\u5e95\u5c42\u8fc7\u7a0b\u89e3\u6790","text":"<ol> <li>\u6784\u9020\u5de5\u5177\uff08\u51fd\u6570\uff09\u63cf\u8ff0\uff1a\u5728\u5185\u90e8\uff0c<code>with_structured_output</code> \u65b9\u6cd5\u4f1a\u6839\u636e <code>Person</code> \u6a21\u578b\u751f\u6210\u4e00\u4e2a JSON Schema\uff0c\u7136\u540e\u521b\u5efa\u4e00\u4e2a LangChain \u5de5\u5177\uff08<code>Tool</code>\uff09\u6216\u51fd\u6570\uff08<code>Function</code>\uff09\uff0c\u5176\u53c2\u6570\u5c31\u662f\u8fd9\u4e2a JSON Schema\u3002\u4f8b\u5982\uff0c\u5728OpenAI\u7684API\u4e2d\uff0c\u4f60\u53ef\u4ee5\u8fd9\u6837\u5b9a\u4e49\uff1a</li> </ol> <pre><code>{\n  \"name\": \"get_user_info\",\n  \"description\": \"\u83b7\u53d6\u7528\u6237\u4fe1\u606f\",\n  \"parameters\": {\n    \"type\": \"object\",\n    \"properties\": {\n      \"name\": {\n        \"type\": \"string\",\n        \"description\": \"\u7528\u6237\u7684\u59d3\u540d\"\n      },\n      \"age\": {\n        \"type\": \"integer\",\n        \"description\": \"\u7528\u6237\u7684\u5e74\u9f84\"\n      }\n    },\n    \"required\": [\"name\", \"age\"]\n  }\n}\n</code></pre> <ol> <li>\u8c03\u7528\u6a21\u578b\uff1a\u5f53\u8c03\u7528 <code>invoke</code> \u65f6\uff0c\u6a21\u578b\u4f1a\u63a5\u6536\u5230\uff1a<ul> <li>\u7528\u6237\u7684\u6d88\u606f\uff08\u5373\u8f93\u5165\u7684\u5b57\u7b26\u4e32\uff09</li> <li>\u53ef\u7528\u7684\u5de5\u5177\u5217\u8868\uff08\u5305\u542b\u6211\u4eec\u5b9a\u4e49\u7684\u8fd9\u4e2a\u865a\u62df\u5de5\u5177\uff09</li> </ul> </li> <li>\u6a21\u578b\u51b3\u7b56\uff1a\u6a21\u578b\u4f1a\u5224\u65ad\u662f\u5426\u9700\u8981\u8c03\u7528\u5de5\u5177\u3002\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u56e0\u4e3a\u8981\u6c42\u7ed3\u6784\u5316\u8f93\u51fa\uff0c\u6240\u4ee5\u6a21\u578b\u4f1a\u8fd4\u56de\u4e00\u4e2a\u5de5\u5177\u8c03\u7528\u8bf7\u6c42\uff0c\u5176\u4e2d\u53c2\u6570\u90e8\u5206\u5c31\u662f\u6839\u636e\u7528\u6237\u8f93\u5165\u586b\u5145\u7684 <code>Person</code> \u6570\u636e\u3002</li> <li>\u89e3\u6790\u5de5\u5177\u8c03\u7528\uff1aLangChain \u8fd0\u884c\u65f6\u6355\u83b7\u8fd9\u4e2a\u5de5\u5177\u8c03\u7528\uff0c\u63d0\u53d6\u53c2\u6570\uff0c\u5e76\u5c06\u5176\u8f6c\u6362\u4e3a <code>Person</code> \u5bf9\u8c61\u3002</li> </ol>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#_11","title":"\u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u8fd9\u79cd\u65b9\u6cd5\u4f9d\u8d56\u4e8e\u6a21\u578b\u5bf9\u51fd\u6570\u8c03\u7528\u7684\u652f\u6301\u3002\u5982\u679c\u6a21\u578b\u4e0d\u652f\u6301\u51fd\u6570\u8c03\u7528\uff0c\u5219\u53ef\u80fd\u65e0\u6cd5\u4f7f\u7528\u6b64\u65b9\u6cd5\u3002</li> <li>\u4f7f\u7528\u7ed3\u6784\u5316\u8f93\u51fa\u65f6\uff0c\u6a21\u578b\u7684\u6e29\u5ea6\uff08temperature\uff09\u901a\u5e38\u8bbe\u7f6e\u4e3a0\uff0c\u4ee5\u589e\u52a0\u8f93\u51fa\u7684\u786e\u5b9a\u6027\u3002</li> </ul>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#_12","title":"\u603b\u7ed3","text":"<p><code>with_structured_output()</code> \u65b9\u6cd5\u901a\u8fc7\u5229\u7528\u6a21\u578b\u7684\u51fd\u6570\u8c03\u7528\u80fd\u529b\uff0c\u5c06\u8f93\u51fa\u7ea6\u675f\u5728\u9884\u5b9a\u4e49\u7684\u7ed3\u6784\u4e2d\uff0c\u4ece\u800c\u7b80\u5316\u4e86\u4ece\u5927\u8bed\u8a00\u6a21\u578b\u83b7\u53d6\u7ed3\u6784\u5316\u6570\u636e\u7684\u8fc7\u7a0b\u3002\u5176\u6838\u5fc3\u5728\u4e8e\u5c06\u8f93\u51fa\u89e3\u6790\u5668\uff08\u5982Pydantic\u6a21\u578b\uff09\u8f6c\u6362\u4e3a\u51fd\u6570\u63cf\u8ff0\uff0c\u5f15\u5bfc\u6a21\u578b\u751f\u6210\u7ed3\u6784\u5316\u7684\u51fd\u6570\u8c03\u7528\u53c2\u6570\uff0c\u7136\u540e\u5c06\u5176\u89e3\u6790\u4e3a\u5bf9\u8c61\u3002\u8fd9\u79cd\u65b9\u6cd5\u6bd4\u624b\u52a8\u7f16\u5199\u63d0\u793a\u8bcd\u548c\u89e3\u6790\u6587\u672c\u8f93\u51fa\u66f4\u53ef\u9760\u3001\u66f4\u7b80\u6d01\u3002</p>"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#_13","title":"\u5bf9\u6bd4\u89e3\u51b3\u65b9\u6848\u7684\u4f18\u52bf","text":"\u95ee\u9898\u7ef4\u5ea6 \u624b\u52a8\u63d0\u793a\u5de5\u7a0b PydanticOutputParser/LangChain \u7c7b\u578b\u5b89\u5168 \u274c \u65e0\u4fdd\u969c \u2705 \u81ea\u52a8\u9a8c\u8bc1\u5b57\u6bb5\u7c7b\u578b\u548c\u8303\u56f4 \u9519\u8bef\u6062\u590d \u274c \u9700\u5b8c\u5168\u624b\u52a8\u5904\u7406 \u2705 \u5185\u7f6eRetryOutputParser\u81ea\u52a8\u91cd\u8bd5 \u5d4c\u5957\u7ed3\u6784 \u26a0\ufe0f \u6781\u96be\u5b9e\u73b0 \u2705 \u539f\u751f\u652f\u6301\u5d4c\u5957\u6a21\u578b/\u8054\u5408\u7c7b\u578b \u63d0\u793a\u8bcd\u7ef4\u62a4 \u274c \u5b8c\u5168\u624b\u52a8 \u2705 \u81ea\u52a8\u751f\u6210\u683c\u5f0f\u6307\u4ee4 \u591a\u6a21\u578b\u9002\u914d \u274c \u9700\u4e3a\u6bcf\u4e2a\u6a21\u578b\u5b9a\u5236 \u2705 \u7edf\u4e00\u63a5\u53e3\u9002\u914d\u4e3b\u6d41\u6a21\u578b \u5de5\u7a0b\u5316\u652f\u6301 \u274c \u65e0 \u2705 \u96c6\u6210\u6d4b\u8bd5/\u7248\u672c\u63a7\u5236/CI/CD"},{"location":"%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%A6%82%E4%BD%95%E8%AE%A9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE/#_14","title":"\u7ed3\u8bba","text":"<p>\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u6211\u4eec\u63a8\u8350\u4f7f\u7528 PydanticOutputParser \u6216 LangChain \u7684 <code>.with_structured_output()</code> \u65b9\u6cd5\u6765\u5b9e\u73b0\u7ed3\u6784\u5316\u8f93\u51fa\u3002\u8fd9\u4e24\u79cd\u65b9\u6cd5\u90fd\u63d0\u4f9b\u4e86\u7c7b\u578b\u5b89\u5168\u3001\u81ea\u52a8\u9519\u8bef\u6062\u590d\u548c\u5d4c\u5957\u7ed3\u6784\u652f\u6301\u7b49\u4f18\u52bf\uff0c\u540c\u65f6\u4e5f\u7b80\u5316\u4e86\u63d0\u793a\u8bcd\u7ef4\u62a4\u548c\u591a\u6a21\u578b\u9002\u914d\u7684\u5de5\u4f5c\u3002 \u5982\u679c\u6a21\u578b\u4e0d\u652f\u6301\u51fd\u6570\u8c03\u7528\uff0c\u6211\u4eec\u63a8\u8350\u4f7f\u7528 <code>PydanticOutputParser</code> \u6765\u5b9e\u73b0\u7ed3\u6784\u5316\u8f93\u51fa\uff0c<code>PydanticOutputParser</code>\u5b9e\u9645\u4e0a\u662f\u901a\u8fc7\u63d0\u793a\u8bcd\u6765\u5b9e\u73b0\u7ed3\u6784\u5316\u8f93\u51fa\u3002 \u5982\u679c\u6a21\u578b\u652f\u6301\u51fd\u6570\u8c03\u7528\uff0c\u6211\u4eec\u63a8\u8350\u4f7f\u7528 <code>.with_structured_output()</code> \u65b9\u6cd5\uff0c\u5b83\u5229\u7528\u6a21\u578b\u7684\u51fd\u6570\u8c03\u7528\u80fd\u529b\uff0c\u5c06\u8f93\u51fa\u7ea6\u675f\u5728\u9884\u5b9a\u4e49\u7684\u7ed3\u6784\u4e2d\uff0c\u4ece\u800c\u7b80\u5316\u4e86\u4ece\u5927\u8bed\u8a00\u6a21\u578b\u83b7\u53d6\u7ed3\u6784\u5316\u6570\u636e\u7684\u8fc7\u7a0b\u3002</p> <p>\u53c2\u8003\u6587\u6863</p> <ol> <li>https://python.langchain.com/docs/how_to/structured_output/</li> </ol>"},{"location":"%E5%B7%A5%E5%85%B7/%E4%BD%BF%E7%94%A8%E8%BF%87%E7%9A%84%E5%BC%80%E6%BA%90%E5%B7%A5%E5%85%B7/","title":"\u4f7f\u7528\u8fc7\u7684\u5f00\u6e90\u5de5\u5177","text":"\u5f00\u6e90\u5de5\u5177 \u63cf\u8ff0 \u5b98\u65b9\u6587\u6863 \u5feb\u901f\u5b89\u88c5\u6587\u6863 \u5b89\u88c5\u5230k8s kubernetes \u5bb9\u5668\u7f16\u6392\u5de5\u5177 k8s \u5b98\u7f51 k8s \u5feb\u901f\u5b89\u88c5 gitlab \u4ee3\u7801\u6258\u7ba1\u5e73\u53f0 gitlab \u5b98\u7f51 gitlab \u5feb\u901f\u5b89\u88c5 nexus maven \u4ed3\u5e93\u7ba1\u7406\u5de5\u5177 nexus \u5b98\u7f51 nexus \u5feb\u901f\u5b89\u88c5 jenkins devops\u6301\u7eed\u96c6\u6210\u5de5\u5177 jenkins \u5b98\u7f51 jenkins \u5feb\u901f\u5b89\u88c5 kuboard k8s\u56fe\u5f62\u5316\u7ba1\u7406\u5de5\u5177 kuboard \u5b98\u7f51 kuboard \u5feb\u901f\u5b89\u88c5 torna \u4f01\u4e1a\u63a5\u53e3\u6587\u6863\u89e3\u51b3\u65b9\u6848 torna \u5b98\u7f51 torna \u5feb\u901f\u5b89\u88c5 sornaqube \u4ee3\u7801\u8d28\u91cf\u7ba1\u7406\u5e73\u53f0 sornaqube \u5b98\u7f51 sornaqub \u5feb\u901f\u6309\u7167 skywalking \u5206\u5e03\u5f0f\u94fe\u8def\u8ffd\u8e2a\u4e0e\u76d1\u63a7\u5e73\u53f0 skywaking \u5b98\u7f51 skywalking \u5feb\u901f\u5b89\u88c5 kubeview k8s \u8d44\u6e90\u53ef\u89c6\u5316\u5de5\u5177 kubeview \u5b98\u7f51 kubeview \u5feb\u901f\u5b89\u88c5 apisix \u4e91\u539f\u751f\u7f51\u5173\u5e73\u53f0 apisix \u5b98\u7f51 apisix \u5feb\u901f\u5b89\u88c5 xxl-job \u5206\u5e03\u5f0f\u4efb\u52a1\u8c03\u5ea6\u5e73\u53f0 xxl-job \u5b98\u7f51 xxl-job \u5feb\u901f\u5b89\u88c5"},{"location":"%E7%88%AC%E8%99%AB/selenium%E5%A6%82%E4%BD%95%E6%8B%96%E5%8A%A8%E6%BB%9A%E5%8A%A8%E6%9D%A1/","title":"selenium \u5982\u4f55\u62d6\u52a8\u6eda\u52a8\u6761\uff1f","text":""},{"location":"%E7%88%AC%E8%99%AB/selenium%E5%A6%82%E4%BD%95%E6%8B%96%E5%8A%A8%E6%BB%9A%E5%8A%A8%E6%9D%A1/#_1","title":"\u4e00. \u95ee\u9898\u63cf\u8ff0","text":"<p>\u6709\u4e00\u4e9b\u7279\u6b8a\u7f51\u9875\uff0c\u9700\u8981\u6a21\u62df\u70b9\u51fb\u5e76\u4e14\u6709\u65f6\u5019\u9700\u8981\u62d6\u52a8\u6eda\u52a8\u6761\u624d\u80fd\u663e\u793a\u5b8c\u6574\u7684\u5185\u5bb9\uff0c\u4e3e\u4e00\u4e2a\u4f8b\u5b50\uff0c\u6bd4\u5982\u4eba\u6c11\u65e5\u62a5\u5ba2\u6237\u7aef\u7684\u7f51\u9875\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u9700\u8981\u70b9\u51fb\u9605\u8bfb\u5168\u6587\u624d\u80fd\u663e\u793a\u5b8c\u6574\u7684\u5185\u5bb9\uff0c\u5e76\u4e14\u7f51\u9875\u7684\u56fe\u7247\u9700\u8981\u62d6\u52a8\u6eda\u52a8\u6761\u5230\u56fe\u7247\u7684\u4f4d\u7f6e\u624d\u80fd\u663e\u793a\u56fe\u7247\u5185\u5bb9\uff0c\u5982\u679c\u9700\u8981\u83b7\u53d6\u8fd9\u79cd\u7f51\u9875\u7684\u5185\u5bb9\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>python + selenium</code> \u6a21\u62df\u6d4f\u89c8\u5668\u7684\u884c\u4e3a\u6765\u83b7\u53d6\u3002</p>"},{"location":"%E7%88%AC%E8%99%AB/selenium%E5%A6%82%E4%BD%95%E6%8B%96%E5%8A%A8%E6%BB%9A%E5%8A%A8%E6%9D%A1/#_2","title":"\u4e8c. \u89e3\u51b3\u65b9\u6cd5","text":"<p>\u5173\u4e8e selenium \u7684\u5b89\u88c5\u4e0e\u4f7f\u7528\u53ef\u4ee5\u67e5\u770b\u8fd9\u7bc7\u6587\u7ae0\uff1ahttps://juejin.cn/post/6996973391328575525</p>"},{"location":"%E7%88%AC%E8%99%AB/selenium%E5%A6%82%E4%BD%95%E6%8B%96%E5%8A%A8%E6%BB%9A%E5%8A%A8%E6%9D%A1/#1-js","title":"1. \u4f7f\u7528 js \u811a\u672c\u76f4\u63a5\u62d6\u52a8\u6eda\u52a8\u6761\u5230\u5e95\u90e8","text":"<pre><code># document.body.scrollHeight \u662f\u7528\u6765\u83b7\u53d6\u6eda\u52a8\u6761\u7684\u9ad8\u5ea6\njs = 'window.scrollTo(0, document.body.scrollHeight)'\ndriver.execute_script(js)\n</code></pre> <p>\u6216\u8005</p> <pre><code>js = \"var q=document.documentElement.scrollTop=10000\"\ndriver.execute_script(js)\n</code></pre>"},{"location":"%E7%88%AC%E8%99%AB/selenium%E5%A6%82%E4%BD%95%E6%8B%96%E5%8A%A8%E6%BB%9A%E5%8A%A8%E6%9D%A1/#2-js","title":"2. \u4f7f\u7528 js \u811a\u672c\u62d6\u52a8\u6eda\u52a8\u6761\u5230\u6307\u5b9a\u4f4d\u7f6e","text":"<pre><code>target = driver.find_element_by_class_name(\"class_name\")\ndriver.execute_script(\"arguments[0].scrollIntoView();\", target) # \u62d6\u52a8\u5230\u53ef\u89c1\u7684\u5143\u7d20\u53bb\n</code></pre> <p>\u8fd9\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u5c06\u6eda\u52a8\u6761\u62d6\u52a8\u5230\u9700\u8981\u663e\u793a\u7684\u5143\u7d20\u4f4d\u7f6e\uff0c\u6b64\u65b9\u6cd5\u7528\u9014\u6bd4\u8f83\u5e7f\u3002</p> <p>\u6bd4\u5982\u9700\u8981\u62d6\u52a8\u6eda\u52a8\u6761\u5230\u6700\u540e\u4e00\u4e2a\u56fe\u7247\u663e\u793a\u7684\u4f4d\u7f6e\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u65b9\u5f0f\uff1a</p> <pre><code>time.sleep(1)\n# \u4f7f\u7528 xpath \u83b7\u53d6\u6700\u540e\u4e00\u4e2a\u56fe\u7247\ntarget = driver.find_element_by_xpath('(//img)[last()]')\ndriver.execute_script(\"arguments[0].scrollIntoView();\", target)  # \u62d6\u52a8\u5230\u53ef\u89c1\u7684\u5143\u7d20\u53bb\n</code></pre> <p>\u5bf9\u4e8e\u56fe\u7247\u7f51\u7ad9\uff0c\u901a\u8fc7\u6eda\u52a8\u6761\u4e0b\u62c9\u52a0\u8f7d\u56fe\u7247\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e0a\u8ff0\u65b9\u5f0f\u5b9e\u73b0\u3002</p>"},{"location":"%E7%88%AC%E8%99%AB/selenium%E5%A6%82%E4%BD%95%E6%8B%96%E5%8A%A8%E6%BB%9A%E5%8A%A8%E6%9D%A1/#3-js","title":"3. \u4f7f\u7528 js \u811a\u672c\u7f13\u6162\u62d6\u52a8\u6eda\u52a8\u6761","text":"<p>\u6709\u7684\u7f51\u9875\u56fe\u7247\u9700\u8981\u62d6\u52a8\u6eda\u52a8\u6761\u5230\u56fe\u7247\u7684\u4f4d\u7f6e\u624d\u80fd\u663e\u793a\u56fe\u7247\u5185\u5bb9\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u65b9\u5f0f\u7f13\u6162\u62d6\u52a8\u6eda\u52a8\u6761\uff1a</p> <pre><code>js = \"return document.body.scrollHeight\"\n# \u83b7\u53d6\u6eda\u52a8\u6761\u7684\u9ad8\u5ea6\nnew_height = driver.execute_script(js)\nfor i in range(0, new_height, 350):\n    time.sleep(0.05)\n    driver.execute_script('window.scrollTo(0, %s)' % i)\n</code></pre> <p>\u8fd9\u91cc\u5b9e\u73b0\u65b9\u5f0f\u662f\uff0c\u5148\u83b7\u53d6\u6eda\u52a8\u6761\u7684\u9ad8\u5ea6\uff0c\u518d\u901a\u8fc7 <code>range(start, stop, step)</code> \u51fd\u6570\u6bcf\u6b21 350 \u7684\u95f4\u8ddd\u62d6\u52a8\u3002</p>"},{"location":"%E7%88%AC%E8%99%AB/selenium%E5%A6%82%E4%BD%95%E6%8B%96%E5%8A%A8%E6%BB%9A%E5%8A%A8%E6%9D%A1/#4-selenium","title":"4. selenium \u5982\u4f55\u5224\u65ad\u5143\u7d20\u662f\u5426\u5b58\u5728","text":"<p>\u7b2c\u4e00\u79cd\u65b9\u5f0f\uff1a\u6355\u83b7\u5f02\u5e38</p> <pre><code>def isElementExist(driver, class_name):\n    try:\n        el = driver.find_element_by_class_name(class_name)\n        return True\n    except Exception as e:\n        logging.error(e)\n        return False\n</code></pre> <p>\u7b2c\u4e8c\u79cd\u65b9\u5f0f\uff1afind_elements \u65b9\u6cd5</p> <pre><code>def is_element_exist(driver, class_name):\n    el = driver.find_elements_by_class_name(class_name)\n    if len(el) &gt; 0:\n        return True\n    else:\n        return False\n</code></pre>"},{"location":"%E7%88%AC%E8%99%AB/selenium%E5%A6%82%E4%BD%95%E6%8B%96%E5%8A%A8%E6%BB%9A%E5%8A%A8%E6%9D%A1/#_3","title":"\u56db. \u83b7\u53d6\u5ba2\u6237\u7aef\u7f51\u9875\u6570\u636e\u7684\u5b8c\u6574\u4ee3\u7801","text":"<pre><code>import time\n\nfrom lxml import etree\nfrom selenium import webdriver\nfrom selenium.webdriver import DesiredCapabilities\nfrom selenium.webdriver.common.by import By\nfrom selenium.webdriver.support import expected_conditions as EC  # \u548c\u4e0b\u9762WebDriverWait\u4e00\u8d77\u7528\u7684\nfrom selenium.webdriver.support.wait import WebDriverWait\n\n\ndef get_news_content(url):\n    \"\"\"\n    \u89e3\u6790\u7f51\u9875\u5185\u5bb9\n    :param url: \n    :return: \n    \"\"\"\n    html = html_selenium_firefox(url)\n    tree = etree.HTML(html)\n    title = tree.xpath('//h1[@class=\"title\"]/text()')[0]\n    pubtime = tree.xpath('//span[@class=\"pr10\"]/text()')\n    pubtime = pubtime[0] if len(pubtime) &gt; 0 else ''\n    source = tree.xpath('//span[@class=\"pr10 head-info-copyfrom\"]/text()')\n    source = source[0] if len(source) &gt; 0 else '\u4eba\u6c11\u65e5\u62a5'\n    img_urls = tree.xpath('//img/@src')\n\n    result = {\n        \"title\": title,\n        \"pubtime\": pubtime,\n        \"source\": source,\n        \"img_urls\": img_urls,\n    }\n    return result\n\n\ndef html_selenium_firefox(url):\n    \"\"\"\n    \u4f7f\u7528 selenium \u83b7\u53d6\u7f51\u9875\u5185\u5bb9\n    :param url: \n    :return: \n    \"\"\"\n    driver = webdriver.Remote(\n        command_executor='http://localhost:4444/wd/hub',\n        desired_capabilities=DesiredCapabilities.FIREFOX,\n    )\n    # \u9690\u5f0f\u7b49\u5f85\n    driver.implicitly_wait(10)\n    # \u8bf7\u6c42\u9875\u9762\n    driver.get(url)\n    # \u663e\u5f0f\u7b49\u5f85\uff1a\u663e\u5f0f\u5730\u7b49\u5f85\u67d0\u4e2a\u5143\u7d20\u88ab\u52a0\u8f7d\n    wait = WebDriverWait(driver, 5)\n    wait.until(EC.presence_of_element_located((By.TAG_NAME, 'span')))\n    handle_selenium_content(driver, url)\n    time.sleep(2)\n    html = driver.page_source\n    driver.quit()\n    return html\n\n\ndef handle_selenium_content(driver, url):\n    \"\"\"\n    \u6a21\u62df\u70b9\u51fb\u548c\u6eda\u52a8\u6eda\u52a8\u6761\n    :param driver: \n    :param url: \n    :return: \n    \"\"\"\n    if 'wap.peopleapp.com' in url:\n        class_name = 'read-more-zhankai'\n        if is_element_exist(driver, class_name):\n            i = driver.find_element_by_class_name(class_name)\n            i.click()\n        js = \"return document.body.scrollHeight\"\n        new_height = driver.execute_script(js)\n        for i in range(0, new_height, 350):\n            time.sleep(0.05)\n            driver.execute_script('window.scrollTo(0, %s)' % i)\n\n\ndef is_element_exist(driver, class_name):\n    \"\"\"\n    \u5224\u65ad\u5143\u7d20\u662f\u5426\u5b58\u5728\n    :param driver: \n    :param class_name: \n    :return: \n    \"\"\"\n    el = driver.find_elements_by_class_name(class_name)\n    if len(el) &gt; 0:\n        return True\n    else:\n        return False\n\n\nif __name__ == '__main__':\n    url = \"https://wap.peopleapp.com/article/6305024/6198096\"\n    result = get_news_content(url)\n    print(result)\n</code></pre> <p>\u53c2\u8003\u6587\u6863\uff1a</p> <p>https://zhuanlan.zhihu.com/p/343516637</p> <p>https://www.cnblogs.com/landhu/p/5761794.html</p>"},{"location":"%E7%88%AC%E8%99%AB/%E3%80%90%E7%88%AC%E8%99%AB%E3%80%91docker%E9%83%A8%E7%BD%B2python%2Bselenium%2Bfirefox-headless/","title":"\u3010\u722c\u866b\u3011docker \u90e8\u7f72 python + selenium + firefox-headless","text":"<p>\u5916\u89c2\u5f80\u5f80\u548c\u4e8b\u7269\u7684\u672c\u8eab\u5b8c\u5168\u4e0d\u7b26\uff0c\u4e16\u4eba\u90fd\u5bb9\u6613\u4e3a\u8868\u9762\u7684\u88c5\u9970\u6240\u6b3a\u9a97\u3002\u2014\u2014 \u838e\u58eb\u6bd4\u4e9a \u300a\u5a01\u5c3c\u65af\u5546\u4eba\u300b</p>"},{"location":"%E7%88%AC%E8%99%AB/%E3%80%90%E7%88%AC%E8%99%AB%E3%80%91docker%E9%83%A8%E7%BD%B2python%2Bselenium%2Bfirefox-headless/#_1","title":"\u4e00. \u6982\u8ff0","text":"<p>\u4e0a\u4e00\u7bc7\u6587\u7ae0 \u3010\u722c\u866b\u3011python+selenium+firefox\u4f7f\u7528\u4e0e\u90e8\u7f72\u8be6\u89e3 \u4ecb\u7ecd\u4e86 <code>selenium</code> \u4f20\u7edf\u65b9\u5f0f\u90e8\u7f72\u4e0e\u4f7f\u7528\uff0c\u9700\u8981\u5b89\u88c5\u6d4f\u89c8\u5668\u3001\u5b89\u88c5\u6d4f\u89c8\u5668\u5bf9\u5e94\u7684\u9a71\u52a8\u7b49\uff0c\u5bf9\u4e8e\u6211\u6765\u8bf4\u914d\u7f6e\u8fd8\u662f\u6bd4\u8f83\u7e41\u7410\uff0c\u6709\u6ca1\u6709\u6ca1\u6709\u7b80\u5355\u7684\u914d\u7f6e\u65b9\u5f0f\u5462\uff1f\u6709\uff0c\u90a3\u5c31\u662f\u4f7f\u7528 <code>docker</code> \u6765\u90e8\u7f72\uff0c\u63a5\u4e0b\u6765\u5c06\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 <code>docker</code> \u90e8\u7f72 <code>python + selenium + firefox-headless</code>\u3002</p>"},{"location":"%E7%88%AC%E8%99%AB/%E3%80%90%E7%88%AC%E8%99%AB%E3%80%91docker%E9%83%A8%E7%BD%B2python%2Bselenium%2Bfirefox-headless/#docker-seleniumstandalone-firefox","title":"\u4e8c. docker \u5b89\u88c5 selenium/standalone-firefox","text":"<p>selenium docker hub \u5730\u5740\uff1ahttps://hub.docker.com/u/selenium</p> <p>\u8bbf\u95ee\u4e0a\u9762\u7684\u5730\u5740\uff0c\u9009\u62e9\u4e00\u4e2a\u5bf9\u5e94\u6d4f\u89c8\u5668\u955c\u50cf\uff0c\u8fd9\u91cc\u9009\u62e9 <code>selenium/standalone-firefox</code>\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"%E7%88%AC%E8%99%AB/%E3%80%90%E7%88%AC%E8%99%AB%E3%80%91docker%E9%83%A8%E7%BD%B2python%2Bselenium%2Bfirefox-headless/#_2","title":"\u5feb\u901f\u5f00\u59cb","text":"<p>\u66f4\u591a\u914d\u7f6e\u4e0e\u4f7f\u7528\u53ef\u4ee5\u67e5\u770b github\uff1ahttps://github.com/SeleniumHQ/docker-selenium</p> <ol> <li>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u542f\u52a8\u4e00\u4e2a <code>Firefox</code> \u7684 <code>docker</code> \u5bb9\u5668\uff1a</li> </ol> <pre><code>$ docker run --name firefox -d -p 4444:4444 -p 7900:7900 --shm-size=\"2g\" selenium/standalone-firefox:3.141\n</code></pre> <ol> <li>\u8bbf\u95ee http://localhost:4444 \u6d4b\u8bd5 <code>webDriver</code>\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</li> </ol> <p></p> <ol> <li>\u8bbf\u95ee http://localhost:4444/wd/hub/static/resource/hub.html \u8df3\u8f6c\u5230 selenium \u63a7\u5236\u53f0\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</li> </ol> <p></p> <p>\u6ce8\u610f\uff1a</p> <ol> <li>\u5f53\u4e3a\u5305\u542b\u6d4f\u89c8\u5668\u7684\u955c\u50cf\u6267\u884cdocker\u8fd0\u884c\u65f6\uff0c\u8bf7\u4f7f\u7528\u6807\u5fd7 <code>--shm-size 2g</code> \u6765\u4f7f\u7528\u4e3b\u673a\u7684\u5171\u4eab\u5185\u5b58</li> <li>\u59cb\u7ec8\u4f7f\u7528\u5e26\u6709\u5b8c\u6574\u6807\u7b7e\u7684 Docker \u955c\u50cf\u6765\u56fa\u5b9a\u7279\u5b9a\u7684\u6d4f\u89c8\u5668\u548c\u7f51\u683c\u7248\u672c\u3002</li> </ol> <p>\u4e3a\u4ec0\u4e48\u9700\u8981\u8bbe\u7f6e <code>--shm-size 2g</code>\uff1a</p> <p>\u8fd9\u662f\u4e00\u4e2a\u5df2\u77e5\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u4ee5\u907f\u514d\u5728docker\u5bb9\u5668\u5185\u6d4f\u89c8\u5668\u5d29\u6e83\uff0c2gb\u7684shm\u5927\u5c0f\u662f\u4efb\u610f\u7684\uff0c\u4f46\u5df2\u77e5\u53ef\u4ee5\u5f88\u597d\u5730\u5de5\u4f5c\uff0c\u60a8\u7684\u7279\u5b9a\u7528\u4f8b\u53ef\u80fd\u9700\u8981\u4e0d\u540c\u7684\u503c\uff0c\u5efa\u8bae\u6839\u636e\u60a8\u7684\u9700\u8981\u8c03\u6574\u8fd9\u4e2a\u503c\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u8fdb\u5165\u5230 firefox \u5bb9\u5668\u4e2d\uff1a</p> <pre><code>docker exec -it firefox bash\n</code></pre> <p>\u4f7f\u7528\u4e0b\u9762\u547d\u4ee4\uff0c\u53ef\u4ee5\u770b\u5230\u5bb9\u5668\u4e2d\u5df2\u7ecf\u5b89\u88c5\u597d\u4e86 <code>firefox</code> \u548c <code>geckodriver</code>\uff1a</p> <pre><code>seluser@67be1f8cd61f:/opt$ ls -al /opt\ntotal 8228\ndrwxr-xr-x 1 root root    4096 Jul 29 08:49 .\ndrwxr-xr-x 1 root root    4096 Aug 15 08:02 ..\ndrwxr-xr-x 1 root root    4096 Jul 29 08:52 bin\ndrwxr-xr-x 7 root root    4096 Jul 29 08:49 firefox-latest\n-rwxr-xr-x 1 1000 1000 8401832 Apr  8 22:01 geckodriver-0.29.1\ndrwxrwxrwx 1 root root    4096 Jul 29 08:44 selenium\n</code></pre>"},{"location":"%E7%88%AC%E8%99%AB/%E3%80%90%E7%88%AC%E8%99%AB%E3%80%91docker%E9%83%A8%E7%BD%B2python%2Bselenium%2Bfirefox-headless/#webdriverremote","title":"\u4e09. \u4f7f\u7528 webdriver.Remote() \u914d\u7f6e\u8fdc\u7a0b\u6d4f\u89c8\u5668","text":"<p><code>selenium</code> \u63d0\u4f9b\u4e86 <code>webdriver.Remote()</code>\u901a\u8fc7\u53d1\u9001\u547d\u4ee4\u5230\u8fdc\u7a0b\u670d\u52a1\u5668\u6765\u63a7\u5236\u6d4f\u89c8\u5668\uff0c\u53ef\u4ee5\u4f7f\u6267\u884c\u6d4b\u8bd5\u7684\u673a\u5668\u548c\u53d1\u9001\u6d4b\u8bd5\u547d\u4ee4\u7684\u673a\u5668\u72ec\u7acb\u5f00\u6765\u3002</p> <p>\u5173\u4e8e <code>webdriver.Remote()</code>\u7684\u914d\u7f6e\u4f7f\u7528\u975e\u5e38\u7b80\u5355\uff0c\u4e0d\u9700\u8981\u50cf\u524d\u9762\u6587\u7ae0\u63d0\u5230\u7684\u6307\u5b9a\u5404\u79cd\u914d\u7f6e\uff0c\u5176\u53c2\u6570\u9ed8\u8ba4\u5982\u4e0b\uff1a</p> <pre><code>selenium.webdriver.remote.webdriver.WebDriver \ndef __init__(self,\n             command_executor: str = 'http://127.0.0.1:4444/wd/hub',\n             desired_capabilities: Any = None,\n             browser_profile: Any = None,\n             proxy: Any = None,\n             keep_alive: bool = False,\n             file_detector: Any = None,\n             options: Any = None) -&gt; Any\n</code></pre> <p>\u4f7f\u7528\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>from selenium import webdriver\nfrom selenium.webdriver import DesiredCapabilities\n\nif __name__ == '__main__':\n    driver = webdriver.Remote(\n        # \u6307\u5b9a\u8fdc\u7a0b\u6d4f\u89c8\u5668\u7684\u5730\u5740\n        command_executor='http://localhost:4444/wd/hub',\n        # \u6307\u5b9a\u671f\u671b\u7684\u6d4f\u89c8\u5668\u7c7b\u578b\uff0c\u8fd9\u91cc\u5b89\u88c5\u7684\u662f firefox \u6240\u4ee5\u6307\u5b9afirefox\n        desired_capabilities=DesiredCapabilities.FIREFOX,\n    )\n    # \u53d1\u9001\u8bf7\u6c42\n    driver.get(\"https://www.baidu.com\")\n    # \u83b7\u53d6\u7f51\u9875\u6e90\u7801\n    html = driver.page_source\n    print(html)\n    # \u83b7\u53d6\u7f51\u9875title\n    title = driver.title\n    print(title)  # \u767e\u5ea6\u4e00\u4e0b\uff0c\u4f60\u5c31\u77e5\u9053\n    # \u83b7\u53d6\u5f53\u524d\u7f51\u9875\u7684 url\n    current_url = driver.current_url\n    print(current_url)  # https://www.baidu.com/\n    # \u9000\u51fa\u9a71\u52a8\uff0c\u5173\u95ed\u6240\u6709\u5173\u8054\u7684\u7a97\u53e3\n    driver.quit()\n</code></pre> <p>\u5f53\u4f7f\u7528 <code>driver.close()</code> \u5173\u95ed\u5f53\u524d\u7a97\u53e3\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u770b\u5230 selenium \u63a7\u5236\u53f0\u4f1a\u4ea7\u751f\u4e00\u4e2a\u4f1a\u8bdd\uff0c\u5e76\u4e14\u6ca1\u6709\u81ea\u52a8\u5173\u95ed\u4f1a\u8bdd\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u8fd9\u91cc\u8fd0\u884c\u4e86\u4e09\u6b21\u4ea7\u751f\u4e86\u4e09\u4e2a\u4f1a\u8bdd\uff0c\u5982\u679c\u4f7f\u7528 <code>driver.quit()</code> \u4f1a\u81ea\u52a8\u5173\u95ed\u5173\u8054\u7684\u6240\u6709\u4f1a\u8bdd\uff0c\u4e0d\u4f1a\u4fdd\u7559\u4f1a\u8bdd id \u5728\u63a7\u5236\u53f0\u3002</p>"},{"location":"%E7%88%AC%E8%99%AB/%E3%80%90%E7%88%AC%E8%99%AB%E3%80%91docker%E9%83%A8%E7%BD%B2python%2Bselenium%2Bfirefox-headless/#driver-webdriverremote","title":"driver = webdriver.Remote() \u5e38\u7528\u65b9\u6cd5\u4e0e\u5c5e\u6027\uff1a","text":"<pre><code>driver.get(url)\n</code></pre> <p>\u5728\u5f53\u524d\u6d4f\u89c8\u5668\u4f1a\u8bdd\u4e2d\u8bbf\u95ee\u4f20\u5165\u7684url\u5730\u5740\u3002</p> <p>\u7528\u6cd5\uff1a<code>driver.get('https://www.baidu.com')</code></p> <pre><code>driver.close()\n</code></pre> <p>\u5173\u95ed\u6d4f\u89c8\u5668\u5f53\u524d\u7a97\u53e3\u3002</p> <pre><code>driver.quit()\n</code></pre> <p>\u9000\u51fawebdriver\u5e76\u5173\u95ed\u6240\u6709\u7a97\u53e3\u3002</p> <pre><code>driver.refresh()\n</code></pre> <p>\u5237\u65b0\u5f53\u524d\u9875\u9762\u3002</p> <pre><code>driver.title\n</code></pre> <p>\u83b7\u53d6\u5f53\u524d\u9875\u7684\u6807\u9898\u3002</p> <pre><code>driver.page_source\n</code></pre> <p>\u83b7\u53d6\u5f53\u524d\u9875\u6e32\u67d3\u540e\u7684\u6e90\u4ee3\u7801\u3002</p> <pre><code>driver.current_url\n</code></pre> <p>\u83b7\u53d6\u5f53\u524d\u9875\u9762\u7684url\u3002</p> <pre><code>driver.window_handles\n</code></pre> <p>\u83b7\u53d6\u5f53\u524d\u4f1a\u8bdd\u4e2d\u6240\u6709\u7a97\u53e3\u7684\u53e5\u67c4\uff0c\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u5217\u8868\u3002</p>"},{"location":"%E7%88%AC%E8%99%AB/%E3%80%90%E7%88%AC%E8%99%AB%E3%80%91docker%E9%83%A8%E7%BD%B2python%2Bselenium%2Bfirefox-headless/#python-selenium","title":"\u56db. python + selenium \u914d\u7f6e\u8fdc\u7a0b\u6d4f\u89c8\u5668\u83b7\u53d6\u4eca\u65e5\u5934\u6761\u6570\u636e","text":"<p>\u4e0a\u4e00\u7bc7\u6587\u7ae0\u4e2d\u83b7\u53d6\u4eca\u65e5\u5934\u6761\u6570\u636e\u7684\u4ee3\u7801\u914d\u7f6e\u8fdc\u7a0b\u6d4f\u89c8\u5668\u4fee\u6539\u5982\u4e0b\uff1a</p> <pre><code>from lxml import etree\nfrom selenium import webdriver\nfrom selenium.webdriver import DesiredCapabilities\nfrom selenium.webdriver.common.by import By\nfrom selenium.webdriver.support import expected_conditions as EC  # \u548c\u4e0b\u9762WebDriverWait\u4e00\u8d77\u7528\u7684\nfrom selenium.webdriver.support.wait import WebDriverWait\n\n\ndef html_selenium_firefox(url):\n    \"\"\"\n    \u6839\u636e url \u4f7f\u7528 selenium \u83b7\u53d6\u7f51\u9875\u6e90\u7801\n    :param url: url\n    :return: \u7f51\u9875\u6e90\u7801\n    \"\"\"\n    driver = webdriver.Remote(\n        # \u6307\u5b9a\u8fdc\u7a0b\u6d4f\u89c8\u5668\u7684\u5730\u5740\n        command_executor='http://localhost:4444/wd/hub',\n        # \u6307\u5b9a\u671f\u671b\u7684\u6d4f\u89c8\u5668\u7c7b\u578b\uff0c\u8fd9\u91cc\u5b89\u88c5\u7684\u662f firefox \u6240\u4ee5\u6307\u5b9afirefox\n        desired_capabilities=DesiredCapabilities.FIREFOX,\n    )\n    # \u53d1\u9001\u8bf7\u6c42\n    driver.get(url)\n    # \u663e\u5f0f\u7b49\u5f85\uff1a\u663e\u5f0f\u5730\u7b49\u5f85\u67d0\u4e2a\u5143\u7d20\u88ab\u52a0\u8f7d\n    wait = WebDriverWait(driver, 20)\n    wait.until(EC.presence_of_element_located((By.CLASS_NAME, 'article-content')))\n    wait.until(EC.presence_of_element_located((By.TAG_NAME, 'span')))\n    # \u83b7\u53d6\u7f51\u9875\u6e90\u7801\n    html = driver.page_source\n    # \u5173\u95ed\u6d4f\u89c8\u5668\u91ca\u653e\u8d44\u6e90\n    driver.quit()\n    return html\n\n\ndef get_news_content(url):\n    html = html_selenium_firefox(url)\n    tree = etree.HTML(html)\n    title = tree.xpath('//div[@class=\"article-content\"]/h1/text()')[0]\n    # xpath \u67e5\u627e\u6ca1\u6709 class \u7684\u5143\u7d20\uff1aspan[not(@class)]\n    pubtime = tree.xpath('//div[@class=\"article-meta mt-4\"]/span[not(@class)]/text()')[0]\n    # xpath \u67e5\u627e class=\"name\" \u7684\u5143\u7d20\uff1aspan[@class=\"name\"]\n    source = tree.xpath('//div[@class=\"article-meta mt-4\"]/span[@class=\"name\"]/a/text()')[0]\n    # xpath \u67d0\u4e2a\u6807\u7b7e\u4e2d\u7684\u6240\u6709\u5143\u7d20\uff1a//div\n    content = tree.xpath('//article')[0]\n    # \u5904\u7406 content \u4e71\u7801\u95ee\u9898\n    content = str(etree.tostring(content, encoding='utf-8', method='html'), 'utf-8')\n    # \u63d0\u53d6 content \u4e2d\u6240\u6709\u56fe\u7247\u7684\u5730\u5740\n    images = etree.HTML(content).xpath('//img/@src')\n\n    result = {\n        \"title\": title,\n        \"pubtime\": pubtime,\n        \"source\": source,\n        \"content\": content,\n        \"images\": images,\n    }\n    return result\n\n\nif __name__ == '__main__':\n    url = \"https://www.toutiao.com/a6969138023774667264/\"\n    result = get_news_content(url)\n    print(result)\n</code></pre> <p>\u53c2\u8003\u6587\u6863\uff1a</p> <p>https://github.com/SeleniumHQ/docker-selenium</p>"},{"location":"%E7%88%AC%E8%99%AB/%E3%80%90%E7%88%AC%E8%99%AB%E3%80%91python%2Bselenium%2Bfirefox%E4%BD%BF%E7%94%A8%E4%B8%8E%E9%83%A8%E7%BD%B2%E8%AF%A6%E8%A7%A3/","title":"\u3010\u722c\u866b\u3011python+selenium+firefox\u4f7f\u7528\u4e0e\u90e8\u7f72\u8be6\u89e3","text":"<p>\u6211\u7684\u68a6\u60f3\uff0c\u503c\u5f97\u6211\u672c\u4eba\u53bb\u4e89\u53d6\uff0c\u6211\u4eca\u5929\u7684\u751f\u6d3b\uff0c\u7edd\u4e0d\u662f\u6211\u6628\u5929\u751f\u6d3b\u7684\u51b7\u6de1\u6284\u88ad\u3002\u2014\u2014 \u53f8\u6c64\u8fbe\u300a\u7ea2\u4e0e\u9ed1\u300b</p>"},{"location":"%E7%88%AC%E8%99%AB/%E3%80%90%E7%88%AC%E8%99%AB%E3%80%91python%2Bselenium%2Bfirefox%E4%BD%BF%E7%94%A8%E4%B8%8E%E9%83%A8%E7%BD%B2%E8%AF%A6%E8%A7%A3/#_1","title":"\u4e00. \u6982\u8ff0","text":"<p>\u4ee5\u524d\u5bf9\u722c\u866b\u611f\u5174\u8da3\u5b66\u4e60\u4e86 <code>requests</code>\u3001<code>scrapy</code> \u7b49 <code>python</code> \u5e93\u7528\u6765\u722c\u53d6\u4e00\u4e9b\u7f51\u7ad9\u6570\u636e\uff0c\u6700\u8fd1\u521a\u597d\u7531\u4e8e\u9700\u8981\uff0c\u53c8\u5f00\u59cb\u505a\u4e00\u4e9b\u722c\u866b\u76f8\u5173\u7684\u5de5\u4f5c\uff0c\u5199\u672c\u6587\u7684\u76ee\u7684\u662f\u5c06\u81ea\u5df1\u5b66\u4e60\u8fc7\u7a0b\u548c\u9047\u5230\u7684\u95ee\u9898\u8bb0\u5f55\u4e0b\u6765\uff0c\u4e00\u65b9\u9762\u5de9\u56fa\u5b66\u4e60\u7684\u77e5\u8bc6\uff0c\u53e6\u4e00\u65b9\u9762\u5e0c\u671b\u5bf9\u9047\u5230\u540c\u6837\u95ee\u9898\u7684\u670b\u53cb\u63d0\u4f9b\u4e00\u4e9b\u5e2e\u52a9\u3002</p> <p>\u672c\u6587\u4e3b\u8981\u4ece\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\u4ecb\u7ecd\uff08\u8fd9\u4e5f\u662f\u81ea\u5df1\u5b66\u4e60\u7684\u8fc7\u7a0b\uff09\uff1a</p> <ol> <li> <p>\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528 selenium </p> </li> <li> <p>\u4f20\u7edf\u65b9\u5f0f\u914d\u7f6e\u4f7f\u7528 selenium</p> </li> </ol>"},{"location":"%E7%88%AC%E8%99%AB/%E3%80%90%E7%88%AC%E8%99%AB%E3%80%91python%2Bselenium%2Bfirefox%E4%BD%BF%E7%94%A8%E4%B8%8E%E9%83%A8%E7%BD%B2%E8%AF%A6%E8%A7%A3/#selenium","title":"\u4e8c. \u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528 selenium","text":"<p>\u5728\u4f7f\u7528\u722c\u866b\u5de5\u5177\u6bd4\u5982 <code>requests</code> \u65f6\u5019\uff0c\u4f7f\u7528 <code>requests.get(url)</code>\u547d\u4ee4\u83b7\u53d6\u7f51\u9875\u5185\u5bb9\uff0c\u53d1\u73b0\u6ca1\u6709\u6211\u4eec\u9700\u8981\u7684\u5185\u5bb9\uff0c\u90a3\u662f\u56e0\u4e3a\u6709\u4e9b\u7f51\u9875\u662f\u524d\u540e\u7aef\u5206\u79bb\uff0c\u9700\u8981\u6d4f\u89c8\u5668\u6267\u884c <code>js</code> \u811a\u672c\u901a\u8fc7 <code>ajax</code> \u8bf7\u6c42\u83b7\u53d6\u6570\u636e\u518d\u6e32\u67d3\u5230\u9875\u9762\uff0c\u76f4\u63a5\u8bf7\u6c42\u8fd9\u4e2a\u9875\u9762\u5730\u5740\u7684\u8bdd\uff0c\u5f97\u5230\u7684html\u4e0a\u9762\u662f\u6ca1\u6709\u6570\u636e\u7684\u3002\u6709\u4e9b\u7f51\u7ad9\u7684\u7f51\u9875\u662f\u901a\u8fc7 <code>js</code> \u751f\u6210\u7684\uff0c\u5e76\u975e\u539f\u751f\u7684 <code>HTML</code> \u4ee3\u7801\uff0c\u8fd9\u5176\u4e2d\u5e76\u4e0d\u5305\u542b <code>Ajax</code> \u8bf7\u6c42\u3002</p> <p>\u5982\u4f55\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5462\uff1f\u901a\u5e38\u60c5\u51b5\u4e0b\u53ef\u4ee5\u5206\u6790 js \u811a\u672c\uff0c\u627e\u5230\u8c03\u7528\u7684\u63a5\u53e3\uff0c\u76f4\u63a5\u8bf7\u6c42\u63a5\u53e3\u83b7\u53d6\u6570\u636e\uff0c\u4f46\u662f\u8fd9\u4e9b\u63a5\u53e3\u6709\u52a0\u5bc6\u6216\u8005\u9a8c\u8bc1\uff0c\u8bf7\u6c42\u63a5\u53e3\u662f\u6bd4\u8f83\u9ebb\u70e6\u7684\u3002\u5bf9\u4e8e\u9700\u8981\u6267\u884c js \u811a\u672c\u624d\u80fd\u751f\u6210\u9875\u9762\u7684\u7f51\u7ad9\u662f\u65e0\u6cd5\u76f4\u63a5\u901a\u8fc7\u63a5\u53e3\u83b7\u53d6\u6570\u636e\u7684\uff0c\u4e3a\u4e86\u65b9\u4fbf\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 <code>selenium + \uff08\u6d4f\u89c8\u5668\u9a71\u52a8\uff09firefox</code> \u6a21\u62df\u6d4f\u89c8\u5668\u7684\u884c\u4e3a\uff0c\u901a\u8fc7\u8fd9\u4e2a\u5de5\u5177\u5c31\u53ef\u4ee5\u6267\u884c js \u811a\u672c\u83b7\u53d6\u5230\u6574\u4e2a\u7f51\u9875\u7684\u5b8c\u6574\u6570\u636e\u3002</p> <p>selenium \u662f\u4e00\u4e2a\u81ea\u52a8\u5316\u6d4b\u8bd5\u5de5\u5177</p> <p>\u8be6\u7ec6\u5185\u5bb9\u53ca\u4f7f\u7528\u53ef\u4ee5\u67e5\u770b\u5b98\u65b9\u6587\u6863\uff1ahttps://www.selenium.dev/documentation/</p> <p>\u6bd4\u5982\u4eca\u65e5\u5934\u6761\u65b0\u95fb\u7f51\u9875\u7684\u6570\u636e\u6570\u636e\u7ecf\u8fc7\u7b97\u6cd5\u52a0\u5bc6\uff0c\u65e0\u6cd5\u76f4\u63a5\u8bf7\u6c42\u63a5\u53e3\uff0c\u9700\u8981\u7834\u89e3\u5b83\u7684\u52a0\u5bc6\u89c4\u5219\uff0c\u7f51\u4e0a\u6709\u5f88\u591a\u5927\u4f6c\u5199\u8fc7\u5982\u679c\u6293\u53d6\u4eca\u65e5\u5934\u6761\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u81ea\u884c\u767e\u5ea6\u67e5\u627e\uff0c\u603b\u4e4b\u6709\u5f88\u591a\u5751\u5f88\u9ebb\u70e6\uff0c\u540e\u9762\u4f1a\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 selenium \u6293\u53d6\u4eca\u65e5\u5934\u6761\u7684\u6570\u636e\u3002</p> <p>\u5927\u6982\u77e5\u9053\u4e86\u4f7f\u7528 selenium \u53ef\u4ee5\u83b7\u53d6\u4efb\u4f55\u7f51\u9875\u4e2d\u7684\u6570\u636e\uff0c\u4f46\u662f\u4f7f\u7528 selenium \u5b58\u5728\u7684\u7f3a\u70b9\u5982\u4e0b\uff1a</p> <ol> <li>\u6548\u7387\u8f83\u4f4e</li> </ol> <p>\u6bcf\u4e00\u6b21\u8bf7\u6c42\u76f8\u5f53\u4e8e\u8981\u6253\u5f00\u4e00\u6b21\u6d4f\u89c8\u5668\uff0c\u8fd9\u4e2a\u542f\u52a8\u6548\u7387\u76f8\u5bf9\u4e8e\u76f4\u63a5\u8c03\u7528\u63a5\u53e3\u6765\u8bf4\u662f\u975e\u5e38\u4f4e\u7684\uff0c\u901a\u5e38\u9700\u8981\u51e0\u79d2\u7684\u65f6\u95f4\u3002</p> <ol> <li>\u8d44\u6e90\u6d6a\u8d39</li> </ol> <p>selenium \u6a21\u62df\u6d4f\u89c8\u5668\u7684\u884c\u4e3a\uff0c\u5927\u91cf\u8bf7\u6c42\u4f1a\u6781\u5176\u6d88\u8017\u8d44\u6e90</p>"},{"location":"%E7%88%AC%E8%99%AB/%E3%80%90%E7%88%AC%E8%99%AB%E3%80%91python%2Bselenium%2Bfirefox%E4%BD%BF%E7%94%A8%E4%B8%8E%E9%83%A8%E7%BD%B2%E8%AF%A6%E8%A7%A3/#selenium_1","title":"\u4e09. \u4f20\u7edf\u65b9\u5f0f\u914d\u7f6e\u4f7f\u7528 selenium","text":""},{"location":"%E7%88%AC%E8%99%AB/%E3%80%90%E7%88%AC%E8%99%AB%E3%80%91python%2Bselenium%2Bfirefox%E4%BD%BF%E7%94%A8%E4%B8%8E%E9%83%A8%E7%BD%B2%E8%AF%A6%E8%A7%A3/#1-windows-selenium","title":"1. \u5728 windows \u4e2d\u914d\u7f6e selenium","text":"<p>\u8fd9\u91cc\u4e3b\u8981\u6f14\u793a\u4f7f\u7528 python + selenium \u6765\u722c\u53d6\u6570\u636e\uff0c\u6240\u4ee5\u4e0b\u9762\u53ea\u4f1a\u4ecb\u7ecd python \u7684\u5b89\u88c5\u65b9\u5f0f\uff0c\u5176\u4ed6\u5b89\u88c5\u65b9\u5f0f\u53ef\u4ee5\u67e5\u770b\u5b98\u65b9\u6587\u6863\u3002</p>"},{"location":"%E7%88%AC%E8%99%AB/%E3%80%90%E7%88%AC%E8%99%AB%E3%80%91python%2Bselenium%2Bfirefox%E4%BD%BF%E7%94%A8%E4%B8%8E%E9%83%A8%E7%BD%B2%E8%AF%A6%E8%A7%A3/#selenum","title":"\u5b89\u88c5 Selenum \u5e93","text":"<p>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u5b89\u88c5 selenium \u5e93\uff1a</p> <pre><code>pip install selenium\n</code></pre>"},{"location":"%E7%88%AC%E8%99%AB/%E3%80%90%E7%88%AC%E8%99%AB%E3%80%91python%2Bselenium%2Bfirefox%E4%BD%BF%E7%94%A8%E4%B8%8E%E9%83%A8%E7%BD%B2%E8%AF%A6%E8%A7%A3/#firefox","title":"\u5b89\u88c5 firefox \u6d4f\u89c8\u5668","text":"<p>firefox \u4e0b\u8f7d\u5730\u5740\uff1ahttp://www.firefox.com.cn/download/</p> <p></p> <p>\u6839\u636e\u9700\u8981\u4e0b\u8f7d\u5bf9\u5e94\u73af\u5883\u7684\u5b89\u88c5\u5305\uff0c\u56e0\u4e3a\u8fd9\u91cc\u662f\u5728 windows \u4e2d\u914d\u7f6e\uff0c\u6240\u4ee5\u4e0b\u8f7d windows \u7684\u3002\u4e0b\u8f7d\u5b8c\u6210\u540e\uff0c\u53cc\u51fb <code>.exe</code>\u6587\u4ef6\uff0c\u70b9\u51fb \u4e0b\u4e00\u6b65\u5b8c\u6210\u5b89\u88c5\u3002</p> <p></p>"},{"location":"%E7%88%AC%E8%99%AB/%E3%80%90%E7%88%AC%E8%99%AB%E3%80%91python%2Bselenium%2Bfirefox%E4%BD%BF%E7%94%A8%E4%B8%8E%E9%83%A8%E7%BD%B2%E8%AF%A6%E8%A7%A3/#firefox_1","title":"\u5b89\u88c5 firefox \u6d4f\u89c8\u5668\u9a71\u52a8","text":"<p>\u5b89\u88c5\u597d\u6d4f\u89c8\u5668\u4e4b\u540e\uff0c\u8fd8\u9700\u8981\u5b89\u88c5\u6d4f\u89c8\u5668\u7684\u9a71\u52a8\u624d\u80fd\u662f\u6d4f\u89c8\u5668\u5b8c\u6210\u76f8\u5e94\u7684\u64cd\u4f5c\u3002\u56e0\u4e3a\u8fd9\u91cc\u662f\u4f7f\u7528\u7684 firefox \u6d4f\u89c8\u5668\uff0c\u6240\u4ee5\u9700\u8981\u5b89\u88c5\u5176\u5bf9\u5e94\u7684\u9a71\u52a8 geckodriver \u3002</p> <p>\u5982\u679c\u6ca1\u6709\u5b89\u88c5  geckodriver \u8fd9\u4e2a\u9a71\u52a8\uff0c\u5f53\u4f7f\u7528\u5982\u4e0b\u4ee3\u7801\u8fd0\u884c\u7684\u65f6\u5019\uff1a</p> <pre><code>import time\nfrom selenium.webdriver import Firefox\nfrom selenium import webdriver\ndriver = webdriver.Firefox()\ndriver.get(\"https://www.toutiao.com/a6969138023774667264/\")\ntime.sleep(2)\nhtml = driver.page_source\nprint(html)\ndriver.quit()\n</code></pre> <p>\u4f1a\u62a5\u51fa\u5982\u4e0b\u9519\u8bef\uff1a</p> <pre><code>FileNotFoundError: [WinError 2] \u7cfb\u7edf\u627e\u4e0d\u5230\u6307\u5b9a\u7684\u6587\u4ef6\u3002\nTraceback (most recent call last):\n    raise WebDriverException(\nselenium.common.exceptions.WebDriverException: Message: 'geckodriver' executable needs to be in PATH. \n</code></pre> <p>\u5173\u4e8e geckodriver \u5b98\u65b9\u4ecb\u7ecd\u5982\u4e0b\uff1a</p> <p>geckodriver\uff1a\u4f7f\u7528 W3C WebDriver \u517c\u5bb9\u5ba2\u6237\u7aef\u4e0e\u57fa\u4e8e Gecko \u7684\u6d4f\u89c8\u5668\u4ea4\u4e92\u7684\u4ee3\u7406\u3002</p> <p>\u8be5\u7a0b\u5e8f\u63d0\u4f9b\u4e86 WebDriver \u534f\u8bae\u63cf\u8ff0\u7684 HTTP API \u6765\u4e0e Gecko \u6d4f\u89c8\u5668\u8fdb\u884c\u901a\u4fe1\uff0c\u4f8b\u5982 Firefox\u3002 \u5b83\u901a\u8fc7\u5145\u5f53\u672c\u5730\u7aef\u548c\u8fdc\u7a0b\u7aef\u4e4b\u95f4\u7684\u4ee3\u7406\u5c06\u8c03\u7528\u8f6c\u6362\u4e3a Marionette \u8fdc\u7a0b\u534f\u8bae\u3002</p> <p>geckodriver \u4e0b\u8f7d\u5730\u5740\uff1ahttps://github.com/mozilla/geckodriver/releases</p> <p>1. \u8bf7\u6839\u636e\u7cfb\u7edf\u7248\u672c\u9009\u62e9\u4e0b\u8f7d\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>2. \u4e0b\u8f7d\u89e3\u538b\u540e\u5c06 <code>getckodriver.exe</code> \u6dfb\u52a0\u5230 Path \u73af\u5883\u53d8\u91cf\u4e2d\u3002</p> <p>\u5982\u679c\u4e0d\u60f3\u6dfb\u52a0\u5230\u73af\u5883\u53d8\u91cf\u4e2d\uff0c\u8fd8\u53ef\u4ee5\u5728\u521b\u5efa firefox \u9a71\u52a8\u5b9e\u4f8b\u7684\u65f6\u5019\u6307\u5b9a geckodirver \u7684\u4f4d\u7f6e\uff1a</p> <pre><code>webdriver.Firefox(executable_path=\"E:/Downloads/geckodriver/geckodriver.exe\")\n</code></pre> <p>**3. \u6dfb\u52a0 <code>getckodriver</code> \u5230\u73af\u5883\u53d8\u91cf\u4e2d\u9700\u8981\u91cd\u542fcmd\u6216\u8005idea **</p>"},{"location":"%E7%88%AC%E8%99%AB/%E3%80%90%E7%88%AC%E8%99%AB%E3%80%91python%2Bselenium%2Bfirefox%E4%BD%BF%E7%94%A8%E4%B8%8E%E9%83%A8%E7%BD%B2%E8%AF%A6%E8%A7%A3/#_2","title":"\u5176\u4ed6\u6d4f\u89c8\u5668\u7684\u9a71\u52a8\u4e0b\u8f7d\u5730\u5740","text":"\u6d4f\u89c8\u5668 \u652f\u6301\u7684\u64cd\u4f5c\u7cfb\u7edf \u7ef4\u62a4\u8005 \u4e0b\u8f7d \u95ee\u9898\u8ffd\u8e2a Chromium/Chrome Windows/macOS/Linux \u8c37\u6b4c \u4e0b\u8f7d \u95ee\u9898 \u706b\u72d0 Windows/macOS/Linux Mozilla \u4e0b\u8f7d \u95ee\u9898 Edge Windows 10 \u5fae\u8f6f \u4e0b\u8f7d \u95ee\u9898 Internet Explorer Windows Selenium \u9879\u76ee\u7ec4 \u4e0b\u8f7d \u95ee\u9898 Safari macOS El Capitan \u53ca\u66f4\u9ad8\u7248\u672c \u82f9\u679c \u5185\u7f6e \u95ee\u9898 Opera Windows/macOS/Linux Opera \u4e0b\u8f7d \u95ee\u9898"},{"location":"%E7%88%AC%E8%99%AB/%E3%80%90%E7%88%AC%E8%99%AB%E3%80%91python%2Bselenium%2Bfirefox%E4%BD%BF%E7%94%A8%E4%B8%8E%E9%83%A8%E7%BD%B2%E8%AF%A6%E8%A7%A3/#2-linux-selenium","title":"2. \u5728 linux \u4e2d\u914d\u7f6e selenium","text":"<p>\u5728 linux \u4e2d\u7684\u914d\u7f6e\u548c windows \u7684\u914d\u7f6e\u6b65\u9aa4\u4e00\u6837\uff0c\u4e0b\u9762\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0b\u3002</p>"},{"location":"%E7%88%AC%E8%99%AB/%E3%80%90%E7%88%AC%E8%99%AB%E3%80%91python%2Bselenium%2Bfirefox%E4%BD%BF%E7%94%A8%E4%B8%8E%E9%83%A8%E7%BD%B2%E8%AF%A6%E8%A7%A3/#selenum_1","title":"\u5b89\u88c5 Selenum \u5e93","text":"<p>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u5b89\u88c5 selenium \u5e93\uff1a</p> <pre><code>pip install selenium\n</code></pre>"},{"location":"%E7%88%AC%E8%99%AB/%E3%80%90%E7%88%AC%E8%99%AB%E3%80%91python%2Bselenium%2Bfirefox%E4%BD%BF%E7%94%A8%E4%B8%8E%E9%83%A8%E7%BD%B2%E8%AF%A6%E8%A7%A3/#firefox_2","title":"\u5b89\u88c5 firefox \u6d4f\u89c8\u5668","text":"<p>firefox \u4e0b\u8f7d\u5730\u5740\uff1ahttp://www.firefox.com.cn/download/</p> <p>\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u4e0b\u8f7d linux \u7248\u672c\u7684 firefox \u6d4f\u89c8\u5668\uff1a</p> <pre><code>wget https://download-ssl.firefox.com.cn/releases/firefox/esr/91.0/zh-CN/Firefox-latest-x86_64.tar.bz2\n</code></pre> <p>\u4e0b\u8f7d\u5b8c\u6210\u540e\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u89e3\u538b\u5f97\u5230 <code>Firefox-latest-x86_64.tar</code>\uff1a</p> <pre><code>bunzip2 -d Firefox-latest-x86_64.tar.bz2\n</code></pre> <p>\u518d\u6b21\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u89e3\u538b\uff1a</p> <pre><code>tar -xvf Firefox-latest-x86_64.tar\n</code></pre>"},{"location":"%E7%88%AC%E8%99%AB/%E3%80%90%E7%88%AC%E8%99%AB%E3%80%91python%2Bselenium%2Bfirefox%E4%BD%BF%E7%94%A8%E4%B8%8E%E9%83%A8%E7%BD%B2%E8%AF%A6%E8%A7%A3/#firefox_3","title":"\u5b89\u88c5 firefox \u6d4f\u89c8\u5668\u9a71\u52a8","text":"<p>geckodriver \u9a71\u52a8\u4e0b\u8f7d\u5730\u5740\uff1ahttps://github.com/mozilla/geckodriver/releases</p> <p>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u4e0b\u8f7d linux \u7cfb\u7edf\u7684\u9a71\u52a8\uff1a</p> <pre><code>wget https://github.com/mozilla/geckodriver/releases/download/v0.29.1/geckodriver-v0.29.1-linux64.tar.gz\n</code></pre> <p>\u89e3\u538b\u540e\u5c06 <code>geckodriver</code> \u5b58\u653e\u81f3 <code>/usr/local/bin/</code> \u8def\u5f84\u4e0b\u5373\u53ef</p> <pre><code>tar -zxvf geckodriver-v0.29.1-linux64.tar.gz\ncp geckodriver /usr/local/bin/\n</code></pre> <p>\u540c\u7406\u5bf9\u4e8eIE\u548cChrome\u6d4f\u89c8\u5668\uff0cIEDriverServer\uff0cchromedriver\u4e5f\u662f\u76f8\u540c\u7684\u5b89\u88c5\u65b9\u6cd5</p>"},{"location":"%E7%88%AC%E8%99%AB/%E3%80%90%E7%88%AC%E8%99%AB%E3%80%91python%2Bselenium%2Bfirefox%E4%BD%BF%E7%94%A8%E4%B8%8E%E9%83%A8%E7%BD%B2%E8%AF%A6%E8%A7%A3/#python-selenium","title":"\u56db. python + selenium \u83b7\u53d6\u4eca\u65e5\u5934\u6761\u6570\u636e","text":"<p>\u4e0b\u9762\u7684\u4ee3\u7801\u662f\u6839\u636e url \u83b7\u53d6\u4eca\u65e5\u5934\u6761\u65b0\u95fb\u4e2d\u7684\u6807\u9898\u3001\u53d1\u5e03\u65f6\u95f4\u3001\u6765\u6e90\u3001\u6b63\u6587\u5185\u5bb9\u3001\u56fe\u7247\u5730\u5740\uff0c\u8be6\u7ec6\u8bf4\u660e\u67e5\u770b\u4ee3\u7801\u6ce8\u91ca\uff1a</p> <pre><code>from lxml import etree\nfrom selenium import webdriver\nfrom selenium.webdriver.common.by import By\nfrom selenium.webdriver.support import expected_conditions as EC  # \u548c\u4e0b\u9762WebDriverWait\u4e00\u8d77\u7528\u7684\nfrom selenium.webdriver.support.wait import WebDriverWait\n\n\ndef html_selenium_firefox(url):\n    \"\"\"\n    \u6839\u636e url \u4f7f\u7528 selenium \u83b7\u53d6\u7f51\u9875\u6e90\u7801\n    :param url: url\n    :return: \u7f51\u9875\u6e90\u7801\n    \"\"\"\n    opt = webdriver.FirefoxOptions()\n    # \u8bbe\u7f6e\u65e0\u754c\u9762\n    opt.add_argument(\"--headless\")\n    # \u7981\u7528 gpu\n    opt.add_argument('--disable-gpu')\n    # \u6307\u5b9a firefox \u7684\u5b89\u88c5\u8def\u5f84\uff0c\u5982\u679c\u914d\u7f6e\u4e86\u73af\u5883\u53d8\u91cf\u5219\u4e0d\u9700\u6307\u5b9a\n    firefox_binary = \"C:\\\\Program Files (x86)\\\\Mozilla Firefox\\\\firefox.exe\"\n    # \u6307\u5b9a geckodirver \u7684\u5b89\u88c5\u8def\u5f84\uff0c\u5982\u679c\u914d\u7f6e\u4e86\u73af\u5883\u53d8\u91cf\u5219\u4e0d\u9700\u6307\u5b9a\n    executable_path = \"E:\\\\Downloads/geckodriver\\\\geckodriver.exe\"\n    driver = webdriver.Firefox(firefox_binary=firefox_binary, executable_path=executable_path, options=opt)\n    # \u53d1\u9001\u8bf7\u6c42\n    driver.get(url)\n    # \u663e\u5f0f\u7b49\u5f85\uff1a\u663e\u5f0f\u5730\u7b49\u5f85\u67d0\u4e2a\u5143\u7d20\u88ab\u52a0\u8f7d\n    wait = WebDriverWait(driver, 20)\n    wait.until(EC.presence_of_element_located((By.CLASS_NAME, 'article-content')))\n    wait.until(EC.presence_of_element_located((By.TAG_NAME, 'span')))\n    # \u83b7\u53d6\u7f51\u9875\u6e90\u7801\n    html = driver.page_source\n    # \u5173\u95ed\u6d4f\u89c8\u5668\u91ca\u653e\u8d44\u6e90\n    driver.quit()\n    return html\n\n\ndef get_news_content(url):\n    html = html_selenium_firefox(url)\n    tree = etree.HTML(html)\n    title = tree.xpath('//div[@class=\"article-content\"]/h1/text()')[0]\n    # xpath \u67e5\u627e\u6ca1\u6709 class \u7684\u5143\u7d20\uff1aspan[not(@class)]\n    pubtime = tree.xpath('//div[@class=\"article-meta mt-4\"]/span[not(@class)]/text()')[0]\n    # xpath \u67e5\u627e class=\"name\" \u7684\u5143\u7d20\uff1aspan[@class=\"name\"]\n    source = tree.xpath('//div[@class=\"article-meta mt-4\"]/span[@class=\"name\"]/a/text()')[0]\n    # xpath \u67d0\u4e2a\u6807\u7b7e\u4e2d\u7684\u6240\u6709\u5143\u7d20\uff1a//div\n    content = tree.xpath('//article')[0]\n    # \u5904\u7406 content \u4e71\u7801\u95ee\u9898\n    content = str(etree.tostring(content, encoding='utf-8', method='html'), 'utf-8')\n    # \u63d0\u53d6 content \u4e2d\u6240\u6709\u56fe\u7247\u7684\u5730\u5740\n    images = etree.HTML(content).xpath('//img/@src')\n\n    result = {\n        \"title\": title,\n        \"pubtime\": pubtime,\n        \"source\": source,\n        \"content\": content,\n        \"images\": images,\n    }\n    return result\n\n\nif __name__ == '__main__':\n    url = \"https://www.toutiao.com/a6969138023774667264/\"\n    result = get_news_content(url)\n    print(result)\n</code></pre> <p>\u5173\u4e8e selenium \u548c xpath \u7684\u66f4\u591a\u4f7f\u7528\uff0c\u53ef\u4ee5\u67e5\u770b\u5b98\u65b9\u6587\u6863\uff0c\u8fd9\u91cc\u4e0d\u518d\u8be6\u7ec6\u8bf4\u660e\u3002</p> <p>\u53c2\u8003\u6587\u7ae0\uff1a</p> <p>https://blog.csdn.net/rhx_qiuzhi/article/details/80296801</p> <p>https://github.com/mozilla/geckodriver</p> <p>https://www.selenium.dev/documentation</p>"},{"location":"%E7%AE%97%E6%B3%95/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F%E5%9B%BE%E6%96%87%E8%AE%B2%E8%A7%A3/","title":"\u5f52\u5e76\u6392\u5e8f\u56fe\u6587\u8bb2\u89e3","text":"<p>\u4e00\u4e2a\u4eba\u9700\u8981\u7684\u4e1c\u897f\u6108\u5c11\uff0c\u4ed6\u7684\u5e78\u798f\u5c31\u6108\u5927\uff0c\u4e00\u4e2a\u4eba\u7684\u613f\u671b\u6108\u591a\uff0c\u4ed6\u7684\u81ea\u7531\u5c31\u6108\u5c11\u3002\u2014\u2014\u2014\u2014 \u9ad8\u5c14\u57fa\u300a\u6211\u7684\u5927\u5b66\u300b</p> <p>\u8fd9\u662f\u6211\u53c2\u4e0e\u66f4\u6587\u6311\u6218\u7684\u7b2c11\u5929\uff0c\u6d3b\u52a8\u8be6\u60c5\u67e5\u770b\uff1a \u66f4\u6587\u6311\u6218</p>"},{"location":"%E7%AE%97%E6%B3%95/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F%E5%9B%BE%E6%96%87%E8%AE%B2%E8%A7%A3/#_2","title":"\u4e00\u3001\u7b97\u6cd5\u601d\u60f3","text":"<p>\u5f52\u5e76\u6392\u5e8f\u662f\u6700\u6d41\u884c\u7684\u6392\u5e8f\u7b97\u6cd5\u4e4b\u4e00\uff0c\u5b83\u57fa\u4e8e\u5206\u800c\u6cbb\u4e4b\u7b97\u6cd5\u7684\u539f\u7406\u3002\u5728\u8fd9\u91cc\uff0c\u4e00\u4e2a\u95ee\u9898\u88ab\u5212\u5206\u4e3a\u591a\u4e2a\u5b50\u95ee\u9898\u3002\u6bcf\u4e2a\u5b50\u95ee\u9898\u90fd\u662f\u5355\u72ec\u89e3\u51b3\u7684\u3002\u6700\u540e\uff0c\u5c06\u5b50\u95ee\u9898\u7ec4\u5408\u8d77\u6765\u5f62\u6210\u6700\u7ec8\u89e3\u51b3\u65b9\u6848\u3002</p> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u5f52\u5e76\u6392\u5e8f\u7b97\u6cd5\u9012\u5f52\u5730\u5c06\u6570\u7ec4\u5206\u6210\u4e24\u534a\uff0c\u76f4\u5230\u6211\u4eec\u8fbe\u5230\u5177\u6709 1 \u4e2a\u5143\u7d20\u7684\u6570\u7ec4\u7684\u60c5\u51b5\u3002\u4e4b\u540e\uff0cmerge \u51fd\u6570\u9009\u53d6\u5df2\u6392\u5e8f\u7684\u5b50\u6570\u7ec4\u5e76\u5408\u5e76\u5b83\u4eec\u4ee5\u9010\u6e10\u5bf9\u6574\u4e2a\u6570\u7ec4\u8fdb\u884c\u6392\u5e8f\u3002</p> <p></p>"},{"location":"%E7%AE%97%E6%B3%95/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F%E5%9B%BE%E6%96%87%E8%AE%B2%E8%A7%A3/#1","title":"1. \u56fe\u89e3","text":"<p>\u5047\u8bbe\u6211\u4eec\u8bd5\u56fe\u6309\u5347\u5e8f\u5bf9\u5143\u7d20\u8fdb\u884c\u6392\u5e8f\u3002 </p> <p></p>"},{"location":"%E7%AE%97%E6%B3%95/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F%E5%9B%BE%E6%96%87%E8%AE%B2%E8%A7%A3/#_3","title":"\u4e8c\u3001\u5de5\u4f5c\u6d41\u7a0b","text":"<p>\u5f52\u5e76\u6392\u5e8f\u662f\u57fa\u4e8e\u5206\u800c\u6cbb\u4e4b\u7684\u601d\u60f3\u5b9e\u73b0\u7684\uff0c\u62c6\u5f00\u6765\u8bf4\u5c31\u4e24\u5927\u6b65\u9aa4\uff1a</p> <p>\u5212\u5206\uff1a\u4f7f\u7528\u9012\u5f52\u7684\u65b9\u5f0f\u5c06\u539f\u6570\u7ec4\u5212\u5206\u6210\u53ea\u6709\u4e00\u4e2a\u5143\u7d20\u7684\u5b50\u6570\u7ec4\uff0c\u8fd9\u4e2a\u4e00\u4e2a\u5143\u7d20\u5c31\u662f\u5df2\u7ecf\u6392\u597d\u5e8f\u7684\u4e86</p> <p>\u6cbb\u7406\uff1a\u5c06\u6392\u597d\u5e8f\u7684\u5b50\u6570\u7ec4\u6309\u7167\u89c4\u5219\u5408\u5e76\u4ee5\u6784\u5efa\u4e00\u4e2a\u6700\u7ec8\u7684\u6392\u5e8f\u6570\u7ec4</p> <p>\u5f52\u5e76\u6392\u5e8f\u7b97\u6cd5\u6700\u91cd\u8981\u7684\u6b65\u9aa4\u5c31\u662f\u5408\u5e76\uff0c\u5408\u5e76\u6b65\u9aa4\u662f\u5408\u5e76\u4e24\u4e2a\u6392\u5e8f\u5b50\u6570\u7ec4\u4ee5\u6784\u5efa\u4e00\u4e2a\u5927\u7684\u6392\u5e8f\u6570\u7ec4\u7684\u89e3\u51b3\u65b9\u6848\u3002</p>"},{"location":"%E7%AE%97%E6%B3%95/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F%E5%9B%BE%E6%96%87%E8%AE%B2%E8%A7%A3/#_4","title":"\u7f16\u5199\u5408\u5e76\u51fd\u6570\u7684\u6b65\u9aa4","text":"<p>\u5047\u8bbe\u539f\u6570\u7ec4\u662f <code>arr[p..r]</code> (p\u662f\u7b2c\u4e00\u4e2a\u7d22\u5f15\uff0cr\u662f\u6700\u540e\u4e00\u4e2a\u7d22\u5f15)\uff0cq \u662f p \u548c r \u4e4b\u95f4\u7684\u4e2d\u95f4\u70b9\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u628a\u539f\u6570\u7ec4  <code>arr[p..r]</code> \u62c6\u5206\u6210\u4e24\u4e2a\u5b50\u6570\u7ec4 <code>arr[p..q]</code> \u548c <code>arr[q+1..r]</code></p> <p>\u5408\u5e76\u51fd\u6570\u7684\u4efb\u52a1\u5c31\u662f\u5408\u5e76\u4e24\u4e2a\u5b50\u6570\u7ec4  <code>arr[p..q]</code> \u548c  <code>arr[q+1..r]</code> \u521b\u5efa\u4e00\u4e2a\u6392\u5e8f\u6570\u7ec4<code>arr[p..r]</code>\uff0c \u6240\u4ee5\u51fd\u6570\u7684\u8f93\u5165\u662f <code>arr\u3001p\u3001q \u548c r</code></p>"},{"location":"%E7%AE%97%E6%B3%95/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F%E5%9B%BE%E6%96%87%E8%AE%B2%E8%A7%A3/#_5","title":"\u7f16\u5199\u5408\u5e76\u51fd\u6570\u7684\u6b65\u9aa4\uff1a","text":"<ol> <li>\u521b\u5efa\u4e24\u4e2a\u5b50\u6570\u7ec4\u5206\u522b\u662f <code>arr[p..q] -&gt; L \u548c arr[q+1..r] -&gt; M</code></li> <li>\u5c06\u539f\u6570\u7ec4\u7684\u5143\u7d20\u653e\u5230\u4e24\u4e2a\u5b50\u6570\u7ec4\u4e2d</li> <li>\u521b\u5efa\u4e09\u4e2a\u6307\u9488 i\uff0cj\uff0ck</li> <li>i \u6307\u5411\u7b2c\u4e00\u4e2a\u5b50\u6570\u7ec4 L \u7684\u7d22\u5f15 \uff0c\u521d\u59cb\u503c\u4e3a 0</li> <li>j \u6307\u5411\u7b2c\u4e8c\u4e2a\u5b50\u6570\u7ec4 M \u7684\u7d22\u5f15\uff0c\u521d\u59cb\u503c\u4e3a 0</li> <li>k \u6307\u5411\u539f\u6570\u7ec4\u7684\u7d22\u5f15\uff0c\u521d\u59cb\u503c\u4e3a p</li> <li>\u904d\u5386\u4e24\u4e2a\u5b50\u6570\u7ec4\uff0c\u4ece\u4e2d\u9009\u62e9\u8f83\u5c0f\u7684\u5143\u7d20\uff0c\u5e76\u5c06\u5b83\u4eec\u653e\u5230\u539f\u6570\u7ec4\u7684\u6b63\u786e\u4f4d\u7f6e\uff0c\u76f4\u5230\u5230\u8fbe\u4efb\u4f55\u4e00\u4e2a\u5b50\u6570\u7ec4\u7684\u672b\u5c3e\u4e3a\u6b62</li> <li>\u5c06\u5b50\u6570\u7ec4\u7684\u5269\u4f59\u5143\u7d20\u653e\u5230\u539f\u6570\u7ec4\u7684\u672b\u5c3e</li> </ol> <p>\u4ee3\u7801\u5b9e\u73b0\u5982\u4e0b\uff1a</p> <pre><code>// \u5408\u5e76\u5b50\u6570\u7ec4\u7684\u5143\u7d20\u5230\u539f\u6570\u7ec4\nvoid merge(int arr[], int p, int q, int r) {\n\n    // \u521b\u5efa\u4e24\u4e2a\u5b50\u6570\u7ec4 L \u2190 A[p..q] \u548c M \u2190 A[q+1..r]\n    int n1 = q - p + 1;\n    int n2 = r - q;\n\n    int L[n1], M[n2];\n\n    for (int i = 0; i &lt; n1; i++)\n        L[i] = arr[p + i];\n    for (int j = 0; j &lt; n2; j++)\n        M[j] = arr[q + 1 + j];\n\n    // \u5b9a\u4e49\u6307\u9488\u6307\u5411\u5b50\u6570\u7ec4\u548c\u539f\u6570\u7ec4\u7684\u5f53\u524d\u7d22\u5f15\u4f4d\u7f6e\n    int i, j, k;\n    i = 0;\n    j = 0;\n    k = p;\n\n\n    // \u904d\u5386\u4e24\u4e2a\u5b50\u6570\u7ec4\uff0c\u4ece\u4e2d\u9009\u62e9\u8f83\u5c0f\u7684\u5143\u7d20\uff0c\u5e76\u5c06\u5b83\u4eec\u653e\u5230\u539f\u6570\u7ec4\u7684\u6b63\u786e\u4f4d\u7f6e\uff0c\n    // \u76f4\u5230\u5230\u8fbe\u4efb\u4f55\u4e00\u4e2a\u5b50\u6570\u7ec4\u7684\u672b\u5c3e\u4e3a\u6b62\n    while (i &lt; n1 &amp;&amp; j &lt; n2) {\n        if (L[i] &lt;= M[j]) {\n            arr[k] = L[i];\n            i++;\n        } else {\n            arr[k] = M[j];\n            j++;\n        }\n        k++;\n    }\n\n    // \u5c06\u5b50\u6570\u7ec4\u7684\u5269\u4f59\u5143\u7d20\u653e\u5230\u539f\u6570\u7ec4\u7684\u672b\u5c3e\n    while (i &lt; n1) {\n        arr[k] = L[i];\n        i++;\n        k++;\n    }\n\n    while (j &lt; n2) {\n        arr[k] = M[j];\n        j++;\n        k++;\n    }\n}\n</code></pre>"},{"location":"%E7%AE%97%E6%B3%95/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F%E5%9B%BE%E6%96%87%E8%AE%B2%E8%A7%A3/#merge","title":"Merge() \u51fd\u6570\u9010\u6b65\u89e3\u91ca","text":"<p>\u8fd9\u4e2a\u51fd\u6570\u53d1\u751f\u4e86\u5f88\u591a\u4e8b\u60c5\uff0c\u6240\u4ee5\u8ba9\u6211\u4eec\u4e3e\u4e00\u4e2a\u4f8b\u5b50\u6765\u770b\u770b\u5b83\u662f\u5982\u4f55\u5de5\u4f5c\u7684\u3002</p> <p>\u4e00\u56fe\u80dc\u5343\u8a00\uff0c\u5047\u8bbe\u539f\u6570\u7ec4\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u6570\u7ec4 <code>A[0..5]</code> \u5305\u542b\u4e24\u4e2a\u6392\u5e8f\u7684\u5b50\u6570\u7ec4 <code>A[0..3]</code> \u548c <code>A[4..5]</code>. \u8ba9\u6211\u4eec\u770b\u770b\u5408\u5e76\u51fd\u6570\u5982\u4f55\u5408\u5e76\u4e24\u4e2a\u6570\u7ec4\u3002</p> <p>\u6b65\u9aa4 1\uff1a\u521b\u5efa\u8981\u6392\u5e8f\u7684\u5b50\u6570\u7ec4\u7684\u91cd\u590d\u526f\u672c</p> <pre><code>// Create L \u2190 A[p..q] and M \u2190 A[q+1..r]\nint n1 = q - p + 1 = 3 - 0 + 1 = 4;\nint n2 = r - q = 5 - 3 = 2;\n\nint L[4], M[2];\n\nfor (int i = 0; i &lt; 4; i++)\n    L[i] = arr[p + i];\n// L[0,1,2,3] = A[0,1,2,3] = [1,5,10,12]\n\nfor (int j = 0; j &lt; 2; j++)\n    M[j] = arr[q + 1 + j];\n// M[0,1] = A[4,5] = [6,9]\n</code></pre> <p></p> <p>\u6b65\u9aa4 2\uff1a\u7ef4\u62a4\u5b50\u6570\u7ec4\u548c\u4e3b\u6570\u7ec4\u7684\u5f53\u524d\u7d22\u5f15</p> <pre><code>    int i, j, k;\n    i = 0; \n    j = 0; \n    k = p; \n</code></pre> <p></p> <p>\u7b2c 3 \u6b65\uff1a\u76f4\u5230\u6211\u4eec\u5230\u8fbe L \u6216 M \u7684\u672b\u5c3e\uff0c\u5728\u5143\u7d20 L \u548c M \u4e2d\u9009\u53d6\u8f83\u5c0f\u7684\u5143\u7d20\u5e76\u5c06\u5b83\u4eec\u653e\u7f6e\u5728 A[p..r]</p> <pre><code>    while (i &lt; n1 &amp;&amp; j &lt; n2) { \n        if (L[i] &lt;= M[j]) { \n            arr[k] = L[i]; i++; \n        } \n        else { \n            arr[k] = M[j]; \n            j++; \n        } \n        k++; \n    }\n</code></pre> <p></p> <p>\u7b2c 4 \u6b65\uff1a\u5f53\u6211\u4eec\u7528\u5b8c L \u6216 M \u4e2d\u7684\u5143\u7d20\u65f6\uff0c\u62ff\u8d77\u5269\u4f59\u7684\u5143\u7d20\u5e76\u653e\u5165 A[p..r]</p> <pre><code>   // \u5c06\u7b2c\u4e00\u4e2a\u6570\u7ec4\u4e2d\u7684\u5269\u4f59\u5143\u7d20\u590d\u5236\u5230\u4e3b\u5b50\u6570\u7ec4\n    while (i &lt; n1)\n    {\n        arr[k] = L[i];\n        i++;\n        k++;\n    }\n</code></pre> <p></p> <pre><code>   // \u5c06\u7b2c\u4e8c\u4e2a\u6570\u7ec4\u7684\u5269\u4f59\u5143\u7d20\u590d\u5236\u5230\u4e3b\u5b50\u6570\u7ec4\n    while (j &lt; n2)\n    {\n        arr[k] = M[j];\n        j++;\n        k++;\n    }\n}\n</code></pre> <p></p>"},{"location":"%E7%AE%97%E6%B3%95/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F%E5%9B%BE%E6%96%87%E8%AE%B2%E8%A7%A3/#_6","title":"\u4e09\u3001\u4ee3\u7801\u5b9e\u73b0","text":""},{"location":"%E7%AE%97%E6%B3%95/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F%E5%9B%BE%E6%96%87%E8%AE%B2%E8%A7%A3/#1_1","title":"1. \u4f2a\u4ee3\u7801\u5b9e\u73b0","text":"<pre><code>\u6211\u4eec\u662f\u5426\u5df2\u5230\u8fbe\u4efb\u4f55\u5b50\u6570\u7ec4\u7684\u672b\u5c3e\uff1f\n    \u4e0d\uff1a\n        \u6bd4\u8f83\u4e24\u4e2a\u6570\u7ec4\u7684\u5f53\u524d\u5143\u7d20 \n        \u5c06\u8f83\u5c0f\u7684\u5143\u7d20\u590d\u5236\u5230\u5df2\u6392\u5e8f\u7684\u6570\u7ec4\u4e2d\n        \u79fb\u52a8\u5305\u542b\u8f83\u5c0f\u5143\u7d20\u7684\u5143\u7d20\u7684\u6307\u9488\n    \u662f\u7684\uff1a\n        \u590d\u5236\u975e\u7a7a\u6570\u7ec4\u7684\u6240\u6709\u5269\u4f59\u5143\u7d20\n</code></pre>"},{"location":"%E7%AE%97%E6%B3%95/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F%E5%9B%BE%E6%96%87%E8%AE%B2%E8%A7%A3/#2-java","title":"2. java \u5b9e\u73b0","text":"<pre><code>import java.util.Arrays;\n\n/**\n * \u5f52\u5e76\u6392\u5e8f\n *\n * @className: MergeSort\n * @date: 2021/6/30 14:17\n */\npublic class MergeSort {\n    public static void main(String[] args) {\n        int[] arr = { 6, 5, 12, 10, 9, 1 };\n        mergeSort(arr, 0, arr.length -1);\n        System.out.println(Arrays.toString(arr));\n    }\n\n    /**\n     * \u9012\u5f52\u8c03\u7528\uff0c\u5c06\u539f\u6570\u7ec4\u5212\u5206\u6210\u5b50\u6570\u7ec4\n     * @param arr \u539f\u6570\u7ec4\n     * @param p \u8d77\u59cb\u7d22\u5f15\n     * @param r \u7ed3\u675f\u7d22\u5f15\n     */\n    public static void mergeSort(int[] arr, int p, int r) {\n        if (p &lt; r) {\n            int q = (p + r) /2;\n            mergeSort(arr, p, q);\n            mergeSort(arr, q + 1, r);\n            merge(arr, p, q, r);\n        }\n    }\n\n    public static void merge(int[] arr, int p, int q, int r) {\n        // \u5b9a\u4e49\u4e24\u4e2a\u5b50\u6570\u7ec4\u7528\u6765\u4fdd\u5b58\u539f\u6570\u7ec4\u7684\u5143\u7d20\n        int n1 = q - p + 1;\n        int n2 = r - q;\n        int[] L = new int[n1];\n        int[] M = new int[n2];\n        // \u5c06\u539f\u6570\u7ec4\u7684\u5143\u7d20\u4fdd\u5b58\u5230\u5b50\u6570\u7ec4\u4e2d\n        for (int i = 0; i &lt; n1; i++) {\n            L[i] = arr[p + i];\n        }\n        for (int i = 0; i &lt; n2; i++) {\n            M[i] = arr[q + i + 1];\n        }\n        // \u5b9a\u4e49\u4e09\u4e2a\u6307\u9488\u5206\u522b\u6307\u5411\u539f\u6570\u7ec4\u548c\u5b50\u6570\u7ec4\u7684\u7d22\u5f15\n        int i = 0;\n        int j = 0;\n        int k = p;\n        // \u904d\u5386\u5b50\u6570\u7ec4\u7684\u5143\u7d20\uff0c\u76f4\u5230\u5230\u8fbe\u5b50\u6570\u7ec4\u7684\u672b\u5c3e\n        while (i &lt; n1 &amp;&amp; j &lt; n2) {\n            if (L[i] &lt; M[j]) {\n                arr[k] = L[i];\n                i++;\n            } else {\n                arr[k] = M[j];\n                j++;\n            }\n            k++;\n        }\n        // \u5c06\u5b50\u6570\u7ec4\u5269\u4f59\u5143\u7d20\u4fdd\u5b58\u5230\u539f\u6570\u7ec4\n        while (i &lt; n1) {\n            arr[k] = L[i];\n            i++;\n            k++;\n        }\n        while (j &lt; n2) {\n            arr[k] = M[j];\n            j++;\n            k++;\n        }\n    }\n}\n</code></pre>"},{"location":"%E7%AE%97%E6%B3%95/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F%E5%9B%BE%E6%96%87%E8%AE%B2%E8%A7%A3/#_7","title":"\u56db\u3001\u6392\u5e8f\u590d\u6742\u5ea6","text":""},{"location":"%E7%AE%97%E6%B3%95/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F%E5%9B%BE%E6%96%87%E8%AE%B2%E8%A7%A3/#1_2","title":"1. \u65f6\u95f4\u590d\u6742\u5ea6","text":"\u65f6\u95f4\u590d\u6742\u5ea6 \u6700\u597d O(n*log n) \u6700\u5dee O(n*log n) \u5e73\u5747 O(n*log n) \u7a7a\u95f4\u590d\u6742\u5ea6 O(n) \u7a33\u5b9a \u662f"},{"location":"%E7%AE%97%E6%B3%95/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F%E5%9B%BE%E6%96%87%E8%AE%B2%E8%A7%A3/#2","title":"2. \u7a7a\u95f4\u590d\u6742\u5ea6","text":"<ul> <li>\u7a7a\u95f4\u590d\u6742\u5ea6\u662fO(n)\uff0c\u56e0\u4e3a\u5c06\u539f\u6570\u7ec4\u7684\u5143\u7d20\u590d\u6742\u5230\u4e86\u5b50\u6570\u7ec4\u4e2d\u3002</li> </ul>"},{"location":"%E7%AE%97%E6%B3%95/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F%E5%9B%BE%E6%96%87%E8%AE%B2%E8%A7%A3/#_8","title":"\u4e94\u3001\u5f52\u5e76\u6392\u5e8f\u5e94\u7528","text":"<ul> <li>\u5012\u6570\u95ee\u9898</li> <li>\u5916\u90e8\u6392\u5e8f</li> <li>\u7535\u5b50\u5546\u52a1\u5e94\u7528</li> </ul> <p>\u53c2\u8003\u6587\u7ae0\uff1a</p> <p>https://www.programiz.com/dsa/merge-sort</p>"}]}